var EX=Object.defineProperty;var v3=t=>{throw TypeError(t)};var $X=(t,e,n)=>e in t?EX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var vn=(t,e,n)=>$X(t,typeof e!="symbol"?e+"":e,n),u2=(t,e,n)=>e.has(t)||v3("Cannot "+n);var J=(t,e,n)=>(u2(t,e,"read from private field"),n?n.call(t):e.get(t)),Ft=(t,e,n)=>e.has(t)?v3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),xt=(t,e,n,s)=>(u2(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n),un=(t,e,n)=>(u2(t,e,"access private method"),n);var sy=(t,e,n,s)=>({set _(r){xt(t,e,r,n)},get _(){return J(t,e,s)}});function yL(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var Cl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function IX(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var vL={exports:{}},Aw={},bL={exports:{}},bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var px=Symbol.for("react.element"),RX=Symbol.for("react.portal"),PX=Symbol.for("react.fragment"),AX=Symbol.for("react.strict_mode"),jX=Symbol.for("react.profiler"),DX=Symbol.for("react.provider"),OX=Symbol.for("react.context"),FX=Symbol.for("react.forward_ref"),MX=Symbol.for("react.suspense"),LX=Symbol.for("react.memo"),BX=Symbol.for("react.lazy"),b3=Symbol.iterator;function VX(t){return t===null||typeof t!="object"?null:(t=b3&&t[b3]||t["@@iterator"],typeof t=="function"?t:null)}var wL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},SL=Object.assign,CL={};function Jp(t,e,n){this.props=t,this.context=e,this.refs=CL,this.updater=n||wL}Jp.prototype.isReactComponent={};Jp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Jp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function kL(){}kL.prototype=Jp.prototype;function yT(t,e,n){this.props=t,this.context=e,this.refs=CL,this.updater=n||wL}var vT=yT.prototype=new kL;vT.constructor=yT;SL(vT,Jp.prototype);vT.isPureReactComponent=!0;var w3=Array.isArray,NL=Object.prototype.hasOwnProperty,bT={current:null},TL={key:!0,ref:!0,__self:!0,__source:!0};function _L(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)NL.call(e,s)&&!TL.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:px,type:t,key:i,ref:o,props:r,_owner:bT.current}}function zX(t,e){return{$$typeof:px,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function wT(t){return typeof t=="object"&&t!==null&&t.$$typeof===px}function WX(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var S3=/\/+/g;function d2(t,e){return typeof t=="object"&&t!==null&&t.key!=null?WX(""+t.key):e.toString(36)}function lv(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case px:case RX:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+d2(o,0):s,w3(r)?(n="",t!=null&&(n=t.replace(S3,"$&/")+"/"),lv(r,e,n,"",function(c){return c})):r!=null&&(wT(r)&&(r=zX(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(S3,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",w3(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+d2(i,a);o+=lv(i,e,n,l,r)}else if(l=VX(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+d2(i,a++),o+=lv(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ry(t,e,n){if(t==null)return t;var s=[],r=0;return lv(t,s,"","",function(i){return e.call(n,i,r++)}),s}function UX(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ki={current:null},cv={transition:null},HX={ReactCurrentDispatcher:ki,ReactCurrentBatchConfig:cv,ReactCurrentOwner:bT};function EL(){throw Error("act(...) is not supported in production builds of React.")}bn.Children={map:ry,forEach:function(t,e,n){ry(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ry(t,function(){e++}),e},toArray:function(t){return ry(t,function(e){return e})||[]},only:function(t){if(!wT(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};bn.Component=Jp;bn.Fragment=PX;bn.Profiler=jX;bn.PureComponent=yT;bn.StrictMode=AX;bn.Suspense=MX;bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HX;bn.act=EL;bn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=SL({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=bT.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)NL.call(e,l)&&!TL.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:px,type:t.type,key:r,ref:i,props:s,_owner:o}};bn.createContext=function(t){return t={$$typeof:OX,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:DX,_context:t},t.Consumer=t};bn.createElement=_L;bn.createFactory=function(t){var e=_L.bind(null,t);return e.type=t,e};bn.createRef=function(){return{current:null}};bn.forwardRef=function(t){return{$$typeof:FX,render:t}};bn.isValidElement=wT;bn.lazy=function(t){return{$$typeof:BX,_payload:{_status:-1,_result:t},_init:UX}};bn.memo=function(t,e){return{$$typeof:LX,type:t,compare:e===void 0?null:e}};bn.startTransition=function(t){var e=cv.transition;cv.transition={};try{t()}finally{cv.transition=e}};bn.unstable_act=EL;bn.useCallback=function(t,e){return ki.current.useCallback(t,e)};bn.useContext=function(t){return ki.current.useContext(t)};bn.useDebugValue=function(){};bn.useDeferredValue=function(t){return ki.current.useDeferredValue(t)};bn.useEffect=function(t,e){return ki.current.useEffect(t,e)};bn.useId=function(){return ki.current.useId()};bn.useImperativeHandle=function(t,e,n){return ki.current.useImperativeHandle(t,e,n)};bn.useInsertionEffect=function(t,e){return ki.current.useInsertionEffect(t,e)};bn.useLayoutEffect=function(t,e){return ki.current.useLayoutEffect(t,e)};bn.useMemo=function(t,e){return ki.current.useMemo(t,e)};bn.useReducer=function(t,e,n){return ki.current.useReducer(t,e,n)};bn.useRef=function(t){return ki.current.useRef(t)};bn.useState=function(t){return ki.current.useState(t)};bn.useSyncExternalStore=function(t,e,n){return ki.current.useSyncExternalStore(t,e,n)};bn.useTransition=function(){return ki.current.useTransition()};bn.version="18.3.1";bL.exports=bn;var b=bL.exports;const zt=Pw(b),$L=yL({__proto__:null,default:zt},[b]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GX=b,KX=Symbol.for("react.element"),qX=Symbol.for("react.fragment"),XX=Object.prototype.hasOwnProperty,YX=GX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,QX={key:!0,ref:!0,__self:!0,__source:!0};function IL(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)XX.call(e,s)&&!QX.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:KX,type:t,key:i,ref:o,props:r,_owner:YX.current}}Aw.Fragment=qX;Aw.jsx=IL;Aw.jsxs=IL;vL.exports=Aw;var u=vL.exports,aC={},RL={exports:{}},Io={},PL={exports:{}},AL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(U,G){var xe=U.length;U.push(G);e:for(;0<xe;){var Ce=xe-1>>>1,De=U[Ce];if(0<r(De,G))U[Ce]=G,U[xe]=De,xe=Ce;else break e}}function n(U){return U.length===0?null:U[0]}function s(U){if(U.length===0)return null;var G=U[0],xe=U.pop();if(xe!==G){U[0]=xe;e:for(var Ce=0,De=U.length,fe=De>>>1;Ce<fe;){var ee=2*(Ce+1)-1,Pe=U[ee],Re=ee+1,ce=U[Re];if(0>r(Pe,xe))Re<De&&0>r(ce,Pe)?(U[Ce]=ce,U[Re]=xe,Ce=Re):(U[Ce]=Pe,U[ee]=xe,Ce=ee);else if(Re<De&&0>r(ce,xe))U[Ce]=ce,U[Re]=xe,Ce=Re;else break e}}return G}function r(U,G){var xe=U.sortIndex-G.sortIndex;return xe!==0?xe:U.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(U){for(var G=n(c);G!==null;){if(G.callback===null)s(c);else if(G.startTime<=U)s(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=n(c)}}function C(U){if(g=!1,S(U),!m)if(n(l)!==null)m=!0,z(k);else{var G=n(c);G!==null&&re(C,G.startTime-U)}}function k(U,G){m=!1,g&&(g=!1,y($),$=-1),p=!0;var xe=f;try{for(S(G),h=n(l);h!==null&&(!(h.expirationTime>G)||U&&!j());){var Ce=h.callback;if(typeof Ce=="function"){h.callback=null,f=h.priorityLevel;var De=Ce(h.expirationTime<=G);G=t.unstable_now(),typeof De=="function"?h.callback=De:h===n(l)&&s(l),S(G)}else s(l);h=n(l)}if(h!==null)var fe=!0;else{var ee=n(c);ee!==null&&re(C,ee.startTime-G),fe=!1}return fe}finally{h=null,f=xe,p=!1}}var T=!1,_=null,$=-1,R=5,A=-1;function j(){return!(t.unstable_now()-A<R)}function F(){if(_!==null){var U=t.unstable_now();A=U;var G=!0;try{G=_(!0,U)}finally{G?L():(T=!1,_=null)}}else T=!1}var L;if(typeof v=="function")L=function(){v(F)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,q=M.port2;M.port1.onmessage=F,L=function(){q.postMessage(null)}}else L=function(){x(F,0)};function z(U){_=U,T||(T=!0,L())}function re(U,G){$=x(function(){U(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,z(k))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(U){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var xe=f;f=G;try{return U()}finally{f=xe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,G){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var xe=f;f=U;try{return G()}finally{f=xe}},t.unstable_scheduleCallback=function(U,G,xe){var Ce=t.unstable_now();switch(typeof xe=="object"&&xe!==null?(xe=xe.delay,xe=typeof xe=="number"&&0<xe?Ce+xe:Ce):xe=Ce,U){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=xe+De,U={id:d++,callback:G,priorityLevel:U,startTime:xe,expirationTime:De,sortIndex:-1},xe>Ce?(U.sortIndex=xe,e(c,U),n(l)===null&&U===n(c)&&(g?(y($),$=-1):g=!0,re(C,xe-Ce))):(U.sortIndex=De,e(l,U),m||p||(m=!0,z(k))),U},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(U){var G=f;return function(){var xe=f;f=G;try{return U.apply(this,arguments)}finally{f=xe}}}})(AL);PL.exports=AL;var ZX=PL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JX=b,Eo=ZX;function Ue(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jL=new Set,Zg={};function Dh(t,e){Cp(t,e),Cp(t+"Capture",e)}function Cp(t,e){for(Zg[t]=e,t=0;t<e.length;t++)jL.add(e[t])}var yc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lC=Object.prototype.hasOwnProperty,eY=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C3={},k3={};function tY(t){return lC.call(k3,t)?!0:lC.call(C3,t)?!1:eY.test(t)?k3[t]=!0:(C3[t]=!0,!1)}function nY(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function sY(t,e,n,s){if(e===null||typeof e>"u"||nY(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ni(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Fr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fr[t]=new Ni(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fr[e]=new Ni(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fr[t]=new Ni(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fr[t]=new Ni(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fr[t]=new Ni(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fr[t]=new Ni(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fr[t]=new Ni(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fr[t]=new Ni(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fr[t]=new Ni(t,5,!1,t.toLowerCase(),null,!1,!1)});var ST=/[\-:]([a-z])/g;function CT(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ST,CT);Fr[e]=new Ni(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ST,CT);Fr[e]=new Ni(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ST,CT);Fr[e]=new Ni(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fr[t]=new Ni(t,1,!1,t.toLowerCase(),null,!1,!1)});Fr.xlinkHref=new Ni("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fr[t]=new Ni(t,1,!1,t.toLowerCase(),null,!0,!0)});function kT(t,e,n,s){var r=Fr.hasOwnProperty(e)?Fr[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(sY(e,n,r,s)&&(n=null),s||r===null?tY(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Dc=JX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,iy=Symbol.for("react.element"),Nf=Symbol.for("react.portal"),Tf=Symbol.for("react.fragment"),NT=Symbol.for("react.strict_mode"),cC=Symbol.for("react.profiler"),DL=Symbol.for("react.provider"),OL=Symbol.for("react.context"),TT=Symbol.for("react.forward_ref"),uC=Symbol.for("react.suspense"),dC=Symbol.for("react.suspense_list"),_T=Symbol.for("react.memo"),Jc=Symbol.for("react.lazy"),FL=Symbol.for("react.offscreen"),N3=Symbol.iterator;function $m(t){return t===null||typeof t!="object"?null:(t=N3&&t[N3]||t["@@iterator"],typeof t=="function"?t:null)}var Ls=Object.assign,h2;function ng(t){if(h2===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);h2=e&&e[1]||""}return`
`+h2+t}var f2=!1;function p2(t,e){if(!t||f2)return"";f2=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{f2=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ng(t):""}function rY(t){switch(t.tag){case 5:return ng(t.type);case 16:return ng("Lazy");case 13:return ng("Suspense");case 19:return ng("SuspenseList");case 0:case 2:case 15:return t=p2(t.type,!1),t;case 11:return t=p2(t.type.render,!1),t;case 1:return t=p2(t.type,!0),t;default:return""}}function hC(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Tf:return"Fragment";case Nf:return"Portal";case cC:return"Profiler";case NT:return"StrictMode";case uC:return"Suspense";case dC:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case OL:return(t.displayName||"Context")+".Consumer";case DL:return(t._context.displayName||"Context")+".Provider";case TT:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case _T:return e=t.displayName||null,e!==null?e:hC(t.type)||"Memo";case Jc:e=t._payload,t=t._init;try{return hC(t(e))}catch{}}return null}function iY(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hC(e);case 8:return e===NT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Lu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ML(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function oY(t){var e=ML(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function oy(t){t._valueTracker||(t._valueTracker=oY(t))}function LL(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=ML(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Gv(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function fC(t,e){var n=e.checked;return Ls({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function T3(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Lu(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function BL(t,e){e=e.checked,e!=null&&kT(t,"checked",e,!1)}function pC(t,e){BL(t,e);var n=Lu(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?mC(t,e.type,n):e.hasOwnProperty("defaultValue")&&mC(t,e.type,Lu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function _3(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function mC(t,e,n){(e!=="number"||Gv(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var sg=Array.isArray;function Kf(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Lu(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function gC(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ue(91));return Ls({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function E3(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ue(92));if(sg(n)){if(1<n.length)throw Error(Ue(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Lu(n)}}function VL(t,e){var n=Lu(e.value),s=Lu(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function $3(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zL(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xC(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zL(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ay,WL=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ay=ay||document.createElement("div"),ay.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ay.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Jg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var kg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aY=["Webkit","ms","Moz","O"];Object.keys(kg).forEach(function(t){aY.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),kg[e]=kg[t]})});function UL(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||kg.hasOwnProperty(t)&&kg[t]?(""+e).trim():e+"px"}function HL(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=UL(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var lY=Ls({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yC(t,e){if(e){if(lY[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ue(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ue(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ue(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ue(62))}}function vC(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bC=null;function ET(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wC=null,qf=null,Xf=null;function I3(t){if(t=xx(t)){if(typeof wC!="function")throw Error(Ue(280));var e=t.stateNode;e&&(e=Mw(e),wC(t.stateNode,t.type,e))}}function GL(t){qf?Xf?Xf.push(t):Xf=[t]:qf=t}function KL(){if(qf){var t=qf,e=Xf;if(Xf=qf=null,I3(t),e)for(t=0;t<e.length;t++)I3(e[t])}}function qL(t,e){return t(e)}function XL(){}var m2=!1;function YL(t,e,n){if(m2)return t(e,n);m2=!0;try{return qL(t,e,n)}finally{m2=!1,(qf!==null||Xf!==null)&&(XL(),KL())}}function e0(t,e){var n=t.stateNode;if(n===null)return null;var s=Mw(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ue(231,e,typeof n));return n}var SC=!1;if(yc)try{var Im={};Object.defineProperty(Im,"passive",{get:function(){SC=!0}}),window.addEventListener("test",Im,Im),window.removeEventListener("test",Im,Im)}catch{SC=!1}function cY(t,e,n,s,r,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(d){this.onError(d)}}var Ng=!1,Kv=null,qv=!1,CC=null,uY={onError:function(t){Ng=!0,Kv=t}};function dY(t,e,n,s,r,i,o,a,l){Ng=!1,Kv=null,cY.apply(uY,arguments)}function hY(t,e,n,s,r,i,o,a,l){if(dY.apply(this,arguments),Ng){if(Ng){var c=Kv;Ng=!1,Kv=null}else throw Error(Ue(198));qv||(qv=!0,CC=c)}}function Oh(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function QL(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function R3(t){if(Oh(t)!==t)throw Error(Ue(188))}function fY(t){var e=t.alternate;if(!e){if(e=Oh(t),e===null)throw Error(Ue(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return R3(r),t;if(i===s)return R3(r),e;i=i.sibling}throw Error(Ue(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(Ue(189))}}if(n.alternate!==s)throw Error(Ue(190))}if(n.tag!==3)throw Error(Ue(188));return n.stateNode.current===n?t:e}function ZL(t){return t=fY(t),t!==null?JL(t):null}function JL(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=JL(t);if(e!==null)return e;t=t.sibling}return null}var e5=Eo.unstable_scheduleCallback,P3=Eo.unstable_cancelCallback,pY=Eo.unstable_shouldYield,mY=Eo.unstable_requestPaint,er=Eo.unstable_now,gY=Eo.unstable_getCurrentPriorityLevel,$T=Eo.unstable_ImmediatePriority,t5=Eo.unstable_UserBlockingPriority,Xv=Eo.unstable_NormalPriority,xY=Eo.unstable_LowPriority,n5=Eo.unstable_IdlePriority,jw=null,kl=null;function yY(t){if(kl&&typeof kl.onCommitFiberRoot=="function")try{kl.onCommitFiberRoot(jw,t,void 0,(t.current.flags&128)===128)}catch{}}var Ba=Math.clz32?Math.clz32:wY,vY=Math.log,bY=Math.LN2;function wY(t){return t>>>=0,t===0?32:31-(vY(t)/bY|0)|0}var ly=64,cy=4194304;function rg(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Yv(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=rg(a):(i&=o,i!==0&&(s=rg(i)))}else o=n&~r,o!==0?s=rg(o):i!==0&&(s=rg(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Ba(e),r=1<<n,s|=t[n],e&=~r;return s}function SY(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CY(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Ba(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=SY(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function kC(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function s5(){var t=ly;return ly<<=1,!(ly&4194240)&&(ly=64),t}function g2(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function mx(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ba(e),t[e]=n}function kY(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Ba(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function IT(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Ba(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var Jn=0;function r5(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var i5,RT,o5,a5,l5,NC=!1,uy=[],Cu=null,ku=null,Nu=null,t0=new Map,n0=new Map,su=[],NY="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function A3(t,e){switch(t){case"focusin":case"focusout":Cu=null;break;case"dragenter":case"dragleave":ku=null;break;case"mouseover":case"mouseout":Nu=null;break;case"pointerover":case"pointerout":t0.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":n0.delete(e.pointerId)}}function Rm(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=xx(e),e!==null&&RT(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function TY(t,e,n,s,r){switch(e){case"focusin":return Cu=Rm(Cu,t,e,n,s,r),!0;case"dragenter":return ku=Rm(ku,t,e,n,s,r),!0;case"mouseover":return Nu=Rm(Nu,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return t0.set(i,Rm(t0.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,n0.set(i,Rm(n0.get(i)||null,t,e,n,s,r)),!0}return!1}function c5(t){var e=Fd(t.target);if(e!==null){var n=Oh(e);if(n!==null){if(e=n.tag,e===13){if(e=QL(n),e!==null){t.blockedOn=e,l5(t.priority,function(){o5(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function uv(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=TC(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);bC=s,n.target.dispatchEvent(s),bC=null}else return e=xx(n),e!==null&&RT(e),t.blockedOn=n,!1;e.shift()}return!0}function j3(t,e,n){uv(t)&&n.delete(e)}function _Y(){NC=!1,Cu!==null&&uv(Cu)&&(Cu=null),ku!==null&&uv(ku)&&(ku=null),Nu!==null&&uv(Nu)&&(Nu=null),t0.forEach(j3),n0.forEach(j3)}function Pm(t,e){t.blockedOn===e&&(t.blockedOn=null,NC||(NC=!0,Eo.unstable_scheduleCallback(Eo.unstable_NormalPriority,_Y)))}function s0(t){function e(r){return Pm(r,t)}if(0<uy.length){Pm(uy[0],t);for(var n=1;n<uy.length;n++){var s=uy[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Cu!==null&&Pm(Cu,t),ku!==null&&Pm(ku,t),Nu!==null&&Pm(Nu,t),t0.forEach(e),n0.forEach(e),n=0;n<su.length;n++)s=su[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<su.length&&(n=su[0],n.blockedOn===null);)c5(n),n.blockedOn===null&&su.shift()}var Yf=Dc.ReactCurrentBatchConfig,Qv=!0;function EY(t,e,n,s){var r=Jn,i=Yf.transition;Yf.transition=null;try{Jn=1,PT(t,e,n,s)}finally{Jn=r,Yf.transition=i}}function $Y(t,e,n,s){var r=Jn,i=Yf.transition;Yf.transition=null;try{Jn=4,PT(t,e,n,s)}finally{Jn=r,Yf.transition=i}}function PT(t,e,n,s){if(Qv){var r=TC(t,e,n,s);if(r===null)T2(t,e,s,Zv,n),A3(t,s);else if(TY(r,t,e,n,s))s.stopPropagation();else if(A3(t,s),e&4&&-1<NY.indexOf(t)){for(;r!==null;){var i=xx(r);if(i!==null&&i5(i),i=TC(t,e,n,s),i===null&&T2(t,e,s,Zv,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else T2(t,e,s,null,n)}}var Zv=null;function TC(t,e,n,s){if(Zv=null,t=ET(s),t=Fd(t),t!==null)if(e=Oh(t),e===null)t=null;else if(n=e.tag,n===13){if(t=QL(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Zv=t,null}function u5(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gY()){case $T:return 1;case t5:return 4;case Xv:case xY:return 16;case n5:return 536870912;default:return 16}default:return 16}}var gu=null,AT=null,dv=null;function d5(){if(dv)return dv;var t,e=AT,n=e.length,s,r="value"in gu?gu.value:gu.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return dv=r.slice(t,1<s?1-s:void 0)}function hv(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function dy(){return!0}function D3(){return!1}function Ro(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dy:D3,this.isPropagationStopped=D3,this}return Ls(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=dy)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=dy)},persist:function(){},isPersistent:dy}),e}var em={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jT=Ro(em),gx=Ls({},em,{view:0,detail:0}),IY=Ro(gx),x2,y2,Am,Dw=Ls({},gx,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:DT,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Am&&(Am&&t.type==="mousemove"?(x2=t.screenX-Am.screenX,y2=t.screenY-Am.screenY):y2=x2=0,Am=t),x2)},movementY:function(t){return"movementY"in t?t.movementY:y2}}),O3=Ro(Dw),RY=Ls({},Dw,{dataTransfer:0}),PY=Ro(RY),AY=Ls({},gx,{relatedTarget:0}),v2=Ro(AY),jY=Ls({},em,{animationName:0,elapsedTime:0,pseudoElement:0}),DY=Ro(jY),OY=Ls({},em,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FY=Ro(OY),MY=Ls({},em,{data:0}),F3=Ro(MY),LY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BY={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zY(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=VY[t])?!!e[t]:!1}function DT(){return zY}var WY=Ls({},gx,{key:function(t){if(t.key){var e=LY[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=hv(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?BY[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:DT,charCode:function(t){return t.type==="keypress"?hv(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?hv(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),UY=Ro(WY),HY=Ls({},Dw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),M3=Ro(HY),GY=Ls({},gx,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:DT}),KY=Ro(GY),qY=Ls({},em,{propertyName:0,elapsedTime:0,pseudoElement:0}),XY=Ro(qY),YY=Ls({},Dw,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),QY=Ro(YY),ZY=[9,13,27,32],OT=yc&&"CompositionEvent"in window,Tg=null;yc&&"documentMode"in document&&(Tg=document.documentMode);var JY=yc&&"TextEvent"in window&&!Tg,h5=yc&&(!OT||Tg&&8<Tg&&11>=Tg),L3=" ",B3=!1;function f5(t,e){switch(t){case"keyup":return ZY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function p5(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var _f=!1;function eQ(t,e){switch(t){case"compositionend":return p5(e);case"keypress":return e.which!==32?null:(B3=!0,L3);case"textInput":return t=e.data,t===L3&&B3?null:t;default:return null}}function tQ(t,e){if(_f)return t==="compositionend"||!OT&&f5(t,e)?(t=d5(),dv=AT=gu=null,_f=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return h5&&e.locale!=="ko"?null:e.data;default:return null}}var nQ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function V3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!nQ[t.type]:e==="textarea"}function m5(t,e,n,s){GL(s),e=Jv(e,"onChange"),0<e.length&&(n=new jT("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var _g=null,r0=null;function sQ(t){T5(t,0)}function Ow(t){var e=If(t);if(LL(e))return t}function rQ(t,e){if(t==="change")return e}var g5=!1;if(yc){var b2;if(yc){var w2="oninput"in document;if(!w2){var z3=document.createElement("div");z3.setAttribute("oninput","return;"),w2=typeof z3.oninput=="function"}b2=w2}else b2=!1;g5=b2&&(!document.documentMode||9<document.documentMode)}function W3(){_g&&(_g.detachEvent("onpropertychange",x5),r0=_g=null)}function x5(t){if(t.propertyName==="value"&&Ow(r0)){var e=[];m5(e,r0,t,ET(t)),YL(sQ,e)}}function iQ(t,e,n){t==="focusin"?(W3(),_g=e,r0=n,_g.attachEvent("onpropertychange",x5)):t==="focusout"&&W3()}function oQ(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ow(r0)}function aQ(t,e){if(t==="click")return Ow(e)}function lQ(t,e){if(t==="input"||t==="change")return Ow(e)}function cQ(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ga=typeof Object.is=="function"?Object.is:cQ;function i0(t,e){if(Ga(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!lC.call(e,r)||!Ga(t[r],e[r]))return!1}return!0}function U3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function H3(t,e){var n=U3(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=U3(n)}}function y5(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?y5(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function v5(){for(var t=window,e=Gv();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Gv(t.document)}return e}function FT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function uQ(t){var e=v5(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&y5(n.ownerDocument.documentElement,n)){if(s!==null&&FT(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=H3(n,i);var o=H3(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var dQ=yc&&"documentMode"in document&&11>=document.documentMode,Ef=null,_C=null,Eg=null,EC=!1;function G3(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;EC||Ef==null||Ef!==Gv(s)||(s=Ef,"selectionStart"in s&&FT(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Eg&&i0(Eg,s)||(Eg=s,s=Jv(_C,"onSelect"),0<s.length&&(e=new jT("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Ef)))}function hy(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $f={animationend:hy("Animation","AnimationEnd"),animationiteration:hy("Animation","AnimationIteration"),animationstart:hy("Animation","AnimationStart"),transitionend:hy("Transition","TransitionEnd")},S2={},b5={};yc&&(b5=document.createElement("div").style,"AnimationEvent"in window||(delete $f.animationend.animation,delete $f.animationiteration.animation,delete $f.animationstart.animation),"TransitionEvent"in window||delete $f.transitionend.transition);function Fw(t){if(S2[t])return S2[t];if(!$f[t])return t;var e=$f[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in b5)return S2[t]=e[n];return t}var w5=Fw("animationend"),S5=Fw("animationiteration"),C5=Fw("animationstart"),k5=Fw("transitionend"),N5=new Map,K3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function td(t,e){N5.set(t,e),Dh(e,[t])}for(var C2=0;C2<K3.length;C2++){var k2=K3[C2],hQ=k2.toLowerCase(),fQ=k2[0].toUpperCase()+k2.slice(1);td(hQ,"on"+fQ)}td(w5,"onAnimationEnd");td(S5,"onAnimationIteration");td(C5,"onAnimationStart");td("dblclick","onDoubleClick");td("focusin","onFocus");td("focusout","onBlur");td(k5,"onTransitionEnd");Cp("onMouseEnter",["mouseout","mouseover"]);Cp("onMouseLeave",["mouseout","mouseover"]);Cp("onPointerEnter",["pointerout","pointerover"]);Cp("onPointerLeave",["pointerout","pointerover"]);Dh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Dh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Dh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Dh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Dh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ig="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pQ=new Set("cancel close invalid load scroll toggle".split(" ").concat(ig));function q3(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,hY(s,e,void 0,t),t.currentTarget=null}function T5(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;q3(r,a,c),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;q3(r,a,c),i=l}}}if(qv)throw t=CC,qv=!1,CC=null,t}function ks(t,e){var n=e[AC];n===void 0&&(n=e[AC]=new Set);var s=t+"__bubble";n.has(s)||(_5(e,t,2,!1),n.add(s))}function N2(t,e,n){var s=0;e&&(s|=4),_5(n,t,s,e)}var fy="_reactListening"+Math.random().toString(36).slice(2);function o0(t){if(!t[fy]){t[fy]=!0,jL.forEach(function(n){n!=="selectionchange"&&(pQ.has(n)||N2(n,!1,t),N2(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fy]||(e[fy]=!0,N2("selectionchange",!1,e))}}function _5(t,e,n,s){switch(u5(e)){case 1:var r=EY;break;case 4:r=$Y;break;default:r=PT}n=r.bind(null,e,n,t),r=void 0,!SC||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function T2(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Fd(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}YL(function(){var c=i,d=ET(n),h=[];e:{var f=N5.get(t);if(f!==void 0){var p=jT,m=t;switch(t){case"keypress":if(hv(n)===0)break e;case"keydown":case"keyup":p=UY;break;case"focusin":m="focus",p=v2;break;case"focusout":m="blur",p=v2;break;case"beforeblur":case"afterblur":p=v2;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=O3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=PY;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=KY;break;case w5:case S5:case C5:p=DY;break;case k5:p=XY;break;case"scroll":p=IY;break;case"wheel":p=QY;break;case"copy":case"cut":case"paste":p=FY;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=M3}var g=(e&4)!==0,x=!g&&t==="scroll",y=g?f!==null?f+"Capture":null:f;g=[];for(var v=c,S;v!==null;){S=v;var C=S.stateNode;if(S.tag===5&&C!==null&&(S=C,y!==null&&(C=e0(v,y),C!=null&&g.push(a0(v,C,S)))),x)break;v=v.return}0<g.length&&(f=new p(f,m,null,n,d),h.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==bC&&(m=n.relatedTarget||n.fromElement)&&(Fd(m)||m[vc]))break e;if((p||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=c,m=m?Fd(m):null,m!==null&&(x=Oh(m),m!==x||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=c),p!==m)){if(g=O3,C="onMouseLeave",y="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(g=M3,C="onPointerLeave",y="onPointerEnter",v="pointer"),x=p==null?f:If(p),S=m==null?f:If(m),f=new g(C,v+"leave",p,n,d),f.target=x,f.relatedTarget=S,C=null,Fd(d)===c&&(g=new g(y,v+"enter",m,n,d),g.target=S,g.relatedTarget=x,C=g),x=C,p&&m)t:{for(g=p,y=m,v=0,S=g;S;S=cf(S))v++;for(S=0,C=y;C;C=cf(C))S++;for(;0<v-S;)g=cf(g),v--;for(;0<S-v;)y=cf(y),S--;for(;v--;){if(g===y||y!==null&&g===y.alternate)break t;g=cf(g),y=cf(y)}g=null}else g=null;p!==null&&X3(h,f,p,g,!1),m!==null&&x!==null&&X3(h,x,m,g,!0)}}e:{if(f=c?If(c):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var k=rQ;else if(V3(f))if(g5)k=lQ;else{k=oQ;var T=iQ}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(k=aQ);if(k&&(k=k(t,c))){m5(h,k,n,d);break e}T&&T(t,f,c),t==="focusout"&&(T=f._wrapperState)&&T.controlled&&f.type==="number"&&mC(f,"number",f.value)}switch(T=c?If(c):window,t){case"focusin":(V3(T)||T.contentEditable==="true")&&(Ef=T,_C=c,Eg=null);break;case"focusout":Eg=_C=Ef=null;break;case"mousedown":EC=!0;break;case"contextmenu":case"mouseup":case"dragend":EC=!1,G3(h,n,d);break;case"selectionchange":if(dQ)break;case"keydown":case"keyup":G3(h,n,d)}var _;if(OT)e:{switch(t){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else _f?f5(t,n)&&($="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&($="onCompositionStart");$&&(h5&&n.locale!=="ko"&&(_f||$!=="onCompositionStart"?$==="onCompositionEnd"&&_f&&(_=d5()):(gu=d,AT="value"in gu?gu.value:gu.textContent,_f=!0)),T=Jv(c,$),0<T.length&&($=new F3($,t,null,n,d),h.push({event:$,listeners:T}),_?$.data=_:(_=p5(n),_!==null&&($.data=_)))),(_=JY?eQ(t,n):tQ(t,n))&&(c=Jv(c,"onBeforeInput"),0<c.length&&(d=new F3("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:c}),d.data=_))}T5(h,e)})}function a0(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Jv(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=e0(t,n),i!=null&&s.unshift(a0(t,i,r)),i=e0(t,e),i!=null&&s.push(a0(t,i,r))),t=t.return}return s}function cf(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function X3(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,r?(l=e0(n,i),l!=null&&o.unshift(a0(n,l,a))):r||(l=e0(n,i),l!=null&&o.push(a0(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var mQ=/\r\n?/g,gQ=/\u0000|\uFFFD/g;function Y3(t){return(typeof t=="string"?t:""+t).replace(mQ,`
`).replace(gQ,"")}function py(t,e,n){if(e=Y3(e),Y3(t)!==e&&n)throw Error(Ue(425))}function eb(){}var $C=null,IC=null;function RC(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var PC=typeof setTimeout=="function"?setTimeout:void 0,xQ=typeof clearTimeout=="function"?clearTimeout:void 0,Q3=typeof Promise=="function"?Promise:void 0,yQ=typeof queueMicrotask=="function"?queueMicrotask:typeof Q3<"u"?function(t){return Q3.resolve(null).then(t).catch(vQ)}:PC;function vQ(t){setTimeout(function(){throw t})}function _2(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),s0(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);s0(e)}function Tu(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Z3(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var tm=Math.random().toString(36).slice(2),gl="__reactFiber$"+tm,l0="__reactProps$"+tm,vc="__reactContainer$"+tm,AC="__reactEvents$"+tm,bQ="__reactListeners$"+tm,wQ="__reactHandles$"+tm;function Fd(t){var e=t[gl];if(e)return e;for(var n=t.parentNode;n;){if(e=n[vc]||n[gl]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Z3(t);t!==null;){if(n=t[gl])return n;t=Z3(t)}return e}t=n,n=t.parentNode}return null}function xx(t){return t=t[gl]||t[vc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function If(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ue(33))}function Mw(t){return t[l0]||null}var jC=[],Rf=-1;function nd(t){return{current:t}}function _s(t){0>Rf||(t.current=jC[Rf],jC[Rf]=null,Rf--)}function xs(t,e){Rf++,jC[Rf]=t.current,t.current=e}var Bu={},Jr=nd(Bu),Gi=nd(!1),lh=Bu;function kp(t,e){var n=t.type.contextTypes;if(!n)return Bu;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Ki(t){return t=t.childContextTypes,t!=null}function tb(){_s(Gi),_s(Jr)}function J3(t,e,n){if(Jr.current!==Bu)throw Error(Ue(168));xs(Jr,e),xs(Gi,n)}function E5(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(Ue(108,iY(t)||"Unknown",r));return Ls({},n,s)}function nb(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Bu,lh=Jr.current,xs(Jr,t),xs(Gi,Gi.current),!0}function eA(t,e,n){var s=t.stateNode;if(!s)throw Error(Ue(169));n?(t=E5(t,e,lh),s.__reactInternalMemoizedMergedChildContext=t,_s(Gi),_s(Jr),xs(Jr,t)):_s(Gi),xs(Gi,n)}var nc=null,Lw=!1,E2=!1;function $5(t){nc===null?nc=[t]:nc.push(t)}function SQ(t){Lw=!0,$5(t)}function sd(){if(!E2&&nc!==null){E2=!0;var t=0,e=Jn;try{var n=nc;for(Jn=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}nc=null,Lw=!1}catch(r){throw nc!==null&&(nc=nc.slice(t+1)),e5($T,sd),r}finally{Jn=e,E2=!1}}return null}var Pf=[],Af=0,sb=null,rb=0,Yo=[],Qo=0,ch=null,uc=1,dc="";function wd(t,e){Pf[Af++]=rb,Pf[Af++]=sb,sb=t,rb=e}function I5(t,e,n){Yo[Qo++]=uc,Yo[Qo++]=dc,Yo[Qo++]=ch,ch=t;var s=uc;t=dc;var r=32-Ba(s)-1;s&=~(1<<r),n+=1;var i=32-Ba(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,uc=1<<32-Ba(e)+r|n<<r|s,dc=i+t}else uc=1<<i|n<<r|s,dc=t}function MT(t){t.return!==null&&(wd(t,1),I5(t,1,0))}function LT(t){for(;t===sb;)sb=Pf[--Af],Pf[Af]=null,rb=Pf[--Af],Pf[Af]=null;for(;t===ch;)ch=Yo[--Qo],Yo[Qo]=null,dc=Yo[--Qo],Yo[Qo]=null,uc=Yo[--Qo],Yo[Qo]=null}var wo=null,vo=null,Is=!1,Ia=null;function R5(t,e){var n=Jo(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function tA(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,wo=t,vo=Tu(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,wo=t,vo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ch!==null?{id:uc,overflow:dc}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Jo(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,wo=t,vo=null,!0):!1;default:return!1}}function DC(t){return(t.mode&1)!==0&&(t.flags&128)===0}function OC(t){if(Is){var e=vo;if(e){var n=e;if(!tA(t,e)){if(DC(t))throw Error(Ue(418));e=Tu(n.nextSibling);var s=wo;e&&tA(t,e)?R5(s,n):(t.flags=t.flags&-4097|2,Is=!1,wo=t)}}else{if(DC(t))throw Error(Ue(418));t.flags=t.flags&-4097|2,Is=!1,wo=t}}}function nA(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;wo=t}function my(t){if(t!==wo)return!1;if(!Is)return nA(t),Is=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!RC(t.type,t.memoizedProps)),e&&(e=vo)){if(DC(t))throw P5(),Error(Ue(418));for(;e;)R5(t,e),e=Tu(e.nextSibling)}if(nA(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ue(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){vo=Tu(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}vo=null}}else vo=wo?Tu(t.stateNode.nextSibling):null;return!0}function P5(){for(var t=vo;t;)t=Tu(t.nextSibling)}function Np(){vo=wo=null,Is=!1}function BT(t){Ia===null?Ia=[t]:Ia.push(t)}var CQ=Dc.ReactCurrentBatchConfig;function jm(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ue(309));var s=n.stateNode}if(!s)throw Error(Ue(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Ue(284));if(!n._owner)throw Error(Ue(290,t))}return t}function gy(t,e){throw t=Object.prototype.toString.call(e),Error(Ue(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function sA(t){var e=t._init;return e(t._payload)}function A5(t){function e(y,v){if(t){var S=y.deletions;S===null?(y.deletions=[v],y.flags|=16):S.push(v)}}function n(y,v){if(!t)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function s(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function r(y,v){return y=Iu(y,v),y.index=0,y.sibling=null,y}function i(y,v,S){return y.index=S,t?(S=y.alternate,S!==null?(S=S.index,S<v?(y.flags|=2,v):S):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,v,S,C){return v===null||v.tag!==6?(v=D2(S,y.mode,C),v.return=y,v):(v=r(v,S),v.return=y,v)}function l(y,v,S,C){var k=S.type;return k===Tf?d(y,v,S.props.children,C,S.key):v!==null&&(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Jc&&sA(k)===v.type)?(C=r(v,S.props),C.ref=jm(y,v,S),C.return=y,C):(C=vv(S.type,S.key,S.props,null,y.mode,C),C.ref=jm(y,v,S),C.return=y,C)}function c(y,v,S,C){return v===null||v.tag!==4||v.stateNode.containerInfo!==S.containerInfo||v.stateNode.implementation!==S.implementation?(v=O2(S,y.mode,C),v.return=y,v):(v=r(v,S.children||[]),v.return=y,v)}function d(y,v,S,C,k){return v===null||v.tag!==7?(v=th(S,y.mode,C,k),v.return=y,v):(v=r(v,S),v.return=y,v)}function h(y,v,S){if(typeof v=="string"&&v!==""||typeof v=="number")return v=D2(""+v,y.mode,S),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case iy:return S=vv(v.type,v.key,v.props,null,y.mode,S),S.ref=jm(y,null,v),S.return=y,S;case Nf:return v=O2(v,y.mode,S),v.return=y,v;case Jc:var C=v._init;return h(y,C(v._payload),S)}if(sg(v)||$m(v))return v=th(v,y.mode,S,null),v.return=y,v;gy(y,v)}return null}function f(y,v,S,C){var k=v!==null?v.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return k!==null?null:a(y,v,""+S,C);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case iy:return S.key===k?l(y,v,S,C):null;case Nf:return S.key===k?c(y,v,S,C):null;case Jc:return k=S._init,f(y,v,k(S._payload),C)}if(sg(S)||$m(S))return k!==null?null:d(y,v,S,C,null);gy(y,S)}return null}function p(y,v,S,C,k){if(typeof C=="string"&&C!==""||typeof C=="number")return y=y.get(S)||null,a(v,y,""+C,k);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case iy:return y=y.get(C.key===null?S:C.key)||null,l(v,y,C,k);case Nf:return y=y.get(C.key===null?S:C.key)||null,c(v,y,C,k);case Jc:var T=C._init;return p(y,v,S,T(C._payload),k)}if(sg(C)||$m(C))return y=y.get(S)||null,d(v,y,C,k,null);gy(v,C)}return null}function m(y,v,S,C){for(var k=null,T=null,_=v,$=v=0,R=null;_!==null&&$<S.length;$++){_.index>$?(R=_,_=null):R=_.sibling;var A=f(y,_,S[$],C);if(A===null){_===null&&(_=R);break}t&&_&&A.alternate===null&&e(y,_),v=i(A,v,$),T===null?k=A:T.sibling=A,T=A,_=R}if($===S.length)return n(y,_),Is&&wd(y,$),k;if(_===null){for(;$<S.length;$++)_=h(y,S[$],C),_!==null&&(v=i(_,v,$),T===null?k=_:T.sibling=_,T=_);return Is&&wd(y,$),k}for(_=s(y,_);$<S.length;$++)R=p(_,y,$,S[$],C),R!==null&&(t&&R.alternate!==null&&_.delete(R.key===null?$:R.key),v=i(R,v,$),T===null?k=R:T.sibling=R,T=R);return t&&_.forEach(function(j){return e(y,j)}),Is&&wd(y,$),k}function g(y,v,S,C){var k=$m(S);if(typeof k!="function")throw Error(Ue(150));if(S=k.call(S),S==null)throw Error(Ue(151));for(var T=k=null,_=v,$=v=0,R=null,A=S.next();_!==null&&!A.done;$++,A=S.next()){_.index>$?(R=_,_=null):R=_.sibling;var j=f(y,_,A.value,C);if(j===null){_===null&&(_=R);break}t&&_&&j.alternate===null&&e(y,_),v=i(j,v,$),T===null?k=j:T.sibling=j,T=j,_=R}if(A.done)return n(y,_),Is&&wd(y,$),k;if(_===null){for(;!A.done;$++,A=S.next())A=h(y,A.value,C),A!==null&&(v=i(A,v,$),T===null?k=A:T.sibling=A,T=A);return Is&&wd(y,$),k}for(_=s(y,_);!A.done;$++,A=S.next())A=p(_,y,$,A.value,C),A!==null&&(t&&A.alternate!==null&&_.delete(A.key===null?$:A.key),v=i(A,v,$),T===null?k=A:T.sibling=A,T=A);return t&&_.forEach(function(F){return e(y,F)}),Is&&wd(y,$),k}function x(y,v,S,C){if(typeof S=="object"&&S!==null&&S.type===Tf&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case iy:e:{for(var k=S.key,T=v;T!==null;){if(T.key===k){if(k=S.type,k===Tf){if(T.tag===7){n(y,T.sibling),v=r(T,S.props.children),v.return=y,y=v;break e}}else if(T.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Jc&&sA(k)===T.type){n(y,T.sibling),v=r(T,S.props),v.ref=jm(y,T,S),v.return=y,y=v;break e}n(y,T);break}else e(y,T);T=T.sibling}S.type===Tf?(v=th(S.props.children,y.mode,C,S.key),v.return=y,y=v):(C=vv(S.type,S.key,S.props,null,y.mode,C),C.ref=jm(y,v,S),C.return=y,y=C)}return o(y);case Nf:e:{for(T=S.key;v!==null;){if(v.key===T)if(v.tag===4&&v.stateNode.containerInfo===S.containerInfo&&v.stateNode.implementation===S.implementation){n(y,v.sibling),v=r(v,S.children||[]),v.return=y,y=v;break e}else{n(y,v);break}else e(y,v);v=v.sibling}v=O2(S,y.mode,C),v.return=y,y=v}return o(y);case Jc:return T=S._init,x(y,v,T(S._payload),C)}if(sg(S))return m(y,v,S,C);if($m(S))return g(y,v,S,C);gy(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,v!==null&&v.tag===6?(n(y,v.sibling),v=r(v,S),v.return=y,y=v):(n(y,v),v=D2(S,y.mode,C),v.return=y,y=v),o(y)):n(y,v)}return x}var Tp=A5(!0),j5=A5(!1),ib=nd(null),ob=null,jf=null,VT=null;function zT(){VT=jf=ob=null}function WT(t){var e=ib.current;_s(ib),t._currentValue=e}function FC(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Qf(t,e){ob=t,VT=jf=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ui=!0),t.firstContext=null)}function da(t){var e=t._currentValue;if(VT!==t)if(t={context:t,memoizedValue:e,next:null},jf===null){if(ob===null)throw Error(Ue(308));jf=t,ob.dependencies={lanes:0,firstContext:t}}else jf=jf.next=t;return e}var Md=null;function UT(t){Md===null?Md=[t]:Md.push(t)}function D5(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,UT(e)):(n.next=r.next,r.next=n),e.interleaved=n,bc(t,s)}function bc(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var eu=!1;function HT(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function O5(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function hc(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function _u(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Dn&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,bc(t,n)}return r=s.interleaved,r===null?(e.next=e,UT(s)):(e.next=r.next,r.next=e),s.interleaved=e,bc(t,n)}function fv(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,IT(t,n)}}function rA(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ab(t,e,n,s){var r=t.updateQueue;eu=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(i!==null){var h=r.baseState;o=0,d=c=l=null,a=i;do{var f=a.lane,p=a.eventTime;if((s&f)===f){d!==null&&(d=d.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,g=a;switch(f=e,p=n,g.tag){case 1:if(m=g.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=Ls({},h,f);break e;case 2:eu=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=p,l=h):d=d.next=p,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(d===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);dh|=o,t.lanes=o,t.memoizedState=h}}function iA(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(Ue(191,r));r.call(s)}}}var yx={},Nl=nd(yx),c0=nd(yx),u0=nd(yx);function Ld(t){if(t===yx)throw Error(Ue(174));return t}function GT(t,e){switch(xs(u0,e),xs(c0,t),xs(Nl,yx),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:xC(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=xC(e,t)}_s(Nl),xs(Nl,e)}function _p(){_s(Nl),_s(c0),_s(u0)}function F5(t){Ld(u0.current);var e=Ld(Nl.current),n=xC(e,t.type);e!==n&&(xs(c0,t),xs(Nl,n))}function KT(t){c0.current===t&&(_s(Nl),_s(c0))}var As=nd(0);function lb(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $2=[];function qT(){for(var t=0;t<$2.length;t++)$2[t]._workInProgressVersionPrimary=null;$2.length=0}var pv=Dc.ReactCurrentDispatcher,I2=Dc.ReactCurrentBatchConfig,uh=0,Fs=null,dr=null,wr=null,cb=!1,$g=!1,d0=0,kQ=0;function Vr(){throw Error(Ue(321))}function XT(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ga(t[n],e[n]))return!1;return!0}function YT(t,e,n,s,r,i){if(uh=i,Fs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,pv.current=t===null||t.memoizedState===null?EQ:$Q,t=n(s,r),$g){i=0;do{if($g=!1,d0=0,25<=i)throw Error(Ue(301));i+=1,wr=dr=null,e.updateQueue=null,pv.current=IQ,t=n(s,r)}while($g)}if(pv.current=ub,e=dr!==null&&dr.next!==null,uh=0,wr=dr=Fs=null,cb=!1,e)throw Error(Ue(300));return t}function QT(){var t=d0!==0;return d0=0,t}function ll(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?Fs.memoizedState=wr=t:wr=wr.next=t,wr}function ha(){if(dr===null){var t=Fs.alternate;t=t!==null?t.memoizedState:null}else t=dr.next;var e=wr===null?Fs.memoizedState:wr.next;if(e!==null)wr=e,dr=t;else{if(t===null)throw Error(Ue(310));dr=t,t={memoizedState:dr.memoizedState,baseState:dr.baseState,baseQueue:dr.baseQueue,queue:dr.queue,next:null},wr===null?Fs.memoizedState=wr=t:wr=wr.next=t}return wr}function h0(t,e){return typeof e=="function"?e(t):e}function R2(t){var e=ha(),n=e.queue;if(n===null)throw Error(Ue(311));n.lastRenderedReducer=t;var s=dr,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,c=i;do{var d=c.lane;if((uh&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=s):l=l.next=h,Fs.lanes|=d,dh|=d}c=c.next}while(c!==null&&c!==i);l===null?o=s:l.next=a,Ga(s,e.memoizedState)||(Ui=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,Fs.lanes|=i,dh|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function P2(t){var e=ha(),n=e.queue;if(n===null)throw Error(Ue(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);Ga(i,e.memoizedState)||(Ui=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function M5(){}function L5(t,e){var n=Fs,s=ha(),r=e(),i=!Ga(s.memoizedState,r);if(i&&(s.memoizedState=r,Ui=!0),s=s.queue,ZT(z5.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||wr!==null&&wr.memoizedState.tag&1){if(n.flags|=2048,f0(9,V5.bind(null,n,s,r,e),void 0,null),Nr===null)throw Error(Ue(349));uh&30||B5(n,e,r)}return r}function B5(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Fs.updateQueue,e===null?(e={lastEffect:null,stores:null},Fs.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function V5(t,e,n,s){e.value=n,e.getSnapshot=s,W5(e)&&U5(t)}function z5(t,e,n){return n(function(){W5(e)&&U5(t)})}function W5(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ga(t,n)}catch{return!0}}function U5(t){var e=bc(t,1);e!==null&&Va(e,t,1,-1)}function oA(t){var e=ll();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h0,lastRenderedState:t},e.queue=t,t=t.dispatch=_Q.bind(null,Fs,t),[e.memoizedState,t]}function f0(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Fs.updateQueue,e===null?(e={lastEffect:null,stores:null},Fs.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function H5(){return ha().memoizedState}function mv(t,e,n,s){var r=ll();Fs.flags|=t,r.memoizedState=f0(1|e,n,void 0,s===void 0?null:s)}function Bw(t,e,n,s){var r=ha();s=s===void 0?null:s;var i=void 0;if(dr!==null){var o=dr.memoizedState;if(i=o.destroy,s!==null&&XT(s,o.deps)){r.memoizedState=f0(e,n,i,s);return}}Fs.flags|=t,r.memoizedState=f0(1|e,n,i,s)}function aA(t,e){return mv(8390656,8,t,e)}function ZT(t,e){return Bw(2048,8,t,e)}function G5(t,e){return Bw(4,2,t,e)}function K5(t,e){return Bw(4,4,t,e)}function q5(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function X5(t,e,n){return n=n!=null?n.concat([t]):null,Bw(4,4,q5.bind(null,e,t),n)}function JT(){}function Y5(t,e){var n=ha();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&XT(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function Q5(t,e){var n=ha();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&XT(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function Z5(t,e,n){return uh&21?(Ga(n,e)||(n=s5(),Fs.lanes|=n,dh|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ui=!0),t.memoizedState=n)}function NQ(t,e){var n=Jn;Jn=n!==0&&4>n?n:4,t(!0);var s=I2.transition;I2.transition={};try{t(!1),e()}finally{Jn=n,I2.transition=s}}function J5(){return ha().memoizedState}function TQ(t,e,n){var s=$u(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},eB(t))tB(e,n);else if(n=D5(t,e,n,s),n!==null){var r=yi();Va(n,t,s,r),nB(n,e,s)}}function _Q(t,e,n){var s=$u(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(eB(t))tB(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,Ga(a,o)){var l=e.interleaved;l===null?(r.next=r,UT(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=D5(t,e,r,s),n!==null&&(r=yi(),Va(n,t,s,r),nB(n,e,s))}}function eB(t){var e=t.alternate;return t===Fs||e!==null&&e===Fs}function tB(t,e){$g=cb=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function nB(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,IT(t,n)}}var ub={readContext:da,useCallback:Vr,useContext:Vr,useEffect:Vr,useImperativeHandle:Vr,useInsertionEffect:Vr,useLayoutEffect:Vr,useMemo:Vr,useReducer:Vr,useRef:Vr,useState:Vr,useDebugValue:Vr,useDeferredValue:Vr,useTransition:Vr,useMutableSource:Vr,useSyncExternalStore:Vr,useId:Vr,unstable_isNewReconciler:!1},EQ={readContext:da,useCallback:function(t,e){return ll().memoizedState=[t,e===void 0?null:e],t},useContext:da,useEffect:aA,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,mv(4194308,4,q5.bind(null,e,t),n)},useLayoutEffect:function(t,e){return mv(4194308,4,t,e)},useInsertionEffect:function(t,e){return mv(4,2,t,e)},useMemo:function(t,e){var n=ll();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=ll();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=TQ.bind(null,Fs,t),[s.memoizedState,t]},useRef:function(t){var e=ll();return t={current:t},e.memoizedState=t},useState:oA,useDebugValue:JT,useDeferredValue:function(t){return ll().memoizedState=t},useTransition:function(){var t=oA(!1),e=t[0];return t=NQ.bind(null,t[1]),ll().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Fs,r=ll();if(Is){if(n===void 0)throw Error(Ue(407));n=n()}else{if(n=e(),Nr===null)throw Error(Ue(349));uh&30||B5(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,aA(z5.bind(null,s,i,t),[t]),s.flags|=2048,f0(9,V5.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=ll(),e=Nr.identifierPrefix;if(Is){var n=dc,s=uc;n=(s&~(1<<32-Ba(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=d0++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kQ++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$Q={readContext:da,useCallback:Y5,useContext:da,useEffect:ZT,useImperativeHandle:X5,useInsertionEffect:G5,useLayoutEffect:K5,useMemo:Q5,useReducer:R2,useRef:H5,useState:function(){return R2(h0)},useDebugValue:JT,useDeferredValue:function(t){var e=ha();return Z5(e,dr.memoizedState,t)},useTransition:function(){var t=R2(h0)[0],e=ha().memoizedState;return[t,e]},useMutableSource:M5,useSyncExternalStore:L5,useId:J5,unstable_isNewReconciler:!1},IQ={readContext:da,useCallback:Y5,useContext:da,useEffect:ZT,useImperativeHandle:X5,useInsertionEffect:G5,useLayoutEffect:K5,useMemo:Q5,useReducer:P2,useRef:H5,useState:function(){return P2(h0)},useDebugValue:JT,useDeferredValue:function(t){var e=ha();return dr===null?e.memoizedState=t:Z5(e,dr.memoizedState,t)},useTransition:function(){var t=P2(h0)[0],e=ha().memoizedState;return[t,e]},useMutableSource:M5,useSyncExternalStore:L5,useId:J5,unstable_isNewReconciler:!1};function Ta(t,e){if(t&&t.defaultProps){e=Ls({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function MC(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Ls({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vw={isMounted:function(t){return(t=t._reactInternals)?Oh(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=yi(),r=$u(t),i=hc(s,r);i.payload=e,n!=null&&(i.callback=n),e=_u(t,i,r),e!==null&&(Va(e,t,r,s),fv(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=yi(),r=$u(t),i=hc(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=_u(t,i,r),e!==null&&(Va(e,t,r,s),fv(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=yi(),s=$u(t),r=hc(n,s);r.tag=2,e!=null&&(r.callback=e),e=_u(t,r,s),e!==null&&(Va(e,t,s,n),fv(e,t,s))}};function lA(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!i0(n,s)||!i0(r,i):!0}function sB(t,e,n){var s=!1,r=Bu,i=e.contextType;return typeof i=="object"&&i!==null?i=da(i):(r=Ki(e)?lh:Jr.current,s=e.contextTypes,i=(s=s!=null)?kp(t,r):Bu),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vw,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function cA(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Vw.enqueueReplaceState(e,e.state,null)}function LC(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},HT(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=da(i):(i=Ki(e)?lh:Jr.current,r.context=kp(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(MC(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Vw.enqueueReplaceState(r,r.state,null),ab(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Ep(t,e){try{var n="",s=e;do n+=rY(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function A2(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function BC(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var RQ=typeof WeakMap=="function"?WeakMap:Map;function rB(t,e,n){n=hc(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){hb||(hb=!0,YC=s),BC(t,e)},n}function iB(t,e,n){n=hc(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){BC(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){BC(t,e),typeof s!="function"&&(Eu===null?Eu=new Set([this]):Eu.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function uA(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new RQ;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=HQ.bind(null,t,e,n),e.then(t,t))}function dA(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function hA(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=hc(-1,1),e.tag=2,_u(n,e,1))),n.lanes|=1),t)}var PQ=Dc.ReactCurrentOwner,Ui=!1;function hi(t,e,n,s){e.child=t===null?j5(e,null,n,s):Tp(e,t.child,n,s)}function fA(t,e,n,s,r){n=n.render;var i=e.ref;return Qf(e,r),s=YT(t,e,n,s,i,r),n=QT(),t!==null&&!Ui?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wc(t,e,r)):(Is&&n&&MT(e),e.flags|=1,hi(t,e,s,r),e.child)}function pA(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!a_(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,oB(t,e,i,s,r)):(t=vv(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:i0,n(o,s)&&t.ref===e.ref)return wc(t,e,r)}return e.flags|=1,t=Iu(i,s),t.ref=e.ref,t.return=e,e.child=t}function oB(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(i0(i,s)&&t.ref===e.ref)if(Ui=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(Ui=!0);else return e.lanes=t.lanes,wc(t,e,r)}return VC(t,e,n,s,r)}function aB(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xs(Of,oo),oo|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,xs(Of,oo),oo|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,xs(Of,oo),oo|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,xs(Of,oo),oo|=s;return hi(t,e,r,n),e.child}function lB(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function VC(t,e,n,s,r){var i=Ki(n)?lh:Jr.current;return i=kp(e,i),Qf(e,r),n=YT(t,e,n,s,i,r),s=QT(),t!==null&&!Ui?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wc(t,e,r)):(Is&&s&&MT(e),e.flags|=1,hi(t,e,n,r),e.child)}function mA(t,e,n,s,r){if(Ki(n)){var i=!0;nb(e)}else i=!1;if(Qf(e,r),e.stateNode===null)gv(t,e),sB(e,n,s),LC(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=da(c):(c=Ki(n)?lh:Jr.current,c=kp(e,c));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&cA(e,o,s,c),eu=!1;var f=e.memoizedState;o.state=f,ab(e,s,o,r),l=e.memoizedState,a!==s||f!==l||Gi.current||eu?(typeof d=="function"&&(MC(e,n,d,s),l=e.memoizedState),(a=eu||lA(e,n,a,s,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,O5(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ta(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=da(l):(l=Ki(n)?lh:Jr.current,l=kp(e,l));var p=n.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&cA(e,o,s,l),eu=!1,f=e.memoizedState,o.state=f,ab(e,s,o,r);var m=e.memoizedState;a!==h||f!==m||Gi.current||eu?(typeof p=="function"&&(MC(e,n,p,s),m=e.memoizedState),(c=eu||lA(e,n,c,s,f,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=m),o.props=s,o.state=m,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),s=!1)}return zC(t,e,n,s,i,r)}function zC(t,e,n,s,r,i){lB(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&eA(e,n,!1),wc(t,e,i);s=e.stateNode,PQ.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=Tp(e,t.child,null,i),e.child=Tp(e,null,a,i)):hi(t,e,a,i),e.memoizedState=s.state,r&&eA(e,n,!0),e.child}function cB(t){var e=t.stateNode;e.pendingContext?J3(t,e.pendingContext,e.pendingContext!==e.context):e.context&&J3(t,e.context,!1),GT(t,e.containerInfo)}function gA(t,e,n,s,r){return Np(),BT(r),e.flags|=256,hi(t,e,n,s),e.child}var WC={dehydrated:null,treeContext:null,retryLane:0};function UC(t){return{baseLanes:t,cachePool:null,transitions:null}}function uB(t,e,n){var s=e.pendingProps,r=As.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),xs(As,r&1),t===null)return OC(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Uw(o,s,0,null),t=th(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=UC(n),e.memoizedState=WC,t):e_(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return AQ(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Iu(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Iu(a,i):(i=th(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?UC(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=WC,s}return i=t.child,t=i.sibling,s=Iu(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function e_(t,e){return e=Uw({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xy(t,e,n,s){return s!==null&&BT(s),Tp(e,t.child,null,n),t=e_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function AQ(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=A2(Error(Ue(422))),xy(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Uw({mode:"visible",children:s.children},r,0,null),i=th(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Tp(e,t.child,null,o),e.child.memoizedState=UC(o),e.memoizedState=WC,i);if(!(e.mode&1))return xy(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(Ue(419)),s=A2(i,s,void 0),xy(t,e,o,s)}if(a=(o&t.childLanes)!==0,Ui||a){if(s=Nr,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,bc(t,r),Va(s,t,r,-1))}return o_(),s=A2(Error(Ue(421))),xy(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=GQ.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,vo=Tu(r.nextSibling),wo=e,Is=!0,Ia=null,t!==null&&(Yo[Qo++]=uc,Yo[Qo++]=dc,Yo[Qo++]=ch,uc=t.id,dc=t.overflow,ch=e),e=e_(e,s.children),e.flags|=4096,e)}function xA(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),FC(t.return,e,n)}function j2(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function dB(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(hi(t,e,s.children,n),s=As.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&xA(t,n,e);else if(t.tag===19)xA(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(xs(As,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&lb(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),j2(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&lb(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}j2(e,!0,n,null,i);break;case"together":j2(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gv(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wc(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),dh|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ue(153));if(e.child!==null){for(t=e.child,n=Iu(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Iu(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function jQ(t,e,n){switch(e.tag){case 3:cB(e),Np();break;case 5:F5(e);break;case 1:Ki(e.type)&&nb(e);break;case 4:GT(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;xs(ib,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(xs(As,As.current&1),e.flags|=128,null):n&e.child.childLanes?uB(t,e,n):(xs(As,As.current&1),t=wc(t,e,n),t!==null?t.sibling:null);xs(As,As.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return dB(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),xs(As,As.current),s)break;return null;case 22:case 23:return e.lanes=0,aB(t,e,n)}return wc(t,e,n)}var hB,HC,fB,pB;hB=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};HC=function(){};fB=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,Ld(Nl.current);var i=null;switch(n){case"input":r=fC(t,r),s=fC(t,s),i=[];break;case"select":r=Ls({},r,{value:void 0}),s=Ls({},s,{value:void 0}),i=[];break;case"textarea":r=gC(t,r),s=gC(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=eb)}yC(n,s);var o;n=null;for(c in r)if(!s.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Zg.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in s){var l=s[c];if(a=r!=null?r[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Zg.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ks("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};pB=function(t,e,n,s){n!==s&&(e.flags|=4)};function Dm(t,e){if(!Is)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function zr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function DQ(t,e,n){var s=e.pendingProps;switch(LT(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zr(e),null;case 1:return Ki(e.type)&&tb(),zr(e),null;case 3:return s=e.stateNode,_p(),_s(Gi),_s(Jr),qT(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(my(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ia!==null&&(JC(Ia),Ia=null))),HC(t,e),zr(e),null;case 5:KT(e);var r=Ld(u0.current);if(n=e.type,t!==null&&e.stateNode!=null)fB(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(Ue(166));return zr(e),null}if(t=Ld(Nl.current),my(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[gl]=e,s[l0]=i,t=(e.mode&1)!==0,n){case"dialog":ks("cancel",s),ks("close",s);break;case"iframe":case"object":case"embed":ks("load",s);break;case"video":case"audio":for(r=0;r<ig.length;r++)ks(ig[r],s);break;case"source":ks("error",s);break;case"img":case"image":case"link":ks("error",s),ks("load",s);break;case"details":ks("toggle",s);break;case"input":T3(s,i),ks("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},ks("invalid",s);break;case"textarea":E3(s,i),ks("invalid",s)}yC(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&py(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&py(s.textContent,a,t),r=["children",""+a]):Zg.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ks("scroll",s)}switch(n){case"input":oy(s),_3(s,i,!0);break;case"textarea":oy(s),$3(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=eb)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zL(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[gl]=e,t[l0]=s,hB(t,e,!1,!1),e.stateNode=t;e:{switch(o=vC(n,s),n){case"dialog":ks("cancel",t),ks("close",t),r=s;break;case"iframe":case"object":case"embed":ks("load",t),r=s;break;case"video":case"audio":for(r=0;r<ig.length;r++)ks(ig[r],t);r=s;break;case"source":ks("error",t),r=s;break;case"img":case"image":case"link":ks("error",t),ks("load",t),r=s;break;case"details":ks("toggle",t),r=s;break;case"input":T3(t,s),r=fC(t,s),ks("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=Ls({},s,{value:void 0}),ks("invalid",t);break;case"textarea":E3(t,s),r=gC(t,s),ks("invalid",t);break;default:r=s}yC(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?HL(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&WL(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Jg(t,l):typeof l=="number"&&Jg(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Zg.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ks("scroll",t):l!=null&&kT(t,i,l,o))}switch(n){case"input":oy(t),_3(t,s,!1);break;case"textarea":oy(t),$3(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Lu(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?Kf(t,!!s.multiple,i,!1):s.defaultValue!=null&&Kf(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=eb)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return zr(e),null;case 6:if(t&&e.stateNode!=null)pB(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(Ue(166));if(n=Ld(u0.current),Ld(Nl.current),my(e)){if(s=e.stateNode,n=e.memoizedProps,s[gl]=e,(i=s.nodeValue!==n)&&(t=wo,t!==null))switch(t.tag){case 3:py(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&py(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[gl]=e,e.stateNode=s}return zr(e),null;case 13:if(_s(As),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Is&&vo!==null&&e.mode&1&&!(e.flags&128))P5(),Np(),e.flags|=98560,i=!1;else if(i=my(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(Ue(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ue(317));i[gl]=e}else Np(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;zr(e),i=!1}else Ia!==null&&(JC(Ia),Ia=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||As.current&1?mr===0&&(mr=3):o_())),e.updateQueue!==null&&(e.flags|=4),zr(e),null);case 4:return _p(),HC(t,e),t===null&&o0(e.stateNode.containerInfo),zr(e),null;case 10:return WT(e.type._context),zr(e),null;case 17:return Ki(e.type)&&tb(),zr(e),null;case 19:if(_s(As),i=e.memoizedState,i===null)return zr(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)Dm(i,!1);else{if(mr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=lb(t),o!==null){for(e.flags|=128,Dm(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return xs(As,As.current&1|2),e.child}t=t.sibling}i.tail!==null&&er()>$p&&(e.flags|=128,s=!0,Dm(i,!1),e.lanes=4194304)}else{if(!s)if(t=lb(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Dm(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Is)return zr(e),null}else 2*er()-i.renderingStartTime>$p&&n!==1073741824&&(e.flags|=128,s=!0,Dm(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=er(),e.sibling=null,n=As.current,xs(As,s?n&1|2:n&1),e):(zr(e),null);case 22:case 23:return i_(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?oo&1073741824&&(zr(e),e.subtreeFlags&6&&(e.flags|=8192)):zr(e),null;case 24:return null;case 25:return null}throw Error(Ue(156,e.tag))}function OQ(t,e){switch(LT(e),e.tag){case 1:return Ki(e.type)&&tb(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return _p(),_s(Gi),_s(Jr),qT(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return KT(e),null;case 13:if(_s(As),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ue(340));Np()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return _s(As),null;case 4:return _p(),null;case 10:return WT(e.type._context),null;case 22:case 23:return i_(),null;case 24:return null;default:return null}}var yy=!1,qr=!1,FQ=typeof WeakSet=="function"?WeakSet:Set,bt=null;function Df(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Gs(t,e,s)}else n.current=null}function GC(t,e,n){try{n()}catch(s){Gs(t,e,s)}}var yA=!1;function MQ(t,e){if($C=Qv,t=v5(),FT(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,d=0,h=t,f=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(l=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===t)break t;if(f===n&&++c===r&&(a=o),f===i&&++d===s&&(l=o),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(IC={focusedElem:t,selectionRange:n},Qv=!1,bt=e;bt!==null;)if(e=bt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,bt=t;else for(;bt!==null;){e=bt;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,x=m.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ta(e.type,g),x);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ue(163))}}catch(C){Gs(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,bt=t;break}bt=e.return}return m=yA,yA=!1,m}function Ig(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&GC(e,n,i)}r=r.next}while(r!==s)}}function zw(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function KC(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function mB(t){var e=t.alternate;e!==null&&(t.alternate=null,mB(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[gl],delete e[l0],delete e[AC],delete e[bQ],delete e[wQ])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gB(t){return t.tag===5||t.tag===3||t.tag===4}function vA(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gB(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qC(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=eb));else if(s!==4&&(t=t.child,t!==null))for(qC(t,e,n),t=t.sibling;t!==null;)qC(t,e,n),t=t.sibling}function XC(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(XC(t,e,n),t=t.sibling;t!==null;)XC(t,e,n),t=t.sibling}var jr=null,Ea=!1;function Wc(t,e,n){for(n=n.child;n!==null;)xB(t,e,n),n=n.sibling}function xB(t,e,n){if(kl&&typeof kl.onCommitFiberUnmount=="function")try{kl.onCommitFiberUnmount(jw,n)}catch{}switch(n.tag){case 5:qr||Df(n,e);case 6:var s=jr,r=Ea;jr=null,Wc(t,e,n),jr=s,Ea=r,jr!==null&&(Ea?(t=jr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):jr.removeChild(n.stateNode));break;case 18:jr!==null&&(Ea?(t=jr,n=n.stateNode,t.nodeType===8?_2(t.parentNode,n):t.nodeType===1&&_2(t,n),s0(t)):_2(jr,n.stateNode));break;case 4:s=jr,r=Ea,jr=n.stateNode.containerInfo,Ea=!0,Wc(t,e,n),jr=s,Ea=r;break;case 0:case 11:case 14:case 15:if(!qr&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&GC(n,e,o),r=r.next}while(r!==s)}Wc(t,e,n);break;case 1:if(!qr&&(Df(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){Gs(n,e,a)}Wc(t,e,n);break;case 21:Wc(t,e,n);break;case 22:n.mode&1?(qr=(s=qr)||n.memoizedState!==null,Wc(t,e,n),qr=s):Wc(t,e,n);break;default:Wc(t,e,n)}}function bA(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FQ),e.forEach(function(s){var r=KQ.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Ca(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:jr=a.stateNode,Ea=!1;break e;case 3:jr=a.stateNode.containerInfo,Ea=!0;break e;case 4:jr=a.stateNode.containerInfo,Ea=!0;break e}a=a.return}if(jr===null)throw Error(Ue(160));xB(i,o,r),jr=null,Ea=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Gs(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yB(e,t),e=e.sibling}function yB(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ca(e,t),il(t),s&4){try{Ig(3,t,t.return),zw(3,t)}catch(g){Gs(t,t.return,g)}try{Ig(5,t,t.return)}catch(g){Gs(t,t.return,g)}}break;case 1:Ca(e,t),il(t),s&512&&n!==null&&Df(n,n.return);break;case 5:if(Ca(e,t),il(t),s&512&&n!==null&&Df(n,n.return),t.flags&32){var r=t.stateNode;try{Jg(r,"")}catch(g){Gs(t,t.return,g)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&BL(r,i),vC(a,o);var c=vC(a,i);for(o=0;o<l.length;o+=2){var d=l[o],h=l[o+1];d==="style"?HL(r,h):d==="dangerouslySetInnerHTML"?WL(r,h):d==="children"?Jg(r,h):kT(r,d,h,c)}switch(a){case"input":pC(r,i);break;case"textarea":VL(r,i);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Kf(r,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?Kf(r,!!i.multiple,i.defaultValue,!0):Kf(r,!!i.multiple,i.multiple?[]:"",!1))}r[l0]=i}catch(g){Gs(t,t.return,g)}}break;case 6:if(Ca(e,t),il(t),s&4){if(t.stateNode===null)throw Error(Ue(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(g){Gs(t,t.return,g)}}break;case 3:if(Ca(e,t),il(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{s0(e.containerInfo)}catch(g){Gs(t,t.return,g)}break;case 4:Ca(e,t),il(t);break;case 13:Ca(e,t),il(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(s_=er())),s&4&&bA(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(qr=(c=qr)||d,Ca(e,t),qr=c):Ca(e,t),il(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!d&&t.mode&1)for(bt=t,d=t.child;d!==null;){for(h=bt=d;bt!==null;){switch(f=bt,p=f.child,f.tag){case 0:case 11:case 14:case 15:Ig(4,f,f.return);break;case 1:Df(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){s=f,n=f.return;try{e=s,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){Gs(s,n,g)}}break;case 5:Df(f,f.return);break;case 22:if(f.memoizedState!==null){SA(h);continue}}p!==null?(p.return=f,bt=p):SA(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{r=h.stateNode,c?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=UL("display",o))}catch(g){Gs(t,t.return,g)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(g){Gs(t,t.return,g)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ca(e,t),il(t),s&4&&bA(t);break;case 21:break;default:Ca(e,t),il(t)}}function il(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(gB(n)){var s=n;break e}n=n.return}throw Error(Ue(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Jg(r,""),s.flags&=-33);var i=vA(t);XC(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=vA(t);qC(t,a,o);break;default:throw Error(Ue(161))}}catch(l){Gs(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function LQ(t,e,n){bt=t,vB(t)}function vB(t,e,n){for(var s=(t.mode&1)!==0;bt!==null;){var r=bt,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||yy;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||qr;a=yy;var c=qr;if(yy=o,(qr=l)&&!c)for(bt=r;bt!==null;)o=bt,l=o.child,o.tag===22&&o.memoizedState!==null?CA(r):l!==null?(l.return=o,bt=l):CA(r);for(;i!==null;)bt=i,vB(i),i=i.sibling;bt=r,yy=a,qr=c}wA(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,bt=i):wA(t)}}function wA(t){for(;bt!==null;){var e=bt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qr||zw(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!qr)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ta(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&iA(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}iA(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&s0(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ue(163))}qr||e.flags&512&&KC(e)}catch(f){Gs(e,e.return,f)}}if(e===t){bt=null;break}if(n=e.sibling,n!==null){n.return=e.return,bt=n;break}bt=e.return}}function SA(t){for(;bt!==null;){var e=bt;if(e===t){bt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,bt=n;break}bt=e.return}}function CA(t){for(;bt!==null;){var e=bt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{zw(4,e)}catch(l){Gs(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){Gs(e,r,l)}}var i=e.return;try{KC(e)}catch(l){Gs(e,i,l)}break;case 5:var o=e.return;try{KC(e)}catch(l){Gs(e,o,l)}}}catch(l){Gs(e,e.return,l)}if(e===t){bt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,bt=a;break}bt=e.return}}var BQ=Math.ceil,db=Dc.ReactCurrentDispatcher,t_=Dc.ReactCurrentOwner,oa=Dc.ReactCurrentBatchConfig,Dn=0,Nr=null,ir=null,Or=0,oo=0,Of=nd(0),mr=0,p0=null,dh=0,Ww=0,n_=0,Rg=null,Vi=null,s_=0,$p=1/0,ec=null,hb=!1,YC=null,Eu=null,vy=!1,xu=null,fb=0,Pg=0,QC=null,xv=-1,yv=0;function yi(){return Dn&6?er():xv!==-1?xv:xv=er()}function $u(t){return t.mode&1?Dn&2&&Or!==0?Or&-Or:CQ.transition!==null?(yv===0&&(yv=s5()),yv):(t=Jn,t!==0||(t=window.event,t=t===void 0?16:u5(t.type)),t):1}function Va(t,e,n,s){if(50<Pg)throw Pg=0,QC=null,Error(Ue(185));mx(t,n,s),(!(Dn&2)||t!==Nr)&&(t===Nr&&(!(Dn&2)&&(Ww|=n),mr===4&&ru(t,Or)),qi(t,s),n===1&&Dn===0&&!(e.mode&1)&&($p=er()+500,Lw&&sd()))}function qi(t,e){var n=t.callbackNode;CY(t,e);var s=Yv(t,t===Nr?Or:0);if(s===0)n!==null&&P3(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&P3(n),e===1)t.tag===0?SQ(kA.bind(null,t)):$5(kA.bind(null,t)),yQ(function(){!(Dn&6)&&sd()}),n=null;else{switch(r5(s)){case 1:n=$T;break;case 4:n=t5;break;case 16:n=Xv;break;case 536870912:n=n5;break;default:n=Xv}n=_B(n,bB.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function bB(t,e){if(xv=-1,yv=0,Dn&6)throw Error(Ue(327));var n=t.callbackNode;if(Zf()&&t.callbackNode!==n)return null;var s=Yv(t,t===Nr?Or:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=pb(t,s);else{e=s;var r=Dn;Dn|=2;var i=SB();(Nr!==t||Or!==e)&&(ec=null,$p=er()+500,eh(t,e));do try{WQ();break}catch(a){wB(t,a)}while(!0);zT(),db.current=i,Dn=r,ir!==null?e=0:(Nr=null,Or=0,e=mr)}if(e!==0){if(e===2&&(r=kC(t),r!==0&&(s=r,e=ZC(t,r))),e===1)throw n=p0,eh(t,0),ru(t,s),qi(t,er()),n;if(e===6)ru(t,s);else{if(r=t.current.alternate,!(s&30)&&!VQ(r)&&(e=pb(t,s),e===2&&(i=kC(t),i!==0&&(s=i,e=ZC(t,i))),e===1))throw n=p0,eh(t,0),ru(t,s),qi(t,er()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(Ue(345));case 2:Sd(t,Vi,ec);break;case 3:if(ru(t,s),(s&130023424)===s&&(e=s_+500-er(),10<e)){if(Yv(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){yi(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=PC(Sd.bind(null,t,Vi,ec),e);break}Sd(t,Vi,ec);break;case 4:if(ru(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-Ba(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=er()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*BQ(s/1960))-s,10<s){t.timeoutHandle=PC(Sd.bind(null,t,Vi,ec),s);break}Sd(t,Vi,ec);break;case 5:Sd(t,Vi,ec);break;default:throw Error(Ue(329))}}}return qi(t,er()),t.callbackNode===n?bB.bind(null,t):null}function ZC(t,e){var n=Rg;return t.current.memoizedState.isDehydrated&&(eh(t,e).flags|=256),t=pb(t,e),t!==2&&(e=Vi,Vi=n,e!==null&&JC(e)),t}function JC(t){Vi===null?Vi=t:Vi.push.apply(Vi,t)}function VQ(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!Ga(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ru(t,e){for(e&=~n_,e&=~Ww,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ba(e),s=1<<n;t[n]=-1,e&=~s}}function kA(t){if(Dn&6)throw Error(Ue(327));Zf();var e=Yv(t,0);if(!(e&1))return qi(t,er()),null;var n=pb(t,e);if(t.tag!==0&&n===2){var s=kC(t);s!==0&&(e=s,n=ZC(t,s))}if(n===1)throw n=p0,eh(t,0),ru(t,e),qi(t,er()),n;if(n===6)throw Error(Ue(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Sd(t,Vi,ec),qi(t,er()),null}function r_(t,e){var n=Dn;Dn|=1;try{return t(e)}finally{Dn=n,Dn===0&&($p=er()+500,Lw&&sd())}}function hh(t){xu!==null&&xu.tag===0&&!(Dn&6)&&Zf();var e=Dn;Dn|=1;var n=oa.transition,s=Jn;try{if(oa.transition=null,Jn=1,t)return t()}finally{Jn=s,oa.transition=n,Dn=e,!(Dn&6)&&sd()}}function i_(){oo=Of.current,_s(Of)}function eh(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xQ(n)),ir!==null)for(n=ir.return;n!==null;){var s=n;switch(LT(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&tb();break;case 3:_p(),_s(Gi),_s(Jr),qT();break;case 5:KT(s);break;case 4:_p();break;case 13:_s(As);break;case 19:_s(As);break;case 10:WT(s.type._context);break;case 22:case 23:i_()}n=n.return}if(Nr=t,ir=t=Iu(t.current,null),Or=oo=e,mr=0,p0=null,n_=Ww=dh=0,Vi=Rg=null,Md!==null){for(e=0;e<Md.length;e++)if(n=Md[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}Md=null}return t}function wB(t,e){do{var n=ir;try{if(zT(),pv.current=ub,cb){for(var s=Fs.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}cb=!1}if(uh=0,wr=dr=Fs=null,$g=!1,d0=0,t_.current=null,n===null||n.return===null){mr=1,p0=e,ir=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=Or,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=dA(o);if(p!==null){p.flags&=-257,hA(p,o,a,i,e),p.mode&1&&uA(i,c,e),e=p,l=c;var m=e.updateQueue;if(m===null){var g=new Set;g.add(l),e.updateQueue=g}else m.add(l);break e}else{if(!(e&1)){uA(i,c,e),o_();break e}l=Error(Ue(426))}}else if(Is&&a.mode&1){var x=dA(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),hA(x,o,a,i,e),BT(Ep(l,a));break e}}i=l=Ep(l,a),mr!==4&&(mr=2),Rg===null?Rg=[i]:Rg.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=rB(i,l,e);rA(i,y);break e;case 1:a=l;var v=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Eu===null||!Eu.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var C=iB(i,a,e);rA(i,C);break e}}i=i.return}while(i!==null)}kB(n)}catch(k){e=k,ir===n&&n!==null&&(ir=n=n.return);continue}break}while(!0)}function SB(){var t=db.current;return db.current=ub,t===null?ub:t}function o_(){(mr===0||mr===3||mr===2)&&(mr=4),Nr===null||!(dh&268435455)&&!(Ww&268435455)||ru(Nr,Or)}function pb(t,e){var n=Dn;Dn|=2;var s=SB();(Nr!==t||Or!==e)&&(ec=null,eh(t,e));do try{zQ();break}catch(r){wB(t,r)}while(!0);if(zT(),Dn=n,db.current=s,ir!==null)throw Error(Ue(261));return Nr=null,Or=0,mr}function zQ(){for(;ir!==null;)CB(ir)}function WQ(){for(;ir!==null&&!pY();)CB(ir)}function CB(t){var e=TB(t.alternate,t,oo);t.memoizedProps=t.pendingProps,e===null?kB(t):ir=e,t_.current=null}function kB(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=OQ(n,e),n!==null){n.flags&=32767,ir=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{mr=6,ir=null;return}}else if(n=DQ(n,e,oo),n!==null){ir=n;return}if(e=e.sibling,e!==null){ir=e;return}ir=e=t}while(e!==null);mr===0&&(mr=5)}function Sd(t,e,n){var s=Jn,r=oa.transition;try{oa.transition=null,Jn=1,UQ(t,e,n,s)}finally{oa.transition=r,Jn=s}return null}function UQ(t,e,n,s){do Zf();while(xu!==null);if(Dn&6)throw Error(Ue(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ue(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kY(t,i),t===Nr&&(ir=Nr=null,Or=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vy||(vy=!0,_B(Xv,function(){return Zf(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=oa.transition,oa.transition=null;var o=Jn;Jn=1;var a=Dn;Dn|=4,t_.current=null,MQ(t,n),yB(n,t),uQ(IC),Qv=!!$C,IC=$C=null,t.current=n,LQ(n),mY(),Dn=a,Jn=o,oa.transition=i}else t.current=n;if(vy&&(vy=!1,xu=t,fb=r),i=t.pendingLanes,i===0&&(Eu=null),yY(n.stateNode),qi(t,er()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(hb)throw hb=!1,t=YC,YC=null,t;return fb&1&&t.tag!==0&&Zf(),i=t.pendingLanes,i&1?t===QC?Pg++:(Pg=0,QC=t):Pg=0,sd(),null}function Zf(){if(xu!==null){var t=r5(fb),e=oa.transition,n=Jn;try{if(oa.transition=null,Jn=16>t?16:t,xu===null)var s=!1;else{if(t=xu,xu=null,fb=0,Dn&6)throw Error(Ue(331));var r=Dn;for(Dn|=4,bt=t.current;bt!==null;){var i=bt,o=i.child;if(bt.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(bt=c;bt!==null;){var d=bt;switch(d.tag){case 0:case 11:case 15:Ig(8,d,i)}var h=d.child;if(h!==null)h.return=d,bt=h;else for(;bt!==null;){d=bt;var f=d.sibling,p=d.return;if(mB(d),d===c){bt=null;break}if(f!==null){f.return=p,bt=f;break}bt=p}}}var m=i.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var x=g.sibling;g.sibling=null,g=x}while(g!==null)}}bt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,bt=o;else e:for(;bt!==null;){if(i=bt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ig(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,bt=y;break e}bt=i.return}}var v=t.current;for(bt=v;bt!==null;){o=bt;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,bt=S;else e:for(o=v;bt!==null;){if(a=bt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:zw(9,a)}}catch(k){Gs(a,a.return,k)}if(a===o){bt=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,bt=C;break e}bt=a.return}}if(Dn=r,sd(),kl&&typeof kl.onPostCommitFiberRoot=="function")try{kl.onPostCommitFiberRoot(jw,t)}catch{}s=!0}return s}finally{Jn=n,oa.transition=e}}return!1}function NA(t,e,n){e=Ep(n,e),e=rB(t,e,1),t=_u(t,e,1),e=yi(),t!==null&&(mx(t,1,e),qi(t,e))}function Gs(t,e,n){if(t.tag===3)NA(t,t,n);else for(;e!==null;){if(e.tag===3){NA(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Eu===null||!Eu.has(s))){t=Ep(n,t),t=iB(e,t,1),e=_u(e,t,1),t=yi(),e!==null&&(mx(e,1,t),qi(e,t));break}}e=e.return}}function HQ(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=yi(),t.pingedLanes|=t.suspendedLanes&n,Nr===t&&(Or&n)===n&&(mr===4||mr===3&&(Or&130023424)===Or&&500>er()-s_?eh(t,0):n_|=n),qi(t,e)}function NB(t,e){e===0&&(t.mode&1?(e=cy,cy<<=1,!(cy&130023424)&&(cy=4194304)):e=1);var n=yi();t=bc(t,e),t!==null&&(mx(t,e,n),qi(t,n))}function GQ(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),NB(t,n)}function KQ(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(Ue(314))}s!==null&&s.delete(e),NB(t,n)}var TB;TB=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Gi.current)Ui=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ui=!1,jQ(t,e,n);Ui=!!(t.flags&131072)}else Ui=!1,Is&&e.flags&1048576&&I5(e,rb,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;gv(t,e),t=e.pendingProps;var r=kp(e,Jr.current);Qf(e,n),r=YT(null,e,s,t,r,n);var i=QT();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ki(s)?(i=!0,nb(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,HT(e),r.updater=Vw,e.stateNode=r,r._reactInternals=e,LC(e,s,t,n),e=zC(null,e,s,!0,i,n)):(e.tag=0,Is&&i&&MT(e),hi(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(gv(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=XQ(s),t=Ta(s,t),r){case 0:e=VC(null,e,s,t,n);break e;case 1:e=mA(null,e,s,t,n);break e;case 11:e=fA(null,e,s,t,n);break e;case 14:e=pA(null,e,s,Ta(s.type,t),n);break e}throw Error(Ue(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ta(s,r),VC(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ta(s,r),mA(t,e,s,r,n);case 3:e:{if(cB(e),t===null)throw Error(Ue(387));s=e.pendingProps,i=e.memoizedState,r=i.element,O5(t,e),ab(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=Ep(Error(Ue(423)),e),e=gA(t,e,s,n,r);break e}else if(s!==r){r=Ep(Error(Ue(424)),e),e=gA(t,e,s,n,r);break e}else for(vo=Tu(e.stateNode.containerInfo.firstChild),wo=e,Is=!0,Ia=null,n=j5(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Np(),s===r){e=wc(t,e,n);break e}hi(t,e,s,n)}e=e.child}return e;case 5:return F5(e),t===null&&OC(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,RC(s,r)?o=null:i!==null&&RC(s,i)&&(e.flags|=32),lB(t,e),hi(t,e,o,n),e.child;case 6:return t===null&&OC(e),null;case 13:return uB(t,e,n);case 4:return GT(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Tp(e,null,s,n):hi(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ta(s,r),fA(t,e,s,r,n);case 7:return hi(t,e,e.pendingProps,n),e.child;case 8:return hi(t,e,e.pendingProps.children,n),e.child;case 12:return hi(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,xs(ib,s._currentValue),s._currentValue=o,i!==null)if(Ga(i.value,o)){if(i.children===r.children&&!Gi.current){e=wc(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=hc(-1,n&-n),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),FC(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Ue(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),FC(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}hi(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Qf(e,n),r=da(r),s=s(r),e.flags|=1,hi(t,e,s,n),e.child;case 14:return s=e.type,r=Ta(s,e.pendingProps),r=Ta(s.type,r),pA(t,e,s,r,n);case 15:return oB(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ta(s,r),gv(t,e),e.tag=1,Ki(s)?(t=!0,nb(e)):t=!1,Qf(e,n),sB(e,s,r),LC(e,s,r,n),zC(null,e,s,!0,t,n);case 19:return dB(t,e,n);case 22:return aB(t,e,n)}throw Error(Ue(156,e.tag))};function _B(t,e){return e5(t,e)}function qQ(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jo(t,e,n,s){return new qQ(t,e,n,s)}function a_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function XQ(t){if(typeof t=="function")return a_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===TT)return 11;if(t===_T)return 14}return 2}function Iu(t,e){var n=t.alternate;return n===null?(n=Jo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function vv(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")a_(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Tf:return th(n.children,r,i,e);case NT:o=8,r|=8;break;case cC:return t=Jo(12,n,e,r|2),t.elementType=cC,t.lanes=i,t;case uC:return t=Jo(13,n,e,r),t.elementType=uC,t.lanes=i,t;case dC:return t=Jo(19,n,e,r),t.elementType=dC,t.lanes=i,t;case FL:return Uw(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case DL:o=10;break e;case OL:o=9;break e;case TT:o=11;break e;case _T:o=14;break e;case Jc:o=16,s=null;break e}throw Error(Ue(130,t==null?t:typeof t,""))}return e=Jo(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function th(t,e,n,s){return t=Jo(7,t,s,e),t.lanes=n,t}function Uw(t,e,n,s){return t=Jo(22,t,s,e),t.elementType=FL,t.lanes=n,t.stateNode={isHidden:!1},t}function D2(t,e,n){return t=Jo(6,t,null,e),t.lanes=n,t}function O2(t,e,n){return e=Jo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YQ(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=g2(0),this.expirationTimes=g2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=g2(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function l_(t,e,n,s,r,i,o,a,l){return t=new YQ(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Jo(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},HT(i),t}function QQ(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nf,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function EB(t){if(!t)return Bu;t=t._reactInternals;e:{if(Oh(t)!==t||t.tag!==1)throw Error(Ue(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ki(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ue(171))}if(t.tag===1){var n=t.type;if(Ki(n))return E5(t,n,e)}return e}function $B(t,e,n,s,r,i,o,a,l){return t=l_(n,s,!0,t,r,i,o,a,l),t.context=EB(null),n=t.current,s=yi(),r=$u(n),i=hc(s,r),i.callback=e??null,_u(n,i,r),t.current.lanes=r,mx(t,r,s),qi(t,s),t}function Hw(t,e,n,s){var r=e.current,i=yi(),o=$u(r);return n=EB(n),e.context===null?e.context=n:e.pendingContext=n,e=hc(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=_u(r,e,o),t!==null&&(Va(t,r,o,i),fv(t,r,o)),o}function mb(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function TA(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function c_(t,e){TA(t,e),(t=t.alternate)&&TA(t,e)}function ZQ(){return null}var IB=typeof reportError=="function"?reportError:function(t){console.error(t)};function u_(t){this._internalRoot=t}Gw.prototype.render=u_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ue(409));Hw(t,e,null,null)};Gw.prototype.unmount=u_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;hh(function(){Hw(null,t,null,null)}),e[vc]=null}};function Gw(t){this._internalRoot=t}Gw.prototype.unstable_scheduleHydration=function(t){if(t){var e=a5();t={blockedOn:null,target:t,priority:e};for(var n=0;n<su.length&&e!==0&&e<su[n].priority;n++);su.splice(n,0,t),n===0&&c5(t)}};function d_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Kw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _A(){}function JQ(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var c=mb(o);i.call(c)}}var o=$B(e,s,t,0,null,!1,!1,"",_A);return t._reactRootContainer=o,t[vc]=o.current,o0(t.nodeType===8?t.parentNode:t),hh(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var c=mb(l);a.call(c)}}var l=l_(t,0,!1,null,null,!1,!1,"",_A);return t._reactRootContainer=l,t[vc]=l.current,o0(t.nodeType===8?t.parentNode:t),hh(function(){Hw(e,l,n,s)}),l}function qw(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=mb(o);a.call(l)}}Hw(e,o,t,r)}else o=JQ(n,e,t,r,s);return mb(o)}i5=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=rg(e.pendingLanes);n!==0&&(IT(e,n|1),qi(e,er()),!(Dn&6)&&($p=er()+500,sd()))}break;case 13:hh(function(){var s=bc(t,1);if(s!==null){var r=yi();Va(s,t,1,r)}}),c_(t,1)}};RT=function(t){if(t.tag===13){var e=bc(t,134217728);if(e!==null){var n=yi();Va(e,t,134217728,n)}c_(t,134217728)}};o5=function(t){if(t.tag===13){var e=$u(t),n=bc(t,e);if(n!==null){var s=yi();Va(n,t,e,s)}c_(t,e)}};a5=function(){return Jn};l5=function(t,e){var n=Jn;try{return Jn=t,e()}finally{Jn=n}};wC=function(t,e,n){switch(e){case"input":if(pC(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Mw(s);if(!r)throw Error(Ue(90));LL(s),pC(s,r)}}}break;case"textarea":VL(t,n);break;case"select":e=n.value,e!=null&&Kf(t,!!n.multiple,e,!1)}};qL=r_;XL=hh;var eZ={usingClientEntryPoint:!1,Events:[xx,If,Mw,GL,KL,r_]},Om={findFiberByHostInstance:Fd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tZ={bundleType:Om.bundleType,version:Om.version,rendererPackageName:Om.rendererPackageName,rendererConfig:Om.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZL(t),t===null?null:t.stateNode},findFiberByHostInstance:Om.findFiberByHostInstance||ZQ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var by=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!by.isDisabled&&by.supportsFiber)try{jw=by.inject(tZ),kl=by}catch{}}Io.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eZ;Io.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d_(e))throw Error(Ue(200));return QQ(t,e,null,n)};Io.createRoot=function(t,e){if(!d_(t))throw Error(Ue(299));var n=!1,s="",r=IB;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=l_(t,1,!1,null,null,n,!1,s,r),t[vc]=e.current,o0(t.nodeType===8?t.parentNode:t),new u_(e)};Io.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ue(188)):(t=Object.keys(t).join(","),Error(Ue(268,t)));return t=ZL(e),t=t===null?null:t.stateNode,t};Io.flushSync=function(t){return hh(t)};Io.hydrate=function(t,e,n){if(!Kw(e))throw Error(Ue(200));return qw(null,t,e,!0,n)};Io.hydrateRoot=function(t,e,n){if(!d_(t))throw Error(Ue(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=IB;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=$B(e,null,t,1,n??null,r,!1,i,o),t[vc]=e.current,o0(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Gw(e)};Io.render=function(t,e,n){if(!Kw(e))throw Error(Ue(200));return qw(null,t,e,!1,n)};Io.unmountComponentAtNode=function(t){if(!Kw(t))throw Error(Ue(40));return t._reactRootContainer?(hh(function(){qw(null,null,t,!1,function(){t._reactRootContainer=null,t[vc]=null})}),!0):!1};Io.unstable_batchedUpdates=r_;Io.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!Kw(n))throw Error(Ue(200));if(t==null||t._reactInternals===void 0)throw Error(Ue(38));return qw(t,e,n,!1,s)};Io.version="18.3.1-next-f1338f8080-20240426";function RB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(RB)}catch(t){console.error(t)}}RB(),RL.exports=Io;var Fh=RL.exports;const nZ=Pw(Fh);var EA=Fh;aC.createRoot=EA.createRoot,aC.hydrateRoot=EA.hydrateRoot;function sZ(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var n,s,r,i,o=[],a="",l=t.split("/");for(l[0]||l.shift();r=l.shift();)n=r[0],n==="*"?(o.push(n),a+=r[1]==="?"?"(?:/(.*))?":"/(.*)"):n===":"?(s=r.indexOf("?",1),i=r.indexOf(".",1),o.push(r.substring(1,~s?s:~i?i:r.length)),a+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~s?"?":"")+"\\"+r.substring(i))):a+="/"+r;return{keys:o,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}var PB={exports:{}},AB={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ip=b;function rZ(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var iZ=typeof Object.is=="function"?Object.is:rZ,oZ=Ip.useState,aZ=Ip.useEffect,lZ=Ip.useLayoutEffect,cZ=Ip.useDebugValue;function uZ(t,e){var n=e(),s=oZ({inst:{value:n,getSnapshot:e}}),r=s[0].inst,i=s[1];return lZ(function(){r.value=n,r.getSnapshot=e,F2(r)&&i({inst:r})},[t,n,e]),aZ(function(){return F2(r)&&i({inst:r}),t(function(){F2(r)&&i({inst:r})})},[t]),cZ(n),n}function F2(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!iZ(t,n)}catch{return!0}}function dZ(t,e){return e()}var hZ=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?dZ:uZ;AB.useSyncExternalStore=Ip.useSyncExternalStore!==void 0?Ip.useSyncExternalStore:hZ;PB.exports=AB;var fZ=PB.exports;const pZ=$L.useInsertionEffect,mZ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jB=mZ?b.useLayoutEffect:b.useEffect,gZ=pZ||jB,h_=t=>{const e=b.useRef([t,(...n)=>e[0](...n)]).current;return gZ(()=>{e[0]=t}),e[1]},xZ="popstate",f_="pushState",p_="replaceState",yZ="hashchange",$A=[xZ,f_,p_,yZ],vZ=t=>{for(const e of $A)addEventListener(e,t);return()=>{for(const e of $A)removeEventListener(e,t)}},DB=(t,e)=>fZ.useSyncExternalStore(vZ,t,e),bZ=()=>location.search,wZ=({ssrSearch:t=""}={})=>DB(bZ,()=>t),IA=()=>location.pathname,SZ=({ssrPath:t}={})=>DB(IA,t?()=>t:IA),CZ=(t,{replace:e=!1,state:n=null}={})=>history[e?p_:f_](n,"",t),kZ=(t={})=>[SZ(t),CZ],RA=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[RA]>"u"){for(const t of[f_,p_]){const e=history[t];history[t]=function(){const n=e.apply(this,arguments),s=new Event(t);return s.arguments=arguments,dispatchEvent(s),n}}Object.defineProperty(window,RA,{value:!0})}const NZ=(t,e)=>e.toLowerCase().indexOf(t.toLowerCase())?"~"+e:e.slice(t.length)||"/",OB=(t="")=>t==="/"?"":t,TZ=(t,e)=>t[0]==="~"?t.slice(1):OB(e)+t,_Z=(t="",e)=>NZ(PA(OB(t)),PA(e)),PA=t=>{try{return decodeURI(t)}catch{return t}},FB={hook:kZ,searchHook:wZ,parser:sZ,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:t=>t},MB=b.createContext(FB),vx=()=>b.useContext(MB),LB={},BB=b.createContext(LB),EZ=()=>b.useContext(BB),Xw=t=>{const[e,n]=t.hook(t);return[_Z(t.base,e),h_((s,r)=>n(TZ(s,t.base),r))]},Po=()=>Xw(vx()),VB=(t,e,n,s)=>{const{pattern:r,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:t(e||"*",s),o=r.exec(n)||[],[a,...l]=o;return a!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((h,f)=>[h,l[f]])):o.groups;let d={...l};return c&&Object.assign(d,c),d})(),...s?[a]:[]]:[!1,null]},$Z=({children:t,...e})=>{var d,h;const n=vx(),s=e.hook?FB:n;let r=s;const[i,o]=((d=e.ssrPath)==null?void 0:d.split("?"))??[];o&&(e.ssrSearch=o,e.ssrPath=i),e.hrefs=e.hrefs??((h=e.hook)==null?void 0:h.hrefs);let a=b.useRef({}),l=a.current,c=l;for(let f in s){const p=f==="base"?s[f]+(e[f]||""):e[f]||s[f];l===c&&p!==c[f]&&(a.current=c={...c}),c[f]=p,p!==s[f]&&(r=c)}return b.createElement(MB.Provider,{value:r,children:t})},AA=({children:t,component:e},n)=>e?b.createElement(e,{params:n}):typeof t=="function"?t(n):t,IZ=t=>{let e=b.useRef(LB),n=e.current;for(const s in t)t[s]!==n[s]&&(n=t);return Object.keys(t).length===0&&(n=t),e.current=n},ro=({path:t,nest:e,match:n,...s})=>{const r=vx(),[i]=Xw(r),[o,a,l]=n??VB(r.parser,t,i,e),c=IZ({...EZ(),...a});if(!o)return null;const d=l?b.createElement($Z,{base:l},AA(s,c)):AA(s,c);return b.createElement(BB.Provider,{value:c,children:d})},jn=b.forwardRef((t,e)=>{const n=vx(),[s,r]=Xw(n),{to:i="",href:o=i,onClick:a,asChild:l,children:c,className:d,replace:h,state:f,...p}=t,m=h_(x=>{x.ctrlKey||x.metaKey||x.altKey||x.shiftKey||x.button!==0||(a==null||a(x),x.defaultPrevented||(x.preventDefault(),r(o,t)))}),g=n.hrefs(o[0]==="~"?o.slice(1):n.base+o,n);return l&&b.isValidElement(c)?b.cloneElement(c,{onClick:m,href:g}):b.createElement("a",{...p,onClick:m,href:g,className:d!=null&&d.call?d(s===o):d,children:c,ref:e})}),zB=t=>Array.isArray(t)?t.flatMap(e=>zB(e&&e.type===b.Fragment?e.props.children:e)):[t],RZ=({children:t,location:e})=>{const n=vx(),[s]=Xw(n);for(const r of zB(t)){let i=0;if(b.isValidElement(r)&&(i=VB(n.parser,r.props.path,e||s,r.props.nest))[0])return b.cloneElement(r,{match:i})}return null},PZ=t=>{const{to:e,href:n=e}=t,[,s]=Po(),r=h_(()=>s(e||n,t));return jB(()=>{r()},[]),null};var nm=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},fh=typeof window>"u"||"Deno"in globalThis;function qo(){}function AZ(t,e){return typeof t=="function"?t(e):t}function ek(t){return typeof t=="number"&&t>=0&&t!==1/0}function WB(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Jf(t,e){return typeof t=="function"?t(e):t}function Ra(t,e){return typeof t=="function"?t(e):t}function jA(t,e){const{type:n="all",exact:s,fetchStatus:r,predicate:i,queryKey:o,stale:a}=t;if(o){if(s){if(e.queryHash!==m_(o,e.options))return!1}else if(!m0(e.queryKey,o))return!1}if(n!=="all"){const l=e.isActive();if(n==="active"&&!l||n==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||r&&r!==e.state.fetchStatus||i&&!i(e))}function DA(t,e){const{exact:n,status:s,predicate:r,mutationKey:i}=t;if(i){if(!e.options.mutationKey)return!1;if(n){if(ph(e.options.mutationKey)!==ph(i))return!1}else if(!m0(e.options.mutationKey,i))return!1}return!(s&&e.state.status!==s||r&&!r(e))}function m_(t,e){return((e==null?void 0:e.queryKeyHashFn)||ph)(t)}function ph(t){return JSON.stringify(t,(e,n)=>tk(n)?Object.keys(n).sort().reduce((s,r)=>(s[r]=n[r],s),{}):n)}function m0(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?!Object.keys(e).some(n=>!m0(t[n],e[n])):!1}function UB(t,e){if(t===e)return t;const n=OA(t)&&OA(e);if(n||tk(t)&&tk(e)){const s=n?t:Object.keys(t),r=s.length,i=n?e:Object.keys(e),o=i.length,a=n?[]:{};let l=0;for(let c=0;c<o;c++){const d=n?c:i[c];(!n&&s.includes(d)||n)&&t[d]===void 0&&e[d]===void 0?(a[d]=void 0,l++):(a[d]=UB(t[d],e[d]),a[d]===t[d]&&t[d]!==void 0&&l++)}return r===o&&l===r?t:a}return e}function gb(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function OA(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function tk(t){if(!FA(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!FA(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function FA(t){return Object.prototype.toString.call(t)==="[object Object]"}function jZ(t){return new Promise(e=>{setTimeout(e,t)})}function nk(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?UB(t,e):e}function DZ(t,e,n=0){const s=[...t,e];return n&&s.length>n?s.slice(1):s}function OZ(t,e,n=0){const s=[e,...t];return n&&s.length>n?s.slice(0,-1):s}var g_=Symbol();function HB(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===g_?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Kd,au,up,lL,FZ=(lL=class extends nm{constructor(){super();Ft(this,Kd);Ft(this,au);Ft(this,up);xt(this,up,e=>{if(!fh&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){J(this,au)||this.setEventListener(J(this,up))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,au))==null||e.call(this),xt(this,au,void 0))}setEventListener(e){var n;xt(this,up,e),(n=J(this,au))==null||n.call(this),xt(this,au,e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(e){J(this,Kd)!==e&&(xt(this,Kd,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof J(this,Kd)=="boolean"?J(this,Kd):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Kd=new WeakMap,au=new WeakMap,up=new WeakMap,lL),x_=new FZ,dp,lu,hp,cL,MZ=(cL=class extends nm{constructor(){super();Ft(this,dp,!0);Ft(this,lu);Ft(this,hp);xt(this,hp,e=>{if(!fh&&window.addEventListener){const n=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",s)}}})}onSubscribe(){J(this,lu)||this.setEventListener(J(this,hp))}onUnsubscribe(){var e;this.hasListeners()||((e=J(this,lu))==null||e.call(this),xt(this,lu,void 0))}setEventListener(e){var n;xt(this,hp,e),(n=J(this,lu))==null||n.call(this),xt(this,lu,e(this.setOnline.bind(this)))}setOnline(e){J(this,dp)!==e&&(xt(this,dp,e),this.listeners.forEach(s=>{s(e)}))}isOnline(){return J(this,dp)}},dp=new WeakMap,lu=new WeakMap,hp=new WeakMap,cL),xb=new MZ;function sk(){let t,e;const n=new Promise((r,i)=>{t=r,e=i});n.status="pending",n.catch(()=>{});function s(r){Object.assign(n,r),delete n.resolve,delete n.reject}return n.resolve=r=>{s({status:"fulfilled",value:r}),t(r)},n.reject=r=>{s({status:"rejected",reason:r}),e(r)},n}function LZ(t){return Math.min(1e3*2**t,3e4)}function GB(t){return(t??"online")==="online"?xb.isOnline():!0}var KB=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function M2(t){return t instanceof KB}function qB(t){let e=!1,n=0,s=!1,r;const i=sk(),o=g=>{var x;s||(f(new KB(g)),(x=t.abort)==null||x.call(t))},a=()=>{e=!0},l=()=>{e=!1},c=()=>x_.isFocused()&&(t.networkMode==="always"||xb.isOnline())&&t.canRun(),d=()=>GB(t.networkMode)&&t.canRun(),h=g=>{var x;s||(s=!0,(x=t.onSuccess)==null||x.call(t,g),r==null||r(),i.resolve(g))},f=g=>{var x;s||(s=!0,(x=t.onError)==null||x.call(t,g),r==null||r(),i.reject(g))},p=()=>new Promise(g=>{var x;r=y=>{(s||c())&&g(y)},(x=t.onPause)==null||x.call(t)}).then(()=>{var g;r=void 0,s||(g=t.onContinue)==null||g.call(t)}),m=()=>{if(s)return;let g;const x=n===0?t.initialPromise:void 0;try{g=x??t.fn()}catch(y){g=Promise.reject(y)}Promise.resolve(g).then(h).catch(y=>{var T;if(s)return;const v=t.retry??(fh?0:3),S=t.retryDelay??LZ,C=typeof S=="function"?S(n,y):S,k=v===!0||typeof v=="number"&&n<v||typeof v=="function"&&v(n,y);if(e||!k){f(y);return}n++,(T=t.onFail)==null||T.call(t,n,y),jZ(C).then(()=>c()?void 0:p()).then(()=>{e?f(y):m()})})};return{promise:i,cancel:o,continue:()=>(r==null||r(),i),cancelRetry:a,continueRetry:l,canStart:d,start:()=>(d()?m():p().then(m),i)}}function BZ(){let t=[],e=0,n=a=>{a()},s=a=>{a()},r=a=>setTimeout(a,0);const i=a=>{e?t.push(a):r(()=>{n(a)})},o=()=>{const a=t;t=[],a.length&&r(()=>{s(()=>{a.forEach(l=>{n(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{n=a},setBatchNotifyFunction:a=>{s=a},setScheduler:a=>{r=a}}}var hr=BZ(),qd,uL,XB=(uL=class{constructor(){Ft(this,qd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ek(this.gcTime)&&xt(this,qd,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(fh?1/0:5*60*1e3))}clearGcTimeout(){J(this,qd)&&(clearTimeout(J(this,qd)),xt(this,qd,void 0))}},qd=new WeakMap,uL),fp,pp,Ko,Ur,ux,Xd,_a,Yl,dL,VZ=(dL=class extends XB{constructor(e){super();Ft(this,_a);Ft(this,fp);Ft(this,pp);Ft(this,Ko);Ft(this,Ur);Ft(this,ux);Ft(this,Xd);xt(this,Xd,!1),xt(this,ux,e.defaultOptions),this.setOptions(e.options),this.observers=[],xt(this,Ko,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,xt(this,fp,zZ(this.options)),this.state=e.state??J(this,fp),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=J(this,Ur))==null?void 0:e.promise}setOptions(e){this.options={...J(this,ux),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&J(this,Ko).remove(this)}setData(e,n){const s=nk(this.state.data,e,this.options);return un(this,_a,Yl).call(this,{data:s,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),s}setState(e,n){un(this,_a,Yl).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var s,r;const n=(s=J(this,Ur))==null?void 0:s.promise;return(r=J(this,Ur))==null||r.cancel(e),n?n.then(qo).catch(qo):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(J(this,fp))}isActive(){return this.observers.some(e=>Ra(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===g_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!WB(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(s=>s.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=J(this,Ur))==null||n.continue()}onOnline(){var n;const e=this.observers.find(s=>s.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=J(this,Ur))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),J(this,Ko).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(J(this,Ur)&&(J(this,Xd)?J(this,Ur).cancel({revert:!0}):J(this,Ur).cancelRetry()),this.scheduleGc()),J(this,Ko).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||un(this,_a,Yl).call(this,{type:"invalidate"})}fetch(e,n){var l,c,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(J(this,Ur))return J(this,Ur).continueRetry(),J(this,Ur).promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const s=new AbortController,r=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(xt(this,Xd,!0),s.signal)})},i=()=>{const h=HB(this.options,n),f={queryKey:this.queryKey,meta:this.meta};return r(f),xt(this,Xd,!1),this.options.persister?this.options.persister(h,f,this):h(f)},o={fetchOptions:n,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:i};r(o),(l=this.options.behavior)==null||l.onFetch(o,this),xt(this,pp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((c=o.fetchOptions)==null?void 0:c.meta))&&un(this,_a,Yl).call(this,{type:"fetch",meta:(d=o.fetchOptions)==null?void 0:d.meta});const a=h=>{var f,p,m,g;M2(h)&&h.silent||un(this,_a,Yl).call(this,{type:"error",error:h}),M2(h)||((p=(f=J(this,Ko).config).onError)==null||p.call(f,h,this),(g=(m=J(this,Ko).config).onSettled)==null||g.call(m,this.state.data,h,this)),this.scheduleGc()};return xt(this,Ur,qB({initialPromise:n==null?void 0:n.initialPromise,fn:o.fetchFn,abort:s.abort.bind(s),onSuccess:h=>{var f,p,m,g;if(h===void 0){a(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(x){a(x);return}(p=(f=J(this,Ko).config).onSuccess)==null||p.call(f,h,this),(g=(m=J(this,Ko).config).onSettled)==null||g.call(m,h,this.state.error,this),this.scheduleGc()},onError:a,onFail:(h,f)=>{un(this,_a,Yl).call(this,{type:"failed",failureCount:h,error:f})},onPause:()=>{un(this,_a,Yl).call(this,{type:"pause"})},onContinue:()=>{un(this,_a,Yl).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),J(this,Ur).start()}},fp=new WeakMap,pp=new WeakMap,Ko=new WeakMap,Ur=new WeakMap,ux=new WeakMap,Xd=new WeakMap,_a=new WeakSet,Yl=function(e){const n=s=>{switch(e.type){case"failed":return{...s,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...YB(s.data,this.options),fetchMeta:e.meta??null};case"success":return{...s,data:e.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const r=e.error;return M2(r)&&r.revert&&J(this,pp)?{...J(this,pp),fetchStatus:"idle"}:{...s,error:r,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...e.state}}};this.state=n(this.state),hr.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),J(this,Ko).notify({query:this,type:"updated",action:e})})},dL);function YB(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:GB(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function zZ(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,s=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var hl,hL,WZ=(hL=class extends nm{constructor(e={}){super();Ft(this,hl);this.config=e,xt(this,hl,new Map)}build(e,n,s){const r=n.queryKey,i=n.queryHash??m_(r,n);let o=this.get(i);return o||(o=new VZ({cache:this,queryKey:r,queryHash:i,options:e.defaultQueryOptions(n),state:s,defaultOptions:e.getQueryDefaults(r)}),this.add(o)),o}add(e){J(this,hl).has(e.queryHash)||(J(this,hl).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=J(this,hl).get(e.queryHash);n&&(e.destroy(),n===e&&J(this,hl).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){hr.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return J(this,hl).get(e)}getAll(){return[...J(this,hl).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(s=>jA(n,s))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(s=>jA(e,s)):n}notify(e){hr.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){hr.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){hr.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},hl=new WeakMap,hL),fl,ci,Yd,pl,qc,fL,UZ=(fL=class extends XB{constructor(e){super();Ft(this,pl);Ft(this,fl);Ft(this,ci);Ft(this,Yd);this.mutationId=e.mutationId,xt(this,ci,e.mutationCache),xt(this,fl,[]),this.state=e.state||QB(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){J(this,fl).includes(e)||(J(this,fl).push(e),this.clearGcTimeout(),J(this,ci).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){xt(this,fl,J(this,fl).filter(n=>n!==e)),this.scheduleGc(),J(this,ci).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){J(this,fl).length||(this.state.status==="pending"?this.scheduleGc():J(this,ci).remove(this))}continue(){var e;return((e=J(this,Yd))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var r,i,o,a,l,c,d,h,f,p,m,g,x,y,v,S,C,k,T,_;xt(this,Yd,qB({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:($,R)=>{un(this,pl,qc).call(this,{type:"failed",failureCount:$,error:R})},onPause:()=>{un(this,pl,qc).call(this,{type:"pause"})},onContinue:()=>{un(this,pl,qc).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>J(this,ci).canRun(this)}));const n=this.state.status==="pending",s=!J(this,Yd).canStart();try{if(!n){un(this,pl,qc).call(this,{type:"pending",variables:e,isPaused:s}),await((i=(r=J(this,ci).config).onMutate)==null?void 0:i.call(r,e,this));const R=await((a=(o=this.options).onMutate)==null?void 0:a.call(o,e));R!==this.state.context&&un(this,pl,qc).call(this,{type:"pending",context:R,variables:e,isPaused:s})}const $=await J(this,Yd).start();return await((c=(l=J(this,ci).config).onSuccess)==null?void 0:c.call(l,$,e,this.state.context,this)),await((h=(d=this.options).onSuccess)==null?void 0:h.call(d,$,e,this.state.context)),await((p=(f=J(this,ci).config).onSettled)==null?void 0:p.call(f,$,null,this.state.variables,this.state.context,this)),await((g=(m=this.options).onSettled)==null?void 0:g.call(m,$,null,e,this.state.context)),un(this,pl,qc).call(this,{type:"success",data:$}),$}catch($){try{throw await((y=(x=J(this,ci).config).onError)==null?void 0:y.call(x,$,e,this.state.context,this)),await((S=(v=this.options).onError)==null?void 0:S.call(v,$,e,this.state.context)),await((k=(C=J(this,ci).config).onSettled)==null?void 0:k.call(C,void 0,$,this.state.variables,this.state.context,this)),await((_=(T=this.options).onSettled)==null?void 0:_.call(T,void 0,$,e,this.state.context)),$}finally{un(this,pl,qc).call(this,{type:"error",error:$})}}finally{J(this,ci).runNext(this)}}},fl=new WeakMap,ci=new WeakMap,Yd=new WeakMap,pl=new WeakSet,qc=function(e){const n=s=>{switch(e.type){case"failed":return{...s,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...s,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:e.error,failureCount:s.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),hr.batch(()=>{J(this,fl).forEach(s=>{s.onMutationUpdate(e)}),J(this,ci).notify({mutation:this,type:"updated",action:e})})},fL);function QB(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var io,dx,pL,HZ=(pL=class extends nm{constructor(e={}){super();Ft(this,io);Ft(this,dx);this.config=e,xt(this,io,new Map),xt(this,dx,Date.now())}build(e,n,s){const r=new UZ({mutationCache:this,mutationId:++sy(this,dx)._,options:e.defaultMutationOptions(n),state:s});return this.add(r),r}add(e){const n=wy(e),s=J(this,io).get(n)??[];s.push(e),J(this,io).set(n,s),this.notify({type:"added",mutation:e})}remove(e){var s;const n=wy(e);if(J(this,io).has(n)){const r=(s=J(this,io).get(n))==null?void 0:s.filter(i=>i!==e);r&&(r.length===0?J(this,io).delete(n):J(this,io).set(n,r))}this.notify({type:"removed",mutation:e})}canRun(e){var s;const n=(s=J(this,io).get(wy(e)))==null?void 0:s.find(r=>r.state.status==="pending");return!n||n===e}runNext(e){var s;const n=(s=J(this,io).get(wy(e)))==null?void 0:s.find(r=>r!==e&&r.state.isPaused);return(n==null?void 0:n.continue())??Promise.resolve()}clear(){hr.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...J(this,io).values()].flat()}find(e){const n={exact:!0,...e};return this.getAll().find(s=>DA(n,s))}findAll(e={}){return this.getAll().filter(n=>DA(e,n))}notify(e){hr.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return hr.batch(()=>Promise.all(e.map(n=>n.continue().catch(qo))))}},io=new WeakMap,dx=new WeakMap,pL);function wy(t){var e;return((e=t.options.scope)==null?void 0:e.id)??String(t.mutationId)}function MA(t){return{onFetch:(e,n)=>{var d,h,f,p,m;const s=e.options,r=(f=(h=(d=e.fetchOptions)==null?void 0:d.meta)==null?void 0:h.fetchMore)==null?void 0:f.direction,i=((p=e.state.data)==null?void 0:p.pages)||[],o=((m=e.state.data)==null?void 0:m.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let g=!1;const x=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},y=HB(e.options,e.fetchOptions),v=async(S,C,k)=>{if(g)return Promise.reject();if(C==null&&S.pages.length)return Promise.resolve(S);const T={queryKey:e.queryKey,pageParam:C,direction:k?"backward":"forward",meta:e.options.meta};x(T);const _=await y(T),{maxPages:$}=e.options,R=k?OZ:DZ;return{pages:R(S.pages,_,$),pageParams:R(S.pageParams,C,$)}};if(r&&i.length){const S=r==="backward",C=S?GZ:LA,k={pages:i,pageParams:o},T=C(s,k);a=await v(k,T,S)}else{const S=t??i.length;do{const C=l===0?o[0]??s.initialPageParam:LA(s,a);if(l>0&&C==null)break;a=await v(a,C),l++}while(l<S)}return a};e.options.persister?e.fetchFn=()=>{var g,x;return(x=(g=e.options).persister)==null?void 0:x.call(g,c,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=c}}}function LA(t,{pages:e,pageParams:n}){const s=e.length-1;return e.length>0?t.getNextPageParam(e[s],e,n[s],n):void 0}function GZ(t,{pages:e,pageParams:n}){var s;return e.length>0?(s=t.getPreviousPageParam)==null?void 0:s.call(t,e[0],e,n[0],n):void 0}var Us,cu,uu,mp,gp,du,xp,yp,mL,ZB=(mL=class{constructor(t={}){Ft(this,Us);Ft(this,cu);Ft(this,uu);Ft(this,mp);Ft(this,gp);Ft(this,du);Ft(this,xp);Ft(this,yp);xt(this,Us,t.queryCache||new WZ),xt(this,cu,t.mutationCache||new HZ),xt(this,uu,t.defaultOptions||{}),xt(this,mp,new Map),xt(this,gp,new Map),xt(this,du,0)}mount(){sy(this,du)._++,J(this,du)===1&&(xt(this,xp,x_.subscribe(async t=>{t&&(await this.resumePausedMutations(),J(this,Us).onFocus())})),xt(this,yp,xb.subscribe(async t=>{t&&(await this.resumePausedMutations(),J(this,Us).onOnline())})))}unmount(){var t,e;sy(this,du)._--,J(this,du)===0&&((t=J(this,xp))==null||t.call(this),xt(this,xp,void 0),(e=J(this,yp))==null||e.call(this),xt(this,yp,void 0))}isFetching(t){return J(this,Us).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return J(this,cu).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=J(this,Us).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.getQueryData(t.queryKey);if(e===void 0)return this.fetchQuery(t);{const n=this.defaultQueryOptions(t),s=J(this,Us).build(this,n);return t.revalidateIfStale&&s.isStaleByTime(Jf(n.staleTime,s))&&this.prefetchQuery(n),Promise.resolve(e)}}getQueriesData(t){return J(this,Us).findAll(t).map(({queryKey:e,state:n})=>{const s=n.data;return[e,s]})}setQueryData(t,e,n){const s=this.defaultQueryOptions({queryKey:t}),r=J(this,Us).get(s.queryHash),i=r==null?void 0:r.state.data,o=AZ(e,i);if(o!==void 0)return J(this,Us).build(this,s).setData(o,{...n,manual:!0})}setQueriesData(t,e,n){return hr.batch(()=>J(this,Us).findAll(t).map(({queryKey:s})=>[s,this.setQueryData(s,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=J(this,Us).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=J(this,Us);hr.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=J(this,Us),s={type:"active",...t};return hr.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries(s,e)))}cancelQueries(t={},e={}){const n={revert:!0,...e},s=hr.batch(()=>J(this,Us).findAll(t).map(r=>r.cancel(n)));return Promise.all(s).then(qo).catch(qo)}invalidateQueries(t={},e={}){return hr.batch(()=>{if(J(this,Us).findAll(t).forEach(s=>{s.invalidate()}),t.refetchType==="none")return Promise.resolve();const n={...t,type:t.refetchType??t.type??"active"};return this.refetchQueries(n,e)})}refetchQueries(t={},e){const n={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},s=hr.batch(()=>J(this,Us).findAll(t).filter(r=>!r.isDisabled()).map(r=>{let i=r.fetch(void 0,n);return n.throwOnError||(i=i.catch(qo)),r.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(s).then(qo)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=J(this,Us).build(this,e);return n.isStaleByTime(Jf(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(qo).catch(qo)}fetchInfiniteQuery(t){return t.behavior=MA(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(qo).catch(qo)}ensureInfiniteQueryData(t){return t.behavior=MA(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return xb.isOnline()?J(this,cu).resumePausedMutations():Promise.resolve()}getQueryCache(){return J(this,Us)}getMutationCache(){return J(this,cu)}getDefaultOptions(){return J(this,uu)}setDefaultOptions(t){xt(this,uu,t)}setQueryDefaults(t,e){J(this,mp).set(ph(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...J(this,mp).values()];let n={};return e.forEach(s=>{m0(t,s.queryKey)&&(n={...n,...s.defaultOptions})}),n}setMutationDefaults(t,e){J(this,gp).set(ph(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...J(this,gp).values()];let n={};return e.forEach(s=>{m0(t,s.mutationKey)&&(n={...n,...s.defaultOptions})}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...J(this,uu).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=m_(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===g_&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...J(this,uu).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){J(this,Us).clear(),J(this,cu).clear()}},Us=new WeakMap,cu=new WeakMap,uu=new WeakMap,mp=new WeakMap,gp=new WeakMap,du=new WeakMap,xp=new WeakMap,yp=new WeakMap,mL),Oi,Nn,hx,ui,Qd,vp,hu,ml,fx,bp,wp,Zd,Jd,fu,Sp,Hn,og,rk,ik,ok,ak,lk,ck,uk,JB,gL,KZ=(gL=class extends nm{constructor(e,n){super();Ft(this,Hn);Ft(this,Oi);Ft(this,Nn);Ft(this,hx);Ft(this,ui);Ft(this,Qd);Ft(this,vp);Ft(this,hu);Ft(this,ml);Ft(this,fx);Ft(this,bp);Ft(this,wp);Ft(this,Zd);Ft(this,Jd);Ft(this,fu);Ft(this,Sp,new Set);this.options=n,xt(this,Oi,e),xt(this,ml,null),xt(this,hu,sk()),this.options.experimental_prefetchInRender||J(this,hu).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(J(this,Nn).addObserver(this),BA(J(this,Nn),this.options)?un(this,Hn,og).call(this):this.updateResult(),un(this,Hn,ak).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return dk(J(this,Nn),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return dk(J(this,Nn),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,un(this,Hn,lk).call(this),un(this,Hn,ck).call(this),J(this,Nn).removeObserver(this)}setOptions(e,n){const s=this.options,r=J(this,Nn);if(this.options=J(this,Oi).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ra(this.options.enabled,J(this,Nn))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");un(this,Hn,uk).call(this),J(this,Nn).setOptions(this.options),s._defaulted&&!gb(this.options,s)&&J(this,Oi).getQueryCache().notify({type:"observerOptionsUpdated",query:J(this,Nn),observer:this});const i=this.hasListeners();i&&VA(J(this,Nn),r,this.options,s)&&un(this,Hn,og).call(this),this.updateResult(n),i&&(J(this,Nn)!==r||Ra(this.options.enabled,J(this,Nn))!==Ra(s.enabled,J(this,Nn))||Jf(this.options.staleTime,J(this,Nn))!==Jf(s.staleTime,J(this,Nn)))&&un(this,Hn,rk).call(this);const o=un(this,Hn,ik).call(this);i&&(J(this,Nn)!==r||Ra(this.options.enabled,J(this,Nn))!==Ra(s.enabled,J(this,Nn))||o!==J(this,fu))&&un(this,Hn,ok).call(this,o)}getOptimisticResult(e){const n=J(this,Oi).getQueryCache().build(J(this,Oi),e),s=this.createResult(n,e);return XZ(this,s)&&(xt(this,ui,s),xt(this,vp,this.options),xt(this,Qd,J(this,Nn).state)),s}getCurrentResult(){return J(this,ui)}trackResult(e,n){const s={};return Object.keys(e).forEach(r=>{Object.defineProperty(s,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),n==null||n(r),e[r])})}),s}trackProp(e){J(this,Sp).add(e)}getCurrentQuery(){return J(this,Nn)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const n=J(this,Oi).defaultQueryOptions(e),s=J(this,Oi).getQueryCache().build(J(this,Oi),n);return s.fetch().then(()=>this.createResult(s,n))}fetch(e){return un(this,Hn,og).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),J(this,ui)))}createResult(e,n){var $;const s=J(this,Nn),r=this.options,i=J(this,ui),o=J(this,Qd),a=J(this,vp),c=e!==s?e.state:J(this,hx),{state:d}=e;let h={...d},f=!1,p;if(n._optimisticResults){const R=this.hasListeners(),A=!R&&BA(e,n),j=R&&VA(e,s,n,r);(A||j)&&(h={...h,...YB(d.data,e.options)}),n._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:m,errorUpdatedAt:g,status:x}=h;if(n.select&&h.data!==void 0)if(i&&h.data===(o==null?void 0:o.data)&&n.select===J(this,fx))p=J(this,bp);else try{xt(this,fx,n.select),p=n.select(h.data),p=nk(i==null?void 0:i.data,p,n),xt(this,bp,p),xt(this,ml,null)}catch(R){xt(this,ml,R)}else p=h.data;if(n.placeholderData!==void 0&&p===void 0&&x==="pending"){let R;if(i!=null&&i.isPlaceholderData&&n.placeholderData===(a==null?void 0:a.placeholderData))R=i.data;else if(R=typeof n.placeholderData=="function"?n.placeholderData(($=J(this,wp))==null?void 0:$.state.data,J(this,wp)):n.placeholderData,n.select&&R!==void 0)try{R=n.select(R),xt(this,ml,null)}catch(A){xt(this,ml,A)}R!==void 0&&(x="success",p=nk(i==null?void 0:i.data,R,n),f=!0)}J(this,ml)&&(m=J(this,ml),p=J(this,bp),g=Date.now(),x="error");const y=h.fetchStatus==="fetching",v=x==="pending",S=x==="error",C=v&&y,k=p!==void 0,_={status:x,fetchStatus:h.fetchStatus,isPending:v,isSuccess:x==="success",isError:S,isInitialLoading:C,isLoading:C,data:p,dataUpdatedAt:h.dataUpdatedAt,error:m,errorUpdatedAt:g,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>c.dataUpdateCount||h.errorUpdateCount>c.errorUpdateCount,isFetching:y,isRefetching:y&&!v,isLoadingError:S&&!k,isPaused:h.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:S&&k,isStale:y_(e,n),refetch:this.refetch,promise:J(this,hu)};if(this.options.experimental_prefetchInRender){const R=F=>{_.status==="error"?F.reject(_.error):_.data!==void 0&&F.resolve(_.data)},A=()=>{const F=xt(this,hu,_.promise=sk());R(F)},j=J(this,hu);switch(j.status){case"pending":e.queryHash===s.queryHash&&R(j);break;case"fulfilled":(_.status==="error"||_.data!==j.value)&&A();break;case"rejected":(_.status!=="error"||_.error!==j.reason)&&A();break}}return _}updateResult(e){const n=J(this,ui),s=this.createResult(J(this,Nn),this.options);if(xt(this,Qd,J(this,Nn).state),xt(this,vp,this.options),J(this,Qd).data!==void 0&&xt(this,wp,J(this,Nn)),gb(s,n))return;xt(this,ui,s);const r={},i=()=>{if(!n)return!0;const{notifyOnChangeProps:o}=this.options,a=typeof o=="function"?o():o;if(a==="all"||!a&&!J(this,Sp).size)return!0;const l=new Set(a??J(this,Sp));return this.options.throwOnError&&l.add("error"),Object.keys(J(this,ui)).some(c=>{const d=c;return J(this,ui)[d]!==n[d]&&l.has(d)})};(e==null?void 0:e.listeners)!==!1&&i()&&(r.listeners=!0),un(this,Hn,JB).call(this,{...r,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&un(this,Hn,ak).call(this)}},Oi=new WeakMap,Nn=new WeakMap,hx=new WeakMap,ui=new WeakMap,Qd=new WeakMap,vp=new WeakMap,hu=new WeakMap,ml=new WeakMap,fx=new WeakMap,bp=new WeakMap,wp=new WeakMap,Zd=new WeakMap,Jd=new WeakMap,fu=new WeakMap,Sp=new WeakMap,Hn=new WeakSet,og=function(e){un(this,Hn,uk).call(this);let n=J(this,Nn).fetch(this.options,e);return e!=null&&e.throwOnError||(n=n.catch(qo)),n},rk=function(){un(this,Hn,lk).call(this);const e=Jf(this.options.staleTime,J(this,Nn));if(fh||J(this,ui).isStale||!ek(e))return;const s=WB(J(this,ui).dataUpdatedAt,e)+1;xt(this,Zd,setTimeout(()=>{J(this,ui).isStale||this.updateResult()},s))},ik=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(J(this,Nn)):this.options.refetchInterval)??!1},ok=function(e){un(this,Hn,ck).call(this),xt(this,fu,e),!(fh||Ra(this.options.enabled,J(this,Nn))===!1||!ek(J(this,fu))||J(this,fu)===0)&&xt(this,Jd,setInterval(()=>{(this.options.refetchIntervalInBackground||x_.isFocused())&&un(this,Hn,og).call(this)},J(this,fu)))},ak=function(){un(this,Hn,rk).call(this),un(this,Hn,ok).call(this,un(this,Hn,ik).call(this))},lk=function(){J(this,Zd)&&(clearTimeout(J(this,Zd)),xt(this,Zd,void 0))},ck=function(){J(this,Jd)&&(clearInterval(J(this,Jd)),xt(this,Jd,void 0))},uk=function(){const e=J(this,Oi).getQueryCache().build(J(this,Oi),this.options);if(e===J(this,Nn))return;const n=J(this,Nn);xt(this,Nn,e),xt(this,hx,e.state),this.hasListeners()&&(n==null||n.removeObserver(this),e.addObserver(this))},JB=function(e){hr.batch(()=>{e.listeners&&this.listeners.forEach(n=>{n(J(this,ui))}),J(this,Oi).getQueryCache().notify({query:J(this,Nn),type:"observerResultsUpdated"})})},gL);function qZ(t,e){return Ra(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function BA(t,e){return qZ(t,e)||t.state.data!==void 0&&dk(t,e,e.refetchOnMount)}function dk(t,e,n){if(Ra(e.enabled,t)!==!1){const s=typeof n=="function"?n(t):n;return s==="always"||s!==!1&&y_(t,e)}return!1}function VA(t,e,n,s){return(t!==e||Ra(s.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&y_(t,n)}function y_(t,e){return Ra(e.enabled,t)!==!1&&t.isStaleByTime(Jf(e.staleTime,t))}function XZ(t,e){return!gb(t.getCurrentResult(),e)}var pu,mu,Fi,ac,xc,bv,hk,xL,YZ=(xL=class extends nm{constructor(n,s){super();Ft(this,xc);Ft(this,pu);Ft(this,mu);Ft(this,Fi);Ft(this,ac);xt(this,pu,n),this.setOptions(s),this.bindMethods(),un(this,xc,bv).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var r;const s=this.options;this.options=J(this,pu).defaultMutationOptions(n),gb(this.options,s)||J(this,pu).getMutationCache().notify({type:"observerOptionsUpdated",mutation:J(this,Fi),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&ph(s.mutationKey)!==ph(this.options.mutationKey)?this.reset():((r=J(this,Fi))==null?void 0:r.state.status)==="pending"&&J(this,Fi).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=J(this,Fi))==null||n.removeObserver(this)}onMutationUpdate(n){un(this,xc,bv).call(this),un(this,xc,hk).call(this,n)}getCurrentResult(){return J(this,mu)}reset(){var n;(n=J(this,Fi))==null||n.removeObserver(this),xt(this,Fi,void 0),un(this,xc,bv).call(this),un(this,xc,hk).call(this)}mutate(n,s){var r;return xt(this,ac,s),(r=J(this,Fi))==null||r.removeObserver(this),xt(this,Fi,J(this,pu).getMutationCache().build(J(this,pu),this.options)),J(this,Fi).addObserver(this),J(this,Fi).execute(n)}},pu=new WeakMap,mu=new WeakMap,Fi=new WeakMap,ac=new WeakMap,xc=new WeakSet,bv=function(){var s;const n=((s=J(this,Fi))==null?void 0:s.state)??QB();xt(this,mu,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},hk=function(n){hr.batch(()=>{var s,r,i,o,a,l,c,d;if(J(this,ac)&&this.hasListeners()){const h=J(this,mu).variables,f=J(this,mu).context;(n==null?void 0:n.type)==="success"?((r=(s=J(this,ac)).onSuccess)==null||r.call(s,n.data,h,f),(o=(i=J(this,ac)).onSettled)==null||o.call(i,n.data,null,h,f)):(n==null?void 0:n.type)==="error"&&((l=(a=J(this,ac)).onError)==null||l.call(a,n.error,h,f),(d=(c=J(this,ac)).onSettled)==null||d.call(c,void 0,n.error,h,f))}this.listeners.forEach(h=>{h(J(this,mu))})})},xL),eV=b.createContext(void 0),Yw=t=>{const e=b.useContext(eV);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},tV=({client:t,children:e})=>(b.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),u.jsx(eV.Provider,{value:t,children:e})),nV=b.createContext(!1),QZ=()=>b.useContext(nV);nV.Provider;function ZZ(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var JZ=b.createContext(ZZ()),eJ=()=>b.useContext(JZ);function sV(t,e){return typeof t=="function"?t(...e):!!t}function fk(){}var tJ=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},nJ=t=>{b.useEffect(()=>{t.clearReset()},[t])},sJ=({result:t,errorResetBoundary:e,throwOnError:n,query:s})=>t.isError&&!e.isReset()&&!t.isFetching&&s&&sV(n,[t.error,s]),rJ=t=>{t.suspense&&(t.staleTime===void 0&&(t.staleTime=1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},iJ=(t,e)=>t.isLoading&&t.isFetching&&!e,oJ=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,zA=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function aJ(t,e,n){var d,h,f,p,m;const s=Yw(),r=QZ(),i=eJ(),o=s.defaultQueryOptions(t);(h=(d=s.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||h.call(d,o),o._optimisticResults=r?"isRestoring":"optimistic",rJ(o),tJ(o,i),nJ(i);const a=!s.getQueryCache().get(o.queryHash),[l]=b.useState(()=>new e(s,o)),c=l.getOptimisticResult(o);if(b.useSyncExternalStore(b.useCallback(g=>{const x=r?fk:l.subscribe(hr.batchCalls(g));return l.updateResult(),x},[l,r]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),b.useEffect(()=>{l.setOptions(o,{listeners:!1})},[o,l]),oJ(o,c))throw zA(o,l,i);if(sJ({result:c,errorResetBoundary:i,throwOnError:o.throwOnError,query:s.getQueryCache().get(o.queryHash)}))throw c.error;if((p=(f=s.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||p.call(f,o,c),o.experimental_prefetchInRender&&!fh&&iJ(c,r)){const g=a?zA(o,l,i):(m=s.getQueryCache().get(o.queryHash))==null?void 0:m.promise;g==null||g.catch(fk).finally(()=>{l.updateResult()})}return o.notifyOnChangeProps?c:l.trackResult(c)}function sm(t,e){return aJ(t,KZ)}function za(t,e){const n=Yw(),[s]=b.useState(()=>new YZ(n,t));b.useEffect(()=>{s.setOptions(t)},[s,t]);const r=b.useSyncExternalStore(b.useCallback(o=>s.subscribe(hr.batchCalls(o)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),i=b.useCallback((o,a)=>{s.mutate(o,a).catch(fk)},[s]);if(r.error&&sV(s.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:i,mutateAsync:r.mutate}}async function rV(t){if(!t.ok){const e=await t.text()||t.statusText;throw new Error(`${t.status}: ${e}`)}}async function aa(t,e,n){const s=await fetch(e,{method:t,headers:n?{"Content-Type":"application/json"}:{},body:n?JSON.stringify(n):void 0,credentials:"include"});return await rV(s),s}const lJ=({on401:t})=>async({queryKey:e})=>{const n=await fetch(e[0],{credentials:"include"});return t==="returnNull"&&n.status===401?null:(await rV(n),await n.json())},wv=new ZB({defaultOptions:{queries:{queryFn:lJ({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),cJ=1,uJ=1e6;let L2=0;function dJ(){return L2=(L2+1)%Number.MAX_SAFE_INTEGER,L2.toString()}const B2=new Map,WA=t=>{if(B2.has(t))return;const e=setTimeout(()=>{B2.delete(t),Ag({type:"REMOVE_TOAST",toastId:t})},uJ);B2.set(t,e)},hJ=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,cJ)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?WA(n):t.toasts.forEach(s=>{WA(s.id)}),{...t,toasts:t.toasts.map(s=>s.id===n||n===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==e.toastId)}}},Sv=[];let Cv={toasts:[]};function Ag(t){Cv=hJ(Cv,t),Sv.forEach(e=>{e(Cv)})}function fJ({...t}){const e=dJ(),n=r=>Ag({type:"UPDATE_TOAST",toast:{...r,id:e}}),s=()=>Ag({type:"DISMISS_TOAST",toastId:e});return Ag({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:r=>{r||s()}}}),{id:e,dismiss:s,update:n}}function Qw(){const[t,e]=b.useState(Cv);return b.useEffect(()=>(Sv.push(e),()=>{const n=Sv.indexOf(e);n>-1&&Sv.splice(n,1)}),[t]),{...t,toast:fJ,dismiss:n=>Ag({type:"DISMISS_TOAST",toastId:n})}}function nt(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function UA(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Zw(...t){return e=>{let n=!1;const s=t.map(r=>{const i=UA(r,e);return!n&&typeof i=="function"&&(n=!0),i});if(n)return()=>{for(let r=0;r<s.length;r++){const i=s[r];typeof i=="function"?i():UA(t[r],null)}}}}function Pn(...t){return b.useCallback(Zw(...t),t)}function pJ(t,e){const n=b.createContext(e),s=i=>{const{children:o,...a}=i,l=b.useMemo(()=>a,Object.values(a));return u.jsx(n.Provider,{value:l,children:o})};s.displayName=t+"Provider";function r(i){const o=b.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${t}\``)}return[s,r]}function Ao(t,e=[]){let n=[];function s(i,o){const a=b.createContext(o),l=n.length;n=[...n,o];const c=h=>{var y;const{scope:f,children:p,...m}=h,g=((y=f==null?void 0:f[t])==null?void 0:y[l])||a,x=b.useMemo(()=>m,Object.values(m));return u.jsx(g.Provider,{value:x,children:p})};c.displayName=i+"Provider";function d(h,f){var g;const p=((g=f==null?void 0:f[t])==null?void 0:g[l])||a,m=b.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[c,d]}const r=()=>{const i=n.map(o=>b.createContext(o));return function(a){const l=(a==null?void 0:a[t])||i;return b.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return r.scopeName=t,[s,mJ(r,...e)]}function mJ(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const s=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(i){const o=s.reduce((a,{useScope:l,scopeName:c})=>{const h=l(i)[`__scope${c}`];return{...a,...h}},{});return b.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function mh(t){const e=gJ(t),n=b.forwardRef((s,r)=>{const{children:i,...o}=s,a=b.Children.toArray(i),l=a.find(yJ);if(l){const c=l.props.children,d=a.map(h=>h===l?b.Children.count(c)>1?b.Children.only(null):b.isValidElement(c)?c.props.children:null:h);return u.jsx(e,{...o,ref:r,children:b.isValidElement(c)?b.cloneElement(c,void 0,d):null})}return u.jsx(e,{...o,ref:r,children:i})});return n.displayName=`${t}.Slot`,n}var iV=mh("Slot");function gJ(t){const e=b.forwardRef((n,s)=>{const{children:r,...i}=n;if(b.isValidElement(r)){const o=bJ(r),a=vJ(i,r.props);return r.type!==b.Fragment&&(a.ref=s?Zw(s,o):o),b.cloneElement(r,a)}return b.Children.count(r)>1?b.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var oV=Symbol("radix.slottable");function xJ(t){const e=({children:n})=>u.jsx(u.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=oV,e}function yJ(t){return b.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===oV}function vJ(t,e){const n={...e};for(const s in e){const r=t[s],i=e[s];/^on[A-Z]/.test(s)?r&&i?n[s]=(...a)=>{i(...a),r(...a)}:r&&(n[s]=r):s==="style"?n[s]={...r,...i}:s==="className"&&(n[s]=[r,i].filter(Boolean).join(" "))}return{...t,...n}}function bJ(t){var s,r;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Jw(t){const e=t+"CollectionProvider",[n,s]=Ao(e),[r,i]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=g=>{const{scope:x,children:y}=g,v=zt.useRef(null),S=zt.useRef(new Map).current;return u.jsx(r,{scope:x,itemMap:S,collectionRef:v,children:y})};o.displayName=e;const a=t+"CollectionSlot",l=mh(a),c=zt.forwardRef((g,x)=>{const{scope:y,children:v}=g,S=i(a,y),C=Pn(x,S.collectionRef);return u.jsx(l,{ref:C,children:v})});c.displayName=a;const d=t+"CollectionItemSlot",h="data-radix-collection-item",f=mh(d),p=zt.forwardRef((g,x)=>{const{scope:y,children:v,...S}=g,C=zt.useRef(null),k=Pn(x,C),T=i(d,y);return zt.useEffect(()=>(T.itemMap.set(C,{ref:C,...S}),()=>void T.itemMap.delete(C))),u.jsx(f,{[h]:"",ref:k,children:v})});p.displayName=d;function m(g){const x=i(t+"CollectionConsumer",g);return zt.useCallback(()=>{const v=x.collectionRef.current;if(!v)return[];const S=Array.from(v.querySelectorAll(`[${h}]`));return Array.from(x.itemMap.values()).sort((T,_)=>S.indexOf(T.ref.current)-S.indexOf(_.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:o,Slot:c,ItemSlot:p},m,s]}var wJ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Mt=wJ.reduce((t,e)=>{const n=mh(`Primitive.${e}`),s=b.forwardRef((r,i)=>{const{asChild:o,...a}=r,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(l,{...a,ref:i})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function v_(t,e){t&&Fh.flushSync(()=>t.dispatchEvent(e))}function ei(t){const e=b.useRef(t);return b.useEffect(()=>{e.current=t}),b.useMemo(()=>(...n)=>{var s;return(s=e.current)==null?void 0:s.call(e,...n)},[])}function SJ(t,e=globalThis==null?void 0:globalThis.document){const n=ei(t);b.useEffect(()=>{const s=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[n,e])}var CJ="DismissableLayer",pk="dismissableLayer.update",kJ="dismissableLayer.pointerDownOutside",NJ="dismissableLayer.focusOutside",HA,aV=b.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rm=b.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:r,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=t,c=b.useContext(aV),[d,h]=b.useState(null),f=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=b.useState({}),m=Pn(e,_=>h(_)),g=Array.from(c.layers),[x]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(x),v=d?g.indexOf(d):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,C=v>=y,k=_J(_=>{const $=_.target,R=[...c.branches].some(A=>A.contains($));!C||R||(r==null||r(_),o==null||o(_),_.defaultPrevented||a==null||a())},f),T=EJ(_=>{const $=_.target;[...c.branches].some(A=>A.contains($))||(i==null||i(_),o==null||o(_),_.defaultPrevented||a==null||a())},f);return SJ(_=>{v===c.layers.size-1&&(s==null||s(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},f),b.useEffect(()=>{if(d)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(HA=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),GA(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=HA)}},[d,f,n,c]),b.useEffect(()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),GA())},[d,c]),b.useEffect(()=>{const _=()=>p({});return document.addEventListener(pk,_),()=>document.removeEventListener(pk,_)},[]),u.jsx(Mt.div,{...l,ref:m,style:{pointerEvents:S?C?"auto":"none":void 0,...t.style},onFocusCapture:nt(t.onFocusCapture,T.onFocusCapture),onBlurCapture:nt(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:nt(t.onPointerDownCapture,k.onPointerDownCapture)})});rm.displayName=CJ;var TJ="DismissableLayerBranch",lV=b.forwardRef((t,e)=>{const n=b.useContext(aV),s=b.useRef(null),r=Pn(e,s);return b.useEffect(()=>{const i=s.current;if(i)return n.branches.add(i),()=>{n.branches.delete(i)}},[n.branches]),u.jsx(Mt.div,{...t,ref:r})});lV.displayName=TJ;function _J(t,e=globalThis==null?void 0:globalThis.document){const n=ei(t),s=b.useRef(!1),r=b.useRef(()=>{});return b.useEffect(()=>{const i=a=>{if(a.target&&!s.current){let l=function(){cV(kJ,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>s.current=!0}}function EJ(t,e=globalThis==null?void 0:globalThis.document){const n=ei(t),s=b.useRef(!1);return b.useEffect(()=>{const r=i=>{i.target&&!s.current&&cV(NJ,n,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function GA(){const t=new CustomEvent(pk);document.dispatchEvent(t)}function cV(t,e,n,{discrete:s}){const r=n.originalEvent.target,i=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),s?v_(r,i):r.dispatchEvent(i)}var $J=rm,IJ=lV,ti=globalThis!=null&&globalThis.document?b.useLayoutEffect:()=>{},RJ="Portal",bx=b.forwardRef((t,e)=>{var a;const{container:n,...s}=t,[r,i]=b.useState(!1);ti(()=>i(!0),[]);const o=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?nZ.createPortal(u.jsx(Mt.div,{...s,ref:e}),o):null});bx.displayName=RJ;function PJ(t,e){return b.useReducer((n,s)=>e[n][s]??n,t)}var jo=t=>{const{present:e,children:n}=t,s=AJ(e),r=typeof n=="function"?n({present:s.isPresent}):b.Children.only(n),i=Pn(s.ref,jJ(r));return typeof n=="function"||s.isPresent?b.cloneElement(r,{ref:i}):null};jo.displayName="Presence";function AJ(t){const[e,n]=b.useState(),s=b.useRef({}),r=b.useRef(t),i=b.useRef("none"),o=t?"mounted":"unmounted",[a,l]=PJ(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return b.useEffect(()=>{const c=Sy(s.current);i.current=a==="mounted"?c:"none"},[a]),ti(()=>{const c=s.current,d=r.current;if(d!==t){const f=i.current,p=Sy(c);t?l("MOUNT"):p==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(d&&f!==p?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,l]),ti(()=>{if(e){let c;const d=e.ownerDocument.defaultView??window,h=p=>{const g=Sy(s.current).includes(p.animationName);if(p.target===e&&g&&(l("ANIMATION_END"),!r.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",c=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},f=p=>{p.target===e&&(i.current=Sy(s.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:b.useCallback(c=>{c&&(s.current=getComputedStyle(c)),n(c)},[])}}function Sy(t){return(t==null?void 0:t.animationName)||"none"}function jJ(t){var s,r;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Sc({prop:t,defaultProp:e,onChange:n=()=>{}}){const[s,r]=DJ({defaultProp:e,onChange:n}),i=t!==void 0,o=i?t:s,a=ei(n),l=b.useCallback(c=>{if(i){const h=typeof c=="function"?c(t):c;h!==t&&a(h)}else r(c)},[i,t,r,a]);return[o,l]}function DJ({defaultProp:t,onChange:e}){const n=b.useState(t),[s]=n,r=b.useRef(s),i=ei(e);return b.useEffect(()=>{r.current!==s&&(i(s),r.current=s)},[s,r,i]),n}var OJ="VisuallyHidden",wx=b.forwardRef((t,e)=>u.jsx(Mt.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));wx.displayName=OJ;var FJ=wx,b_="ToastProvider",[w_,MJ,LJ]=Jw("Toast"),[uV,p9e]=Ao("Toast",[LJ]),[BJ,e1]=uV(b_),dV=t=>{const{__scopeToast:e,label:n="Notification",duration:s=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:o}=t,[a,l]=b.useState(null),[c,d]=b.useState(0),h=b.useRef(!1),f=b.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${b_}\`. Expected non-empty \`string\`.`),u.jsx(w_.Provider,{scope:e,children:u.jsx(BJ,{scope:e,label:n,duration:s,swipeDirection:r,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:b.useCallback(()=>d(p=>p+1),[]),onToastRemove:b.useCallback(()=>d(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:f,children:o})})};dV.displayName=b_;var hV="ToastViewport",VJ=["F8"],mk="toast.viewportPause",gk="toast.viewportResume",fV=b.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:s=VJ,label:r="Notifications ({hotkey})",...i}=t,o=e1(hV,n),a=MJ(n),l=b.useRef(null),c=b.useRef(null),d=b.useRef(null),h=b.useRef(null),f=Pn(e,h,o.onViewportChange),p=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),m=o.toastCount>0;b.useEffect(()=>{const x=y=>{var S;s.length!==0&&s.every(C=>y[C]||y.code===C)&&((S=h.current)==null||S.focus())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[s]),b.useEffect(()=>{const x=l.current,y=h.current;if(m&&x&&y){const v=()=>{if(!o.isClosePausedRef.current){const T=new CustomEvent(mk);y.dispatchEvent(T),o.isClosePausedRef.current=!0}},S=()=>{if(o.isClosePausedRef.current){const T=new CustomEvent(gk);y.dispatchEvent(T),o.isClosePausedRef.current=!1}},C=T=>{!x.contains(T.relatedTarget)&&S()},k=()=>{x.contains(document.activeElement)||S()};return x.addEventListener("focusin",v),x.addEventListener("focusout",C),x.addEventListener("pointermove",v),x.addEventListener("pointerleave",k),window.addEventListener("blur",v),window.addEventListener("focus",S),()=>{x.removeEventListener("focusin",v),x.removeEventListener("focusout",C),x.removeEventListener("pointermove",v),x.removeEventListener("pointerleave",k),window.removeEventListener("blur",v),window.removeEventListener("focus",S)}}},[m,o.isClosePausedRef]);const g=b.useCallback(({tabbingDirection:x})=>{const v=a().map(S=>{const C=S.ref.current,k=[C,...eee(C)];return x==="forwards"?k:k.reverse()});return(x==="forwards"?v.reverse():v).flat()},[a]);return b.useEffect(()=>{const x=h.current;if(x){const y=v=>{var k,T,_;const S=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!S){const $=document.activeElement,R=v.shiftKey;if(v.target===x&&R){(k=c.current)==null||k.focus();return}const F=g({tabbingDirection:R?"backwards":"forwards"}),L=F.findIndex(M=>M===$);V2(F.slice(L+1))?v.preventDefault():R?(T=c.current)==null||T.focus():(_=d.current)==null||_.focus()}};return x.addEventListener("keydown",y),()=>x.removeEventListener("keydown",y)}},[a,g]),u.jsxs(IJ,{ref:l,role:"region","aria-label":r.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:m?void 0:"none"},children:[m&&u.jsx(xk,{ref:c,onFocusFromOutsideViewport:()=>{const x=g({tabbingDirection:"forwards"});V2(x)}}),u.jsx(w_.Slot,{scope:n,children:u.jsx(Mt.ol,{tabIndex:-1,...i,ref:f})}),m&&u.jsx(xk,{ref:d,onFocusFromOutsideViewport:()=>{const x=g({tabbingDirection:"backwards"});V2(x)}})]})});fV.displayName=hV;var pV="ToastFocusProxy",xk=b.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:s,...r}=t,i=e1(pV,n);return u.jsx(wx,{"aria-hidden":!0,tabIndex:0,...r,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&s()}})});xk.displayName=pV;var t1="Toast",zJ="toast.swipeStart",WJ="toast.swipeMove",UJ="toast.swipeCancel",HJ="toast.swipeEnd",mV=b.forwardRef((t,e)=>{const{forceMount:n,open:s,defaultOpen:r,onOpenChange:i,...o}=t,[a=!0,l]=Sc({prop:s,defaultProp:r,onChange:i});return u.jsx(jo,{present:n||a,children:u.jsx(qJ,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:ei(t.onPause),onResume:ei(t.onResume),onSwipeStart:nt(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:nt(t.onSwipeMove,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:nt(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:nt(t.onSwipeEnd,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),l(!1)})})})});mV.displayName=t1;var[GJ,KJ]=uV(t1,{onClose(){}}),qJ=b.forwardRef((t,e)=>{const{__scopeToast:n,type:s="foreground",duration:r,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:f,onSwipeEnd:p,...m}=t,g=e1(t1,n),[x,y]=b.useState(null),v=Pn(e,M=>y(M)),S=b.useRef(null),C=b.useRef(null),k=r||g.duration,T=b.useRef(0),_=b.useRef(k),$=b.useRef(0),{onToastAdd:R,onToastRemove:A}=g,j=ei(()=>{var q;(x==null?void 0:x.contains(document.activeElement))&&((q=g.viewport)==null||q.focus()),o()}),F=b.useCallback(M=>{!M||M===1/0||(window.clearTimeout($.current),T.current=new Date().getTime(),$.current=window.setTimeout(j,M))},[j]);b.useEffect(()=>{const M=g.viewport;if(M){const q=()=>{F(_.current),c==null||c()},z=()=>{const re=new Date().getTime()-T.current;_.current=_.current-re,window.clearTimeout($.current),l==null||l()};return M.addEventListener(mk,z),M.addEventListener(gk,q),()=>{M.removeEventListener(mk,z),M.removeEventListener(gk,q)}}},[g.viewport,k,l,c,F]),b.useEffect(()=>{i&&!g.isClosePausedRef.current&&F(k)},[i,k,g.isClosePausedRef,F]),b.useEffect(()=>(R(),()=>A()),[R,A]);const L=b.useMemo(()=>x?SV(x):null,[x]);return g.viewport?u.jsxs(u.Fragment,{children:[L&&u.jsx(XJ,{__scopeToast:n,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:L}),u.jsx(GJ,{scope:n,onClose:j,children:Fh.createPortal(u.jsx(w_.ItemSlot,{scope:n,children:u.jsx($J,{asChild:!0,onEscapeKeyDown:nt(a,()=>{g.isFocusedToastEscapeKeyDownRef.current||j(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:u.jsx(Mt.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":g.swipeDirection,...m,ref:v,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:nt(t.onKeyDown,M=>{M.key==="Escape"&&(a==null||a(M.nativeEvent),M.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,j()))}),onPointerDown:nt(t.onPointerDown,M=>{M.button===0&&(S.current={x:M.clientX,y:M.clientY})}),onPointerMove:nt(t.onPointerMove,M=>{if(!S.current)return;const q=M.clientX-S.current.x,z=M.clientY-S.current.y,re=!!C.current,U=["left","right"].includes(g.swipeDirection),G=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,xe=U?G(0,q):0,Ce=U?0:G(0,z),De=M.pointerType==="touch"?10:2,fe={x:xe,y:Ce},ee={originalEvent:M,delta:fe};re?(C.current=fe,Cy(WJ,h,ee,{discrete:!1})):KA(fe,g.swipeDirection,De)?(C.current=fe,Cy(zJ,d,ee,{discrete:!1}),M.target.setPointerCapture(M.pointerId)):(Math.abs(q)>De||Math.abs(z)>De)&&(S.current=null)}),onPointerUp:nt(t.onPointerUp,M=>{const q=C.current,z=M.target;if(z.hasPointerCapture(M.pointerId)&&z.releasePointerCapture(M.pointerId),C.current=null,S.current=null,q){const re=M.currentTarget,U={originalEvent:M,delta:q};KA(q,g.swipeDirection,g.swipeThreshold)?Cy(HJ,p,U,{discrete:!0}):Cy(UJ,f,U,{discrete:!0}),re.addEventListener("click",G=>G.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),XJ=t=>{const{__scopeToast:e,children:n,...s}=t,r=e1(t1,e),[i,o]=b.useState(!1),[a,l]=b.useState(!1);return ZJ(()=>o(!0)),b.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:u.jsx(bx,{asChild:!0,children:u.jsx(wx,{...s,children:i&&u.jsxs(u.Fragment,{children:[r.label," ",n]})})})},YJ="ToastTitle",gV=b.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return u.jsx(Mt.div,{...s,ref:e})});gV.displayName=YJ;var QJ="ToastDescription",xV=b.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return u.jsx(Mt.div,{...s,ref:e})});xV.displayName=QJ;var yV="ToastAction",vV=b.forwardRef((t,e)=>{const{altText:n,...s}=t;return n.trim()?u.jsx(wV,{altText:n,asChild:!0,children:u.jsx(S_,{...s,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${yV}\`. Expected non-empty \`string\`.`),null)});vV.displayName=yV;var bV="ToastClose",S_=b.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t,r=KJ(bV,n);return u.jsx(wV,{asChild:!0,children:u.jsx(Mt.button,{type:"button",...s,ref:e,onClick:nt(t.onClick,r.onClose)})})});S_.displayName=bV;var wV=b.forwardRef((t,e)=>{const{__scopeToast:n,altText:s,...r}=t;return u.jsx(Mt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...r,ref:e})});function SV(t){const e=[];return Array.from(t.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&e.push(s.textContent),JJ(s)){const r=s.ariaHidden||s.hidden||s.style.display==="none",i=s.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=s.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...SV(s))}}),e}function Cy(t,e,n,{discrete:s}){const r=n.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),s?v_(r,i):r.dispatchEvent(i)}var KA=(t,e,n=0)=>{const s=Math.abs(t.x),r=Math.abs(t.y),i=s>r;return e==="left"||e==="right"?i&&s>n:!i&&r>n};function ZJ(t=()=>{}){const e=ei(t);ti(()=>{let n=0,s=0;return n=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(s)}},[e])}function JJ(t){return t.nodeType===t.ELEMENT_NODE}function eee(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function V2(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var tee=dV,CV=fV,kV=mV,NV=gV,TV=xV,_V=vV,EV=S_;function $V(t){var e,n,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=$V(t[e]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n);return s}function IV(){for(var t,e,n=0,s="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=$V(t))&&(s&&(s+=" "),s+=e);return s}const qA=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,XA=IV,Sx=(t,e)=>n=>{var s;if((e==null?void 0:e.variants)==null)return XA(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:r,defaultVariants:i}=e,o=Object.keys(r).map(c=>{const d=n==null?void 0:n[c],h=i==null?void 0:i[c];if(d===null)return null;const f=qA(d)||qA(h);return r[c][f]}),a=n&&Object.entries(n).reduce((c,d)=>{let[h,f]=d;return f===void 0||(c[h]=f),c},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((c,d)=>{let{class:h,className:f,...p}=d;return Object.entries(p).every(m=>{let[g,x]=m;return Array.isArray(x)?x.includes({...i,...a}[g]):{...i,...a}[g]===x})?[...c,h,f]:c},[]);return XA(t,o,l,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nee=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RV=(...t)=>t.filter((e,n,s)=>!!e&&s.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var see={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ree=b.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:o,...a},l)=>b.createElement("svg",{ref:l,...see,width:e,height:e,stroke:t,strokeWidth:s?Number(n)*24/Number(e):n,className:RV("lucide",r),...a},[...o.map(([c,d])=>b.createElement(c,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=(t,e)=>{const n=b.forwardRef(({className:s,...r},i)=>b.createElement(ree,{ref:i,iconNode:e,className:RV(`lucide-${nee(t)}`,s),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kv=kt("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iee=kt("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=kt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=kt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=kt("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cx=kt("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C_=kt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nv=kt("ChartNoAxesColumnIncreasing",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=kt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PV=kt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AV=kt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yk=kt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oee=kt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aee=kt("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ff=kt("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jV=kt("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YA=kt("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DV=kt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mh=kt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lc=kt("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lee=kt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z2=kt("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cee=kt("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uee=kt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OV=kt("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k_=kt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dee=kt("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fm=kt("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hee=kt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=kt("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yb=kt("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FV=kt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vk=kt("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MV=kt("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QA=kt("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fee=kt("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bk=kt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wk=kt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZA=kt("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sk=kt("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mf=kt("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JA=kt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LV=kt("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pee=kt("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BV=kt("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vb=kt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ck=kt("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mee=kt("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gh=kt("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gee=kt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ej=kt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kk=kt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N_=kt("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=kt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xee=kt("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yu=kt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VV=kt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yee=kt("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nk=kt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bb=kt("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=kt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T_=kt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lh=kt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=kt("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),__="-",vee=t=>{const e=wee(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:o=>{const a=o.split(__);return a[0]===""&&a.length!==1&&a.shift(),zV(a,e)||bee(o)},getConflictingClassGroupIds:(o,a)=>{const l=n[o]||[];return a&&s[o]?[...l,...s[o]]:l}}},zV=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const n=t[0],s=e.nextPart.get(n),r=s?zV(t.slice(1),s):void 0;if(r)return r;if(e.validators.length===0)return;const i=t.join(__);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},tj=/^\[(.+)\]$/,bee=t=>{if(tj.test(t)){const e=tj.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},wee=t=>{const{theme:e,prefix:n}=t,s={nextPart:new Map,validators:[]};return Cee(Object.entries(t.classGroups),n).forEach(([i,o])=>{Tk(o,s,i,e)}),s},Tk=(t,e,n,s)=>{t.forEach(r=>{if(typeof r=="string"){const i=r===""?e:nj(e,r);i.classGroupId=n;return}if(typeof r=="function"){if(See(r)){Tk(r(s),e,n,s);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([i,o])=>{Tk(o,nj(e,i),n,s)})})},nj=(t,e)=>{let n=t;return e.split(__).forEach(s=>{n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n},See=t=>t.isThemeGetter,Cee=(t,e)=>e?t.map(([n,s])=>{const r=s.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[n,r]}):t,kee=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,s=new Map;const r=(i,o)=>{n.set(i,o),e++,e>t&&(e=0,s=n,n=new Map)};return{get(i){let o=n.get(i);if(o!==void 0)return o;if((o=s.get(i))!==void 0)return r(i,o),o},set(i,o){n.has(i)?n.set(i,o):r(i,o)}}},WV="!",Nee=t=>{const{separator:e,experimentalParseClassName:n}=t,s=e.length===1,r=e[0],i=e.length,o=a=>{const l=[];let c=0,d=0,h;for(let x=0;x<a.length;x++){let y=a[x];if(c===0){if(y===r&&(s||a.slice(x,x+i)===e)){l.push(a.slice(d,x)),d=x+i;continue}if(y==="/"){h=x;continue}}y==="["?c++:y==="]"&&c--}const f=l.length===0?a:a.substring(d),p=f.startsWith(WV),m=p?f.substring(1):f,g=h&&h>d?h-d:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:m,maybePostfixModifierPosition:g}};return n?a=>n({className:a,parseClassName:o}):o},Tee=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(s=>{s[0]==="["?(e.push(...n.sort(),s),n=[]):n.push(s)}),e.push(...n.sort()),e},_ee=t=>({cache:kee(t.cacheSize),parseClassName:Nee(t),...vee(t)}),Eee=/\s+/,$ee=(t,e)=>{const{parseClassName:n,getClassGroupId:s,getConflictingClassGroupIds:r}=e,i=[],o=t.trim().split(Eee);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:d,hasImportantModifier:h,baseClassName:f,maybePostfixModifierPosition:p}=n(c);let m=!!p,g=s(m?f.substring(0,p):f);if(!g){if(!m){a=c+(a.length>0?" "+a:a);continue}if(g=s(f),!g){a=c+(a.length>0?" "+a:a);continue}m=!1}const x=Tee(d).join(":"),y=h?x+WV:x,v=y+g;if(i.includes(v))continue;i.push(v);const S=r(g,m);for(let C=0;C<S.length;++C){const k=S[C];i.push(y+k)}a=c+(a.length>0?" "+a:a)}return a};function Iee(){let t=0,e,n,s="";for(;t<arguments.length;)(e=arguments[t++])&&(n=UV(e))&&(s&&(s+=" "),s+=n);return s}const UV=t=>{if(typeof t=="string")return t;let e,n="";for(let s=0;s<t.length;s++)t[s]&&(e=UV(t[s]))&&(n&&(n+=" "),n+=e);return n};function Ree(t,...e){let n,s,r,i=o;function o(l){const c=e.reduce((d,h)=>h(d),t());return n=_ee(c),s=n.cache.get,r=n.cache.set,i=a,a(l)}function a(l){const c=s(l);if(c)return c;const d=$ee(l,n);return r(l,d),d}return function(){return i(Iee.apply(null,arguments))}}const Cs=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},HV=/^\[(?:([a-z-]+):)?(.+)\]$/i,Pee=/^\d+\/\d+$/,Aee=new Set(["px","full","screen"]),jee=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Dee=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Oee=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Fee=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Mee=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Gl=t=>ep(t)||Aee.has(t)||Pee.test(t),Uc=t=>im(t,"length",Gee),ep=t=>!!t&&!Number.isNaN(Number(t)),U2=t=>im(t,"number",ep),Mm=t=>!!t&&Number.isInteger(Number(t)),Lee=t=>t.endsWith("%")&&ep(t.slice(0,-1)),on=t=>HV.test(t),Hc=t=>jee.test(t),Bee=new Set(["length","size","percentage"]),Vee=t=>im(t,Bee,GV),zee=t=>im(t,"position",GV),Wee=new Set(["image","url"]),Uee=t=>im(t,Wee,qee),Hee=t=>im(t,"",Kee),Lm=()=>!0,im=(t,e,n)=>{const s=HV.exec(t);return s?s[1]?typeof e=="string"?s[1]===e:e.has(s[1]):n(s[2]):!1},Gee=t=>Dee.test(t)&&!Oee.test(t),GV=()=>!1,Kee=t=>Fee.test(t),qee=t=>Mee.test(t),Xee=()=>{const t=Cs("colors"),e=Cs("spacing"),n=Cs("blur"),s=Cs("brightness"),r=Cs("borderColor"),i=Cs("borderRadius"),o=Cs("borderSpacing"),a=Cs("borderWidth"),l=Cs("contrast"),c=Cs("grayscale"),d=Cs("hueRotate"),h=Cs("invert"),f=Cs("gap"),p=Cs("gradientColorStops"),m=Cs("gradientColorStopPositions"),g=Cs("inset"),x=Cs("margin"),y=Cs("opacity"),v=Cs("padding"),S=Cs("saturate"),C=Cs("scale"),k=Cs("sepia"),T=Cs("skew"),_=Cs("space"),$=Cs("translate"),R=()=>["auto","contain","none"],A=()=>["auto","hidden","clip","visible","scroll"],j=()=>["auto",on,e],F=()=>[on,e],L=()=>["",Gl,Uc],M=()=>["auto",ep,on],q=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],z=()=>["solid","dashed","dotted","double","none"],re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],U=()=>["start","end","center","between","around","evenly","stretch"],G=()=>["","0",on],xe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ce=()=>[ep,on];return{cacheSize:500,separator:":",theme:{colors:[Lm],spacing:[Gl,Uc],blur:["none","",Hc,on],brightness:Ce(),borderColor:[t],borderRadius:["none","","full",Hc,on],borderSpacing:F(),borderWidth:L(),contrast:Ce(),grayscale:G(),hueRotate:Ce(),invert:G(),gap:F(),gradientColorStops:[t],gradientColorStopPositions:[Lee,Uc],inset:j(),margin:j(),opacity:Ce(),padding:F(),saturate:Ce(),scale:Ce(),sepia:G(),skew:Ce(),space:F(),translate:F()},classGroups:{aspect:[{aspect:["auto","square","video",on]}],container:["container"],columns:[{columns:[Hc]}],"break-after":[{"break-after":xe()}],"break-before":[{"break-before":xe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...q(),on]}],overflow:[{overflow:A()}],"overflow-x":[{"overflow-x":A()}],"overflow-y":[{"overflow-y":A()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Mm,on]}],basis:[{basis:j()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",on]}],grow:[{grow:G()}],shrink:[{shrink:G()}],order:[{order:["first","last","none",Mm,on]}],"grid-cols":[{"grid-cols":[Lm]}],"col-start-end":[{col:["auto",{span:["full",Mm,on]},on]}],"col-start":[{"col-start":M()}],"col-end":[{"col-end":M()}],"grid-rows":[{"grid-rows":[Lm]}],"row-start-end":[{row:["auto",{span:[Mm,on]},on]}],"row-start":[{"row-start":M()}],"row-end":[{"row-end":M()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",on]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",on]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...U()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...U(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...U(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",on,e]}],"min-w":[{"min-w":[on,e,"min","max","fit"]}],"max-w":[{"max-w":[on,e,"none","full","min","max","fit","prose",{screen:[Hc]},Hc]}],h:[{h:[on,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[on,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[on,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[on,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Hc,Uc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",U2]}],"font-family":[{font:[Lm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",on]}],"line-clamp":[{"line-clamp":["none",ep,U2]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Gl,on]}],"list-image":[{"list-image":["none",on]}],"list-style-type":[{list:["none","disc","decimal",on]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...z(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Gl,Uc]}],"underline-offset":[{"underline-offset":["auto",Gl,on]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:F()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",on]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",on]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...q(),zee]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Vee]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Uee]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...z(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:z()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...z()]}],"outline-offset":[{"outline-offset":[Gl,on]}],"outline-w":[{outline:[Gl,Uc]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Gl,Uc]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Hc,Hee]}],"shadow-color":[{shadow:[Lm]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...re(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":re()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Hc,on]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[S]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",on]}],duration:[{duration:Ce()}],ease:[{ease:["linear","in","out","in-out",on]}],delay:[{delay:Ce()}],animate:[{animate:["none","spin","ping","pulse","bounce",on]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[C]}],"scale-x":[{"scale-x":[C]}],"scale-y":[{"scale-y":[C]}],rotate:[{rotate:[Mm,on]}],"translate-x":[{"translate-x":[$]}],"translate-y":[{"translate-y":[$]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",on]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",on]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":F()}],"scroll-mx":[{"scroll-mx":F()}],"scroll-my":[{"scroll-my":F()}],"scroll-ms":[{"scroll-ms":F()}],"scroll-me":[{"scroll-me":F()}],"scroll-mt":[{"scroll-mt":F()}],"scroll-mr":[{"scroll-mr":F()}],"scroll-mb":[{"scroll-mb":F()}],"scroll-ml":[{"scroll-ml":F()}],"scroll-p":[{"scroll-p":F()}],"scroll-px":[{"scroll-px":F()}],"scroll-py":[{"scroll-py":F()}],"scroll-ps":[{"scroll-ps":F()}],"scroll-pe":[{"scroll-pe":F()}],"scroll-pt":[{"scroll-pt":F()}],"scroll-pr":[{"scroll-pr":F()}],"scroll-pb":[{"scroll-pb":F()}],"scroll-pl":[{"scroll-pl":F()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",on]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Gl,Uc,U2]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Yee=Ree(Xee);function Pt(...t){return Yee(IV(t))}const Qee=tee,KV=b.forwardRef(({className:t,...e},n)=>u.jsx(CV,{ref:n,className:Pt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));KV.displayName=CV.displayName;const Zee=Sx("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),qV=b.forwardRef(({className:t,variant:e,...n},s)=>u.jsx(kV,{ref:s,className:Pt(Zee({variant:e}),t),...n}));qV.displayName=kV.displayName;const Jee=b.forwardRef(({className:t,...e},n)=>u.jsx(_V,{ref:n,className:Pt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...e}));Jee.displayName=_V.displayName;const XV=b.forwardRef(({className:t,...e},n)=>u.jsx(EV,{ref:n,className:Pt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:u.jsx(Lh,{className:"h-4 w-4"})}));XV.displayName=EV.displayName;const YV=b.forwardRef(({className:t,...e},n)=>u.jsx(NV,{ref:n,className:Pt("text-sm font-semibold",t),...e}));YV.displayName=NV.displayName;const QV=b.forwardRef(({className:t,...e},n)=>u.jsx(TV,{ref:n,className:Pt("text-sm opacity-90",t),...e}));QV.displayName=TV.displayName;function ete(){const{toasts:t}=Qw();return u.jsxs(Qee,{children:[t.map(function({id:e,title:n,description:s,action:r,...i}){return u.jsxs(qV,{...i,children:[u.jsxs("div",{className:"grid gap-1",children:[n&&u.jsx(YV,{children:n}),s&&u.jsx(QV,{children:s})]}),r,u.jsx(XV,{})]},e)}),u.jsx(KV,{})]})}var tte=$L[" useId ".trim().toString()]||(()=>{}),nte=0;function Tl(t){const[e,n]=b.useState(tte());return ti(()=>{t||n(s=>s??String(nte++))},[t]),t||(e?`radix-${e}`:"")}const ste=["top","right","bottom","left"],Vu=Math.min,uo=Math.max,wb=Math.round,ky=Math.floor,_l=t=>({x:t,y:t}),rte={left:"right",right:"left",bottom:"top",top:"bottom"},ite={start:"end",end:"start"};function _k(t,e,n){return uo(t,Vu(e,n))}function Cc(t,e){return typeof t=="function"?t(e):t}function kc(t){return t.split("-")[0]}function om(t){return t.split("-")[1]}function E_(t){return t==="x"?"y":"x"}function $_(t){return t==="y"?"height":"width"}function zu(t){return["top","bottom"].includes(kc(t))?"y":"x"}function I_(t){return E_(zu(t))}function ote(t,e,n){n===void 0&&(n=!1);const s=om(t),r=I_(t),i=$_(r);let o=r==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Sb(o)),[o,Sb(o)]}function ate(t){const e=Sb(t);return[Ek(t),e,Ek(e)]}function Ek(t){return t.replace(/start|end/g,e=>ite[e])}function lte(t,e,n){const s=["left","right"],r=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?r:s:e?s:r;case"left":case"right":return e?i:o;default:return[]}}function cte(t,e,n,s){const r=om(t);let i=lte(kc(t),n==="start",s);return r&&(i=i.map(o=>o+"-"+r),e&&(i=i.concat(i.map(Ek)))),i}function Sb(t){return t.replace(/left|right|bottom|top/g,e=>rte[e])}function ute(t){return{top:0,right:0,bottom:0,left:0,...t}}function ZV(t){return typeof t!="number"?ute(t):{top:t,right:t,bottom:t,left:t}}function Cb(t){const{x:e,y:n,width:s,height:r}=t;return{width:s,height:r,top:n,left:e,right:e+s,bottom:n+r,x:e,y:n}}function sj(t,e,n){let{reference:s,floating:r}=t;const i=zu(e),o=I_(e),a=$_(o),l=kc(e),c=i==="y",d=s.x+s.width/2-r.width/2,h=s.y+s.height/2-r.height/2,f=s[a]/2-r[a]/2;let p;switch(l){case"top":p={x:d,y:s.y-r.height};break;case"bottom":p={x:d,y:s.y+s.height};break;case"right":p={x:s.x+s.width,y:h};break;case"left":p={x:s.x-r.width,y:h};break;default:p={x:s.x,y:s.y}}switch(om(e)){case"start":p[o]-=f*(n&&c?-1:1);break;case"end":p[o]+=f*(n&&c?-1:1);break}return p}const dte=async(t,e,n)=>{const{placement:s="bottom",strategy:r="absolute",middleware:i=[],platform:o}=n,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:d,y:h}=sj(c,s,l),f=s,p={},m=0;for(let g=0;g<a.length;g++){const{name:x,fn:y}=a[g],{x:v,y:S,data:C,reset:k}=await y({x:d,y:h,initialPlacement:s,placement:f,strategy:r,middlewareData:p,rects:c,platform:o,elements:{reference:t,floating:e}});d=v??d,h=S??h,p={...p,[x]:{...p[x],...C}},k&&m<=50&&(m++,typeof k=="object"&&(k.placement&&(f=k.placement),k.rects&&(c=k.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):k.rects),{x:d,y:h}=sj(c,f,l)),g=-1)}return{x:d,y:h,placement:f,strategy:r,middlewareData:p}};async function g0(t,e){var n;e===void 0&&(e={});const{x:s,y:r,platform:i,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:f=!1,padding:p=0}=Cc(e,t),m=ZV(p),x=a[f?h==="floating"?"reference":"floating":h],y=Cb(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(x)))==null||n?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),v=h==="floating"?{x:s,y:r,width:o.floating.width,height:o.floating.height}:o.reference,S=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),C=await(i.isElement==null?void 0:i.isElement(S))?await(i.getScale==null?void 0:i.getScale(S))||{x:1,y:1}:{x:1,y:1},k=Cb(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:S,strategy:l}):v);return{top:(y.top-k.top+m.top)/C.y,bottom:(k.bottom-y.bottom+m.bottom)/C.y,left:(y.left-k.left+m.left)/C.x,right:(k.right-y.right+m.right)/C.x}}const hte=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:s,placement:r,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:d=0}=Cc(t,e)||{};if(c==null)return{};const h=ZV(d),f={x:n,y:s},p=I_(r),m=$_(p),g=await o.getDimensions(c),x=p==="y",y=x?"top":"left",v=x?"bottom":"right",S=x?"clientHeight":"clientWidth",C=i.reference[m]+i.reference[p]-f[p]-i.floating[m],k=f[p]-i.reference[p],T=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let _=T?T[S]:0;(!_||!await(o.isElement==null?void 0:o.isElement(T)))&&(_=a.floating[S]||i.floating[m]);const $=C/2-k/2,R=_/2-g[m]/2-1,A=Vu(h[y],R),j=Vu(h[v],R),F=A,L=_-g[m]-j,M=_/2-g[m]/2+$,q=_k(F,M,L),z=!l.arrow&&om(r)!=null&&M!==q&&i.reference[m]/2-(M<F?A:j)-g[m]/2<0,re=z?M<F?M-F:M-L:0;return{[p]:f[p]+re,data:{[p]:q,centerOffset:M-q-re,...z&&{alignmentOffset:re}},reset:z}}}),fte=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,s;const{placement:r,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0,...x}=Cc(t,e);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const y=kc(r),v=zu(a),S=kc(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=f||(S||!g?[Sb(a)]:ate(a)),T=m!=="none";!f&&T&&k.push(...cte(a,g,m,C));const _=[a,...k],$=await g0(e,x),R=[];let A=((s=i.flip)==null?void 0:s.overflows)||[];if(d&&R.push($[y]),h){const M=ote(r,o,C);R.push($[M[0]],$[M[1]])}if(A=[...A,{placement:r,overflows:R}],!R.every(M=>M<=0)){var j,F;const M=(((j=i.flip)==null?void 0:j.index)||0)+1,q=_[M];if(q)return{data:{index:M,overflows:A},reset:{placement:q}};let z=(F=A.filter(re=>re.overflows[0]<=0).sort((re,U)=>re.overflows[1]-U.overflows[1])[0])==null?void 0:F.placement;if(!z)switch(p){case"bestFit":{var L;const re=(L=A.filter(U=>{if(T){const G=zu(U.placement);return G===v||G==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(G=>G>0).reduce((G,xe)=>G+xe,0)]).sort((U,G)=>U[1]-G[1])[0])==null?void 0:L[0];re&&(z=re);break}case"initialPlacement":z=a;break}if(r!==z)return{reset:{placement:z}}}return{}}}};function rj(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function ij(t){return ste.some(e=>t[e]>=0)}const pte=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:s="referenceHidden",...r}=Cc(t,e);switch(s){case"referenceHidden":{const i=await g0(e,{...r,elementContext:"reference"}),o=rj(i,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:ij(o)}}}case"escaped":{const i=await g0(e,{...r,altBoundary:!0}),o=rj(i,n.floating);return{data:{escapedOffsets:o,escaped:ij(o)}}}default:return{}}}}};async function mte(t,e){const{placement:n,platform:s,elements:r}=t,i=await(s.isRTL==null?void 0:s.isRTL(r.floating)),o=kc(n),a=om(n),l=zu(n)==="y",c=["left","top"].includes(o)?-1:1,d=i&&l?-1:1,h=Cc(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:m}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof m=="number"&&(p=a==="end"?m*-1:m),l?{x:p*d,y:f*c}:{x:f*c,y:p*d}}const gte=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,s;const{x:r,y:i,placement:o,middlewareData:a}=e,l=await mte(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:r+l.x,y:i+l.y,data:{...l,placement:o}}}}},xte=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:s,placement:r}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:x=>{let{x:y,y:v}=x;return{x:y,y:v}}},...l}=Cc(t,e),c={x:n,y:s},d=await g0(e,l),h=zu(kc(r)),f=E_(h);let p=c[f],m=c[h];if(i){const x=f==="y"?"top":"left",y=f==="y"?"bottom":"right",v=p+d[x],S=p-d[y];p=_k(v,p,S)}if(o){const x=h==="y"?"top":"left",y=h==="y"?"bottom":"right",v=m+d[x],S=m-d[y];m=_k(v,m,S)}const g=a.fn({...e,[f]:p,[h]:m});return{...g,data:{x:g.x-n,y:g.y-s,enabled:{[f]:i,[h]:o}}}}}},yte=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:s,placement:r,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Cc(t,e),d={x:n,y:s},h=zu(r),f=E_(h);let p=d[f],m=d[h];const g=Cc(a,e),x=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const S=f==="y"?"height":"width",C=i.reference[f]-i.floating[S]+x.mainAxis,k=i.reference[f]+i.reference[S]-x.mainAxis;p<C?p=C:p>k&&(p=k)}if(c){var y,v;const S=f==="y"?"width":"height",C=["top","left"].includes(kc(r)),k=i.reference[h]-i.floating[S]+(C&&((y=o.offset)==null?void 0:y[h])||0)+(C?0:x.crossAxis),T=i.reference[h]+i.reference[S]+(C?0:((v=o.offset)==null?void 0:v[h])||0)-(C?x.crossAxis:0);m<k?m=k:m>T&&(m=T)}return{[f]:p,[h]:m}}}},vte=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,s;const{placement:r,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Cc(t,e),d=await g0(e,c),h=kc(r),f=om(r),p=zu(r)==="y",{width:m,height:g}=i.floating;let x,y;h==="top"||h==="bottom"?(x=h,y=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=h,x=f==="end"?"top":"bottom");const v=g-d.top-d.bottom,S=m-d.left-d.right,C=Vu(g-d[x],v),k=Vu(m-d[y],S),T=!e.middlewareData.shift;let _=C,$=k;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&($=S),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(_=v),T&&!f){const A=uo(d.left,0),j=uo(d.right,0),F=uo(d.top,0),L=uo(d.bottom,0);p?$=m-2*(A!==0||j!==0?A+j:uo(d.left,d.right)):_=g-2*(F!==0||L!==0?F+L:uo(d.top,d.bottom))}await l({...e,availableWidth:$,availableHeight:_});const R=await o.getDimensions(a.floating);return m!==R.width||g!==R.height?{reset:{rects:!0}}:{}}}};function r1(){return typeof window<"u"}function am(t){return JV(t)?(t.nodeName||"").toLowerCase():"#document"}function So(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Vl(t){var e;return(e=(JV(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function JV(t){return r1()?t instanceof Node||t instanceof So(t).Node:!1}function Ka(t){return r1()?t instanceof Element||t instanceof So(t).Element:!1}function jl(t){return r1()?t instanceof HTMLElement||t instanceof So(t).HTMLElement:!1}function oj(t){return!r1()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof So(t).ShadowRoot}function kx(t){const{overflow:e,overflowX:n,overflowY:s,display:r}=qa(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+n)&&!["inline","contents"].includes(r)}function bte(t){return["table","td","th"].includes(am(t))}function i1(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function R_(t){const e=P_(),n=Ka(t)?qa(t):t;return["transform","translate","scale","rotate","perspective"].some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(n.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(n.contain||"").includes(s))}function wte(t){let e=Wu(t);for(;jl(e)&&!Rp(e);){if(R_(e))return e;if(i1(e))return null;e=Wu(e)}return null}function P_(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Rp(t){return["html","body","#document"].includes(am(t))}function qa(t){return So(t).getComputedStyle(t)}function o1(t){return Ka(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Wu(t){if(am(t)==="html")return t;const e=t.assignedSlot||t.parentNode||oj(t)&&t.host||Vl(t);return oj(e)?e.host:e}function ez(t){const e=Wu(t);return Rp(e)?t.ownerDocument?t.ownerDocument.body:t.body:jl(e)&&kx(e)?e:ez(e)}function x0(t,e,n){var s;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=ez(t),i=r===((s=t.ownerDocument)==null?void 0:s.body),o=So(r);if(i){const a=$k(o);return e.concat(o,o.visualViewport||[],kx(r)?r:[],a&&n?x0(a):[])}return e.concat(r,x0(r,[],n))}function $k(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function tz(t){const e=qa(t);let n=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const r=jl(t),i=r?t.offsetWidth:n,o=r?t.offsetHeight:s,a=wb(n)!==i||wb(s)!==o;return a&&(n=i,s=o),{width:n,height:s,$:a}}function A_(t){return Ka(t)?t:t.contextElement}function tp(t){const e=A_(t);if(!jl(e))return _l(1);const n=e.getBoundingClientRect(),{width:s,height:r,$:i}=tz(e);let o=(i?wb(n.width):n.width)/s,a=(i?wb(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const Ste=_l(0);function nz(t){const e=So(t);return!P_()||!e.visualViewport?Ste:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Cte(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==So(t)?!1:e}function xh(t,e,n,s){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),i=A_(t);let o=_l(1);e&&(s?Ka(s)&&(o=tp(s)):o=tp(t));const a=Cte(i,n,s)?nz(i):_l(0);let l=(r.left+a.x)/o.x,c=(r.top+a.y)/o.y,d=r.width/o.x,h=r.height/o.y;if(i){const f=So(i),p=s&&Ka(s)?So(s):s;let m=f,g=$k(m);for(;g&&s&&p!==m;){const x=tp(g),y=g.getBoundingClientRect(),v=qa(g),S=y.left+(g.clientLeft+parseFloat(v.paddingLeft))*x.x,C=y.top+(g.clientTop+parseFloat(v.paddingTop))*x.y;l*=x.x,c*=x.y,d*=x.x,h*=x.y,l+=S,c+=C,m=So(g),g=$k(m)}}return Cb({width:d,height:h,x:l,y:c})}function j_(t,e){const n=o1(t).scrollLeft;return e?e.left+n:xh(Vl(t)).left+n}function sz(t,e,n){n===void 0&&(n=!1);const s=t.getBoundingClientRect(),r=s.left+e.scrollLeft-(n?0:j_(t,s)),i=s.top+e.scrollTop;return{x:r,y:i}}function kte(t){let{elements:e,rect:n,offsetParent:s,strategy:r}=t;const i=r==="fixed",o=Vl(s),a=e?i1(e.floating):!1;if(s===o||a&&i)return n;let l={scrollLeft:0,scrollTop:0},c=_l(1);const d=_l(0),h=jl(s);if((h||!h&&!i)&&((am(s)!=="body"||kx(o))&&(l=o1(s)),jl(s))){const p=xh(s);c=tp(s),d.x=p.x+s.clientLeft,d.y=p.y+s.clientTop}const f=o&&!h&&!i?sz(o,l,!0):_l(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+f.x,y:n.y*c.y-l.scrollTop*c.y+d.y+f.y}}function Nte(t){return Array.from(t.getClientRects())}function Tte(t){const e=Vl(t),n=o1(t),s=t.ownerDocument.body,r=uo(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),i=uo(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-n.scrollLeft+j_(t);const a=-n.scrollTop;return qa(s).direction==="rtl"&&(o+=uo(e.clientWidth,s.clientWidth)-r),{width:r,height:i,x:o,y:a}}function _te(t,e){const n=So(t),s=Vl(t),r=n.visualViewport;let i=s.clientWidth,o=s.clientHeight,a=0,l=0;if(r){i=r.width,o=r.height;const c=P_();(!c||c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:i,height:o,x:a,y:l}}function Ete(t,e){const n=xh(t,!0,e==="fixed"),s=n.top+t.clientTop,r=n.left+t.clientLeft,i=jl(t)?tp(t):_l(1),o=t.clientWidth*i.x,a=t.clientHeight*i.y,l=r*i.x,c=s*i.y;return{width:o,height:a,x:l,y:c}}function aj(t,e,n){let s;if(e==="viewport")s=_te(t,n);else if(e==="document")s=Tte(Vl(t));else if(Ka(e))s=Ete(e,n);else{const r=nz(t);s={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Cb(s)}function rz(t,e){const n=Wu(t);return n===e||!Ka(n)||Rp(n)?!1:qa(n).position==="fixed"||rz(n,e)}function $te(t,e){const n=e.get(t);if(n)return n;let s=x0(t,[],!1).filter(a=>Ka(a)&&am(a)!=="body"),r=null;const i=qa(t).position==="fixed";let o=i?Wu(t):t;for(;Ka(o)&&!Rp(o);){const a=qa(o),l=R_(o);!l&&a.position==="fixed"&&(r=null),(i?!l&&!r:!l&&a.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||kx(o)&&!l&&rz(t,o))?s=s.filter(d=>d!==o):r=a,o=Wu(o)}return e.set(t,s),s}function Ite(t){let{element:e,boundary:n,rootBoundary:s,strategy:r}=t;const o=[...n==="clippingAncestors"?i1(e)?[]:$te(e,this._c):[].concat(n),s],a=o[0],l=o.reduce((c,d)=>{const h=aj(e,d,r);return c.top=uo(h.top,c.top),c.right=Vu(h.right,c.right),c.bottom=Vu(h.bottom,c.bottom),c.left=uo(h.left,c.left),c},aj(e,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function Rte(t){const{width:e,height:n}=tz(t);return{width:e,height:n}}function Pte(t,e,n){const s=jl(e),r=Vl(e),i=n==="fixed",o=xh(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=_l(0);if(s||!s&&!i)if((am(e)!=="body"||kx(r))&&(a=o1(e)),s){const f=xh(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else r&&(l.x=j_(r));const c=r&&!s&&!i?sz(r,a):_l(0),d=o.left+a.scrollLeft-l.x-c.x,h=o.top+a.scrollTop-l.y-c.y;return{x:d,y:h,width:o.width,height:o.height}}function H2(t){return qa(t).position==="static"}function lj(t,e){if(!jl(t)||qa(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Vl(t)===n&&(n=n.ownerDocument.body),n}function iz(t,e){const n=So(t);if(i1(t))return n;if(!jl(t)){let r=Wu(t);for(;r&&!Rp(r);){if(Ka(r)&&!H2(r))return r;r=Wu(r)}return n}let s=lj(t,e);for(;s&&bte(s)&&H2(s);)s=lj(s,e);return s&&Rp(s)&&H2(s)&&!R_(s)?n:s||wte(t)||n}const Ate=async function(t){const e=this.getOffsetParent||iz,n=this.getDimensions,s=await n(t.floating);return{reference:Pte(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function jte(t){return qa(t).direction==="rtl"}const Dte={convertOffsetParentRelativeRectToViewportRelativeRect:kte,getDocumentElement:Vl,getClippingRect:Ite,getOffsetParent:iz,getElementRects:Ate,getClientRects:Nte,getDimensions:Rte,getScale:tp,isElement:Ka,isRTL:jte};function oz(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Ote(t,e){let n=null,s;const r=Vl(t);function i(){var a;clearTimeout(s),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=t.getBoundingClientRect(),{left:d,top:h,width:f,height:p}=c;if(a||e(),!f||!p)return;const m=ky(h),g=ky(r.clientWidth-(d+f)),x=ky(r.clientHeight-(h+p)),y=ky(d),S={rootMargin:-m+"px "+-g+"px "+-x+"px "+-y+"px",threshold:uo(0,Vu(1,l))||1};let C=!0;function k(T){const _=T[0].intersectionRatio;if(_!==l){if(!C)return o();_?o(!1,_):s=setTimeout(()=>{o(!1,1e-7)},1e3)}_===1&&!oz(c,t.getBoundingClientRect())&&o(),C=!1}try{n=new IntersectionObserver(k,{...S,root:r.ownerDocument})}catch{n=new IntersectionObserver(k,S)}n.observe(t)}return o(!0),i}function Fte(t,e,n,s){s===void 0&&(s={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,c=A_(t),d=r||i?[...c?x0(c):[],...x0(e)]:[];d.forEach(y=>{r&&y.addEventListener("scroll",n,{passive:!0}),i&&y.addEventListener("resize",n)});const h=c&&a?Ote(c,n):null;let f=-1,p=null;o&&(p=new ResizeObserver(y=>{let[v]=y;v&&v.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=p)==null||S.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let m,g=l?xh(t):null;l&&x();function x(){const y=xh(t);g&&!oz(g,y)&&n(),g=y,m=requestAnimationFrame(x)}return n(),()=>{var y;d.forEach(v=>{r&&v.removeEventListener("scroll",n),i&&v.removeEventListener("resize",n)}),h==null||h(),(y=p)==null||y.disconnect(),p=null,l&&cancelAnimationFrame(m)}}const Mte=gte,Lte=xte,Bte=fte,Vte=vte,zte=pte,cj=hte,Wte=yte,Ute=(t,e,n)=>{const s=new Map,r={platform:Dte,...n},i={...r.platform,_c:s};return dte(t,e,{...r,platform:i})};var Tv=typeof document<"u"?b.useLayoutEffect:b.useEffect;function kb(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,s,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(s=n;s--!==0;)if(!kb(t[s],e[s]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(e,r[s]))return!1;for(s=n;s--!==0;){const i=r[s];if(!(i==="_owner"&&t.$$typeof)&&!kb(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function az(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function uj(t,e){const n=az(t);return Math.round(e*n)/n}function G2(t){const e=b.useRef(t);return Tv(()=>{e.current=t}),e}function Hte(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:s=[],platform:r,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[d,h]=b.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=b.useState(s);kb(f,s)||p(s);const[m,g]=b.useState(null),[x,y]=b.useState(null),v=b.useCallback(U=>{U!==T.current&&(T.current=U,g(U))},[]),S=b.useCallback(U=>{U!==_.current&&(_.current=U,y(U))},[]),C=i||m,k=o||x,T=b.useRef(null),_=b.useRef(null),$=b.useRef(d),R=l!=null,A=G2(l),j=G2(r),F=G2(c),L=b.useCallback(()=>{if(!T.current||!_.current)return;const U={placement:e,strategy:n,middleware:f};j.current&&(U.platform=j.current),Ute(T.current,_.current,U).then(G=>{const xe={...G,isPositioned:F.current!==!1};M.current&&!kb($.current,xe)&&($.current=xe,Fh.flushSync(()=>{h(xe)}))})},[f,e,n,j,F]);Tv(()=>{c===!1&&$.current.isPositioned&&($.current.isPositioned=!1,h(U=>({...U,isPositioned:!1})))},[c]);const M=b.useRef(!1);Tv(()=>(M.current=!0,()=>{M.current=!1}),[]),Tv(()=>{if(C&&(T.current=C),k&&(_.current=k),C&&k){if(A.current)return A.current(C,k,L);L()}},[C,k,L,A,R]);const q=b.useMemo(()=>({reference:T,floating:_,setReference:v,setFloating:S}),[v,S]),z=b.useMemo(()=>({reference:C,floating:k}),[C,k]),re=b.useMemo(()=>{const U={position:n,left:0,top:0};if(!z.floating)return U;const G=uj(z.floating,d.x),xe=uj(z.floating,d.y);return a?{...U,transform:"translate("+G+"px, "+xe+"px)",...az(z.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:G,top:xe}},[n,a,z.floating,d.x,d.y]);return b.useMemo(()=>({...d,update:L,refs:q,elements:z,floatingStyles:re}),[d,L,q,z,re])}const Gte=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:s,padding:r}=typeof t=="function"?t(n):t;return s&&e(s)?s.current!=null?cj({element:s.current,padding:r}).fn(n):{}:s?cj({element:s,padding:r}).fn(n):{}}}},Kte=(t,e)=>({...Mte(t),options:[t,e]}),qte=(t,e)=>({...Lte(t),options:[t,e]}),Xte=(t,e)=>({...Wte(t),options:[t,e]}),Yte=(t,e)=>({...Bte(t),options:[t,e]}),Qte=(t,e)=>({...Vte(t),options:[t,e]}),Zte=(t,e)=>({...zte(t),options:[t,e]}),Jte=(t,e)=>({...Gte(t),options:[t,e]});var ene="Arrow",lz=b.forwardRef((t,e)=>{const{children:n,width:s=10,height:r=5,...i}=t;return u.jsx(Mt.svg,{...i,ref:e,width:s,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:u.jsx("polygon",{points:"0,0 30,0 15,10"})})});lz.displayName=ene;var tne=lz;function D_(t){const[e,n]=b.useState(void 0);return ti(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const s=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const i=r[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return s.observe(t,{box:"border-box"}),()=>s.unobserve(t)}else n(void 0)},[t]),e}var O_="Popper",[cz,lm]=Ao(O_),[nne,uz]=cz(O_),dz=t=>{const{__scopePopper:e,children:n}=t,[s,r]=b.useState(null);return u.jsx(nne,{scope:e,anchor:s,onAnchorChange:r,children:n})};dz.displayName=O_;var hz="PopperAnchor",fz=b.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:s,...r}=t,i=uz(hz,n),o=b.useRef(null),a=Pn(e,o);return b.useEffect(()=>{i.onAnchorChange((s==null?void 0:s.current)||o.current)}),s?null:u.jsx(Mt.div,{...r,ref:a})});fz.displayName=hz;var F_="PopperContent",[sne,rne]=cz(F_),pz=b.forwardRef((t,e)=>{var ce,me,ie,Q,oe,ae;const{__scopePopper:n,side:s="bottom",sideOffset:r=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:m,...g}=t,x=uz(F_,n),[y,v]=b.useState(null),S=Pn(e,Ae=>v(Ae)),[C,k]=b.useState(null),T=D_(C),_=(T==null?void 0:T.width)??0,$=(T==null?void 0:T.height)??0,R=s+(i!=="center"?"-"+i:""),A=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},j=Array.isArray(c)?c:[c],F=j.length>0,L={padding:A,boundary:j.filter(one),altBoundary:F},{refs:M,floatingStyles:q,placement:z,isPositioned:re,middlewareData:U}=Hte({strategy:"fixed",placement:R,whileElementsMounted:(...Ae)=>Fte(...Ae,{animationFrame:p==="always"}),elements:{reference:x.anchor},middleware:[Kte({mainAxis:r+$,alignmentAxis:o}),l&&qte({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?Xte():void 0,...L}),l&&Yte({...L}),Qte({...L,apply:({elements:Ae,rects:Be,availableWidth:Xe,availableHeight:lt})=>{const{width:Me,height:je}=Be.reference,Ze=Ae.floating.style;Ze.setProperty("--radix-popper-available-width",`${Xe}px`),Ze.setProperty("--radix-popper-available-height",`${lt}px`),Ze.setProperty("--radix-popper-anchor-width",`${Me}px`),Ze.setProperty("--radix-popper-anchor-height",`${je}px`)}}),C&&Jte({element:C,padding:a}),ane({arrowWidth:_,arrowHeight:$}),f&&Zte({strategy:"referenceHidden",...L})]}),[G,xe]=xz(z),Ce=ei(m);ti(()=>{re&&(Ce==null||Ce())},[re,Ce]);const De=(ce=U.arrow)==null?void 0:ce.x,fe=(me=U.arrow)==null?void 0:me.y,ee=((ie=U.arrow)==null?void 0:ie.centerOffset)!==0,[Pe,Re]=b.useState();return ti(()=>{y&&Re(window.getComputedStyle(y).zIndex)},[y]),u.jsx("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...q,transform:re?q.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Pe,"--radix-popper-transform-origin":[(Q=U.transformOrigin)==null?void 0:Q.x,(oe=U.transformOrigin)==null?void 0:oe.y].join(" "),...((ae=U.hide)==null?void 0:ae.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:u.jsx(sne,{scope:n,placedSide:G,onArrowChange:k,arrowX:De,arrowY:fe,shouldHideArrow:ee,children:u.jsx(Mt.div,{"data-side":G,"data-align":xe,...g,ref:S,style:{...g.style,animation:re?void 0:"none"}})})})});pz.displayName=F_;var mz="PopperArrow",ine={top:"bottom",right:"left",bottom:"top",left:"right"},gz=b.forwardRef(function(e,n){const{__scopePopper:s,...r}=e,i=rne(mz,s),o=ine[i.placedSide];return u.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:u.jsx(tne,{...r,ref:n,style:{...r.style,display:"block"}})})});gz.displayName=mz;function one(t){return t!==null}var ane=t=>({name:"transformOrigin",options:t,fn(e){var x,y,v;const{placement:n,rects:s,middlewareData:r}=e,o=((x=r.arrow)==null?void 0:x.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,d]=xz(n),h={start:"0%",center:"50%",end:"100%"}[d],f=(((y=r.arrow)==null?void 0:y.x)??0)+a/2,p=(((v=r.arrow)==null?void 0:v.y)??0)+l/2;let m="",g="";return c==="bottom"?(m=o?h:`${f}px`,g=`${-l}px`):c==="top"?(m=o?h:`${f}px`,g=`${s.floating.height+l}px`):c==="right"?(m=`${-l}px`,g=o?h:`${p}px`):c==="left"&&(m=`${s.floating.width+l}px`,g=o?h:`${p}px`),{data:{x:m,y:g}}}});function xz(t){const[e,n="center"]=t.split("-");return[e,n]}var yz=dz,M_=fz,L_=pz,B_=gz,[a1,m9e]=Ao("Tooltip",[lm]),V_=lm(),vz="TooltipProvider",lne=700,dj="tooltip.open",[cne,bz]=a1(vz),wz=t=>{const{__scopeTooltip:e,delayDuration:n=lne,skipDelayDuration:s=300,disableHoverableContent:r=!1,children:i}=t,o=b.useRef(!0),a=b.useRef(!1),l=b.useRef(0);return b.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),u.jsx(cne,{scope:e,isOpenDelayedRef:o,delayDuration:n,onOpen:b.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:b.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,s)},[s]),isPointerInTransitRef:a,onPointerInTransitChange:b.useCallback(c=>{a.current=c},[]),disableHoverableContent:r,children:i})};wz.displayName=vz;var Sz="Tooltip",[g9e,l1]=a1(Sz),Ik="TooltipTrigger",une=b.forwardRef((t,e)=>{const{__scopeTooltip:n,...s}=t,r=l1(Ik,n),i=bz(Ik,n),o=V_(n),a=b.useRef(null),l=Pn(e,a,r.onTriggerChange),c=b.useRef(!1),d=b.useRef(!1),h=b.useCallback(()=>c.current=!1,[]);return b.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),u.jsx(M_,{asChild:!0,...o,children:u.jsx(Mt.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...s,ref:l,onPointerMove:nt(t.onPointerMove,f=>{f.pointerType!=="touch"&&!d.current&&!i.isPointerInTransitRef.current&&(r.onTriggerEnter(),d.current=!0)}),onPointerLeave:nt(t.onPointerLeave,()=>{r.onTriggerLeave(),d.current=!1}),onPointerDown:nt(t.onPointerDown,()=>{r.open&&r.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:nt(t.onFocus,()=>{c.current||r.onOpen()}),onBlur:nt(t.onBlur,r.onClose),onClick:nt(t.onClick,r.onClose)})})});une.displayName=Ik;var dne="TooltipPortal",[x9e,hne]=a1(dne,{forceMount:void 0}),Pp="TooltipContent",Cz=b.forwardRef((t,e)=>{const n=hne(Pp,t.__scopeTooltip),{forceMount:s=n.forceMount,side:r="top",...i}=t,o=l1(Pp,t.__scopeTooltip);return u.jsx(jo,{present:s||o.open,children:o.disableHoverableContent?u.jsx(kz,{side:r,...i,ref:e}):u.jsx(fne,{side:r,...i,ref:e})})}),fne=b.forwardRef((t,e)=>{const n=l1(Pp,t.__scopeTooltip),s=bz(Pp,t.__scopeTooltip),r=b.useRef(null),i=Pn(e,r),[o,a]=b.useState(null),{trigger:l,onClose:c}=n,d=r.current,{onPointerInTransitChange:h}=s,f=b.useCallback(()=>{a(null),h(!1)},[h]),p=b.useCallback((m,g)=>{const x=m.currentTarget,y={x:m.clientX,y:m.clientY},v=yne(y,x.getBoundingClientRect()),S=vne(y,v),C=bne(g.getBoundingClientRect()),k=Sne([...S,...C]);a(k),h(!0)},[h]);return b.useEffect(()=>()=>f(),[f]),b.useEffect(()=>{if(l&&d){const m=x=>p(x,d),g=x=>p(x,l);return l.addEventListener("pointerleave",m),d.addEventListener("pointerleave",g),()=>{l.removeEventListener("pointerleave",m),d.removeEventListener("pointerleave",g)}}},[l,d,p,f]),b.useEffect(()=>{if(o){const m=g=>{const x=g.target,y={x:g.clientX,y:g.clientY},v=(l==null?void 0:l.contains(x))||(d==null?void 0:d.contains(x)),S=!wne(y,o);v?f():S&&(f(),c())};return document.addEventListener("pointermove",m),()=>document.removeEventListener("pointermove",m)}},[l,d,o,c,f]),u.jsx(kz,{...t,ref:i})}),[pne,mne]=a1(Sz,{isInside:!1}),gne=xJ("TooltipContent"),kz=b.forwardRef((t,e)=>{const{__scopeTooltip:n,children:s,"aria-label":r,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=t,l=l1(Pp,n),c=V_(n),{onClose:d}=l;return b.useEffect(()=>(document.addEventListener(dj,d),()=>document.removeEventListener(dj,d)),[d]),b.useEffect(()=>{if(l.trigger){const h=f=>{const p=f.target;p!=null&&p.contains(l.trigger)&&d()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,d]),u.jsx(rm,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:d,children:u.jsxs(L_,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[u.jsx(gne,{children:s}),u.jsx(pne,{scope:n,isInside:!0,children:u.jsx(FJ,{id:l.contentId,role:"tooltip",children:r||s})})]})})});Cz.displayName=Pp;var Nz="TooltipArrow",xne=b.forwardRef((t,e)=>{const{__scopeTooltip:n,...s}=t,r=V_(n);return mne(Nz,n).isInside?null:u.jsx(B_,{...r,...s,ref:e})});xne.displayName=Nz;function yne(t,e){const n=Math.abs(e.top-t.y),s=Math.abs(e.bottom-t.y),r=Math.abs(e.right-t.x),i=Math.abs(e.left-t.x);switch(Math.min(n,s,r,i)){case i:return"left";case r:return"right";case n:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function vne(t,e,n=5){const s=[];switch(e){case"top":s.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":s.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":s.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":s.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return s}function bne(t){const{top:e,right:n,bottom:s,left:r}=t;return[{x:r,y:e},{x:n,y:e},{x:n,y:s},{x:r,y:s}]}function wne(t,e){const{x:n,y:s}=t;let r=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i].x,l=e[i].y,c=e[o].x,d=e[o].y;l>s!=d>s&&n<(c-a)*(s-l)/(d-l)+a&&(r=!r)}return r}function Sne(t){const e=t.slice();return e.sort((n,s)=>n.x<s.x?-1:n.x>s.x?1:n.y<s.y?-1:n.y>s.y?1:0),Cne(e)}function Cne(t){if(t.length<=1)return t.slice();const e=[];for(let s=0;s<t.length;s++){const r=t[s];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))e.pop();else break}e.push(r)}e.pop();const n=[];for(let s=t.length-1;s>=0;s--){const r=t[s];for(;n.length>=2;){const i=n[n.length-1],o=n[n.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))n.pop();else break}n.push(r)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var kne=wz,Tz=Cz;const Nne=kne,Tne=b.forwardRef(({className:t,sideOffset:e=4,...n},s)=>u.jsx(Tz,{ref:s,sideOffset:e,className:Pt("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...n}));Tne.displayName=Tz.displayName;var _ne={};(function(){var t;function e(w){var N=0;return function(){return N<w.length?{done:!1,value:w[N++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(w,N,I){return w==Array.prototype||w==Object.prototype||(w[N]=I.value),w};function s(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof Cl=="object"&&Cl];for(var N=0;N<w.length;++N){var I=w[N];if(I&&I.Math==Math)return I}throw Error("Cannot find global object")}var r=s(this);function i(w,N){if(N)e:{var I=r;w=w.split(".");for(var P=0;P<w.length-1;P++){var V=w[P];if(!(V in I))break e;I=I[V]}w=w[w.length-1],P=I[w],N=N(P),N!=P&&N!=null&&n(I,w,{configurable:!0,writable:!0,value:N})}}i("Symbol",function(w){function N(H){if(this instanceof N)throw new TypeError("Symbol is not a constructor");return new I(P+(H||"")+"_"+V++,H)}function I(H,W){this.h=H,n(this,"description",{configurable:!0,writable:!0,value:W})}if(w)return w;I.prototype.toString=function(){return this.h};var P="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",V=0;return N}),i("Symbol.iterator",function(w){if(w)return w;w=Symbol("Symbol.iterator");for(var N="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),I=0;I<N.length;I++){var P=r[N[I]];typeof P=="function"&&typeof P.prototype[w]!="function"&&n(P.prototype,w,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return w});function o(w){return w={next:w},w[Symbol.iterator]=function(){return this},w}function a(w){var N=typeof Symbol<"u"&&Symbol.iterator&&w[Symbol.iterator];return N?N.call(w):{next:e(w)}}function l(w){if(!(w instanceof Array)){w=a(w);for(var N,I=[];!(N=w.next()).done;)I.push(N.value);w=I}return w}var c=typeof Object.assign=="function"?Object.assign:function(w,N){for(var I=1;I<arguments.length;I++){var P=arguments[I];if(P)for(var V in P)Object.prototype.hasOwnProperty.call(P,V)&&(w[V]=P[V])}return w};i("Object.assign",function(w){return w||c});var d=typeof Object.create=="function"?Object.create:function(w){function N(){}return N.prototype=w,new N},h;if(typeof Object.setPrototypeOf=="function")h=Object.setPrototypeOf;else{var f;e:{var p={a:!0},m={};try{m.__proto__=p,f=m.a;break e}catch{}f=!1}h=f?function(w,N){if(w.__proto__=N,w.__proto__!==N)throw new TypeError(w+" is not extensible");return w}:null}var g=h;function x(w,N){if(w.prototype=d(N.prototype),w.prototype.constructor=w,g)g(w,N);else for(var I in N)if(I!="prototype")if(Object.defineProperties){var P=Object.getOwnPropertyDescriptor(N,I);P&&Object.defineProperty(w,I,P)}else w[I]=N[I];w.za=N.prototype}function y(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function v(w){if(w.m)throw new TypeError("Generator is already running");w.m=!0}y.prototype.u=function(w){this.i=w};function S(w,N){w.l={ma:N,na:!0},w.h=w.s||w.v}y.prototype.return=function(w){this.l={return:w},this.h=this.v};function C(w,N,I){return w.h=I,{value:N}}function k(w){this.h=new y,this.i=w}function T(w,N){v(w.h);var I=w.h.j;return I?_(w,"return"in I?I.return:function(P){return{value:P,done:!0}},N,w.h.return):(w.h.return(N),$(w))}function _(w,N,I,P){try{var V=N.call(w.h.j,I);if(!(V instanceof Object))throw new TypeError("Iterator result "+V+" is not an object");if(!V.done)return w.h.m=!1,V;var H=V.value}catch(W){return w.h.j=null,S(w.h,W),$(w)}return w.h.j=null,P.call(w.h,H),$(w)}function $(w){for(;w.h.h;)try{var N=w.i(w.h);if(N)return w.h.m=!1,{value:N.value,done:!1}}catch(I){w.h.i=void 0,S(w.h,I)}if(w.h.m=!1,w.h.l){if(N=w.h.l,w.h.l=null,N.na)throw N.ma;return{value:N.return,done:!0}}return{value:void 0,done:!0}}function R(w){this.next=function(N){return v(w.h),w.h.j?N=_(w,w.h.j.next,N,w.h.u):(w.h.u(N),N=$(w)),N},this.throw=function(N){return v(w.h),w.h.j?N=_(w,w.h.j.throw,N,w.h.u):(S(w.h,N),N=$(w)),N},this.return=function(N){return T(w,N)},this[Symbol.iterator]=function(){return this}}function A(w){function N(P){return w.next(P)}function I(P){return w.throw(P)}return new Promise(function(P,V){function H(W){W.done?P(W.value):Promise.resolve(W.value).then(N,I).then(H,V)}H(w.next())})}function j(w){return A(new R(new k(w)))}i("Promise",function(w){function N(W){this.i=0,this.j=void 0,this.h=[],this.u=!1;var se=this.l();try{W(se.resolve,se.reject)}catch(ye){se.reject(ye)}}function I(){this.h=null}function P(W){return W instanceof N?W:new N(function(se){se(W)})}if(w)return w;I.prototype.i=function(W){if(this.h==null){this.h=[];var se=this;this.j(function(){se.m()})}this.h.push(W)};var V=r.setTimeout;I.prototype.j=function(W){V(W,0)},I.prototype.m=function(){for(;this.h&&this.h.length;){var W=this.h;this.h=[];for(var se=0;se<W.length;++se){var ye=W[se];W[se]=null;try{ye()}catch(Le){this.l(Le)}}}this.h=null},I.prototype.l=function(W){this.j(function(){throw W})},N.prototype.l=function(){function W(Le){return function(tt){ye||(ye=!0,Le.call(se,tt))}}var se=this,ye=!1;return{resolve:W(this.I),reject:W(this.m)}},N.prototype.I=function(W){if(W===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(W instanceof N)this.L(W);else{e:switch(typeof W){case"object":var se=W!=null;break e;case"function":se=!0;break e;default:se=!1}se?this.F(W):this.s(W)}},N.prototype.F=function(W){var se=void 0;try{se=W.then}catch(ye){this.m(ye);return}typeof se=="function"?this.M(se,W):this.s(W)},N.prototype.m=function(W){this.v(2,W)},N.prototype.s=function(W){this.v(1,W)},N.prototype.v=function(W,se){if(this.i!=0)throw Error("Cannot settle("+W+", "+se+"): Promise already settled in state"+this.i);this.i=W,this.j=se,this.i===2&&this.K(),this.H()},N.prototype.K=function(){var W=this;V(function(){if(W.D()){var se=r.console;typeof se<"u"&&se.error(W.j)}},1)},N.prototype.D=function(){if(this.u)return!1;var W=r.CustomEvent,se=r.Event,ye=r.dispatchEvent;return typeof ye>"u"?!0:(typeof W=="function"?W=new W("unhandledrejection",{cancelable:!0}):typeof se=="function"?W=new se("unhandledrejection",{cancelable:!0}):(W=r.document.createEvent("CustomEvent"),W.initCustomEvent("unhandledrejection",!1,!0,W)),W.promise=this,W.reason=this.j,ye(W))},N.prototype.H=function(){if(this.h!=null){for(var W=0;W<this.h.length;++W)H.i(this.h[W]);this.h=null}};var H=new I;return N.prototype.L=function(W){var se=this.l();W.T(se.resolve,se.reject)},N.prototype.M=function(W,se){var ye=this.l();try{W.call(se,ye.resolve,ye.reject)}catch(Le){ye.reject(Le)}},N.prototype.then=function(W,se){function ye(Rt,ht){return typeof Rt=="function"?function(Kt){try{Le(Rt(Kt))}catch(mn){tt(mn)}}:ht}var Le,tt,Gt=new N(function(Rt,ht){Le=Rt,tt=ht});return this.T(ye(W,Le),ye(se,tt)),Gt},N.prototype.catch=function(W){return this.then(void 0,W)},N.prototype.T=function(W,se){function ye(){switch(Le.i){case 1:W(Le.j);break;case 2:se(Le.j);break;default:throw Error("Unexpected state: "+Le.i)}}var Le=this;this.h==null?H.i(ye):this.h.push(ye),this.u=!0},N.resolve=P,N.reject=function(W){return new N(function(se,ye){ye(W)})},N.race=function(W){return new N(function(se,ye){for(var Le=a(W),tt=Le.next();!tt.done;tt=Le.next())P(tt.value).T(se,ye)})},N.all=function(W){var se=a(W),ye=se.next();return ye.done?P([]):new N(function(Le,tt){function Gt(Kt){return function(mn){Rt[Kt]=mn,ht--,ht==0&&Le(Rt)}}var Rt=[],ht=0;do Rt.push(void 0),ht++,P(ye.value).T(Gt(Rt.length-1),tt),ye=se.next();while(!ye.done)})},N});function F(w,N){w instanceof String&&(w+="");var I=0,P=!1,V={next:function(){if(!P&&I<w.length){var H=I++;return{value:N(H,w[H]),done:!1}}return P=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}i("Array.prototype.keys",function(w){return w||function(){return F(this,function(N){return N})}}),i("Array.prototype.fill",function(w){return w||function(N,I,P){var V=this.length||0;for(0>I&&(I=Math.max(0,V+I)),(P==null||P>V)&&(P=V),P=Number(P),0>P&&(P=Math.max(0,V+P)),I=Number(I||0);I<P;I++)this[I]=N;return this}});function L(w){return w||Array.prototype.fill}i("Int8Array.prototype.fill",L),i("Uint8Array.prototype.fill",L),i("Uint8ClampedArray.prototype.fill",L),i("Int16Array.prototype.fill",L),i("Uint16Array.prototype.fill",L),i("Int32Array.prototype.fill",L),i("Uint32Array.prototype.fill",L),i("Float32Array.prototype.fill",L),i("Float64Array.prototype.fill",L),i("Object.is",function(w){return w||function(N,I){return N===I?N!==0||1/N===1/I:N!==N&&I!==I}}),i("Array.prototype.includes",function(w){return w||function(N,I){var P=this;P instanceof String&&(P=String(P));var V=P.length;for(I=I||0,0>I&&(I=Math.max(I+V,0));I<V;I++){var H=P[I];if(H===N||Object.is(H,N))return!0}return!1}}),i("String.prototype.includes",function(w){return w||function(N,I){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(N instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(N,I||0)!==-1}});var M=this||self;function q(w,N){w=w.split(".");var I=M;w[0]in I||typeof I.execScript>"u"||I.execScript("var "+w[0]);for(var P;w.length&&(P=w.shift());)w.length||N===void 0?I[P]&&I[P]!==Object.prototype[P]?I=I[P]:I=I[P]={}:I[P]=N}function z(w){var N;e:{if((N=M.navigator)&&(N=N.userAgent))break e;N=""}return N.indexOf(w)!=-1}var re=Array.prototype.map?function(w,N){return Array.prototype.map.call(w,N,void 0)}:function(w,N){for(var I=w.length,P=Array(I),V=typeof w=="string"?w.split(""):w,H=0;H<I;H++)H in V&&(P[H]=N.call(void 0,V[H],H,w));return P},U={},G=null;function xe(w){var N=w.length,I=3*N/4;I%3?I=Math.floor(I):"=.".indexOf(w[N-1])!=-1&&(I="=.".indexOf(w[N-2])!=-1?I-2:I-1);var P=new Uint8Array(I),V=0;return Ce(w,function(H){P[V++]=H}),V!==I?P.subarray(0,V):P}function Ce(w,N){function I(ye){for(;P<w.length;){var Le=w.charAt(P++),tt=G[Le];if(tt!=null)return tt;if(!/^[\s\xa0]*$/.test(Le))throw Error("Unknown base64 encoding at char: "+Le)}return ye}De();for(var P=0;;){var V=I(-1),H=I(0),W=I(64),se=I(64);if(se===64&&V===-1)break;N(V<<2|H>>4),W!=64&&(N(H<<4&240|W>>2),se!=64&&N(W<<6&192|se))}}function De(){if(!G){G={};for(var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),N=["+/=","+/","-_=","-_.","-_"],I=0;5>I;I++){var P=w.concat(N[I].split(""));U[I]=P;for(var V=0;V<P.length;V++){var H=P[V];G[H]===void 0&&(G[H]=V)}}}}var fe=typeof Uint8Array<"u",ee=!(z("Trident")||z("MSIE"))&&typeof M.btoa=="function";function Pe(w){if(!ee){var N;N===void 0&&(N=0),De(),N=U[N];for(var I=Array(Math.floor(w.length/3)),P=N[64]||"",V=0,H=0;V<w.length-2;V+=3){var W=w[V],se=w[V+1],ye=w[V+2],Le=N[W>>2];W=N[(W&3)<<4|se>>4],se=N[(se&15)<<2|ye>>6],ye=N[ye&63],I[H++]=Le+W+se+ye}switch(Le=0,ye=P,w.length-V){case 2:Le=w[V+1],ye=N[(Le&15)<<2]||P;case 1:w=w[V],I[H]=N[w>>2]+N[(w&3)<<4|Le>>4]+ye+P}return I.join("")}for(N="";10240<w.length;)N+=String.fromCharCode.apply(null,w.subarray(0,10240)),w=w.subarray(10240);return N+=String.fromCharCode.apply(null,w),btoa(N)}var Re=RegExp("[-_.]","g");function ce(w){switch(w){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function me(w){if(!ee)return xe(w);Re.test(w)&&(w=w.replace(Re,ce)),w=atob(w);for(var N=new Uint8Array(w.length),I=0;I<w.length;I++)N[I]=w.charCodeAt(I);return N}var ie;function Q(){return ie||(ie=new Uint8Array(0))}var oe={},ae=typeof Uint8Array.prototype.slice=="function",Ae=0,Be=0;function Xe(w){var N=0>w;w=Math.abs(w);var I=w>>>0;w=Math.floor((w-I)/4294967296),N&&(I=a(Me(I,w)),N=I.next().value,w=I.next().value,I=N),Ae=I>>>0,Be=w>>>0}var lt=typeof BigInt=="function";function Me(w,N){return N=~N,w?w=~w+1:N+=1,[w,N]}function je(w,N){this.i=w>>>0,this.h=N>>>0}function Ze(w){if(!w)return Ye||(Ye=new je(0,0));if(!/^-?\d+$/.test(w))return null;if(16>w.length)Xe(Number(w));else if(lt)w=BigInt(w),Ae=Number(w&BigInt(4294967295))>>>0,Be=Number(w>>BigInt(32)&BigInt(4294967295));else{var N=+(w[0]==="-");Be=Ae=0;for(var I=w.length,P=N,V=(I-N)%6+N;V<=I;P=V,V+=6)P=Number(w.slice(P,V)),Be*=1e6,Ae=1e6*Ae+P,4294967296<=Ae&&(Be+=Ae/4294967296|0,Ae%=4294967296);N&&(N=a(Me(Ae,Be)),w=N.next().value,N=N.next().value,Ae=w,Be=N)}return new je(Ae,Be)}var Ye;function Ie(w,N){return Error("Invalid wire type: "+w+" (at position "+N+")")}function B(){return Error("Failed to read varint, encoding is invalid.")}function Z(w,N){return Error("Tried to read past the end of the data "+N+" > "+w)}function te(){throw Error("Invalid UTF8")}function ve(w,N){return N=String.fromCharCode.apply(null,N),w==null?N:w+N}var we=void 0,de,Ee=typeof TextDecoder<"u",mt,It=typeof TextEncoder<"u",jt;function hs(w){if(w!==oe)throw Error("illegal external caller")}function fn(w,N){if(hs(N),this.V=w,w!=null&&w.length===0)throw Error("ByteString should be constructed with non-empty values")}function dt(){return jt||(jt=new fn(null,oe))}function At(w){hs(oe);var N=w.V;return N=N==null||fe&&N!=null&&N instanceof Uint8Array?N:typeof N=="string"?me(N):null,N==null?N:w.V=N}function Vs(w){if(typeof w=="string")return{buffer:me(w),C:!1};if(Array.isArray(w))return{buffer:new Uint8Array(w),C:!1};if(w.constructor===Uint8Array)return{buffer:w,C:!1};if(w.constructor===ArrayBuffer)return{buffer:new Uint8Array(w),C:!1};if(w.constructor===fn)return{buffer:At(w)||Q(),C:!0};if(w instanceof Uint8Array)return{buffer:new Uint8Array(w.buffer,w.byteOffset,w.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Ln(w,N){this.i=null,this.m=!1,this.h=this.j=this.l=0,lr(this,w,N)}function lr(w,N,I){I=I===void 0?{}:I,w.S=I.S===void 0?!1:I.S,N&&(N=Vs(N),w.i=N.buffer,w.m=N.C,w.l=0,w.j=w.i.length,w.h=w.l)}Ln.prototype.reset=function(){this.h=this.l};function qn(w,N){if(w.h=N,N>w.j)throw Z(w.j,N)}function Ei(w){var N=w.i,I=w.h,P=N[I++],V=P&127;if(P&128&&(P=N[I++],V|=(P&127)<<7,P&128&&(P=N[I++],V|=(P&127)<<14,P&128&&(P=N[I++],V|=(P&127)<<21,P&128&&(P=N[I++],V|=P<<28,P&128&&N[I++]&128&&N[I++]&128&&N[I++]&128&&N[I++]&128&&N[I++]&128)))))throw B();return qn(w,I),V}function is(w,N){if(0>N)throw Error("Tried to read a negative byte length: "+N);var I=w.h,P=I+N;if(P>w.j)throw Z(N,w.j-I);return w.h=P,I}var Mo=[];function fs(){this.h=[]}fs.prototype.length=function(){return this.h.length},fs.prototype.end=function(){var w=this.h;return this.h=[],w};function pe(w,N,I){for(;0<I||127<N;)w.h.push(N&127|128),N=(N>>>7|I<<25)>>>0,I>>>=7;w.h.push(N)}function $e(w,N){for(;127<N;)w.h.push(N&127|128),N>>>=7;w.h.push(N)}function Te(w,N){if(Mo.length){var I=Mo.pop();lr(I,w,N),w=I}else w=new Ln(w,N);this.h=w,this.j=this.h.h,this.i=this.l=-1,this.setOptions(N)}Te.prototype.setOptions=function(w){w=w===void 0?{}:w,this.ca=w.ca===void 0?!1:w.ca},Te.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Je(w){var N=w.h;if(N.h==N.j)return!1;w.j=w.h.h;var I=Ei(w.h)>>>0;if(N=I>>>3,I&=7,!(0<=I&&5>=I))throw Ie(I,w.j);if(1>N)throw Error("Invalid field number: "+N+" (at position "+w.j+")");return w.l=N,w.i=I,!0}function He(w){switch(w.i){case 0:if(w.i!=0)He(w);else e:{w=w.h;for(var N=w.h,I=N+10,P=w.i;N<I;)if(!(P[N++]&128)){qn(w,N);break e}throw B()}break;case 1:w=w.h,qn(w,w.h+8);break;case 2:w.i!=2?He(w):(N=Ei(w.h)>>>0,w=w.h,qn(w,w.h+N));break;case 5:w=w.h,qn(w,w.h+4);break;case 3:N=w.l;do{if(!Je(w))throw Error("Unmatched start-group tag: stream EOF");if(w.i==4){if(w.l!=N)throw Error("Unmatched end-group tag");break}He(w)}while(!0);break;default:throw Ie(w.i,w.j)}}var it=[];function Ot(){this.j=[],this.i=0,this.h=new fs}function Yt(w,N){N.length!==0&&(w.j.push(N),w.i+=N.length)}function On(w,N){if(N=N.R){Yt(w,w.h.end());for(var I=0;I<N.length;I++)Yt(w,At(N[I])||Q())}}var en=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function An(w,N){return en?w[en]|=N:w.A!==void 0?w.A|=N:(Object.defineProperties(w,{A:{value:N,configurable:!0,writable:!0,enumerable:!1}}),N)}function os(w,N){en?w[en]&&(w[en]&=~N):w.A!==void 0&&(w.A&=~N)}function Ht(w){var N;return en?N=w[en]:N=w.A,N??0}function zs(w,N){en?w[en]=N:w.A!==void 0?w.A=N:Object.defineProperties(w,{A:{value:N,configurable:!0,writable:!0,enumerable:!1}})}function nl(w){return An(w,1),w}function Lo(w,N){zs(N,(w|0)&-51)}function ts(w,N){zs(N,(w|18)&-41)}var $i={};function wa(w){return w!==null&&typeof w=="object"&&!Array.isArray(w)&&w.constructor===Object}var Bo,zl=[];zs(zl,23),Bo=Object.freeze(zl);function Vo(w){if(Ht(w.o)&2)throw Error("Cannot mutate an immutable Message")}function oi(w){var N=w.length;(N=N?w[N-1]:void 0)&&wa(N)?N.g=1:(N={},w.push((N.g=1,N)))}function Wl(w){var N=w.i+w.G;return w.B||(w.B=w.o[N]={})}function $r(w,N){return N===-1?null:N>=w.i?w.B?w.B[N]:void 0:w.o[N+w.G]}function Xs(w,N,I,P){Vo(w),Ii(w,N,I,P)}function Ii(w,N,I,P){w.j&&(w.j=void 0),N>=w.i||P?Wl(w)[N]=I:(w.o[N+w.G]=I,(w=w.B)&&N in w&&delete w[N])}function sl(w,N,I,P){var V=$r(w,N);Array.isArray(V)||(V=Bo);var H=Ht(V);if(H&1||nl(V),P)H&2||An(V,2),I&1||Object.freeze(V);else{P=!(I&2);var W=H&2;I&1||!W?P&&H&16&&!W&&os(V,16):(V=nl(Array.prototype.slice.call(V)),Ii(w,N,V))}return V}function as(w,N){var I=$r(w,N),P=I==null?I:typeof I=="number"||I==="NaN"||I==="Infinity"||I==="-Infinity"?Number(I):void 0;return P!=null&&P!==I&&Ii(w,N,P),P}function Oe(w,N,I,P,V){w.h||(w.h={});var H=w.h[I],W=sl(w,I,3,V);if(!H){var se=W;H=[];var ye=!!(Ht(w.o)&16);W=!!(Ht(se)&2);var Le=se;!V&&W&&(se=Array.prototype.slice.call(se));for(var tt=W,Gt=0;Gt<se.length;Gt++){var Rt=se[Gt],ht=N,Kt=!1;if(Kt=Kt===void 0?!1:Kt,Rt=Array.isArray(Rt)?new ht(Rt):Kt?new ht:void 0,Rt!==void 0){ht=Rt.o;var mn=Kt=Ht(ht);W&&(mn|=2),ye&&(mn|=16),mn!=Kt&&zs(ht,mn),ht=mn,tt=tt||!!(2&ht),H.push(Rt)}}return w.h[I]=H,ye=Ht(se),N=ye|33,N=tt?N&-9:N|8,ye!=N&&(tt=se,Object.isFrozen(tt)&&(tt=Array.prototype.slice.call(tt)),zs(tt,N),se=tt),Le!==se&&Ii(w,I,se),(V||P&&W)&&An(H,2),P&&Object.freeze(H),H}return V||(V=Object.isFrozen(H),P&&!V?Object.freeze(H):!P&&V&&(H=Array.prototype.slice.call(H),w.h[I]=H)),H}function _t(w,N,I){var P=!!(Ht(w.o)&2);if(N=Oe(w,N,I,P,P),w=sl(w,I,3,P),!(P||Ht(w)&8)){for(P=0;P<N.length;P++){if(I=N[P],Ht(I.o)&2){var V=ft(I,!1);V.j=I}else V=I;I!==V&&(N[P]=V,w[P]=V.o)}An(w,8)}return N}function Zt(w,N,I){if(I!=null&&typeof I!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof I+": "+I);Xs(w,N,I)}function Es(w,N,I,P,V){Vo(w);var H=Oe(w,I,N,!1,!1);return I=P??new I,w=sl(w,N,2,!1),V!=null?(H.splice(V,0,I),w.splice(V,0,I.o)):(H.push(I),w.push(I.o)),I.C()&&os(w,8),I}function Ri(w,N){return w??N}function yr(w,N,I){return I=I===void 0?0:I,Ri(as(w,N),I)}var to;function of(w){switch(typeof w){case"number":return isFinite(w)?w:String(w);case"object":if(w)if(Array.isArray(w)){if(Ht(w)&128)return w=Array.prototype.slice.call(w),oi(w),w}else{if(fe&&w!=null&&w instanceof Uint8Array)return Pe(w);if(w instanceof fn){var N=w.V;return N==null?"":typeof N=="string"?N:w.V=Pe(N)}}}return w}function rl(w,N,I,P){if(w!=null){if(Array.isArray(w))w=Ul(w,N,I,P!==void 0);else if(wa(w)){var V={},H;for(H in w)V[H]=rl(w[H],N,I,P);w=V}else w=N(w,P);return w}}function Ul(w,N,I,P){var V=Ht(w);P=P?!!(V&16):void 0,w=Array.prototype.slice.call(w);for(var H=0;H<w.length;H++)w[H]=rl(w[H],N,I,P);return I(V,w),w}function af(w){return w.ja===$i?w.toJSON():of(w)}function ne(w,N){w&128&&oi(N)}function he(w,N,I){if(I=I===void 0?ts:I,w!=null){if(fe&&w instanceof Uint8Array)return w.length?new fn(new Uint8Array(w),oe):dt();if(Array.isArray(w)){var P=Ht(w);return P&2?w:N&&!(P&32)&&(P&16||P===0)?(zs(w,P|2),w):(w=Ul(w,he,P&4?ts:I,!0),N=Ht(w),N&4&&N&2&&Object.freeze(w),w)}return w.ja===$i?ke(w):w}}function ge(w,N,I,P,V,H,W){if(w=w.h&&w.h[I]){if(P=Ht(w),P&2?P=w:(H=re(w,ke),ts(P,H),Object.freeze(H),P=H),Vo(N),W=P==null?Bo:nl([]),P!=null){for(H=!!P.length,w=0;w<P.length;w++){var se=P[w];H=H&&!(Ht(se.o)&2),W[w]=se.o}H=(H?8:0)|1,w=Ht(W),(w&H)!==H&&(Object.isFrozen(W)&&(W=Array.prototype.slice.call(W)),zs(W,w|H)),N.h||(N.h={}),N.h[I]=P}else N.h&&(N.h[I]=void 0);Ii(N,I,W,V)}else Xs(N,I,he(P,H,W),V)}function ke(w){return Ht(w.o)&2||(w=ft(w,!0),An(w.o,2)),w}function ft(w,N){var I=w.o,P=[];An(P,16);var V=w.constructor.h;if(V&&P.push(V),V=w.B,V){P.length=I.length,P.fill(void 0,P.length,I.length);var H={};P[P.length-1]=H}Ht(I)&128&&oi(P),N=N||w.C()?ts:Lo,H=w.constructor,to=P,P=new H(P),to=void 0,w.R&&(P.R=w.R.slice()),H=!!(Ht(I)&16);for(var W=V?I.length-1:I.length,se=0;se<W;se++)ge(w,P,se-w.G,I[se],!1,H,N);if(V)for(var ye in V)ge(w,P,+ye,V[ye],!0,H,N);return P}function Tt(w,N,I){w==null&&(w=to),to=void 0;var P=this.constructor.i||0,V=0<P,H=this.constructor.h,W=!1;if(w==null){w=H?[H]:[];var se=48,ye=!0;V&&(P=0,se|=128),zs(w,se)}else{if(!Array.isArray(w)||H&&H!==w[0])throw Error();var Le=se=An(w,0);if((ye=(16&Le)!==0)&&((W=(32&Le)!==0)||(Le|=32)),V){if(128&Le)P=0;else if(0<w.length){var tt=w[w.length-1];if(wa(tt)&&"g"in tt){P=0,Le|=128,delete tt.g;var Gt=!0,Rt;for(Rt in tt){Gt=!1;break}Gt&&w.pop()}}}else if(128&Le)throw Error();se!==Le&&zs(w,Le)}this.G=(H?0:-1)-P,this.h=void 0,this.o=w;e:{if(H=this.o.length,P=H-1,H&&(H=this.o[P],wa(H))){this.B=H,this.i=P-this.G;break e}N!==void 0&&-1<N?(this.i=Math.max(N,P+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!V&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(I){N=ye&&!W&&!0,V=this.i;var ht;for(ye=0;ye<I.length;ye++)W=I[ye],W<V?(W+=this.G,(P=w[W])?gn(P,N):w[W]=Bo):(ht||(ht=Wl(this)),(P=ht[W])?gn(P,N):ht[W]=Bo)}}Tt.prototype.toJSON=function(){return Ul(this.o,af,ne)},Tt.prototype.C=function(){return!!(Ht(this.o)&2)};function gn(w,N){if(Array.isArray(w)){var I=Ht(w),P=1;!N||I&2||(P|=16),(I&P)!==P&&zs(w,I|P)}}Tt.prototype.ja=$i,Tt.prototype.toString=function(){return this.o.toString()};function zn(w,N,I){if(I){var P={},V;for(V in I){var H=I[V],W=H.ra;W||(P.J=H.xa||H.oa.W,H.ia?(P.aa=Ys(H.ia),W=function(se){return function(ye,Le,tt){return se.J(ye,Le,tt,se.aa)}}(P)):H.ka?(P.Z=lf(H.da.P,H.ka),W=function(se){return function(ye,Le,tt){return se.J(ye,Le,tt,se.Z)}}(P)):W=P.J,H.ra=W),W(N,w,H.da),P={J:P.J,aa:P.aa,Z:P.Z}}}On(N,w)}var Cn=Symbol();function En(w,N,I){return w[Cn]||(w[Cn]=function(P,V){return N(P,V,I)})}function ps(w){var N=w[Cn];if(!N){var I=Ne(w);N=function(P,V){return St(P,V,I)},w[Cn]=N}return N}function Dt(w){var N=w.ia;if(N)return ps(N);if(N=w.wa)return En(w.da.P,N,w.ka)}function ns(w){var N=Dt(w),I=w.da,P=w.oa.U;return N?function(V,H){return P(V,H,I,N)}:function(V,H){return P(V,H,I)}}function ai(w,N){var I=w[N];return typeof I=="function"&&I.length===0&&(I=I(),w[N]=I),Array.isArray(I)&&(Fe in I||fd in I||0<I.length&&typeof I[0]=="function")?I:void 0}function no(w,N,I,P,V,H){N.P=w[0];var W=1;if(w.length>W&&typeof w[W]!="number"){var se=w[W++];I(N,se)}for(;W<w.length;){I=w[W++];for(var ye=W+1;ye<w.length&&typeof w[ye]!="number";)ye++;switch(se=w[W++],ye-=W,ye){case 0:P(N,I,se);break;case 1:(ye=ai(w,W))?(W++,V(N,I,se,ye)):P(N,I,se,w[W++]);break;case 2:ye=W++,ye=ai(w,ye),V(N,I,se,ye,w[W++]);break;case 3:H(N,I,se,w[W++],w[W++],w[W++]);break;case 4:H(N,I,se,w[W++],w[W++],w[W++],w[W++]);break;default:throw Error("unexpected number of binary field arguments: "+ye)}}return N}var Ir=Symbol();function Ys(w){var N=w[Ir];if(!N){var I=le(w);N=function(P,V){return gt(P,V,I)},w[Ir]=N}return N}function lf(w,N){var I=w[Ir];return I||(I=function(P,V){return zn(P,V,N)},w[Ir]=I),I}var fd=Symbol();function Jx(w,N){w.push(N)}function i2(w,N,I){w.push(N,I.W)}function ey(w,N,I,P){var V=Ys(P),H=le(P).P,W=I.W;w.push(N,function(se,ye,Le){return W(se,ye,Le,H,V)})}function o2(w,N,I,P,V,H){var W=lf(P,H),se=I.W;w.push(N,function(ye,Le,tt){return se(ye,Le,tt,P,W)})}function le(w){var N=w[fd];return N||(N=no(w,w[fd]=[],Jx,i2,ey,o2),Fe in w&&fd in w&&(w.length=0),N)}var Fe=Symbol();function Ve(w,N){w[0]=N}function Qe(w,N,I,P){var V=I.U;w[N]=P?function(H,W,se){return V(H,W,se,P)}:V}function rt(w,N,I,P,V){var H=I.U,W=ps(P),se=Ne(P).P;w[N]=function(ye,Le,tt){return H(ye,Le,tt,se,W,V)}}function pt(w,N,I,P,V,H,W){var se=I.U,ye=En(P,V,H);w[N]=function(Le,tt,Gt){return se(Le,tt,Gt,P,ye,W)}}function Ne(w){var N=w[Fe];return N||(N=no(w,w[Fe]={},Ve,Qe,rt,pt),Fe in w&&fd in w&&(w.length=0),N)}function St(w,N,I){for(;Je(N)&&N.i!=4;){var P=N.l,V=I[P];if(!V){var H=I[0];H&&(H=H[P])&&(V=I[P]=ns(H))}if(!V||!V(N,w,P)){V=N,P=w,H=V.j,He(V);var W=V;if(!W.ca){if(V=W.h.h-H,W.h.h=H,W=W.h,V==0)V=dt();else{if(H=is(W,V),W.S&&W.m)V=W.i.subarray(H,H+V);else{W=W.i;var se=H;V=H+V,V=se===V?Q():ae?W.slice(se,V):new Uint8Array(W.subarray(se,V))}V=V.length==0?dt():new fn(V,oe)}(H=P.R)?H.push(V):P.R=[V]}}}return w}function gt(w,N,I){for(var P=I.length,V=P%2==1,H=V?1:0;H<P;H+=2)(0,I[H+1])(N,w,I[H]);zn(w,N,V?I[0]:void 0)}function vt(w,N){return{U:w,W:N}}var Xt=vt(function(w,N,I){if(w.i!==5)return!1;w=w.h;var P=w.i,V=w.h,H=P[V],W=P[V+1],se=P[V+2];return P=P[V+3],qn(w,w.h+4),W=(H<<0|W<<8|se<<16|P<<24)>>>0,w=2*(W>>31)+1,H=W>>>23&255,W&=8388607,Xs(N,I,H==255?W?NaN:1/0*w:H==0?w*Math.pow(2,-149)*W:w*Math.pow(2,H-150)*(W+Math.pow(2,23))),!0},function(w,N,I){if(N=as(N,I),N!=null){$e(w.h,8*I+5),w=w.h;var P=+N;P===0?0<1/P?Ae=Be=0:(Be=0,Ae=2147483648):isNaN(P)?(Be=0,Ae=2147483647):(P=(I=0>P?-2147483648:0)?-P:P,34028234663852886e22<P?(Be=0,Ae=(I|2139095040)>>>0):11754943508222875e-54>P?(P=Math.round(P/Math.pow(2,-149)),Be=0,Ae=(I|P)>>>0):(N=Math.floor(Math.log(P)/Math.LN2),P*=Math.pow(2,-N),P=Math.round(8388608*P),16777216<=P&&++N,Be=0,Ae=(I|N+127<<23|P&8388607)>>>0)),I=Ae,w.h.push(I>>>0&255),w.h.push(I>>>8&255),w.h.push(I>>>16&255),w.h.push(I>>>24&255)}}),ws=vt(function(w,N,I){if(w.i!==0)return!1;var P=w.h,V=0,H=w=0,W=P.i,se=P.h;do{var ye=W[se++];V|=(ye&127)<<H,H+=7}while(32>H&&ye&128);for(32<H&&(w|=(ye&127)>>4),H=3;32>H&&ye&128;H+=7)ye=W[se++],w|=(ye&127)<<H;if(qn(P,se),128>ye)P=V>>>0,ye=w>>>0,(w=ye&2147483648)&&(P=~P+1>>>0,ye=~ye>>>0,P==0&&(ye=ye+1>>>0)),P=4294967296*ye+(P>>>0);else throw B();return Xs(N,I,w?-P:P),!0},function(w,N,I){N=$r(N,I),N!=null&&(typeof N=="string"&&Ze(N),N!=null&&($e(w.h,8*I),typeof N=="number"?(w=w.h,Xe(N),pe(w,Ae,Be)):(I=Ze(N),pe(w.h,I.i,I.h))))}),$n=vt(function(w,N,I){return w.i!==0?!1:(Xs(N,I,Ei(w.h)),!0)},function(w,N,I){if(N=$r(N,I),N!=null&&N!=null)if($e(w.h,8*I),w=w.h,I=N,0<=I)$e(w,I);else{for(N=0;9>N;N++)w.h.push(I&127|128),I>>=7;w.h.push(1)}}),rn=vt(function(w,N,I){if(w.i!==2)return!1;var P=Ei(w.h)>>>0;w=w.h;var V=is(w,P);if(w=w.i,Ee){var H=w,W;(W=de)||(W=de=new TextDecoder("utf-8",{fatal:!0})),w=V+P,H=V===0&&w===H.length?H:H.subarray(V,w);try{var se=W.decode(H)}catch(Gt){if(we===void 0){try{W.decode(new Uint8Array([128]))}catch{}try{W.decode(new Uint8Array([97])),we=!0}catch{we=!1}}throw!we&&(de=void 0),Gt}}else{se=V,P=se+P,V=[];for(var ye=null,Le,tt;se<P;)Le=w[se++],128>Le?V.push(Le):224>Le?se>=P?te():(tt=w[se++],194>Le||(tt&192)!==128?(se--,te()):V.push((Le&31)<<6|tt&63)):240>Le?se>=P-1?te():(tt=w[se++],(tt&192)!==128||Le===224&&160>tt||Le===237&&160<=tt||((H=w[se++])&192)!==128?(se--,te()):V.push((Le&15)<<12|(tt&63)<<6|H&63)):244>=Le?se>=P-2?te():(tt=w[se++],(tt&192)!==128||(Le<<28)+(tt-144)>>30||((H=w[se++])&192)!==128||((W=w[se++])&192)!==128?(se--,te()):(Le=(Le&7)<<18|(tt&63)<<12|(H&63)<<6|W&63,Le-=65536,V.push((Le>>10&1023)+55296,(Le&1023)+56320))):te(),8192<=V.length&&(ye=ve(ye,V),V.length=0);se=ve(ye,V)}return Xs(N,I,se),!0},function(w,N,I){if(N=$r(N,I),N!=null){var P=!1;if(P=P===void 0?!1:P,It){if(P&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(N))throw Error("Found an unpaired surrogate");N=(mt||(mt=new TextEncoder)).encode(N)}else{for(var V=0,H=new Uint8Array(3*N.length),W=0;W<N.length;W++){var se=N.charCodeAt(W);if(128>se)H[V++]=se;else{if(2048>se)H[V++]=se>>6|192;else{if(55296<=se&&57343>=se){if(56319>=se&&W<N.length){var ye=N.charCodeAt(++W);if(56320<=ye&&57343>=ye){se=1024*(se-55296)+ye-56320+65536,H[V++]=se>>18|240,H[V++]=se>>12&63|128,H[V++]=se>>6&63|128,H[V++]=se&63|128;continue}else W--}if(P)throw Error("Found an unpaired surrogate");se=65533}H[V++]=se>>12|224,H[V++]=se>>6&63|128}H[V++]=se&63|128}}N=V===H.length?H:H.subarray(0,V)}$e(w.h,8*I+2),$e(w.h,N.length),Yt(w,w.h.end()),Yt(w,N)}}),Fn=vt(function(w,N,I,P,V){if(w.i!==2)return!1;N=Es(N,I,P),I=w.h.j,P=Ei(w.h)>>>0;var H=w.h.h+P,W=H-I;if(0>=W&&(w.h.j=H,V(N,w,void 0,void 0,void 0),W=H-w.h.h),W)throw Error("Message parsing ended unexpectedly. Expected to read "+(P+" bytes, instead read "+(P-W)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return w.h.h=H,w.h.j=I,!0},function(w,N,I,P,V){if(N=_t(N,P,I),N!=null)for(P=0;P<N.length;P++){var H=w;$e(H.h,8*I+2);var W=H.h.end();Yt(H,W),W.push(H.i),H=W,V(N[P],w),W=w;var se=H.pop();for(se=W.i+W.h.length()-se;127<se;)H.push(se&127|128),se>>>=7,W.i++;H.push(se),W.i++}});function Vt(w){return function(N,I){e:{if(it.length){var P=it.pop();P.setOptions(I),lr(P.h,N,I),N=P}else N=new Te(N,I);try{var V=Ne(w),H=St(new V.P,N,V);break e}finally{V=N.h,V.i=null,V.m=!1,V.l=0,V.j=0,V.h=0,V.S=!1,N.l=-1,N.i=-1,100>it.length&&it.push(N)}H=void 0}return H}}function yn(w){return function(){var N=new Ot;gt(this,N,le(w)),Yt(N,N.h.end());for(var I=new Uint8Array(N.i),P=N.j,V=P.length,H=0,W=0;W<V;W++){var se=P[W];I.set(se,H),H+=se.length}return N.j=[I],I}}function Rs(w){Tt.call(this,w)}x(Rs,Tt);var xn=[Rs,1,$n,2,Xt,3,rn,4,rn];Rs.prototype.l=yn(xn);function Et(w){Tt.call(this,w,-1,pn)}x(Et,Tt),Et.prototype.addClassification=function(w,N){return Es(this,1,Rs,w,N),this};var pn=[1],Jt=Vt([Et,1,Fn,xn]);function kn(w){Tt.call(this,w)}x(kn,Tt);var cn=[kn,1,Xt,2,Xt,3,Xt,4,Xt,5,Xt];kn.prototype.l=yn(cn);function ls(w){Tt.call(this,w,-1,Qs)}x(ls,Tt);var Qs=[1],Ws=Vt([ls,1,Fn,cn]);function cs(w){Tt.call(this,w)}x(cs,Tt);var vr=[cs,1,Xt,2,Xt,3,Xt,4,Xt,5,Xt,6,ws],li=Vt(vr);cs.prototype.l=yn(vr);function Sa(w,N,I){if(I=w.createShader(I===0?w.VERTEX_SHADER:w.FRAGMENT_SHADER),w.shaderSource(I,N),w.compileShader(I),!w.getShaderParameter(I,w.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+w.getShaderInfoLog(I));return I}function Vc(w){return _t(w,Rs,1).map(function(N){var I=$r(N,1);return{index:I??0,qa:yr(N,2),label:$r(N,3)!=null?Ri($r(N,3),""):void 0,displayName:$r(N,4)!=null?Ri($r(N,4),""):void 0}})}function Hl(w){return{x:yr(w,1),y:yr(w,2),z:yr(w,3),visibility:as(w,4)!=null?yr(w,4):void 0}}function a2(w){return _t(Ws(w),kn,1).map(Hl)}function l2(w,N){this.i=w,this.h=N,this.m=0}function m3(w,N,I){return dX(w,N),typeof w.h.canvas.transferToImageBitmap=="function"?Promise.resolve(w.h.canvas.transferToImageBitmap()):I?Promise.resolve(w.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(w.h.canvas):(w.j===void 0&&(w.j=document.createElement("canvas")),new Promise(function(P){w.j.height=w.h.canvas.height,w.j.width=w.h.canvas.width,w.j.getContext("2d",{}).drawImage(w.h.canvas,0,0,w.h.canvas.width,w.h.canvas.height),P(w.j)}))}function dX(w,N){var I=w.h;if(w.s===void 0){var P=Sa(I,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),V=Sa(I,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),H=I.createProgram();if(I.attachShader(H,P),I.attachShader(H,V),I.linkProgram(H),!I.getProgramParameter(H,I.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+I.getProgramInfoLog(H));P=w.s=H,I.useProgram(P),V=I.getUniformLocation(P,"sampler0"),w.l={O:I.getAttribLocation(P,"aVertex"),N:I.getAttribLocation(P,"aTex"),ya:V},w.v=I.createBuffer(),I.bindBuffer(I.ARRAY_BUFFER,w.v),I.enableVertexAttribArray(w.l.O),I.vertexAttribPointer(w.l.O,2,I.FLOAT,!1,0,0),I.bufferData(I.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),I.STATIC_DRAW),I.bindBuffer(I.ARRAY_BUFFER,null),w.u=I.createBuffer(),I.bindBuffer(I.ARRAY_BUFFER,w.u),I.enableVertexAttribArray(w.l.N),I.vertexAttribPointer(w.l.N,2,I.FLOAT,!1,0,0),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),I.STATIC_DRAW),I.bindBuffer(I.ARRAY_BUFFER,null),I.uniform1i(V,0)}P=w.l,I.useProgram(w.s),I.canvas.width=N.width,I.canvas.height=N.height,I.viewport(0,0,N.width,N.height),I.activeTexture(I.TEXTURE0),w.i.bindTexture2d(N.glName),I.enableVertexAttribArray(P.O),I.bindBuffer(I.ARRAY_BUFFER,w.v),I.vertexAttribPointer(P.O,2,I.FLOAT,!1,0,0),I.enableVertexAttribArray(P.N),I.bindBuffer(I.ARRAY_BUFFER,w.u),I.vertexAttribPointer(P.N,2,I.FLOAT,!1,0,0),I.bindFramebuffer(I.DRAW_FRAMEBUFFER?I.DRAW_FRAMEBUFFER:I.FRAMEBUFFER,null),I.clearColor(0,0,0,0),I.clear(I.COLOR_BUFFER_BIT),I.colorMask(!0,!0,!0,!0),I.drawArrays(I.TRIANGLE_FAN,0,4),I.disableVertexAttribArray(P.O),I.disableVertexAttribArray(P.N),I.bindBuffer(I.ARRAY_BUFFER,null),w.i.bindTexture2d(0)}function hX(w){this.h=w}var fX=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function pX(w,N){return N+w}function g3(w,N){window[w]=N}function mX(w){var N=document.createElement("script");return N.setAttribute("src",w),N.setAttribute("crossorigin","anonymous"),new Promise(function(I){N.addEventListener("load",function(){I()},!1),N.addEventListener("error",function(){I()},!1),document.body.appendChild(N)})}function gX(){return j(function(w){switch(w.h){case 1:return w.s=2,C(w,WebAssembly.instantiate(fX),4);case 4:w.h=3,w.s=0;break;case 2:return w.s=0,w.l=null,w.return(!1);case 3:return w.return(!0)}})}function c2(w){if(this.h=w,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=w&&w.locateFile||pX,typeof window=="object")var N=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")N=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=N,w.options){N=a(Object.keys(w.options));for(var I=N.next();!I.done;I=N.next()){I=I.value;var P=w.options[I].default;P!==void 0&&(this.l[I]=typeof P=="function"?P():P)}}}t=c2.prototype,t.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function xX(w){var N,I,P,V,H,W,se,ye,Le,tt,Gt;return j(function(Rt){switch(Rt.h){case 1:return w.ga?(N=w.h.files===void 0?[]:typeof w.h.files=="function"?w.h.files(w.l):w.h.files,C(Rt,gX(),2)):Rt.return();case 2:if(I=Rt.i,typeof window=="object")return g3("createMediapipeSolutionsWasm",{locateFile:w.locateFile}),g3("createMediapipeSolutionsPackedAssets",{locateFile:w.locateFile}),W=N.filter(function(ht){return ht.data!==void 0}),se=N.filter(function(ht){return ht.data===void 0}),ye=Promise.all(W.map(function(ht){var Kt=ty(w,ht.url);if(ht.path!==void 0){var mn=ht.path;Kt=Kt.then(function(Ss){return w.overrideFile(mn,Ss),Promise.resolve(Ss)})}return Kt})),Le=Promise.all(se.map(function(ht){return ht.simd===void 0||ht.simd&&I||!ht.simd&&!I?mX(w.locateFile(ht.url,w.ha)):Promise.resolve()})).then(function(){var ht,Kt,mn;return j(function(Ss){if(Ss.h==1)return ht=window.createMediapipeSolutionsWasm,Kt=window.createMediapipeSolutionsPackedAssets,mn=w,C(Ss,ht(Kt),2);mn.i=Ss.i,Ss.h=0})}),tt=function(){return j(function(ht){return w.h.graph&&w.h.graph.url?ht=C(ht,ty(w,w.h.graph.url),0):(ht.h=0,ht=void 0),ht})}(),C(Rt,Promise.all([Le,ye,tt]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return P=N.filter(function(ht){return ht.simd===void 0||ht.simd&&I||!ht.simd&&!I}).map(function(ht){return w.locateFile(ht.url,w.ha)}),importScripts.apply(null,l(P)),V=w,C(Rt,createMediapipeSolutionsWasm(Module),6);case 6:V.i=Rt.i,w.m=new OffscreenCanvas(1,1),w.i.canvas=w.m,H=w.i.GL.createContext(w.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),w.i.GL.makeContextCurrent(H),Rt.h=4;break;case 7:if(w.m=document.createElement("canvas"),Gt=w.m.getContext("webgl2",{}),!Gt&&(Gt=w.m.getContext("webgl",{}),!Gt))return alert("Failed to create WebGL canvas context when passing video frame."),Rt.return();w.K=Gt,w.i.canvas=w.m,w.i.createContext(w.m,!0,!0,{});case 4:w.j=new w.i.SolutionWasm,w.ga=!1,Rt.h=0}})}function yX(w){var N,I,P,V,H,W,se,ye;return j(function(Le){if(Le.h==1){if(w.h.graph&&w.h.graph.url&&w.fa===w.h.graph.url)return Le.return();if(w.u=!0,!w.h.graph||!w.h.graph.url){Le.h=2;return}return w.fa=w.h.graph.url,C(Le,ty(w,w.h.graph.url),3)}for(Le.h!=2&&(N=Le.i,w.j.loadGraph(N)),I=a(Object.keys(w.D)),P=I.next();!P.done;P=I.next())V=P.value,w.j.overrideFile(V,w.D[V]);if(w.D={},w.h.listeners)for(H=a(w.h.listeners),W=H.next();!W.done;W=H.next())se=W.value,SX(w,se);ye=w.l,w.l={},w.setOptions(ye),Le.h=0})}t.reset=function(){var w=this;return j(function(N){w.j&&(w.j.reset(),w.s={},w.v={}),N.h=0})},t.setOptions=function(w,N){var I=this;if(N=N||this.h.options){for(var P=[],V=[],H={},W=a(Object.keys(w)),se=W.next();!se.done;H={X:H.X,Y:H.Y},se=W.next())if(se=se.value,!(se in this.l&&this.l[se]===w[se])){this.l[se]=w[se];var ye=N[se];ye!==void 0&&(ye.onChange&&(H.X=ye.onChange,H.Y=w[se],P.push(function(Le){return function(){var tt;return j(function(Gt){if(Gt.h==1)return C(Gt,Le.X(Le.Y),2);tt=Gt.i,tt===!0&&(I.u=!0),Gt.h=0})}}(H))),ye.graphOptionXref&&(se=Object.assign({},{calculatorName:"",calculatorIndex:0},ye.graphOptionXref,{valueNumber:ye.type===1?w[se]:0,valueBoolean:ye.type===0?w[se]:!1,valueString:ye.type===2?w[se]:""}),V.push(se)))}(P.length!==0||V.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(V),this.F=(this.F===void 0?[]:this.F).concat(P))}};function vX(w){var N,I,P,V,H,W,se;return j(function(ye){switch(ye.h){case 1:if(!w.u)return ye.return();if(!w.F){ye.h=2;break}N=a(w.F),I=N.next();case 3:if(I.done){ye.h=5;break}return P=I.value,C(ye,P(),4);case 4:I=N.next(),ye.h=3;break;case 5:w.F=void 0;case 2:if(w.H){for(V=new w.i.GraphOptionChangeRequestList,H=a(w.H),W=H.next();!W.done;W=H.next())se=W.value,V.push_back(se);w.j.changeOptions(V),V.delete(),w.H=void 0}w.u=!1,ye.h=0}})}t.initialize=function(){var w=this;return j(function(N){return N.h==1?C(N,xX(w),2):N.h!=3?C(N,yX(w),3):C(N,vX(w),0)})};function ty(w,N){var I,P;return j(function(V){return N in w.L?V.return(w.L[N]):(I=w.locateFile(N,""),P=fetch(I).then(function(H){return H.arrayBuffer()}),w.L[N]=P,V.return(P))})}t.overrideFile=function(w,N){this.j?this.j.overrideFile(w,N):this.D[w]=N},t.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},t.send=function(w,N){var I=this,P,V,H,W,se,ye,Le,tt,Gt;return j(function(Rt){switch(Rt.h){case 1:return I.h.inputs?(P=1e3*(N??performance.now()),C(Rt,I.I,2)):Rt.return();case 2:return C(Rt,I.initialize(),3);case 3:for(V=new I.i.PacketDataList,H=a(Object.keys(w)),W=H.next();!W.done;W=H.next())if(se=W.value,ye=I.h.inputs[se]){e:{var ht=w[se];switch(ye.type){case"video":var Kt=I.s[ye.stream];if(Kt||(Kt=new l2(I.i,I.K),I.s[ye.stream]=Kt),Kt.m===0&&(Kt.m=Kt.i.createTexture()),typeof HTMLVideoElement<"u"&&ht instanceof HTMLVideoElement)var mn=ht.videoWidth,Ss=ht.videoHeight;else typeof HTMLImageElement<"u"&&ht instanceof HTMLImageElement?(mn=ht.naturalWidth,Ss=ht.naturalHeight):(mn=ht.width,Ss=ht.height);Ss={glName:Kt.m,width:mn,height:Ss},mn=Kt.h,mn.canvas.width=Ss.width,mn.canvas.height=Ss.height,mn.activeTexture(mn.TEXTURE0),Kt.i.bindTexture2d(Kt.m),mn.texImage2D(mn.TEXTURE_2D,0,mn.RGBA,mn.RGBA,mn.UNSIGNED_BYTE,ht),Kt.i.bindTexture2d(0),Kt=Ss;break e;case"detections":for(Kt=I.s[ye.stream],Kt||(Kt=new hX(I.i),I.s[ye.stream]=Kt),Kt.data||(Kt.data=new Kt.h.DetectionListData),Kt.data.reset(ht.length),Ss=0;Ss<ht.length;++Ss){mn=ht[Ss];var ms=Kt.data,Rr=ms.setBoundingBox,zo=Ss,Pi=mn.la,Mn=new cs;if(Zt(Mn,1,Pi.sa),Zt(Mn,2,Pi.ta),Zt(Mn,3,Pi.height),Zt(Mn,4,Pi.width),Zt(Mn,5,Pi.rotation),Xs(Mn,6,Pi.pa),Pi=Mn.l(),Rr.call(ms,zo,Pi),mn.ea)for(ms=0;ms<mn.ea.length;++ms){Mn=mn.ea[ms],Rr=Kt.data,zo=Rr.addNormalizedLandmark,Pi=Ss,Mn=Object.assign({},Mn,{visibility:Mn.visibility?Mn.visibility:0});var Pr=new kn;Zt(Pr,1,Mn.x),Zt(Pr,2,Mn.y),Zt(Pr,3,Mn.z),Mn.visibility&&Zt(Pr,4,Mn.visibility),Mn=Pr.l(),zo.call(Rr,Pi,Mn)}if(mn.ba)for(ms=0;ms<mn.ba.length;++ms)Rr=Kt.data,zo=Rr.addClassification,Pi=Ss,Mn=mn.ba[ms],Pr=new Rs,Zt(Pr,2,Mn.qa),Mn.index&&Xs(Pr,1,Mn.index),Mn.label&&Xs(Pr,3,Mn.label),Mn.displayName&&Xs(Pr,4,Mn.displayName),Mn=Pr.l(),zo.call(Rr,Pi,Mn)}Kt=Kt.data;break e;default:Kt={}}}switch(Le=Kt,tt=ye.stream,ye.type){case"video":V.pushTexture2d(Object.assign({},Le,{stream:tt,timestamp:P}));break;case"detections":Gt=Le,Gt.stream=tt,Gt.timestamp=P,V.pushDetectionList(Gt);break;default:throw Error("Unknown input config type: '"+ye.type+"'")}}return I.j.send(V),C(Rt,I.I,4);case 4:V.delete(),Rt.h=0}})};function bX(w,N,I){var P,V,H,W,se,ye,Le,tt,Gt,Rt,ht,Kt,mn,Ss;return j(function(ms){switch(ms.h){case 1:if(!I)return ms.return(N);for(P={},V=0,H=a(Object.keys(I)),W=H.next();!W.done;W=H.next())se=W.value,ye=I[se],typeof ye!="string"&&ye.type==="texture"&&N[ye.stream]!==void 0&&++V;1<V&&(w.M=!1),Le=a(Object.keys(I)),W=Le.next();case 2:if(W.done){ms.h=4;break}if(tt=W.value,Gt=I[tt],typeof Gt=="string")return mn=P,Ss=tt,C(ms,wX(w,tt,N[Gt]),14);if(Rt=N[Gt.stream],Gt.type==="detection_list"){if(Rt){for(var Rr=Rt.getRectList(),zo=Rt.getLandmarksList(),Pi=Rt.getClassificationsList(),Mn=[],Pr=0;Pr<Rr.size();++Pr){var zc=li(Rr.get(Pr)),CX=yr(zc,1),kX=yr(zc,2),NX=yr(zc,3),TX=yr(zc,4),_X=yr(zc,5,0),ny=void 0;ny=ny===void 0?0:ny,zc={la:{sa:CX,ta:kX,height:NX,width:TX,rotation:_X,pa:Ri($r(zc,6),ny)},ea:a2(zo.get(Pr)),ba:Vc(Jt(Pi.get(Pr)))},Mn.push(zc)}Rr=Mn}else Rr=[];P[tt]=Rr,ms.h=7;break}if(Gt.type==="proto_list"){if(Rt){for(Rr=Array(Rt.size()),zo=0;zo<Rt.size();zo++)Rr[zo]=Rt.get(zo);Rt.delete()}else Rr=[];P[tt]=Rr,ms.h=7;break}if(Rt===void 0){ms.h=3;break}if(Gt.type==="float_list"){P[tt]=Rt,ms.h=7;break}if(Gt.type==="proto"){P[tt]=Rt,ms.h=7;break}if(Gt.type!=="texture")throw Error("Unknown output config type: '"+Gt.type+"'");return ht=w.v[tt],ht||(ht=new l2(w.i,w.K),w.v[tt]=ht),C(ms,m3(ht,Rt,w.M),13);case 13:Kt=ms.i,P[tt]=Kt;case 7:Gt.transform&&P[tt]&&(P[tt]=Gt.transform(P[tt])),ms.h=3;break;case 14:mn[Ss]=ms.i;case 3:W=Le.next(),ms.h=2;break;case 4:return ms.return(P)}})}function wX(w,N,I){var P;return j(function(V){return typeof I=="number"||I instanceof Uint8Array||I instanceof w.i.Uint8BlobList?V.return(I):I instanceof w.i.Texture2dDataOut?(P=w.v[N],P||(P=new l2(w.i,w.K),w.v[N]=P),V.return(m3(P,I,w.M))):V.return(void 0)})}function SX(w,N){for(var I=N.name||"$",P=[].concat(l(N.wants)),V=new w.i.StringList,H=a(N.wants),W=H.next();!W.done;W=H.next())V.push_back(W.value);H=w.i.PacketListener.implement({onResults:function(se){for(var ye={},Le=0;Le<N.wants.length;++Le)ye[P[Le]]=se.get(Le);var tt=w.listeners[I];tt&&(w.I=bX(w,ye,N.outs).then(function(Gt){Gt=tt(Gt);for(var Rt=0;Rt<N.wants.length;++Rt){var ht=ye[P[Rt]];typeof ht=="object"&&ht.hasOwnProperty&&ht.hasOwnProperty("delete")&&ht.delete()}Gt&&(w.I=Gt)}))}}),w.j.attachMultiListener(V,H),V.delete()}t.onResults=function(w,N){this.listeners[N||"$"]=w},q("Solution",c2),q("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function x3(w){switch(w===void 0&&(w=0),w){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function y3(w){var N=this;w=w||{},this.h=new c2({locateFile:w.locateFile,files:function(I){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:x3(I.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:a2},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:a2},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(I){var P,V,H;return j(function(W){return W.h==1?(P=x3(I),V="third_party/mediapipe/modules/pose_landmark/"+P,C(W,ty(N.h,P),2)):(H=W.i,N.h.overrideFile(V,H),W.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}t=y3.prototype,t.reset=function(){this.h.reset()},t.close=function(){return this.h.close(),Promise.resolve()},t.onResults=function(w){this.h.onResults(w)},t.initialize=function(){var w=this;return j(function(N){return C(N,w.h.initialize(),0)})},t.send=function(w,N){var I=this;return j(function(P){return C(P,I.h.send(w,N),0)})},t.setOptions=function(w){this.h.setOptions(w)},q("Pose",y3),q("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),q("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),q("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),q("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),q("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),q("VERSION","0.5.1675469404")}).call(Cl);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ene=1e-7,$ne=1e-4;class _z{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class z_{refCount(e){return Ai("refCount")}incRef(e){return Ai("incRef")}timerAvailable(){return!0}time(e){return Ai("time")}read(e){return Ai("read")}readSync(e){return Ai("readSync")}readToGPU(e,n){return Ai("readToGPU")}numDataIds(){return Ai("numDataIds")}disposeData(e,n){return Ai("disposeData")}write(e,n,s){return Ai("write")}move(e,n,s,r,i){return Ai("move")}createTensorFromGPUData(e,n,s){return Ai("createTensorFromGPUData")}memory(){return Ai("memory")}floatPrecision(){return Ai("floatPrecision")}epsilon(){return this.floatPrecision()===32?Ene:$ne}dispose(){return Ai("dispose")}}function Ai(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nb(t,e,n){return Math.max(t,Math.min(e,n))}function W_(t){return t%2===0?t:t+1}function Bm(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function Ez(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function O(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Qi(t,e,n=""){O(Gn(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function cm(t){O(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function be(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function hj(t){return t.length===0}function Ine(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function Gn(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ap(t){return t%1===0}function Rk(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function np(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function fj(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function $z(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function bs(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),O(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),O(t.every(s=>Ap(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function rd(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:bs(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function Dl(t,e){return or(t,e)}function or(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function Rne(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function Pne(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Iz(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Tb(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function Ane(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Nx(t){return typeof t=="string"||t instanceof String}function jne(t){return typeof t=="boolean"}function Dne(t){return typeof t=="number"}function um(t){return Array.isArray(t)?um(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Dne(t)?"float32":Nx(t)?"string":jne(t)?"bool":"float32"}function Pk(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Ak(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Ms(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function Rz(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=Rz(t+l*a,o,n,s)}return r}function jk(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Rz(0,t,e,n)}function K2(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Pz(t,e){const n=Nc(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Nc(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Do(t){t.forEach(e=>{O(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Dk(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function U_(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function yh(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pj="tfjsflags";class One{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Fne,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(yh(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);pj in e&&e[pj].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=Lne(r,i)})}}function Fne(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(Mne(e,s[0],s[1]),s.join("="))),e}function Mne(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Lne(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function ue(){return Az}let Az=null;function Bne(t){Az=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let q2;function jz(){if(q2==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");q2=t}return q2}function Vne(){const t=jz();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function H_(t,e){const n=Vne();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const G_="Abs",K_="Acos",q_="Acosh",c1="Add",X_="AddN",Y_="All",Q_="Any",Z_="ArgMax",J_="ArgMin",eE="Asin",tE="Asinh",nE="Atan",sE="Atanh",rE="Atan2",iE="AvgPool",Dz="AvgPoolGrad",oE="AvgPool3D",Oz="AvgPool3DGrad",aE="BatchMatMul",lE="BatchToSpaceND",cE="Bincount",Fz="BitwiseAnd",uE="BroadcastArgs",u1="Cast",dE="Ceil",hE="ClipByValue",fE="Complex",pE="ComplexAbs",mE="Concat",gE="Conv2D",xE="Conv2DBackpropFilter",yE="Conv2DBackpropInput",vE="Conv3D",Mz="Conv3DBackpropFilterV2",bE="Conv3DBackpropInputV2",wE="Cos",SE="Cosh",CE="Cumprod",kE="Cumsum",NE="CropAndResize",TE="DenseBincount",_E="DepthToSpace",EE="DepthwiseConv2dNative",$E="DepthwiseConv2dNativeBackpropFilter",IE="DepthwiseConv2dNativeBackpropInput",RE="Diag",PE="Dilation2D",zne="Dilation2DBackpropInput",Wne="Dilation2DBackpropFilter",Lz="Draw",AE="RealDiv",jE="Einsum",DE="Elu",Bz="EluGrad",OE="Erf",FE="Equal",ME="Exp",LE="ExpandDims",BE="Expm1",VE="FFT",zE="Fill",WE="FlipLeftRight",UE="Floor",HE="FloorDiv",GE="FusedBatchNorm",KE="GatherV2",qE="GatherNd",XE="Greater",YE="GreaterEqual",d1="Identity",QE="IFFT",ZE="Imag",JE="IsFinite",e$="IsInf",t$="IsNan",n$="LeakyRelu",s$="Less",r$="LessEqual",i$="LinSpace",o$="Log",a$="Log1p",l$="LogicalAnd",c$="LogicalNot",u$="LogicalOr",d$="LRN",Vz="LRNGrad",h$="Max",f$="Maximum",p$="MaxPool",zz="MaxPoolGrad",m$="MaxPool3D",Wz="MaxPool3DGrad",g$="MaxPoolWithArgmax",x$="Mean",y$="Min",v$="Minimum",b$="MirrorPad",w$="Mod",S$="Multinomial",C$="Multiply",k$="Neg",N$="NotEqual",T$="NonMaxSuppressionV3",Uz="NonMaxSuppressionV4",_$="NonMaxSuppressionV5",E$="OnesLike",$$="OneHot",I$="Pack",R$="PadV2",P$="Pow",A$="Prelu",j$="Prod",Hz="RaggedGather",Gz="RaggedRange",Kz="RaggedTensorToTensor",D$="Range",O$="Real",F$="Reciprocal",M$="Relu",L$="Reshape",B$="ResizeNearestNeighbor",qz="ResizeNearestNeighborGrad",V$="ResizeBilinear",Xz="ResizeBilinearGrad",z$="Relu6",W$="Reverse",U$="Round",H$="Rsqrt",G$="ScatterNd",K$="TensorScatterUpdate",q$="SearchSorted",X$="Select",Y$="Selu",Q$="Slice",Z$="Sin",J$="Sinh",eI="Sign",tI="Sigmoid",nI="Softplus",sI="Sqrt",rI="Sum",iI="SpaceToBatchND",oI="SplitV",aI="Softmax",Yz="SparseFillEmptyRows",Qz="SparseReshape",lI="SparseSegmentMean",cI="SparseSegmentSum",uI="SparseToDense",dI="SquaredDifference",Zz="Square",Jz="StaticRegexReplace",hI="StridedSlice",fI="StringNGrams",eW="StringSplit",tW="StringToHashBucketFast",pI="Sub",mI="Tan",gI="Tanh",h1="Tile",xI="TopK",yI="Transform",Dg="Transpose",nW="Unique",vI="Unpack",bI="UnsortedSegmentSum",wI="ZerosLike",SI="Step",_b="FromPixels",CI="RotateWithOffset",Eb="_FusedMatMul",$b="FusedConv2D",Ib="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Da(...t){ue().getBool("IS_TEST")||ue().getBool("PROD")||console.warn(...t)}function Une(...t){ue().getBool("IS_TEST")||ue().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rb=H_("kernelRegistry",()=>new Map),Hne=H_("gradRegistry",()=>new Map);function Pb(t,e){const n=rW(t,e);return Rb.get(n)}function mj(t){return Hne.get(t)}function gj(t){const e=Rb.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function sW(t){const{kernelName:e,backendName:n}=t,s=rW(e,n);Rb.has(s)&&Da(`The kernel '${e}' for backend '${n}' is already registered`),Rb.set(s,t)}function rW(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var oW=ys,ta=null;try{ta=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ys(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}ys.prototype.__isLong__;Object.defineProperty(ys.prototype,"__isLong__",{value:!0});function Zi(t){return(t&&t.__isLong__)===!0}ys.isLong=Zi;var xj={},yj={};function Bh(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=yj[t],s)?s:(n=vs(t,(t|0)<0?-1:0,!0),r&&(yj[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=xj[t],s)?s:(n=vs(t,t<0?-1:0,!1),r&&(xj[t]=n),n))}ys.fromInt=Bh;function na(t,e){if(isNaN(t))return e?Bd:sa;if(e){if(t<0)return Bd;if(t>=aW)return uW}else{if(t<=-bj)return Hi;if(t+1>=bj)return cW}return t<0?na(-t,e).neg():vs(t%jp|0,t/jp|0,e)}ys.fromNumber=na;function vs(t,e,n){return new ys(t,e,n)}ys.fromBits=vs;var Ab=Math.pow;function kI(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return sa;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return kI(t.substring(1),e,n).neg();for(var r=na(Ab(n,8)),i=sa,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=na(Ab(n,a));i=i.mul(c).add(na(l))}else i=i.mul(r),i=i.add(na(l))}return i.unsigned=e,i}ys.fromString=kI;function Za(t,e){return typeof t=="number"?na(t,e):typeof t=="string"?kI(t,e):vs(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}ys.fromValue=Za;var vj=65536,Gne=1<<24,jp=vj*vj,aW=jp*jp,bj=aW/2,wj=Bh(Gne),sa=Bh(0);ys.ZERO=sa;var Bd=Bh(0,!0);ys.UZERO=Bd;var Lf=Bh(1);ys.ONE=Lf;var lW=Bh(1,!0);ys.UONE=lW;var Ok=Bh(-1);ys.NEG_ONE=Ok;var cW=vs(-1,2147483647,!1);ys.MAX_VALUE=cW;var uW=vs(-1,-1,!0);ys.MAX_UNSIGNED_VALUE=uW;var Hi=vs(0,-2147483648,!1);ys.MIN_VALUE=Hi;var st=ys.prototype;st.toInt=function(){return this.unsigned?this.low>>>0:this.low};st.toNumber=function(){return this.unsigned?(this.high>>>0)*jp+(this.low>>>0):this.high*jp+(this.low>>>0)};st.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Hi)){var n=na(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=na(Ab(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=o.sub(l.mul(i)).toInt()>>>0,d=c.toString(e);if(o=l,o.isZero())return d+a;for(;d.length<6;)d="0"+d;a=""+d+a}};st.getHighBits=function(){return this.high};st.getHighBitsUnsigned=function(){return this.high>>>0};st.getLowBits=function(){return this.low};st.getLowBitsUnsigned=function(){return this.low>>>0};st.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Hi)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};st.isZero=function(){return this.high===0&&this.low===0};st.eqz=st.isZero;st.isNegative=function(){return!this.unsigned&&this.high<0};st.isPositive=function(){return this.unsigned||this.high>=0};st.isOdd=function(){return(this.low&1)===1};st.isEven=function(){return(this.low&1)===0};st.equals=function(e){return Zi(e)||(e=Za(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};st.eq=st.equals;st.notEquals=function(e){return!this.eq(e)};st.neq=st.notEquals;st.ne=st.notEquals;st.lessThan=function(e){return this.comp(e)<0};st.lt=st.lessThan;st.lessThanOrEqual=function(e){return this.comp(e)<=0};st.lte=st.lessThanOrEqual;st.le=st.lessThanOrEqual;st.greaterThan=function(e){return this.comp(e)>0};st.gt=st.greaterThan;st.greaterThanOrEqual=function(e){return this.comp(e)>=0};st.gte=st.greaterThanOrEqual;st.ge=st.greaterThanOrEqual;st.compare=function(e){if(Zi(e)||(e=Za(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};st.comp=st.compare;st.negate=function(){return!this.unsigned&&this.eq(Hi)?Hi:this.not().add(Lf)};st.neg=st.negate;st.add=function(e){Zi(e)||(e=Za(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,d=0,h=0,f=0,p=0;return p+=i+c,f+=p>>>16,p&=65535,f+=r+l,h+=f>>>16,f&=65535,h+=s+a,d+=h>>>16,h&=65535,d+=n+o,d&=65535,vs(f<<16|p,d<<16|h,this.unsigned)};st.subtract=function(e){return Zi(e)||(e=Za(e)),this.add(e.neg())};st.sub=st.subtract;st.multiply=function(e){if(this.isZero())return sa;if(Zi(e)||(e=Za(e)),ta){var n=ta.mul(this.low,this.high,e.low,e.high);return vs(n,ta.get_high(),this.unsigned)}if(e.isZero())return sa;if(this.eq(Hi))return e.isOdd()?Hi:sa;if(e.eq(Hi))return this.isOdd()?Hi:sa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wj)&&e.lt(wj))return na(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,d=e.low&65535,h=0,f=0,p=0,m=0;return m+=o*d,p+=m>>>16,m&=65535,p+=i*d,f+=p>>>16,p&=65535,p+=o*c,f+=p>>>16,p&=65535,f+=r*d,h+=f>>>16,f&=65535,f+=i*c,h+=f>>>16,f&=65535,f+=o*l,h+=f>>>16,f&=65535,h+=s*d+r*c+i*l+o*a,h&=65535,vs(p<<16|m,h<<16|f,this.unsigned)};st.mul=st.multiply;st.divide=function(e){if(Zi(e)||(e=Za(e)),e.isZero())throw Error("division by zero");if(ta){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?ta.div_u:ta.div_s)(this.low,this.high,e.low,e.high);return vs(n,ta.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Bd:sa;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Bd;if(e.gt(this.shru(1)))return lW;i=Bd}else{if(this.eq(Hi)){if(e.eq(Lf)||e.eq(Ok))return Hi;if(e.eq(Hi))return Lf;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(sa)?e.isNegative()?Lf:Ok:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(Hi))return this.unsigned?Bd:sa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=sa}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Ab(2,a-48),c=na(s),d=c.mul(e);d.isNegative()||d.gt(r);)s-=l,c=na(s,this.unsigned),d=c.mul(e);c.isZero()&&(c=Lf),i=i.add(c),r=r.sub(d)}return i};st.div=st.divide;st.modulo=function(e){if(Zi(e)||(e=Za(e)),ta){var n=(this.unsigned?ta.rem_u:ta.rem_s)(this.low,this.high,e.low,e.high);return vs(n,ta.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};st.mod=st.modulo;st.rem=st.modulo;st.not=function(){return vs(~this.low,~this.high,this.unsigned)};st.and=function(e){return Zi(e)||(e=Za(e)),vs(this.low&e.low,this.high&e.high,this.unsigned)};st.or=function(e){return Zi(e)||(e=Za(e)),vs(this.low|e.low,this.high|e.high,this.unsigned)};st.xor=function(e){return Zi(e)||(e=Za(e)),vs(this.low^e.low,this.high^e.high,this.unsigned)};st.shiftLeft=function(e){return Zi(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vs(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):vs(0,this.low<<e-32,this.unsigned)};st.shl=st.shiftLeft;st.shiftRight=function(e){return Zi(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?vs(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):vs(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};st.shr=st.shiftRight;st.shiftRightUnsigned=function(e){if(Zi(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return vs(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?vs(n,0,this.unsigned):vs(n>>>e-32,0,this.unsigned)};st.shru=st.shiftRightUnsigned;st.shr_u=st.shiftRightUnsigned;st.toSigned=function(){return this.unsigned?vs(this.low,this.high,!1):this};st.toUnsigned=function(){return this.unsigned?this:vs(this.low,this.high,!0)};st.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};st.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};st.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};ys.fromBytes=function(e,n,s){return s?ys.fromBytesLE(e,n):ys.fromBytesBE(e,n)};ys.fromBytesLE=function(e,n){return new ys(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};ys.fromBytesBE=function(e,n){return new ys(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const dW=Pw(oW),Kne=yL({__proto__:null,default:dW},[oW]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rd=dW||Kne;function f1(t){return Rd.fromString(t,!0,16)}const hW=f1("c3a5c85c97cb3127"),Cd=f1("b492b66fbe98f273"),Xr=f1("9ae16a3b2f90404f");function Fk(t){return t.xor(t.shru(47))}function fW(t,e,n){const s=t.slice(e,e+n);return Rd.fromBytes(Array.from(s),!0,!0)}function us(t,e){return fW(t,e,8)}function Sj(t,e){return fW(t,e,4)}function fr(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function Pu(t,e,n=f1("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function qne(t,e,n,s,r,i){r=r.add(t),i=fr(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(fr(r,44)),[r.add(s),i.add(o)]}function Ny(t,e,n,s){return qne(us(t,e),us(t,e+8),us(t,e+16),us(t,e+24),n,s)}function Xne(t,e=t.length){if(e>=8){const n=Xr.add(e*2),s=us(t,0).add(Xr),r=us(t,e-8),i=fr(r,37).mul(n).add(s),o=fr(s,25).add(r).mul(n);return Pu(i,o,n)}if(e>=4){const n=Xr.add(e*2),s=Sj(t,0);return Pu(s.shl(3).add(e),Sj(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return Fk(Xr.mul(i).xor(hW.mul(o))).mul(Xr)}return Xr}function Yne(t,e=t.length){const n=Xr.add(e*2),s=us(t,0).mul(Cd),r=us(t,8),i=us(t,e-8).mul(n),o=us(t,e-16).mul(Xr);return Pu(fr(s.add(r),43).add(fr(i,30)).add(o),s.add(fr(r.add(Xr),18)).add(i),n)}function Qne(t,e=t.length){const n=Xr.add(e*2),s=us(t,0).mul(Xr),r=us(t,8),i=us(t,e-8).mul(n),o=us(t,e-16).mul(Xr),a=fr(s.add(r),43).add(fr(i,30)).add(o),l=Pu(a,s.add(fr(r.add(Xr),18)).add(i),n),c=us(t,16).mul(n),d=us(t,24),h=a.add(us(t,e-32)).mul(n),f=l.add(us(t,e-24)).mul(n);return Pu(fr(c.add(d),43).add(fr(h,30)).add(f),c.add(fr(d.add(s),18)).add(h),n)}function Zne(t,e=t.length){const n=Rd.fromNumber(81,!0);if(e<=32)return e<=16?Xne(t,e):Yne(t,e);if(e<=64)return Qne(t,e);let s=n,r=n.mul(Cd).add(113),i=Fk(r.mul(Xr).add(113)).mul(Xr),o=[Rd.UZERO,Rd.UZERO],a=[Rd.UZERO,Rd.UZERO];s=s.mul(Xr).add(us(t,0));let l=0;const c=(e-1>>6)*64,d=c+(e-1&63)-63;do s=fr(s.add(r).add(o[0]).add(us(t,l+8)),37).mul(Cd),r=fr(r.add(o[1]).add(us(t,l+48)),42).mul(Cd),s=s.xor(a[1]),r=r.add(o[0]).add(us(t,l+40)),i=fr(i.add(a[0]),33).mul(Cd),o=Ny(t,l,o[1].mul(Cd),s.add(a[0])),a=Ny(t,l+32,i.add(a[1]),r.add(us(t,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const h=Cd.add(i.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=fr(s.add(r).add(o[0]).add(us(t,l+8)),37).mul(h),r=fr(r.add(o[1]).add(us(t,l+48)),42).mul(h),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(us(t,l+40))),i=fr(i.add(a[0]),33).mul(h),o=Ny(t,l,o[1].mul(h),s.add(a[0])),a=Ny(t,l+32,i.add(a[1]),r.add(us(t,l+16))),[i,s]=[s,i],Pu(Pu(o[0],a[0],h).add(Fk(r).mul(hW)).add(i),Pu(o[1],a[1],h).add(s),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dm(t,e){return e==="string"?Au(t):p1([t],e)}function Jne(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function p1(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=_c(t)),ue().getBool("DEBUG")&&Rne(t,e),Jne(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function $a(){return ue().platform.now()}function Au(t,e="utf-8"){return e=e||"utf-8",ue().platform.encode(t,e)}function Tc(t,e="utf-8"){return e=e||"utf-8",ue().platform.decode(t,e)}function pa(t){return ue().platform.isTypedArray!=null?ue().platform.isTypedArray(t):iW(t)}function _c(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||yh(t)||t==null||pa(t)&&n)e.push(t);else if(Array.isArray(t)||pa(t))for(let s=0;s<t.length;++s)_c(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)_c(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ese{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new nse)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=$a();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();o=Promise.resolve({kernelMs:$a()-a})}if(ue().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const d=r[c];d.data().then(h=>{tse(h,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function tse(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class nse{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?np(`${r}ms`,9):r.error,l=np(e,25),c=n.rank,d=n.size,h=np(n.shape.toString(),14);let f="";for(const p in i){const m=i[p];if(m!=null){const g=m.shape||n.shape,x=g.length;f+=`${p}: ${x}D ${x>0?g:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${h}	%c${d}	%c${f}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sse(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],d=c.inputs;for(const h in d){const f=d[h];let p=!1;for(let m=0;m<e.length;m++)if(s[f.id]){c.outputs.forEach(g=>s[g.id]=!0),p=!0,r[c.id]=!0;break}if(p)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],d=c.inputs;for(let h=0;h<c.outputs.length;h++)if(i[c.outputs[h].id]){for(const f in d)i[d[f].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(r[c.id]&&o[c.id]){const d={};for(const f in c.inputs){const p=c.inputs[f];s[p.id]&&(d[f]=p)}const h=Object.assign({},c);h.inputs=d,h.outputs=c.outputs,a.push(h)}}return a}function rse(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const d=i.inputs[l];if(!Gn(c.shape,d.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${d.shape}'`);if(t[d.id]==null)t[d.id]=c;else{const h=t[d.id];t[d.id]=s(h,c),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj=20,Vm=3,X2=7;function ise(t,e,n,s){const r=Ms(e),i=ose(t,e,n,r),o=e.length,a=_v(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function ose(t,e,n,s){const r=be(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?lg(t):t;if(a>1)for(let c=0;c<r/i;c++){const d=c*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],ag(l[d+h],0,n).length)}return o}function ag(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(X2))} + ${parseFloat(t[1].toFixed(X2))}j`:Nx(t)?s=`'${t}'`:n==="bool"?s=pW(t):s=parseFloat(t.toFixed(X2)).toString(),np(s,e)}function pW(t){return t===0?"false":"true"}function _v(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const g=lg(t);return[ag(g[0],0,n)]}return n==="bool"?[pW(t[0])]:[t[0].toString()]}if(l===1){if(a>Cj){const x=Vm*o;let y=Array.from(t.slice(0,x)),v=Array.from(t.slice((a-Vm)*o,a*o));return n==="complex64"&&(y=lg(y),v=lg(v)),["["+y.map((S,C)=>ag(S,r[C],n)).join(", ")+", ..., "+v.map((S,C)=>ag(S,r[a-Vm+C],n)).join(", ")+"]"]}return["["+(n==="complex64"?lg(t):Array.from(t)).map((x,y)=>ag(x,r[y],n)).join(", ")+"]"]}const c=e.slice(1),d=s.slice(1),h=s[0]*o,f=[];if(a>Cj){for(let g=0;g<Vm;g++){const x=g*h,y=x+h;f.push(..._v(t.slice(x,y),c,n,d,r,!1))}f.push("...");for(let g=a-Vm;g<a;g++){const x=g*h,y=x+h;f.push(..._v(t.slice(x,y),c,n,d,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*h,y=x+h;f.push(..._v(t.slice(x,y),c,n,d,r,g===a-1))}const p=l===2?",":"";f[0]="["+(a>0?f[0]+p:"");for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=`,
`;for(let g=2;g<l;g++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(i?"":m),f}function lg(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dp{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=be(e),s!=null){const r=s.length;O(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||or(n,this.size),this.strides=Ms(e)}set(e,...n){n.length===0&&(n=[0]),O(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Pa().makeTensor(this.values,this.shape,this.dtype)}}let Pa=null,wf=null;function ase(t){Pa=t}function lse(t){wf=t}class js{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=be(e),this.strides=Ms(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return wf.buffer(this.shape,this.dtype,e)}bufferSync(){return wf.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return jk(this.shape,e,this.dtype==="complex64")}arraySync(){return jk(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Pa().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>Tc(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Pa().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Pa().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Tc(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Pa().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Pa().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return wf.print(this,e)}clone(){return this.throwIfDisposed(),wf.clone(this)}toString(e=!1){const n=this.dataSync();return ise(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),wf.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Pa().makeVariable(this,e,n,s)}}Object.defineProperty(js,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function mW(){return H_("Tensor",()=>js)}mW();class jb extends js{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Gn(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Pa().disposeTensor(this),this.dataId=e.dataId,Pa().incRef(this,null)}dispose(){Pa().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(jb,Symbol.hasInstance,{value:t=>t instanceof js&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kj;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(kj||(kj={}));var Mk;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(Mk||(Mk={}));var Lk;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(Lk||(Lk={}));var Bk;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(Bk||(Bk={}));var Vk;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(Vk||(Vk={}));const cse={float32:Bk,int32:Mk,bool:Lk,complex64:Vk};function wi(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return cse[t][e]}function m1(t){return wi(t,"int32")}function gW(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function xW(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bs(t,e){if(t.dtype===e.dtype)return[t,e];const n=wi(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function use(t,e){O(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function yW(t){const e=[];return vW(t,e,new Set),e}function vW(t,e,n){if(t==null)return;if(t instanceof js){e.push(t);return}if(!dse(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),vW(i,e,n))}}function dse(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2(t){return t.kernelName!=null}class Nj{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Op{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Nj}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Da(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ese(this.backendInstance),!0}setupRegisteredKernels(){gj(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){gj(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof z_)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Da(`Initialization of backend ${e} failed`),Da(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Da(`Initialization of backend ${e} failed`),Da(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return Op.nextTensorId++}nextVariableId(){return Op.nextVariableId++}clone(e){const n=Y.runKernel(d1,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return Y.runKernel(u1,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(Pb(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Y2(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Y2(e)){const{kernelName:m,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const y=Pb(m,this.backendName);O(y!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{const v=this.backend.numDataIds();l=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});const S=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,v,S);const C=S.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(r){const k=this.getTensorsForGradient(m,g,C);s=this.saveTensorsForBackwardMode(k)}return C}}else{const{forwardFunc:m}=e,g=x=>{r&&(s=x.map(y=>this.keep(this.clone(y))))};a=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>m(this.backend,g));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,x,y),y}}const{inputs:d,attrs:h}=e,f=Y2(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(c,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(c,d,n,f,s,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(m=>d[m]!=null?d[m].shape:null),outputShapes:n.map(m=>m.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=mj(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(O(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=i.map(c=>n[c]);const l=s.filter((c,d)=>o[d]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Nx(e[0])&&(i=e.map(l=>Au(l)));const o=r.write(i,n,s),a=new js(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),c=Ane(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new js(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new jb(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Tb(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof jb||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Tb(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=mj(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((d,h)=>{if(d==null){const f=s[h],p=Nc(f.size,f.dtype);return this.makeTensor(p,f.shape,f.dtype)}return d}),r(c.length>1?c:c[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=yW(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(O(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));O(i instanceof js,()=>"The result y returned by f() must be a tensor.");const o=sse(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??hse(i.shape),rse(a,o,c=>this.tidy(c),fse);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const d of c.saved)d.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return O(Pk(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{O(n.every(a=>a instanceof js),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),O(s.value instanceof js,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),O(Pk(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),d=Array.isArray(c)?c:[c];O(d.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),O(d.every(f=>f instanceof js),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return d.forEach((f,p)=>{h[p]=()=>f}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=$a(),s=await this.backend.time(e);return s.wallMs=$a()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Nj;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Op.nextTensorId=0;Op.nextVariableId=0;function hse(t){const e=Pz(be(t),"float32");return Y.makeTensor(e,t,"float32")}function bW(){const t=jz();if(t._tfengine==null){const e=new One(t);t._tfengine=new Op(e)}return Bne(t._tfengine.ENV),ase(()=>t._tfengine),t._tfengine}const Y=bW();function fse(t,e){const n={a:t,b:e};return Y.runKernel(c1,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(){return typeof navigator<"u"&&navigator!=null}function wW(t){if(t||pse()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function SW(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Si=ue();Si.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Si.registerFlag("IS_BROWSER",()=>SW());Si.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Si.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Si.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Si.registerFlag("PROD",()=>!1);Si.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Si.getBool("DEBUG"));Si.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Si.registerFlag("IS_TEST",()=>!1);Si.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Si.getBool("DEBUG"));Si.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Si.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Si.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function id(t,e){let n=t;if(pa(t))return e==="string"?[]:[t.length];if(gW(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(xW(t))return[t.buffer.size/(e==null?4:Tb(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||pa(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&ue().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&CW(t,s,[]),s}function CW(t,e,n){if(n=n||[],!Array.isArray(t)&&!pa(t)){O(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}O(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),O(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)CW(t[r],s,n.concat(r))}function Tj(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function D(t,e,n,s="numeric"){if(t instanceof mW())return Tj(s,t.dtype,e,n),t;let r=um(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),Tj(s,r,e,n),t==null||!pa(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=id(t,r);!pa(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?p1(t,r):_c(t,[],!0);return Y.makeTensor(a,i,r)}function Db(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>D(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW="__op";function K(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+kW;const r=(...i)=>{Y.startScope(n);try{const o=s(...i);return yh(o)&&console.error("Cannot return a Promise inside of tidy."),Y.endScope(o),o}catch(o){throw Y.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(t,e){const n=D(t,"real","complex"),s=D(e,"imag","complex");Qi(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return Y.runKernel(fE,r)}const Uu=K({complex_:mse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function od(t,e,n,s){if(s==null)s=um(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(xW(t)||gW(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Y.backend.createTensorFromGPUData(t,e||n,s)}if(!pa(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Do(e);const r=be(e),i=be(n);O(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==be(e.slice(o)):!0;O(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!pa(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?p1(t,s):_c(t,[],!0),Y.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function El(t,e,n){const s=id(t,n);return od(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vh={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Ja{static join(e){return new Ja(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>pa(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],h=e+a-c.start,f=a,m=Math.min(n,c.end)-c.start,g=new Uint8Array(c.buffer,h,m-h);if(o.set(g,f),a+=g.length,n<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=gse(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function gse(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Li(){return Y}function Wt(t,e){return Y.tidy(t,e)}function Un(t){yW(t).forEach(n=>n.dispose())}function yl(t){return Y.keep(t)}function xse(t){return Y.setBackend(t)}function yse(){return Y.ready()}function bh(){return Y.backendName}function NW(t,e,n=1){return Y.registerBackend(t,e,n)}function Fp(){return Y.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hu=4;async function vse(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async h=>{const f=await l.bytes(),p=f.reduce((x,y)=>x+y.length,0)+Hu*f.length,m=new Uint8Array(p);let g=0;for(let x=0;x<f.length;x++){const y=f[x],v=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(v,g),g+=Hu,m.set(y,g),g+=y.length}h(m)});s.push(d)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const i=await Promise.all(s);return{data:Sse(i),specs:n}}function TW(t,e){const n=new Ja(t),s={};let r=0;for(const i of e){const o=bse(i,(a,l)=>n.slice(r+a,r+l));s[i.name]=_W(i,n.slice(r,r+o)),r+=o}return s}function bse(t,e){const n=be(t.shape);let s;if("quantization"in t){const r=t.quantization;s=vh[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Hu+new Uint32Array(e(r,r+Hu))[0];return r}else s=vh[t.dtype];return n*s}async function wse(t,e){const n=be(t.shape);let s;if("quantization"in t){const r=t.quantization;s=vh[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Hu+new Uint32Array(await e(r,r+Hu))[0];return r}else s=vh[t.dtype];return n*s}function _W(t,e){const n=t.name,s=t.dtype,r=t.shape,i=be(r);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=vh[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];o[h]=f*l.scale+l.min}}else if(l.dtype==="float16")o=$se()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(d.length);for(let h=0;h<d.length;h++){const f=d[h];o[h]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*c}else if(s==="string"){const l=be(t.shape);o=[];for(let c=0;c<l;c++){const d=new Uint32Array(e.slice(a,a+Hu))[0];a+=Hu;const h=new Uint8Array(e.slice(a,a+d));o.push(h),a+=d}}else{const l=vh[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const c=new Float32Array(o.length/2),d=new Float32Array(o.length/2);for(let m=0;m<c.length;m++)c[m]=o[m*2],d[m]=o[m*2+1];const h=El(c,r,"float32"),f=El(d,r,"float32"),p=Uu(h,f);return h.dispose(),f.dispose(),p}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*l}return El(o,r,s)}async function _j(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:r,value:i}=await t.read();if(r&&i==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const o=new Uint8Array(s.length+i.byteLength);o.set(s,0),o.set(new Uint8Array(i),s.length),s=o}return s.buffer}async function EW(t,e){const n={},s=t.getReader();let r=new ArrayBuffer(0);for(const i of e){const o=await wse(i,async(c,d)=>(r=await _j(s,r,d),r.slice(c,d)));r=await _j(s,r,o);const a=r.slice(0,o);r=r.slice(o);const l=_W(i,a);if(n[i.name]=l,bh()==="webgpu"){const c=Fp();"uploadToGPU"in c&&be(l.shape)>=ue().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&c.uploadToGPU(l.dataId)}}return n}function Sse(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const NI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Ej(t){return NI?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function Cse(t){if(NI)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function kse(t){if(NI){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function Nse(t){return Ja.join(t)}function $j(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function $W(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function IW(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function TI(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),IW(t,n,s)}function Tx(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:Ej(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:Ej(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Ja(t.weightData).byteLength}}function zk(t){const e=[];for(const n of t)e.push(...n.weights);return e}function Tse(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function _se(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function Ese(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function $se(){const t=Tse(),e=_se(),n=Ese();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $s{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return $s.instance==null&&($s.instance=new $s),$s.instance}static registerSaveRouter(e){$s.getInstance().saveRouters.push(e)}static registerLoadRouter(e){$s.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return $s.getHandlers(e,"save")}static getLoadHandlers(e,n){return $s.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?$s.getInstance().loadRouters:$s.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const Ise=t=>$s.registerSaveRouter(t),Rse=t=>$s.registerLoadRouter(t),Pse=t=>$s.getSaveHandlers(t),Ase=(t,e)=>$s.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wk="tensorflowjs",Uk=1,Vd="models_store",vu="model_info_store";function RW(){if(!ue().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Hk(t){const e=t.result;e.createObjectStore(Vd,{keyPath:"modelPath"}),e.createObjectStore(vu,{keyPath:"modelPath"})}class wh{constructor(e){if(this.indexedDB=RW(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(Wk,Uk);i.onupgradeneeded=()=>Hk(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(Vd,"readonly"),c=a.objectStore(Vd).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=d=>(o.close(),r(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=Ja.join(n.weightData);const a=Tx(n),l=o.transaction(vu,"readwrite");let c=l.objectStore(vu),d;try{d=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return r(f)}let h;d.onsuccess=()=>{h=o.transaction(Vd,"readwrite");const f=h.objectStore(Vd);let p;try{p=f.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(m){return r(m)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=m=>{c=l.objectStore(vu);const g=c.delete(this.modelPath);g.onsuccess=()=>(o.close(),r(p.error)),g.onerror=x=>(o.close(),r(p.error))}},d.onerror=f=>(o.close(),r(d.error)),l.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}wh.URL_SCHEME="indexeddb://";const PW=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(wh.URL_SCHEME)?jse(t.slice(wh.URL_SCHEME.length)):null;$s.registerSaveRouter(PW);$s.registerLoadRouter(PW);function jse(t){return new wh(t)}function Dse(t){return t.startsWith(wh.URL_SCHEME)?t.slice(wh.URL_SCHEME.length):t}class Ose{constructor(){this.indexedDB=RW()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(Wk,Uk);s.onupgradeneeded=()=>Hk(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(vu,"readonly"),a=i.objectStore(vu).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=Dse(e),new Promise((n,s)=>{const r=this.indexedDB.open(Wk,Uk);r.onupgradeneeded=()=>Hk(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(vu,"readwrite"),a=o.objectStore(vu),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),h=()=>{c=i.transaction(Vd,"readwrite");const p=c.objectStore(Vd).delete(e);p.onsuccess=()=>n(l.result.modelArtifactsInfo),p.onerror=m=>s(l.error)};d.onsuccess=h,d.onerror=f=>(h(),i.close(),s(l.error))}},l.onerror=d=>(i.close(),s(l.error)),o.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc="/",Sf="tensorflowjs_models",AW="info",Fse="model_topology",Mse="weight_specs",Lse="weight_data",Bse="model_metadata";function jW(t){return{info:[Sf,t,AW].join(cc),topology:[Sf,t,Fse].join(cc),weightSpecs:[Sf,t,Mse].join(cc),weightData:[Sf,t,Lse].join(cc),modelMetadata:[Sf,t,Bse].join(cc)}}function DW(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Vse(t){const e=t.split(cc);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(cc)}function zse(t){return t.startsWith(Sh.URL_SCHEME)?t.slice(Sh.URL_SCHEME.length):t}class Sh{constructor(e){if(!ue().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=jW(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=Tx(e),i=Ja.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,Cse(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw DW(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=kse(o),n}}Sh.URL_SCHEME="localstorage://";const OW=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Sh.URL_SCHEME)?Wse(t.slice(Sh.URL_SCHEME.length)):null;$s.registerSaveRouter(OW);$s.registerLoadRouter(OW);function Wse(t){return new Sh(t)}class Use{constructor(){O(ue().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),O(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Sf+cc,s=cc+AW;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=Vse(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=zse(e);const n=jW(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return DW(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sp="://";class Kr{constructor(){this.managers={}}static getInstance(){return Kr.instance==null&&(Kr.instance=new Kr),Kr.instance}static registerManager(e,n){O(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(sp)&&(e=e.slice(0,e.indexOf(sp))),O(e.length>0,()=>"scheme must not be an empty string.");const s=Kr.getInstance();O(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Kr.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Kr.getInstance().managers)}}function Ev(t){if(t.indexOf(sp)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Kr.getSchemes().join(",")}`);return{scheme:t.split(sp)[0],path:t.split(sp)[1]}}async function FW(t,e,n=!1){O(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=$s.getLoadHandlers(t);O(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),O(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const r=s[0],i=$s.getSaveHandlers(e);O(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),O(i.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const o=i[0],a=Ev(t).scheme,l=Ev(t).path,c=a===Ev(t).scheme,d=await r.load();n&&c&&await Kr.getManager(a).removeModel(l);const h=await o.save(d);return n&&!c&&await Kr.getManager(a).removeModel(l),h.modelArtifactsInfo}async function Hse(){const t=Kr.getSchemes(),e={};for(const n of t){const s=await Kr.getManager(n).listModels();for(const r in s){const i=n+sp+r;e[i]=s[r]}}return e}async function Gse(t){const e=Ev(t);return Kr.getManager(e.scheme).removeModel(e.path)}async function Kse(t,e){return FW(t,e,!1)}async function qse(t,e){return FW(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xse{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!ue().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return iW(e)}}if(ue().get("IS_BROWSER")){ue().setPlatform("browser",new Xse);try{Kr.registerManager(Sh.URL_SCHEME,new Use)}catch{}try{Kr.registerManager(wh.URL_SCHEME,new Ose)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse={importFetch:()=>require("node-fetch")};let Q2;class Qse{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return ue().global.fetch!=null?ue().global.fetch(e,n):(Q2==null&&(Q2=Yse.importFetch()),Q2(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ue().get("IS_NODE")&&!ue().get("IS_BROWSER")&&ue().setPlatform("node",new Qse);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kn(t,e="float32",n){return e=e||"float32",Do(t),new Dp(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zse(t,e){const n=D(t,"x","cast");if(!Pne(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return Y.runKernel(u1,s,r)}const rs=K({cast_:Zse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(t){const n={x:D(t,"x","clone","string_or_numeric")};return Y.runKernel(d1,n)}const ju=K({clone_:Jse});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */bW();const ere={buffer:Kn,cast:rs,clone:ju,print:MW};lse(ere);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t,e){let n=D(t,"a","add"),s=D(e,"b","add");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(c1,r)}const Nt=K({add_:tre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nre(t,e){let n=D(t,"a","floorDiv"),s=D(e,"b","floorDiv");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(HE,r)}const LW=K({floorDiv_:nre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t,e){let n=D(t,"a","div"),s=D(e,"b","div");if([n,s]=Bs(n,s),n.dtype==="int32"&&s.dtype==="int32")return LW(n,s);const r={a:n,b:s},i={};return Y.runKernel(AE,r,i)}const dn=K({div_:sre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(t,e){let n=D(t,"a","mul"),s=D(e,"b","mul");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(C$,r)}const We=K({mul_:rre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ire(t){const e=D(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return Y.runKernel(pE,n)}else{const n={x:e};return Y.runKernel(G_,n)}}const ao=K({abs_:ire});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ore(t){const n={x:D(t,"x","acos")};return Y.runKernel(K_,n)}const are=K({acos_:ore});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lre(t){const n={x:D(t,"x","acosh")};return Y.runKernel(q_,n)}const cre=K({acosh_:lre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ure(t){O(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),O(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((r,i)=>D(r,`tensors${i}`,"addN")),n=e[0];e.forEach(r=>{if(r.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!Gn(r.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return Y.runKernel(X_,s)}const dre=K({addN_:ure});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(t,e=null,n=!1){const r={x:D(t,"x","all","bool")},i={axis:e,keepDims:n};return Y.runKernel(Y_,r,i)}const fre=K({all_:hre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pre(t,e=null,n=!1){const r={x:D(t,"x","any","bool")},i={axis:e,keepDims:n};return Y.runKernel(Q_,r,i)}const mre=K({any_:pre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gre(t,e=0){const s={x:D(t,"x","argMax")},r={axis:e};return Y.runKernel(Z_,s,r)}const BW=K({argMax_:gre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xre(t,e=0){const s={x:D(t,"x","argMin")},r={axis:e};return Y.runKernel(J_,s,r)}const yre=K({argMin_:xre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vre(t){const n={x:D(t,"x","asin")};return Y.runKernel(eE,n)}const bre=K({asin_:vre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(t){const n={x:D(t,"x","asinh")};return Y.runKernel(tE,n)}const Sre=K({asinh_:wre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t){const n={x:D(t,"x","atan")};return Y.runKernel(nE,n)}const kre=K({atan_:Cre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nre(t,e){let n=D(t,"a","atan2"),s=D(e,"b","atan2");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(rE,r)}const Tre=K({atan2_:Nre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _re(t){const n={x:D(t,"x","atanh")};return Y.runKernel(sE,n)}const Ere=K({atanh_:_re});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _x(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=el(r);return sr(t,a,n,i,s,null,null,l)}function ya(t,e,n,s,r,i,o="channelsLast"){const[a,l]=y0(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return sr(t,c,n,s,r,i,!1,o)}function Oc(t,e,n,s,r,i,o="NDHWC"){const[a,l,c]=Gk(e);let d,h;if(o==="NDHWC")h="channelsLast",d=[a,l,c,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",d=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return ad(t,d,n,s,r,!1,h,i)}function sr(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,c,d,h]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,d,h]=t;else if(a==="channelsFirst")[l,h,c,d]=t;else throw new Error(`Unknown dataFormat ${a}`);const[f,p,,m]=e,[g,x]=y0(n),[y,v]=y0(s),S=rp(f,y),C=rp(p,v),{padInfo:k,outHeight:T,outWidth:_}=Rre(r,c,d,g,x,S,C,i,a),$=o?m*h:m;let R;return a==="channelsFirst"?R=[l,$,T,_]:a==="channelsLast"&&(R=[l,T,_,$]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:d,inChannels:h,outHeight:T,outWidth:_,outChannels:$,padInfo:k,strideHeight:g,strideWidth:x,filterHeight:f,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:y,dilationWidth:v,inShape:t,outShape:R,filterShape:e}}function ad(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,c,d,h,f]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,d,h,f]=t;else if(o==="channelsFirst")[l,f,c,d,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[p,m,g,,x]=e,[y,v,S]=Gk(n),[C,k,T]=Gk(s),_=rp(p,C),$=rp(m,k),R=rp(g,T),{padInfo:A,outDepth:j,outHeight:F,outWidth:L}=Pre(r,c,d,h,y,v,S,_,$,R,a),M=i?x*f:x;let q;return o==="channelsFirst"?q=[l,M,j,F,L]:o==="channelsLast"&&(q=[l,j,F,L,M]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:d,inWidth:h,inChannels:f,outDepth:j,outHeight:F,outWidth:L,outChannels:M,padInfo:A,strideDepth:y,strideHeight:v,strideWidth:S,filterDepth:p,filterHeight:m,filterWidth:g,effectiveFilterDepth:_,effectiveFilterHeight:$,effectiveFilterWidth:R,dilationDepth:C,dilationHeight:k,dilationWidth:T,inShape:t,outShape:q,filterShape:e}}function $re(t,e,n,s,r){s==null&&(s=_I(t,e,n));const i=t[0],o=t[1],a=v0((i-e+2*s)/n+1,r),l=v0((o-e+2*s)/n+1,r);return[a,l]}function Ire(t,e,n,s,r,i){r==null&&(r=_I(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=v0((t[a]-e[a]+2*r)/s[a]+1,i));return o}function _I(t,e,n,s=1){const r=rp(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function y0(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function Gk(t){return typeof t=="number"?[t,t,t]:t}function rp(t,e){return e<=1?t:t+(t-1)*(e-1)}function Rre(t,e,n,s,r,i,o,a,l){let c,d,h;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=$re([e,n],i,s,t,a);d=p[0],h=p[1]}else if(t==="same"){d=Math.ceil(e/s),h=Math.ceil(n/r);const f=Math.max(0,(d-1)*s+i-e),p=Math.max(0,(h-1)*r+o-n),m=Math.floor(f/2),g=f-m,x=Math.floor(p/2),y=p-x;c={top:m,bottom:g,left:x,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-i+1)/s),h=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const f=l==="channelsLast"?t[1][0]:t[2][0],p=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],g=l==="channelsLast"?t[2][1]:t[3][1];c={top:f,bottom:p,left:m,right:g,type:f===0&&p===0&&m===0&&g===0?"VALID":"EXPLICIT"},d=v0((e-i+f+p)/s+1,a),h=v0((n-o+m+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:d,outWidth:h}}function Pre(t,e,n,s,r,i,o,a,l,c,d){let h,f,p,m;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const x=Ire([e,n,s,1],[a,l,c],1,[r,i,o],t,d);f=x[0],p=x[1],m=x[2]}else if(t==="same"){f=Math.ceil(e/r),p=Math.ceil(n/i),m=Math.ceil(s/o);const g=(f-1)*r+a-e,x=(p-1)*i+l-n,y=(m-1)*o+c-s,v=Math.floor(g/2),S=g-v,C=Math.floor(x/2),k=x-C,T=Math.floor(y/2),_=y-T;h={top:C,bottom:k,left:T,right:_,front:v,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:f,outHeight:p,outWidth:m}}function v0(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function b0(t){const[e,n,s]=y0(t);return e===1&&n===1&&s===1}function ri(t,e){return b0(t)||b0(e)}function Ch(t){return y0(t).every(e=>e>0)}function el(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function va(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")O(Ap(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{O(Ap(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Are(t,e){const s={x:D(t,"x","reshape","string_or_numeric")},r={shape:e};return Y.runKernel(L$,s,r)}const _e=K({reshape_:Are});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(t,e,n,s,r){const i=D(t,"x","avgPool","float32"),o=1;O(ri(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),va("avgPool",s,r);const c={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let h=Y.runKernel(iE,c,d);return h=rs(h,i.dtype),l?_e(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const VW=K({avgPool_:jre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(t,e,n,s,r,i="NDHWC"){const o=D(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),O(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),va("avgPool3d",s,r);const c={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let h=Y.runKernel(oE,c,d);return h=rs(h,a.dtype),l?_e(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Ore=K({avgPool3d_:Dre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t,e=0){O(t.length>=1,()=>"Pass at least one tensor to concat");const n=Db(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return ju(n[0]);const s=n,r={axis:e};return Y.runKernel(mE,s,r)}const gr=K({concat_:Fre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(t,e,n=!1,s=!1){let r=D(t,"a","matMul"),i=D(e,"b","matMul");[r,i]=Bs(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return Y.runKernel(aE,o,a)}const Zn=K({matMul_:Mre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lre(t){const n={x:D(t,"x","sigmoid","float32")};return Y.runKernel(tI,n)}const fc=K({sigmoid_:Lre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(t,e,n){const s=D(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return Y.runKernel(Q$,r,i)}const an=K({slice_:Bre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(t){const n={x:D(t,"x","tanh","float32")};return Y.runKernel(gI,n)}const Kk=K({tanh_:Vre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zre(t,e,n,s,r,i){const o=D(t,"forgetBias","basicLSTMCell"),a=D(e,"lstmKernel","basicLSTMCell"),l=D(n,"lstmBias","basicLSTMCell"),c=D(s,"data","basicLSTMCell"),d=D(r,"c","basicLSTMCell"),h=D(i,"h","basicLSTMCell"),f=gr([c,h],1),p=Zn(f,a),m=Nt(p,l),g=m.shape[0],x=m.shape[1]/4,y=[g,x],v=an(m,[0,0],y),S=an(m,[0,x],y),C=an(m,[0,x*2],y),k=an(m,[0,x*3],y),T=Nt(We(fc(v),Kk(S)),We(d,fc(Nt(o,C)))),_=We(Kk(T),fc(k));return[T,_]}const Wre=K({basicLSTMCell_:zre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t,e,n){const s=D(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);O(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),O(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),O(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return Y.runKernel(lE,i,o)}const zW=K({batchToSpaceND_:Ure});function Hre(t){let e;return t.rank===0||t.rank===1?e=_e(t,[1,1,1,t.size]):t.rank===2?e=_e(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=_e(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gre(t,e,n,s,r,i){i==null&&(i=.001);const o=D(t,"x","batchNorm"),a=D(e,"mean","batchNorm"),l=D(n,"variance","batchNorm");let c;r!=null&&(c=D(r,"scale","batchNorm"));let d;s!=null&&(d=D(s,"offset","batchNorm")),O(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:Hre(o),scale:c,offset:d,mean:a,variance:l},p={varianceEpsilon:i},m=Y.runKernel(GE,f,p);return _e(m,o.shape)}const g1=K({batchNorm_:Gre});function Kre(t,e,n,s,r,i){const o=D(t,"x","batchNorm"),a=D(e,"mean","batchNorm"),l=D(n,"variance","batchNorm");let c;r!=null&&(c=D(r,"scale","batchNorm"));let d;return s!=null&&(d=D(s,"offset","batchNorm")),O(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),O(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),O(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),d!=null&&O(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),g1(o,a,l,d,c,i)}const qre=K({batchNorm2d_:Kre});function Xre(t,e,n,s,r,i){const o=D(t,"x","batchNorm"),a=D(e,"mean","batchNorm"),l=D(n,"variance","batchNorm");let c;r!=null&&(c=D(r,"scale","batchNorm"));let d;return s!=null&&(d=D(s,"offset","batchNorm")),O(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),O(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),O(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),d!=null&&O(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),g1(o,a,l,d,c,i)}const Yre=K({batchNorm3d_:Xre});function Qre(t,e,n,s,r,i){const o=D(t,"x","batchNorm"),a=D(e,"mean","batchNorm"),l=D(n,"variance","batchNorm");let c;r!=null&&(c=D(r,"scale","batchNorm"));let d;return s!=null&&(d=D(s,"offset","batchNorm")),O(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),O(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),O(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&O(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),d!=null&&O(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),g1(o,a,l,d,c,i)}const Zre=K({batchNorm4d_:Qre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jre(t,e,n){const s=D(t,"x","bincount"),r=D(e,"weights","bincount");O(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),O(n>=0,()=>`size must be non-negative, but got ${n}.`),O(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return Y.runKernel(cE,i,o)}const WW=K({bincount_:Jre});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eie(t,e){const n=D(t,"x","bitwiseAnd"),s=D(e,"y","bitwiseAnd");if(!Gn(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const r={a:n,b:s};return Y.runKernel(Fz,r)}const tie=K({bitwiseAnd_:eie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nie(t,e){const n=D(t,"s0","broadcastArgs","int32"),s=D(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:n,s1:s};return Y.runKernel(uE,r)}const sie=K({broadcastArgs_:nie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(t,e){let n=D(t,"broadcastTo","x");const s=n.shape;if(Do(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=_e(n,c)}const r=n.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,d)=>c>1?d:-1).filter(c=>c>=0).length===0)return ju(n);const a={x:n},l={reps:i};return Y.runKernel(h1,a,l)}const Og=K({broadcastTo_:rie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iie(t){const n={x:D(t,"x","ceil","float32")};return Y.runKernel(dE,n)}const oie=K({ceil_:iie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ex(t,e,n){Do(t),n=n||um(e);const s={shape:t,value:e,dtype:n};return Y.runKernel(zE,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(t,e,n){const s=D(t,"x","clipByValue");if(O(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Ex(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return Y.runKernel(hE,r,i)}const UW=K({clipByValue_:aie});function lie(t){return gr(t,0)}const cie=K({concat1d_:lie});function uie(t,e){return gr(t,e)}const die=K({concat2d_:uie});function hie(t,e){return gr(t,e)}const fie=K({concat3d_:hie});function pie(t,e){return gr(t,e)}const mie=K({concat4d_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t,e,n,s,r="NHWC",i=[1,1],o){const a=D(t,"x","conv2d","float32"),l=D(e,"filter","conv2d","float32");let c=a,d=!1;a.rank===3&&(d=!0,c=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),O(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),va("conv2d",s,o);const h=r==="NHWC"?c.shape[3]:c.shape[1];O(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),O(ri(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),O(Ch(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),O(Ch(n),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},m=Y.runKernel(gE,f,p);return d?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const x1=K({conv2d_:gie});function xie(t,e,n,s,r="NWC",i=1,o){const a=D(t,"x","conv1d"),l=D(e,"filter","conv1d");let c=a,d=!1;a.rank===2&&(d=!0,c=_e(a,[1,a.shape[0],a.shape[1]])),O(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),O(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),va("conv1d",s,o),O(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),O(ri(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),O(Ch(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),O(Ch(n),()=>"Error in conv1D: Stride should be larger than 0."),O(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=_e(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=_e(c,[c.shape[0],1,c.shape[1],c.shape[2]]),x=x1(f,h,[1,n],s,"NHWC",[1,i],o);return d?_e(x,[x.shape[2],x.shape[3]]):_e(x,[x.shape[0],x.shape[2],x.shape[3]])}const yie=K({conv1d_:xie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vie(t,e,n,s,r,i="NHWC",o){O(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),O(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),O(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),O(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const d=i==="NHWC"?a[3]:a[1],h=i==="NHWC"?l.shape[3]:l.shape[1];O(d===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${n.shape[2]}.`),O(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),va("conv2dDerInput",r,o);const f={dy:l,filter:n},p={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},m=Y.runKernel(yE,f,p);return c?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const HW=K({conv2DBackpropInput_:vie});function bie(t,e,n,s,r,i){const o=D(t,"x","conv2dTranspose"),a=D(e,"filter","conv2dTranspose");return HW(n,o,a,s,r,"NHWC",i)}const wie=K({conv2dTranspose_:bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sie(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=D(t,"x","conv3d"),a=D(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),O(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),O(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),O(ri(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),O(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),O(Ch(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),O(Ch(n),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},h={strides:n,pad:s,dataFormat:r,dilations:i},f=Y.runKernel(vE,d,h);return c?_e(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Cie=K({conv3d_:Sie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(t,e,n,s,r){O(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=_e(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],c=o.shape[4];O(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),O(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),O(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),O(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),O(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const d={dy:o,filter:n},h={pad:r,strides:s,inputShape:i},f=Y.runKernel(bE,d,h);return a?_e(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Nie=K({conv3DBackpropInput_:kie});function Tie(t,e,n,s,r){const i=D(t,"x","conv3dTranspose"),o=D(e,"filter","conv3dTranspose");return Nie(n,i,o,s,r)}const _ie=K({conv3dTranspose_:Tie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(t){const n={x:D(t,"x","cos","float32")};return Y.runKernel(wE,n)}const $ie=K({cos_:Eie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iie(t){const n={x:D(t,"x","cosh","float32")};return Y.runKernel(SE,n)}const Rie=K({cosh_:Iie});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pie(t,e=0,n=!1,s=!1){const i={x:D(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return Y.runKernel(CE,i,o)}const Aie=K({cumprod_:Pie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t,e=0,n=!1,s=!1){const i={x:D(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return Y.runKernel(kE,i,o)}const Die=K({cumsum_:jie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(t,e,n,s=!1){const r=D(t,"x","denseBincount"),i=D(e,"weights","denseBincount");O(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),O(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),O(n>=0,()=>`size must be non-negative, but got ${n}.`),O(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return Y.runKernel(TE,o,a)}const Fie=K({denseBincount_:Oie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(t,e,n="NHWC"){const s=D(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];O(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),O(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),O(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),O(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return Y.runKernel(_E,a,l)}const Lie=K({depthToSpace_:Mie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(t,e,n,s,r="NHWC",i=[1,1],o){const a=D(t,"x","depthwiseConv2d","float32"),l=D(e,"filter","depthwiseConv2d","float32");let c=a,d=!1;a.rank===3&&(d=!0,c=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),O(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const h=r==="NHWC"?c.shape[3]:c.shape[1];O(h===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${l.shape[2]}.`),va("depthwiseConv2d",s,o);const f={x:c,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},m=Y.runKernel(EE,f,p);return d?_e(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const EI=K({depthwiseConv2d_:Bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(t){const n={x:D(t,"x","diag")};return Y.runKernel(RE,n)}const zie=K({diag_:Vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(t,e,n,s,r=[1,1],i="NHWC"){const o=D(t,"x","dilation2d"),a=D(e,"filter","dilation2d");O(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),O(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),O(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,c=!1;o.rank===3&&(l=_e(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),O(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},h={strides:n,pad:s,dilations:r},f=Y.runKernel(PE,d,h);return c?_e(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Uie=K({dilation2d_:Wie});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mp(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function GW(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function nn(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hie(t,e){let n=D(t,"a","equal","string_or_numeric"),s=D(e,"b","equal","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(FE,r)}const KW=K({equal_:Hie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(t,e,n){const s=D(e,"a","where"),r=D(n,"b","where"),i=D(t,"condition","where","bool"),o=nn(nn(i.shape,s.shape),r.shape),a=Og(i,o),l=Og(s,o),c=Og(r,o),d={condition:a,t:l,e:c};return Y.runKernel(X$,d)}const Du=K({where_:Gie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(t){const n={x:D(t,"x","zerosLike")};return Y.runKernel(wI,n)}const Co=K({zerosLike_:Kie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(t,e){let n=D(t,"a","div"),s=D(e,"b","div");[n,s]=Bs(n,s);const r=dn(n,s),i=Co(r),o=KW(s,i);return Du(o,i,r)}const Xie=K({divNoNan_:qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(t,e){const n=D(t,"t1","dot"),s=D(e,"t2","dot");O((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(O(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=_e(n,[1,-1]),a=_e(s,[-1,1]),l=Zn(o,a);return _e(l,[])}else if(n.rank===1&&s.rank===2){const o=_e(n,[1,-1]),a=_e(s,[s.shape[0],s.shape[1]]),l=Zn(o,a);return _e(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=_e(s,[-1,1]),a=Zn(n,o);return _e(a,[a.size])}else{const o=_e(s,[s.shape[0],s.shape[1]]);return Zn(n,o)}}const Qie=K({dot_:Yie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t,...e){const n=e.map((r,i)=>D(r,`tensors${i}`,"einsum")),s={equation:t};return Y.runKernel(jE,n,s)}const Cf=K({einsum_:Zie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(t){const n={x:D(t,"x","elu","float32")};return Y.runKernel(DE,n)}const qW=K({elu_:Jie});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t,e){const n=D(t,"x","ensureShape","string_or_numeric");if(!Ine(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const toe=K({ensureShape_:eoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t){let e=D(t,"x","erf");O(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=rs(e,"float32"));const n={x:e};return Y.runKernel(OE,n)}const soe=K({erf_:noe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $I(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function XW(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Oo(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function Ji(t,e){const n=e.map(s=>1);return XW(t,n,e)}function eo(t,e,n){O($I(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Mr(t,e){if($I(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function $x(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Lr(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t,e=null,n=!1){const r={x:D(t,"x","max")},i={reductionIndices:e,keepDims:n};return Y.runKernel(h$,r,i)}const ip=K({max_:roe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t,e=null,n=!1){const r={x:D(t,"x","min")},i={axis:e,keepDims:n};return Y.runKernel(y$,r,i)}const qk=K({min_:ioe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t,e){let n=D(t,"base","pow"),s=D(e,"exp","pow");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(P$,r)}const w0=K({pow_:ooe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ln(t,e){if((pa(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&pa(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return od(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(t){const n={x:D(t,"x","sqrt","float32")};return Y.runKernel(sI,n)}const Ec=K({sqrt_:aoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t){const e=D(t,"x","square"),n={};return Y.runKernel("Square",{x:e},n)}const la=K({square_:loe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function coe(t,e=null,n=!1){let s=D(t,"x","sum");s.dtype==="bool"&&(s=rs(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return Y.runKernel(rI,r,i)}const gs=K({sum_:coe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t,e="euclidean",n=null,s=!1){t=D(t,"x","norm");const r=YW(t,e,n);let i=r.shape;if(s){const o=bs(n,t.shape);i=Ji(r.shape,o)}return _e(r,i)}function YW(t,e,n=null){if(t.rank===0)return ao(t);if(t.rank!==1&&n===null)return YW(_e(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return gs(ao(t),n);if(e===1/0)return ip(ao(t),n);if(e===-1/0)return qk(ao(t),n);if(e==="euclidean"||e===2)return Ec(gs(w0(ao(t),ln(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return ip(gs(ao(t),n[0]),n[1]-1);if(e===1/0)return ip(gs(ao(t),n[1]),n[0]);if(e===-1/0)return qk(gs(ao(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Ec(gs(la(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const y1=K({norm_:uoe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t,e=null,n=!1){return y1(t,"euclidean",e,n)}const hoe=K({euclideanNorm_:doe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t){const n={x:D(t,"x","exp")};return Y.runKernel(ME,n)}const $c=K({exp_:foe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t,e=0){const n=D(t,"x","expandDims","string_or_numeric");O(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return Y.runKernel(LE,s,r)}const ho=K({expandDims_:poe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function moe(t){const n={x:D(t,"x","expm1")};return Y.runKernel(BE,n)}const goe=K({expm1_:moe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(t,e){const n=D(t,"x","tile","string_or_numeric");O(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return Y.runKernel(h1,s,r)}const Fg=K({tile_:xoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(t,e,n,s="float32"){e==null&&(e=t);const r=Kn([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=_e(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Fg(ho(o,0),[n[0],1,1]);if(n.length===2)return Fg(ho(ho(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Fg(ho(ho(ho(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const QW=K({eye_:yoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const n={x:D(t,"x","floor","float32")};return Y.runKernel(UE,n)}const ZW=K({floor_:voe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(t,e,n=0,s=0){const r=D(t,"x","gather"),i=D(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return Y.runKernel(KE,o,a)}const JW=K({gather_:boe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t,e){let n=D(t,"a","greater","string_or_numeric"),s=D(e,"b","greater","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(XE,r)}const v1=K({greater_:woe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t,e){let n=D(t,"a","greaterEqual","string_or_numeric"),s=D(e,"b","greaterEqual","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(YE,r)}const e6=K({greaterEqual_:Soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(t){const n={input:D(t,"input","imag")};return Y.runKernel(ZE,n)}const b1=K({imag_:Coe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(t){const n={x:D(t,"x","isFinite")};return Y.runKernel(JE,n)}const Noe=K({isFinite_:koe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t){const n={x:D(t,"x","isInf")};return Y.runKernel(e$,n)}const _oe=K({isInf_:Toe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eoe(t){const n={x:D(t,"x","isNaN")};return Y.runKernel(t$,n)}const $oe=K({isNaN_:Eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t,e=.2){const s={x:D(t,"x","leakyRelu")},r={alpha:e};return Y.runKernel(n$,s,r)}const t6=K({leakyRelu_:Ioe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(t,e){let n=D(t,"a","less","string_or_numeric"),s=D(e,"b","less","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(s$,r)}const Xk=K({less_:Roe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(t,e){let n=D(t,"a","lessEqual","string_or_numeric"),s=D(e,"b","lessEqual","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(r$,r)}const II=K({lessEqual_:Poe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return Y.runKernel(i$,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t,e=5,n=1,s=1,r=.5){const i=D(t,"x","localResponseNormalization");O(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),O(Ap(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:s,beta:r},d=Y.runKernel(d$,l,c);return a?_e(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Doe=K({localResponseNormalization_:joe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ooe(t){const n={x:D(t,"x","log","float32")};return Y.runKernel(o$,n)}const S0=K({log_:Ooe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t){const n={x:D(t,"x","log1p")};return Y.runKernel(a$,n)}const n6=K({log1p_:Foe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Moe(t,e){O(Pk(t),()=>"The f passed in variableGrads(f) must be a function"),O(e==null||Array.isArray(e)&&e.every(c=>c instanceof jb),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in Y.registeredVariables)e.push(Y.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),O(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=Y.gradients(t,e,null,i);O(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),O(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,d)=>{a[d]!=null&&(l[c.name]=a[d])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function Ic(t){return Y.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Loe(t){const n={x:D(t,"x","neg")};return Y.runKernel(k$,n)}const $l=K({neg_:Loe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Boe(t){const n={x:D(t,"x","softplus")};return Y.runKernel(nI,n)}const s6=K({softplus_:Boe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(t){const e=D(t,"x","logSigmoid");return Ic(s=>({value:$l(s6($l(s))),gradFunc:o=>We(o,fc($l(s)))}))(e)}const zoe=K({logSigmoid_:Voe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(t,e){let n=D(t,"a","sub"),s=D(e,"b","sub");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(pI,r)}const Qt=K({sub_:Woe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(t,e=-1){const n=D(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Ic((r,i)=>{const a=ip(r,e,!0),l=Qt(r,a),c=Qt(rs(l,"float32"),S0(gs($c(l),e,!0)));return i([c]),{value:c,gradFunc:(h,f)=>{const[p]=f,m=!0,g=$c(p);return Qt(h,We(gs(h,e,m),g))}}})(n)}const Hoe=K({logSoftmax_:Uoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(t,e=null,n=!1){const s=D(t,"x","logSumExp"),r=bs(e,s.shape),i=ip(s,r,!0),o=Qt(s,i),a=$c(o),l=gs(a,r),c=S0(l),d=Nt(_e(i,c.shape),c);if(n){const h=Ji(d.shape,r);return _e(d,h)}return d}const r6=K({logSumExp_:Goe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(t,e){const n=D(t,"a","logicalAnd","bool"),s=D(e,"b","logicalAnd","bool");nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(l$,r)}const Ob=K({logicalAnd_:Koe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const n={x:D(t,"x","logicalNot","bool")};return Y.runKernel(c$,n)}const i6=K({logicalNot_:qoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(t,e){const n=D(t,"a","logicalOr","bool"),s=D(e,"b","logicalOr","bool");nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(u$,r)}const o6=K({logicalOr_:Xoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe(t,e){const n=D(t,"a","logicalXor","bool"),s=D(e,"b","logicalXor","bool");return nn(n.shape,s.shape),Ob(o6(t,e),i6(Ob(t,e)))}const Qoe=K({logicalXor_:Yoe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ty=2147483648;function Zoe(t,e,n="left"){const s=D(t,"sortedSequence","searchSorted"),r=D(e,"values","searchSorted"),i=s.shape[s.shape.length-1],o=r.shape[r.shape.length-1],a=_e(s,[-1,i]),l=_e(r,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(be(l.shape)>=Ty)throw new Error(`values tensor size must less than ${Ty}`);if(a.shape[1]>=Ty)throw new Error(`trailing dim_size must less than ${Ty} for int32 output type, was ${a.shape[1]}`);const c={sortedSequence:a,values:l},d={side:n};return Y.runKernel(q$,c,d)}const RI=K({searchSorted_:Zoe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Joe(t,e){return RI(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eae(t,e,n,s,r){const i=D(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=_e(i,[1,i.shape[0],i.shape[1],i.shape[2]])),O(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),O(ri(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),va("maxPool",s,r);const c={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:r},h=Y.runKernel(p$,c,d);return l?_e(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const a6=K({maxPool_:eae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=D(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=_e(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),O(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),O(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),va("maxPool3d",s,r);const c={x:a},d={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},h=Y.runKernel(m$,c,d);return l?_e(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const nae=K({maxPool3d_:tae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sae(t,e,n,s,r=!1){const o={x:D(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:r},l=Y.runKernel(g$,o,a);return{result:l[0],indexes:l[1]}}const rae=K({maxPoolWithArgmax_:sae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(t,e){let n=D(t,"a","maximum"),s=D(e,"b","maximum");[n,s]=Bs(n,s),n.dtype==="bool"&&(n=rs(n,"int32"),s=rs(s,"int32")),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(f$,r)}const l6=K({maximum_:iae});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oae(t,e=null,n=!1){const r={x:D(t,"x","mean")},i={axis:e,keepDims:n};return Y.runKernel(x$,r,i)}const Fb=K({mean_:oae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rc(t,e="float32"){if(Do(t),e==="complex64"){const s=Rc(t,"float32"),r=Rc(t,"float32");return Uu(s,r)}const n=Nc(be(t),e);return Y.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zd(t,e="float32"){if(Do(t),e==="complex64"){const s=zd(t,"float32"),r=Rc(t,"float32");return Uu(s,r)}const n=Pz(be(t),e);return Y.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=D(t,"x","meshgrid",t instanceof js?t.dtype:"float32");if(e===void 0)return[s];let r=D(e,"y","meshgrid",e instanceof js?e.dtype:"float32");const i=be(s.shape),o=be(r.shape);return n==="xy"?(s=_e(s,[1,-1]),r=_e(r,[-1,1]),[Zn(zd([o,1],s.dtype),s),Zn(r,zd([1,i],r.dtype))]):(s=_e(s,[-1,1]),r=_e(r,[1,-1]),[Zn(s,zd([1,o],s.dtype)),Zn(zd([i,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e){let n=D(t,"a","minimum"),s=D(e,"b","minimum");[n,s]=Bs(n,s),n.dtype==="bool"&&(n=rs(n,"int32"),s=rs(s,"int32")),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(v$,r)}const C0=K({minimum_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t,e,n){O(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=D(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");O(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)O(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),O(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return Y.runKernel(b$,o,i)}const c6=K({mirrorPad_:cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(t,e){let n=D(t,"a","mod"),s=D(e,"b","mod");[n,s]=Bs(n,s);const r={a:n,b:s};return Y.runKernel(w$,r)}const dae=K({mod_:uae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t,e=null,n=!1){t=D(t,"x","moments");const s=bs(e,t.shape),r=Fb(t,s,n);let i=r.shape;n||(i=Ji(r.shape,s));const o=la(Qt(rs(t,"float32"),_e(r,i))),a=Fb(o,s,n);return{mean:r,variance:a}}const fae=K({moments_:hae});function pae(t,e,n,s){const r=D(e,"data","multiRNNCell"),i=Db(n,"c","multiRNNCell"),o=Db(s,"h","multiRNNCell");let a=r;const l=[];for(let h=0;h<t.length;h++){const f=t[h](a,i[h],o[h]);l.push(f[0]),l.push(f[1]),a=f[1]}const c=[],d=[];for(let h=0;h<l.length;h+=2)c.push(l[h]),d.push(l[h+1]);return[c,d]}const mae=K({multiRNNCell_:pae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gae(t,e,n,s=!1){const r=D(t,"logits","multinomial"),i=r.size,o=r.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const l={logits:o===1?_e(r,[1,-1]):r},c={numSamples:e,seed:n,normalized:s},d=Y.runKernel(S$,l,c);return o===1?_e(d,[d.size]):d}const xae=K({multinomial_:gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t,e){let n=D(t,"a","notEqual","string_or_numeric"),s=D(e,"b","notEqual","string_or_numeric");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s};return Y.runKernel(N$,r)}const u6=K({notEqual_:yae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vae(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:D(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return Y.runKernel($$,o,a)}const bae=K({oneHot_:vae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(t){const n={x:D(t,"x","onesLike")};return Y.runKernel(E$,n)}const Sae=K({onesLike_:wae});function Cae(t,e){const n=D(t,"v1","outerProduct"),s=D(e,"v2","outerProduct");O(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const r=_e(n,[-1,1]),i=_e(s,[1,-1]);return Zn(r,i)}const kae=K({outerProduct_:Cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(t,e,n=0){const s=D(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return Y.runKernel(R$,i,r)}const Gu=K({pad_:Nae});function Tae(t,e,n=0){return O(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Gu(t,[e],n)}const _ae=K({pad1d_:Tae});function Eae(t,e,n=0){return O(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Gu(t,e,n)}const $ae=K({pad2d_:Eae});function Iae(t,e,n=0){return O(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Gu(t,e,n)}const Rae=K({pad3d_:Iae});function Pae(t,e,n=0){return O(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Gu(t,e,n)}const Aae=K({pad4d_:Pae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(t,e,n){const s=D(t,"x","spaceToBatchND");O(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),O(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),O(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return Y.runKernel(iI,r,i)}const d6=K({spaceToBatchND_:jae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dae(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=D(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(ri(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const d=ya(l.shape,e,i,r,s),h=[d.dilationHeight,d.dilationWidth];let f;s==="same"?f=Fae([d.filterHeight,d.filterWidth],h):f=[[0,0],[0,0]];const p=h[0]===1&&h[1]===1,[m,g]=Oae([d.inHeight,d.inWidth],h,f),x=p?s:"valid",y=p?l:d6(l,h,m),S=(n==="avg"?()=>VW(y,e,i,x,o):()=>a6(y,e,i,x,o))(),C=p?S:zW(S,h,g);return c?_e(C,[C.shape[1],C.shape[2],C.shape[3]]):C}function Oae(t,e,n){const s=n.map(d=>d[0]),r=n.map(d=>d[1]),i=t.concat(s,r),o=e.map((d,h)=>(d-i[h]%d)%d),a=r.map((d,h)=>d+o[h]),l=e.map((d,h)=>[s[h],a[h]]),c=e.map((d,h)=>[0,o[h]]);return[l,c]}function Fae(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const Mae=K({pool_:Dae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(t,e){const n=D(t,"x","prelu"),s=D(e,"alpha","prelu"),r={x:n,alpha:s};return Y.runKernel(A$,r)}const h6=K({prelu_:Lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t,e=null,n=!1){let s=D(t,"x","prod");s.dtype==="bool"&&(s=rs(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return Y.runKernel(j$,r,i)}const Vae=K({prod_:Bae});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zae(t,e,n,s){const r=t.map((d,h)=>D(d,`tensors${h}`,"raggedGather","int32")),i=D(e,"paramsDenseValues","raggedGather"),o=D(n,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:i,indices:o},l={outputRaggedRank:s},c=Y.runKernel(Hz,a,l);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}const Wae=K({raggedGather_:zae});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uae(t,e,n){const s=D(t,"starts","raggedRange"),r=D(e,"limits","raggedRange",s.dtype),i=D(n,"deltas","raggedRange",s.dtype),o={starts:s,limits:r,deltas:i},a=Y.runKernel(Gz,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const Hae=K({raggedRange_:Uae});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t,e,n,s,r){const i=D(t,"shape","raggedTensorToTensor","int32"),o=D(e,"values","raggedTensorToTensor"),a=D(n,"defaultValue","raggedTensorToTensor",o.dtype),l=s.map((h,f)=>D(h,`tensors${f}`,"raggedTensorToTensor","int32")),c={shape:i,values:o,defaultValue:a,rowPartitionTensors:l},d={rowPartitionTypes:r};return Y.runKernel(Kz,c,d)}const Kae=K({raggedTensorToTensor_:Gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t,e,n){Do(t);const s=be(t);let r=null;if(n==null||n==="float32")r=new Float32Array(s);else if(n==="int32")r=new Int32Array(s);else if(n==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let i=0;i<s;i++)r[i]=e();return Y.makeTensor(r,t,n)}const Xae=K({rand_:qae});var PI={exports:{}};PI.exports;(function(t){(function(e,n,s){function r(l){var c=this,d=a();c.next=function(){var h=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=h-(c.c=h|0)},c.c=1,c.s0=d(" "),c.s1=d(" "),c.s2=d(" "),c.s0-=d(l),c.s0<0&&(c.s0+=1),c.s1-=d(l),c.s1<0&&(c.s1+=1),c.s2-=d(l),c.s2<0&&(c.s2+=1),d=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var d=new r(l),h=c&&c.state,f=d.next;return f.int32=function(){return d.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&i(h,d),f.state=function(){return i(d,{})}),f}function a(){var l=4022871197,c=function(d){d=String(d);for(var h=0;h<d.length;h++){l+=d.charCodeAt(h);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:this.alea=o})(Cl,t)})(PI);var Yae=PI.exports,AI={exports:{}};AI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},a===(a|0)?l.x=a:c+=a;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new r(a),d=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=c.next,h.quick=h,d&&(typeof d=="object"&&i(d,c),h.state=function(){return i(c,{})}),h}n&&n.exports?n.exports=o:this.xor128=o})(Cl,t)})(AI);var Qae=AI.exports,jI={exports:{}};jI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var d=0;d<c.length+64;d++)l.x^=c.charCodeAt(d)|0,d==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new r(a),d=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=c.next,h.quick=h,d&&(typeof d=="object"&&i(d,c),h.state=function(){return i(c,{})}),h}n&&n.exports?n.exports=o:this.xorwow=o})(Cl,t)})(jI);var Zae=jI.exports,DI={exports:{}};DI.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var d=l.x,h=l.i,f,p;return f=d[h],f^=f>>>7,p=f^f<<24,f=d[h+1&7],p^=f^f>>>10,f=d[h+3&7],p^=f^f>>>3,f=d[h+4&7],p^=f^f<<7,f=d[h+7&7],f=f^f<<13,p^=f^f<<9,d[h]=p,l.i=h+1&7,p};function c(d,h){var f,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,f=0;f<h.length;++f)p[f&7]=p[f&7]<<15^h.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],d.x=p,d.i=0,f=256;f>0;--f)d.next()}c(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),d=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=c.next,h.quick=h,d&&(d.x&&i(d,c),h.state=function(){return i(c,{})}),h}n&&n.exports?n.exports=o:this.xorshift7=o})(Cl,t)})(DI);var Jae=DI.exports,OI={exports:{}};OI.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var d=l.w,h=l.X,f=l.i,p,m;return l.w=d=d+1640531527|0,m=h[f+34&127],p=h[f=f+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[f]=m^p,l.i=f,m+(d^d>>>16)|0};function c(d,h){var f,p,m,g,x,y=[],v=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,v=Math.max(v,h.length)),m=0,g=-32;g<v;++g)h&&(p^=h.charCodeAt((g+32)%h.length)),g===0&&(x=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,g>=0&&(x=x+1640531527|0,f=y[g&127]^=p+x,m=f==0?m+1:0);for(m>=128&&(y[(h&&h.length||0)&127]=-1),m=127,g=4*128;g>0;--g)p=y[m+34&127],f=y[m=m+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,y[m]=p^f;d.w=x,d.X=y,d.i=m}c(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),d=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=c.next,h.quick=h,d&&(d.X&&i(d,c),h.state=function(){return i(c,{})}),h}n&&n.exports?n.exports=o:this.xor4096=o})(Cl,t)})(OI);var ele=OI.exports,FI={exports:{}};FI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var h=l.b,f=l.c,p=l.d,m=l.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,l.b=h=h<<20^h>>>12^f,l.c=f=f-p|0,l.d=p<<16^f>>>16^m,l.a=m-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var d=0;d<c.length+20;d++)l.b^=c.charCodeAt(d)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new r(a),d=l&&l.state,h=function(){return(c.next()>>>0)/4294967296};return h.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=c.next,h.quick=h,d&&(typeof d=="object"&&i(d,c),h.state=function(){return i(c,{})}),h}n&&n.exports?n.exports=o:this.tychei=o})(Cl,t)})(FI);var tle=FI.exports,f6={exports:{}};const nle={},sle=Object.freeze(Object.defineProperty({__proto__:null,default:nle},Symbol.toStringTag,{value:"Module"})),rle=IX(sle);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),c=s.pow(2,o),d=c*2,h=r-1,f;function p(C,k,T){var _=[];k=k==!0?{entropy:!0}:k||{};var $=y(x(k.entropy?[C,S(n)]:C??v(),3),_),R=new m(_),A=function(){for(var j=R.g(i),F=l,L=0;j<c;)j=(j+L)*r,F*=r,L=R.g(1);for(;j>=d;)j/=2,F/=2,L>>>=1;return(j+L)/F};return A.int32=function(){return R.g(4)|0},A.quick=function(){return R.g(4)/4294967296},A.double=A,y(S(R.S),n),(k.pass||T||function(j,F,L,M){return M&&(M.S&&g(M,R),j.state=function(){return g(R,{})}),L?(s[a]=j,F):j})(A,$,"global"in k?k.global:this==s,k.state)}function m(C){var k,T=C.length,_=this,$=0,R=_.i=_.j=0,A=_.S=[];for(T||(C=[T++]);$<r;)A[$]=$++;for($=0;$<r;$++)A[$]=A[R=h&R+C[$%T]+(k=A[$])],A[R]=k;(_.g=function(j){for(var F,L=0,M=_.i,q=_.j,z=_.S;j--;)F=z[M=h&M+1],L=L*r+z[h&(z[M]=z[q=h&q+F])+(z[q]=F)];return _.i=M,_.j=q,L})(r)}function g(C,k){return k.i=C.i,k.j=C.j,k.S=C.S.slice(),k}function x(C,k){var T=[],_=typeof C,$;if(k&&_=="object")for($ in C)try{T.push(x(C[$],k-1))}catch{}return T.length?T:_=="string"?C:C+"\0"}function y(C,k){for(var T=C+"",_,$=0;$<T.length;)k[h&$]=h&(_^=k[h&$]*19)+T.charCodeAt($++);return S(k)}function v(){try{var C;return f&&(C=f.randomBytes)?C=C(r):(C=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(C)),S(C)}catch{var k=e.navigator,T=k&&k.plugins;return[+new Date,e,T,e.screen,S(n)]}}function S(C){return String.fromCharCode.apply(0,C)}if(y(s.random(),n),t.exports){t.exports=p;try{f=rle}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:Cl,[],Math)})(f6);var ile=f6.exports,ole=Yae,ale=Qae,lle=Zae,cle=Jae,ule=ele,dle=tle,Vh=ile;Vh.alea=ole;Vh.xor128=ale;Vh.xorwow=lle;Vh.xorshift7=cle;Vh.xor4096=ule;Vh.tychei=dle;var MI=Vh;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LI{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=MI.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class hle{constructor(e,n,s,r){this.alpha=e,this.beta=1/n,this.dtype=s;const i=r||Math.random();this.randu=MI.alea(i.toString()),this.randn=new LI(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,r,i,o;for(;;){do r=this.randn.nextValue(),o=1+this.c*r;while(o<=0);if(o*=o*o,e=r*r,n=1-.331*e*e,s=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<n||Math.log(i)<s)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class fle{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=MI.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ple(t,e,n=1,s="float32",r){if(Do(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const i=new hle(e,n,s,r),o=Kn(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const mle=K({randomGamma_:ple});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(t,e=0,n=1,s,r){if(Do(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new LI(e,n,s,!1,r),o=Kn(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const p6=K({randomNormal_:gle});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xle(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return p6(t,0,1,e,n)}const yle=K({randomStandardNormal_:xle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t,e=0,n=1,s="float32",r){Do(t);const i=Kn(t,s),o=new fle(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const BI=K({randomUniform_:vle});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(t,e,n,s){return BI(t,e,n,"int32",s)}const wle=K({randomUniformInt_:ble});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return Y.runKernel(D$,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(t){const n={input:D(t,"input","real")};return Y.runKernel(O$,n)}const N0=K({real_:Sle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cle(t){const n={x:D(t,"x","reciprocal")};return Y.runKernel(F$,n)}const kle=K({reciprocal_:Cle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nle(t){const n={x:D(t,"x","relu")};return Y.runKernel(M$,n)}const w1=K({relu_:Nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(t){const n={x:D(t,"x","relu6")};return Y.runKernel(z$,n)}const m6=K({relu6_:Tle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(t,e){const s={x:D(t,"x","reverse")},r={dims:e};return Y.runKernel(W$,s,r)}const kh=K({reverse_:_le});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t){const e=D(t,"x","reverse");return O(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),kh(e,0)}const $le=K({reverse1d_:Ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t,e){const n=D(t,"x","reverse");return O(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),kh(n,e)}const Rle=K({reverse2d_:Ile});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t,e){const n=D(t,"x","reverse");return O(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),kh(n,e)}const Ale=K({reverse3d_:Ple});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jle(t,e){const n=D(t,"x","reverse");return O(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),kh(n,e)}const Dle=K({reverse4d_:jle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ole(t){const n={x:D(t,"x","round")};return Y.runKernel(U$,n)}const g6=K({round_:Ole});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t){const n={x:D(t,"x","rsqrt","float32")};return Y.runKernel(H$,n)}const Mle=K({rsqrt_:Fle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t){const n={x:D(t,"x","selu")};return Y.runKernel(Y$,n)}const Ble=K({selu_:Lle});function Vle(t,e,n,s,r,i=[1,1],o="NHWC"){const a=D(t,"x","separableConv2d"),l=D(e,"depthwiseFilter","separableConv2d"),c=D(n,"pointwiseFilter","separableConv2d");let d=a,h=!1;if(a.rank===3&&(h=!0,d=_e(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),O(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),O(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),O(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),O(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],p=l.shape[3];O(c.shape[2]===f*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*p}, but got ${c.shape[2]}.`);const m=EI(d,l,s,r,o,i),x=x1(m,c,1,"valid",o);return h?_e(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const zle=K({separableConv2d_:Vle});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Wle(t,e){const n=D(t,"x","setdiff1d"),s=D(e,"y","setdiff1d");O(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),O(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),O(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await n.data(),i=await s.data(),o=new Set(i);let a=0;for(let d=0;d<r.length;d++)o.has(r[d])||a++;const l=new Dp([a],n.dtype),c=new Dp([a],"int32");for(let d=0,h=0;d<r.length;d++)o.has(r[d])||(l.values[h]=r[d],c.values[h]=d,h++);return[l.toTensor(),c.toTensor()]}const Ule=Wle;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hle(t){const n={x:D(t,"x","sign")};return Y.runKernel(eI,n)}const Gle=K({sign_:Hle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kle(t){const n={x:D(t,"x","sin","float32")};return Y.runKernel(Z$,n)}const qle=K({sin_:Kle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xle(t){const n={x:D(t,"x","sinh")};return Y.runKernel(J$,n)}const Yle=K({sinh_:Xle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qle(t,e,n){const s=D(t,"x","slice1d");return O(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),an(s,[e],[n])}const Zle=K({slice1d_:Qle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t,e,n){const s=D(t,"x","slice2d");return O(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),an(s,e,n)}const ece=K({slice2d_:Jle});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(t,e,n){const s=D(t,"x","slice3d");return O(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),an(s,e,n)}const nce=K({slice3d_:tce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sce(t,e,n){const s=D(t,"x","slice4d");return O(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),an(s,e,n)}const rce=K({slice4d_:sce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ice(t,e=-1){const n=D(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return Y.runKernel(aI,s,r)}const oce=K({softmax_:ice});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ace(t){O(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return Y.runKernel(VE,e)}const VI=K({fft_:ace});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lce(t){O(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return Y.runKernel(QE,e)}const Mb=K({ifft_:lce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cce(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=_e(t,[n,e]);s=Mb(r)}else{const r=[n,2*(e-1)],i=_e(N0(t),[n,e]),o=_e(b1(t),[n,e]),a=kh(an(i,[0,1],[n,e-2]),1),l=We(kh(an(o,[0,1],[n,e-2]),1),ln(-1)),c=gr([i,a],1),d=gr([o,l],1),h=_e(Uu(c,d),[r[0],r[1]]);s=Mb(h)}if(s=N0(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=_e(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const x6=K({irfft_:cce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uce(t,e,n=0){const r={x:D(t,"x","split")},i={numOrSizeSplits:e,axis:n};return Y.runKernel(oI,r,i)}const T0=K({split_:uce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dce(t,e){O(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const m=t.shape.map(x=>0),g=t.shape.map(x=>x);g[t.shape.length-1]=e,r=an(t,m,g),n=e}else if(e!=null&&e>n){const m=t.shape.map(g=>g);m[t.shape.length-1]=e-n,r=gr([t,Rc(m)],t.shape.length-1),n=e}else r=t;const i=Co(r),o=_e(Uu(r,i),[s,n]),a=VI(o),l=Math.floor(n/2)+1,c=N0(a),d=b1(a),h=T0(c,[l,n-l],c.shape.length-1),f=T0(d,[l,n-l],d.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,_e(Uu(h[0],f[0]),p)}const zI=K({rfft_:dce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t,e){let n=D(t,"a","squaredDifference"),s=D(e,"b","squaredDifference");[n,s]=Bs(n,s),nn(n.shape,s.shape);const r={a:n,b:s},i={};return Y.runKernel(dI,r,i)}const y6=K({squaredDifference_:hce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t,e){const n=D(t,"x","squeeze","string_or_numeric");return _e(n,rd(n.shape,e).newShape)}const Yn=K({squeeze_:fce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pce(t,e=0){const n=Db(t,"tensors","stack","string_or_numeric");O(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&O(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return Y.runKernel(I$,s,r)}const Pc=K({stack_:pce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mce(t,e=0){const s={x:D(t,"x","step")},r={alpha:e};return Y.runKernel(SI,s,r)}const v6=K({step_:mce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gce(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const d={x:D(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return Y.runKernel(hI,d,h)}const xce=K({stridedSlice_:gce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yce(t){const n={x:D(t,"x","tan","float32")};return Y.runKernel(mI,n)}const vce=K({tan_:yce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dr(t,e){cm(t);const n=id(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return od(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ca(t,e,n){if(cm(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=id(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return od(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(t,e,n){if(cm(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=id(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return od(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t,e,n){if(cm(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=id(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return od(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t,e,n){if(cm(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=id(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return od(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sce(t,e,n){if(cm(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=id(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,od(t,e,s,n)}function w6(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function WI(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}w6(n,e,t)}function zh(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let h=r;h<i;++h)o*=n[h];const a=r<1?1:r,l=be(e.shape)/a,c=[...Ms(n.slice(0,r)),1],d=be(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:c,outputSize:d}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cce(t,e,n){const s=D(t,"tensor","tensorScatterupdate"),r=D(e,"indices","tensorScatterupdate","int32"),i=D(n,"updates","tensorScatterupdate");if(WI(i,r,s.shape),s.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${i.dtype}.`);const o={tensor:s,indices:r,updates:i},a={};return Y.runKernel(K$,o,a)}const kce=K({tensorScatterUpdate_:Cce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t,e=1,n=!0){const s=D(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=Y.runKernel(xI,i,o);return{values:a,indices:l}}const Tce=K({topk_:Nce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ce(t,e=0,n=1,s,r){if(Do(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new LI(e,n,s,!0,r),o=Kn(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const Ece=K({truncatedNormal_:_ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(t,e=0){const n=D(t,"x","unique","string_or_numeric");O(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=Y.runKernel(nW,s,r);return{values:i,indices:o}}const Ice=K({unique_:$ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rce(t,e,n){const s=D(t,"x","unsortedSegmentSum"),r=D(e,"segmentIds","unsortedSegmentSum","int32");O(Ap(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return Y.runKernel(bI,i,o)}const Pce=K({unsortedSegmentSum_:Rce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ace(t,e=0){const n=D(t,"x","unstack","string_or_numeric");O(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return Y.runKernel(vI,s,r)}const Wh=K({unstack_:Ace});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jce(t,e){return RI(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dce(t,e=!0,n,s){return Y.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=Kn(t,"int32"),r=Kn([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Oce(t){const e=D(t,"condition","whereAsync","bool"),n=await e.data(),s=S6(e.shape,n);return t!==e&&e.dispose(),s}const C6=Oce;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Fce(t,e,n){const s=D(t,"tensor","boolMask"),r=D(e,"mask","boolMask","bool"),i=n??0,o=r.rank,a=s.shape;O(o>0,()=>"mask cannot be scalar"),Qi(a.slice(i,i+o),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let g=i;g<i+o;g++)l*=a[g];const c=a.slice(0,i).concat([l],a.slice(i+o)),d=_e(s,c),h=_e(r,[-1]),f=await C6(h),p=Yn(f,[1]),m=JW(d,p,i);return t!==s&&s.dispose(),e!==r&&r.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),m}const Mce=Fce;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lce(t,e,n){const s=D(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),O(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{O(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?Wt(()=>{let o=N0(s),a=b1(s);return o=Y.runKernel(Dg,{x:o},i),a=Y.runKernel(Dg,{x:a},i),n&&(a=$l(a)),Uu(o,a)}):Y.runKernel(Dg,r,i)}const Yk=K({transpose_:Lce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bce(t,e,n,s,r=!0){const i=D(t,"v","movingAverage"),o=D(e,"x","movingAverage"),a=D(n,"decay","movingAverage");use(i,o),O(Gn(i.shape,o.shape),()=>"Shape mismatch in v and x");const l=ln(1),c=Qt(l,a);let d=We(Qt(o,i),c);if(r){O(s!=null,()=>"When using zeroDebias: true, step is required.");const h=D(s,"step","movingAverage");d=dn(d,Qt(l,w0(a,h)))}return Nt(i,d)}const Vce=K({movingAverage_:Bce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zce(t,e,n){Do(n);const s=D(t,"indices","scatterND","int32"),r=D(e,"updates","scatterND");WI(r,s,n);const i={indices:s,updates:r},o={shape:n};return Y.runKernel(G$,i,o)}const Wce=K({scatterND_:zce});function Uce(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${i}.`);const o=e.size;if(!(e.rank===0||e.rank===1&&o===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hce(t,e,n,s=0){Do(n);const r=D(t,"sparseIndices","sparseToDense","int32"),i=D(e,"sparseValues","sparseToDense","string_or_numeric"),o=D(s,"defaultValue","sparseToDense",i.dtype);Uce(r,i,n,o);const a={sparseIndices:r,sparseValues:i,defaultValue:o},l={outputShape:n};return Y.runKernel(uI,a,l)}const Gce=K({sparseToDense_:Hce});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kce(t,e){const n=D(e,"indices","gatherND","int32"),r={params:D(t,"x","gatherND","string_or_numeric"),indices:n};return Y.runKernel(qE,r)}const qce=K({gatherND_:Kce});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xce(t,e){if(e==null)return t.shape.slice();if(Gn(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yce(t,e,n,s){const r=D(t,"x","dropout");if(O(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),O(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof js?r.clone():r;const i=Xce(r,n),o=1-e,a=dn(ZW(Nt(BI(i,0,1,"float32",s),o)),o);return We(r,a)}const Qce=K({dropout_:Yce});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function UI(t,e,n){const s=1-t%2,r=new Float32Array(t);for(let i=0;i<t;++i){const o=2*Math.PI*i/(t+s-1);r[i]=e-n*Math.cos(o)}return Dr(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Zce(t,e,n=1){const s=D(t,"predictions","inTopK"),r=D(e,"targets","inTopK");O(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),O(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Qi(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const i=s.shape[s.shape.length-1];O(n>0&&n<=i,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${i}), but got ${n}`);const o=await s.data(),a=await r.data(),[l,c]=[o.length/i,i],d=Dl("bool",l);for(let h=0;h<l;h++){const f=h*c,p=o.subarray(f,f+c),m=[];for(let g=0;g<p.length;g++)m.push({value:p[g],index:g});m.sort((g,x)=>x.value-g.value),d[h]=0;for(let g=0;g<n;g++)if(m[g].index===a[h]){d[h]=1;break}}return t!==s&&s.dispose(),e!==r&&r.dispose(),El(d,r.shape,"bool")}const Jce=Zce;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eue(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=_e(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]])),O(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),O(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),O(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=i==="NHWC"?a.shape[3]:a.shape[1],d=i==="NHWC"?l.shape[3]:l.shape[1];O(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),O(d===n[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${n[3]}).`),va("conv2dDerFilter",r,o);const h={x:a,dy:l},f={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return Y.runKernel(xE,h,f)}const tue=K({conv2DBackpropFilter_:eue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return We(t,v6(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function C1(t,e){let n=e;const s=GW(t.shape,e.shape);return s.length>0&&(n=gs(n,s)),_e(n,t.shape)}function k1(t,e,n,s){if(e==="linear")return t;if(e==="relu")return w1(t);if(e==="elu")return qW(t);if(e==="relu6")return m6(t);if(e==="prelu")return h6(t,n);if(e==="leakyrelu")return t6(t,s);if(e==="sigmoid")return fc(t);throw new Error(`Unknown fused activation ${e}.`)}const N1=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nue({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:d}){if(l=l||"linear",N1(Y.state.gradientDepth,l)===!1){O(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let T=x1(t,e,n,s,r,i,o);return a!=null&&(T=Nt(T,a)),k1(T,l,c,d)}const h=D(t,"x","conv2d","float32"),f=D(e,"filter","conv2d","float32");let p=h,m=!1;h.rank===3&&(m=!0,p=_e(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),O(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),va("fused conv2d",s,o);const g=r==="NHWC"?p.shape[3]:p.shape[1];O(f.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${f.shape[2]}.`),O(ri(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const x=sr(p.shape,f.shape,n,i,s,o);let y;a!=null&&(y=D(a,"bias","fused conv2d"),[y]=Bs(y,h),r==="NHWC"?nn(x.outShape,y.shape):(O(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),O(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let v;if(c!=null){const T=c.shape;if(O(T.length<=1||T.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${T.length}.`),T.length===1)O(T[0]===1||T[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the number of output channels (${x.outChannels}).`);else if(T.length===3)try{nn(T,x.outShape)}catch{const $=`Error in fused conv2d: PReLU activation weights (${T}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error($)}v=D(c,"prelu weights","fused conv2d")}const S=(T,_)=>{O(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[$,R,A,j]=_,F=S1(T,A,l);O(b0(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const L=HW(R.shape,F,$,n,s),M=tue(R,F,$.shape,n,s),q=[L,M];if(j!=null){const z=C1(j,F);q.push(z)}return q},C={x:p,filter:f,bias:y,preluActivationWeights:v},k={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?Ic((_,$,R)=>{let A=Y.runKernel($b,C,k);return R([$,_,A]),m&&(A=_e(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:S}})(p,f):Ic((_,$,R,A)=>{let j=Y.runKernel($b,C,k);return A([$,_,j,R]),m&&(j=_e(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:S}})(p,f,y)}const sue=K({fusedConv2d_:nue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rue(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=_e(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return Y.runKernel($E,c,d)}const iue=K({depthwiseConv2dNativeBackpropFilter_:rue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oue(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=_e(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},d={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},h=Y.runKernel(IE,c,d);return l?_e(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const aue=K({depthwiseConv2dNativeBackpropInput_:oue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lue({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:d}){if(N1(Y.state.gradientDepth,l)===!1){let k=EI(t,e,n,s,r,i,o);return a!=null&&(k=Nt(k,a)),k1(k,l,c,d)}const h=D(t,"x","depthwiseConv2d","float32"),f=D(e,"filter","depthwiseConv2d","float32");let p=h,m=!1;h.rank===3&&(m=!0,p=_e(h,[1,h.shape[0],h.shape[1],h.shape[2]])),O(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),O(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),O(p.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),i==null&&(i=[1,1]),O(ri(n,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),va("fused depthwiseConv2d",s,o);const g=sr(p.shape,f.shape,n,i,s,o,!0);let x;a!=null&&(x=D(a,"bias","fused conv2d"),[x]=Bs(x,h),nn(g.outShape,x.shape));let y;c!=null&&(y=D(c,"prelu weights","fused depthwiseConv2d"));const v=(k,T)=>{O(b0(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[_,$,R,A]=T,j=S1(k,R,l),F=aue($.shape,j,_,n,s,i,o),L=iue($,j,_.shape,n,s,i,o);if(A!=null){const M=C1(x,j);return[F,L,M]}return[F,L]},S={x:p,filter:f,bias:x,preluActivationWeights:y},C={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:d};return a==null?Ic((T,_,$)=>{let R=Y.runKernel(Ib,S,C);return $([_,T,R]),m&&(R=_e(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:v}})(p,f):Ic((T,_,$,R)=>{let A=Y.runKernel(Ib,S,C);return R([_,T,A,$]),m&&(A=_e(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:v}})(p,f,x)}const cue=K({fusedDepthwiseConv2d_:lue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uue({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(N1(Y.state.gradientDepth,i)===!1){let j=Zn(t,e,n,s);return r!=null&&(j=Nt(j,r)),k1(j,i,o,a)}let l=D(t,"a","fused matMul"),c=D(e,"b","fused matMul");[l,c]=Bs(l,c);const d=n?l.shape[l.rank-2]:l.shape[l.rank-1],h=s?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=s?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),g=c.shape.slice(0,-2),x=be(m),y=be(g);O(d===h,()=>`Error in fused matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=nn(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,p]),C=n?_e(l,[x,d,f]):_e(l,[x,f,d]),k=s?_e(c,[y,p,h]):_e(c,[y,h,p]);let T;r!=null&&(T=D(r,"bias","fused matMul"),[T]=Bs(T,l),nn(S,T.shape));let _;o!=null&&(_=D(o,"prelu weights","fused matMul"));const $=(j,F)=>{const[L,M,q,z]=F,re=S1(_e(j,q.shape),q,i);let U,G;if(!n&&!s?(U=Zn(re,M,!1,!0),G=Zn(L,re,!0,!1)):!n&&s?(U=Zn(re,M,!1,!1),G=Zn(re,L,!0,!1)):n&&!s?(U=Zn(M,re,!1,!0),G=Zn(L,re,!1,!1)):(U=Zn(M,re,!0,!0),G=Zn(re,L,!0,!0)),r!=null){const xe=C1(z,re);return[U,G,xe]}else return[U,G]},R={a:C,b:k,bias:T,preluActivationWeights:_},A={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Ic((F,L,M)=>{const q=Y.runKernel(Eb,R,A);return M([F,L,q]),{value:_e(q,S),gradFunc:$}})(C,k):Ic((F,L,M,q)=>{const z=Y.runKernel(Eb,R,A);return q([F,L,z,M]),{value:_e(z,S),gradFunc:$}})(C,k,T)}const due=K({fusedMatMul_:uue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue=Object.freeze(Object.defineProperty({__proto__:null,conv2d:sue,depthwiseConv2d:cue,matMul:due},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(t){return UI(t,.54,.46)}const pue=K({hammingWindow_:fue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(t){return UI(t,.5,.5)}const N6=K({hannWindow_:mue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(t,e,n,s=!1,r=0){let i=0;const o=[];for(;i+e<=t.size;)o.push(an(t,i,e)),i+=n;if(s)for(;i<t.size;){const a=i+e-t.size,l=gr([an(t,i,e-a),Ex([a],r)]);o.push(l),i+=n}return o.length===0?ca([],[0,e]):_e(gr(o),[o.length,e])}const T6=K({frame_:gue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xue(t,e,n,s,r=N6){s==null&&(s=k6(e));const i=T6(t,e,n),o=We(i,r(e));return zI(o,s)}const yue=K({stft_:xue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vue(t,e,n,s,r="bilinear",i=0){const o=D(t,"image","cropAndResize"),a=D(e,"boxes","cropAndResize","float32"),l=D(n,"boxInd","cropAndResize","int32"),c=a.shape[0];O(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),O(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),O(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),O(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),O(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:o,boxes:a,boxInd:l},h={method:r,extrapolationValue:i,cropSize:s};return Y.runKernel(NE,d,h)}const bue=K({cropAndResize_:vue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(t){const e=D(t,"image","flipLeftRight","float32");O(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return Y.runKernel(WE,n,{})}const Sue=K({flipLeftRight_:wue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cue(t){const e=D(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];O(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),O(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Fg(e,r)}const kue=K({grayscaleToRGB_:Cue});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nue(t){const e=D(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];O(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),O(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=rs(e,"float32"),o=Dr([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Cf("ij,j->i",i,o);break;case 3:a=Cf("ijk,k->ij",i,o);break;case 4:a=Cf("ijkl,l->ijk",i,o);break;case 5:a=Cf("ijklm,m->ijkl",i,o);break;case 6:a=Cf("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=ho(a,-1),rs(a,r)}const Tue=K({rgbToGrayscale_:Nue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(t,e,n=0,s=.5){const r=D(t,"image","rotateWithOffset","float32");O(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return Y.runKernel(CI,i,o)}const Eue=K({rotateWithOffset_:_ue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hm(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),O(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),O(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),O(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),O(e.rank===1,()=>"scores must be a 1D tensor"),O(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),O(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=D(t,"boxes","nonMaxSuppression","float32"),o=D(e,"scores","nonMaxSuppression","float32"),a=hm(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return Y.runKernel(T$,{boxes:i,scores:o},l)}const Iue=K({nonMaxSuppression_:$ue});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rue(t,e,n){const s=Pue(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function Pue(t,e,n){return jue(t,e,n||Aue)}function Aue(t,e){return t>e?1:t<e?-1:0}function jue(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HI(t,e,n,s,r){return KI(t,e,n,s,r,0)}function _6(t,e,n,s,r,i){return KI(t,e,n,s,r,0,!1,i,!0)}function GI(t,e,n,s,r,i){return KI(t,e,n,s,r,i,!0)}function KI(t,e,n,s,r,i,o=!1,a=!1,l=!1){const c=[];for(let x=0;x<e.length;x++)e[x]>r&&c.push({score:e[x],boxIndex:x,suppressBeginIndex:0});c.sort(Ij);const d=i>0?-.5/i:0,h=[],f=[];for(;h.length<n&&c.length>0;){const x=c.pop(),{score:y,boxIndex:v,suppressBeginIndex:S}=x;if(y<r)break;let C=!1;for(let k=h.length-1;k>=S;--k){const T=Due(t,v,h[k]);if(T>=s){C=!0;break}if(x.score=x.score*Oue(s,d,T),x.score<=r)break}x.suppressBeginIndex=h.length,C||(x.score===y?(h.push(v),f.push(x.score)):x.score>r&&Rue(c,x,Ij))}const p=h.length,m=n-p;a&&m>0&&(h.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));const g={selectedIndices:h};return o&&(g.selectedScores=f),l&&(g.validOutputs=p),g}function Due(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),p=(a-i)*(l-o),m=(h-c)*(f-d);if(p<=0||m<=0)return 0;const g=Math.max(i,c),x=Math.max(o,d),y=Math.min(a,h),v=Math.min(l,f),S=Math.max(y-g,0)*Math.max(v-x,0);return S/(p+m-S)}function Oue(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function Ij(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Fue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=D(t,"boxes","nonMaxSuppressionAsync"),o=D(e,"scores","nonMaxSuppressionAsync"),a=hm(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),c=l[0],d=l[1],{selectedIndices:h}=HI(c,d,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),Dr(h,"int32")}const Mue=Fue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=D(t,"boxes","nonMaxSuppression"),a=D(e,"scores","nonMaxSuppression"),l=hm(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:o,scores:a},d={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},h=Y.runKernel(_$,c,d);return{selectedIndices:h[0],selectedScores:h[1]}}const Bue=K({nonMaxSuppressionWithScore_:Lue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Vue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=D(t,"boxes","nonMaxSuppressionAsync"),a=D(e,"scores","nonMaxSuppressionAsync"),l=hm(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),d=c[0],h=c[1],{selectedIndices:f,selectedScores:p}=GI(d,h,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Dr(f,"int32"),selectedScores:Dr(p)}}const zue=Vue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=D(t,"boxes","nonMaxSuppression"),a=D(e,"scores","nonMaxSuppression"),l=hm(o,a,n,s,r,null),c=l.maxOutputSize,d=l.iouThreshold,h=l.scoreThreshold,f={boxes:o,scores:a},p={maxOutputSize:c,iouThreshold:d,scoreThreshold:h,padToMaxOutputSize:i},m=Y.runKernel(Uz,f,p);return{selectedIndices:m[0],validOutputs:m[1]}}const Uue=K({nonMaxSuppressionPadded_:Wue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Hue(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=D(t,"boxes","nonMaxSuppressionAsync"),a=D(e,"scores","nonMaxSuppressionAsync"),l=hm(o,a,n,s,r,null),c=l.maxOutputSize,d=l.iouThreshold,h=l.scoreThreshold,[f,p]=await Promise.all([o.data(),a.data()]),{selectedIndices:m,validOutputs:g}=_6(f,p,c,d,h,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:Dr(m,"int32"),validOutputs:ln(g,"int32")}}const Gue=Hue;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t,e,n=!1,s=!1){const r=D(t,"images","resizeBilinear");O(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),O(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=Y.runKernel(V$,a,l);return o?_e(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const que=K({resizeBilinear_:Kue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(t,e,n=!1,s=!1){const r=D(t,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),O(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),O(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=_e(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=Y.runKernel(B$,a,l);return o?_e(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Yue=K({resizeNearestNeighbor_:Xue});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Que(t,e="binary",n=!1,s=.5){const r=D(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let c=We(Dr([s]),255),d,h,f,p;if(O(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),O(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),O(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),O(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,h,f]=T0(r,[1,1,1],-1);const x=We(d,i),y=We(h,o),v=We(f,a);p=Nt(Nt(x,y),v)}else p=t;if(e==="otsu"){const x=WW(rs(g6(p),"int32"),El([]),256);c=Zue(x,l)}const m=n?II(p,c):v1(p,c);return rs(We(m,255),"int32")}function Zue(t,e){let n=Dr([-1]),s=Dr([0]),r=Dr([0]),i,o,a,l,c,d;for(let h=0;h<t.size-1;h++){i=an(t,0,h+1),o=an(t,h+1),c=dn(gs(i),e),d=dn(gs(o),e);const f=gs(We(i,k0(0,i.size)));a=dn(f,gs(i));const p=Ex(o.shape,i.size),m=Nt(k0(0,o.size),p),g=We(o,m);l=dn(gs(g),gs(o));const x=Qt(a,l),y=Qt(a,l),v=We(c,d);r=We(We(v,x),y);const S=v1(r,s);s=Du(S,r,s),n=Du(S,Dr([h]),n)}return n}const Jue=K({threshold_:Que});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ede(t,e,n="nearest",s="constant",r=0,i){const o=D(t,"image","transform","float32"),a=D(e,"transforms","transform","float32");O(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),O(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),O(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return Y.runKernel(yI,l,c)}const tde=K({transform_:ede});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(t,e,n){const s=D(t,"a","bandPart");O(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(O(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),O(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=D(e<0?i:e,"numLower","bandPart")):(O(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Du(Xk(e,0),i,C0(e,i))),typeof n=="number"?(O(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),O(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=D(n<0?o:n,"numUpper","bandPart")):(O(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Du(Xk(n,0),o,C0(n,o)));const c=_e(k0(0,i,1,"int32"),[-1,1]),d=k0(0,o,1,"int32"),h=Qt(c,d),f=Ob(II(h,a),e6(h,$l(l))),p=Rc([i,o],s.dtype);return _e(Pc(Wh(_e(s,[-1,i,o])).map(m=>Du(f,m,p))),r)}const sde=K({bandPart_:nde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rde(t){let e;if(Array.isArray(t)){e=!1,O(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)O(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=T0(t,t.shape[0],0).map(r=>Yn(r,[0]));O(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(Y.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=We(gs(We(n[o],i)),n[o]);i=Qt(i,a)}return dn(i,y1(i,"euclidean"))}));return e?Pc(n,0):n}const ide=K({gramSchmidt_:rde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ode(t,e=!1){if(O(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return Rj(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=Wh(_e(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,d]=Rj(l,e);r.push(c),i.push(d)});const o=_e(Pc(r,0),t.shape),a=_e(Pc(i,0),t.shape);return[o,a]}}function Rj(t,e=!1){return Y.tidy(()=>{O(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=QW(n),i=ju(t);const o=ca([[1]],[1,1]);let a=ju(o);const l=n>=s?s:n;for(let c=0;c<l;++c){const d=i,h=a,f=r;[a,i,r]=Y.tidy(()=>{const p=an(i,[c,c],[n-c,1]),m=y1(p),g=an(i,[c,c],[1,1]),x=Du(v1(g,0),ca([[-1]]),ca([[1]])),y=Qt(g,We(x,m)),v=dn(p,y);v.shape[0]===1?a=ju(o):a=gr([o,an(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);const S=$l(dn(Zn(x,y),m)),C=an(i,[c,0],[n-c,s]),k=We(S,a),T=Yk(a);if(c===0)i=Qt(C,Zn(k,Zn(T,C)));else{const R=Qt(C,Zn(k,Zn(T,C)));i=gr([an(i,[0,0],[c,s]),R],0)}const _=Yk(k),$=an(r,[0,c],[n,r.shape[1]-c]);if(c===0)r=Qt($,Zn(Zn($,a),_));else{const R=Qt($,Zn(Zn($,a),_));r=gr([an(r,[0,0],[n,c]),R],1)}return[a,i,r]}),Un([d,h,f])}return!e&&n>s&&(r=an(r,[0,0],[n,s]),i=an(i,[0,0],[s,s])),[r,i]})}const ade=K({qr_:ode});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var xi;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(xi||(xi={}));function lde(t,e,n=xi.SUM_BY_NONZERO_WEIGHTS){const s=D(t,"losses","computeWeightedLoss");let r=null;e!=null&&(r=D(e,"weights","computeWeightedLoss"));const i=r==null?s:We(s,r);if(n===xi.NONE)return i;if(n===xi.SUM)return gs(i);if(n===xi.MEAN){if(r==null)return Fb(i);{const o=s.size/r.size,a=dn(gs(i),gs(r));return o>1?dn(a,ln(o)):a}}if(n===xi.SUM_BY_NONZERO_WEIGHTS){if(r==null)return dn(gs(i),ln(s.size));{const o=We(r,zd(s.shape)),a=rs(gs(u6(o,ln(0))),"float32");return dn(gs(i),a)}}throw Error(`Unknown reduction: ${n}`)}const Fc=K({computeWeightedLoss_:lde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(t,e,n,s=xi.SUM_BY_NONZERO_WEIGHTS){const r=D(t,"labels","absoluteDifference"),i=D(e,"predictions","absoluteDifference");let o=null;n!=null&&(o=D(n,"weights","absoluteDifference")),Qi(r.shape,i.shape,"Error in absoluteDifference: ");const a=ao(Qt(r,i));return Fc(a,o,s)}const ude=K({absoluteDifference_:cde});function dde(t,e,n,s,r=xi.SUM_BY_NONZERO_WEIGHTS){const i=D(t,"labels","cosineDistance"),o=D(e,"predictions","cosineDistance");let a=null;s!=null&&(a=D(s,"weights","cosineDistance")),Qi(i.shape,o.shape,"Error in cosineDistance: ");const l=ln(1),c=Qt(l,gs(We(i,o),n,!0));return Fc(c,a,r)}const hde=K({cosineDistance_:dde});function fde(t,e,n,s=xi.SUM_BY_NONZERO_WEIGHTS){let r=D(t,"labels","hingeLoss");const i=D(e,"predictions","hingeLoss");let o=null;n!=null&&(o=D(n,"weights","hingeLoss")),Qi(r.shape,i.shape,"Error in hingeLoss: ");const a=ln(1);r=Qt(We(ln(2),r),a);const l=w1(Qt(a,We(r,i)));return Fc(l,o,s)}const pde=K({hingeLoss_:fde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(t,e,n,s=1,r=xi.SUM_BY_NONZERO_WEIGHTS){const i=D(t,"labels","huberLoss"),o=D(e,"predictions","huberLoss");let a=null;n!=null&&(a=D(n,"weights","huberLoss")),Qi(i.shape,o.shape,"Error in huberLoss: ");const l=ln(s),c=ao(Qt(o,i)),d=C0(c,l),h=Qt(c,d),f=Nt(We(ln(.5),la(d)),We(l,h));return Fc(f,a,r)}const gde=K({huberLoss_:mde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(t,e,n,s=1e-7,r=xi.SUM_BY_NONZERO_WEIGHTS){const i=D(t,"labels","logLoss"),o=D(e,"predictions","logLoss");let a=null;n!=null&&(a=D(n,"weights","logLoss")),Qi(i.shape,o.shape,"Error in logLoss: ");const l=ln(1),c=ln(s),d=$l(We(i,S0(Nt(o,c)))),h=We(Qt(l,i),S0(Nt(Qt(l,o),c))),f=Qt(d,h);return Fc(f,a,r)}const yde=K({logLoss_:xde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vde(t,e,n,s=xi.SUM_BY_NONZERO_WEIGHTS){const r=D(t,"labels","meanSquaredError"),i=D(e,"predictions","meanSquaredError");let o=null;n!=null&&(o=D(n,"weights","meanSquaredError")),Qi(r.shape,i.shape,"Error in meanSquaredError: ");const a=y6(r,i);return Fc(a,o,s)}const bde=K({meanSquaredError_:vde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wde(t,e){const n=D(t,"labels","sigmoidCrossEntropyWithLogits"),s=D(e,"logits","sigmoidCrossEntropyWithLogits");Qi(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=w1(s),i=We(s,n),o=n6($c($l(ao(s))));return Nt(Qt(r,i),o)}function Sde(t,e,n,s=0,r=xi.SUM_BY_NONZERO_WEIGHTS){let i=D(t,"multiClassLabels","sigmoidCrossEntropy");const o=D(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=D(n,"weights","sigmoidCrossEntropy")),Qi(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const c=ln(s),d=ln(1),h=ln(.5);i=Nt(We(i,Qt(d,c)),We(h,c))}const l=wde(i,o);return Fc(l,a,r)}const Cde=K({sigmoidCrossEntropy_:Sde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return Ic((r,i,o)=>{const l=r6(i,[n],!0),c=Qt(rs(i,"float32"),l);o([r,c]);const d=$l(We(c,r));return{value:gs(d,[n]),gradFunc:(p,m)=>{const[g,x]=m,y=Ji(p.shape,[n]);return[We(_e(p,y),Qt(rs(g,"float32"),$c(x))),We(_e(p,y),Qt($c(x),rs(g,"float32")))]}}})(t,e)}function Nde(t,e,n,s=0,r=xi.SUM_BY_NONZERO_WEIGHTS){let i=D(t,"onehotLabels","softmaxCrossEntropy");const o=D(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=D(n,"weights","softmaxCrossEntropy")),Qi(i.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const c=ln(s),d=ln(1),h=ln(i.shape[1]);i=Nt(We(i,Qt(d,c)),dn(c,h))}const l=kde(i,o);return Fc(l,a,r)}const Tde=K({softmaxCrossEntropy_:Nde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _de(t,e,n,s){const r=D(t,"indices","sparseFillEmptyRows","int32"),i=D(e,"values","sparseFillEmptyRows"),o=D(n,"denseShape","sparseFillEmptyRows","int32"),a=D(s,"defaultValue","sparseFillEmptyRows",i.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:i,denseShape:o,defaultValue:a},c=Y.runKernel(Yz,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const Ede=K({sparseFillEmptyRows_:_de});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $de(t,e,n){const s=D(t,"inputIndices","sparseReshape","int32"),r=D(e,"inputShape","sparseReshape","int32"),i=D(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);const o={inputIndices:s,inputShape:r,newShape:i},a=Y.runKernel(Qz,o);return{outputIndices:a[0],outputShape:a[1]}}const Ide=K({sparseReshape_:$de});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rde(t,e,n){const s=D(t,"data","sparseSegmentMean"),r=D(e,"indices","sparseSegmentMean","int32"),i=D(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return Y.runKernel(lI,o)}const Pde=K({sparseSegmentMean_:Rde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ade(t,e,n){const s=D(t,"data","sparseSegmentSum"),r=D(e,"indices","sparseSegmentSum","int32"),i=D(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);const o={data:s,indices:r,segmentIds:i};return Y.runKernel(cI,o)}const jde=K({sparseSegmentSum_:Ade});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dde(t,e,n,s,r,i,o,a){const l=D(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=D(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const d={separator:n,nGramWidths:s,leftPad:r,rightPad:i,padWidth:o,preserveShortSequences:a},h={data:l,dataSplits:c},f=Y.runKernel(fI,h,d);return{nGrams:f[0],nGramsSplits:f[1]}}const Ode=K({stringNGrams_:Dde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fde(t,e,n=!0){const s=D(t,"input","stringSplit","string"),r=D(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const i={skipEmpty:n},o={input:s,delimiter:r},a=Y.runKernel(eW,o,i);return{indices:a[0],values:a[1],shape:a[2]}}const Mde=K({stringSplit_:Fde});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lde(t,e){const n=D(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return Y.runKernel(tW,r,s)}const Bde=K({stringToHashBucketFast_:Lde});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vde(t,e,n,s=!0){const r=D(t,"input","staticRegexReplace","string"),i={pattern:e,rewrite:n,replaceGlobal:s};return Y.runKernel(Jz,{x:r},i)}const zde=K({staticRegexReplace_:Vde});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wde={fft:VI,ifft:Mb,rfft:zI,irfft:x6},Ude={hammingWindow:pue,hannWindow:N6,frame:T6,stft:yue},nh={flipLeftRight:Sue,grayscaleToRGB:kue,resizeNearestNeighbor:Yue,resizeBilinear:que,rgbToGrayscale:Tue,rotateWithOffset:Eue,cropAndResize:bue,nonMaxSuppression:Iue,nonMaxSuppressionAsync:Mue,nonMaxSuppressionWithScore:Bue,nonMaxSuppressionWithScoreAsync:zue,nonMaxSuppressionPadded:Uue,nonMaxSuppressionPaddedAsync:Gue,threshold:Jue,transform:tde},Hde={bandPart:sde,gramSchmidt:ide,qr:ade},Gde={absoluteDifference:ude,computeWeightedLoss:Fc,cosineDistance:hde,hingeLoss:pde,huberLoss:gde,logLoss:yde,meanSquaredError:bde,sigmoidCrossEntropy:Cde,softmaxCrossEntropy:Tde},Kde={sparseFillEmptyRows:Ede,sparseReshape:Ide,sparseSegmentMean:Pde,sparseSegmentSum:jde},qde={stringNGrams:Ode,stringSplit:Mde,stringToHashBucketFast:Bde,staticRegexReplace:zde};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xde=new Map,Yde=new Map;class Qde{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Pd{constructor(){this.classNameMap={}}static getMap(){return Pd.instance==null&&(Pd.instance=new Pd),Pd.instance}static register(e){Pd.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Zde(t,e,n){O(t.className!=null,()=>"Class being registered does not have the static className property defined."),O(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),O(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return Pd.register(t),Xde.set(r,t),Yde.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uh extends Qde{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Un(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return Moe(e,n)}dispose(){this.iterations_!=null&&Un(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:ln(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Uh,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jde extends Uh{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Y.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:Wt(()=>Co(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:Wt(()=>Co(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;Wt(()=>{const d=Nt(We(l,this.rho),We(la(a),1-this.rho)),h=We(dn(Ec(Nt(c,this.epsilon)),Ec(Nt(l,this.epsilon))),a),f=Nt(We(c,this.rho),We(la(h),1-this.rho));l.assign(d),c.assign(f);const p=Nt(We(h,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Un(this.accumulatedGrads.map(e=>e.variable)),Un(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ehe extends Uh{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Y.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:Wt(()=>Ex(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;Wt(()=>{const l=Nt(a,la(o));a.assign(l);const c=Nt(We(dn(o,Ec(Nt(l,Y.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Un(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class the extends Uh{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Wt(()=>{this.accBeta1=ln(n).variable(),this.accBeta2=ln(s).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Wt(()=>{const s=Qt(1,this.accBeta1),r=Qt(1,this.accBeta2);n.forEach((i,o)=>{const a=Y.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Wt(()=>Co(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:Wt(()=>Co(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const d=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,f=Nt(We(d,this.beta1),We(c,1-this.beta1)),p=Nt(We(h,this.beta2),We(la(c),1-this.beta2)),m=dn(f,s),g=dn(p,r);d.assign(f),h.assign(p);const x=Nt(We(dn(m,Nt(Ec(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(We(this.accBeta1,this.beta1)),this.accBeta2.assign(We(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Un(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Un(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),Wt(()=>{this.accBeta1.assign(w0(this.beta1,this.iterations_+1)),this.accBeta2.assign(w0(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nhe extends Uh{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Wt(()=>{this.iteration=ln(0).variable(),this.accBeta1=ln(n).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Wt(()=>{const s=Qt(1,this.accBeta1),r=dn(-this.learningRate,Nt(We(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=Y.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Co(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Co(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const d=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,f=Nt(We(d,this.beta1),We(c,1-this.beta1)),p=We(h,this.beta2),m=ao(c),g=l6(p,m);d.assign(f),h.assign(g);const x=Nt(We(dn(r,s),dn(f,Nt(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Nt(this.iteration,1)),this.accBeta1.assign(We(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Un(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Un(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E6 extends Uh{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=Y.registeredVariables[s];Wt(()=>{const a=Nt(We(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=yl(ln(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class she extends E6{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=ln(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Y.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:Wt(()=>Co(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&Wt(()=>{let l;const c=Nt(We(this.m,o),a);this.useNesterov?l=Nt(We(this.c,Nt(a,We(c,this.m))),i):l=Nt(We(this.c,c),i),o.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Un(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rhe extends Uh{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=Y.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Y.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:Wt(()=>Co(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:Wt(()=>Co(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:Wt(()=>Co(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;Wt(()=>{const d=Nt(We(l,this.decay),We(la(a),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,f=Nt(We(h,this.decay),We(a,1-this.decay)),p=dn(We(a,this.learningRate),Ec(Qt(d,Nt(la(f),this.epsilon)))),m=Nt(We(c,this.momentum),p);l.assign(d),h.assign(f),c.assign(m);const g=Qt(i,m);i.assign(g)}else{const h=Nt(We(l,this.decay),We(la(a),1-this.decay)),f=Nt(We(c,this.momentum),dn(We(a,this.learningRate),Ec(Nt(h,this.epsilon))));l.assign(h),c.assign(f);const p=Qt(i,f);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Un(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Un(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Un(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ihe=[Jde,ehe,the,nhe,she,rhe,E6];function ohe(){for(const t of ihe)Zde(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ahe="model",lhe=".json",che=".weights.bin";function Pj(t){return new Promise(e=>setTimeout(e)).then(t)}class Nh{constructor(e){if(!ue().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Nh.URL_SCHEME)&&(e=e.slice(Nh.URL_SCHEME.length)),(e==null||e.length===0)&&(e=ahe),this.modelJsonFileName=e+lhe,this.weightDataFileName=e+che}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Ja.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=$W(e,r),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await Pj(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await Pj(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Tx(e)}}}}Nh.URL_SCHEME="downloads://";class uhe{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=r=>{const i=JSON.parse(r.target.result),o=i.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:o});return}const l=TI(i,c=>this.loadWeights(c));e(l)},s.onerror=r=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const o of e)n.push(...o.weights),s.push(...o.paths);const r=this.checkManifestAndWeightFiles(e),i=s.map(o=>this.loadWeightsFile(o,r[o]));return Promise.all(i).then(o=>[n,o])}loadWeightsFile(e,n){return new Promise((s,r)=>{const i=new FileReader;i.onload=o=>{const a=o.target.result;s(a)},i.onerror=o=>r(`Failed to weights data from file of path '${e}'.`),i.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(i=>$j(i.name)),r={};for(const i of e)i.paths.forEach(o=>{const a=$j(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[o]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const dhe=t=>ue().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Nh.URL_SCHEME)?hhe(t.slice(Nh.URL_SCHEME.length)):null;$s.registerSaveRouter(dhe);function hhe(t="model"){return new Nh(t)}function fhe(t){return new uhe(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aj(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let r=0;const i=l=>(l.then(c=>{const d=n+ ++r/t.length*(s-n);return e(d),c}),l);function o(l){O(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){O(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),O(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),O(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $6(t,e){e==null&&(e={});const n=e.fetchFunc==null?ue().platform.fetch:e.fetchFunc,s=t.map(h=>n(h,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await Aj(s,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(a):await Aj(a,e.onProgress,.5,1)}function phe(t,e){var n;const s=e.fetchFunc==null?ue().platform.fetch:e.fetchFunc;let r=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){i||(i=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(c);return}o.close()}})}async function mhe(t,e="",n,s){return I6(o=>$6(o,{requestInit:s}))(t,e,n)}function I6(t){return async(e,n="",s)=>{const r=e.map(()=>!1),i={},o=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((p,m)=>{let g=0;p.weights.forEach(x=>{const y="quantization"in x?x.quantization.dtype:x.dtype,v=vh[y]*be(x.shape),S=()=>{r[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:x,groupOffset:g,sizeBytes:v})};s!=null?s.forEach((C,k)=>{C===x.name&&(S(),o[k]=!0)}):S(),a.push(x.name),g+=v})}),!o.every(p=>p)){const p=s.filter((m,g)=>!o[g]);throw new Error(`Could not find weights in manifest with names: ${p.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((p,m,g)=>(m&&p.push(g),p),[]),c=[];l.forEach(p=>{e[p].paths.forEach(m=>{const g=n+(n.endsWith("/")?"":"/")+m;c.push(g)})});const d=await t(c),h={};let f=0;return l.forEach(p=>{const m=e[p].paths.length,g=new Ja(d.slice(f,f+m));i[p].forEach(y=>{const v=g.slice(y.groupOffset,y.groupOffset+y.sizeBytes),S=TW(v,[y.manifestEntry]);for(const C in S)h[C]=S[C]}),f+=m}),h}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ghe="application/octet-stream",xhe="application/json";class qI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(O(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=ue().platform.fetch,O(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&O(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=$W(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:xhe}),"model.json"),e.weightData!=null){const o=Ja.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:ghe}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:Tx(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return TI(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=zk(e.weightsManifest),r=()=>phe(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=yhe(n),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(i+c+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=zk(e),r=await $6(n,this.loadOptions);return[s,r]}}qI.URL_SCHEME_REGEX=/^https?:\/\//;function yhe(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function Qk(t){return t.match(qI.URL_SCHEME_REGEX)!=null}const R6=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>Qk(s)):n=Qk(t),n)return XI(t,e)}return null};$s.registerSaveRouter(R6);$s.registerLoadRouter(R6);function XI(t,e){return new qI(t,e)}function vhe(t,e){return XI(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z2{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class P6{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class bhe{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function whe(t,e,n,s){const r=arguments;return new bhe(A6(...r))}function A6(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Z2(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Z2({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Z2({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function She(t){return new P6(t)}function Che(t){return new P6(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j6=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Ja,browserFiles:fhe,browserHTTPRequest:vhe,concatenateArrayBuffers:Nse,copyModel:Kse,decodeWeights:TW,decodeWeightsStream:EW,encodeWeights:vse,fromMemory:whe,fromMemorySync:A6,getLoadHandlers:Ase,getModelArtifactsForJSON:TI,getModelArtifactsForJSONSync:IW,getModelArtifactsInfoForJSON:Tx,getSaveHandlers:Pse,getWeightSpecs:zk,http:XI,isHTTPScheme:Qk,listModels:Hse,loadWeights:mhe,moveModel:qse,registerLoadRouter:Rse,registerSaveRouter:Ise,removeModel:Gse,weightsLoaderFactory:I6,withSaveHandler:She,withSaveHandlerSync:Che},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let pd,jj=!1;function khe(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)i=!0;else if(t.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(Pb(_b,Y.backendName)!=null){const m={pixels:t},g={numChannels:e};return Y.runKernel(_b,m,g)}const[c,d]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h;if(o)h=t.getContext("2d").getImageData(0,0,c,d).data;else if(s||n)h=t.data;else if(i||r||a){if(pd==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")pd=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else pd=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});pd.canvas.width=c,pd.canvas.height=d,pd.drawImage(t,0,0,c,d),h=pd.getImageData(0,0,c,d).data}let f;if(e===4)f=new Int32Array(h);else{const m=c*d;f=new Int32Array(m*e);for(let g=0;g<m;g++)for(let x=0;x<e;++x)f[g*e+x]=h[g*4+x]}return b6(f,[d,c,e],"int32")}function Nhe(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}async function YI(t,e){let n=D(t,"img","toPixels");if(!(t instanceof js)){const c=n;n=rs(c,"int32"),c.dispose()}Nhe(n);const[s,r]=n.shape.slice(0,2),i=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let c=0;c<s*r;++c){const d=[0,0,0,255];for(let f=0;f<i;f++){const p=o[c*i+f];if(n.dtype==="float32"){if(p<0||p>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${p}.`)}else if(n.dtype==="int32"&&(p<0||p>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${p}.`);i===1?(d[0]=p*a,d[1]=p*a,d[2]=p*a):d[f]=p*a}const h=c*4;l[h+0]=Math.round(d[0]),l[h+1]=Math.round(d[1]),l[h+2]=Math.round(d[2]),l[h+3]=Math.round(d[3])}if(e!=null){jj||Pb(Lz,Y.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),jj=!0),e.width=r,e.height=s;const c=e.getContext("2d"),d=new ImageData(l,r,s);c.putImageData(d,0,0)}return n!==t&&n.dispose(),l}const D6=K({fromPixels_:khe});function QI(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(be(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const a=t.shape,l=r.slice();l.pop();let c=1;for(let h=i;h<n;++h)c*=a[h],l.push(a[h]);const d=[...Ms(t.shape).map(h=>h/c),1].slice(0,i);return[l,o,c,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zk=-2,The=-1;function ZI(t,e,n){const s=t.shape.length;O(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),O(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)O(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function _he(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function JI(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function O6(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function F6(t,e,n){return n<=t?n:n-(e-1)}function M6(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function Ehe(t,e,n,s,r,i,o,a,l){const c=t.length;let d=new Array(c),h=new Array(c),f=new Array(c);if(e.length&&n>0){const p=e[0],m=n+1;d=L6(o,p,m,s,t),h=B6(a,p,m,r,t),f=O6(i,p,m,t)}else for(let p=0;p<c;p++)d[p]=z6(o,s,i,t,p,l),h[p]=W6(a,r,i,t,p,l),f[p]=V6(i,p,l);return{begin:d,end:h,strides:f}}function L6(t,e,n,s,r){const i=[...r],o=M6(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=F6(e,n,a);let c=s[l];t&1<<l&&(c=0),i[a]=c}return i}function B6(t,e,n,s,r){const i=[...r],o=M6(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=F6(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Nb(0,i[a],r[a])}return i}function V6(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function z6(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Nb(0,o,l-1),o}function W6(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Nb(0,o,l):o=Nb(-1,o,l-1),o}function eR(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function tR(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function nR(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{O(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(O(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function sR(t,e,n,s,r,i,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const h={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let S=0;S<h.dims;S++)d&&1<<S&a&&h.numAddAxisAfterEllipsis++,1<<S&o&&(d=!0);d||(h.ellipsisMask|=1<<h.dims,h.dims++);const f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};$he(h,f);let p=!0,m=!0,g=!0;const x=[],y=[];for(let S=0;S<t.length;++S){if(f.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const C=!!(f.shrinkAxisMask&1<<S),k=t[S];if(k===-1){x.push(C?1:-1);continue}const T=[f.beginMask&1<<S,f.endMask&1<<S],_=[f.strides[S]>0?0:-1,f.strides[S]>0?k:k-1];if(C&&f.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&f.strides[S]===1;const $=!!(f.beginMask&1<<S&&f.endMask&1<<S);if(f.beginValid&&f.endValid){if(C){const F=f.begin[S]<0?k+f.begin[S]:f.begin[S];if(f.begin[S]=F,f.end[S]=f.begin[S]+1,F<0||F>=k)throw Error(`slice index ${f.begin[S]} of dimension ${S} out of bounds.`)}else f.begin[S]=Dj(f.begin[S],0,f.strides[S],k,T,_),f.end[S]=Dj(f.end[S],1,f.strides[S],k,T,_);const j=f.strides[S]===1&&f.begin[S]===0&&f.end[S]===k;p=p&&j,m=m&&(S===0&&f.strides[S]===1||j)}else p=p&&f.strides[S]===1&&$,m=m&&(S===0&&f.strides[S]===1||$);let R,A=!1;if(f.beginValid&&f.endValid?(R=f.end[S]-f.begin[S],A=!0):C?(R=1,A=!0):$&&k>=0&&(f.strides[S]<0?R=-k:R=k,A=!0),A){let j;R===0||R<0!=f.strides[S]<0?j=0:j=Math.trunc(R/f.strides[S])+(R%f.strides[S]!==0?1:0),x.push(j)}else x.push(-1)}for(let S=0;S<f.finalShapeGatherIndices.length;++S){const C=f.finalShapeGatherIndices[S];C>=0?y.push(x[C]):C===Zk&&y.push(1)}return{finalShapeSparse:y.filter((S,C)=>f.finalShapeGatherIndices[C]!==Zk),finalShape:y,isIdentity:p,sliceDim0:m,isSimpleSlice:g,begin:f.begin,end:f.end,strides:f.strides}}function $he(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(Zk),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(The),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function Dj(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const Ihe=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:ZI,computeFlatOffset:tR,computeOutShape:JI,getNormalizedAxes:Ehe,isSliceContinous:eR,maskToAxes:_he,parseSliceParams:nR,sliceInfo:sR,startForAxis:z6,startIndicesWithElidedDims:L6,stopForAxis:W6,stopIndicesWithElidedDims:B6,stridesForAxis:V6,stridesWithElidedDims:O6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rhe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function Phe(){return new Promise(t=>Rhe(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(t,e){const n=t[0].length;t.forEach((r,i)=>{O(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),O(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)O(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function ma(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Aa;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Aa||(Aa={}));function U6(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function H6(t){const e={FIRST_DIM_SIZE:Aa.FIRST_DIM_SIZE,VALUE_ROWIDS:Aa.VALUE_ROWIDS,ROW_LENGTHS:Aa.ROW_LENGTHS,ROW_SPLITS:Aa.ROW_SPLITS,ROW_LIMITS:Aa.ROW_LIMITS,ROW_STARTS:Aa.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function G6(t){return t.length===0?0:t[0]===Aa.FIRST_DIM_SIZE?t.length-1:t.length}function K6(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iR=30;function T1(t){return t<=iR?t:Ak(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oR(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ix(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function Rx(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Px(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function aR(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function lR(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cR=1.7580993408473768,uR=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dR=.3275911,hR=.254829592,fR=-.284496736,pR=1.421413741,mR=-1.453152027,gR=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _0(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function Ahe(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function jhe(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function Dhe(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function Ohe(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function Fhe(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function Mhe(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function Lhe(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2="->",Bhe=/->/g,Oj=",",Fj="...";function xR(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Bhe,"").length)/J2.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${J2}").`);const[s,r]=t.split(J2);O(s.indexOf(Fj)===-1,()=>`The ellipsis notation ("${Fj}") is not supported yet.`);const i=s.split(Oj),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<r.length;++f){const p=r[f];if(!i.some(m=>m.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let f=0;f<s.length;++f){const p=s[f];a.indexOf(p)===-1&&p!==Oj&&a.push(p)}const l=new Array(i.length);for(let f=0;f<o;++f){if(new Set(i[f].split("")).size!==i[f].length)throw new Error(`Found duplicate axes in input component ${i[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let p=0;p<i[f].length;++p)l[f].push(a.indexOf(i[f][p]))}const c=a.length,d=r.length,h=[];for(let f=d;f<c;++f)h.push(f);return{allDims:a,summedDims:h,idDims:l}}function yR(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function vR(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:O(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function bR(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=Vhe(e,a);for(const c of l)i.indexOf(c)===-1&&(s[o].push(c),i.push(c))}return{path:n,steps:s}}function wR(t){return t.every((e,n)=>e===n)}function Vhe(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function SR(t,e,n=0){let s=[];if(typeof e=="number")O(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);O(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}O(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function X6(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function Y6(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function Z6(t,e){return`size ${t} must be non-negative, not ${e}`}function J6(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function eU(t,e){const n=be(t),s=be(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function tU(t,e){const n=be(t),s=be(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jk(){return"segment ids must be >= 0"}function nU(){return"segment ids are not increasing"}function sU(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function rU(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iU(t,e){let n=!1,s;for(t<=iR?(s=t,n=!0):s=Ak(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Ak(t,s+1);return s}function CR(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function kR(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let l=1,c=1,d=1;for(let h=0;h<s;++h)a.push(t.shape[h]),l*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),c*=t.shape[h];for(let h=s;h<r;h++)a.push(e.shape[h]);for(let h=n+1;h<i;h++)a.push(t.shape[h]),d*=t.shape[h];return{batchSize:l,sliceSize:d,outerSize:c,dimSize:o,outputShape:a}}const zhe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:kR,computeOutShape:CR,segOpComputeOptimalWindowSize:iU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ku(t){try{return t.map(e=>Tc(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function oU(t){return t.map(e=>Au(e))}const Whe=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:hR,ERF_A2:fR,ERF_A3:pR,ERF_A4:mR,ERF_A5:gR,ERF_P:dR,PARALLELIZE_THRESHOLD:iR,get RowPartitionType(){return Aa},SELU_SCALE:uR,SELU_SCALEALPHA:cR,applyActivation:k1,assertAndGetBroadcastShape:nn,assertAxesAreInnerMostDims:eo,assertParamsConsistent:rR,assignToTypedArray:Fhe,axesAreInnerMostDims:$I,calculateShapes:zh,checkEinsumDimSizes:vR,checkPadOnDimRoundingMode:va,combineLocations:XW,combineRaggedTensorToTensorShapes:U6,complexWithEvenIndex:jhe,complexWithOddIndex:Dhe,computeConv2DInfo:sr,computeConv3DInfo:ad,computeDefaultPad:_I,computeDilation2DInfo:_x,computeOptimalWindowSize:T1,computeOutAndReduceShapes:Oo,computeOutShape:ma,computePool2DInfo:ya,computePool3DInfo:Oc,convertConv2DDataFormat:el,decodeEinsumEquation:xR,eitherStridesOrDilationsAreOne:ri,expandShapeToKeepDim:Ji,exponent:Lhe,exponents:Mhe,fromStringArrayToUint8:oU,fromUint8ToStringArray:Ku,getAxesPermutation:Mr,getBroadcastDims:Mp,getComplexWithIndex:Ohe,getEinsumComputePath:bR,getEinsumPermutation:yR,getFusedBiasGradient:C1,getFusedDyActivation:S1,getImageCenter:oR,getInnerMostAxes:Lr,getPermuted:Rx,getRaggedRank:G6,getReductionAxes:GW,getReshaped:Ix,getReshapedPermuted:Px,getRowPartitionTypesHelper:H6,getSliceBeginCoords:aR,getSliceSize:lR,getSparseFillEmptyRowsIndicesDenseShapeMismatch:q6,getSparseFillEmptyRowsNegativeIndexErrorMessage:X6,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Y6,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:J6,getSparseReshapeInputOutputMismatchErrorMessage:tU,getSparseReshapeInputOutputMultipleErrorMessage:eU,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Q6,getSparseReshapeNegativeOutputDimErrorMessage:Z6,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:rU,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Jk,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:nU,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:sU,getUndoAxesPermutation:$x,isIdentityPermutation:wR,log:Une,mergeRealAndImagArrays:_0,prepareAndValidate:QI,prepareSplitSize:SR,segment_util:zhe,shouldFuse:N1,slice_util:Ihe,splitRealAndImagArrays:Ahe,stridesOrDilationsArePositive:Ch,tupleValuesAreOne:b0,upcastType:wi,validateDefaultValueShape:K6,validateInput:WI,validateUpdateShape:w6,warn:Da},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ohe();/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uhe=ue();Uhe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Di;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(Di||(Di={}));var Mj;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(Mj||(Mj={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hhe={};function aU(t){return Hhe[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E(t,e,n,s,r){const i=e.inputParams[t];if(i&&i.inputIndexStart!==void 0){const a=i.inputIndexStart,l=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?a+1:i.inputIndexEnd,c=a<0?e.inputNames.length+a:a;if(i.type==="tensor")return Sr(e.inputNames[c],n,s,r);if(i.type==="tensors"){const f=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((m,g)=>{var x;return((x=f[g])===null||x===void 0?void 0:x.op)!=="NoOp"}).map(m=>Sr(m,n,s,r))}const d=Sr(e.inputNames[c],n,s,r),h=d.dataSync();return i.type==="number"?h[0]:jk(d.shape,h)}const o=e.attrParams[t];return o&&o.value}function Sr(t,e,n,s){const[r,i]=Mi(t,n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const o=n.currentContextIds.find(a=>!!e[Lb(r,a)]);return o!==void 0?e[Lb(r,o)][i]:void 0}function Lj(t,e,n){return e[Lb(t,n.currentContextId)]}function sc(t,e){const[n,s,r]=Mi(t,e);return[Lb(n,e&&e.currentContextId),s,r]}function Lb(t,e){return e?`${t}-${e}`:t}function Mi(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const i=e.parseNodeNameCache.get(t);if(i!=null)return i}const s=t.split(":");let r;if(s.length===1)r=[t,0,void 0];else{const i=s[0],o=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[i,a,o]}return n&&e.parseNodeNameCache.set(t,r),r}function $v(t,e,n){let s=E("pad",t,e,n);if(s==="explicit"){s=E("explicitPaddings",t,e,n);const r=[[0,0],[0,0],[0,0],[0,0]];for(let i=0;i<4;i++)r[i][0]=s[i*2],r[i][1]=s[i*2+1];return r}return s}function rc(t){return t.kept?t:ju(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ghe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Khe=Object.freeze(Object.defineProperty({__proto__:null,json:Ghe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qhe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Xhe=Object.freeze(Object.defineProperty({__proto__:null,json:qhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yhe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Qhe=Object.freeze(Object.defineProperty({__proto__:null,json:Yhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zhe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Jhe=Object.freeze(Object.defineProperty({__proto__:null,json:Zhe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const efe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],tfe=Object.freeze(Object.defineProperty({__proto__:null,json:efe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nfe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],sfe=Object.freeze(Object.defineProperty({__proto__:null,json:nfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rfe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],ife=Object.freeze(Object.defineProperty({__proto__:null,json:rfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ofe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],afe=Object.freeze(Object.defineProperty({__proto__:null,json:ofe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lfe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],cfe=Object.freeze(Object.defineProperty({__proto__:null,json:lfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ufe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],dfe=Object.freeze(Object.defineProperty({__proto__:null,json:ufe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hfe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],ffe=Object.freeze(Object.defineProperty({__proto__:null,json:hfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pfe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],mfe=Object.freeze(Object.defineProperty({__proto__:null,json:pfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gfe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],xfe=Object.freeze(Object.defineProperty({__proto__:null,json:gfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],vfe=Object.freeze(Object.defineProperty({__proto__:null,json:yfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bfe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],wfe=Object.freeze(Object.defineProperty({__proto__:null,json:bfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sfe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Cfe=Object.freeze(Object.defineProperty({__proto__:null,json:Sfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kfe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Nfe=Object.freeze(Object.defineProperty({__proto__:null,json:kfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],_fe=Object.freeze(Object.defineProperty({__proto__:null,json:Tfe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Efe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],$fe=Object.freeze(Object.defineProperty({__proto__:null,json:Efe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bj{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Khe,Xhe,Qhe,Jhe,tfe,sfe,ife,afe,cfe,dfe,ffe,mfe,xfe,vfe,wfe,Cfe,Nfe,_fe,$fe],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,n={}){const s=e.node,r=[],i=[],o=[],a=s.reduce((g,x)=>(g[x.name]=this.mapNode(x),x.op.startsWith("Placeholder")?r.push(g[x.name]):x.op==="Const"?i.push(g[x.name]):(x.input==null||x.input.length===0)&&o.push(g[x.name]),g),{});let l=[];const c=[];let d={},h={};n!=null&&(d=this.mapSignatureEntries(n.inputs),h=this.mapSignatureEntries(n.outputs));const f=Object.keys(a);f.forEach(g=>{const x=a[g];x.inputNames.forEach((y,v)=>{const[S,,C]=sc(y),k=a[S];if(k.outputs!=null){const T=k.outputs.indexOf(C);if(T!==-1){const _=`${S}:${T}`;x.inputNames[v]=_}}x.inputs.push(k),k.children.push(x)})}),Object.keys(h).length===0?f.forEach(g=>{const x=a[g];x.children.length===0&&c.push(x)}):Object.keys(h).forEach(g=>{const[x]=sc(g),y=a[x];y!=null&&(y.signatureKey=h[g],c.push(y))}),Object.keys(d).length>0?Object.keys(d).forEach(g=>{const[x]=sc(g),y=a[x];y&&(y.signatureKey=d[g],l.push(y))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((g,x)=>(g[x.signature.name]=this.mapFunction(x),g),{}));const m={nodes:a,inputs:l,outputs:c,weights:i,placeholders:r,signature:n,functions:p};return o.length>0&&(m.initNodes=o),m}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=aU(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((r,i)=>(r[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},r),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((r,i)=>{const o=i.type;let a;switch(i.type){case"string":a=eN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=eN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":a=aN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=aN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":a=nN(e.attr,i.tfName,i.defaultValue||0),a===void 0&&i.tfDeprecatedName&&(a=nN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":a=oN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=oN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":a=tN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=tN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":a=cN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=cN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":a=iN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=iN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":a=lN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=lN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":a=sN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=sN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":a=rN(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=rN(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":a=Vj(e.attr,i.tfName,i.defaultValue),a===void 0&&i.tfDeprecatedName&&(a=Vj(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${i.type} for op: ${e.op}`)}return r[i.name]={value:a,type:o},r},{})),s}mapFunction(e){const n=e.nodeDef,s=[],r=[];let i={};n!=null&&(i=n.reduce((h,f)=>(h[f.name]=this.mapNode(f),f.op==="Const"&&r.push(h[f.name]),h),{}));const o=[],a=[];e.signature.inputArg.forEach(h=>{const[f]=sc(h.name),p={name:f,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:NR(h.type),type:"dtype"}},children:[]};p.signatureKey=h.name,o.push(p),i[f]=p}),Object.keys(i).forEach(h=>{const f=i[h];f.inputNames.forEach((p,m)=>{const[g,,x]=sc(p),y=i[g];if(y.outputs!=null){const v=y.outputs.indexOf(x);if(v!==-1){const S=`${g}:${v}`;f.inputNames[m]=S}}f.inputs.push(y),y.children.push(f)})});const c=e.ret;e.signature.outputArg.forEach(h=>{const[f,p]=sc(c[h.name]),m=i[f];m!=null&&(m.defaultOutput=p,a.push(m))});const d=this.mapArgsToSignature(e);return{nodes:i,inputs:o,outputs:a,weights:r,placeholders:s,signature:d}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function Ife(t){const e=ue().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function lU(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):Ife(t);return e?n:n.toLowerCase()}function eN(t,e,n,s=!1){const r=t[e];return r!=null?lU(r.s,s):n}function tN(t,e,n){const s=t[e];return s?s.b:n}function nN(t,e,n){const s=t[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:n;return typeof r=="number"?r:parseInt(r,10)}function NR(t){switch(typeof t=="string"&&(t=Di[t]),t){case Di.DT_FLOAT:case Di.DT_HALF:return"float32";case Di.DT_INT32:case Di.DT_INT64:case Di.DT_INT8:case Di.DT_UINT8:return"int32";case Di.DT_BOOL:return"bool";case Di.DT_DOUBLE:return"float32";case Di.DT_STRING:return"string";case Di.DT_COMPLEX64:case Di.DT_COMPLEX128:return"complex64";default:return null}}function Vj(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function sN(t,e,n){const s=t[e];return s&&s.type?NR(s.type):n}function rN(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(r=>NR(r)):n}function cU(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function iN(t,e,n){const s=t[e];return s&&s.shape?cU(s.shape):n}function oN(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):n}function aN(t,e,n,s=!1){const r=t[e];return r&&r.list&&r.list.s?r.list.s.map(i=>lU(i,s)):n}function lN(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>cU(r)):n}function cN(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rfe{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,i)=>(r[i]=this.getAttr(i),r),{}))}getInput(e){return Sr(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return Sr(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return nN(this.node.rawAttrs,e,n);if(s.s!=null)return eN(this.node.rawAttrs,e,n);if(s.b!=null)return tN(this.node.rawAttrs,e,n);if(s.shape!=null)return iN(this.node.rawAttrs,e,n);if(s.type!=null)return sN(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return oN(this.node.rawAttrs,e,n);if(s.list.s!=null)return aN(this.node.rawAttrs,e,n);if(s.list.shape!=null)return lN(this.node.rawAttrs,e,n);if(s.list.b!=null)return cN(this.node.rawAttrs,e,n);if(s.list.type!=null)return rN(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _r=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:kW,abs:ao,acos:are,acosh:cre,add:Nt,addN:dre,all:fre,any:mre,argMax:BW,argMin:yre,asin:bre,asinh:Sre,atan:kre,atan2:Tre,atanh:Ere,avgPool:VW,avgPool3d:Ore,basicLSTMCell:Wre,batchNorm:g1,batchNorm2d:qre,batchNorm3d:Yre,batchNorm4d:Zre,batchToSpaceND:zW,bincount:WW,bitwiseAnd:tie,booleanMaskAsync:Mce,broadcastArgs:sie,broadcastTo:Og,buffer:Kn,cast:rs,ceil:oie,clipByValue:UW,clone:ju,complex:Uu,concat:gr,concat1d:cie,concat2d:die,concat3d:fie,concat4d:mie,conv1d:yie,conv2d:x1,conv2dTranspose:wie,conv3d:Cie,conv3dTranspose:_ie,cos:$ie,cosh:Rie,cosineWindow:UI,cumprod:Aie,cumsum:Die,denseBincount:Fie,depthToSpace:Lie,depthwiseConv2d:EI,diag:zie,dilation2d:Uie,div:dn,divNoNan:Xie,dot:Qie,dropout:Qce,einsum:Cf,elu:qW,enclosingPowerOfTwo:k6,ensureShape:toe,equal:KW,erf:soe,euclideanNorm:hoe,exp:$c,expandDims:ho,expm1:goe,eye:QW,fft:VI,fill:Ex,floor:ZW,floorDiv:LW,fused:hue,gather:JW,gatherND:qce,greater:v1,greaterEqual:e6,ifft:Mb,imag:b1,image:nh,inTopKAsync:Jce,irfft:x6,isFinite:Noe,isInf:_oe,isNaN:$oe,leakyRelu:t6,less:Xk,lessEqual:II,linalg:Hde,linspace:Aoe,localResponseNormalization:Doe,log:S0,log1p:n6,logSigmoid:zoe,logSoftmax:Hoe,logSumExp:r6,logicalAnd:Ob,logicalNot:i6,logicalOr:o6,logicalXor:Qoe,losses:Gde,lowerBound:Joe,matMul:Zn,max:ip,maxPool:a6,maxPool3d:nae,maxPoolWithArgmax:rae,maximum:l6,mean:Fb,meshgrid:aae,min:qk,minimum:C0,mirrorPad:c6,mod:dae,moments:fae,movingAverage:Vce,mul:We,multiRNNCell:mae,multinomial:xae,neg:$l,norm:y1,notEqual:u6,oneHot:bae,ones:zd,onesLike:Sae,op:K,outerProduct:kae,pad:Gu,pad1d:_ae,pad2d:$ae,pad3d:Rae,pad4d:Aae,pool:Mae,pow:w0,prelu:h6,print:MW,prod:Vae,raggedGather:Wae,raggedRange:Hae,raggedTensorToTensor:Kae,rand:Xae,randomGamma:mle,randomNormal:p6,randomStandardNormal:yle,randomUniform:BI,randomUniformInt:wle,range:k0,real:N0,reciprocal:kle,relu:w1,relu6:m6,reshape:_e,reverse:kh,reverse1d:$le,reverse2d:Rle,reverse3d:Ale,reverse4d:Dle,rfft:zI,round:g6,rsqrt:Mle,scalar:ln,scatterND:Wce,searchSorted:RI,selu:Ble,separableConv2d:zle,setdiff1dAsync:Ule,sigmoid:fc,sign:Gle,signal:Ude,sin:qle,sinh:Yle,slice:an,slice1d:Zle,slice2d:ece,slice3d:nce,slice4d:rce,softmax:oce,softplus:s6,spaceToBatchND:d6,sparse:Kde,sparseToDense:Gce,spectral:Wde,split:T0,sqrt:Ec,square:la,squaredDifference:y6,squeeze:Yn,stack:Pc,step:v6,stridedSlice:xce,string:qde,sub:Qt,sum:gs,tan:vce,tanh:Kk,tensor:El,tensor1d:Dr,tensor2d:ca,tensor3d:b6,tensor4d:bce,tensor5d:wce,tensor6d:Sce,tensorScatterUpdate:kce,tile:Fg,topk:Tce,transpose:Yk,truncatedNormal:Ece,unique:Ice,unsortedSegmentSum:Pce,unstack:Wh,upperBound:jce,variable:Dce,where:Du,whereAsync:C6,zeros:Rc,zerosLike:Co},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pfe=(t,e,n,s=_r)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(E("a",t,e,n),E("b",t,e,n))];case"AddN":return[s.addN(E("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(E("a",t,e,n),E("b",t,e,n))];case"Mul":return[s.mul(E("a",t,e,n),E("b",t,e,n))];case"RealDiv":case"Div":return[s.div(E("a",t,e,n),E("b",t,e,n))];case"DivNoNan":return[s.divNoNan(E("a",t,e,n),E("b",t,e,n))];case"FloorDiv":return[s.floorDiv(E("a",t,e,n),E("b",t,e,n))];case"Sub":return[s.sub(E("a",t,e,n),E("b",t,e,n))];case"Minimum":return[s.minimum(E("a",t,e,n),E("b",t,e,n))];case"Maximum":return[s.maximum(E("a",t,e,n),E("b",t,e,n))];case"Pow":return[s.pow(E("a",t,e,n),E("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Afe=(t,e,n,s=_r)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(E("x",t,e,n))];case"Acos":return[s.acos(E("x",t,e,n))];case"Acosh":return[s.acosh(E("x",t,e,n))];case"Asin":return[s.asin(E("x",t,e,n))];case"Asinh":return[s.asinh(E("x",t,e,n))];case"Atan":return[s.atan(E("x",t,e,n))];case"Atan2":return[s.atan2(E("x",t,e,n),E("y",t,e,n))];case"Atanh":return[s.atanh(E("x",t,e,n))];case"Ceil":return[s.ceil(E("x",t,e,n))];case"Complex":return[s.complex(E("real",t,e,n),E("imag",t,e,n))];case"Cos":return[s.cos(E("x",t,e,n))];case"Cosh":return[s.cosh(E("x",t,e,n))];case"Elu":return[s.elu(E("x",t,e,n))];case"Erf":return[s.erf(E("x",t,e,n))];case"Exp":return[s.exp(E("x",t,e,n))];case"Expm1":return[s.expm1(E("x",t,e,n))];case"Floor":return[s.floor(E("x",t,e,n))];case"Log":return[s.log(E("x",t,e,n))];case"Log1p":return[s.log1p(E("x",t,e,n))];case"Imag":return[s.imag(E("x",t,e,n))];case"Neg":return[s.neg(E("x",t,e,n))];case"Reciprocal":return[s.reciprocal(E("x",t,e,n))];case"Real":return[s.real(E("x",t,e,n))];case"Relu":return[s.relu(E("x",t,e,n))];case"Round":return[s.round(E("x",t,e,n))];case"Selu":return[s.selu(E("x",t,e,n))];case"Sigmoid":return[s.sigmoid(E("x",t,e,n))];case"Sin":return[s.sin(E("x",t,e,n))];case"Sign":return[s.sign(E("x",t,e,n))];case"Sinh":return[s.sinh(E("x",t,e,n))];case"Softplus":return[s.softplus(E("x",t,e,n))];case"Sqrt":return[s.sqrt(E("x",t,e,n))];case"Square":return[s.square(E("x",t,e,n))];case"Tanh":return[s.tanh(E("x",t,e,n))];case"Tan":return[s.tan(E("x",t,e,n))];case"ClipByValue":return[s.clipByValue(E("x",t,e,n),E("clipValueMin",t,e,n),E("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(E("x",t,e,n))];case"Rsqrt":return[s.rsqrt(Sr(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu(E("x",t,e,n),E("alpha",t,e,n))];case"Prelu":return[s.prelu(E("x",t,e,n),E("alpha",t,e,n))];case"IsNan":return[s.isNaN(Sr(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(Sr(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(Sr(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xo(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){O(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const r=t[s],i=e[s];O(r<0||i<0||r===i,()=>n+` Shapes ${t} and ${e} must match`)}}}function zj(t){return!(typeof t=="number"||t.some(e=>e<0))}function zm(t,e,n){let s=uN(t,n);const r=!zj(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(i=>{s=uN(i.shape,s)}),!zj(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function uN(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const r=t[s],i=e[s];if(r>=0&&i>=0&&r!==i)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=r>=0?r:i}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jfe{constructor(e,n,s,r,i,o,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=ln(0),yl(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),Xo(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,yl(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,r)=>this.write(s,n[r]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return El([],[0].concat(this.elementShape));const s=this.readMany(e);return Xo(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),Pc(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return El([],[0].concat(this.elementShape));const n=[];for(let r=0;r<this.size();r++)n.push(r);const s=this.readMany(n);return Xo(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),gr(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Wh(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const i=s===0?0:n.size/s,o=[];Wt(()=>{n=_e(n,[1,s,i]);for(let l=0;l<e.length;++l){const d=[0,l===0?0:r[l-1],0],h=[1,e[l],i];o[l]=_e(an(n,d,h),this.elementShape)}return o});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,o)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Th{get id(){return this.idTensor.id}constructor(e,n,s,r=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(i=>{if(s!==i.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${i.dtype}`);Xo(n,i.shape,"TensorList shape mismatch: "),yl(i)}),this.idTensor=ln(0),this.maxNumElements=r,yl(this.idTensor)}copy(){return new Th([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Xo(e,this.elementShape,"TensorList shape mismatch: ");const r=zm(this.elementShape,this.tensors,e);return Wt(()=>{const i=this.tensors.map(o=>_e(o,r));return Pc(i,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=zm(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Xo(r.shape,e,"TensorList shape mismatch: "),_e(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Xo(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");yl(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new Th([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Xo(this.tensors[e].shape,n,"TensorList shape mismatch: ");const r=zm(this.elementShape,this.tensors,n);return _e(this.tensors[e],r)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Xo(this.elementShape,n.shape,"TensorList shape mismatch: "),yl(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Xo(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=zm(this.elementShape,this.tensors,s);return e.length===0?El([],[0].concat(r)):Wt(()=>{const i=e.map(o=>_e(this.tensors[o],r));return Pc(i,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Xo(this.elementShape,n,"TensorList shape mismatch: ");const s=zm(this.elementShape,this.tensors,n);return this.size()===0?El([],[0].concat(s)):Wt(()=>{const r=this.tensors.map(i=>_e(i,s));return gr(r,0)})}}function Dfe(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const r=t.shape.slice(1);Xo(r,e,"TensorList shape mismatch: ");const i=Wh(t);return new Th(i,e,s)}function Ofe(t,e,n,s){return new Th([],t,e,s)}function Ffe(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const i=new Th([],n,t.dtype,s),o=Wh(t,0);return e.forEach((a,l)=>{i.setItem(a,o[l])}),i}function Mfe(t,e,n){let s=0;const r=e.map(d=>(s+=d,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const i=t.shape.slice(1),o=uN(i,n),a=s===0?0:t.size/s,l=Wt(()=>{const d=[];t=_e(t,[1,s,a]);for(let h=0;h<e.length;++h){const p=[0,h===0?0:r[h-1],0],m=[1,e[h],a];d[h]=_e(an(t,p,m),o)}return t.dispose(),d}),c=new Th([],n,t.dtype,e.length);for(let d=0;d<l.length;d++)c.setItem(d,l[d]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lfe=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=E("thenBranch",t,e,n),r=E("elseBranch",t,e,n),i=E("cond",t,e,n),o=E("args",t,e,n);return(await i.data())[0]?n.functionMap[s].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=E("body",t,e,n),r=E("cond",t,e,n),i=E("args",t,e,n),o=await n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap),a=i.map(d=>d.id);let l=await o[0].data();o.forEach(d=>{!d.kept&&a.indexOf(d.id)===-1&&d.dispose()});let c=i;for(;l[0];){const d=c;c=await n.functionMap[s].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);const h=c.map(p=>p.id);d.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()});const f=await n.functionMap[r].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap);l=await f[0].data(),f.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&h.indexOf(p.id)===-1&&p.dispose()})}return c}case"LoopCond":{const s=E("pred",t,e,n);return[rc(s)]}case"Switch":{const s=E("pred",t,e,n);let r=E("data",t,e,n);return r.kept||(r=rc(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=t.inputNames.find(r=>Sr(r,e,n)!==void 0);if(s){const r=Sr(s,e,n);return[rc(r)]}return}case"Enter":{const s=E("frameName",t,e,n),r=E("tensor",t,e,n);return n.enterFrame(s),[rc(r)]}case"Exit":{const s=E("tensor",t,e,n);return n.exitFrame(),[rc(s)]}case"NextIteration":{const s=E("tensor",t,e,n);return n.nextIteration(),[rc(s)]}case"TensorArrayV3":{const s=E("size",t,e,n),r=E("dtype",t,e,n),i=E("elementShape",t,e,n),o=E("dynamicSize",t,e,n),a=E("clearAfterRead",t,e,n),l=E("identicalElementShapes",t,e,n),c=E("name",t,e,n),d=new jfe(c,r,s,i,l,o,a);return n.addTensorArray(d),[d.idTensor,ln(1)]}case"TensorArrayWriteV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.write(r,i),[o.idTensor]}case"TensorArrayReadV3":{const s=E("tensorArrayId",t,e,n),r=E("index",t,e,n);return[n.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("dtype",t,e,n);return[n.getTensorArray(s.id).gather(r,i)]}case"TensorArrayScatterV3":{const s=E("tensorArrayId",t,e,n),r=E("indices",t,e,n),i=E("tensor",t,e,n),o=n.getTensorArray(s.id);return o.scatter(r,i),[o.idTensor]}case"TensorArrayConcatV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id),i=E("dtype",t,e,n);return[r.concat(i)]}case"TensorArraySplitV3":{const s=E("tensorArrayId",t,e,n),r=E("tensor",t,e,n),i=E("lengths",t,e,n),o=n.getTensorArray(s.id);return o.split(i,r),[o.idTensor]}case"TensorArraySizeV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return[ln(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=E("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("tensor",t,e,n),o=n.getTensorList(s.id);return o.setItem(r,i),[o.idTensor]}case"TensorListGetItem":{const s=E("tensorListId",t,e,n),r=E("index",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(r,i,o)]}case"TensorListScatterV2":case"TensorListScatter":{const s=E("indices",t,e,n),r=E("tensor",t,e,n),i=E("elementShape",t,e,n),o=E("numElements",t,e,n),a=Ffe(r,s,i,o);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=E("elementShape",t,e,n),r=E("elementDType",t,e,n);let i;t.op==="TensorListReserve"?i="numElements":i="maxNumElements";const o=E(i,t,e,n),a=t.op==="TensorListReserve"?-1:o,l=Ofe(s,r,o,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=E("tensorListId",t,e,n),r=E("indices",t,e,n),i=E("elementShape",t,e,n),o=E("elementDType",t,e,n);return[n.getTensorList(s.id).gather(r,o,i)]}case"TensorListStack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=E("numElements",t,e,n);return[n.getTensorList(s.id).stack(r,i,o)]}case"TensorListFromTensor":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n),o=Dfe(s,r,i);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id),i=E("dtype",t,e,n),o=E("elementShape",t,e,n);return[r.concat(i,o)]}case"TensorListPushBack":{const s=E("tensorListId",t,e,n),r=E("tensor",t,e,n),i=n.getTensorList(s.id);return i.pushBack(r),[i.idTensor]}case"TensorListPopBack":{const s=E("tensorListId",t,e,n),r=E("elementShape",t,e,n),i=E("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(r,i)]}case"TensorListSplit":{const s=E("tensor",t,e,n),r=E("elementShape",t,e,n),i=E("lengths",t,e,n),o=Mfe(s,i,r);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{const s=E("tensorListId",t,e,n),r=n.getTensorList(s.id);return[ln(r.size(),"int32")]}case"TensorListResize":{const s=E("tensorListId",t,e,n),r=E("size",t,e,n),o=n.getTensorList(s.id).resize(r);return n.addTensorList(o),[o.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(t,e,n){const[s,r]=E("fusedOps",t,e,n),i=s==="biasadd",o=!i,a=r==="prelu",l=s==="fusedbatchnorm",c=E("numArgs",t,e,n);if(i){if(a&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&i&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const d=E("strides",t,e,n),h=$v(t,e,n),f=E("dataFormat",t,e,n).toUpperCase(),p=E("dilations",t,e,n);let[m,g]=E("args",t,e,n);o&&(g=m,m=void 0);const x=E("leakyreluAlpha",t,e,n);return{stride:d,pad:h,dataFormat:f,dilations:p,biasArg:m,preluArg:g,activationFunc:r,leakyreluAlpha:x}}const Bfe=(t,e,n,s=_r)=>{switch(t.op){case"Conv1D":{const r=E("stride",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilation",t,e,n);return[s.conv1d(E("x",t,e,n),E("filter",t,e,n),r,i,o,a)]}case"Conv2D":{const r=E("strides",t,e,n),i=$v(t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv2d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,o,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:d,leakyreluAlpha:h}=Wj(t,e,n);return[s.fused.conv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:d,preluActivationWeights:c,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:o,dilations:a,biasArg:l,preluArg:c,activationFunc:d,leakyreluAlpha:h}=Wj(t,e,n);return[s.fused.depthwiseConv2d({x:E("x",t,e,n),filter:E("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:o,dilations:[a[1],a[2]],bias:l,activation:d,preluActivationWeights:c,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=E("outputShape",t,e,n),i=E("strides",t,e,n),o=$v(t,e,n);return[s.conv2dTranspose(E("x",t,e,n),E("filter",t,e,n),r,[i[1],i[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=E("strides",t,e,n),i=$v(t,e,n),o=E("dilations",t,e,n),a=E("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(E("input",t,e,n),E("filter",t,e,n),[r[1],r[2]],i,a,[o[1],o[2]])]}case"Conv3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dataFormat",t,e,n).toUpperCase(),a=E("dilations",t,e,n);return[s.conv3d(E("x",t,e,n),E("filter",t,e,n),[r[1],r[2],r[3]],i,o,[a[1],a[2],a[3]])]}case"AvgPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n),a=E("includeBatchInIndex",t,e,n),{result:l,indexes:c}=s.maxPoolWithArgmax(E("x",t,e,n),[o[1],o[2]],[r[1],r[2]],i,a);return[l,c]}case"AvgPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.avgPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("kernelSize",t,e,n);return[s.maxPool3d(E("x",t,e,n),[o[1],o[2],o[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=E("strides",t,e,n),i=E("pad",t,e,n),o=E("dilations",t,e,n),a=r[1],l=r[2],c=o[1],d=o[2];return[s.dilation2d(E("x",t,e,n),E("filter",t,e,n),[a,l],i,[c,d],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe=(t,e,n,s=_r)=>{switch(t.op){case"Fill":{const r=E("shape",t,e,n),i=E("dtype",t,e,n),o=E("value",t,e,n);return[s.fill(r,o,i)]}case"LinSpace":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("num",t,e,n);return[s.linspace(r,i,o)]}case"Multinomial":{const r=E("logits",t,e,n),i=E("numSamples",t,e,n),o=E("seed",t,e,n);return[s.multinomial(r,i,o)]}case"OneHot":{const r=E("indices",t,e,n),i=E("depth",t,e,n),o=E("onValue",t,e,n),a=E("offValue",t,e,n),l=E("dtype",t,e,n);return[s.oneHot(r,i,o,a,l)]}case"Ones":return[s.ones(E("shape",t,e,n),E("dtype",t,e,n))];case"OnesLike":return[s.onesLike(E("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(E("shape",t,e,n),E("dtype",t,e,n),E("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt(E("shape",t,e,n),E("minval",t,e,n),E("maxval",t,e,n),E("seed",t,e,n))];case"Range":{const r=E("start",t,e,n),i=E("stop",t,e,n),o=E("step",t,e,n);return[s.range(r,i,o,E("dtype",t,e,n))]}case"TruncatedNormal":{const r=E("shape",t,e,n),i=E("mean",t,e,n),o=E("stdDev",t,e,n),a=E("seed",t,e,n);return[s.truncatedNormal(r,i,o,E("dtype",t,e,n),a)]}case"Zeros":return[s.zeros(E("shape",t,e,n),E("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eS(t,e,n){const s=E("boxes",t,e,n),r=E("scores",t,e,n),i=E("maxOutputSize",t,e,n),o=E("iouThreshold",t,e,n),a=E("scoreThreshold",t,e,n),l=E("softNmsSigma",t,e,n);return{boxes:s,scores:r,maxOutputSize:i,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}}const zfe=async(t,e,n,s,r=_r)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c,softNmsSigma:d}=eS(t,e,n),h=await r.image.nonMaxSuppressionWithScoreAsync(i,o,a,l,c,d);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c}=eS(t,e,n),d=E("padToMaxOutputSize",t,e,n),h=await r.image.nonMaxSuppressionPaddedAsync(i,o,a,l,c,d);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:i,scores:o,maxOutputSize:a,iouThreshold:l,scoreThreshold:c}=eS(t,e,n);return[await r.image.nonMaxSuppressionAsync(i,o,a,l,c)]}case"Where":{const i=r.cast(E("condition",t,e,n),"bool"),o=[await r.whereAsync(i)];return i.dispose(),o}case"ListDiff":return r.setdiff1dAsync(E("x",t,e,n),E("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wfe=(t,e,n,s=_r)=>{switch(t.op){case"LowerBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.lowerBound(r,i)]}case"TopKV2":{const r=E("x",t,e,n),i=E("k",t,e,n),o=E("sorted",t,e,n),a=s.topk(r,i,o);return[a.values,a.indices]}case"UpperBound":{const r=E("sortedSequence",t,e,n),i=E("values",t,e,n);return[s.upperBound(r,i)]}case"Unique":{const r=E("x",t,e,n),i=s.unique(r);return[i.values,i.indices]}case"UniqueV2":{const r=E("x",t,e,n),i=E("axis",t,e,n),o=s.unique(r,i);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ufe=(t,e,n,s=_r)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=E("default",t,e,n);return[Sr(t.name,e,n)||r];case"Placeholder":return[Sr(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const d=E("x",t,e,n);return[rc(d)]}case"IdentityN":return E("x",t,e,n).map(d=>rc(d));case"Snapshot":const i=E("x",t,e,n);return[rc(i)];case"Shape":return[s.tensor1d(E("x",t,e,n).shape,"int32")];case"ShapeN":return E("x",t,e,n).map(d=>s.tensor1d(d.shape));case"Size":return[s.scalar(E("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(E("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const o=E("x",t,e,n),a=E("data",t,e,n),l=E("message",t,e,n),c=E("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let d=0;d<a.length;d++)console.log(Array.prototype.slice.call(a[d].dataSync()).slice(0,c));return[o];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hfe{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=ln(0),this.tensorMap=new Map,yl(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return ln(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),Wt(()=>{const r=Wh(n),i=s.length,o=r.length;O(i===o,()=>`The number of elements doesn't match, keys has ${i} elements, the values has ${o} elements.`);for(let a=0;a<i;a++){const l=s[a],c=r[a];yl(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return Wt(()=>{const r=[];for(let i=0;i<s.length;i++){const o=s[i],a=this.findWithDefault(o,n);r.push(a)}return Pc(r)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gfe=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(t.name);if(r!=null)return[r];{const i=E("keyDType",t,e,n),o=E("valueDType",t,e,n),a=new Hfe(i,o);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("values",t,e,n);return[await s.getHashTableById(r.id).import(i,o)]}case"LookupTableFind":case"LookupTableFindV2":{const r=E("tableHandle",t,e,n,s),i=E("keys",t,e,n),o=E("defaultValue",t,e,n);return[await s.getHashTableById(r.id).find(i,o)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=E("tableHandle",t,e,n,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kfe=(t,e,n,s=_r)=>{switch(t.op){case"ResizeBilinear":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(r,[i[0],i[1]],o,a)]}case"ResizeNearestNeighbor":{const r=E("images",t,e,n),i=E("size",t,e,n),o=E("alignCorners",t,e,n),a=E("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(r,[i[0],i[1]],o,a)]}case"CropAndResize":{const r=E("image",t,e,n),i=E("boxes",t,e,n),o=E("boxInd",t,e,n),a=E("cropSize",t,e,n),l=E("method",t,e,n),c=E("extrapolationValue",t,e,n);return[s.image.cropAndResize(r,i,o,a,l,c)]}case"ImageProjectiveTransformV3":{const r=E("images",t,e,n),i=E("transforms",t,e,n),o=E("outputShape",t,e,n),a=E("fillValue",t,e,n),l=E("interpolation",t,e,n),c=E("fillMode",t,e,n);return[s.image.transform(r,i,l.toLowerCase(),c.toLowerCase(),a,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qfe=(t,e,n,s=_r)=>{switch(t.op){case"Equal":return[s.equal(E("a",t,e,n),E("b",t,e,n))];case"NotEqual":return[s.notEqual(E("a",t,e,n),E("b",t,e,n))];case"Greater":return[s.greater(E("a",t,e,n),E("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(E("a",t,e,n),E("b",t,e,n))];case"Less":return[s.less(E("a",t,e,n),E("b",t,e,n))];case"LessEqual":return[s.lessEqual(E("a",t,e,n),E("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(E("a",t,e,n),E("b",t,e,n))];case"LogicalNot":return[s.logicalNot(E("a",t,e,n))];case"LogicalOr":return[s.logicalOr(E("a",t,e,n),E("b",t,e,n))];case"Select":case"SelectV2":return[s.where(E("condition",t,e,n),E("a",t,e,n),E("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd(E("a",t,e,n),E("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xfe=(t,e,n,s=_r)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(E("a",t,e,n),E("b",t,e,n),E("transposeA",t,e,n),E("transposeB",t,e,n))];case"Einsum":return[s.einsum(E("equation",t,e,n),...E("tensors",t,e,n))];case"Transpose":return[s.transpose(E("x",t,e,n),E("perm",t,e,n))];case"_FusedMatMul":const[r,i]=E("fusedOps",t,e,n),o=r==="biasadd",a=i==="prelu",l=E("numArgs",t,e,n),c=E("leakyreluAlpha",t,e,n);if(o){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[d,h]=E("args",t,e,n);return[s.fused.matMul({a:E("a",t,e,n),b:E("b",t,e,n),transposeA:E("transposeA",t,e,n),transposeB:E("transposeB",t,e,n),bias:d,activation:i,preluActivationWeights:h,leakyreluAlpha:c})];case"MatrixBandPart":return[s.linalg.bandPart(E("a",t,e,n),E("numLower",t,e,n),E("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yfe=(t,e,n,s=_r)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(E("x",t,e,n),E("axis",t,e,n),E("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(E("x",t,e,n),E("mean",t,e,n),E("variance",t,e,n),E("offset",t,e,n),E("scale",t,e,n),E("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(E("x",t,e,n),E("radius",t,e,n),E("bias",t,e,n),E("alpha",t,e,n),E("beta",t,e,n))];case"Softmax":return[s.softmax(E("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qfe=(t,e,n,s=_r)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:i}=s.raggedGather(E("paramsNestedSplits",t,e,n),E("paramsDenseValues",t,e,n),E("indices",t,e,n),E("outputRaggedRank",t,e,n));return r.concat(i)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:i}=s.raggedRange(E("starts",t,e,n),E("limits",t,e,n),E("splits",t,e,n));return[r,i]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor(E("shape",t,e,n),E("values",t,e,n),E("defaultValue",t,e,n),E("rowPartitionTensors",t,e,n),E("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zfe=(t,e,n,s=_r)=>{switch(t.op){case"Max":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.max(E("x",t,e,n),a,l)]}case"Mean":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.mean(E("x",t,e,n),a,l)]}case"Min":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.min(E("x",t,e,n),a,l)]}case"Sum":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.sum(E("x",t,e,n),a,l)]}case"All":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.all(E("x",t,e,n),a,l)]}case"Any":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.any(E("x",t,e,n),a,l)]}case"ArgMax":{const a=E("axis",t,e,n);return[s.argMax(E("x",t,e,n),a)]}case"ArgMin":{const a=E("axis",t,e,n);return[s.argMin(E("x",t,e,n),a)]}case"Prod":{const a=E("axis",t,e,n),l=E("keepDims",t,e,n);return[s.prod(E("x",t,e,n),a,l)]}case"Cumprod":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),c=E("reverse",t,e,n);return[s.cumprod(E("x",t,e,n),a,l,c)]}case"Cumsum":{const a=E("axis",t,e,n),l=E("exclusive",t,e,n),c=E("reverse",t,e,n);return[s.cumsum(E("x",t,e,n),a,l,c)]}case"Bincount":const r=E("x",t,e,n),i=E("weights",t,e,n),o=E("size",t,e,n);return[s.bincount(r,i,o)];case"DenseBincount":{const a=E("x",t,e,n),l=E("weights",t,e,n),c=E("size",t,e,n),d=E("binaryOutput",t,e,n);return[s.denseBincount(a,l,c,d)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jfe=(t,e,n,s=_r)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=E("n",t,e,n),i=E("axis",t,e,n);let o=E("tensors",t,e,n);return o=o.slice(0,r),[s.concat(o,i)]}case"Gather":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gather(r,s.cast(i,"int32"),0)]}case"GatherV2":{const r=E("axis",t,e,n),i=E("batchDims",t,e,n),o=E("x",t,e,n),a=E("indices",t,e,n);return[s.gather(o,s.cast(a,"int32"),r,i)]}case"Reverse":{const r=E("dims",t,e,n),i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(a);const o=E("x",t,e,n);return[s.reverse(o,i)]}case"ReverseV2":{const r=E("axis",t,e,n),i=E("x",t,e,n);return[s.reverse(i,r)]}case"Slice":{const r=E("begin",t,e,n),i=E("size",t,e,n);return[s.slice(E("x",t,e,n),r,i)]}case"StridedSlice":{const r=E("begin",t,e,n),i=E("end",t,e,n),o=E("strides",t,e,n),a=E("beginMask",t,e,n),l=E("endMask",t,e,n),c=E("ellipsisMask",t,e,n),d=E("newAxisMask",t,e,n),h=E("shrinkAxisMask",t,e,n),f=E("x",t,e,n);return[s.stridedSlice(f,r,i,o,a,l,c,d,h)]}case"Pack":return Wt(()=>{const r=E("axis",t,e,n),i=E("tensors",t,e,n),o=i[0].shape,a=s.squeeze(i[0]).shape,l=i.map(c=>{const d=Gn(c.shape,o);if(!d&&!Gn(s.squeeze(c).shape,a))throw new Error("the input tensors shape does not match");return d?c:s.reshape(c,o)});return[s.stack(l,r)]});case"Unpack":{const r=E("axis",t,e,n),i=E("tensor",t,e,n);return s.unstack(i,r)}case"Tile":{const r=E("reps",t,e,n);return[s.tile(E("x",t,e,n),r)]}case"Split":case"SplitV":{const r=E("axis",t,e,n),i=E("numOrSizeSplits",t,e,n),o=E("x",t,e,n);return s.split(o,i,r)}case"ScatterNd":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("shape",t,e,n);return[s.scatterND(r,i,o)]}case"GatherNd":{const r=E("x",t,e,n),i=E("indices",t,e,n);return[s.gatherND(r,i)]}case"SparseToDense":{const r=E("sparseIndices",t,e,n),i=E("outputShape",t,e,n),o=E("sparseValues",t,e,n),a=E("defaultValue",t,e,n);return[s.sparseToDense(r,o,i,o.dtype===a.dtype?a:s.cast(a,o.dtype))]}case"TensorScatterUpdate":{const r=E("indices",t,e,n),i=E("values",t,e,n),o=E("tensor",t,e,n);return[s.tensorScatterUpdate(o,r,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const epe=(t,e,n,s=_r)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:i,emptyRowIndicator:o,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows(E("indices",t,e,n),E("values",t,e,n),E("denseShape",t,e,n),E("defaultValue",t,e,n));return[r,i,o,a]}case"SparseReshape":{const{outputIndices:r,outputShape:i}=s.sparse.sparseReshape(E("inputIndices",t,e,n),E("inputShape",t,e,n),E("newShape",t,e,n));return[r,i]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(E("data",t,e,n),E("indices",t,e,n),E("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tpe=(t,e,n,s=_r)=>{switch(t.op){case"FFT":return[s.fft(E("x",t,e,n))];case"IFFT":return[s.ifft(E("x",t,e,n))];case"RFFT":return[s.rfft(E("x",t,e,n))];case"IRFFT":return[s.irfft(E("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const npe=(t,e,n,s=_r)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace(E("input",t,e,n),E("pattern",t,e,n),E("rewrite",t,e,n),E("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:r,nGramsSplits:i}=s.string.stringNGrams(E("data",t,e,n),E("dataSplits",t,e,n),E("separator",t,e,n),E("nGramWidths",t,e,n),E("leftPad",t,e,n),E("rightPad",t,e,n),E("padWidth",t,e,n),E("preserveShortSequences",t,e,n));return[r,i]}case"StringSplit":{const{indices:r,values:i,shape:o}=s.string.stringSplit(E("input",t,e,n),E("delimiter",t,e,n),E("skipEmpty",t,e,n));return[r,i,o]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(E("input",t,e,n),E("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const spe=(t,e,n,s=_r)=>{switch(t.op){case"Cast":return[s.cast(E("x",t,e,n),E("dtype",t,e,n))];case"ExpandDims":{const r=E("axis",t,e,n);return[s.expandDims(E("x",t,e,n),r)]}case"Squeeze":{const r=E("axis",t,e,n);return[s.squeeze(E("x",t,e,n),r)]}case"Reshape":return[s.reshape(E("x",t,e,n),E("shape",t,e,n))];case"EnsureShape":return[s.ensureShape(E("x",t,e,n),E("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(E("x",t,e,n),E("padding",t,e,n),E("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(E("x",t,e,n),E("padding",t,e,n),E("constantValue",t,e,n))];case"SpaceToBatchND":{const r=E("blockShape",t,e,n),i=E("paddings",t,e,n);return[s.spaceToBatchND(E("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=E("blockShape",t,e,n),i=E("crops",t,e,n);return[s.batchToSpaceND(E("x",t,e,n),r,i)]}case"DepthToSpace":{const r=E("blockSize",t,e,n),i=E("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(E("x",t,e,n),r,i)]}case"BroadcastTo":return[s.broadcastTo(E("x",t,e,n),E("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(E("s0",t,e,n),E("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(t,e,n,s,r=Wt){const i=((o,a,l)=>{switch(o.category){case"arithmetic":return r(()=>Pfe(o,a,l));case"basic_math":return r(()=>Afe(o,a,l));case"control":return Lfe(o,a,l);case"convolution":return r(()=>Bfe(o,a,l));case"creation":return r(()=>Vfe(o,a,l));case"dynamic":return zfe(o,a,l);case"evaluation":return r(()=>Wfe(o,a,l));case"image":return r(()=>Kfe(o,a,l));case"graph":return r(()=>Ufe(o,a,l));case"logical":return r(()=>qfe(o,a,l));case"matrices":return r(()=>Xfe(o,a,l));case"normalization":return r(()=>Yfe(o,a,l));case"ragged":return r(()=>Qfe(o,a,l));case"reduction":return r(()=>Zfe(o,a,l));case"slice_join":return r(()=>Jfe(o,a,l));case"sparse":return r(()=>epe(o,a,l));case"spectral":return r(()=>tpe(o,a,l));case"string":return r(()=>npe(o,a,l));case"transformation":return r(()=>spe(o,a,l));case"hash_table":return Gfe(o,a,l,s);case"custom":const c=aU(o.op);if(c&&c.customExecutor)return c.customExecutor(new Rfe(o,a,l));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return yh(i)?i.then(o=>[].concat(o)):[].concat(i)}class Hj{constructor(e={},n={},s={},r={},i){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(t,e,n,s){const r=new Set,i=[];let o=null,a=null;const l=new Set,c=new Set(Object.keys(t).map(f=>Mi(f)[0]));s=s||[];const d=new Set(s.map(f=>Mi(f.name)[0])),h=[...e];for(;h.length>0;){const f=h.pop();if((Ad(f)||dpe(f)||hpe(f))&&o==null&&(o=f,a=o.children.map(p=>p.name).filter(p=>r.has(p))),r.add(f.name),n[f.name]==null&&!c.has(f.name)&&!d.has(f.name)){if(f.inputs.length===0){i.push(f.name);continue}f.inputs.forEach(p=>{l.has(p.name)||(l.add(p.name),h.push(p))})}}return{inputs:t,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:o,syncInputs:a}}function rpe(t,e){const{usedNodes:n,inputs:s}=e,r=Object.keys(s).map(x=>Mi(x)[0]).map(x=>t.nodes[x]),i=t.initNodes||[],o=x=>n.has(typeof x=="string"?x:x.name);function a(x){return[...new Map(x.map(y=>[y.name,y])).values()]}const l=a([...r,...t.weights,...i]).filter(o),c=a([...l,...Object.values(t.nodes)]).filter(o),d=new Map(c.map(x=>[x.name,x])),h={};for(const x of c){h[x.name]=h[x.name]||0;for(const y of x.children)o(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}const f=Object.entries(h).filter(([,x])=>x===0).map(([x])=>x),p=[...f];for(;f.length>0;){const x=f.pop(),y=d.get(x);for(const v of y.children.filter(o))--h[v.name]===0&&(p.push(v.name),f.push(v.name))}const m=p.map(x=>d.get(x)),g=ipe(m,l);return ope(g,l),g}function ipe(t,e){const n=new Map(t.map(o=>[o.name,o])),s=e.map(o=>o.name),r=new Set(s);for(;s.length>0;){const o=s.pop(),a=n.get(o);for(const l of a.children)!n.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return t.filter(o=>r.has(o.name))}class _y extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function ope(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),i=new Set(t.map(a=>a.name)),o=a=>i.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(o)){if(!n.has(l.name))throw new _y(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new _y(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!n.has(l.name))throw new _y(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new _y(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function ape(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>Ad(a)?n:l),r=a=>{const l=s[e.get(a.name)];return l??-1},i=t.map((a,l)=>a.children.map(r).reduce((c,d)=>Math.max(c,d),s[l])),o=new Map;for(let a=0;a<t.length;++a){const l=i[a];if(l===n)continue;const c=t[a],d=t[l];o.has(d.name)||o.set(d.name,[]),o.get(d.name).push(c)}return o}const lpe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),cpe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),upe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Ad(t){return lpe.has(t.op)}function dpe(t){return cpe.has(t.op)}function hpe(t){return upe.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bb{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new Bb(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(i=>i.name).sort(),r=n.map(i=>i.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,n){const s=Gj(e,n,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:i,syncInputs:o}=s;if(i!=null)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(r.length>0){const c=n.map(h=>h.name),d=Object.keys(e);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${d}]. Missing the following inputs: [${r}]`)}const a=rpe(this.graph,s),l=ape(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return yl(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const r=s.map(f=>this.graph.nodes[Mi(f)[0]]),i=n.map(f=>Mi(f)[0]),o=new Set(i);let a=i.map(f=>this.graph.nodes[f]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let c=this.compiledMap.get(l);c==null&&(c=this.compile(e,a),this.compiledMap.set(l,c));try{this.keepIntermediateTensors=ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const d={},h={};return Wt(()=>{const f=new Hj(this.weightMap,d,h,this.functionExecutorMap,this.parseNodeNameCache),p=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{const[v,S]=Mi(y,f),C=[];C[S]=e[y],p[v]=C,this.keepIntermediateTensors&&(this.clonedTensorsMap[v]=this.cloneTensorList(C))});const m=this.getFrozenTensorIds(p),{orderedNodes:g,nodeLiveUntilMap:x}=c;for(const y of g){if(p[y.name])continue;const v=Uj(y,p,f,this._resourceManager);if(yh(v))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);p[y.name]=v,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(v)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,p,f,m,o,x.get(y.name))}return this.parent==null&&f.dispose(m),n.map(y=>Sr(y,p,f))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(n)}checkTensorForDisposal(e,n,s,r,i,o,a){if(!(Ad(n)||o.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(Ad(l))continue;const c=Lj(l.name,s,r);if(c!=null)for(const d of c){if(!d||d.kept||i.has(d.id))continue;const h=a[d.id];h===1?(d.dispose(),delete a[d.id]):h!=null&&a[d.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,r,i,o){function a(l){return Ad(l)||i.has(l.name)}if(!(Ad(e)||o==null))for(const l of o){if(a(l))continue;const c=Lj(l.name,n,s);for(const d of c)!d||d.kept||r.has(d.id)||d.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,r={},i={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=ue().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const o=new Hj(this.weightMap,r,i,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,o,n,s),l=n.map(f=>Sr(f,a,o)),c=l.map(f=>f.id),d=Object.keys(e).map(f=>e[f].id),h=new Set([...c,...d,...this.weightIds]);return Object.values(a).forEach(f=>{f.forEach(p=>{p&&!p.isDisposed&&!h.has(p.id)&&p.dispose()})}),this.parent==null&&o.dispose(h),l}async executeFunctionAsync(e,n,s){const r=e.reduce((i,o,a)=>(i[this.inputs[a].name]=o,i),{});return this._executeAsync(r,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,r){const i=Object.keys(e),o=i.map(C=>this.graph.nodes[Mi(C)[0]]),a=s.map(C=>Mi(C)[0]),l=new Set(a);let c=a.map(C=>this.graph.nodes[C]);c.length===0&&(c=this._outputs);const{usedNodes:d,missingInputs:h,dynamicNode:f,syncInputs:p}=Gj(e,c,this.weightMap,this._initNodes),m=[...o,...this.graph.weights,...this._initNodes||[]].map(C=>({node:C,contexts:n.currentContext})),g=Object.assign({},this.weightMap);Object.keys(e).forEach(C=>{const[k,T]=Mi(C),_=[];_[T]=e[C],g[k]=_});const x={},y=this.getFrozenTensorIds(g),v={};for(;m.length>0;){const C=this.processStack(o,m,n,g,v,y,l,x,d);await Promise.all(C)}f==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const S=c.filter(C=>!Ad(C)&&!Sr(C.name,g,n)).map(C=>C.name);if(S.length>0){let C="";throw f!=null&&(C=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${p}]`),new Error(`Cannot compute the outputs [${S}] from the provided inputs [${i}]. Consider providing the following inputs: [${h}]. ${C}`)}return g}processStack(e,n,s,r,i,o,a,l,c){const d=[];for(;n.length>0;){const h=n.pop();s.currentContext=h.contexts;let f="";if(h.node.op==="Enter"&&E("isConstant",h.node,r,s)&&([f]=sc(h.node.name,s)),r[h.node.name]==null){const p=Uj(h.node,r,s,this._resourceManager);f||([f]=sc(h.node.name,s));const m=s.currentContext;yh(p)?d.push(p.then(g=>(r[f]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(g)),s.currentContext=m,this.checkTensorForDisposal(f,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,c),g))):(r[f]=p,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(p)),this.checkTensorForDisposal(f,h.node,r,s,o,a,l),this.processChildNodes(h.node,n,s,r,i,c))}else this.processChildNodes(h.node,n,s,r,i,c)}return d}processChildNodes(e,n,s,r,i,o){e.children.forEach(a=>{const[l]=sc(a.name,s);i[l]||!o.has(a.name)||(a.op==="Merge"?a.inputNames.some(c=>!!Sr(c,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(c=>!!Sr(c,r,s))&&(i[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[r]=Mi(n),i=this.graph.nodes[r];if(i.attrParams.shape&&i.attrParams.shape.value){const o=i.attrParams.shape.value,a=o.length===s.shape.length&&s.shape.every((l,c)=>o[c]===-1||o[c]===l);O(a,()=>`The shape of dict['${i.name}'] provided in model.execute(dict) must be [${o}], but was [${s.shape}]`)}i.attrParams.dtype&&i.attrParams.dtype.value&&O(s.dtype===i.attrParams.dtype.value,()=>`The dtype of dict['${i.name}'] provided in model.execute(dict) must be ${i.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const r={};for(const i in e){const o=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[i];o!=null?r[o.name]=e[i]:r[i]=e[i]}return r}checkInputs(e){const n=Object.keys(e).filter(s=>{const[r]=Mi(s);return this.graph.nodes[r]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,r;const i=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[n];return i!=null?i.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=Mi(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class fpe{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ppe="?tfjs-format=file",mpe="model.json";class gpe{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=j6){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new fpe}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return yh(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await EW(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const i=this.artifacts.userDefinedMetadata;i.signature!=null&&(r=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new Bb(Bj.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const i=Bj.Instance.transformGraph(e.modelInitializer);this.initializer=new Bb(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof js?[e]:e,s={};return n.forEach((r,i)=>s[this.structuredOutputKeys[i]]=r),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof js)&&!Array.isArray(e)){const i=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(i!=null)for(const o in i){const a=i[o];a.resourceId!=null&&(e[o]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((i,o)=>{var a,l,c;const d=(c=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[o])===null||c===void 0?void 0:c.resourceId;return d!=null?i[o]=this.resourceIdToCapturedInput[d]:i[o]=e[r++],i},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let r=0;r<s.length;r++){const i=s[r],o=n[i];this.resourceIdToCapturedInput[o.resourceId]=e[r]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Un(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function Lp(t,e={},n=j6){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=xpe(t));const s=new gpe(t,e,n);return await s.load(),s}function xpe(t){return t.endsWith("/")||(t=t+"/"),`${t}${mpe}${ppe}`}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fo=ue();Fo.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",()=>15);Fo.registerFlag("WEBGPU_CPU_FORWARD",()=>!0);Fo.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",()=>-1);Fo.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",()=>!0);Fo.registerFlag("WEBGPU_USE_LOW_POWER_GPU",()=>!1);Fo.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e3);Fo.registerFlag("WEBGPU_USE_PROFILE_TOOL",()=>!1);Fo.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",()=>!0);Fo.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",()=>!1);Fo.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",()=>-1);Fo.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",()=>!1);Fo.registerFlag("WEBGPU_PRINT_SHADER",()=>"");Fo.registerFlag("WEBGPU_ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ype{constructor(e){e&&(this.vendor=e.vendor,this.architecture=e.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}getIntelGPUGeneration(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}isIntel(){return this.vendor==="intel"}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vpe{constructor(e){this.device=e,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireBuffer(e,n,s=!1,r=!0){let i;const o=Kj(e,n);return r?(this.freeBuffers.has(o)||this.freeBuffers.set(o,[]),this.freeBuffers.get(o).length>0?(i=this.freeBuffers.get(o).pop(),this.numFreeBuffers--):(i=this.device.createBuffer({size:e,usage:n,mappedAtCreation:s}),this.numBytesAllocated+=e)):(i=this.device.createBuffer({size:e,usage:n,mappedAtCreation:s}),this.numBytesAllocated+=e),this.usedBuffers.has(o)||this.usedBuffers.set(o,[]),this.usedBuffers.get(o).push(i),this.numUsedBuffers++,this.numBytesUsed+=e,i}releaseBuffer(e,n=!0){if(this.freeBuffers.size===0)return;const s=e.size,r=e.usage,i=Kj(s,r),o=this.usedBuffers.get(i),a=o.indexOf(e);if(a<0)throw new Error("Cannot find the buffer in buffer manager");o[a]=o[o.length-1],o.pop(),this.numUsedBuffers--,this.numBytesUsed-=s,n?(this.freeBuffers.get(i).push(e),this.numFreeBuffers++):(e.destroy(),this.numBytesAllocated-=s)}getNumUsedBuffers(){return this.numUsedBuffers}getNumFreeBuffers(){return this.numFreeBuffers}dispose(){this.freeBuffers.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.usedBuffers.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}}function Kj(t,e){return`${t}_${e}`}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bpe=class{constructor(e){this.device=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireTexture(e,n,s,r){const i=Xj(s),o=e*n*i,a=qj(e,n,s,r);if(this.freeTextures.has(a)||this.freeTextures.set(a,[]),this.usedTextures.has(a)||this.usedTextures.set(a,[]),this.numBytesUsed+=o,this.numUsedTextures++,this.freeTextures.get(a).length>0){this.numFreeTextures--;const c=this.freeTextures.get(a).shift();return this.usedTextures.get(a).push(c),c}this.numBytesAllocated+=o;const l=this.device.createTexture({size:[e,n],format:s,usage:r});return this.usedTextures.get(a).push(l),l}releaseTexture(e){if(this.freeTextures.size===0)return;const n=e.width,s=e.height,r=e.format,i=e.usage,o=qj(n,s,r,i);this.freeTextures.has(o)||this.freeTextures.set(o,[]),this.freeTextures.get(o).push(e),this.numFreeTextures++,this.numUsedTextures--;const a=this.usedTextures.get(o),l=a.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(l,1);const c=Xj(r),d=n*s*c;this.numBytesUsed-=d}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){this.freeTextures.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.usedTextures.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}};function qj(t,e,n,s){return`${t}_${e}_${n}_${s}`}function Xj(t){if(t==="rgba8unorm")return 16;throw new Error(`${t} is not supported!`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(t,e){if(Math.max(...t)>5)throw new Error("Cannot symbolically compute strides for rank > 6 tensor.");const n=t.length,s="xyzwuv",r=t.map(o=>`${e}.${s[o]}`),i=new Array(n-1);i[n-2]=r[n-1];for(let o=n-3;o>=0;--o)i[o]=`(${i[o+1]} * ${r[o+1]})`;return i}const ld=(t,e,n)=>n==="int32"?`atomicAdd(${t}, bitcast<i32>(${e}));`:`
          {
            var oldValue = 0;
            loop {
              let newValueF32 = bitcast<f32>(oldValue) + (${e});
              let newValue = bitcast<i32>(newValueF32);
              let res = atomicCompareExchangeWeak(${t}, oldValue, newValue);
              if res.exchanged {
                break;
              }
              oldValue = res.old_value;
            }
          }`;/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Bp;(function(t){t[t.FROM_PIXELS=0]="FROM_PIXELS",t[t.DRAW=1]="DRAW"})(Bp||(Bp={}));const Spe=(t,e,n,s,r)=>{const i={dtype:s.dtype,shape:s.shape},o=kpe(n,i,e),a=t.createShaderModule({code:o,label:e.constructor.name});let l=ue().get("WEBGPU_PRINT_SHADER");if(l!==""){l=l.toLowerCase();const c=l.split(",");(l==="all"||c.some(d=>e.shaderKey.toLowerCase().includes(d)))&&(console.group(e.shaderKey),console.debug(o),console.groupEnd())}return r?t.createComputePipelineAsync({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"}):t.createComputePipeline({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"})},tn=(t,e="f32")=>{switch(t){case 1:return`${e}`;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component ${e} is not supported.`)}};function qs(t){if(t<=1)return"i32";if(t===2)return"vec2<i32>";if(t===3)return"vec3<i32>";if(t===4)return"vec4<i32>";if(t===5)return"vec5";if(t===6)return"vec6";throw Error(`GPU for rank ${t} is not yet supported`)}function pc(t){if(t===0)return"x";if(t===1)return"y";if(t===2)return"z";if(t===3)return"w";if(t===4)return"u";if(t===5)return"v";throw Error(`Index ${t} is not yet supported`)}function Ke(...t){let e;switch(t.length){case 0:e=`
        fn main()
      `;break;case 1:e=`
        fn main(${t[0]} : i32)
      `;break;default:throw Error("Unreachable")}return e}function Yj(t,e){let n;return n=`
     ${Cpe(e)}
      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,
                @builtin(global_invocation_id) GlobalId : vec3<u32>,
                @builtin(local_invocation_index) LocalIndex: u32,
                @builtin(workgroup_id) WorkgroupId : vec3<u32>,
                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {
        localId = LocalId;
        localIndex = LocalIndex;
        globalId = GlobalId;
        numWorkgroups = NumWorkgroups;
        workgroupId = WorkgroupId;
        ${t?"main(getGlobalIndex());":"main();"};
      }
    `,n}function Cpe(t){return`
  @compute @workgroup_size(${t.workgroupSize[0]}, ${t.workgroupSize[1]}, ${t.workgroupSize[2]})
`}function kpe(t,e,n){const s=[],r=n.workgroupSize[0]*n.workgroupSize[1]*n.workgroupSize[2];if(n.outputComponent=n.outputComponent?n.outputComponent:1,s.push(`

      var<private> localId: vec3<u32>;
      var<private> localIndex: u32;
      var<private> globalId: vec3<u32>;
      var<private> numWorkgroups: vec3<u32>;
      var<private> workgroupId: vec3<u32>;

      // Only used when the y/z dimension of workgroup size is 1.
      fn getGlobalIndex() -> i32 {
        ${uU(n)?"  return i32(globalId.x);":`  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +
                workgroupId.y * numWorkgroups.x + workgroupId.x) * ${r}u +
                localIndex);
        `}
      }
    `),n.pixelsOpType!=null){const m=n.pixelsOpType===Bp.FROM_PIXELS?`@group(0) @binding(0) var<storage, read_write> result: array<${jd(e.dtype,n.outputComponent)}>;`:`@group(0) @binding(1) var<storage, read> inBuf : array<${jd(t[0].dtype,n.outputComponent)}>;`,g=e.shape.length===3?"vec2<i32>":"i32";s.push(`
        struct Uniform {
          outShapeStrides : ${g},
          size            : i32,
          numChannels     : i32,
          alpha           : f32,
        };

        ${m}
        @group(0) @binding(2) var<uniform> uniforms: Uniform;
      `);const x=Zj(n);return[Qj,s.join(`
`),Iv(e.shape),n.getUserCode(),Yj(x,n)].join(`
`)}let i,o,a="struct Uniforms { NAN : f32, INFINITY : f32, ";n.variableNames.forEach((m,g)=>{const x=qs(t[g].shape.length);a+=`${m.charAt(0).toLowerCase()+m.slice(1)}Shape : ${x}, `,i=t[g].shape.length-1,o=qs(i),a+=`${m.charAt(0).toLowerCase()+m.slice(1)}ShapeStrides: ${o}, `});const l=qs(e.shape.length);a+=`outShape : ${l}, `,i=e.shape.length-1,o=qs(i),a+=`
         outShapeStrides: ${o}, `,n.size&&(a+="size : i32, "),n.uniforms&&(a+=n.uniforms),a+="};",a=Ape(a),s.push(a),n.atomic?s.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;
    `):s.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<${jd(e.dtype,n.outputComponent)}>;
    `),n.variableNames.forEach((m,g)=>{s.push(`
      @group(0) @binding(${1+g}) var<storage, read> ${m}: array<${n.variableComponents?jd(t[g].dtype,n.variableComponents[g]):jd(t[g].dtype,n.outputComponent)}>;
        `)}),a!==""&&s.push(`
      @group(0) @binding(${1+n.variableNames.length}) var<uniform> uniforms: Uniforms;
      `);const c=Ipe(e.shape,n.dispatchLayout),d=[Qj,s.join(`
`)+Tpe,Iv(e.shape),c,Rpe(e.shape.length)];n.atomic||d.push(Ppe(e.shape,e.dtype,n.outputComponent)),n.variableNames.forEach((m,g)=>{d.push(`${Iv(t[g].shape,m)}`)});const h=t.map((m,g)=>$pe(m,e.shape,n.variableComponents?n.variableComponents[g]:n.outputComponent,n.dispatchLayout.x.length===e.shape.length)).join(`
`);d.push(h),d.push(n.getUserCode());const f=Zj(n);return d.push(Yj(f,n)),d.join(`
`)}function Npe(t,e,n){let s=t.shaderKey;if(t.pixelsOpType!=null)return s;const r=[],i=[];e.forEach(d=>{r.push(d.shape),i.push(d.dtype)}),r.push(n.shape),i.push(n.dtype);const o=e.map(d=>Mp(d.shape,n.shape)),a=e.map(d=>Gn(d.shape,n.shape)).join("_"),l=o.map(d=>d.join("_")).join(";"),c=uU(t)?"flatDispatch":"";return s+="_"+(t.workgroupSize?t.workgroupSize.join(","):"")+r.map(d=>d.length).join(",")+i.join(",")+t.variableNames.join(",")+l+a+c,s}const Qj=`
  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};
  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};

  // Checks whether coordinates lie within the bounds of the shape.
  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {
    return all(coord >= vec2<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {
    return all(coord >= vec3<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {
    return all(coord >= vec4<i32>(0)) && all(coord < shape);
  }

  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {
    return coord;
  }
  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {
    return dot(coords, vec2<i32>(shape.y, 1));
  }
  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {
    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));
  }
  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
    return dot(coords, vec4<i32>(
        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
  }
  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {
    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;
  }
  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {
    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;
  }

  // NaN defination in IEEE 754-1985 is :
  //   - sign = either 0 or 1.
  //   - biased exponent = all 1 bits.
  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).
  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers
  fn isnan(val: f32) -> bool {
    let floatToUint: u32 = bitcast<u32>(val);
    return (floatToUint & 0x7fffffffu) > 0x7f800000u;
  }
  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {
    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);
    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);
  }
`,Tpe=`
  fn isinf(val: f32) -> bool {
    return abs(val) == uniforms.INFINITY;
  }
`;function Iv(t,e=""){const n=t.length,s=e!==""?`get${e.charAt(0).toUpperCase()+e.slice(1)}CoordsFromIndex`:"getCoordsFromIndex",r=e!==""?`${e.charAt(0).toLowerCase()+e.slice(1)}ShapeStrides`:"outShapeStrides";if(n<=1)return`fn ${s}(index : i32) -> i32 { return index; }`;const i=Ms(t),o=qs(n),a=[];for(let c=0;c<n;c++)a.push(`d${c}`);if(i.length===1)return`    fn ${s}(index : i32) -> vec2<i32> {
      let d0 = index / uniforms.${r}; let d1 = index - d0 * uniforms.${r};
      return vec2<i32>(d0, d1);
    }`;let l;return l="var index2 = index;"+i.map((c,d)=>{const h=`let ${a[d]} = index2 / uniforms.${r}.${pc(d)}`,f=d===i.length-1?`let ${a[d+1]} = index2 - ${a[d]} * uniforms.${r}.${pc(d)}`:`index2 = index2 - ${a[d]} * uniforms.${r}.${pc(d)}`;return`${h}; ${f};`}).join(""),`
    fn ${s}(index : i32) -> ${o} {
      ${l}
      return ${o}(${a.join(",")});
    }
  `}function _pe(t,e){const n=t.name,s=t.shape.length,r=qs(s),i="get"+n.charAt(0).toUpperCase()+n.slice(1),o=["d0","d1","d2","d3","d4","d5"].slice(0,s),a=o.map(d=>`${d} : i32`).join(", ");if(s<1)return`
      fn ${i}() -> ${tn(e)} {
        return ${tn(e)}(${n}[0]);
      }
    `;const l=`uniforms.${n.charAt(0).toLowerCase()+n.slice(1)}Shape`;let c=`${s}D`;return s===0&&(c="1D"),`
    fn ${i}(${a}) -> ${tn(e)} {
      return ${tn(e)}(${n}[getIndexFromCoords${c}(${r}(${o.join(",")}),
        ${l})${e===1?"":` / ${e}`}]);
    }
   `}function Epe(t,e,n,s){const r=t.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"ByOutput",a=t.shape.length,l=e.length,c=qs(l);if(Gn(t.shape,e)&&s)return`
    fn ${o}Index(globalIndex : i32) -> ${tn(n)} {
      return ${tn(n)}(${r}[globalIndex]);
    }

    fn ${o}Coords(coords : ${c}) -> ${tn(n)} {
      return ${tn(n)}(${r}[${l>1?"getOutputIndexFromCoords(coords)":"coords"}${n===1?"":` / ${n}`}]);
    }
    `;const d=Mp(t.shape,e),h=l-a;let f="";if(a===0)return`
    fn ${o}Index(globalIndex : i32) -> ${tn(n)}{
      return get${i}();
    }

    fn ${o}Coords(coords : ${c}) -> ${tn(n)}{
      return get${i}();
    }
  `;l<2&&d.length>=1?f="coords = 0;":f=d.map(x=>`coords.${pc(x+h)} = 0;`).join(`
`);let p="";if(l<2&&a>0)p="coords";else if(l>1){const x=qs(a),y=t.shape.map((v,S)=>`coords.${pc(S+h)}`).join(", ");p=`${x}(${y})`}else p="coords";const m=`uniforms.${r.charAt(0).toLowerCase()+r.slice(1)}Shape`,g=`${a}D`;return`
  fn ${o}Index(globalIndex : i32) -> ${tn(n)} {
    var coords = getCoordsFromIndex(globalIndex);
    ${f}
    return ${tn(n)}(${r}[getIndexFromCoords${g}(${p}, ${m})${n===1?"":` / ${n}`}]);
  }

  fn ${o}Coords(coordsIn : ${c}) -> ${tn(n)} {
    var coords = coordsIn;
    ${f}
    return ${tn(n)}(${r}[getIndexFromCoords${g}(${p}, ${m})${n===1?"":` / ${n}`}]);
  }
`}function $pe(t,e,n,s){let r=_pe(t,n);return t.shape.length<=e.length&&(r+=Epe(t,e,n,s)),r}function Ipe(t,e){const{x:n,y:s=[],z:r=[]}=e,i=t.length,o=n.length+s.length+r.length;if(o!==i)return"";if(n.length===i)return`fn getOutputCoords() -> ${qs(i)}{
    let globalIndex = getGlobalIndex();
    return getCoordsFromIndex(globalIndex);
  }
  `;let a="";const l=[n,s,r];for(let f=0;f<l.length;f++){const p=l[f];if(p.length!==0)if(p.length===1)a+=`let d${p[0]} = i32(globalId[${f}]);`;else{const m=wpe(p,"uniforms.outShape");a+=`var index${f} = i32(globalId[${f}]);`;for(let g=0;g<m.length;g++)a+=`let d${p[g]} = index${f} / ${m[g]};`,g===m.length-1?a+=`let d${p[g+1]} = index${f} - d${p[g]} * ${m[g]};`:a+=`index${f} = index${f} - d${p[g]} * ${m[g]};`}}const c=[];for(let f=0;f<o;f++)c.push(`d${f}`);const d=qs(o);let h=`fn getOutputCoords() -> ${d} {
  ${a}
`;return c.length===0?h+=`return ${d}(0); }`:h+=`return ${d}(${c.join(",")}); }`,h}function Rpe(t){let e="";switch(t){case 0:case 1:e+=`
        fn getOutputIndexFromCoords(coords : i32) -> i32 {
          return coords;
        }
        `;break;case 2:e+=`
        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {
          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));
        }
        `;break;case 3:e+=`
        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {
          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));
        }
        `;break;case 4:e+=`
        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
          return dot(coords, vec4<i32>(
            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));
        }
        `;break;case 5:e+=`
        fn getOutputIndexFromCoords(coords : vec5) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u;
        }
        `;break;case 6:e+=`
        fn getOutputIndexFromCoords(coords : vec6) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u * uniforms.outShapeStrides.u +
              coords.v;
        }
        `;break;default:O(!1,()=>`Unsupported ${t}D shape`);break}return e}function uU(t){return t.dispatch[1]===1&&t.dispatch[2]===1}function jd(t,e=1){if(t==="float32")return tn(e,"f32");if(t==="int32"||t==="bool")return tn(e,"i32");throw new Error(`type ${t} is not supported.`)}function Ppe(t,e,n){const s=t.length,r=jd(e,n);let i=`fn setOutputAtIndex(flatIndex : i32, value : ${tn(n)}) {
      result[flatIndex] = ${r}(value);
    }

    fn setOutputAtIndexI32(flatIndex : i32, value : ${tn(n,"i32")}) {
      result[flatIndex] = ${r}(value);
    }
    `;if(s>=2){const o=["d0","d1","d2","d3","d4","d5"].slice(0,s),a=qs(s);i+=`
      fn setOutputAtCoords(${o.map(l=>`${l} : i32`).join(", ")}, value : ${tn(n)}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${o.join(", ")}));
        setOutputAtIndex(flatIndex${n===1?"":` / ${n}`}, value);
      }
      fn setOutputAtCoordsI32(${o.map(l=>`${l} : i32`).join(", ")}, value : ${tn(n,"i32")}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${o.join(", ")}));
        setOutputAtIndexI32(flatIndex${n===1?"":` / ${n}`}, value);
      }
    `}return i}function Ape(t){const e=/(\w+)\s*:\s*vec(5|6)/g;t=t.replace(e,s=>"@align(16) "+s);const n=/vec(5|6)\s*,\s*(\w+)/g;return t=t.replace(n,(s,r,i)=>`vec${r}, @align(16) ${i}`),t}function Zj(t){return!(t.dispatchLayout.hasOwnProperty("y")&&t.dispatchLayout.y.length!==0||t.dispatchLayout.hasOwnProperty("z")&&t.dispatchLayout.z.length!==0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sh=t=>{let e=1;for(let n=0;n<t.length;n++)e*=t[n];return e};function qe(t,e,n=[1,1,1],s=[1,1,1]){const[r,i,o]=[Math.ceil(sh(t.x.map(a=>e[a]))/(n[0]*s[0])),t.y?Math.ceil(sh(t.y.map(a=>e[a]))/(n[1]*s[1])):1,t.z?Math.ceil(sh(t.z.map(a=>e[a]))/(n[2]*s[2])):1];return[r,i,o]}function jpe(t,e,n,s=!1){const r=[8,8,1],i=[4,4,1];return s||(t<=8&&(i[1]=1),e<=16&&n<=16&&(r[0]=4)),{workgroupSize:r,elementsPerThread:i}}function dU(t,e,n=!1){if(n)return[8,8,1];const s=sh(t.x.map(i=>e[i])),r=sh(t.y.map(i=>e[i]));return s<=4?[4,16,1]:r<=4?[16,4,1]:[16,16,1]}function hU(t,e,n=!1){if(n)return[4,4,1];const s=sh(t.x.map(i=>e[i])),r=sh(t.y.map(i=>e[i]));return s<=4?[1,2,1]:r<=4?[2,1,1]:[2,2,1]}function at(t){return{x:t.map((e,n)=>n)}}function Jj(t){if(t==="float32"||t==="int32"||t==="bool"||t==="string")return 4;if(t==="complex64")return 8;throw new Error(`Unknown dtype ${t}`)}function fU(){return!!(typeof globalThis<"u"&&globalThis.navigator&&globalThis.navigator.gpu)}function pU(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&O(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGPU backend.`)})}var cl;(function(t){t[t.MatMulReduceProgram=0]="MatMulReduceProgram",t[t.MatMulSplitKProgram=1]="MatMulSplitKProgram",t[t.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",t[t.MatMulPackedProgram=3]="MatMulPackedProgram",t[t.MatMulMax=4]="MatMulMax"})(cl||(cl={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dpe=ue().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),Ope=(t,e)=>{const n=t.limits.maxComputeWorkgroupsPerDimension,s=e.dispatchLayout,r=e.dispatch;if(r.every(o=>o<=n))return r;O(r[0]>n&&s.y===void 0&&s.z===void 0,()=>"Dispatch size exceeds WebGPU limits in Y or Z dimension.");let i=Math.ceil(Math.sqrt(r[0]));return i>n?(i=Math.ceil(Math.cbrt(r[0])),O(i<=n,()=>"Total dispatch size exceeds WebGPU maximum."),[i,i,i]):[i,i,1]};class fm extends z_{nextDataId(){return fm.nextDataId++}constructor(e,n){if(super(),this.commandQueueOwnedIds=new WeakSet,this.dispatchCountInPass=0,this.disposed=!1,this.downloadWaitMs=0,this.tensorDataPendingDisposal=[],this.queryResolveBuffer=null,this.querySet=null,this.querySetCount=2,this.stagingPendingDisposal=[],this.uniformPendingDisposal=[],this.uploadWaitMs=0,this.hasReadSyncWarned=!1,this.hasTimestampQueryWarned=!1,!fU())throw new Error("WebGPU is not supported on this device");this.pipelineCache={},this.device=e,this.queue=e.queue,this.commandEncoder=null,this.computePassEncoder=null,this.adapterInfo=new ype(n),this.supportTimestampQuery=this.device.features.has("timestamp-query"),this.thresholdToIncreaseWorkgroups=this.adapterInfo.intelGPUGeneration>=12?16:8,this.bufferManager=new vpe(this.device),this.textureManager=new bpe(this.device),this.tensorMap=new _z(this,Li()),ue().getBool("WEBGPU_USE_PROFILE_TOOL")&&(this.dummyCanvas=document.createElement("canvas"),this.dummyCanvas.width=1,this.dummyCanvas.height=1,this.dummyContext=this.dummyCanvas.getContext("webgpu"),this.dummyContext.configure({device:e,format:"bgra8unorm"}),document.body.appendChild(this.dummyCanvas))}floatPrecision(){return 32}disposeData(e,n=!1){if(!this.tensorMap.has(e))return!0;const s=this.tensorMap.get(e);return n?s.refCount=0:s.refCount--,s.refCount>0?!1:(s.complexTensorInfos!=null&&(this.disposeData(s.complexTensorInfos.real.dataId),this.disposeData(s.complexTensorInfos.imag.dataId)),this.commandQueueOwnedIds.has(e)?(this.tensorDataPendingDisposal.push(e),!0):(this.releaseResource(e),this.tensorMap.delete(e),!0))}memory(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}releaseResource(e){const n=this.tensorMap.get(e);if(!(!n||!n.resource)){if(n.external){n.resource=null;return}n.resource instanceof GPUBuffer?this.bufferManager.releaseBuffer(n.resource):n.resource instanceof GPUTexture&&this.textureManager.releaseTexture(n.resource),n.resource=null}}refCount(e){return this.tensorMap.has(e)?this.tensorMap.get(e).refCount:0}incRef(e){const n=this.tensorMap.get(e);n.refCount++}decRef(e){if(this.tensorMap.has(e)){const n=this.tensorMap.get(e);n.refCount--}}write(e,n,s){if(s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.tensorMap.set(r,{dtype:s,shape:n,values:e,refCount:1}),r}move(e,n,s,r,i){if(r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(e,{dtype:r,shape:s,values:n,refCount:i})}submitQueue(){this.queue.submit([this.commandEncoder.finish()]),this.commandEncoder=null,this.dispatchCountInPass=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach(e=>{this.releaseResource(e),this.tensorMap.delete(e)}),this.uniformPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e)),this.stagingPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e,!1)),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}ensureCommandEncoderReady(){this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder())}endComputePassEncoder(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}async checkCompileCompletionAsync(){let e;try{e=await Promise.all(Object.values(this.pipelineCache))}catch(n){throw new Error(n.message)}Object.keys(this.pipelineCache).map((n,s)=>{this.pipelineCache[n]=e[s]})}async getBufferData(e){if(ue().getBool("WEBGPU_ENGINE_COMPILE_ONLY"))return console.warn("The data may be invalid since WEBGPU_ENGINE_COMPILE_ONLY is true, this can only be called when WEBGPU_ENGINE_COMPILE_ONLY is false"),null;const n=e.size,s=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,s,0,n),this.submitQueue(),await s.mapAsync(GPUMapMode.READ);const r=s.getMappedRange().slice(0);return s.unmap(),s!=null&&this.bufferManager.releaseBuffer(s),ue().getBool("WEBGPU_USE_PROFILE_TOOL")&&(O(this.dummyContext!==void 0,()=>"Fail to get context for profiling tool"),this.dummyContext.getCurrentTexture()),r}convertAndCacheOnCPU(e,n){const s=this.tensorMap.get(e);return s.values=n,s.values}readSync(e){const n=this.tensorMap.get(e),{values:s,complexTensorInfos:r}=n;if(s!=null||n.dtype==="string")return s;if(n.dtype==="complex64"){const g=this.readSync(r.real.dataId),x=this.readSync(r.imag.dataId),y=K2(_0(g,x).buffer,"float32");return this.convertAndCacheOnCPU(e,y),y}this.hasReadSyncWarned||(this.hasReadSyncWarned=!0,console.warn("The performance of synchronously reading data from GPU to CPU is poor on the webgpu backend, please use asynchronous APIs instead."));const i=["opaque","premultiplied"],o=n.resource,a=o.size;O(a%4===0,()=>"Because there is 4 bytes for one pixel, buffer size must be multiple of 4.");const l=a/4,c=new ArrayBuffer(a),d=256,h=256,f=i.map(g=>new OffscreenCanvas(d,h)),p=new OffscreenCanvas(d,h);this.endComputePassEncoder(),f.map((g,x)=>{const y=g.getContext("webgpu");return y.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.COPY_DST,alphaMode:i[x]}),y.getCurrentTexture()}).map((g,x)=>{const y=d*4,v=($,R,A)=>{this.ensureCommandEncoderReady(),this.commandEncoder.copyBufferToTexture({buffer:o,bytesPerRow:y,offset:A},{texture:g},{width:$,height:R}),this.submitQueue();const j=p.getContext("2d",{willReadFrequently:!0});j.clearRect(0,0,$,R),j.drawImage(f[x],0,0);const F=j.getImageData(0,0,$,R).data,L=i[x],M=new Uint8ClampedArray(c,A,$*R*4);for(let q=0;q<M.length;q+=4)if(L==="premultiplied")M[q+3]=F[q+3];else{const z=F[q];M[q]=F[q+2],M[q+1]=F[q+1],M[q+2]=z}},S=Math.floor(l/(d*h));let C=d,k=h,T=0;for(let $=0;$<S;$++)v(C,k,T),T+=d*h*4;const _=l%(d*h);k=Math.floor(_/d),k>0&&(v(C,k,T),T+=k*(d*4)),C=_%d,C>0&&v(C,1,T)});const m=K2(c,n.dtype);return this.convertAndCacheOnCPU(e,m),m}async read(e){if(!this.tensorMap.has(e))throw new Error(`Tensor ${e} was not registered!`);const n=this.tensorMap.get(e),{values:s}=n;if(s!=null)return s;let r;if(n.dtype==="complex64"){const i=await Promise.all([this.read(n.complexTensorInfos.real.dataId),this.read(n.complexTensorInfos.imag.dataId)]),o=i[0],a=i[1];r=_0(o,a)}else{const i=await this.getBufferData(n.resource);r=K2(i,n.dtype)}return this.convertAndCacheOnCPU(e,r),r}copyBuffer(e){const n=e.size,s=e.usage,r=this.bufferManager.acquireBuffer(n,s);return this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,r,0,n),this.submitQueue(),r}createTensorFromGPUData(e,n,s){let r=e.buffer;if(s==="complex64")throw new Error("Cannot write to a complex64 dtype. ");const i={id:this.nextDataId()};this.tensorMap.set(i,{dtype:s,shape:n,values:null,refCount:1,external:e.zeroCopy});const o=this.tensorMap.get(i),a=Jj(o.dtype)*be(o.shape);if(e.buffer.size<a)throw new Error(`GPUBuffer size(${e.buffer.size}) is smaller than tensor size(${a})!`);if((e.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!==(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return e.zeroCopy!==!0&&(r=this.copyBuffer(r)),o.resource=r,Li().makeTensorFromDataId(i,n,s,this)}readToGPU(e){const n=this.tensorMap.get(e),{values:s,dtype:r,shape:i,resource:o}=n;if(r==="complex64")throw new Error("Does not support reading buffer for complex64 dtype.");if(o==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const a=o,l=a.size,c=a.usage,d=this.bufferManager.acquireBuffer(l,c);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(o,0,d,0,l),this.submitQueue();const h=this.makeTensorInfo(i,r),f=Li().makeTensorFromTensorInfo(h),p=this.tensorMap.get(h.dataId);return p.resource=d,{tensorRef:f,buffer:d}}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Tc(r));return Kn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Kn(e.shape,e.dtype,n)}async time(e){!this.supportTimestampQuery&&!this.hasTimestampQueryWarned&&(console.warn("This device doesn't support timestamp-query extension. Start Chrome browser with flag --enable-dawn-features=allow_unsafe_apis to try it again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled."),this.hasTimestampQueryWarned=!0);const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=_c(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=_c(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},l=await Promise.all(i);return a.kernelMs=Ez(l),a.getExtraProfileInfo=()=>l.map((c,d)=>({name:o[d],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", "),this.uploadWaitMs=0,this.downloadWaitMs=0,a}makeTensorInfo(e,n,s){return n==="string"&&s!=null&&s.length>0&&Nx(s[0])&&(s=s.map(i=>Au(i))),{dataId:this.write(s,e,n),shape:e,dtype:n}}tensorToBinding(e){if(!e)return null;const s=this.tensorMap.get(e.dataId).resource;return s instanceof GPUBuffer?{buffer:s}:s instanceof GPUTexture?s.createView():s}uploadToGPU(e){const n=this.tensorMap.get(e);if(n.resource!=null)return;const s=Jj(n.dtype)*be(n.shape);let r;const i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;if(n.values){if(r=this.bufferManager.acquireBuffer(s,i,!0),r.mapState==="unmapped"){const o=this.bufferManager.acquireBuffer(s,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,!0,!1),a=o.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(a).set(n.values):new Float32Array(a).set(n.values),o.unmap(),this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(o,0,r,0,s),this.stagingPendingDisposal.push(o)}else{const o=r.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(o).set(n.values):new Float32Array(o).set(n.values),r.unmap()}n.values=null}else r=this.bufferManager.acquireBuffer(s,i);n.resource=r}makeUniforms(e){let n=0,s=0;const r=[];let i=1;e.forEach(l=>{l.data.length===0&&(l.data=[1]);let c;switch(l.data.length){case 1:c=4;break;case 2:c=8;break;case 3:c=16;break;case 4:c=16;break;case 5:c=16;break;case 6:c=16;break;default:O(!1,()=>`Unsupported ${l.data.length}D shape`)}(s===5||s===6)&&(c=16),c>i&&(i=c),n=Math.ceil(n/c)*c,s=l.data.length,r.push(n),n+=l.data.length*4}),n=Math.ceil(n/i)*i;const o=new ArrayBuffer(n);e.forEach((l,c)=>{const d=r[c];l.type==="int32"?new Int32Array(o,d,l.data.length).set(l.data):l.type==="uint32"?new Uint32Array(o,d,l.data.length).set(l.data):new Float32Array(o,d,l.data.length).set(l.data)});const a=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.queue.writeBuffer(a,0,o,0,n),this.uniformPendingDisposal.push(a),{offset:0,size:n,buffer:a}}runWebGPUProgram(e,n,s,r,i){if(i||(i=this.makeTensorInfo(e.outputShape,s)),be(i.shape)===0)return this.tensorMap.get(i.dataId).values=Dl(i.dtype,0),i;this.uploadToGPU(i.dataId),e.dispatch=Ope(this.device,e);const o=n.map((l,c)=>{if(l.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return this.uploadToGPU(l.dataId),{dtype:this.tensorMap.get(l.dataId).dtype,shape:l.shape,name:e.variableNames[c]}});e.shaderKey=Npe(e,o,i);const a=ue().getBool("WEBGPU_ENGINE_COMPILE_ONLY");return e.shaderKey in this.pipelineCache||(this.pipelineCache[e.shaderKey]=Spe(this.device,e,o,i,a)),e.pipeline=this.pipelineCache[e.shaderKey],a||this.recordAndSubmit(e,i,n,r),i}recordAndSubmit(e,n,s,r){if(e.pipeline instanceof Promise)throw new Error("Please call checkCompileCompletionAsync to ensure parallel compilation is done!");let i=[],o=[];const a="int32";if(e.pixelsOpType==null){i.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),o=s.concat(n).map(p=>p.shape);const f="int32";o.map(p=>{i.push({type:f,data:p});const m=Ms(p);i.push({type:f,data:m})})}else{const f=Ms(n.shape);i.push({type:a,data:f})}if(e.size){const f=be(e.outputShape);i.push({type:a,data:[e.outputComponent?f/e.outputComponent:f]})}r&&(i=[...i,...r]);const l=[this.tensorToBinding(n),...s.map(f=>this.tensorToBinding(f)),this.makeUniforms(i)];s.forEach(f=>{this.commandQueueOwnedIds.add(f.dataId)}),this.commandQueueOwnedIds.add(n.dataId);const c=this.device.createBindGroup({layout:e.pipeline.getBindGroupLayout(0),entries:l.map((f,p)=>({binding:p,resource:f}))}),d=this.activeTimers!=null;this.ensureCommandEncoderReady();const h={};d&&this.supportTimestampQuery?(this.endComputePassEncoder(),this.querySet==null&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.querySetCount})),h.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},this.computePassEncoder=this.commandEncoder.beginComputePass(h)):this.computePassEncoder||(this.computePassEncoder=this.commandEncoder.beginComputePass(h)),this.computePassEncoder.setPipeline(e.pipeline),this.computePassEncoder.setBindGroup(0,c),this.computePassEncoder.dispatchWorkgroups(e.dispatch[0],e.dispatch[1],e.dispatch[2]),this.dispatchCountInPass++,(d||ue().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchCountInPass||e.pixelsOpType===Bp.DRAW)&&(this.endComputePassEncoder(),d?this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime()}):this.submitQueue())}async getQueryTime(){if(!this.supportTimestampQuery)return 0;this.queryResolveBuffer==null&&(this.queryResolveBuffer=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.QUERY_RESOLVE)),this.commandEncoder.resolveQuerySet(this.querySet,0,this.querySetCount,this.queryResolveBuffer,0);const e=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.querySetCount*8),this.submitQueue(),await e.mapAsync(GPUMapMode.READ);const n=new BigUint64Array(e.getMappedRange()),s=Number(n[1]-n[0])/1e6;return e.unmap(),this.bufferManager.releaseBuffer(e),s}shouldExecuteOnCPU(e,n=Dpe){return ue().getBool("WEBGPU_CPU_FORWARD")&&e.every(s=>this.tensorMap.get(s.dataId).resource==null&&be(s.shape)<n)}numDataIds(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}dispose(){this.disposed||(this.querySet!=null&&this.querySet.destroy(),this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}}fm.nextDataId=0;/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */fU()&&NW("webgpu",async()=>{const t={powerPreference:ue().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},e=await navigator.gpu.requestAdapter(t),n={},s=[];e.features.has("timestamp-query")&&s.push("timestamp-query"),e.features.has("bgra8unorm-storage")&&s.push(["bgra8unorm-storage"]),n.requiredFeatures=s;const r=e.limits;n.requiredLimits={maxComputeWorkgroupStorageSize:r.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.maxStorageBufferBindingSize,maxBufferSize:r.maxBufferSize,maxComputeWorkgroupSizeX:r.maxComputeWorkgroupSizeX,maxComputeInvocationsPerWorkgroup:r.maxComputeInvocationsPerWorkgroup};const i=await e.requestDevice(n),o="info"in e?e.info:"requestAdapterInfo"in e?await e.requestAdapterInfo():void 0;return new fm(i,o)},3);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Bt;(function(t){t[t.ADD=0]="ADD",t[t.ATAN2=1]="ATAN2",t[t.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",t[t.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",t[t.DIV=4]="DIV",t[t.ELU_DER=5]="ELU_DER",t[t.EQUAL=6]="EQUAL",t[t.FLOOR_DIV=7]="FLOOR_DIV",t[t.GREATER=8]="GREATER",t[t.GREATER_EQUAL=9]="GREATER_EQUAL",t[t.LESS=10]="LESS",t[t.LESS_EQUAL=11]="LESS_EQUAL",t[t.LOGICAL_AND=12]="LOGICAL_AND",t[t.LOGICAL_OR=13]="LOGICAL_OR",t[t.MAX=14]="MAX",t[t.MIN=15]="MIN",t[t.MOD=16]="MOD",t[t.MUL=17]="MUL",t[t.NOT_EQUAL=18]="NOT_EQUAL",t[t.POW=19]="POW",t[t.PRELU=20]="PRELU",t[t.SQUARED_DIFFERENCE=21]="SQUARED_DIFFERENCE",t[t.SUB=22]="SUB"})(Bt||(Bt={}));const Fpe="let resultTemp = a + b;",Mpe="let resultTemp = atan2(a, b);",Lpe="let resultTemp = areal * breal - aimag * bimag;",Bpe="let resultTemp = areal * bimag + aimag * breal;",Vpe="let resultTemp = a / b;",zpe="let resultTemp = select(a * (b + 1.0), a, b >= b - b);",Wpe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a == b);
`,Upe=`
  let remainder =
      select(a % b, round(a % b), (round(a) == a) & (round(b) == b));
  let quotient = (a - remainder) / b;
  let resultTemp =
      round(select(quotient, quotient - 1, sign(remainder) == -sign(b)));
`,Hpe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a > b);
`,Gpe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a >= b);
`,Kpe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a < b);
`,qpe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a <= b);
`,Xpe="return f32(a >= 1.0 && b >= 1.0);",Ype=`return (vec4<f32>(a >= vec4<f32>(1.0)) *
  vec4<f32>(b >= vec4<f32>(1.0)));`,Qpe="return f32(a >= 1.0 || b >= 1.0);",Zpe=`return min(vec4<f32>(a >= vec4<f32>(1.0)) +
  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));`,Jpe="let resultTemp = max(a, b);",eme="let resultTemp = min(a, b);",tme=`
  let isNaN = b == 0.;
  var resultTemp = a % b;
  resultTemp = select((resultTemp + b) % b, resultTemp,
      (a < 0. && b < 0.) || (a >= 0. && b > 0.));
`,nme=`
  let isNaN = !vec4<bool>(b);
  var resultTemp = vec4<f32>(a % b);
  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {
    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];
  }
  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {
    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];
  }
  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {
    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];
  }
  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {
    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];
  }
`,sme="let resultTemp = a * b;",rme=`
  var resultTemp = f32(a != b);
  let valueForNaN = 1.0;
`,ime=`
  var resultTemp = vec4<f32>(a != b);
  let valueForNaN = 1.0;
`,ome=`
  let isNaN = a < 0.0 && floor(b) < b;
  if (b == 0.0) {
    return 1.0;
  }
  var resultTemp = select(sign(a) * pow(abs(a), b), pow(abs(a), b),
      round(abs(b) % 2.0) != 1.0);
`,ame=`
  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);
  let isModRound1 = vec4<f32>(isModRound1Bool);
  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);
  var resultTemp = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  let isExpZero = b == vec4<f32>(0.0);
  if (isExpZero.r) {
    resultTemp.r = 1.0;
  }
  if (isExpZero.g) {
    resultTemp.g = 1.0;
  }
  if (isExpZero.b) {
    resultTemp.b = 1.0;
  }
  if (isExpZero.a) {
    resultTemp.a = 1.0;
  }
  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);
`,lme="if (a < 0.0) { return b * a; }  return a;",cme=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,ume="let resultTemp = (a - b) * (a - b);",dme="let resultTemp = a - b;";function TR(t,e){let n;do{switch(t){case Bt.ATAN2:n=Mpe;break;case Bt.MAX:n=Jpe;break;case Bt.MIN:n=eme;break;case Bt.MOD:n=e?nme:tme;break;case Bt.NOT_EQUAL:n=e?ime:rme;break;case Bt.POW:n=e?ame:ome;break;default:continue}let s,r,i;return e?(s="isnanVec4",r="vec4<f32>",i="vec4<bool>"):(s="isnan",r="f32",i="bool"),`
      let aIsNaN = ${s}(a);
      let aPostLegalization = select(a, ${r}(42), aIsNaN);
      let bIsNaN = ${s}(b);
      let bPostLegalization = select(b, ${r}(42), bIsNaN);
      let isNaN = false;
      let valueForNaN = uniforms.NAN;
      {
        let a = aPostLegalization;
        let b = bPostLegalization;
        ${n}
        return select(
            resultTemp, ${r}(valueForNaN),
            ${i}(isNaN) | aIsNaN | bIsNaN);
      }
    `}while(!1);switch(t){case Bt.ADD:n=Fpe;break;case Bt.COMPLEX_MULTIPLY_IMAG:n=Bpe;break;case Bt.COMPLEX_MULTIPLY_REAL:n=Lpe;break;case Bt.DIV:n=Vpe;break;case Bt.ELU_DER:n=zpe;break;case Bt.EQUAL:n=Wpe;break;case Bt.FLOOR_DIV:n=Upe;break;case Bt.GREATER:n=Hpe;break;case Bt.GREATER_EQUAL:n=Gpe;break;case Bt.LESS:n=Kpe;break;case Bt.LESS_EQUAL:n=qpe;break;case Bt.LOGICAL_AND:return e?Ype:Xpe;case Bt.LOGICAL_OR:return e?Zpe:Qpe;case Bt.MUL:n=sme;break;case Bt.PRELU:return e?cme:lme;case Bt.SQUARED_DIFFERENCE:n=ume;break;case Bt.SUB:n=dme;break}return`
    ${n}
    return resultTemp;
  `}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ge;(function(t){t[t.ABS=0]="ABS",t[t.ACOS=1]="ACOS",t[t.ACOSH=2]="ACOSH",t[t.ASIN=3]="ASIN",t[t.ASINH=4]="ASINH",t[t.ATAN=5]="ATAN",t[t.ATANH=6]="ATANH",t[t.CEIL=7]="CEIL",t[t.COS=8]="COS",t[t.COSH=9]="COSH",t[t.ELU=10]="ELU",t[t.ERF=11]="ERF",t[t.EXP=12]="EXP",t[t.EXPM1=13]="EXPM1",t[t.FLOOR=14]="FLOOR",t[t.IS_FINITE=15]="IS_FINITE",t[t.IS_INF=16]="IS_INF",t[t.IS_NAN=17]="IS_NAN",t[t.LINEAR=18]="LINEAR",t[t.LOG=19]="LOG",t[t.LOG1P=20]="LOG1P",t[t.LOGICAL_NOT=21]="LOGICAL_NOT",t[t.NEG=22]="NEG",t[t.RELU=23]="RELU",t[t.RELU6=24]="RELU6",t[t.LEAKYRELU=25]="LEAKYRELU",t[t.RECIPROCAL=26]="RECIPROCAL",t[t.ROUND=27]="ROUND",t[t.RSQRT=28]="RSQRT",t[t.SELU=29]="SELU",t[t.SIGMOID=30]="SIGMOID",t[t.SIGN=31]="SIGN",t[t.SIN=32]="SIN",t[t.SINH=33]="SINH",t[t.SOFTPLUS=34]="SOFTPLUS",t[t.SQRT=35]="SQRT",t[t.SQUARE=36]="SQUARE",t[t.STEP=37]="STEP",t[t.TAN=38]="TAN",t[t.TANH=39]="TANH",t[t.TO_INT=40]="TO_INT"})(Ge||(Ge={}));const hme="return abs(a);",fme=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return acos(a);
`,pme=`
  if (a < 1.) {
    return uniforms.NAN;
  }
  return acosh(a);
`,mme=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return asin(a);
`,gme="return asinh(a);",xme=`
  if (isnan(a)) {
    return uniforms.NAN;
  }
  return atan(a);
`,yme=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  if (a == 1.) {
    return uniforms.INFINITY;
  }
  if (a == -1.) {
    return -uniforms.INFINITY;
  }
  return atanh(a);
`,vme="return ceil(a);",bme="return cos(a);",wme=`
  let e2x = exp(-a);
  return (e2x + 1.0 / e2x) / 2.0;
`,Sme="return exp(a) - 1.0;",Cme="if (a >= 0.0) { return a; }  return (exp(a) - 1.0);",kme=`
  var resFloat = exp(a) - vec4<f32>(1.0);
  if (a.r >= 0.0) {
    resFloat.r = a.r;
  }
  if (a.g >= 0.0) {
    resFloat.g = a.g;
  }
  if (a.b >= 0.0) {
    resFloat.b = a.b;
  }
  if (a.a >= 0.0) {
    resFloat.a = a.a;
  }
  return resFloat;
`,Nme=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  let p = ${dR};
  let a1 = ${hR};
  let a2 = ${fR};
  let a3 = ${pR};
  let a4 = ${mR};
  let a5 = ${gR};

  let sign = sign(a);
  let absA = abs(a);
  let t = 1.0 / (1.0 + p * absA);
  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));
`,Tme="return exp(a);",_me="return floor(a);",Eme="return f32(!isnan(a) && !isinf(a));",$me="return f32(isinf(a));",Ime="return f32(isnan(a));",Rme="return a;",Pme=`if (a < 0.0) { return uniforms.NAN; }
  return log(a);`,Ame=`
  if (isnan(a)) { return a; }
  return log(1.0 + a);
`,jme="return f32(!(a >= 1.0));",Dme="return -a;",Ome="if (a < 0.0) { return uniforms.alpha * a; } return a;",Fme=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,Mme="return 1.0 / a;",Lme="return select(a, 0.0, a < 0.0);",Bme="return clamp(a, 0.0, 6.0);",Vme="return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));",zme=`
  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));
`,Wme="return round(a);",Ume="return inverseSqrt(a);",Hme=`
  if (a >= 0.0) {
    return ${uR} * a;
  } else {
    return ${cR} * (exp(a) - 1.0);
  }
`,Gme="return 1.0 / (1.0 + exp(-1.0 * a));",Kme="return sign(a);",qme="return sin(a);",Xme=`
  let e2x = exp(a);
  return (e2x - 1.0 / e2x) / 2.0;
`,Yme=`
  let epsilon = 1.1920928955078125e-7;
  let threshold = log(epsilon) + 2.0;

  let too_large = a > -threshold;
  let too_small = a < threshold;
  let exp_a = exp(a);

  if (too_large) {
    return a;
  } else if (too_small) {
    return exp_a;
  } else {
    return log(exp_a + 1.0);
  }
`,Qme="return sqrt(a);",Zme="return a * a;",Jme=`
  if (isnan(a)) {
    return a;
  }

  return select(uniforms.stepAlpha, 1.0, a > 0.0);
`,ege="return tan(a);",tge=`
  let e2x = exp(-2.0 * abs(a));
  return sign(a) * (1.0 - e2x) / (1.0 + e2x);
`,nge="return f32(i32((a)));";function kd(t,e){switch(t){case Ge.ABS:return hme;case Ge.ACOS:return fme;case Ge.ACOSH:return pme;case Ge.ASIN:return mme;case Ge.ASINH:return gme;case Ge.ATAN:return xme;case Ge.ATANH:return yme;case Ge.COS:return bme;case Ge.COSH:return wme;case Ge.CEIL:return vme;case Ge.ELU:return e?kme:Cme;case Ge.ERF:return Nme;case Ge.EXP:return Tme;case Ge.EXPM1:return Sme;case Ge.FLOOR:return _me;case Ge.IS_FINITE:return Eme;case Ge.IS_INF:return $me;case Ge.IS_NAN:return Ime;case Ge.LINEAR:return Rme;case Ge.LOG:return Pme;case Ge.LOG1P:return Ame;case Ge.LOGICAL_NOT:return jme;case Ge.NEG:return Dme;case Ge.LEAKYRELU:return e?Fme:Ome;case Ge.RECIPROCAL:return Mme;case Ge.RELU:return e?zme:Lme;case Ge.RELU6:return e?Vme:Bme;case Ge.ROUND:return Wme;case Ge.RSQRT:return Ume;case Ge.SELU:return Hme;case Ge.SIGMOID:return Gme;case Ge.SIGN:return Kme;case Ge.SIN:return qme;case Ge.SINH:return Xme;case Ge.SOFTPLUS:return Yme;case Ge.SQRT:return Qme;case Ge.SQUARE:return Zme;case Ge.STEP:return Jme;case Ge.TAN:return ege;case Ge.TANH:return tge;case Ge.TO_INT:return nge;default:throw new Error(`BinaryType ${t} is not implemented!`)}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mc(t,e=!1,n=!1,s=3){if(t===null)return"";let r="";if(t==="linear")r=kd(Ge.LINEAR);else if(t==="relu")r=kd(Ge.RELU,n);else if(t==="elu")r=kd(Ge.ELU,n);else if(t==="relu6")r=kd(Ge.RELU6,n);else if(t==="prelu")r=TR(Bt.PRELU,n);else if(t==="sigmoid")r=kd(Ge.SIGMOID,n);else if(t==="leakyrelu")r=kd(Ge.LEAKYRELU,n);else throw new Error(`Activation ${t} has not been implemented for the WebGPU backend.`);const o=tn(n?4:1);let a="";return e?a=`
      fn activation(a : ${o}, coords : vec${s}<i32>) -> ${o} {
        let b = getPreluActivationWeightsByOutputCoords(coords);
        ${r}
      }`:a=`
      fn activation(a : ${o}, coords : vec${s}<i32>) -> ${o} {
        ${r}
      }`,a}function Hh(t,e){return`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      ${e?"value = activation(value, coords);":""}
      `}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mU(t,e,n=!1,s=!1,r=!1,i=1){O(t&&i===1||!t,()=>`transposeA ${t} is not compatible with component size ${i}`);const o=`
      ${t?"value = getA(batch, col, row);":"value = getA(batch, row, col);"}

    `,a=e?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return`
  fn mm_readA(batch: i32, row: i32, col: i32) -> ${tn(i)} {
    var value = ${tn(i)}(0.0);
    ${n&&r?o:`
    ${t?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])"}
    {
      ${o}
    }
    `}
    return value;
  }

  fn mm_readB(batch: i32, row: i32, col: i32) -> ${tn(i)} {
    var value = ${tn(i)}(0.0);
    ${a}
    return value;
  }
  `}function _R(t,e,n,s,r=!1,i=!1,o=!1,a=1){return`
  ${mU(n,s,r,i,o,a)}
  fn mm_write(batch: i32, row: i32, col: i32, valueIn: ${tn(a)}) {
    ${r&&i?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)"}
    {
      var value = valueIn;
      let coords = vec3<i32>(batch, row, col);
      ${Hh(t,e)}
      setOutputAtCoords(coords[0], coords[1], coords[2], value);
    }
  }
  `}const sge=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol * ${e});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRow + innerRow,
          kStart + inputCol * ${e});
        `,rge=(t,e,n,s)=>{if(t)return`
      for (var k = 0; k < ${s}; k++) {
        let BCached0 = mm_Bsub[k][tileCol];
        let ACached0 = mm_Asub[k][localRow];
        for (var i = 0; i < ${n}; i++) {
          acc[i] = fma(BCached0, vec4<f32>(ACached0[i]), acc[i]);
        }
      }`;{let r="",i="";for(let o=0;o<e;o++)r+=`let BCached${o} = mm_Bsub[k * ${e} + ${o}][tileCol];`,i+=`acc[i] = fma(BCached${o}, vec4<f32>(ACached[${o}]), acc[i]);`;return`
      for (var k = 0; k < ${s/e}; k++) {
        ${r}
        for (var i = 0; i < ${n}; i++) {
          let ACached = mm_Asub[tileRow + i][k];
          ${i}
        }
      }`}};function _1(t,e,n=!1,s=32,r=!1,i=32,o=!1){const a=e[1]*t[1],l=e[0]*t[0],c=n?a:s,d=n?s:a,h=c/e[0],f=s/e[1],p=t[1],m=t[0];return O((n&&h===4&&t[1]===4||!n&&(h===3||h===4))&&c%e[0]===0&&s%e[1]===0&&t[0]===4,()=>`If transposeA ${n} is true, innerElementSize ${h} and workPerThread[1] ${t[1]} must be 4.
          Otherwise, innerElementSize ${h} must be 3 or 4.
      tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`),`
  var<workgroup> mm_Asub : array<array<vec${h}<f32>, ${c/h}>, ${d}>;
  var<workgroup> mm_Bsub : array<array<vec4<f32>, ${l/t[0]}>, ${s}>;

  ${Ke()} {
    let localRow = i32(localId.y);
    let tileRow = localRow * ${p};
    let tileCol = i32(localId.x);

    let globalRow = i32(globalId.y) * ${p};
    let globalCol = i32(globalId.x) * ${m};
    let batch = ${r?"0":"i32(globalId.z)"};
    let batchA = ${r||!o?"batch":"batch % uniforms.aShape[0]"};
    let batchB = ${r||!o?"batch":"batch % uniforms.bShape[0]"};
    let globalRowStart = i32(workgroupId.y) * ${a};

    let numTiles = ${r?`${Math.ceil(i/s)}`:`(uniforms.dimInner - 1) / ${s} + 1`};
    var kStart = ${r?`i32(globalId.z) * ${i}`:"0"};

    var acc: array<vec4<f32>, ${p}>;

    // Loop over shared dimension.
    let tileRowB = localRow * ${f};
    for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var innerRow = 0; innerRow < ${p}; innerRow++) {
            let inputRow = tileRow + innerRow;
            let inputCol = tileCol;
            ${sge(n,h)}
        }

        // Load one tile of B into local memory.
        for (var innerRow = 0; innerRow < ${f}; innerRow++) {
            let inputRow = tileRowB + innerRow;
            let inputCol = tileCol;
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);
        }
        kStart = kStart + ${s};
        workgroupBarrier();

        // Compute acc values for a single thread.
        ${rge(n,h,p,s)}
        workgroupBarrier();
    }

    for (var innerRow = 0; innerRow < ${p}; innerRow++) {
        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
    }
  }`}const eD=t=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol);
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRowStart + inputRow,
          kStart + inputCol);
        `,ige=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];";function E1(t,e,n=!1,s=32,r=!1,i=32,o=!1,a=!1){const l=t[1]*e[1],c=t[0]*e[0],d=n?l:s,h=n?s:l;O(h%e[1]===0&&d%e[0]===0&&s%e[1]===0,()=>`tileAHight ${h} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);const f=h/e[1],p=d/e[0],m=s/e[1],g=t[1],x=t[0],y=o?`
      let localRow = i32(localId.y);
      let localCol = i32(localId.x);
      let globalRowStart = i32(workgroupId.y) * ${l};
      let globalColStart = i32(workgroupId.x) * ${c};

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var inputRow = localRow; inputRow < ${h}; inputRow = inputRow + ${e[1]}) {
          for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${e[0]}) {
            ${eD(n)}
          }
        }
        // Load one tile of B into local memory.
        for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
              for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
              kStart + inputRow,
              globalColStart + inputCol);
          }
        }
        kStart = kStart + ${s};
        workgroupBarrier();

        // Compute acc values for a single thread.
        var BCached : array<f32, ${x}>;
        for (var k = 0; k < ${s}; k++) {
          for (var inner = 0; inner < ${x}; inner++) {
            BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
          }
          for (var innerRow = 0; innerRow < ${g}; innerRow++) {
            let ACached = ${n?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
            for (var innerCol = 0; innerCol < ${x}; innerCol++) {
              acc[innerRow][innerCol] =
                  fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
            }
          }
        }
        workgroupBarrier();
      }
      for (var innerRow = 0; innerRow < ${g}; innerRow++) {
        let gRow = globalRowStart + localRow + innerRow * ${e[1]};
        for (var innerCol = 0; innerCol < ${x}; innerCol++) {
          let gCol = globalColStart + localCol + innerCol * ${e[0]};
          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
        }
      }
      `:`
  let tileRow = i32(localId.y) * ${g};
  let tileCol = i32(localId.x) * ${x};

  let globalRow = i32(globalId.y) * ${g};
  let globalCol = i32(globalId.x) * ${x};
  let globalRowStart = i32(workgroupId.y) * ${l};

  let tileRowA = i32(localId.y) * ${f};
  let tileColA = i32(localId.x) * ${p};
  let tileRowB = i32(localId.y) * ${m};
  // Loop over shared dimension.
  for (var t = 0; t < numTiles; t++) {
    // Load one tile of A into local memory.
    for (var innerRow = 0; innerRow < ${f}; innerRow++) {
      for (var innerCol = 0; innerCol < ${p}; innerCol++) {
        let inputRow = tileRowA + innerRow;
        let inputCol = tileColA + innerCol;
        ${eD(n)}
      }
    }

    // Load one tile of B into local memory.
    for (var innerRow = 0; innerRow < ${m}; innerRow++) {
      for (var innerCol = 0; innerCol < ${x}; innerCol++) {
        let inputRow = tileRowB + innerRow;
        let inputCol = tileCol + innerCol;
        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
          kStart + inputRow,
          globalCol + innerCol);
      }
    }
    kStart = kStart + ${s};
    workgroupBarrier();

    // Compute acc values for a single thread.
    var BCached : array<f32, ${x}>;
    for (var k = 0; k < ${s}; k++) {
      for (var inner = 0; inner < ${x}; inner++) {
        BCached[inner] = mm_Bsub[k][tileCol + inner];
      }

      for (var innerRow = 0; innerRow < ${g}; innerRow++) {
        ${ige(n)}
        for (var innerCol = 0; innerCol < ${x}; innerCol++) {
          acc[innerRow][innerCol] =
              fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
        }
      }
    }

    workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < ${g}; innerRow++) {
    for (var innerCol = 0; innerCol < ${x}; innerCol++) {
      mm_write(batch, globalRow + innerRow, globalCol + innerCol,
          acc[innerRow][innerCol]);
    }
  }
  `;return`
    var<workgroup> mm_Asub : array<array<f32, ${d}>, ${h}>;
    var<workgroup> mm_Bsub : array<array<f32, ${c}>, ${s}>;

    ${Ke()} {
      let batch = ${r?"0":"i32(globalId.z)"};
      let batchA = ${r||!a?"batch":"batch % uniforms.aShape[0]"};
      let batchB = ${r||!a?"batch":"batch % uniforms.bShape[0]"};
      let numTiles = ${r?`${Math.ceil(i/s)}`:`(uniforms.dimInner - 1) / ${s} + 1`};
      var kStart = ${r?`i32(globalId.z) * ${i}`:"0"};

      var acc : array<array<f32, ${x}>, ${g}>;

      // Without this initialization strange values show up in acc.
      for (var innerRow = 0; innerRow < ${g}; innerRow++) {
        for (var innerCol = 0; innerCol < ${x}; innerCol++) {
          acc[innerRow][innerCol] = 0.0;
        }
      }
      ${y}
    }
  `}const oge=t=>t?`
      mm_readA(batchA, colA, globalRow),
      mm_readA(batchA, colA + 1, globalRow),
      mm_readA(batchA, colA + 2, globalRow),
      mm_readA(batchA, colA + 3, globalRow)
  `:`
      mm_readA(batchA, globalRow, colA),
      mm_readA(batchA, globalRow, colA + 1),
      mm_readA(batchA, globalRow, colA + 2),
      mm_readA(batchA, globalRow, colA + 3)
  `;function age(t,e=!1){O(t[1]===1&&t[2]===1,()=>`A linear work group size is required. But got ${t}.`);const n=t[0]*4;return`
    var<workgroup> mm_Asub : array<vec4<f32>, ${t[0]}>;

    ${Ke()} {
      let tileCol = i32(localId.x);
      let globalCol = i32(globalId.x);
      let globalRow = i32(globalId.y);

      let numTiles = (uniforms.dimInner - 1) / ${n} + 1;
      let batch = i32(globalId.z);
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      // Without this initialization strange values show up in acc.
      var acc = 0.0;

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        let colA = t * ${n} + tileCol * 4;
        mm_Asub[tileCol] = vec4<f32>(${oge(e)});
        workgroupBarrier();

        // Compute acc values for a single thread.
        for (var k = 0; k < ${n/4}; k++) {
          let rowB = t * ${n} + k * 4;
          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),
                              mm_readB(batchB, rowB + 1, globalCol),
                              mm_readB(batchB, rowB + 2, globalCol),
                              mm_readB(batchB, rowB + 3, globalCol));

          let ACached = mm_Asub[k];
          acc = acc + dot(ACached, BCached);
        }

        workgroupBarrier();
      }

      mm_write(batch, globalRow, globalCol, acc);
    }
  `}let lge=class{constructor(e,n,s=!1,r=!1,i=null,o=null,a=null,l=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=n,this.dispatchLayout={x:[2],y:[1],z:[0]};const c=s?e[1]:e[2];if(this.isVec4=(c%4===0&&!s||n[1]%4===0&&s)&&n[2]%4===0&&!r,this.outputComponent=this.isVec4?4:1,this.isVectorA=n[1]===1&&!s,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{const f=jpe(n[1],c,n[2],s);this.workgroupSize=f.workgroupSize,this.elementsPerThread=f.elementsPerThread}this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);const d=i!=null,h=a!=null;d&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=l,this.transposeA=s,this.transposeB=r,this.addBias=d,this.activation=o,this.hasPreluActivationWeights=h,[this.fitAOuter,this.fitBOuter,this.fitInner]=this.getShapeFit(n[1],n[2],c),this.shaderKey=`matMulPacked_${this.elementsPerThread}_${s}_${r}_${this.activation}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.isVectorA}_${this.sequentialAccessByThreads}`}getShapeFit(e,n,s){const r=this.workgroupSize[1]*this.elementsPerThread[1],i=this.workgroupSize[0]*this.elementsPerThread[0];!this.isVec4&&this.isVectorA?this.tileInner=this.workgroupSize[0]*4:this.tileInner=i;const o=e%r===0,a=n%i===0,l=s%this.tileInner===0;return[o,a,l]}getUserCode(){return`
      ${Mc(this.activation,this.hasPreluActivationWeights,this.isVec4)}
      ${_R(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1)}
      ${this.isVec4?_1(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,!0):this.isVectorA?age(this.workgroupSize,this.transposeA):E1(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0)}
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(t){return`
    var<workgroup> sumValues : array<f32, ${t}>;
    ${Ke()} {
      let coords = getOutputCoords();
      let batch = coords[0];
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      let row = coords[1];
      let col = coords[2];
      var sum = 0.0;
      let Length = uniforms.dimInner;
      for (var k = i32(localId.x); k < Length; k = k + ${t}) {
        let dataA = mm_readA(batchA, row, k);
        let dataB = mm_readB(batchB, k, col);
        sum = sum + dataA * dataB;
      }
      sumValues[localId.x] = sum;
      workgroupBarrier();

      for(var currentSize = ${t/2}u; currentSize > 1u;
          currentSize = currentSize / 2u) {
        if (localId.x < currentSize)
        {
          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];
        }
        workgroupBarrier();
      }

      if (localId.x == 0u) {
        sum = sumValues[0] + sumValues[1];
        mm_write(batch, row, col, sum);
      }
    }
  `}class uge{constructor(e,n=!1,s=!1,r=null,i=null,o=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize);const a=r!=null,l=o!=null;a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.transposeA=n,this.transposeB=s,this.addBias=a,this.activation=i,this.hasPreluActivationWeights=l,this.shaderKey=`matMulReduce_${this.activation}_${n}_${s}`}getUserCode(){return`
      ${Mc(this.activation,this.hasPreluActivationWeights)}
      ${_R(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${cge(this.workgroupSize[0])}
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(t){const e=t[1],n=t[0],s=e>n?e:n;return`
  var<workgroup> mm_Asub : array<array<f32, ${s}>, ${e}>;
  var<workgroup> mm_Bsub : array<array<f32, ${n}>, ${s}>;

  // If the output size is small for matrix multiplication, avoid to use vec4
  // and handle some elements per thread to optimally utilize the ALU.
  // Read data from global memory to registers firstly, then store them into
  // shared memory, so it is instruction-Level parallelism for arithmetic
  // operations and others handle IO operations between barrier api, makes ALU
  // and load/store units work simultaneously, could improves the performance.
  ${Ke()} {
    let tileRow = i32(localId.y);
    let tileCol = i32(localId.x);
    let globalRow = i32(globalId.y);
    let globalCol = i32(globalId.x);
    let batch = i32(globalId.z);
    let batchA = batch % uniforms.aShape[0];
    let batchB = batch % uniforms.bShape[0];

    // uniforms.dimInner should be greater than 0.
    let numTiles = (uniforms.dimInner - 1) / ${s} + 1;
    var acc = 0.0;

    var globalColA = tileCol;
    var globalRowB = 0;
    var regA = mm_readA(batchA, globalRow, globalColA);
    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
    globalColA = globalColA + ${s};
    globalRowB = globalRowB + ${s};

    for (var t = 0; t < numTiles; t = t + 1) {
      mm_Asub[tileRow][tileCol] = regA;
      mm_Bsub[2 * tileRow][tileCol] = regB0;
      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;

      workgroupBarrier();

      regA = mm_readA(batchA, globalRow, globalColA);
      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
      globalColA = globalColA + ${s};
      globalRowB = globalRowB + ${s};

      for (var k = 0; k < ${s}; k = k + 1) {
        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];
      }
      workgroupBarrier();
    }

    mm_write(batch, globalRow, globalCol, acc);
  }
  `}class hge{constructor(e,n,s,r=!1,i=!1,o=null,a=null,l=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=s,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(s[2]/this.workgroupSize[0]),Math.ceil(s[1]/this.workgroupSize[1]),s[0]];const c=o!=null;c&&this.variableNames.push("bias");const d=l!=null;d&&this.variableNames.push("preluActivationWeights"),this.transposeA=r,this.transposeB=i,this.addBias=c,this.activation=a,this.hasPreluActivationWeights=d,this.shaderKey=`matMulSmallOutputSize_${this.activation}_${r}_${i}`}getUserCode(){return`
      ${Mc(this.activation,this.hasPreluActivationWeights)}
      ${_R(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${dge(this.workgroupSize)}
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fge{constructor(e,n,s=!1,r=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.splitedDimInner=128,O(e[0]===1,()=>"MatMulSplitKProgram only supports batch = 1."),this.outputShape=e,this.dispatchLayout={x:[2],y:[1],z:[0,3]};const i=(s&&this.outputShape[1]%4===0||!s&&n%4===0)&&this.outputShape[2]%4===0;this.elementsPerThread=[4,4,this.splitedDimInner],this.outputComponent=i?4:1,i||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=qe(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],n],this.workgroupSize,this.elementsPerThread),this.transposeA=s,this.transposeB=r,this.shaderKey=`matMulSplitK_${s}_${r}_${this.elementsPerThread}_${this.outputComponent}`}getUserCode(){const e=this.outputComponent;return`
      ${mU(!1,this.transposeB,!1,!1,!1,e)}
      fn mm_write(batch: i32, row : i32, col : i32, value : ${tn(e)}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
          let coords = vec3<i32>(batch, row, col);
          let flatIndex = getOutputIndexFromCoords(coords);
          // The problem is that we should initialize output to zero before using.
          // Otherwise, the original value will be added to the result.
          for (var i = 0; i < ${e}; i = i + 1) {
            ${ld("&result[flatIndex + i]",`${e>1?"value[i]":"value"}`,"float32")}
          }
        }
      }
      ${e===4?_1(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):E1(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner)}
    `}}class pge{constructor(e,n=null,s=null,r=null){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=n!=null,this.hasPreluActivationWeights=r!=null,this.activation=s,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`biasActivation_${s}`}getUserCode(){return`
    ${Mc(this.activation,this.hasPreluActivationWeights)}
    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        var value = getXByOutputIndex(index);
        ${Hh(this.addBias,this.activation)}
        setOutputAtIndex(index, value);
      }
    }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let mge=class{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        setOutputAtIndex(index, uniforms.value);
      }
    }
  `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vi(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||um(r),i==="string"){const o=or(i,be(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new mge(s),a=[{type:"float32",data:[r]}];return e.runWebGPUProgram(o,[],i,a)}}const gge={kernelName:zE,backendName:"webgpu",kernelFunc:vi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wt(t){const{inputs:e,attrs:n}=t,{x:s}=e,{shape:r}=n,i=be(s.shape),o=$z(r,i),a=be(o);return O(i===a,()=>`The new shape (${o}) has ${a} elements and the old shape (${s.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.backend.incRef(s.dataId),{dataId:s.dataId,shape:o,dtype:s.dtype}}const xge={kernelName:L$,backendName:"webgpu",kernelFunc:wt};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,d=e.shape.length,h=n?t.shape[c-2]:t.shape[c-1],f=s?e.shape[d-1]:e.shape[d-2],p=n?t.shape[c-1]:t.shape[c-2],m=s?e.shape[d-2]:e.shape[d-1],g=t.shape.slice(0,-2),x=e.shape.slice(0,-2),y=be(g),v=be(x),C=nn(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,m]);O(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const k=n?[y,h,p]:[y,p,h],T=s?[v,m,f]:[v,f,m],_=wt({inputs:{x:t},backend:r,attrs:{shape:k}}),$=wt({inputs:{x:e},backend:r,attrs:{shape:T}}),R=[_,$],A=Math.max(y,v),j=[_,$],F=[{type:"int32",data:[p]},{type:"int32",data:[m]},{type:"int32",data:[h]}];let L,M;const q=[A,p,m];let z=ue().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(z<0){const U=ue().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),G=U>0?U:r.thresholdToIncreaseWorkgroups,xe=A*Math.ceil(p/32)*Math.ceil(m/32);xe<=G||p<=8&&xe<=G*2?A*p*m<=128?z=cl.MatMulReduceProgram:A===1&&f>=2e3?z=cl.MatMulSplitKProgram:z=cl.MatMulSmallOutputSizeProgram:z=cl.MatMulPackedProgram}switch(z){case cl.MatMulReduceProgram:L=new uge(q,n,s,i,l,o);break;case cl.MatMulSplitKProgram:{if(M=vi({backend:r,attrs:{shape:q,value:0,dtype:t.dtype}}),L=new fge(q,f,n,s),i||l){M=r.runWebGPUProgram(L,j,t.dtype,F,M);const G=new pge(M.shape,i,l,o);let xe=null;const Ce=[M];i&&Ce.push(i),o&&Ce.push(o),l==="leakyrelu"&&(xe=[{type:"float32",data:[a]}],G.uniforms+=" alpha : f32,");const De=r.runWebGPUProgram(G,Ce,M.dtype,xe);R.push(M);const fe=wt({inputs:{x:De},backend:r,attrs:{shape:C}});R.push(De);for(const ee of R)r.disposeData(ee.dataId);return fe}break}case cl.MatMulSmallOutputSizeProgram:L=new hge(k,T,q,n,s,i,l,o);break;case cl.MatMulPackedProgram:const U=r.adapterInfo.isIntel();L=new lge(k,q,n,s,i,l,o,U);break;default:throw new Error(`Unsupported MatMulProgramType ${z}.`)}i&&j.push(i),o&&j.push(o),l==="leakyrelu"&&(F.push({type:"float32",data:[a]}),L.uniforms+=" alpha : f32,"),M=r.runWebGPUProgram(L,j,t.dtype,F,M);const re=wt({inputs:{x:M},backend:r,attrs:{shape:C}});R.push(M);for(const U of R)r.disposeData(U.dataId);return re}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yge(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:d,leakyreluAlpha:h}=s;return $1({a:r,b:i,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const vge={kernelName:Eb,backendName:"webgpu",kernelFunc:yge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let tD=class{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=nn(n,s),this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`binaryOpComplex_${e}`,this.op=e}getUserCode(){return`
      fn binaryOpComplex(
          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {
        ${TR(this.op,!1)}
      }

      ${Ke("index")} {
        if(index < uniforms.size) {
          let areal = getARealByOutputIndex(index);
          let aimag = getAImagByOutputIndex(index);
          let breal = getBRealByOutputIndex(index);
          let bimag = getBImagByOutputIndex(index);
          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));
        }
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Vb=class{constructor(e,n,s){if(this.size=!0,this.variableNames=["A","B"],this.outputShape=nn(n,s),this.dispatchLayout=at(this.outputShape),this.op=e,this.useSharedMemoryWithA=n.length<=1&&s.length>1&&n[0]<128,this.useSharedMemoryWithB=s.length<=1&&n.length>1&&s[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB)this.outputComponent=1,this.variableComponents=[1,1],this.lastDimensionSize=this.useSharedMemoryWithB?s[0]:n[0],this.shaderKey=`binary_${e}_${this.lastDimensionSize}`,this.type="shared",this.workgroupSize=[256,1,1];else{const r=n.length>0&&n[n.length-1]%4===0,i=s.length>0&&s[s.length-1]%4===0;r&&i?(this.outputComponent=4,this.variableComponents=[4,4]):r&&(hj(s)||s[s.length-1]===1)||i&&(hj(n)||n[n.length-1]===1)?(this.outputComponent=4,this.variableComponents=r?[4,1]:[1,4]):(this.outputComponent=1,this.variableComponents=[1,1]),this.type="nonshared",this.shaderKey=`binary_${e}_${this.variableComponents}`,this.workgroupSize=[128,1,1]}this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.outputComponent,1,1])}getUserCode(){let e;const n=this.outputComponent===4?"vec4<f32>":"f32",s=`
    fn binaryOperation(a : ${n}, b : ${n}) -> ${n} {
      ${TR(this.op,this.outputComponent===4)}
    };
    `;if(this.type==="shared"){const r=this.lastDimensionSize>1?`coords[${this.outputShape.length-1}]`:"0",i=this.useSharedMemoryWithB?`let a = getAByOutputIndex(index);
          let b = sharedBuf[${r}];`:`let a = sharedBuf[${r}];
          let b = getBByOutputIndex(index);`;e=`
        ${s}
        var<workgroup> sharedBuf : array<f32, ${this.lastDimensionSize}>;
        ${Ke("index")} {
          // Fill in the shared memory buffer.
          let localIndex = i32(localId.x);
          if(localIndex < ${this.lastDimensionSize}) {
            sharedBuf[localIndex] = f32(${this.useSharedMemoryWithB?"B":"A"}[localIndex]);
          }
          workgroupBarrier();

          if(index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            ${i}
            setOutputAtIndex(index, binaryOperation(a, b));
          }
        }
        `}else e=`
       ${s}
       ${Ke("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index * ${this.outputComponent});
           let a = ${n}(getAByOutputCoords(coords));
           let b = ${n}(getBByOutputCoords(coords));
           setOutputAtIndex(index, binaryOperation(a, b));
         }
       }
       `;return e}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xi(t){const{inputs:e}=t,{x:n}=e;return t.backend.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}const bge={kernelName:d1,backendName:"webgpu",kernelFunc:Xi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gh(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.tensorMap.get(i.dataId),a=Xi({inputs:{x:s},backend:n}),l=Xi({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const wge={kernelName:fE,backendName:"webgpu",kernelFunc:Gh};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let pm=class{constructor(e,n,s=""){this.variableNames=["A"],this.size=!0;const r=128;this.workgroupSize=[r,1,1],this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=n,s!==""&&(this.uniforms=s),this.shaderKey=`unary_${n}`}getUserCode(){return`
      fn unaryOperation(a : f32) -> f32 {
        ${kd(this.op,!1)}
      }
      ${Ke("index")} {
        if (index < uniforms.size) {
          let a = getAByOutputIndex(index);
          setOutputAtIndex(index, unaryOperation(a));
        }
      }
      `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tn({opType:t,cpuKernelImpl:e,dtype:n}){return({inputs:s,backend:r})=>{const{x:i}=s,o=r,a=n||i.dtype;if(o.shouldExecuteOnCPU([i])&&e!=null){const c=o.tensorMap.get(i.dataId),d=e(c.values,a);return o.makeTensorInfo(i.shape,a,d)}const l=new pm(i.shape,t);return o.runWebGPUProgram(l,[i],a)}}function xr({opType:t,cpuKernelImpl:e,supportsComplex:n=!1,dtype:s}){return({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(n&&o.dtype==="complex64"){const h=l.tensorMap.get(o.dataId),f=l.tensorMap.get(a.dataId);let p,m;if(t!==Bt.MUL)[p,m]=[[h.complexTensorInfos.real,f.complexTensorInfos.real],[h.complexTensorInfos.imag,f.complexTensorInfos.imag]].map(x=>{const[y,v]=x,S={dataId:y.dataId,dtype:y.dtype,shape:o.shape},C={dataId:v.dataId,dtype:v.dtype,shape:a.shape},k=new Vb(t,o.shape,a.shape);return l.runWebGPUProgram(k,[S,C],wi(y.dtype,v.dtype))});else{const x=new tD(Bt.COMPLEX_MULTIPLY_REAL,o.shape,a.shape),y=new tD(Bt.COMPLEX_MULTIPLY_IMAG,o.shape,a.shape),v=[{dataId:h.complexTensorInfos.real.dataId,dtype:h.complexTensorInfos.real.dtype,shape:o.shape},{dataId:h.complexTensorInfos.imag.dataId,dtype:h.complexTensorInfos.imag.dtype,shape:o.shape},{dataId:f.complexTensorInfos.real.dataId,dtype:f.complexTensorInfos.real.dtype,shape:a.shape},{dataId:f.complexTensorInfos.imag.dataId,dtype:f.complexTensorInfos.imag.dtype,shape:a.shape}];p=l.runWebGPUProgram(x,v,"float32"),m=l.runWebGPUProgram(y,v,"float32")}const g=Gh({inputs:{real:p,imag:m},backend:l});return l.disposeData(p.dataId),l.disposeData(m.dataId),g}const c=s||wi(o.dtype,a.dtype);if((o.dtype==="string"||a.dtype==="string"||l.shouldExecuteOnCPU([o,a]))&&e!=null){const h=l.tensorMap.get(o.dataId).values,f=l.tensorMap.get(a.dataId).values,p=o.dtype==="string"?Ku(h):h,m=o.dtype==="string"?Ku(f):f,[g,x]=e(o.shape,a.shape,p,m,c);return l.makeTensorInfo(x,c,g)}const d=new Vb(t,o.shape,a.shape);return l.runWebGPUProgram(d,[o,a],c)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sge(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ti(t){return(e,n,s,r,i)=>{const o=nn(e,n),a=o.length,l=Ms(o),c=be(o),d=Dl(i,c),h=e.length,f=n.length,p=Ms(e),m=Ms(n),g=Mp(e,o),x=Mp(n,o);if(g.length+x.length===0)for(let y=0;y<d.length;++y)d[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<d.length;++y){const v=U_(y,a,l),S=v.slice(-h);g.forEach(_=>S[_]=0);const C=Dk(S,h,p),k=v.slice(-f);x.forEach(_=>k[_]=0);const T=Dk(k,f,m);d[y]=t(s[C],r[T])}return[d,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cge(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=p1([0],n),[i,o]=Ti((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kge=Ti((t,e)=>t+e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nge(t,e,n,s,r){const i=be(s),o=Nc(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function Tge(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=Kn([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ge=Ti((t,e)=>t&e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lc(t){return(e,n,s)=>{const r=or(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ege=Lc(t=>Math.ceil(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ge(t,e,n,s){const r=or(n,be(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=be(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?Ku(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const d=c*e[1]+i;for(let h=0;h<o.shape[1];++h)r[d+h]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ige=Ti((t,e)=>t===e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rge=Lc(t=>Math.exp(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge=Lc(t=>Math.expm1(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Age=Lc(t=>Math.floor(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jge=Ti((t,e)=>Math.floor(t/e));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dge(t,e,n,s,r,i,o,a,l){const c=Kn([s,i],n);for(let d=0;d<s;d++){const h=[];let f=0;for(let p=0;p<r;p++){const m=t[d*r+p];f+=m*o[p],h.push(m)}if(f<0||f>=l/i)throw new Error(`Invalid indices: ${h} does not index into ${a}`);for(let p=0;p<i;p++)c.values[d*i+p]=e.get(...e.indexToLoc(f*i+p))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oge(t,e,n){const s=Kn(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const d=t.locToIndex(o);0<=d&&d<t.values.length&&(s.values[r]=t.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fge=Ti((t,e)=>t>e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mge=Ti((t,e)=>t>=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lge=Ti((t,e)=>t<e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bge=Ti((t,e)=>t<=e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vge(t,e,n){const s=(e-t)/(n-1),r=Nc(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zge=Lc(t=>Math.log(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wge(t,e,n,s){const r=Dl(s,be(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uge=Ti((t,e)=>Math.max(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hge=Ti((t,e)=>Math.min(t,e));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU=Ti((t,e)=>t*e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gge(t,e,n){const s=dm(-1,n);return gU([],e,s,t,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kge=Ti((t,e)=>t!==e?1:0);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qge(t,e,n,s,r){const i=e.length,o=be(e),a=Ms(e),l=Ms(r),c=Dl(n,be(r));for(let d=0;d<o;++d){const h=U_(d,i,a),f=new Array(h.length);for(let m=0;m<f.length;m++)f[m]=h[s[m]];const p=Dk(f,i,l);c[p]=t[d]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xge(t,e,n,s){const[r,i]=Oo(t,s),o=wi(e,"int32"),a=Nc(be(r),o),l=be(i);for(let c=0;c<a.length;++c){const d=c*l;let h=1;for(let f=0;f<l;++f)h*=n[d+f];a[c]=h}return{outVals:a,outShape:r,outDtype:o}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yge(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=U_(r,e.length,Ms(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function Qge(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Zge(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);Qge(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const d=e[c+1];for(let h=1;h<l+1;++h)a[c].push(h*d)}for(let c=0;c<t.length;++c){let d=t[c],h=t[c]+1;for(let f=0;f<n.length;++f){const p=n[f],m=f+e.length-1;if(m>=0){const g=a[m],x=g[g.length-1]-p[d];for(let y=d;y<h;++y)a[m].push(p[y+1]+x)}d=p[d],h=p[h]}h!==d&&(r.push([d,h]),i+=h-d)}return{outSplits:a,valueSlices:r,numValues:i}}function Jge(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=or("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function nD(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function e0e(t,e,n,s,r,i){const o=nD(e,2)[1],a=nD(i,2)[1];let l=0;for(const c of n)for(let d=c[0];d<c[1];++d){for(let h=0;h<s;++h)r[l*a+h]=t[d*o+h];++l}}function t0e(t,e,n,s,r){const i=e.slice();i[0]=r;const o=or(n,be(i)),a=t.length,l=a===0?0:a/e[0];return e0e(t,e,s,l,o,i),[o,i]}function n0e(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Yge(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:d,valueSlices:h,numValues:f}=Zge(i,o,t,c),p=Jge(d),m=t0e(n,s,r,h,f);return[p,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=2147483647;function s0e(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=o.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),c||d.push(o[0]);for(let x=1;x<d.length;++x)if(d[x]!==d[x-1])throw new Error("starts, limits, and deltas must have the same shape");const h=d.length===0?1:d[0],f=or("int32",h+1);f[0]=0;for(let x=0;x<h;++x){const y=a?t[0]:t[x],v=l?s[0]:s[x],S=c?i[0]:i[x];if(S===0)throw new Error("Requires delta != 0");let C;if(S>0&&v<y||S<0&&v>y)C=0;else if(C=Math.ceil(Math.abs((v-y)/S)),C>sD)throw new Error(`Requires ((limit - start) / delta) <= ${sD}`);f[x+1]=f[x]+C}const p=f[h],m=or(n,p);let g=0;for(let x=0;x<h;++x){const y=f[x+1]-f[x];let v=a?t[0]:t[x];const S=c?i[0]:i[x];for(let C=0;C<y;++C)m[g++]=v,v+=S}return[f,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wo=Aa;class zb{constructor(e,n,s,r,i,o,a,l,c,d){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=H6(d),this.raggedRank=G6(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Wo.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Wo.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Wo.VALUE_ROWIDS:return zb.getMaxWidthValueRowID(n);case Wo.ROW_SPLITS:return zb.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Wo[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return iD(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;K6(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=U6(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return O(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),d=n[a];d===-1&&(c=0);for(let h=0;h<c;++h)o.push(d),d+=s;for(let h=0;h<l-c;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let d=1;d<i;++d){const h=e[d];if(h===l)c>=0&&(++a,a<r?c+=s:c=-1);else{if(a=0,l=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);c=n[h]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Wo.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case Wo.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${Wo[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Wo.FIRST_DIM_SIZE:return e[0];case Wo.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Wo.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Wo[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=iD(s,!1),o=or(this.valuesDType,be(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=be(a),c=n.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const m=this.defaultValueShape;Wt(()=>{const g=_e(d,m);d=Og(g,a).dataSync()})}let h=0,f=0,p=0;for(let m=0;m<=c;++m){let g=m<c?n[m]:-1;if(g===p){++p;continue}if(f<p){const x=i.subarray(h*l),y=o.subarray(f*l),v=(p-f)*l;rD(y,x,v)}if(m>=c){const x=s.length;g=Math.floor(x/l)}if(g>p)if(this.defaultValue.length===1)o.subarray(p*l,g*l).fill(this.defaultValue[0]),p=g;else for(;g>p;){const x=o.slice(p*l);rD(x,d,l),++p}g<0?(h=m+1,f=p):(h=m,f=p,p=f+1)}}}function rD(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function iD(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function r0e(t,e,n,s,r,i,o,a,l,c){return new zb(t,e,n,s,r,i,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i0e(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return Nc(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=Nc(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o0e=Lc(t=>1/Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a0e(t,e,n,s,r,i,o,a,l,c){const d=[s/r,r],h=t.values,f=e.values;if(s===0)return Kn(n,e.dtype);const p=l instanceof Dp?l:Kn(d,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let m=0;m<i;m++){const g=[];let x=0;for(let y=0;y<o;y++){const v=h[m*o+y];g.push(v),x+=v*a[y]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<r;y++)c?p.values[x*r+y]+=f[m*r+y]:p.values[x*r+y]=e.rank===0?f[0]:f[m*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l0e=Lc(t=>1/(1+Math.exp(-t)));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c0e(t,e,n,s,r){const i=eR(s,e,n),o=be(n),a=Ms(s);if(i){const h=tR(e,a);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const l=r==="string"?Ku(t):t,c=Kn(s,r,l),d=Kn(n,r);for(let h=0;h<d.size;++h){const f=d.indexToLoc(h),p=f.map((m,g)=>m+e[g]);d.set(c.get(...p),...f)}return r==="string"?oU(d.values):d.values}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(t,e,n,s,r,i,o){const a=e[0],l=i[0],c=new Array(l),d=new Array(a),h=e[1];if(l===0){if(a!==0)throw new Error(q6(a));const x=or(n,0),y=or(r,0);return[x,[0,h],y,c,d]}let f=!0,p=0;const m=new Array(l).fill(0);for(let x=0;x<a;++x){const y=t[x*h];if(y<0)throw new Error(X6(x,y));if(y>=l)throw new Error(Y6(x,y,l));++m[y],f=f&&y>=p,p=y}let g=!0;for(let x=0;x<l;++x){const y=m[x]===0;c[x]=y,g=g&&!y,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(g&&f){const x=t,y=s;for(let v=0;v<a;++v)d[v]=v;return[x,[a,h],y,c,d]}else{const x=m[l-1],y=or(n,x*h),v=or(r,x),S=new Array(l).fill(0);for(let C=0;C<a;++C){const k=t[C*h],T=S[k],_=(k===0?0:m[k-1])+T;S[k]++;for(let $=0;$<h;++$)y[_*h+$]=t[C*h+$];v[_]=s[C],d[C]=_}for(let C=0;C<l;++C)if(S[C]===0){const T=C===0?0:m[C-1];y[T*h+0]=C;for(let _=1;_<h;++_)y[T*h+_]=0;v[T]=o}return[y,[x,h],v,c,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d0e(t,e,n,s,r){const i=be(s),o=e[0],a=r.length,l=[];let c=1,d=-1;for(let x=0;x<a;++x){const y=r[x];if(y===-1){if(d!==-1)throw new Error(Q6(d,x));d=x,l.push(1)}else{if(y<0)throw new Error(Z6(x,y));c*=y,l.push(y)}}if(d!==-1){if(c<=0)throw new Error(J6());const x=Math.trunc(i/c);if(c*x!==i)throw new Error(eU(s,l));l[d]=x}if(be(l)!==i)throw new Error(tU(s,l));const f=s.length,p=[];if(f>0){p[f-1]=1;for(let x=f-2;x>=0;--x)p[x]=p[x+1]*s[x+1]}const m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*l[x+1]}const g=or(n,o*a);for(let x=0;x<o;++x){let y=0;for(let v=0;v<f;++v)y+=t[x*f+v]*p[v];for(let v=0;v<a;++v)g[x*a+v]=Math.trunc(y/m[v]),y%=m[v]}return[g,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],h=a>0?r[a-1]+1:0;if(h<0)throw new Error(Jk());const f=e.slice();f[0]=h;const p=f.reduce((S,C)=>S*C,1),m=or(n,p);if(a===0)return h>0&&m.fill(o),[m,f];if(h<=0)throw new Error(Jk());let g=0,x=1,y=0,v=r[g];for(;;){let S=0;if(x<a){if(S=r[x],v===S){++x;continue}if(v>=S)throw new Error(nU())}if(v<0||v>=h)throw new Error(sU(v,h));v>y&&m.fill(o,y*c,v*c);for(let C=g;C<x;++C){const k=s[C];if(k<0||k>=l[0])throw new Error(rU(C,s[C],l[0]));for(let T=0;T<c;T++)m[v*c+T]+=t[k*c+T]}if(i)for(let C=0;C<c;C++)m[v*c+C]/=x-g;if(g=x,++x,y=v+1,v=S,x>a)break}return y<h&&m.fill(o,y*c,h*c),[m,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f0e=Lc(t=>Math.sqrt(t));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p0e=Ti((t,e)=>{const n=t-e;return n*n});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m0e=Lc((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(t,e,n,s){const r=Kn(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x0e{constructor(e,n,s,r,i,o){this.separator=Au(e),this.nGramWidths=n,this.leftPad=Au(s),this.rightPad=Au(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),d=Math.max(0,l-(i-(a+1))),h=o-(c+d),f=n+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let v=0;v<h;++v)p+=e[f+v].length;p+=d*this.rightPad.length;const m=c+d+h-1;p+=m*this.separator.length,s[r+a]=new Uint8Array(p);const g=s[r+a];let x=0;const y=v=>v.forEach(S=>g[x++]=S);for(let v=0;v<c;++v)y(this.leftPad),y(this.separator);for(let v=0;v<h-1;++v)y(e[f+v]),y(this.separator);if(h>0){y(e[f+h-1]);for(let v=0;v<d;++v)y(this.separator),y(this.rightPad)}else{for(let v=0;v<d-1;++v)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let d=n[c]>=l;if(d=d&&n[c]<=s,!d)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=or("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=i;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const c=n[l]-n[l-1];let d=0;this.nGramWidths.forEach(h=>{d+=this.getNumNGrams(c,h)}),this.preserveShort&&c>0&&d===0&&(d=1),o[l]=o[l-1]+d}const a=new Array(o[i]);for(let l=0;l<i;++l){const c=n[l];let d=o[l];if(this.nGramWidths.forEach(h=>{const f=n[l+1]-n[l],p=this.getNumNGrams(f,h);this.createNGrams(e,c,a,d,p,h),d+=p}),this.preserveShort&&d===o[l]){const h=n[l+1]-n[l];if(h===0)continue;const f=h+2*this.padWidth;this.createNGrams(e,c,a,d,1,f)}}return[a,o]}}function y0e(t,e,n,s,r,i,o,a){return new x0e(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function b0e(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let f=0;f<s;++f){const p=r.length;v0e(t[f],e,n,r);const m=r.length-p;a[f]=m,i+=m,o=Math.max(o,m)}const l=or("int32",i*2),c=new Array(i),d=[s,o];let h=0;for(let f=0;f<s;++f)for(let p=0;p<a[f];++p)l[h*2]=f,l[h*2+1]=p,c[h]=r[h],++h;return[l,c,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w0e(t,e){const n=or("int32",t.length);for(let s=0;s<t.length;++s)n[s]=Zne(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S0e=Ti((t,e)=>t-e);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0e(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=Kn(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cg=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function xU(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),d=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*d*(a-d)/a)*Math.sign(l-a/2),f=Math.max(n,Math.floor(e-l*d/a+h)),p=Math.min(s,Math.floor(e+(a-l)*d/a+h));xU(t,e,f,p)}const r=t[e];let i=n,o=s;for(Bm(t,n,e),cg(t[s],r)>0&&Bm(t,n,s);i<o;){for(Bm(t,i,o),i++,o--;cg(t[i],r)<0;)i=i+1;for(;cg(t[o],r)>0;)o=o-1}cg(t[n],r)===0?Bm(t,n,o):(o=o+1,Bm(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function k0e(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=Dl(n,o*s),c=Dl("int32",o*s);for(let h=0;h<o;h++){const f=h*a,p=t.subarray(f,f+a);let m=new Array(p.length);p.forEach((v,S)=>m[S]={value:v,index:S}),s<m.length&&(xU(m,s),m=m.slice(0,s)),r&&m.sort(cg);const g=h*s,x=l.subarray(g,g+s),y=c.subarray(g,g+s);for(let v=0;v<s;v++)x[v]=m[v].value,y[v]=m[v].index}const d=e.slice();return d[d.length-1]=s,[Kn(d,n,l),Kn(d,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N0e(t,e,n,s){const r=bs(e,n)[0],i=[1,n[0],1];for(let m=0;m<r;m++)i[0]*=n[m];i[1]=n[r];for(let m=r+1;m<n.length;m++)i[2]*=n[m];const o=new Map,a=new Int32Array(n[r]),l=new Dp(i,s,t),c=[],d=i[0]===1&&i[2]===1;for(let m=0;m<n[r];m++){let g;if(d)g=t[m].toString();else{const y=[];for(let v=0;v<i[0];v++)for(let S=0;S<i[2];S++)y.push(l.get(v,m,S));g=y.join(",")}const x=o.get(g);if(x!=null)a[m]=x;else{const y=o.size;o.set(g,y),a[m]=y,c.push(m)}}const h=i.slice();h[1]=o.size;const f=new Dp(h,s);c.forEach((m,g)=>{for(let x=0;x<i[0];x++)for(let y=0;y<i[2];y++)f.set(l.get(x,m,y),x,g,y)});const p=n.slice();return p[r]=h[1],{outputValues:f.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU=Object.freeze(Object.defineProperty({__proto__:null,addImpl:kge,bincountImpl:Nge,bincountReduceImpl:Tge,bitwiseAndImpl:_ge,castImpl:Cge,ceilImpl:Ege,concatImpl:$ge,equalImpl:Ige,expImpl:Rge,expm1Impl:Pge,floorDivImpl:jge,floorImpl:Age,gatherNdImpl:Dge,gatherV2Impl:Oge,greaterEqualImpl:Mge,greaterImpl:Fge,lessEqualImpl:Bge,lessImpl:Lge,linSpaceImpl:Vge,logImpl:zge,maxImpl:Wge,maximumImpl:Uge,minimumImpl:Hge,multiplyImpl:gU,negImpl:Gge,notEqualImpl:Kge,prodImpl:Xge,raggedGatherImpl:n0e,raggedRangeImpl:s0e,raggedTensorToTensorImpl:r0e,rangeImpl:i0e,rsqrtImpl:o0e,scatterImpl:a0e,sigmoidImpl:l0e,simpleAbsImpl:Sge,sliceImpl:c0e,sparseFillEmptyRowsImpl:u0e,sparseReshapeImpl:d0e,sparseSegmentReductionImpl:h0e,sqrtImpl:f0e,squaredDifferenceImpl:p0e,staticRegexReplaceImpl:m0e,stridedSliceImpl:g0e,stringNGramsImpl:y0e,stringSplitImpl:b0e,stringToHashBucketFastImpl:w0e,subImpl:S0e,tileImpl:C0e,topKImpl:k0e,transposeImpl:qge,uniqueImpl:N0e},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:T0e,castImpl:_0e,ceilImpl:E0e,concatImpl:$0e,equalImpl:I0e,expImpl:R0e,expm1Impl:P0e,floorImpl:A0e,floorDivImpl:j0e,gatherNdImpl:D0e,gatherV2Impl:O0e,greaterEqualImpl:F0e,greaterImpl:M0e,lessEqualImpl:L0e,lessImpl:B0e,logImpl:V0e,maxImpl:z0e,maximumImpl:W0e,minimumImpl:U0e,multiplyImpl:H0e,negImpl:G0e,notEqualImpl:K0e,prodImpl:q0e,rangeImpl:X0e,rsqrtImpl:Y0e,scatterImpl:Q0e,simpleAbsImpl:Z0e,sliceImpl:J0e,stridedSliceImpl:exe,stringNGramsImpl:txe,subImpl:nxe,tileImpl:sxe,topKImpl:rxe,transposeImpl:ixe,uniqueImpl:k9e}=yU;/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oxe=Tn({opType:Ge.ABS,cpuKernelImpl:Z0e}),axe={kernelName:G_,backendName:"webgpu",kernelFunc:oxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lxe=Tn({opType:Ge.ACOS}),cxe={kernelName:K_,backendName:"webgpu",kernelFunc:lxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uxe=Tn({opType:Ge.ACOSH}),dxe={kernelName:q_,backendName:"webgpu",kernelFunc:uxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hxe=xr({opType:Bt.ADD,cpuKernelImpl:T0e,supportsComplex:!0}),fxe={kernelName:c1,backendName:"webgpu",kernelFunc:hxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let pxe=class{constructor(e){this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e[0],this.variableNames=e.map((n,s)=>`T${s}`),this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}getUserCode(){const e=[];this.variableNames.forEach(r=>{e.push(`let v${r} = get${r}ByOutputCoords(coords);`)});const n=this.variableNames.map(r=>`v${r}`).join(" + ");return`
      ${Ke("index")} {
        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if (flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            ${e.join(`
        `)}
            setOutputAtIndex(flatIndex, ${n});
          }
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mxe(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Xi({inputs:{x:s[0]},backend:n});const r=s.map(a=>a.dtype).reduce((a,l)=>wi(a,l)),i=s.map(a=>a.shape),o=new pxe(i);return n.runWebGPUProgram(o,s,r)}const gxe={kernelName:X_,backendName:"webgpu",kernelFunc:mxe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xxe{constructor(e,n){this.variableNames=["A"],this.workgroupSize=[16,16,1];const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[n[r]];this.outputShape=s,this.dispatchLayout={x:[0],y:[1]},this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}getUserCode(){O(this.workgroupSize[0]===this.workgroupSize[1],()=>`Must be a square tile, current tile shape is ${this.workgroupSize[0]} x ${this.workgroupSize[1]}`);const e=this.workgroupSize[0];return`
      var<workgroup> tile : array<array<f32, ${this.workgroupSize[0]+1}>, ${this.workgroupSize[0]}>;
      ${Ke()} {
        var x = i32(workgroupId.x) * ${e} + i32(localId.x);
        var y = i32(workgroupId.y) * ${e} + i32(localId.y);
        let width = uniforms.outShape[0];
        let height = uniforms.outShape[1];
        if (x < width && y < height) {
          tile[localId.y][localId.x] = f32(A[y * width + x]);
        }
        workgroupBarrier();

        x = i32(workgroupId.y) * ${e} + i32(localId.x);
        y = i32(workgroupId.x) * ${e} + i32(localId.y);
        if (x < height && y < width) {
          setOutputAtIndex((y * height + x), tile[localId.x]
            [localId.y]);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yxe=class{constructor(e,n){this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[n[r]];this.outputShape=s,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=n,this.shaderKey=`transpose_${n}`}getUserCode(){const e=qs(this.outputShape.length),n=vU(this.newDim);return`
      ${Ke("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            setOutputAtIndex(flatIndex, A[getIndexFromCoords${this.outputShape.length}D(
              ${e}(${n}), uniforms.aShape)]);
          }
        }
      }
    `}};function vU(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=new Array(e);for(let s=0;s<t.length;s++)n[t[s]]=`coords.${pc(s)}`;return n.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ol(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];if(n.shouldExecuteOnCPU([r])){const h=o.tensorMap.get(r.dataId).values,f=ixe(h,r.shape,r.dtype,i,l);return n.makeTensorInfo(l,r.dtype,f)}if(r.shape.length===2&&Gn(i,[1,0])){const d=new xxe(r.shape,i);return o.runWebGPUProgram(d,[r],r.dtype)}const c=new yxe(r.shape,i);return o.runWebGPUProgram(c,[r],r.dtype)}const vxe={kernelName:Dg,backendName:"webgpu",kernelFunc:Ol};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bxe=class{constructor(e,n,s){this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[e.batchSize,e.inSize];const[r]=Oo(this.inputShape,[1]);this.outputShape=r.length===0?[1]:r,e.inSize>=32768&&s>=512?this.workgroupSize=[512,1,1]:e.inSize>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=n,this.shaderKey=`reduce_${n}`}getUserCode(){let e="",n="0.0";const s=this.workgroupSize[0];this.reduceType==="min"||this.reduceType==="max"?(e=`
         if (isnan(candidate)) {
          bestValue = uniforms.NAN;
         } else if (!isnan(bestValue) && candidate ${this.reduceType==="min"?"<":">"} bestValue)
           {  bestValue = candidate; }`,n="f32(x[offset])"):this.reduceType==="sum"||this.reduceType==="mean"?e=" bestValue = bestValue + candidate; ":this.reduceType==="prod"?(e=" bestValue = bestValue * candidate; ",n="1.0"):this.reduceType==="all"?(e=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",n="1.0"):this.reduceType==="any"&&(e=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",n="0.0");const r=this.reduceType==="mean"?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return`
       fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
       }

       ${`
         var<workgroup> xBestValues : array<f32, ${s}>;
       `}
       fn getOffset(outputIndex : i32) -> i32 {
         let outputCoords = getCoordsFromIndex(outputIndex);
         let offset = ${this.outputShape.length===1?"outputCoords":"outputCoords[0]"} * uniforms.reduceSize;
          return offset;
       }
       ${Ke("index")} {
         let outputIndex = index / ${s};
         let offset = getOffset(outputIndex);
         var bestValue = ${n};
         let Length = uniforms.reduceSize;
         let WorkPerThread = DIV_CEIL(u32(Length), ${s}u);
         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;
             k = k + ${s}) {
           let candidate = f32(x[offset + k]);
           ${e}
         }
         xBestValues[localId.x] = bestValue;
         workgroupBarrier();

         var reduceSize = min(u32(Length), ${s}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            ${e}
            xBestValues[localId.x] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (localId.x == 0u && outputIndex < uniforms.size) {
          ${r}
        }
       }
     `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wxe={mean:"float32",all:"bool",any:"bool"};function Kh(t,e,n,s,r){const i=t.shape.length,o=[],a=bs(e,t.shape);let l=a;const c=Mr(l,i);let d=t;c!=null&&(d=Ol({inputs:{x:t},attrs:{perm:c},backend:r}),l=Lr(l.length,i),o.push(d)),eo(s,l,i);const[h,f]=Oo(d.shape,l);let p=h;n&&(p=Ji(h,a));let m;if((s==="max"||s==="prod")&&r.shouldExecuteOnCPU([d])){const g=r.tensorMap.get(d.dataId).values;switch(s){case"max":const x=z0e(g,be(f),p,t.dtype);m=r.makeTensorInfo(p,t.dtype,x);break;case"prod":const{outVals:y,outShape:v,outDtype:S}=q0e(d.shape,d.dtype,g,l);m=r.makeTensorInfo(v,S,y);break;default:throw new Error(`${s} CPU implementation is not yet supported.`)}}else{const g=be(f),y=be(d.shape)/g,v={windowSize:g,inSize:g,batchSize:y,outSize:1},S=wxe[s]||m1(t.dtype),C=[{type:"int32",data:[g]}],k=new bxe(v,s,r.device.limits.maxComputeWorkgroupSizeX),T=r.runWebGPUProgram(k,[d],S,C);o.push(T),m=wt({inputs:{x:T},attrs:{shape:p},backend:r})}return o.forEach(g=>r.disposeData(g.dataId)),m}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:i,axis:o}=s;return Kh(r,o,i,"all",n)}const Cxe={kernelName:Y_,backendName:"webgpu",kernelFunc:Sxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:i,axis:o}=s;return Kh(r,o,i,"any",n)}const Nxe={kernelName:Q_,backendName:"webgpu",kernelFunc:kxe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bU=class{constructor(e,n,s){this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;const r=[n];this.op=s==="min"?"<":">";const[i,o]=Oo(e,r);this.outputShape=i.length===0?[1]:i,this.dispatchLayout=at(this.outputShape),be(o)<32?(this.type="plain",this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=qe(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=e,this.shaderKey=`argMinMax_${this.op}_${this.type}`}getUserCode(){const e=this.workgroupSize[0],n=()=>this.inputShape.length===1?"uniforms.xShape":`uniforms.xShape.${pc(this.inputShape.length-1)}`,s=()=>{let r="";if(this.outputShape.length===1)this.inputShape.length!==1&&(r+="outputCoords,");else for(let i=0;i<this.outputShape.length;i++)r+=`outputCoords.${pc(i)},`;return r};return this.type==="shared"?`
      fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
      }

      ${`
      var<workgroup> xBestIndices : array<i32, ${e}>;
      var<workgroup> xBestValues : array<f32, ${e}>;
    `}

      ${Ke("index")} {
        let outputIndex = index / ${e};
        let reduceLength = ${n()};

        var bestIndex = i32(localId.x);
        var bestValue = uniforms.infinityValue;
        let outputCoords = getCoordsFromIndex(outputIndex);
        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;
            k = k + ${e}) {
          let candidate = getX(${s()} k);
          if (!isnan(candidate) && candidate ${this.op} bestValue) {
            bestValue = candidate;
            bestIndex = k;
          }
        }
        xBestValues[localId.x] = bestValue;
        xBestIndices[localId.x] = bestIndex;
        workgroupBarrier();

        var reduceSize = min(u32(reduceLength), ${e}u);
        for (var currentSize = reduceSize / 2u; reduceSize > 1u;
            currentSize = reduceSize / 2u) {
          let interval = DIV_CEIL(reduceSize, 2u);
          if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              xBestValues[localId.x] = bestValue;
              xBestIndices[localId.x] = xBestIndices[localId.x + interval];
            }
          }
          reduceSize = interval;
          workgroupBarrier();
        }

        if (localId.x == 0u && outputIndex < uniforms.size) {
          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);
        }
      }
    `:`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let outputCoords = getCoordsFromIndex(index);
          var bestIndex = 0;
          var bestValue = getX(${s()} 0);
          let reduceLength = ${n()};
          for (var i = 1; i < reduceLength; i++) {
            let candidate = getX(${s()} i);
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              bestIndex = i;
            }
          }
          setOutputAtIndexI32(index, bestIndex);
        }
      }
      `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=bs(i,r.shape);const a=Mr(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Ol({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=Lr(o.length,l.shape.length)),eo("argMax",[o[0]],l.shape.length);const d=new bU(l.shape,o[0],"max"),h=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],f=n.runWebGPUProgram(d,[l],"int32",h);return c.forEach(p=>n.disposeData(p.dataId)),f}const _xe={kernelName:Z_,backendName:"webgpu",kernelFunc:Txe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Exe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=bs(i,r.shape);const a=Mr(o,r.shape.length);let l=r;const c=[];a!=null&&(l=Ol({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=Lr(o.length,l.shape.length)),eo("argMin",[o[0]],l.shape.length);const d=new bU(l.shape,o[0],"min"),h=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],f=n.runWebGPUProgram(d,[l],"int32",h);return c.forEach(p=>n.disposeData(p.dataId)),f}const $xe={kernelName:J_,backendName:"webgpu",kernelFunc:Exe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ixe=Tn({opType:Ge.ASIN}),Rxe={kernelName:eE,backendName:"webgpu",kernelFunc:Ixe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pxe=Tn({opType:Ge.ASINH}),Axe={kernelName:tE,backendName:"webgpu",kernelFunc:Pxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jxe=Tn({opType:Ge.ATAN}),Dxe={kernelName:nE,backendName:"webgpu",kernelFunc:jxe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oxe=xr({opType:Bt.ATAN2}),Fxe={kernelName:rE,backendName:"webgpu",kernelFunc:Oxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mxe=Tn({opType:Ge.ATANH}),Lxe={kernelName:sE,backendName:"webgpu",kernelFunc:Mxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bxe{constructor(e){this.variableNames=["x"],this.uniforms="strides : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];

          let xRCCorner = coords.yz * uniforms.strides;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          let value = getX(batch, xRCorner, xCCorner, d);
          setOutputAtIndex(index, value);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let E0=class{constructor(e,n,s=!1,r=!1,i=!1){if(this.variableNames=["x"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=n,this.computePositions=s,this.flattenPositions=r,this.includeBatchIndex=i,this.shaderKey=`pool2D_${n}_${s}_${r}_${i}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue = resultValue + value; count = count + 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"((batch * uniforms.xShape[1] + xR) * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"(xR * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"wR * uniforms.filterDims.y + wC"};
      }`:e="resultValue = max(value, resultValue);";let n="resultValue";return this.poolType==="avg"&&(n="resultValue / max(count, 1.0)"),`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];
          let xRCCorner = vec2<i32>(coords.yz) * uniforms.strides - uniforms.pads;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilations.x) {
            let xR = xRCorner + wR;

            if (xR < 0 || xR >= uniforms.convDims.x) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilations.y) {
              let xC = xCCorner + wC;
              if (xC < 0 || xC >= uniforms.convDims.y) {
                continue;
              }

              let value = getX(batch, xR, xC, d);
              ${e}
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${n});`}
        }
      }
    `}},ER=class{constructor(e,n,s=!1,r=!1,i=!1){if(this.variableNames=["x"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, convDims : vec3<i32>, filterDims : vec3<i32>,",this.workgroupSize=[128,1,1],this.size=!0,n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=n,this.computePositions=s,this.flattenPositions=r,this.includeBatchIndex=i,this.shaderKey=`pool3D_${n}_${s}_${r}_${i}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue += value; count += 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"(((batch * uniforms.xShape.y + xD) * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"((xD * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"wD * uniforms.filterDims.y * uniforms.filterDims.y + wR * uniforms.filterDims.z + wC"};
      }`:e="resultValue = max(value, resultValue);";let n="resultValue";return this.poolType==="avg"&&(n="resultValue / max(count, 1.0)"),`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords.x;
          let ch = coords.u;

          let xCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
          let xDCorner = xCorner.x;
          let xRCorner = xCorner.y;
          let xCCorner = xCorner.z;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wD = 0; wD < uniforms.filterDims.x; wD++) {
            let xD = xDCorner + wD;
            if (xD < 0 || xD >= uniforms.convDims.x) {
              continue;
            }

            for (var wR = 0; wR < uniforms.filterDims.y; wR++) {
              let xR = xRCorner + wR;
              if (xR < 0 || xR >= uniforms.convDims.y) {
                continue;
              }

              for (var wC = 0; wC < uniforms.filterDims.z; wC++) {
                let xC = xCCorner + wC;
                if (xC < 0 || xC >= uniforms.convDims.z) {
                  continue;
                }

                let value = getX(batch, xD, xR, xC, ch);
                ${e}
              }
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${n});`}
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wU(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s;return Kh(r,i,o,"max",n)}const Vxe={kernelName:h$,backendName:"webgpu",kernelFunc:wU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SU(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:i,axis:o}=s;return Kh(r,o,i,"mean",n)}const zxe={kernelName:x$,backendName:"webgpu",kernelFunc:SU};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CU(t,e,n,s){if(e.filterWidth===1&&e.filterHeight===1&&Gn(e.inShape,e.outShape))return Xi({inputs:{x:t},backend:s});if(e.filterWidth===e.inWidth&&e.filterHeight===e.inHeight&&e.batchSize===1&&e.padInfo.type==="VALID"){const o=t.shape.length,a=wt({inputs:{x:t},backend:s,attrs:{shape:[t.shape[o-3]*t.shape[o-2],t.shape[o-1]]}});let l;n==="avg"?l=SU({inputs:{x:a},backend:s,attrs:{axis:0,keepDims:!1}}):(O(n==="max",()=>`Invalid pool type ${n}`),l=wU({inputs:{x:a},backend:s,attrs:{reductionIndices:0,keepDims:!1}}));const c=wt({inputs:{x:l},backend:s,attrs:{shape:e.outShape}});return s.disposeData(a.dataId),s.disposeData(l.dataId),c}let r;const i=[{type:"int32",data:[e.strideHeight,e.strideWidth]}];return e.filterHeight===1&&e.filterWidth===1?r=new Bxe(e):(n==="avg"?r=new E0(e,"avg"):(O(n==="max",()=>`Invalid pool type ${n}`),r=new E0(e,"max")),i.push({type:"int32",data:[e.padInfo.top,e.padInfo.left]},{type:"int32",data:[e.dilationHeight,e.dilationWidth]},{type:"int32",data:[e.inHeight,e.inWidth]},{type:"int32",data:[e.effectiveFilterHeight,e.effectiveFilterWidth]})),s.runWebGPUProgram(r,[t],t.dtype,i)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,d=ya(r.shape,i,o,1,a,l);return CU(r,d,"avg",n)}const Uxe={kernelName:iE,backendName:"webgpu",kernelFunc:Wxe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,d=[1,1,1],h=Oc(r.shape,i,o,d,a,c,l),f=new ER(h,"avg"),p=[{type:"int32",data:[h.strideDepth,h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.front,h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.inDepth,h.inHeight,h.inWidth]},{type:"int32",data:[h.effectiveFilterDepth,h.effectiveFilterHeight,h.effectiveFilterWidth]}];return n.runWebGPUProgram(f,[r],r.dtype,p)}const Gxe={kernelName:oE,backendName:"webgpu",kernelFunc:Hxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Kxe=class{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool2DBackprop"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);

            dotProd = dotProd + dyValue * uniforms.avgMultiplier;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},qxe=class{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
       outDepth : i32, outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool3DBackprop"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              dotProd += dyValue * uniforms.avgMultiplier;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xxe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=s,h=Oc(o.shape,a,l,1,c,d),f=new qxe(h),p=1/(h.filterDepth*h.filterHeight*h.filterWidth),m=[{type:"int32",data:[h.strideDepth,h.strideHeight,h.strideWidth]},{type:"int32",data:[h.effectiveFilterDepth-1-h.padInfo.front,h.effectiveFilterHeight-1-h.padInfo.top,h.effectiveFilterWidth-1-h.padInfo.left]},{type:"int32",data:[h.effectiveFilterDepth,h.effectiveFilterHeight,h.effectiveFilterWidth]},{type:"int32",data:[h.outDepth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"float32",data:[p]}];return n.runWebGPUProgram(f,[r],o.dtype,m)}const Yxe={kernelName:Oz,backendName:"webgpu",kernelFunc:Xxe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qxe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;pU([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,d=ya(o.shape,a,l,1,c),h=new Kxe(d),f=1/(d.filterHeight*d.filterWidth),p=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"float32",data:[f]}];return n.runWebGPUProgram(h,[r],o.dtype,p)}const Zxe={kernelName:Dz,backendName:"webgpu",kernelFunc:Qxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jxe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return $1({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const eye={kernelName:aE,backendName:"webgpu",kernelFunc:Jxe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let tye=class{constructor(e,n){this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.rank=n.length,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=e,this.uniforms=`start : ${qs(e.length)}, `,this.shaderKey="slice"}getUserCode(){const e=qs(this.rank),n=nye(this.rank);let s;return this.start.length===1?s=this.outputShape.map((i,o)=>"sourceLoc = uniforms.start + coords;"):s=this.outputShape.map((i,o)=>`sourceLoc.${dN[o]} = uniforms.start.${pc(o)} + coords.${dN[o]};`),`
      ${Ke("index")} {
        if (index < uniforms.size) {
          var sourceLoc : ${e};
          let coords = getCoordsFromIndex(index);
          ${s.join(`
`)}
          setOutputAtIndex(index, getSource(${n}));
        }
      }
    `}};const dN=["x","y","z","w","u","v"];function nye(t){if(t===1)return"sourceLoc";if(t<=6)return dN.slice(0,t).map(e=>`sourceLoc.${e}`).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=nR(r,i,o);if(ZI(r,a,l),n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.tensorMap.get(r.dataId),f=J0e(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,f)}if(be(l)===0)return n.makeTensorInfo(l,r.dtype,[]);const c=new tye(a,l),d=[{type:"int32",data:a}];return n.runWebGPUProgram(c,[r],r.dtype,d)}const sye={kernelName:Q$,backendName:"webgpu",kernelFunc:mm};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rye=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;O(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet");const a=i.reduce((v,S)=>v*S),l=Ix(r.shape,i,a),c=Rx(l.length,i.length),d=Px(r.shape,i,a),h=aR(o,i.length),f=lR(d,o,i.length),p=[],m=wt({inputs:{x:r},backend:n,attrs:{shape:l}}),g=Ol({inputs:{x:m},backend:n,attrs:{perm:c}}),x=wt({inputs:{x:g},backend:n,attrs:{shape:d}}),y=mm({inputs:{x},backend:n,attrs:{begin:h,size:f}});return p.push(m),p.push(g),p.push(x),p.forEach(v=>n.disposeData(v.dataId)),y},iye={kernelName:lE,backendName:"webgpu",kernelFunc:rye};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oye=`
  fn bincount_write(index: i32, value: f32) {
    ${ld("&result[index]","value","float32")}
  }
`,aye=`
  fn bincount_write(index: i32, value: f32) {
    atomicStore(&result[index], bitcast<i32>(value));
  }
`;class kU{constructor(e,n,s=!1){this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=e,this.rank=e.length,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=s,s&&(this.atomic=!1),this.hasWeights=n,this.hasWeights&&this.variableNames.push("w"),this.shaderKey=`bincount_${this.hasWeights}_${this.binaryOutput}_${this.rank}`}getUserCode(){return`
    ${this.binaryOutput?aye:oye}
  ${Ke("index")} {
    ${this.rank===1?`if (index < uniforms.xShape) {
      let indexVal = i32(getX(index));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(index)":"1."};
        bincount_write(indexVal, value);
      }
    }`:`let coord = getCoordsFromIndex(index);
    if (coordsInBounds2D(coord, uniforms.xShape)) {
      let indexVal = i32(getX(coord[0], coord[1]));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1."};
        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);
      }
    }`}
  }
  `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=be(r.shape),c=be(i.shape)>0,d=[o],h=i.dtype,f=vi({backend:n,attrs:{shape:d,value:0,dtype:h}}),p=new kU([a],c),m=[{type:"int32",data:[o]}],g=c?[r,i]:[r];return n.runWebGPUProgram(p,g,h,m,f)}const cye={kernelName:cE,backendName:"webgpu",kernelFunc:lye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uye{constructor(e){this.outputShape=[],this.variableNames=["s0","s1"],this.uniforms="s0Size : i32, s1Size : i32, ",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="broadcastArgs"}getUserCode(){return`
  ${Ke("index")} {
    if (index < uniforms.size) {
      var s0 = 1.0;
      var s1 = 1.0;
      let indexS0 = index - uniforms.size + uniforms.s0Size;
      let indexS1 = index - uniforms.size + uniforms.s1Size;
      if (indexS0 >= 0) {
        s0 = getS0(indexS0);
      }
      if (indexS1 >= 0) {
        s1 = getS1(indexS1);
      }

      if (s0 == 1.0) {
        setOutputAtIndex(index, s1);
      } else if (s1 == 1.0) {
        setOutputAtIndex(index, s0);
      } else if (s0 != s1) {
        setOutputAtIndex(index, uniforms.NAN);
      } else {
        setOutputAtIndex(index, s0);
      }
    }
  }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dye(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e;if(n.shouldExecuteOnCPU([s,r])){const d=n.tensorMap.get(s.dataId),h=n.tensorMap.get(r.dataId),f=d.values,p=h.values,m=nn(Array.from(f),Array.from(p));return n.makeTensorInfo([m.length],"int32",Int32Array.from(m))}const i=be(s.shape),o=be(r.shape),a=Math.max(i,o),l=new uye(a),c=[{type:"int32",data:[i]},{type:"int32",data:[o]}];return n.runWebGPUProgram(l,[s,r],"int32",c)}const hye={kernelName:uE,backendName:"webgpu",kernelFunc:dye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU=xr({opType:Bt.NOT_EQUAL,dtype:"bool",cpuKernelImpl:K0e}),fye={kernelName:N$,backendName:"webgpu",kernelFunc:NU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ax(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.tensorMap.get(s.dataId);return Xi({inputs:{x:r.complexTensorInfos.real},backend:n})}const pye={kernelName:O$,backendName:"webgpu",kernelFunc:Ax};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mye(t,e){const n=new pm(t.shape,Ge.TO_INT),s=e.runWebGPUProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hN(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Xi({inputs:{x:r},backend:n});const o=Rc(r.shape),a=hN({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Gh({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeData(a.dataId),l}if(r.dtype==="complex64"){const o=Ax({inputs:{input:r},backend:n}),a=hN({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeData(o.dataId),a}if(!Iz(r.dtype,i)){const o=Xi({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.tensorMap.get(r.dataId).values,[a,l,c]=_0e(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}if(i==="int32")return mye(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",Dl("bool",1)),l=NU({inputs:{a:r,b:o},backend:n});return n.disposeData(o.dataId),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const gye={kernelName:u1,backendName:"webgpu",kernelFunc:hN};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xye=Tn({opType:Ge.CEIL,cpuKernelImpl:E0e}),yye={kernelName:dE,backendName:"webgpu",kernelFunc:xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vye{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.outputComponent=4,this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}getUserCode(){return`
      ${Ke("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          var clampedValue = clamp(
              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));
          clampedValue = select(clampedValue, value, isnanVec4(value));
          setOutputAtIndex(index, clampedValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bye=class{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}getUserCode(){return`
      ${Ke("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          if (isnan(value)) {
            setOutputAtIndex(index, value);
            return;
          }
          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;const l=[{type:"float32",data:[i]},{type:"float32",data:[o]}];return be(r.shape)%4===0?a=new vye(r.shape):a=new bye(r.shape),n.runWebGPUProgram(a,[r],r.dtype,l)}const Sye={kernelName:hE,backendName:"webgpu",kernelFunc:wye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Cye=class{constructor(e){this.outputShape=[],this.variableNames=["real","imag"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="complexAbs"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let re = abs(getRealByOutputIndex(index));
        let im = abs(getImagByOutputIndex(index));
        let mx = max(re, im);

        // The length function in wgsl may be not underflow-safe on some GPUs.
        // So the safe solution is to ensure underflow-safety in all cases.
        setOutputAtIndex(index, select(mx * length(vec2<f32>(1, min(re, im)/mx)), 0.0, mx == 0.0));
      }
    }
  `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function kye(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.tensorMap.get(s.dataId),i=new Cye(s.shape),o=[oD(s,r.complexTensorInfos.real),oD(s,r.complexTensorInfos.imag)];return n.runWebGPUProgram(i,o,o[0].dtype)}const Nye={kernelName:pE,backendName:"webgpu",kernelFunc:kye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Tye=class{constructor(e){this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=ma(e,1),this.variableNames=e.map((n,s)=>`T${s}`),this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=e.length-1;for(let n=0;n<this.offsetLength;n++)this.uniforms+=`offset${n} : i32,`;this.shaderKey="concat"}getUserCode(){const e=[];if(this.offsetLength>0){e.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(let i=1;i<this.offsetLength;i++)e.push(`else if (yC < uniforms.offset${[i]}){ setOutputAtCoords(coords.x, coords.y, getT${i}(yR, yC - uniforms.offset${i-1})); }`);const s=this.offsetLength,r=this.offsetLength-1;e.push(`else { setOutputAtCoords(coords.x, coords.y, getT${s}(yR, yC - uniforms.offset${r})); }`)}else e.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return`
      ${Ke("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            let yR = coords.x;
            let yC = coords.y;

            ${e.join(`
        `)}
          }
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.tensorMap.get(s.dataId);return Xi({inputs:{x:r.complexTensorInfos.imag},backend:n})}const _ye={kernelName:ZE,backendName:"webgpu",kernelFunc:I1};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ug(t,e,n){const s=t[0].dtype;if(s==="complex64"){const m=t.map(S=>Ax({inputs:{input:S},backend:n})),g=t.map(S=>I1({inputs:{input:S},backend:n})),x=ug(m,e,n),y=ug(g,e,n),v=Gh({inputs:{real:x,imag:y},backend:n});return m.forEach(S=>n.disposeData(S.dataId)),g.forEach(S=>n.disposeData(S.dataId)),n.disposeData(x.dataId),n.disposeData(y.dataId),v}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const m=t.map(k=>{const _=[-1,be(k.shape.slice(e))];return wt({inputs:{x:k},backend:n,attrs:{shape:_}})}),g=m.map(k=>({vals:n.readSync(k.dataId),shape:k.shape})),x=ma(m.map(k=>k.shape),1),y=m[0].shape[0]===1,v=$0e(g,x,s,y),S=ma(t.map(k=>k.shape),e),C=n.makeTensorInfo(S,s,v);return m.forEach(k=>n.disposeData(k.dataId)),C}const i=n.device.limits.maxStorageBuffersPerShaderStage-1;if(t.length>i){const m=[];for(let x=0;x<t.length;x+=i){const y=t.slice(x,x+i);m.push(ug(y,e,n))}const g=ug(m,e,n);for(const x of m)n.disposeData(x.dataId);return g}const{tensors2D:o,outShape:a}=Eye(t,e,n),l=o.map(m=>m.shape),c=new Tye(l),d=[],h=new Array(l.length-1);if(h.length>0){h[0]=l[0][1],d.push({type:"int32",data:[h[0]]});for(let m=1;m<h.length;m++)h[m]=h[m-1]+l[m][1],d.push({type:"int32",data:[h[m]]})}const f=n.runWebGPUProgram(c,o,o[0].dtype,d);o.forEach(m=>n.disposeData(m.dataId));const p=wt({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeData(f.dataId),p}function Eye(t,e,n){const s=ma(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>wt({inputs:{x:i},backend:n,attrs:{shape:[be(i.shape.slice(0,e)),be(i.shape.slice(e))]}})),outShape:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TU(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=bs(r,e[0].shape)[0],o=e.map(c=>c.shape);rR(o,i);const a=ma(e.map(c=>c.shape),i);if(be(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>be(c.shape)>0);return l.length===1?Xi({inputs:{x:l[0]},backend:n}):ug(l,i,n)}const $ye={kernelName:mE,backendName:"webgpu",kernelFunc:TU};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iye(t,e,n,s,r=!1,i=null,o=!1,a=4,l=4,c=4){const d=R=>{switch(R){case 1:return"resData = f32(x[xIndex]);";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = vec4<f32>(x[xIndex / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},h=R=>{switch(R){case 1:return"return f32(W[row * uniforms.wShape[3] + col]);";case 4:return"return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},f=t?`
      let coord = vec4<i32>(batch, xRow, xCol, xCh);
      `:`
      let coord = vec4<i32>(batch, xCh, xRow, xCol);
      `,p=t?`
      let coords = vec4<i32>(
        batch,
        row / outWidth,
        row % outWidth,
        col);
      `:`
      let coords = vec4<i32>(
        batch,
        row,
        col / outWidth,
        col % outWidth);
      `,m=t?"uniforms.xShape[1]":"uniforms.xShape[2]",g=t?"uniforms.xShape[2]":"uniforms.xShape[3]",x=t?"row":"col",y=t?"col":"row",v=`
      let inChannels = uniforms.wShape[2];
      let outWidth = ${t?"uniforms.outShape[2]":"uniforms.outShape[3]"};
      let outRow = ${x} / outWidth;
      let outCol = ${x} % outWidth;

      let WRow = ${y} / (uniforms.filterDims[1] * inChannels);
      let WCol = ${y} / inChannels % uniforms.filterDims[1];
      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];
      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];
      let xCh = ${y} % inChannels;
      var resData = ${tn(a)}(0.0);
      // The bounds checking is always needed since we use it to pad zero for
      // the 'same' padding type.
      if (xRow >= 0 && xRow < ${m} && xCol >= 0 && xCol < ${g}) {
        ${f}
        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);
        ${d(a)}
      }
      return resData;`,S=t?e&&s?`
      ${v}`:`
      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${v}
      }
      return ${tn(a)}(0.0);`:s&&n?`
      ${v}`:`
      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {
        ${v}
      }
      return ${tn(a)}(0.0);`,C=`${h(l)}`,k=tn(c),T=tn(t?a:l),_=tn(t?l:a);return`
      ${Mc(i,o,c===4,4)}
      fn mm_readA(batch: i32, row : i32, col : i32) -> ${T} {
        ${t?S:C}
      }

      fn mm_readB(batch: i32, row : i32, col : i32) -> ${_} {
        ${t?C:S}
      }

      fn mm_write(batch: i32, row : i32, col : i32, valueIn : ${k}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)
        {
        var value = valueIn;
        let outWidth = ${t?"uniforms.outShape[2]":"uniforms.outShape[3]"};
        ${p}
        ${Hh(r,i)}
        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }`}class Rye{constructor(e,n,s,r,i=!1,o=null,a=!1,l=!1){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=((e.inChannels%4===0||e.inChannels%3===0)&&this.isChannelsLast||e.outWidth%4===0&&!this.isChannelsLast)&&e.outChannels%4===0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=dU(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=hU(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.outputComponent=4,this.isChannelsLast&&e.inChannels%4!==0?(this.innerElementSize=3,this.variableComponents=[1,4]):(this.innerElementSize=4,this.variableComponents=[4,4]),i&&(this.variableNames.push("bias"),this.variableComponents.push(4)),a&&(this.variableNames.push("preluActivationWeights"),this.variableComponents.push(4))):(this.innerElementSize=this.elementsPerThread[0],i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=l,this.addBias=i,this.activation=o,this.hasPreluActivationWeights=a,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=n%this.tileAOuter===0,this.fitBOuter=s%this.tileBOuter===0,this.fitInner=r%this.tileInner===0,this.shaderKey=`conv2DMM_${this.elementsPerThread}_${this.activation}}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.innerElementSize}_${this.isChannelsLast}_${this.sequentialAccessByThreads}`}getUserCode(){const e=this.isVec4?_1(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):E1(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),n=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return`
    ${Iye(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,n[0],n[1],n[2])}
    ${e}
  `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pye{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=n,this.activation=s,this.hasPreluActivationWeights=r,n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`conv2dnaive_${this.activation}_${this.isChannelsLast}`}getUserCode(){return`
       ${Mc(this.activation,this.hasPreluActivationWeights,!1,4)}
       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{
         let coords = vec4<i32>(batch, row, col, chan);
         if (coordsInBounds4D(coords, uniforms.xShape)) {
           return  getX(batch, row, col, chan);
         } else {
          return 0.0;
         }
       }
       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{
         let coords = vec4<i32>(row, col, xChannel, outChannel);
         if(coordsInBounds4D(coords, uniforms.wShape)) {
           return getW(row, col, xChannel, outChannel);
          } else {
            return 0.0;
          }
       }
       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {
         let coords = ${this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);"}
         if (coordsInBounds4D(coords, uniforms.outShape)) {
           var value = valueIn;
           ${Hh(this.addBias,this.activation)}
           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);
         }
       }
       ${Ke("index")} {
         let coords = getOutputCoords();
         let batch = coords[0];
         let outChannel = ${this.isChannelsLast?"coords[3];":"coords[1];"}
         let outRow = ${this.isChannelsLast?"coords[1];":"coords[2];"}
         let outCol = ${this.isChannelsLast?"coords[2];":"coords[3];"}
         var acc : f32 = 0.0;
         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {
           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {
             let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * row - uniforms.pads[0];
             let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * col - uniforms.pads[1];
             for (var xChannel = 0; xChannel < ${this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"} xChannel = xChannel + 1) {
               ${this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);"}
               let f = readFilt(row, col, xChannel, outChannel);
               acc = acc + v * f;
             }
           }
         }
         writeResult(batch, outRow, outCol, outChannel, acc);
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aye{constructor(e,n){this.variableNames=["x"],this.uniforms=`pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,
       inChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=n,this.shaderKey=`im2col_${this.isChannelsLast}`}getUserCode(){const e=this.isChannelsLast?1:2,n=this.isChannelsLast?2:3,s=this.isChannelsLast?"coords[1]":"coords[2]",r=this.isChannelsLast?"coords[2]":"coords[1]",i=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return`
    ${Ke("index")} {
      let coords = getCoordsFromIndex(index);
      if(index < uniforms.size) {
        let batch = coords[0];
        let row = ${s};
        let col = ${r};
        let offsetY = (row / uniforms.outWidth) * uniforms.strides[0] - uniforms.pads[0];
        let xRow = offsetY + uniforms.dilations[0] * (col / uniforms.itemsPerBlockRow);
        var value = 0.0;
        if(xRow < uniforms.xShape[${e}] && xRow >= 0) {
          let offsetX = (row % uniforms.outWidth) * uniforms.strides[1] -
              uniforms.pads[1];
          let xCol = offsetX + uniforms.dilations[1] * ((col %
              uniforms.itemsPerBlockRow) / uniforms.inChannels);
          let ch = col % uniforms.inChannels;
          if(xCol < uniforms.xShape[${n}] && xCol >= 0) {
            value = ${i};
          }
        }
        setOutputAtIndex(index, value);
      }
    }
   `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wb(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function jye({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=n.dataFormat==="channelsLast",c=!l,d=!1,h=l&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&n.padInfo.type==="VALID",f=[];let p,m;if(h){const y=n.inHeight*n.inWidth*n.inChannels;p=wt({inputs:{x:t},backend:s,attrs:{shape:[1,n.batchSize,y]}}),m=wt({inputs:{x:e},backend:s,attrs:{shape:[1,y,n.outChannels]}})}else p=wt({inputs:{x:t},backend:s,attrs:{shape:l?[n.batchSize,n.inHeight*n.inWidth,n.inChannels]:[n.batchSize,n.inChannels,n.inHeight*n.inWidth]}}),m=wt({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});if(f.push(p),f.push(m),i!=null){const y=Wb(i.shape,l);y!=null&&(i=wt({inputs:{x:i},backend:s,attrs:{shape:y}}),f.push(i))}if(r!=null){const y=Wb(r.shape,l);y!=null&&(r=wt({inputs:{x:r},backend:s,attrs:{shape:y}}),f.push(r))}const g=$1({a:l?p:m,b:l?m:p,transposeA:c,transposeB:d,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),x=wt({inputs:{x:g},backend:s,attrs:{shape:n.outShape}});f.push(g);for(const y of f)s.disposeData(y.dataId);return x}function Dye({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:d,strideWidth:h,strideHeight:f,padInfo:p,outWidth:m,outHeight:g,dilationWidth:x,dilationHeight:y,dataFormat:v}=n,S=v==="channelsLast",C=l*c*d,k=g*m,T=S?[n.batchSize,k,C]:[n.batchSize,C,k],_=new Aye(T,S),$=[{type:"int32",data:[p.top,p.left]},{type:"int32",data:[f,h]},{type:"int32",data:[y,x]},{type:"int32",data:[m]},{type:"int32",data:[d*l]},{type:"int32",data:[d]}],R=s.runWebGPUProgram(_,[t],t.dtype,$),A=[];A.push(R);const j=wt({inputs:{x:e},backend:s,attrs:{shape:[1,C,-1]}});if(A.push(j),i!=null){const z=Wb(i.shape,S);z!=null&&(i=wt({inputs:{x:i},backend:s,attrs:{shape:z}}),A.push(i))}if(r!=null){const z=Wb(r.shape,S);z!=null&&(r=wt({inputs:{x:r},backend:s,attrs:{shape:z}}),A.push(r))}const M=$1({a:S?R:j,b:S?j:R,transposeA:!S,transposeB:!1,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),q=wt({inputs:{x:M},backend:s,attrs:{shape:n.outShape}});A.push(M);for(const z of A)s.disposeData(z.dataId);return q}function _U({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=r!=null,c=i!=null,d=n.dataFormat==="channelsLast",h=d&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&n.padInfo.type==="VALID",f=ue().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!f&&(h||n.filterHeight===1&&n.filterWidth===1&&n.dilationHeight===1&&n.dilationWidth===1&&n.strideHeight===1&&n.strideWidth===1&&(n.padInfo.type==="SAME"||n.padInfo.type==="VALID")))return jye({x:t,filter:e,convInfo:n,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});const p=ue().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),m=p>-1?p:s.thresholdToIncreaseWorkgroups,g=n.batchSize*Math.ceil(n.outHeight*n.outWidth/32)*Math.ceil(n.outChannels/32);if(ue().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||g<=m)return Dye({x:t,filter:e,convInfo:n,backend:s,bias:r,preluActivationWeights:i,leakyreluAlpha:o,activation:a});let x;const y=[n.padInfo.top,n.padInfo.left],v=[{type:"int32",data:[n.filterHeight,n.filterWidth]},{type:"int32",data:[...y]},{type:"int32",data:[n.strideHeight,n.strideWidth]},{type:"int32",data:[n.dilationHeight,n.dilationWidth]}];if(f)x=new Pye(n,l,a,c);else{const T=d?n.outHeight*n.outWidth:n.outChannels,_=d?n.outChannels:n.outHeight*n.outWidth,$=n.filterHeight*n.filterWidth*n.inChannels;v.push({type:"int32",data:[T]},{type:"int32",data:[_]},{type:"int32",data:[$]});const R=s.adapterInfo.isIntel();x=new Rye(n,T,_,$,l,a,c,R)}const S=[],C=[t,e];l&&(!d&&r.shape.length===1&&(r=wt({inputs:{x:r},backend:s,attrs:{shape:[r.shape[0],1,1]}}),S.push(r)),C.push(r)),c&&(!d&&i.shape.length===1&&(i=wt({inputs:{x:i},backend:s,attrs:{shape:[i.shape[0],1,1]}}),S.push(i)),C.push(i)),a==="leakyrelu"&&(v.push({type:"float32",data:[o]}),x.uniforms+=" alpha : f32,");const k=s.runWebGPUProgram(x,C,t.dtype,v);for(const T of S)s.disposeData(T.dataId);return k}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(t){const{inputs:e,attrs:n,backend:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:d}=n,h=el(l),f=sr(r.shape,i.shape,o,c,a,d,!1,h);return _U({x:r,filter:i,convInfo:f,backend:s})}const Fye={kernelName:gE,backendName:"webgpu",kernelFunc:Oye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Mye=class{constructor(e){this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!1,this.isVec4=!1,this.workPerThread=1,this.outputShape=e.inShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=this.isChannelsLast&&e.outChannels%4===0&&e.inChannels%4===0,this.isVec4?(this.workPerThread=2,this.outputComponent=4,this.workgroupSize=[4,4,4],this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1])):(this.size=!0,this.workPerThread=1,this.workgroupSize=[64,1,1],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize)),this.shaderKey=`conv2DDerInput_${this.isChannelsLast}_${this.isVec4}_${this.workPerThread}`}getUserCode(){const e=this.isChannelsLast?1:2,n=this.isChannelsLast?2:3,s=this.isChannelsLast?3:1,r=`
    ${Ke()} {
      let batch = i32(globalId.z) / uniforms.outShape[1];
      let r = i32(globalId.z) % uniforms.outShape[1];
      let c = i32(globalId.y) * ${this.workPerThread};
      let d1 = i32(globalId.x) * 4;

      let dyCorner = vec2<i32>(r, c) - uniforms.pads;

      // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
      // ? = to be determined. : = across all values in that axis.
      var dotProd: array<vec4<f32>, ${this.workPerThread}>;
      for (var i = 0; i < ${this.workPerThread}; i++) {
        dotProd[i] = vec4<f32>(0.0);
      }
      for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
        let dyR = f32(dyCorner.x + wR) / f32(uniforms.strides.x);
        let wRPerm = uniforms.filterDims.x - 1 - wR;
        if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) ||
            fract(dyR) > 0.0) {
          continue;
        }
        let idyR = i32(dyR);

        for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
          let dyC = f32(dyCorner.y + wC) / f32(uniforms.strides.y);
          let dyC2 = f32(dyCorner.y + 1 + wC) / f32(uniforms.strides.y);
          let wCPerm = uniforms.filterDims.y - 1 - wC;
          var bDyCVal = true;
          var bDyCVal2 = true;
          if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
              fract(dyC) > 0.0) {
            bDyCVal = false;
          }
          if (dyC2 < 0.0 || dyC2 >= f32(uniforms.outBackprop[2]) ||
              fract(dyC2) > 0.0) {
            bDyCVal2 = false;
          }

          let idyC = i32(dyC);
          let idyC2 = i32(dyC2);
          if (bDyCVal && bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
              xValue = getDy(batch, idyR, idyC2, d2);
              dotProd[1] = dotProd[1] + vec4<f32>(dot(xValue, wValue0),
                                                  dot(xValue, wValue1),
                                                  dot(xValue, wValue2),
                                                  dot(xValue, wValue3));
            }
          } else if (bDyCVal) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
            }
          } else if (bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC2, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[1] = dotProd[1] + tmpval;
            }
          }
        }
      }

      for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
        let coords = vec4<i32>(batch, r, c + i, d1);
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], dotProd[i]);
        }
      }
    }
    `;return this.isVec4?`
    ${r}
    `:`
    ${Ke("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[${s}];

        let dyCorner = vec2<i32>(coords[${e}], coords[${n}]) - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.strides.x);
          let wRPerm = uniforms.filterDims.x - 1 - wR;
          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||
              wRPerm < 0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.strides.y);
            let wCPerm = uniforms.filterDims.y - 1 - wC;
            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
                fract(dyC) > 0.0 || wCPerm < 0) {
              continue;
            }
            let idyC = i32(dyC);

            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {
              let xValue = ${this.isChannelsLast?"getDy(batch, idyR, idyC, d2)":"getDy(batch, d2, idyR, idyC)"};
              let wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd = dotProd + xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Lye=class{constructor(e){this.variableNames=["x","dy"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",this.shaderKey=`conv2DDerFilter_${this.isChannelsLast}`}getUserCode(){return`
    ${Ke("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let d2 = coords[3];

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b = b + 1) {
          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];
            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              if (${this.isChannelsLast}) {
                let dyValue = getDy(b, yR, yC, d2);
                let xValue = getX(b, xR, xC, d1);
                dotProd = dotProd + xValue * dyValue;
              } else {
                let dyValue = getDy(b, d2, yR, yC);
                let xValue = getX(b, d1, xR, xC);
                dotProd = dotProd + xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Bye=class{constructor(e){this.variableNames=["x","dy"],this.uniforms=`pads : vec3<i32>, strides : vec3<i32>, batchSize : i32, outDepth : i32,
       outHeight : i32, outWidth : i32, inDepth : i32, inHeight : i32, inWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerFilter"}getUserCode(){return`
    ${Ke("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wF = coords.x;
        let wR = coords.y;
        let wC = coords.z;
        let d1 = coords.w;
        let d2 = coords.u;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yF = 0; yF < uniforms.outDepth; yF++) {
            let xF = wF + yF * uniforms.strides[0] - uniforms.pads[0];
            if (xF < 0 || xF >= uniforms.inDepth) {
              continue;
            }

            for (var yR = 0; yR < uniforms.outHeight; yR++) {
              let xR = wR + yR * uniforms.strides[1] - uniforms.pads[1];
              if (xR < 0 || xR >= uniforms.inHeight) {
                continue;
              }

              for (var yC = 0; yC < uniforms.outWidth; yC++) {
                let xC = wC + yC * uniforms.strides[2] - uniforms.pads[2];
                if (xC < 0 || xC >= uniforms.inWidth) {
                  continue;
                }

                let dyValue = getDy(b, yF, yR, yC, d2);
                let xValue = getX(b, xF, xR, xC, d1);
                dotProd += xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},Vye=class{constructor(e){this.variableNames=["dy","W"],this.uniforms=`filterDims : vec3<i32>, pads : vec3<i32>, strides : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32, outChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerInput"}getUserCode(){return`
    ${Ke("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let d1 = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyFCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let dyF = f32(dyFCorner + wF) / f32(uniforms.strides[0]);
          if (dyF < 0.0 || dyF >= f32(uniforms.outDepth) || fract(dyF) > 0.0) {
            continue;
          }
          let idyF = i32(dyF);

          let wFPerm = uniforms.filterDims[0] - 1 - wF;

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            let wRPerm = uniforms.filterDims[1] - 1 - wR;

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let wCPerm = uniforms.filterDims[2] - 1 - wC;

              for (var d2 = 0; d2 < uniforms.outChannels; d2++) {
                let xValue = getDy(batch, idyF, idyR, idyC, d2);
                let wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:d}=s,h=el(l),f=sr(r.shape,d,o,1,a,c,!1,h),p=new Lye(f),m=[{type:"int32",data:[f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.batchSize]},{type:"int32",data:[f.outHeight]},{type:"int32",data:[f.outWidth]},{type:"int32",data:[f.inHeight]},{type:"int32",data:[f.inWidth]}];return n.runWebGPUProgram(p,[r,i],r.dtype,m)}const Wye={kernelName:xE,backendName:"webgpu",kernelFunc:zye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uye(t=4){const e=i=>{switch(i){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return`
            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);
            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);
            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);
            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];
            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];
            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];
            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];
            return vec4<f32>(v0, v1, v2, v3);
            `;default:throw new Error(`innerElementSize ${i} is not supported.`)}},s=`if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${`
      let outRow = row / uniforms.outShape[2];
      let outCol = row % uniforms.outShape[2];

      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];
      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.strides[0]);
      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.strides[1]);
      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {
        return ${tn(t)}(0.0);
      }
      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {
        return ${tn(t)}(0.0);
      }
      let coord = vec4<i32>(
          batch,
          i32(xR),
          i32(xC),
          col % uniforms.outBackprop[3]);
      return x[getIndexFromCoords4D(coord, uniforms.xShape)/${t}];`}
      }
      return ${tn(t)}(0.0);`;return`
  fn mm_readA(batch: i32, row : i32, col : i32) -> ${tn(t)} {
    ${s}
  }

  fn mm_readB(batch: i32, row : i32, col : i32) -> ${tn(t)} {
    let coordX = uniforms.filterDims.x - 1 -
        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
    let coordY = uniforms.filterDims.y - 1 -
        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];
    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&
        coordX >= 0 && coordY >= 0) {
      let rowInner = row % uniforms.outBackprop[3];
      let coord = vec4<i32>(coordX, coordY, col, rowInner);
      ${e(t)}
    }
    return ${tn(t)}(0.0);
  }

  fn mm_write(batch: i32, row : i32, col : i32, valueInput : ${tn(t)}) {
    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
      var value = valueInput;
      let outCoord = vec4<i32>(
          batch,
          row / uniforms.outShape[2],
          row % uniforms.outShape[2],
          col);
      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/${t}] = value;
    }
  }`}class Hye{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.inShape,O(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),this.isVec4=e.inChannels%4===0&&e.outChannels%4===0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=dU(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=hU(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.outputComponent=4,this.variableComponents=[4,1]),this.shaderKey=`conv2DDerInputMM_${this.isVec4}_${this.elementsPerThread}`}getUserCode(){const e=this.isVec4?_1(this.elementsPerThread,this.workgroupSize):E1(this.elementsPerThread,this.workgroupSize);return`
    ${Uye(this.isVec4?4:1)}
    ${e}
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:d}=s,h=el(c),f=sr(o,i.shape,a,1,l,d,!1,h),p=[{type:"int32",data:[f.filterHeight,f.filterWidth]},{type:"int32",data:[f.filterHeight-1-f.padInfo.top,f.filterWidth-1-f.padInfo.left]},{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.batchSize,f.outHeight,f.outWidth,f.outChannels]}];let m;if(ue().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||f.dataFormat!=="channelsLast")m=new Mye(f);else{m=new Hye(f);const g=f.inHeight*f.inWidth,x=f.inChannels,y=f.filterHeight*f.filterWidth*f.outChannels;p.push({type:"uint32",data:[g]},{type:"uint32",data:[x]},{type:"uint32",data:[y]})}return n.runWebGPUProgram(m,[r,i],"float32",p)}const Kye={kernelName:yE,backendName:"webgpu",kernelFunc:Gye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qye{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims: vec3<i32>, pads: vec3<i32>, strides: vec3<i32>, dilations: vec3<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3dnaive"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords.x;
        let d2 = coords.u;

        let xFRCCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
        let xFCorner = xFRCCorner.x;
        let xRCorner = xFRCCorner.y;
        let xCCorner = xFRCCorner.z;

        let inputDepthNearestVec4 = (uniforms.xShape.u / 4) * 4;
        let inputDepthVec4Remainder = uniforms.xShape.u % 4;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let xF = xFCorner + wF * uniforms.dilations[0];
          if (xF < 0 || xF >= uniforms.xShape.y) {
            continue;
          }

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let xR = xRCorner + wR * uniforms.dilations[1];
            if (xR < 0 || xR >= uniforms.xShape.z) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let xC = xCCorner + wC * uniforms.dilations[2];
              if (xC < 0 || xC >= uniforms.xShape.w) {
                continue;
              }

              for (var d1 = 0; d1 < inputDepthNearestVec4; d1 += 4) {
                let xValues = vec4<f32>(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                let wValues = vec4<f32>(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (inputDepthVec4Remainder == 1) {
                dotProd += getX(batch, xF, xR, xC, inputDepthNearestVec4) *
                  getW(wF, wR, wC, inputDepthNearestVec4, d2);
              } else if (inputDepthVec4Remainder == 2) {
                let xValues = vec2<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1)
                );
                let wValues = vec2<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (inputDepthVec4Remainder == 3) {
                let xValues = vec3<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2)
                );
                let wValues = vec3<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }`}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=ad(r.shape,i.shape,o,l,a),d=[c.padInfo.front,c.padInfo.top,c.padInfo.left],h=[{type:"int32",data:[c.filterDepth,c.filterHeight,c.filterWidth]},{type:"int32",data:[...d]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationDepth,c.dilationHeight,c.dilationWidth]}],f=new qye(c),p=wi(r.dtype,i.dtype);return n.runWebGPUProgram(f,[r,i],p,h)}const Yye={kernelName:vE,backendName:"webgpu",kernelFunc:Xye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,c=ad(r.shape,l,o,1,a),d=new Bye(c),h=[{type:"int32",data:[c.padInfo.front,c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.batchSize]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.inDepth]},{type:"int32",data:[c.inHeight]},{type:"int32",data:[c.inWidth]}];return n.runWebGPUProgram(d,[r,i],i.dtype,h)}const Zye={kernelName:Mz,backendName:"webgpu",kernelFunc:Qye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,pad:a,inputShape:l}=s,c=ad(l,i.shape,o,1,a),d=new Vye(c),h=[{type:"int32",data:[c.filterDepth,c.filterHeight,c.filterWidth]},{type:"int32",data:[c.filterDepth-1-c.padInfo.front,c.filterHeight-1-c.padInfo.top,c.filterWidth-1-c.padInfo.left]},{type:"int32",data:[c.strideDepth,c.strideHeight,c.strideWidth]},{type:"int32",data:[c.outDepth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"int32",data:[c.outChannels]}];return n.runWebGPUProgram(d,[r,i],r.dtype,h)}const eve={kernelName:bE,backendName:"webgpu",kernelFunc:Jye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tve=Tn({opType:Ge.COS}),nve={kernelName:wE,backendName:"webgpu",kernelFunc:tve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sve=Tn({opType:Ge.COSH}),rve={kernelName:SE,backendName:"webgpu",kernelFunc:sve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ive=class{constructor(e,n,s,r){this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;const[i]=n;this.outputShape=[i,s[0],s[1],e],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId=r==="bilinear"?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey=`cropAndResize_${this.methodId}_${this.cropHeightBiggerThan1}_${this.cropWidthBiggerThan1}`}getUserCode(){const[e,n]=["f32(uniforms.imageShape[1] - 1)","f32(uniforms.imageShape[2] - 1)"],[s,r,i]=this.cropHeightBiggerThan1?[`(${e} / f32(uniforms.outShape[1] - 1))`,"(y2-y1) * height_ratio",`y1*${e} + f32(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${e}`],[o,a,l]=this.cropWidthBiggerThan1?[`(${n} / f32(uniforms.outShape[2] - 1))`,"(x2-x1) * width_ratio",`x1*${n} + f32(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${n}`];return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let height_ratio = f32(${s});
        let width_ratio = f32(${o});
        let b = coords[0];
        let y = coords[1];
        let x = coords[2];
        let d = coords[3];
        // get box vals
        let y1 = getBoxes(b, 0);
        let x1 = getBoxes(b, 1);
        let y2 = getBoxes(b, 2);
        let x2 = getBoxes(b, 3);
        // get image in batch index
        let bInd = i32(round(getBoxInd(b)));
        if(bInd < 0 || bInd >= uniforms.outShape[0]) {
          return;
        }
        let height_scale = ${r};
        let width_scale = ${a};
        let in_y = ${i};
        if( in_y < 0.0 || in_y > ${e} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let in_x = ${l};
        if( in_x < 0.0 || in_x > ${n} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let sourceFracIndexCR = vec2<f32>(in_x,in_y);
        if(${this.methodId} == 1) {
          // Compute the four integer indices.
          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);
          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));
          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);
          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);
          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);
          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);
          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);
          let top = topLeft + (topRight - topLeft) * fracCR.x;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          let newValue = top + (bottom - top) * fracCR.y;
          setOutputAtIndex(index, newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          let sourceNearestCR = vec2<i32>(floor(
            sourceFracIndexCR + vec2<f32>(0.5,0.5)));
          let newValue = getImage(
            bInd, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutputAtIndex(index, newValue);
        }
      }
    }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ove=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,d=new ive(r.shape[3],i.shape,a,l),h=[{type:"float32",data:[c]}];return n.runWebGPUProgram(d,[r,i,o],"float32",h)},ave={kernelName:NE,backendName:"webgpu",kernelFunc:ove};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $0;(function(t){t.Prod="*",t.Sum="+"})($0||($0={}));let aD=class{constructor(e,n,s,r){this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=n,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=s,this.reverse=r,this.op=e,this.shaderKey=`cum_${this.op}_${this.exclusive}_${this.reverse}`}getUserCode(){const e=this.outputShape.length,n=this.op===$0.Prod?"1.0":"0.0",s=this.exclusive?n:`getX(${lD(e,"coords",this.op)})`,r=this.outputShape[this.outputShape.length-1];let i="",o="";return this.exclusive?(i=this.reverse?`end != ${r-1}`:"end != 0",o=this.reverse?"end + 1":"end - 1"):(i=this.reverse?`end + pow2 < ${r}`:"end >= pow2",o=this.reverse?"end + pow2":"end - pow2"),`
      ${Ke("index")} {
       if (index < uniforms.size) {
         var coords = getCoordsFromIndex(index);

         let end = ${cD(e,"coords",this.op)};
         var val = ${s};
         let pow2 = i32(pow(2.0, uniforms.index));
         if (${i}) {
           let idx = ${o};
           ${cD(e,"coords",this.op)} = idx;
           val ${this.op}= getX(${lD(e,"coords",this.op)});
         }
         setOutputAtIndex(index, val);
       }
      }
    `}};function lD(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function cD(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EU(t,e,n,s,r,i){const o=e.shape.length,a=Mr([s],o);let l=e;a!=null&&(l=Ol({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Lr(1,o)[0];if(c!==o-1)throw new Error(`WebGPU cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[c];let h=Xi({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(d))-1;f++){const p=new aD(t,l.shape,!1,i),m=h,g=[{type:"float32",data:[f]}];h=n.runWebGPUProgram(p,[h],h.dtype,g),n.disposeData(m.dataId)}if(r){const f=new aD(t,l.shape,r,i),p=h,m=[{type:"float32",data:[0]}];h=n.runWebGPUProgram(f,[h],h.dtype,m),n.disposeData(p.dataId)}if(a!=null){const f=$x(a),p=Ol({inputs:{x:h},backend:n,attrs:{perm:f}});return n.disposeData(h.dataId),n.disposeData(l.dataId),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return EU($0.Prod,r,n,i,o,a)}const cve={kernelName:CE,backendName:"webgpu",kernelFunc:lve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return EU($0.Sum,r,n,i,o,a)}const dve={kernelName:kE,backendName:"webgpu",kernelFunc:uve};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s,l=r.shape.length===1,d=be(i.shape)>0,h=i.dtype,f=l?[r.shape[0]]:[r.shape[0],r.shape[1]],p=l?[o]:[r.shape[0],o],m=vi({backend:n,attrs:{shape:p,value:0,dtype:h}}),g=new kU(f,d,a),x=[{type:"int32",data:[o]}],y=d?[r,i]:[r];return n.runWebGPUProgram(g,y,h,x,m)}const fve={kernelName:TE,backendName:"webgpu",kernelFunc:hve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let pve=class{constructor(e,n){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`depthToSpace_${n}`,this.dataFormat=n}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let h = ${this.getHeightCoordString()};
          let w = ${this.getWidthCoordString()};
          let d = ${this.getDepthCoordString()};

          let in_h = h / uniforms.blockSize;
          let offset_h = h % uniforms.blockSize;
          let in_w = w / uniforms.blockSize;
          let offset_w = w % uniforms.blockSize;
          let offset_d = (offset_h * uniforms.blockSize + offset_w) *
            ${this.getOutputDepthSize()};
          let in_d = d + offset_d;

          let rlt = ${this.getInputSamplingString()};
          setOutputAtIndex(index, rlt);
        }
      }`}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?"uniforms.outShape[3]":"uniforms.outShape[1]"}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,f=c*i,p=d/(i*i),m=o==="NHWC"?[a,h,f,p]:[a,p,h,f],g=[{type:"int32",data:[i]}],x=new pve(m,o);return n.runWebGPUProgram(x,[r],r.dtype,g)}const gve={kernelName:_E,backendName:"webgpu",kernelFunc:mve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xve{constructor(e,n,s,r=!1,i=null,o=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=e,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.addBias=r,this.activation=i,this.hasPreluActivation=o,this.filterHeight=n,this.filterWidth=s,this.shaderKey=`depthwiseNCHW_${this.activation}_${this.filterHeight}_${this.filterWidth}`}getUserCode(){const e=this.filterWidth*this.filterHeight,n=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],s=this.workgroupSize[1]+this.filterHeight-1,r=this.workgroupSize[0]+this.filterWidth-1;return`
      ${Mc(this.activation,this.hasPreluActivation,!1,4)}

      var<workgroup> mm_Asub : array<array<f32, ${r}>, ${s}>;
      var<workgroup> mm_Bsub : array<array<f32, ${this.filterWidth}>, ${this.filterHeight}>;
      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {
        var value = 0.0;
        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])
        {
          value = getX(batch, channel, row, col);
        }
        return value;
      }

      ${Ke()} {
        let coords = getOutputCoords();
        let batch = coords[0];
        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pads;
        let channelMul = uniforms.wShape[3];
        let d1 = coords[1] / channelMul;
        let q = coords[1] % channelMul;

        let inputRowStart = xRCCorner.x;
        let inputColStart = xRCCorner.y;

        let localRow = i32(localId.y);
        let localCol = i32(localId.x);

        // Load one tile of X into local memory.
        for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${this.workgroupSize[1]}) {
          for (var inputCol = localCol; inputCol < ${r}; inputCol = inputCol + ${this.workgroupSize[0]}) {
            let rowOffset = inputRow - localRow;
            let colOffset = inputCol - localCol;
            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);
          }
        }

        // Load one tile of W into local memory.
        var wIndex = i32(localIndex);
        ${e<n?`if (wIndex < ${e})`:`for(; wIndex < ${e}; wIndex = wIndex + ${n})`}

        {
          let wRow = wIndex / ${this.filterWidth};
          let wCol = wIndex % ${this.filterWidth};
          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);
        }

        workgroupBarrier();

        var value = 0.0;
        for (var wR = 0; wR < ${this.filterHeight}; wR = wR + 1) {
          for (var wC = 0; wC < ${this.filterWidth}; wC = wC + 1) {
            let xVal = mm_Asub[localRow + wR][localCol + wC];
            let wVal = mm_Bsub[wR][wC];
            value = fma(xVal, wVal, value);
          }
        }
        ${Hh(this.addBias,this.activation)}
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $U{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, virtualWidth : i32,",this.workgroupSize=[64,1,1],this.workPerThread=4,this.outputComponent=4,this.outputShape=e.outShape,this.virtualWidth=Math.ceil(this.outputShape[2]/this.workPerThread)*this.workPerThread;const i=[this.outputShape[0],this.outputShape[1],this.virtualWidth,this.outputShape[3]];this.dispatchLayout=at(i),this.dispatch=qe(this.dispatchLayout,i,this.workgroupSize,[this.outputComponent*this.workPerThread,1,1]),O(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=n,this.activation=s,this.hasPreluActivation=r,this.shaderKey=`depthwiseVec4_${s}_${this.convInfo.filterHeight}_${this.convInfo.filterWidth}_${this.convInfo.strideHeight}_${this.convInfo.strideWidth}_${this.workPerThread}`}getUserCode(){const e=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,n=this.convInfo.strideHeight,s=this.convInfo.strideWidth;return`
      ${Mc(this.activation,this.hasPreluActivation,!0,4)}
      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {
        var value = vec4<f32>(0.0);
        if (col >=0 && col < uniforms.inDims[1]) {
          value = getX(batch, row, col, channel);
        }
        return value;
      }

      ${Ke("index")} {
        let width0 = uniforms.outShape[3] / ${this.outputComponent};
        let d1 = (index % width0) * ${this.outputComponent};
        var index1 = index / width0;
        let width1 = uniforms.virtualWidth / ${this.workPerThread};
        let c = (index1 % width1) * ${this.workPerThread};
        index1 = index1 / width1;
        let r = index1 % uniforms.outShape[1];
        let batch = index1 / uniforms.outShape[1];

        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(${n}, ${s}) - uniforms.pads;

        let xRCorner = xRCCorner.x;
        let xCCorner = xRCCorner.y;
        var xVals : array<vec4<f32>, ${e}>;
        var dotProd : array<vec4<f32>, ${this.workPerThread}>;
        for (var i = 0; i < ${this.workPerThread}; i++) {
          dotProd[i] = vec4<f32>(0.0);
        }

        // Use constant instead of uniform can give better performance.
        for (var wR = 0; wR < ${this.convInfo.filterHeight}; wR = wR + 1) {
          let xR = xRCorner + wR;
          if (xR >=0 && xR < uniforms.inDims[0]) {
            for (var i = 0; i < ${e}; i++) {
              xVals[i] = readX(batch, xR, xCCorner + i, d1);
            }
            for (var wC = 0; wC < ${this.convInfo.filterWidth}; wC = wC + 1) {
              let wValue = getW(wR, wC, d1, 0);
              for (var i = 0; i < ${this.workPerThread}; i++) {
                dotProd[i] = fma(xVals[i * ${s} + wC], wValue, dotProd[i]);
              }
            }
          }
        }

        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let coords = vec4<i32>(batch, r, c + i, d1);
          if (coordsInBounds4D(coords, uniforms.outShape)) {
            var value = dotProd[i];
            ${Hh(this.addBias,this.activation)}
            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
          }
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let IU=class{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms=`pads : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,
      filterWidth : i32, strides : vec2<i32>, dilations : vec2<i32>,`,this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=n,this.activation=s,this.hasPreluActivation=r,this.shaderKey=`depthwise_${this.activation}_${this.isChannelsLast}`}getUserCode(){const e=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return`
      ${Mc(this.activation,this.hasPreluActivation,!1,4)}

      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let batch = coords[0];
          let xRCCorner = vec2<i32>(coords.${this.isChannelsLast?"yz":"zw"}) * uniforms.strides - uniforms.pads;
          let d2 = coords[${this.isChannelsLast?3:1}];
          let channelMul = uniforms.wShape[3];
          let d1 = d2 / channelMul;
          let q = d2 % channelMul;

          let inputRowStart = xRCCorner.x;
          let inputColStart = xRCCorner.y;
          let inputRowEnd = inputRowStart + uniforms.filterHeight *
              uniforms.dilations[0];
          let inputColEnd = inputColStart + uniforms.filterWidth *
              uniforms.dilations[1];

          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get
          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all
          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.
          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.
          var value = 0.0;

          // Extract if checking out of for loop for performance.
          if (inputRowStart >= 0 && inputColStart >= 0 &&
            inputRowEnd < uniforms.inDims[0] &&
                inputColEnd < uniforms.inDims[1]) {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            } else {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                if (xR < 0 || xR >= uniforms.inDims[0]) {
                  continue;
                }

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  if (xC < 0 || xC >= uniforms.inDims[1]) {
                    continue;
                  }

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            }
            ${Hh(this.addBias,this.activation)}
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:d}=s,h=el(l);let f=c;f==null&&(f=[1,1]);const p=sr(r.shape,i.shape,o,f,a,d,!0,h),m=[{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.inHeight,p.inWidth]}],g=p.dataFormat==="channelsLast";let x;return!g&&p.inHeight>16&&p.inWidth>16&&p.strideHeight===1&&p.strideWidth===1&&p.dilationWidth===1&&p.dilationHeight===1&&p.inChannels===p.outChannels?x=new xve(p.outShape,p.filterHeight,p.filterWidth):g&&p.outHeight>4&&p.outWidth>4&&p.strideWidth<=2&&p.inChannels===p.outChannels&&p.dilationHeight===1&&p.dilationWidth===1&&p.inChannels%4===0?(x=new $U(p),m.push({type:"int32",data:[x.virtualWidth]})):(x=new IU(p),m.push({type:"int32",data:[p.filterHeight]},{type:"int32",data:[p.filterWidth]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.dilationHeight,p.dilationWidth]})),n.runWebGPUProgram(x,[r,i],r.dtype,m)}const vve={kernelName:EE,backendName:"webgpu",kernelFunc:yve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let bve=class{constructor(e){this.variableNames=["x","dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>, outHeight : i32,
      outWidth : i32, inHeight : i32, inWidth : i32, batchSize : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_filter"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let dm = coords[3];
        let d2 = d1 * uniforms.channelMul + dm;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yR = 0; yR < uniforms.outHeight; yR++) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];

            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC++) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              let dyValue = getDy(b, yR, yC, d2);
              let xValue = getX(b, xR, xC, d1);
              dotProd += xValue * dyValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},wve=class{constructor(e){this.variableNames=["dy","W"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_input"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[3];
        let dyCorner = coords.yz - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }

          let idyR = i32(dyR);
          let wRPerm = uniforms.filterDims[0] - 1 - wR;

          for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }

            let idyC = i32(dyC);
            let wCPerm = uniforms.filterDims[1] - 1 - wC;

            for (var dm = 0; dm < uniforms.channelMul; dm++) {
              let d2 = d1 * uniforms.channelMul + dm;
              let xValue = getDy(batch, idyR, idyC, d2);
              let wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:d}=s,h=sr(r.shape,d,o,a,l,c,!0),f=new bve(h),p=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.filterHeight,h.filterWidth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"int32",data:[h.inHeight]},{type:"int32",data:[h.inWidth]},{type:"int32",data:[h.batchSize]},{type:"int32",data:[h.outChannels/h.inChannels]}];return n.runWebGPUProgram(f,[r,i],"float32",p)}const Cve={kernelName:$E,backendName:"webgpu",kernelFunc:Sve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:d}=s,h=sr(d,i.shape,o,a,l,c,!0),f=new wve(h),p=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.filterHeight-1-h.padInfo.top,h.filterWidth-1-h.padInfo.left]},{type:"int32",data:[h.filterHeight,h.filterWidth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"int32",data:[h.outChannels/h.inChannels]}];return n.runWebGPUProgram(f,[r,i],r.dtype,p)}const Nve={kernelName:IE,backendName:"webgpu",kernelFunc:kve};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Tve=class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,e],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);
          setOutputAtIndex(index, value);
        }
      }
    `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ve(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=be(s.shape),o=wt({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new Tve(i),l=n.runWebGPUProgram(a,[o],o.dtype),c=wt({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeData(o.dataId),n.disposeData(l.dataId),c}const Eve={kernelName:RE,backendName:"webgpu",kernelFunc:_ve};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let $ve=class{constructor(e){this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}getUserCode(){return`
       ${Ke("index")} {
         if (index < uniforms.size) {
           let neg_infinity = -3.4e38;
           let coords = getOutputCoords();
           let batch = coords.x;
           let d1 = coords.w;
           let outTopLeftCorner = coords.yz * uniforms.strides - uniforms.pads;
           let hBeg = outTopLeftCorner.x;
           let wBeg = outTopLeftCorner.y;

           var curVal = neg_infinity;
           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {
             let hIn = hBeg + h * uniforms.dilations[0];

             if (hIn >= 0 && hIn < uniforms.xShape[1]) {
               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {
                 let wIn = wBeg + w * uniforms.dilations[1];

                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {
                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);
                   if (val > curVal) {
                     curVal = val;
                   }
                 }
               }
             }
           }

           setOutputAtIndex(index, curVal);
         }
       }
     `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=_x(r.shape,i.shape,o,a,"NHWC",l),d=[c.padInfo.top,c.padInfo.left],h=[{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[...d]},{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]}],f=new $ve(c);return n.runWebGPUProgram(f,[r,i],r.dtype,h)}const Rve={kernelName:PE,backendName:"webgpu",kernelFunc:Ive};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pve{constructor(e,n){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.inShape,this.dispatchLayout=at(e.outShape),this.dispatch=qe(this.dispatchLayout,e.outShape,this.workgroupSize),n!=="float32"&&n!=="int32")throw new Error(`Dilation2DBackpropInput only supports float32 and int32
          types, does not support ${n} type.`);this.type=n,this.shaderKey="dilation2DBackpropInput"}getUserCode(){return`
       ${Ke("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var xRMax = 0;
           var xCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     xRMax = xR;
                     xCMax = xC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.xShape[3] *
               (xCMax + uniforms.xShape[2] * (xRMax + uniforms.xShape[1] * b));
           let value = getDy(b, r, c, d);
           ${ld("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}}class Ave{constructor(e,n,s){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.filterShape,this.dispatchLayout=at(e.outShape),this.dispatch=qe(this.dispatchLayout,e.outShape,this.workgroupSize),s!=="float32"&&s!=="int32")throw new Error(`Dilation2DBackpropFilter only supports float32 and int32
          types, does not support ${s} type.`);this.type=s,this.shaderKey="dilation2DBackpropFilter"}getUserCode(){return`
       ${Ke("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var wRMax = 0;
           var wCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     wRMax = wR;
                     wCMax = wC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.wShape[2] * (wCMax + wRMax * uniforms.wShape[1]);
           let value = getDy(b, r, c, d);
           ${ld("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,dy:o}=e,{strides:a,pad:l,dilations:c}=s,d=_x(r.shape,i.shape,a,l,"NHWC",c),h=i.dtype,f=new Ave(d,i.shape,h),p=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[be(d.outShape)]}],m=vi({backend:n,attrs:{shape:i.shape,value:0,dtype:h}});return n.runWebGPUProgram(f,[r,i,o],h,p,m)}const Dve={kernelName:Wne,backendName:"webgpu",kernelFunc:jve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ove(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,dy:o}=e,{strides:a,pad:l,dilations:c}=s,d=_x(r.shape,i.shape,a,l,"NHWC",c),h=r.dtype,f=new Pve(d,h),p=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[be(d.outShape)]}],m=vi({backend:n,attrs:{shape:d.inShape,value:0,dtype:h}});return n.runWebGPUProgram(f,[r,i,o],h,p,m)}const Fve={kernelName:zne,backendName:"webgpu",kernelFunc:Ove};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mve{constructor(e,n,s){this.variableNames=["Image"],this.uniforms="alpha: f32,",this.workgroupSize=[64,1,1],this.pixelsOpType=Bp.DRAW,this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.type=n,this.textureFormat=s,this.shaderKey=`draw_${n}_${s}`}getUserCode(){let e;const n=this.type==="float32"?"value":"value / 255.0";return e=`
      if (uniforms.numChannels == 1) {
        rgba[0] = ${n};
        rgba[1] = ${n};
        rgba[2] = ${n};
      } else {
        rgba[d] = ${n};
      }`,`
       @group(0) @binding(0) var outImage : texture_storage_2d<${this.textureFormat}, write>;
       ${Ke("index")} {
         if (index < uniforms.size) {
           var rgba = vec4<f32>(0.0, 0.0, 0.0, uniforms.alpha);
           for (var d = 0; d < uniforms.numChannels; d = d + 1) {
             let value = f32(inBuf[index * uniforms.numChannels + d]);
             ${e}
           }
           rgba.x = rgba.x * rgba.w;
           rgba.y = rgba.y * rgba.w;
           rgba.z = rgba.z * rgba.w;
           let coords = getCoordsFromIndex(index);
           textureStore(outImage, vec2<i32>(coords.yx), rgba);
         }
       }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use backend file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lve(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,[a,l]=r.shape.slice(0,2),{imageOptions:c}=o||{},d=(c==null?void 0:c.alpha)||1,h=n.device.features.has("bgra8unorm-storage")?"bgra8unorm":"rgba8unorm",f=[a,l],p=new Mve(f,r.dtype,h);i.width=l,i.height=a;const m="webgpu";let g=i.getContext(m),x;g||(x=new OffscreenCanvas(l,a),g=x.getContext(m));const y=r.shape.length===3?r.shape[2]:1;g.configure({device:n.device,format:h,usage:GPUTextureUsage.STORAGE_BINDING,alphaMode:"premultiplied"});const v="int32",S=n.makeTensorInfo(f,v),C=n.tensorMap.get(S.dataId);C.resource=g.getCurrentTexture(),C.external=!0;const k=[{type:"uint32",data:[y]},{type:"float32",data:[d]}];if(n.runWebGPUProgram(p,[r],v,k,S),x){const T=i.getContext("2d");if(!T)throw new Error("Please make sure this canvas has only been used for 2d or webgpu context!");T.drawImage(x,0,0)}return n.disposeData(S.dataId),r}const Bve={kernelName:Lz,backendName:"webgpu",kernelFunc:Lve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU=xr({opType:Bt.MUL,cpuKernelImpl:H0e,supportsComplex:!0}),Vve={kernelName:C$,backendName:"webgpu",kernelFunc:RU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return Kh(r,i,o,"sum",n)}const zve={kernelName:rI,backendName:"webgpu",kernelFunc:PU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wve(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=xR(r,i.length);vR(o.length,l,i);const{path:c,steps:d}=bR(a,l),h=d.length;let f=null,p=o.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:v}=yR(p,l[x]);let S;wR(y)?S=i[x]:(S=Ol({inputs:{x:i[x]},backend:n,attrs:{perm:y}}),m.push(S));const C=S.shape.slice();for(let k=0;k<v.length;++k)C.splice(v[k],0,1);Gn(S.shape,C)||(S=wt({inputs:{x:S},backend:n,attrs:{shape:C}}),m.push(S)),f===null?f=S:(f=RU({inputs:{a:S,b:f},backend:n}),m.push(f))}g<h-1&&(c[g]>=0&&(f=PU({inputs:{x:f},backend:n,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&n.disposeData(g.dataId);return f}const Uve={kernelName:jE,backendName:"webgpu",kernelFunc:Wve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hve=Tn({opType:Ge.ELU}),Gve={kernelName:DE,backendName:"webgpu",kernelFunc:Hve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kve=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=new Vb(Bt.ELU_DER,s.shape,r.shape);return n.runWebGPUProgram(i,[s,r],s.dtype)},qve={kernelName:Bz,backendName:"webgpu",kernelFunc:Kve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xve=xr({opType:Bt.EQUAL,dtype:"bool",cpuKernelImpl:I0e}),Yve={kernelName:FE,backendName:"webgpu",kernelFunc:Xve};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qve=Tn({opType:Ge.ERF}),Zve={kernelName:OE,backendName:"webgpu",kernelFunc:Qve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jve=Tn({opType:Ge.EXP,cpuKernelImpl:R0e,dtype:"float32"}),ebe={kernelName:ME,backendName:"webgpu",kernelFunc:Jve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fN(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(O(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),wt({inputs:{x:i},backend:s,attrs:{shape:a}})}const tbe={kernelName:LE,backendName:"webgpu",kernelFunc:fN};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nbe=Tn({opType:Ge.EXPM1,cpuKernelImpl:P0e}),sbe={kernelName:BE,backendName:"webgpu",kernelFunc:nbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let uD=class{constructor(e,n){this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=e,this.shaderKey=`fft_${e}`}getUserCode(){return`
    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {
      ${this.component==="real"?"return real * expR - imag * expI;":"return real * expI + imag * expR;"}
    }

    fn mulMatDFT(batch: i32, index: i32) -> f32 {
      let indexRatio = f32(index) / f32(uniforms.realShape[1]);
      let exponentMultiplierTimesIndexRatio =
          uniforms.exponentMultiplier * indexRatio;

      var result = 0.0;

      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {
        // x = (-2|2 * PI / N) * index * i;
        let x = exponentMultiplierTimesIndexRatio * f32(i);
        let expR = cos(x);
        let expI = sin(x);
        let real = getReal(batch, i);
        let imag = getImag(batch, i);

        result = result +
            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;
      }

      return result;
    }

    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));
      }
    }
  `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AU(t,e,n){const s=n.tensorMap.get(t.dataId),r=be(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=[],l=wt({inputs:{x:t},backend:n,attrs:{shape:[o,i]}});a.push(l);const c=l.shape,d=new uD("real",c),h=new uD("imag",c),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:c},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:c}],p=e?2*Math.PI:-2*Math.PI,m=e?c[1]:1,g=[{type:"float32",data:[p]},{type:"float32",data:[m]}],x=n.runWebGPUProgram(d,f,"float32",g);a.push(x);const y=n.runWebGPUProgram(h,f,"float32",g);a.push(y);const v=Gh({inputs:{real:x,imag:y},backend:n});a.push(v);const S=wt({inputs:{x:v},backend:n,attrs:{shape:t.shape}});return a.forEach(C=>n.disposeData(C.dataId)),S}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rbe(t){const{inputs:e,backend:n}=t,{input:s}=e;return AU(s,!1,n)}const ibe={kernelName:VE,backendName:"webgpu",kernelFunc:rbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let obe=class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let coordX = uniforms.xShape[2] - coords[2] - 1;
          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);
          setOutputAtIndex(index, outputValue);
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const abe={kernelName:WE,backendName:"webgpu",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new obe(n.shape);return s.runWebGPUProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lbe=Tn({opType:Ge.FLOOR,cpuKernelImpl:A0e}),cbe={kernelName:UE,backendName:"webgpu",kernelFunc:lbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ube=xr({opType:Bt.FLOOR_DIV,cpuKernelImpl:j0e,dtype:"int32"}),dbe={kernelName:HE,backendName:"webgpu",kernelFunc:ube};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let hbe=class{constructor(e,n,s=!1){this.pixelsOpType=Bp.FROM_PIXELS,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[n,1,1]),this.importVideo=s,this.shaderKey=`fromPixels_${this.importVideo}`}getUserCode(){const e=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return`
      @binding(1) @group(0) var src: ${this.importVideo?"texture_external":"texture_2d<f32>"};
      ${Ke("index")} {
        let flatIndex = index * uniforms.numChannels;
        if (flatIndex < uniforms.size) {
          let coords = getCoordsFromIndex(flatIndex);
          let values = ${e};
          for (var i = 0; i < uniforms.numChannels; i = i + 1) {
            result[flatIndex + i] = i32(floor(255.0 * values[i]));
          }
        }
      }
  `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use backend file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fbe={kernelName:_b,backendName:"webgpu",kernelFunc:pbe};let uf,tS=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function pbe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s;if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");const o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,l=typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas,c=typeof ImageBitmap<"u"&&r instanceof ImageBitmap,[d,h]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],f=[h,d,i],p=ue().getBool("WEBGPU_IMPORT_EXTERNAL_TEXTURE")&&o,m=o||a;if(c||l||m){let v;if(p)v=n.device.importExternalTexture({source:r});else{if(m){const L=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(uf==null||L!==tS)&&(tS=L,uf=document.createElement("canvas").getContext("2d",{willReadFrequently:tS})),uf.canvas.width=d,uf.canvas.height=h,uf.drawImage(r,0,0,d,h),r=uf.canvas}const A=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,F=n.textureManager.acquireTexture(f[1],f[0],"rgba8unorm",A);n.queue.copyExternalImageToTexture({source:r},{texture:F},[f[1],f[0]]),v=F}const S=be(f),C=Ms(f),k=new hbe(f,i,p),T=[{type:"uint32",data:[S]},{type:"uint32",data:[i]},{type:"uint32",data:[...C]}],_=n.makeTensorInfo([h,d],"int32"),$=n.tensorMap.get(_.dataId);$.resource=v;const R=n.runWebGPUProgram(k,[_],"int32",T);return n.disposeData(_.dataId),R}const g=r.data;let x=g;if(i!=null&&i!==4){x=new Uint8Array(r.width*r.height*i);const v=g.length;let S=0;for(let C=0;C<v;C++)C%4<i&&(x[S++]=g[C])}const y=n.makeTensorInfo(f,"int32",new Int32Array(x));return n.uploadToGPU(y.dataId),y}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let mbe=class{constructor(e,n,s,r,i){this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],nn(e,n),nn(e,s),this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),r!=null&&(nn(e,r),this.variableNames.push("offset")),i!=null&&(nn(e,i),this.variableNames.push("scale")),this.offsetShape=r,this.scaleShape=i,this.shaderKey="batchNorm"}getUserCode(){let e="0.0";this.offsetShape!=null&&(e="getOffsetByOutputIndex(index)");let n="1.0";return this.scaleShape!=null&&(n="getScaleByOutputIndex(index)"),`
      ${Ke("index")} {
        if (index < uniforms.size)
        {
          let xValue = getXByOutputIndex(index);
          let meanValue = getMeanByOutputIndex(index);
          let varianValue = getVarianceByOutputIndex(index);
          let offsetValue = ${e};
          let scaleValue = ${n};
          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));
          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));
        }
      }
  `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gbe={kernelName:GE,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s,scale:r,offset:i,mean:o,variance:a}=t,{varianceEpsilon:l}=e,c=n,d=[s,o,a];let h=null;i!=null&&(h=i.shape,d.push(i));let f=null;r!=null&&(f=r.shape,d.push(r));const p=new mbe(s.shape,o.shape,a.shape,h,f),m=[{type:"float32",data:[l]}];return c.runWebGPUProgram(p,d,s.dtype,m)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s,g=el(d),x=sr(r.shape,i.shape,l,h,c,f,!1,g);return _U({x:r,filter:i,convInfo:x,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:m,activation:p})}const ybe={kernelName:$b,backendName:"webgpu",kernelFunc:xbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=d;m==null&&(m=[1,1]),O(ri(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=sr(r.shape,i.shape,l,m,c,h,!0),x=[r,i],y=o!=null,v=a!=null;y&&x.push(o),v&&x.push(a);const S=[{type:"int32",data:[g.padInfo.top,g.padInfo.left]},{type:"int32",data:[g.inHeight,g.inWidth]}];let C;return g.outHeight>4&&g.outWidth>4&&g.strideWidth<=2&&g.inChannels===g.outChannels&&g.dilationHeight===1&&g.dilationWidth===1&&g.inChannels%4===0?(C=new $U(g,y,f,v),S.push({type:"int32",data:[C.virtualWidth]})):(C=new IU(g,y,f,v),S.push({type:"int32",data:[g.filterHeight]},{type:"int32",data:[g.filterWidth]},{type:"int32",data:[g.strideHeight,g.strideWidth]},{type:"int32",data:[g.dilationHeight,g.dilationWidth]})),f==="leakyrelu"&&(S.push({type:"float32",data:[p]}),C.uniforms+=" alpha : f32,"),n.runWebGPUProgram(C,x,"float32",S)}const bbe={kernelName:Ib,backendName:"webgpu",kernelFunc:vbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wbe=class{constructor(e,n){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`gathernd_${e}`,this.sliceDim=e,this.uniforms=`sliceDim : i32, strides : ${qs(e)},`}getUserCode(){let e;return this.sliceDim>1?e="uniforms.strides[j]":e="uniforms.strides",`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          var flattenIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexTemp = i32(round(getIndices(coords[0], j)));
            let strideNum = ${e};
            flattenIndex = flattenIndex + indexTemp * strideNum;
          }

          setOutputAtIndex(index, getA(flattenIndex, coords[1]));
        }
      }
      `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sbe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=be(s.shape),[l,c,d,h]=QI(s,r),f=wt({inputs:{x:r},backend:n,attrs:{shape:[c,o]}}),p=wt({inputs:{x:s},backend:n,attrs:{shape:[be(s.shape)/d,d]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const v=n.readSync(r.dataId),S=n.bufferSync(s),C=D0e(v,S,s.dtype,c,o,d,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,C.values)}const m=new wbe(o,[c,d]),g=[{type:"int32",data:[o]},{type:"int32",data:h}],x=n.runWebGPUProgram(m,[p,f],p.dtype,g),y=wt({inputs:{x},backend:n,attrs:{shape:l}});return n.disposeData(f.dataId),n.disposeData(p.dataId),n.disposeData(x.dataId),y}const Cbe={kernelName:qE,backendName:"webgpu",kernelFunc:Sbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let kbe=class{constructor(e,n){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.slice(),this.aShape=e,this.outputShape=n,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}getUserCode(){const e=Nbe(this.aShape);return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let indexZ = i32(getIndices(resRC.x, resRC.z));
          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);
          setOutputAtIndex(index, inBounds * getA(${e}));
        }
      }
    `}};function Nbe(t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let s=0;s<t.length;s++)s===2?n.push("indexZ"):n.push(`${e[s]}`);return n.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=bs(o,r.shape)[0],c=kR(r,i,l,a),d=be(i.shape),h=[],f=wt({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=wt({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,d/c.batchSize]}});h.push(f),h.push(p);const m=[c.batchSize,c.outerSize,d/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,i])){const S=n.tensorMap.get(p.dataId).values,C=Kn(p.shape,p.dtype,S),T=n.tensorMap.get(f.dataId).values,_=Kn(f.shape,f.dtype,T),$=O0e(_,C,m);return h.forEach(R=>n.disposeData(R.dataId)),n.makeTensorInfo(c.outputShape,$.dtype,$.values)}const g=new kbe(f.shape,m),x=n.runWebGPUProgram(g,[f,p],f.dtype);h.push(x);const y=wt({inputs:{x},backend:n,attrs:{shape:c.outputShape}});return h.forEach(v=>n.disposeData(v.dataId)),y}const Tbe={kernelName:KE,backendName:"webgpu",kernelFunc:jU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _be=xr({opType:Bt.GREATER,cpuKernelImpl:M0e,dtype:"bool"}),Ebe={kernelName:XE,backendName:"webgpu",kernelFunc:_be};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $be=xr({opType:Bt.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:F0e}),Ibe={kernelName:YE,backendName:"webgpu",kernelFunc:$be};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rbe(t){const{inputs:e,backend:n}=t,{input:s}=e;return AU(s,!0,n)}const Pbe={kernelName:QE,backendName:"webgpu",kernelFunc:Rbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Abe=Tn({opType:Ge.IS_FINITE,dtype:"bool"}),jbe={kernelName:JE,backendName:"webgpu",kernelFunc:Abe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dbe=Tn({opType:Ge.IS_INF,dtype:"bool"}),Obe={kernelName:e$,backendName:"webgpu",kernelFunc:Dbe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fbe=Tn({opType:Ge.IS_NAN,dtype:"bool"}),Mbe={kernelName:t$,backendName:"webgpu",kernelFunc:Fbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=[{type:"float32",data:[i]}],a=new pm(r.shape,Ge.LEAKYRELU,"alpha : f32,");return n.runWebGPUProgram(a,[r],"float32",o)}const Bbe={kernelName:n$,backendName:"webgpu",kernelFunc:Lbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vbe=xr({opType:Bt.LESS,dtype:"bool",cpuKernelImpl:B0e}),zbe={kernelName:s$,backendName:"webgpu",kernelFunc:Vbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wbe=xr({opType:Bt.LESS_EQUAL,dtype:"bool",cpuKernelImpl:L0e}),Ube={kernelName:r$,backendName:"webgpu",kernelFunc:Wbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hbe{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gbe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=(r-s)/(i-1),a=new Hbe(i),l=[{type:"float32",data:[s]},{type:"float32",data:[o]}];return e.runWebGPUProgram(a,[],"float32",l)}const Kbe={kernelName:i$,backendName:"webgpu",kernelFunc:Gbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qbe=Tn({opType:Ge.LOG,cpuKernelImpl:V0e}),Xbe={kernelName:o$,backendName:"webgpu",kernelFunc:qbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ybe=Tn({opType:Ge.LOG1P}),Qbe={kernelName:a$,backendName:"webgpu",kernelFunc:Ybe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zbe=xr({opType:Bt.LOGICAL_AND,dtype:"bool"}),Jbe={kernelName:l$,backendName:"webgpu",kernelFunc:Zbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ewe=Tn({opType:Ge.LOGICAL_NOT}),twe={kernelName:c$,backendName:"webgpu",kernelFunc:ewe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nwe=xr({opType:Bt.LOGICAL_OR}),swe={kernelName:u$,backendName:"webgpu",kernelFunc:nwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU=`
  var powValue = 0.0;
  let basis = uniforms.bias + uniforms.alpha * sum;
  if (uniforms.beta == 0.5) {
    powValue = inverseSqrt(basis);
  } else if (uniforms.beta == 1.0) {
    powValue = 1.0 / basis;
  } else {
    powValue = exp(log(basis) * (-uniforms.beta));
  }
`;let rwe=class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];
        let d = coords[3];

        let x = getX(b, r, c, d);
        var sum = 0.0;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let idx = d + i;
          if (idx >= 0 && idx < uniforms.xShape[3]) {
            let z = getX(b, r, c, idx);
            sum = sum + z * z;
          }
        }
        ${DU}

        setOutputAtIndex(index, x * powValue);
      }
    }
  `}};class iwe{constructor(e,n){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,O(n<=this.maxAllowRadius,()=>`Radius must be less than or equal to ${this.maxAllowRadius}, current radius is ${n}`),this.outputShape=e,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=qe(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}getUserCode(){return`
    var <workgroup>lrnSub: array<f32, ${this.workgroupSize[0]}>;
    const elementsPerWorkgroup = ${this.elementsPerWorkgroup};
    const maxAllowRadius = ${this.maxAllowRadius};

    ${Ke()} {
      let localDepth = i32(localId.x);
      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;
      let xDepth = workgroupDepth + localDepth - maxAllowRadius;
      let b = i32(globalId.z) / uniforms.xShape[1];
      let r = i32(globalId.z) - b * uniforms.xShape[1];
      let c = i32(globalId.y);
      let d = workgroupDepth + localDepth;

      var x = 0.0;
      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {
        x = getX(b, r, c, xDepth);
      }
      lrnSub[localDepth] = x;
      workgroupBarrier();

      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {
        var sum = 0.0;
        let index = localDepth + maxAllowRadius;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let z = lrnSub[index + i];
          sum = sum + z * z;
        }
        ${DU}

        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);
      }
    } `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function owe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;let c;i>16?c=new rwe(r.shape):c=new iwe(r.shape,i);const d=[{type:"int32",data:[i]},{type:"float32",data:[o]},{type:"float32",data:[a]},{type:"float32",data:[l]}];return n.runWebGPUProgram(c,[r],r.dtype,d)}const awe={kernelName:d$,backendName:"webgpu",kernelFunc:owe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let lwe=class{constructor(e){this.outputShape=[],this.variableNames=["inputImage","outputImage","dy"],this.uniforms="depthRadius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn_grad"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];

        let MIN_DEPTH_BEGIN = 0;
        let MAX_DEPTH_END = uniforms.outShape[3];
        var result = 0.0;
        for (var d = MIN_DEPTH_BEGIN; d < MAX_DEPTH_END; d++) {
          let depthBegin = max(MIN_DEPTH_BEGIN, d - uniforms.depthRadius);
          let depthEnd = min(MAX_DEPTH_END, d + uniforms.depthRadius + 1);

          var norm = 0.0;
          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            } else {
              break;
            }
          }

          norm = uniforms.alpha * norm + uniforms.bias;

          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              var dyi = -2.0 * uniforms.alpha * uniforms.beta
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d) / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * uniforms.beta);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            } else {
              break;
            }
          }
        }

        setOutputAtIndex(index, result);
      }
    }
  `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:d}=s,h=new lwe(r.shape),f=[{type:"int32",data:[a]},{type:"float32",data:[l]},{type:"float32",data:[c]},{type:"float32",data:[d]}];return n.runWebGPUProgram(h,[r,i,o],r.dtype,f)}const uwe={kernelName:Vz,backendName:"webgpu",kernelFunc:cwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dwe=xr({opType:Bt.MAX,cpuKernelImpl:W0e}),hwe={kernelName:f$,backendName:"webgpu",kernelFunc:dwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,d=ya(r.shape,i,o,1,a,l);return CU(r,d,"max",n)}const pwe={kernelName:p$,backendName:"webgpu",kernelFunc:fwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,d=[1,1,1],h=Oc(r.shape,i,o,d,a,c,l),f=new ER(h,"max"),p=[{type:"int32",data:[h.strideDepth,h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.front,h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.inDepth,h.inHeight,h.inWidth]},{type:"int32",data:[h.effectiveFilterDepth,h.effectiveFilterHeight,h.effectiveFilterWidth]}];return n.runWebGPUProgram(f,[r],r.dtype,p)}const gwe={kernelName:m$,backendName:"webgpu",kernelFunc:mwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let xwe=class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool2DBackprop"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] - 1;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR += uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC += uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);
            let maxPosValue = lastIndex - i32(getMaxPos(batch, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            let curPosValue = wR * uniforms.filterDims[1] + wC;
            let mask = select(0.0, 1.0, maxPosValue == curPosValue);
            dotProd += dyValue * mask;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},ywe=class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool3DBackprop"}getUserCode(){return`
      ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] * uniforms.filterDims[2] - 1;

        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              let maxPosValue = lastIndex - i32(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              let curPosValue = wD * uniforms.filterDims[1] * uniforms.filterDims[2] + wR * uniforms.filterDims[2] + wC;
              let mask = select(0.0, 1.0, maxPosValue == curPosValue);
              dotProd += dyValue * mask;
            }
          }
        }

        setOutputAtIndex(index, dotProd);
      }
    }
    `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vwe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=s,h=[1,1,1],f=Oc(o.shape,a,l,h,c,d),p=new ER(f,"max",!0);let m=[{type:"int32",data:[f.strideDepth,f.strideHeight,f.strideWidth]},{type:"int32",data:[f.padInfo.front,f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.inDepth,f.inHeight,f.inWidth]},{type:"int32",data:[f.effectiveFilterDepth,f.effectiveFilterHeight,f.effectiveFilterWidth]}];const g=n.runWebGPUProgram(p,[o],"int32",m),x=new ywe(f);m=[{type:"int32",data:[f.strideDepth,f.strideHeight,f.strideWidth]},{type:"int32",data:[f.effectiveFilterDepth-1-f.padInfo.front,f.effectiveFilterHeight-1-f.padInfo.top,f.effectiveFilterWidth-1-f.padInfo.left]},{type:"int32",data:[f.effectiveFilterDepth,f.effectiveFilterHeight,f.effectiveFilterWidth]},{type:"int32",data:[f.outDepth]},{type:"int32",data:[f.outHeight]},{type:"int32",data:[f.outWidth]}];const y=n.runWebGPUProgram(x,[r,g],o.dtype,m);return n.disposeData(g.dataId),y}const bwe={kernelName:Wz,backendName:"webgpu",kernelFunc:vwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wwe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;pU([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:d,dimRoundingMode:h}=s,f=ya(a.shape,l,c,1,d,h),p=new E0(f,"max",!0);let m=[{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.padInfo.top,f.padInfo.left]},{type:"int32",data:[f.dilationHeight,f.dilationWidth]},{type:"int32",data:[f.inHeight,f.inWidth]},{type:"int32",data:[f.effectiveFilterHeight,f.effectiveFilterWidth]}];const g=n.runWebGPUProgram(p,[a],"int32",m),x=new xwe(f);m=[{type:"int32",data:[f.strideHeight,f.strideWidth]},{type:"int32",data:[f.effectiveFilterHeight-1-f.padInfo.top,f.effectiveFilterWidth-1-f.padInfo.left]},{type:"int32",data:[f.dilationHeight,f.dilationWidth]},{type:"int32",data:[f.effectiveFilterHeight,f.effectiveFilterWidth]},{type:"int32",data:[f.outHeight]},{type:"int32",data:[f.outWidth]}];const y=n.runWebGPUProgram(x,[r,g],a.dtype,m);return n.disposeData(g.dataId),y}const Swe={kernelName:zz,backendName:"webgpu",kernelFunc:wwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cwe(t){const{inputs:e,backend:n,attrs:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=s,{x:l}=e;O(l.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.shape.length}.`);const c=[1,1];O(ri(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const d=ya(l.shape,r,i,c,o),h=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]}];let f=new E0(d,"max",!1);const p=n.runWebGPUProgram(f,[l],l.dtype,h);f=new E0(d,"max",!0,!0,a);const m=n.runWebGPUProgram(f,[l],"int32",h);return[p,m]}const kwe={kernelName:g$,backendName:"webgpu",kernelFunc:Cwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return Kh(r,i,o,"min",n)}const Twe={kernelName:y$,backendName:"webgpu",kernelFunc:Nwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _we=xr({opType:Bt.MIN,cpuKernelImpl:U0e}),Ewe={kernelName:v$,backendName:"webgpu",kernelFunc:_we};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let $we=class{constructor(e,n,s){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((r,i)=>r[0]+e[i]+r[1]),this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,n.map((r,i)=>{this.uniforms+=` pad${i} : vec2<i32>,`}),this.offset=s==="reflect"?0:1,this.shaderKey=`mirrorPad_${s}`}getUserCode(){const e=this.xShape.length,n=this.xShape.map((c,d)=>`uniforms.pad${d}[0]`).join(","),s=this.xShape.map((c,d)=>`uniforms.pad${d}[0] + uniforms.xShape${e>1?`[${d}]`:""}`).join(","),r=e===1?"start":"start[i]",i=e===1?"end":"end[i]",o=e===1?"outC":"outC[i]",a=qs(e),l=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let start = ${a}(${n});
          let end = ${a}(${s});
          var outC = getCoordsFromIndex(index);
          for (var i = 0; i < ${e}; i = i + 1) {
            if (${o} < ${r}) {
              ${o} = ${r} * 2 - ${o} - ${this.offset};
            } else if(${o} >= ${i}) {
              ${o} = (${i} - 1) * 2 - ${o} + ${this.offset};
            }
          }
          let coords = outC - start;
          setOutputAtIndex(index, getX(${l}));
        }
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iwe={kernelName:b$,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{paddings:r,mode:i}=e,o=n,a=r.map(d=>({type:"int32",data:[d[0],d[1]]})),l=new $we(s.shape,r,i);return o.runWebGPUProgram(l,[s],s.dtype,a)}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rwe=xr({opType:Bt.MOD}),Pwe={kernelName:w$,backendName:"webgpu",kernelFunc:Rwe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Awe=class{constructor(e,n){this.variableNames=["probs"],this.outputShape=[],this.uniforms="seed : f32, numOutcomes: i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,n],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="multinomial"}getUserCode(){return`
    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    fn random (seed : f32, resultUV : vec2<f32>) -> f32 {
      let HASHSCALE1 = 443.8975;
      let p = resultUV * seed;
      var p3  = fract(vec3<f32>(p.xyx) * HASHSCALE1);
      p3 = p3 + dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Ke("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords[0];

        let resUV = vec2<f32>(f32(coords[1]) / f32(uniforms.outShape[1]),
            f32(coords[0]) / f32(uniforms.outShape[0]));
        let r = random(uniforms.seed, resUV);
        var cdf = 0.0;
        for (var i = 0; i < uniforms.numOutcomes - 1; i = i + 1) {
          cdf = cdf + getProbs(batch, i);

          if (r < cdf) {
            setOutputAtIndexI32(index, i);
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutputAtIndexI32(index, uniforms.numOutcomes - 1);
      }
    }
  `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jwe{constructor(e){this.variableNames=["logits"],this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=[this.outputShape[0],1,1],this.outputShape[1]>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.shaderKey="softmax"}getUserCode(){return`
    var<workgroup> buf : array<f32, ${this.workgroupSize[0]}>;
    var<workgroup> rowMaxShared : f32;
    var<workgroup> rowSumShared : f32;
    const blockSize = ${this.workgroupSize[0]};
    ${Ke("index")} {
      let row = index / blockSize;
      let tid = i32(localId.x);
      let cols = uniforms.outShape[1];

      var threadMax = -3.402823e+38f;
      for (var col = tid; col < cols; col += blockSize) {
        let value = getLogits(row, col);
        threadMax = max(threadMax, value);
      }
      if (tid < cols) {
        buf[tid] = threadMax;
      }
      workgroupBarrier();

      var reduceSize = min(cols, blockSize);
      for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
        reduceSize = currSize + (reduceSize & 1);
        if (tid < currSize) {
          buf[tid] = max(buf[tid], buf[tid + reduceSize]);
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowMaxShared = buf[0];
      }
      workgroupBarrier();

      var threadSum = 0.0;
      for (var col = tid; col < cols; col += blockSize) {
        let subExp = exp(getLogits(row, col) - rowMaxShared);
        threadSum += subExp;
      }
      buf[tid] = threadSum;
      workgroupBarrier();

      for (var currSize = blockSize >> 1;  currSize > 0; currSize = currSize >> 1) {
        if (tid < currSize) {
          buf[tid] = buf[tid] + buf[tid + currSize];
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowSumShared = buf[0];
      }
      workgroupBarrier();

      for (var col = tid; col < cols; col += blockSize) {
        let value = exp(getLogits(row, col) - rowMaxShared) / rowSumShared;
        setOutputAtCoords(row, col, value);
      }
  }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OU(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=wt({inputs:{x:r},backend:n,attrs:{shape:[be(r.shape)/r.shape[i],r.shape[i]]}}),a=new jwe(o.shape),l=n.runWebGPUProgram(a,[o],r.dtype),c=wt({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeData(o.dataId),n.disposeData(l.dataId),c}const Dwe={kernelName:aI,backendName:"webgpu",kernelFunc:OU};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Owe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:OU({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],d=l.shape[1],h=new Awe(c,i),f=[{type:"float32",data:[o]},{type:"int32",data:[d]}],p=n.runWebGPUProgram(h,[l],"int32",f);return a||n.disposeData(l.dataId),p}const Fwe={kernelName:S$,backendName:"webgpu",kernelFunc:Owe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mwe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.tensorMap.get(s.dataId),[o,a]=G0e(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}const r=new pm(s.shape,Ge.NEG);return n.runWebGPUProgram(r,[s],s.dtype)}const Lwe={kernelName:k$,backendName:"webgpu",kernelFunc:Mwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bwe(t){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(r.dataId),d=n.readSync(i.dataId),{selectedIndices:h}=HI(c,d,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Vwe={kernelName:T$,backendName:"webgpu",kernelFunc:Bwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zwe(t){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,d=n.readSync(r.dataId),h=n.readSync(i.dataId),f=o,p=a,m=l,g=c,{selectedIndices:x,selectedScores:y}=GI(d,h,f,p,m,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Wwe={kernelName:_$,backendName:"webgpu",kernelFunc:zwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Uwe=class{constructor(e,n){this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,n],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}getUserCode(){return`
      ${Ke("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,
                                      f32(i32(round(getX(coords.x))) == coords.y)));
        }
      }
    `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hwe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,c=be(r.shape),d=new Uwe(c,o),h=wt({inputs:{x:r},backend:n,attrs:{shape:[c]}}),f=[{type:"float32",data:[a]},{type:"float32",data:[l]}],p=n.runWebGPUProgram(d,[h],i,f);n.disposeData(h.dataId);const m=[...r.shape,o],g=wt({inputs:{x:p},backend:n,attrs:{shape:m}});return n.disposeData(p.dataId),g}const Gwe={kernelName:$$,backendName:"webgpu",kernelFunc:Hwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ub(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Ax({inputs:{input:s},backend:n}),i=Ub({inputs:{x:r},backend:n}),o=I1({inputs:{input:s},backend:n}),a=Ub({inputs:{x:o},backend:n}),l=Gh({inputs:{real:i,imag:a},backend:n});return n.disposeData(r.dataId),n.disposeData(i.dataId),n.disposeData(o.dataId),n.disposeData(a.dataId),l}else return vi({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const Kwe={kernelName:wI,backendName:"webgpu",kernelFunc:Ub};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FU(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ax({inputs:{input:s},backend:n}),i=FU({inputs:{x:r},backend:n}),o=I1({inputs:{input:s},backend:n}),a=Ub({inputs:{x:o},backend:n}),l=Gh({inputs:{real:i,imag:a},backend:n});return n.disposeData(r.dataId),n.disposeData(i.dataId),n.disposeData(o.dataId),n.disposeData(a.dataId),l}else return vi({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const qwe={kernelName:E$,backendName:"webgpu",kernelFunc:FU};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xwe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return fN({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{Qi(i,d.shape,"All tensors passed to stack must have matching shapes"),O(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const h=fN({inputs:{input:d},backend:n,attrs:{dim:r}});return a.push(h),h}),c=TU({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(d=>n.disposeData(d.dataId)),c}const Ywe={kernelName:I$,backendName:"webgpu",kernelFunc:Xwe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MU(t,e=!1){const n=t.length,s=qs(n),r=t.map((h,f)=>`uniforms.pad${f}[0]`).join(","),i=t.map((h,f)=>`uniforms.pad${f}[0] + uniforms.xShape${n>1?`[${f}]`:""}`).join(","),o=n>1?`${s}(${r})`:`${r}`,a=n>1?`${s}(${i})`:`${i}`,l=n>1?"any(paddedCoords < start)":"paddedCoords < start",c=n>1?"any(paddedCoords >= end)":"paddedCoords >= end",d=n>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n):"coords";return`
        let start = ${o};
        let end = ${a};
        if (${l} || ${c}) {
          setOutputAtIndex(index, ${e?0:"uniforms.constantValue"});
        } else {
          let coords = paddedCoords - start;
          setOutputAtIndex(index, getX(${d}));
        }
  `}let Qwe=class{constructor(e,n){this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((s,r)=>s[0]+e[r]+s[1]),this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),n.map((s,r)=>{this.uniforms+=` pad${r} : vec2<i32>,`}),this.xShape=e,this.shaderKey="pad"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let paddedCoords = getCoordsFromIndex(index);
          ${MU(this.xShape)}
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zwe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(i.every(c=>Gn(c,[0,0])))return Xi({inputs:{x:r},backend:n});if(be(r.shape)===0){const c=i.map((d,h)=>d[0]+r.shape[h]+d[1]);return vi({backend:n,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=[{type:"float32",data:[o]}];i.map(c=>a.push({type:"int32",data:[c[0],c[1]]}));const l=new Qwe(r.shape,i);return n.runWebGPUProgram(l,[r],r.dtype,a)},Jwe={kernelName:R$,backendName:"webgpu",kernelFunc:Zwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e1e=xr({opType:Bt.POW}),t1e={kernelName:P$,backendName:"webgpu",kernelFunc:e1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n1e(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=new Vb(Bt.PRELU,s.shape,r.shape);return n.runWebGPUProgram(i,[s,r],"float32")}const s1e={kernelName:A$,backendName:"webgpu",kernelFunc:n1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return Kh(r,i,o,"prod",n)}const i1e={kernelName:j$,backendName:"webgpu",kernelFunc:r1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o1e=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=X0e(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},a1e={kernelName:D$,backendName:"webgpu",kernelFunc:o1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l1e=xr({opType:Bt.DIV}),c1e={kernelName:AE,backendName:"webgpu",kernelFunc:l1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u1e=Tn({opType:Ge.RECIPROCAL}),d1e={kernelName:F$,backendName:"webgpu",kernelFunc:u1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h1e=Tn({opType:Ge.RELU}),f1e={kernelName:M$,backendName:"webgpu",kernelFunc:h1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1e=Tn({opType:Ge.RELU6}),m1e={kernelName:z$,backendName:"webgpu",kernelFunc:p1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let g1e=class{constructor(e,n,s){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],n,s,e[3]],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC =
            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *
            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);

          // Compute the four integer indices.
          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);
          let sourceCeilRC = vec2<i32>(
            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));

          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);
          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);
          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);
          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);

          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);

          let top = topLeft + (topRight - topLeft) * fracRC.y;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          let newValue = top + (bottom - top) * fracRC.x;

          setOutputAtIndex(index, newValue);
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,size:o,halfPixelCenters:a}=s,[l,c]=o,d=i&&l>1?1:0,h=i&&c>1?1:0,p=[{type:"float32",data:[d,h]},{type:"float32",data:[a?.5:0]}],m=new g1e(r.shape,l,c);return n.runWebGPUProgram(m,[r],"float32",p)}const y1e={kernelName:V$,backendName:"webgpu",kernelFunc:x1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let v1e=class{constructor(e,n){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, heightScale : f32, widthScale : f32,
       invHeightScale : f32, invWidthScale : f32, winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=n,this.shaderKey=`resizeBilinearBackprop_${n}`}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(startRLerp - f32(uniforms.winHeight / 2));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(startCLerp - f32(uniforms.winWidth / 2));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let dxR = f32(dyR) * uniforms.heightScale;
              let topDxRIndex = i32(floor(dxR));
              let bottomDxRIndex = i32(min(ceil(dxR), f32(uniforms.outShape[1] - 1)));
              let dxRLerp = dxR - f32(topDxRIndex);
              let inverseDxRLerp = 1.0 - dxRLerp;

              let dxC = f32(dyC) * uniforms.widthScale;
              let leftDxCIndex = i32(floor(dxC));
              let rightDxCIndex = i32(min(ceil(dxC), f32(uniforms.outShape[2] - 1)));
              let dxCLerp = dxC - f32(leftDxCIndex);
              let inverseDxCLerp = 1.0 - dxCLerp;

              if (r == topDxRIndex && c == leftDxCIndex) {
                // topLeft
                accumulator +=
                  getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
              }

              if (r == topDxRIndex && c == rightDxCIndex) {
                // topRight
                accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
              }

              if (r == bottomDxRIndex && c == leftDxCIndex) {
                // bottomLeft
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
              }

              if (r == bottomDxRIndex && c == rightDxCIndex) {
                // bottomRight
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,[,a,l]=r.shape,[,c,d]=i.shape,h=[o&&c>1?a-1:a,o&&d>1?l-1:l],f=[o&&c>1?c-1:c,o&&d>1?d-1:d],p=h[0]/f[0],m=h[1]/f[1],g=1/p,x=1/m,y=Math.ceil(g)*2+2,v=Math.ceil(x)*2+2,S=new v1e(r.shape,o),C=[{type:"int32",data:h},{type:"int32",data:f},{type:"float32",data:[p]},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"float32",data:[x]},{type:"int32",data:[y]},{type:"int32",data:[v]}];return n.runWebGPUProgram(S,[i],i.dtype,C)}const w1e={kernelName:Xz,backendName:"webgpu",kernelFunc:b1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let S1e=class{constructor(e,n,s,r){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],n,s,e[3]],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=r,this.shaderKey=`resizeNearest_${r}`}getUserCode(){let e;return this.halfPixelCenters?e="max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":e="vec2<f32>(rc) * effectiveInputOverOutputRatioRC",`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC = ${e};

          // Compute the coordinators of nearest neighbor point.
          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));
          let sourceNearestRC = vec2<i32>(
            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));
          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);

          setOutputAtIndex(index, newValue);
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C1e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,d=i&&l>1?1:0,h=i&&c>1?1:0,p=[{type:"float32",data:[d,h]},{type:"float32",data:[i?.5:0]}],m=new S1e(r.shape,l,c,o);return n.runWebGPUProgram(m,[r],r.dtype,p)}const k1e={kernelName:B$,backendName:"webgpu",kernelFunc:C1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let N1e=class{constructor(e,n){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, invHeightScale : f32, invWidthScale : f32,
       winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=n,this.shaderKey=`resizeNearestNeigborBackprop_${n}`}getUserCode(){return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(floor(startRLerp - f32(uniforms.winHeight / 2)));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(floor(startCLerp - f32(uniforms.winWidth / 2)));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let sourceFracRow = f32(uniforms.effectiveXSize[0]) *
                  (f32(dyR) / f32(uniforms.effectiveYSize[0]));

              let sourceFracCol = f32(uniforms.effectiveXSize[1]) *
                  (f32(dyC) / f32(uniforms.effectiveYSize[1]));

              let sourceNearestRow =
                  i32(min(f32(uniforms.outShape[1] - 1),
                  ${this.alignCorners?"floor(sourceFracRow + 0.5)":"floor(sourceFracRow)"}));

              let sourceNearestCol =
                  i32(min(f32(uniforms.outShape[2] - 1),
                  ${this.alignCorners?"floor(sourceFracCol + 0.5)":"floor(sourceFracCol)"}));

              if (r == sourceNearestRow && c == sourceNearestCol) {
                accumulator += getDy(b, dyR, dyC, d);
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,[,a,l]=r.shape,[,c,d]=i.shape,h=[o&&c>1?a-1:a,o&&d>1?l-1:l],f=[o&&c>1?c-1:c,o&&d>1?d-1:d],p=h[0]/f[0],m=h[1]/f[1],g=1/p,x=1/m,y=Math.ceil(g)*2+2,v=Math.ceil(x)*2+2,S=new N1e(r.shape,o),C=[{type:"int32",data:h},{type:"int32",data:f},{type:"float32",data:[g]},{type:"float32",data:[x]},{type:"int32",data:[y]},{type:"int32",data:[v]}];return n.runWebGPUProgram(S,[i],i.dtype,C)}const _1e={kernelName:qz,backendName:"webgpu",kernelFunc:T1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let E1e=class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}getUserCode(){return`
      
      // Using uniform variables as judging conditions, so the function has
      // coherent execution within all threads.
      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {
        var reverseCoords = coords;
        if (uniforms.axis[0] == 1) {
          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;
        }
        if (uniforms.axis[1] == 1) {
          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;
        }
        if (uniforms.axis[2] == 1) {
          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;
        }
        if (uniforms.axis[3] == 1) {
          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;
        }

        return reverseCoords;
      }
    
      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let reverseCoords = getReverseCoords(coords);
          setOutputAtIndex(index, getX(reverseCoords[0],
              reverseCoords[1], reverseCoords[2], reverseCoords[3]));
        }
      }
    `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length;if(o===0)return Xi({inputs:{x:r},backend:n});const a=r.shape,l=[1,1,1,1];a.forEach((x,y)=>{const v=y+4-o;l[v]=x});const c=bs(i,r.shape),d=[0,0,0,0];c.forEach(x=>{const y=x+4-o;d[y]=1});const h=[{type:"int32",data:d}],f=wt({inputs:{x:r},backend:n,attrs:{shape:l}}),p=new E1e(l),m=n.runWebGPUProgram(p,[f],f.dtype,h);n.disposeData(f.dataId);const g=wt({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeData(m.dataId),g}const I1e={kernelName:W$,backendName:"webgpu",kernelFunc:$1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let R1e=class{constructor(e,n){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`centerX : f32, centerY : f32, sinRadians : f32,
          cosRadians : f32,`,this.shaderKey="rotate",this.outputShape=e,typeof n=="number"?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}getUserCode(){return`
        ${Ke("index")} {
          if (index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *
                uniforms.sinRadians;
            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *
                uniforms.cosRadians;
            let coordX = i32(round(coordXFloat + uniforms.centerX));
            let coordY = i32(round(coordYFloat + uniforms.centerY));
            ${this.fillSnippet}
            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&
                coordY < uniforms.xShape[1]) {
              outputValue = getX(coords[0], coordY, coordX, coords[3]);
            }
            setOutputAtIndex(index, outputValue);
          }
        }
      `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P1e={kernelName:CI,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new R1e(s.shape,i),[c,d]=oR(o,s.shape[1],s.shape[2]),h=[{type:"float32",data:[c]},{type:"float32",data:[d]},{type:"float32",data:[Math.sin(r)]},{type:"float32",data:[Math.cos(r)]}];return typeof i=="number"?h.push({type:"float32",data:[Number.parseFloat(i.toFixed(2))]}):h.push({type:"float32",data:i}),a.runWebGPUProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A1e=Tn({opType:Ge.ROUND}),j1e={kernelName:U$,backendName:"webgpu",kernelFunc:A1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D1e=Tn({opType:Ge.RSQRT,cpuKernelImpl:Y0e}),O1e={kernelName:H$,backendName:"webgpu",kernelFunc:D1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Mg=class{constructor(e,n,s,r,i,o,a,l=!0){this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=o,this.type=a,this.sumDupeIndices=l,this.dispatchLayout=at(e),this.dispatch=qe(this.dispatchLayout,e,this.workgroupSize),this.sliceDimGreaterThanOne=n>1,this.shaderKey=`scatter_${s}_${r}_${this.sliceDimGreaterThanOne}_${a}_${l}_${i.length}`;const c=qs(i.length);this.uniforms=`sliceDim : i32, strides: ${c}, updatesSize: i32,`,this.updatesRank=r,this.indicesRank=s}getUserCode(){let e="";this.indicesRank===1?e="coords[0]":this.indicesRank===2&&(e="coords[0], j");const n=`getIndices(${e})`,s=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides";let r="",i="";this.dispatchLayout.x.length===1?(r="flattenedIndex",i=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {
        return index;
      }
      `):this.dispatchLayout.x.length===2&&(r="vec2<i32>(flattenedIndex, coords[1])",i=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {
        // N.B. |updates| could be a scalar tensor, conceptually representing a
        // 2D tensor with all values equal to that. By design, its size must be
        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|
        // gives the other.
        let sliceSize = uniforms.outShape[1];
        let d0 = index / sliceSize;
        let d1 = index - d0 * sliceSize;
        return vec2<i32>(d0, d1);
      }
      `);const a=`getUpdates(${Array.from({length:this.updatesRank},(c,d)=>`coords[${d}]`).join(", ")})`;return`
    ${i}
      ${Ke("index")} {
        if (index < uniforms.updatesSize) {
          let coords = getUpdatesCoordsFromFlatIndex(index);
          var flattenedIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexInside = i32(round(${n}));
            flattenedIndex = flattenedIndex + indexInside * ${s};
          }
          let updateValue =
              ${jd(this.type)}(${a});
          let flatIndex = getOutputIndexFromCoords(${r});

          ${this.sumDupeIndices?ld("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));"}
        }
      }`}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=zh(i,r,o),f=[h/c,c];if(h===0)return n.makeTensorInfo(o,r.dtype);const p=wt({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),m=wt({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),g=m.dtype,x=vi({backend:n,attrs:{shape:f,value:0,dtype:g}}),y=be(m.shape),v=[{type:"int32",data:[a]},{type:"int32",data:d},{type:"int32",data:[y]}],S=new Mg(m.shape,a,p.shape.length,m.shape.length,d,f,g),C=n.runWebGPUProgram(S,[m,p],g,v,x),k=wt({inputs:{x:C},backend:n,attrs:{shape:o}});return n.disposeData(p.dataId),n.disposeData(m.dataId),n.disposeData(C.dataId),k}const M1e={kernelName:G$,backendName:"webgpu",kernelFunc:F1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let L1e=class{constructor(e,n){this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=n,this.shaderKey=`search_sorted_${n}`}getUserCode(){return`
      fn findBound(batch: i32, value: f32) -> i32 {
        var left = i32(0);
        var right = uniforms.numInputs;
        while (left < right) {
          var mid = (left + right) / 2;
          if (getSortedSequence(batch, mid) ${this.side==="left"?"<":"<="} value) {
            left = mid + 1;
          } else {
            right = mid;
          }
        }
        return right;
      }

      ${Ke("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let value = getValuesByOutputIndex(index);
          setOutputAtIndexI32(index, findBound(coords[0], value));
        }
      }
    `}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B1e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new L1e([i.shape[0],i.shape[1]],o),l=[{type:"int32",data:[r.shape[1]]}];return n.runWebGPUProgram(a,[r,i],"int32",l)}const V1e={kernelName:q$,backendName:"webgpu",kernelFunc:B1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let z1e=class{constructor(e,n,s){this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=e,this.rank=s,this.shaderKey="select"}getUserCode(){let e,n;if(this.rank>4)throw Error(`Where for rank ${this.rank} is not yet supported`);if(this.rank===1)n="resRC",e="resRC";else{const r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=[];for(let a=0;a<this.outputShape.length;a++)o.push(`${r[a]}`),a<this.cRank&&i.push(`${r[a]}`);e=i.join(),n=o.join()}return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let cVal = getC(${e});
          if (cVal >= 1.0) {
            setOutputAtIndex(index, getA(${n}));
          } else {
            setOutputAtIndex(index, getB(${n}));
          }
        }
      }
    `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W1e(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new z1e(s.shape.length,r.shape,r.shape.length);return n.runWebGPUProgram(o,[s,r,i],wi(r.dtype,i.dtype))}const U1e={kernelName:X$,backendName:"webgpu",kernelFunc:W1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1e=Tn({opType:Ge.SELU}),G1e={kernelName:Y$,backendName:"webgpu",kernelFunc:H1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=Tn({opType:Ge.SIGMOID}),q1e={kernelName:tI,backendName:"webgpu",kernelFunc:K1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X1e=Tn({opType:Ge.SIGN}),Y1e={kernelName:eI,backendName:"webgpu",kernelFunc:X1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1e=Tn({opType:Ge.SIN}),Z1e={kernelName:Z$,backendName:"webgpu",kernelFunc:Q1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1e=Tn({opType:Ge.SINH}),e2e={kernelName:J$,backendName:"webgpu",kernelFunc:J1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t2e=Tn({opType:Ge.SOFTPLUS}),n2e={kernelName:nI,backendName:"webgpu",kernelFunc:t2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s2e{constructor(e,n,s,r,i,o){this.variableNames=["x"],this.outputShape=[],this.uniforms="",this.workgroupSize=[64,1,1],this.size=!0;const a=new Array(r.length);for(let l=0;l<a.length;l++)a[l]=r[i[l]];this.outputShape=a,this.newDim=i,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,this.paddedXShape=n,this.uniforms+=`reshapedPaddedXShape : ${qs(r.length)}, paddedXShapeStrides : ${qs(o)}, `,s.map((l,c)=>{this.uniforms+=` pad${c} : vec2<i32>,`}),this.shaderKey=`spaceToBatchND_${i}`}getUserCode(){const e=qs(this.outputShape.length),n=vU(this.newDim);return`
      ${Iv(this.paddedXShape,"PaddedX")}
      ${Ke("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let switchedIndex = getIndexFromCoords${this.outputShape.length}D(${e}(${n}), uniforms.reshapedPaddedXShape);
          let paddedCoords = getPaddedXCoordsFromIndex(switchedIndex);
          ${MU(this.xShape,!0)}
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r2e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;O(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet");const a=i.reduce((v,S)=>v*S),l=[[0,0]];l.push(...o);for(let v=1+i.length;v<r.shape.length;++v)l.push([0,0]);const c=l.map((v,S)=>v[0]+r.shape[S]+v[1]),d=Ix(c,i,a,!1),h=Rx(d.length,i.length,!1),f=Px(c,i,a,!1),p=Ms(c),m=new s2e(r.shape,c,l,d,h,p.length),g=[{type:"int32",data:d},{type:"int32",data:p}];l.map(v=>g.push({type:"int32",data:[v[0],v[1]]}));const x=n.runWebGPUProgram(m,[r],r.dtype,g),y=wt({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeData(x.dataId),y},i2e={kernelName:iI,backendName:"webgpu",kernelFunc:r2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o2e{constructor(e,n,s){this.variableNames=["input","indices","segmentIds"],this.outputShape=[],this.uniforms="segmentSize : i32, sparseSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e,this.type=s,this.dispatchLayout=at([n]),this.dispatch=qe(this.dispatchLayout,[n],this.workgroupSize),this.shaderKey="sparseSegmentSum"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.sparseSize) {
        let indexInSegmentIds = index / uniforms.segmentSize;
        let indexInSegment = index % uniforms.segmentSize;
        let indexInInput = indices[indexInSegmentIds];
        let segmentId = segmentIds[indexInSegmentIds];

        let value = input[indexInInput * uniforms.segmentSize + indexInSegment];
        let outIndex = segmentId * uniforms.segmentSize + indexInSegment;
        ${ld("&result[outIndex]","value",this.type)}
      }
    }
  `}}class a2e{constructor(e,n){this.variableNames=["segmentIds"],this.outputShape=[],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=[e],this.dispatchLayout=at(n),this.dispatch=qe(this.dispatchLayout,n,this.workgroupSize),this.shaderKey="sparseSegmentIdCountProgram"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.segmentIdsShape) {
        let segmentId = segmentIds[index];
        ${ld("&result[segmentId]","1","int32")}
      }
    }
  `}}class l2e{constructor(e,n){this.variableNames=["segmentSum","sameSegmentIdCount"],this.outputShape=[],this.uniforms="segmentSize : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.type=n,this.dispatchLayout=at(e),this.dispatch=qe(this.dispatchLayout,e,this.workgroupSize),this.shaderKey="sparseSegmentMean"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.size) {
        let segmentId = index / uniforms.segmentSize;
        let count = sameSegmentIdCount[segmentId];
        if (count != 0) {
          ${this.type==="float32"?"setOutputAtIndex(index, segmentSum[index] / f32(count));":"setOutputAtIndexI32(index, segmentSum[index] / count);"}
        }
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LU(t,e,n,s=!1,r){const o=be(t.shape)/t.shape[0],a=t.dtype,l=be(e.shape),c=r.readSync(n.dataId),h=l>0?c[l-1]+1:0;let f;const p=t.shape.slice();p[0]=h;const m=l*o,g=vi({backend:r,attrs:{shape:p,value:0,dtype:a}});f=new o2e(p,m,a);let x=[{type:"int32",data:[o]},{type:"int32",data:[m]}];const y=r.runWebGPUProgram(f,[t,e,n],a,x,g);if(s)return y;const v=vi({backend:r,attrs:{shape:[h],value:0,dtype:"int32"}});f=new a2e(h,n.shape);const S=r.runWebGPUProgram(f,[n],"int32",null,v),C=vi({backend:r,attrs:{shape:p,value:0,dtype:a}});f=new l2e(p,a),x=[{type:"int32",data:[o]}];const k=r.runWebGPUProgram(f,[y,S],a,x,C);return r.disposeData(y.dataId),r.disposeData(S.dataId),k}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c2e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;return LU(s,r,i,!1,n)}const u2e={kernelName:lI,backendName:"webgpu",kernelFunc:c2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d2e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;return LU(s,r,i,!0,n)}const h2e={kernelName:cI,backendName:"webgpu",kernelFunc:d2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let f2e=class{constructor(e,n){this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[r]*n[r];this.outputShape=s,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}getUserCode(){const e=p2e(this.rank,"uniforms.");return`
      ${Ke("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          setOutputAtIndex(index, getA(${e}));
        }
      }
    `}};function p2e(t,e=""){if(t>=5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`(resRC % ${e}aShape)`;const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t;r++)s.push(`(${n[r]} % ${e}aShape[${r}])`);return s.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(n.shouldExecuteOnCPU([r])||r.dtype==="string"||r.shape.length>=5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(f=>Tc(f)):l,d=Kn(r.shape,r.dtype,c),h=sxe(d,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new f2e(r.shape,i);return n.runWebGPUProgram(o,[r],r.dtype)}const m2e={kernelName:h1,backendName:"webgpu",kernelFunc:$R};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:d,strides:h,outputSize:f}=zh(i,r,a),p=!1;if(i.dtype==="string"){const $=n.bufferSync(r),R=n.bufferSync(i),A=Tc(n.readSync(o.dataId)[0]),j=Q0e($,R,a,f,d,c,l,h,A,p);return n.makeTensorInfo(a,j.dtype,j.values)}const m=[f/d,d],g=wt({inputs:{x:r},backend:n,attrs:{shape:[c,l]}}),x=i.shape.length?wt({inputs:{x:i},backend:n,attrs:{shape:[c,d]}}):Xi({inputs:{x:i},backend:n}),y=x.dtype,v=n.makeTensorInfo([],y,Nc(1,y)),S=wt({inputs:{x:o},backend:n,attrs:{shape:Array(m.length).fill(1)}}),C=$R({inputs:{x:S},backend:n,attrs:{reps:m}}),k=be([c,d]),T=[{type:"int32",data:[l]},{type:"int32",data:h},{type:"int32",data:[k]}];switch(c){case 0:break;case 1:{const $=new Mg([c,d],l,g.shape.length,x.shape.length,h,m,y,p);n.runWebGPUProgram($,[x,g],y,T,C)}break;default:{const $=new Mg([c,d],l,g.shape.length,v.shape.length,h,m,y,p);n.runWebGPUProgram($,[v,g],y,T,C)}{const $=new Mg([c,d],l,g.shape.length,x.shape.length,h,m,y);n.runWebGPUProgram($,[x,g],y,T,C)}}const _=wt({inputs:{x:C},backend:n,attrs:{shape:a}});return n.disposeData(g.dataId),n.disposeData(x.dataId),n.disposeData(S.dataId),n.disposeData(v.dataId),n.disposeData(C.dataId),_}const x2e={kernelName:uI,backendName:"webgpu",kernelFunc:g2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=bs(o,r.shape)[0],l=SR(r,i,a),c=r.shape.length,d=new Array(c).fill(0),h=r.shape.slice();return l.map(f=>{const p=[...h];p[a]=f;const m=mm({inputs:{x:r},backend:n,attrs:{begin:d,size:p}});return d[a]+=f,m})}const v2e={kernelName:oI,backendName:"webgpu",kernelFunc:y2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b2e=Tn({opType:Ge.SQRT}),w2e={kernelName:sI,backendName:"webgpu",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S2e={kernelName:Zz,backendName:"webgpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e,r=new pm(n.shape,Ge.SQUARE);return s.runWebGPUProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2e=xr({opType:Bt.SQUARED_DIFFERENCE}),k2e={kernelName:dI,backendName:"webgpu",kernelFunc:C2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2e({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=new pm(s.shape,Ge.STEP,"stepAlpha : f32,"),i=[{type:"float32",data:[e.alpha]}];return n.runWebGPUProgram(r,[s],s.dtype,i)}const T2e={kernelName:SI,backendName:"webgpu",kernelFunc:N2e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let _2e=class{constructor(e){this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);const n=qs(this.outputShape.length);this.uniforms=`begin : ${n},  strides : ${n}, `,this.shaderKey="stridedSlice"}getUserCode(){const e=this.outputShape.length;let n="";if(e===1)n="coords * uniforms.strides + uniforms.begin";else{let r=0;n=this.outputShape.map((i,o)=>(r++,this.outputShape.length===1?`coords * uniforms.strides[${o}] + uniforms.begin[${o}]`:`coords[${r-1}] * uniforms.strides[${o}] + uniforms.begin[${o}]`)).join(",")}return`
       ${Ke("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index);
           setOutputAtIndex(index, getX(${n}));
         }
       }
     `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:v,end:S,strides:C}=sR(r.shape,i,o,a,l,c,d,h,f);let k;if(g)k=wt({inputs:{x:r},backend:n,attrs:{shape:m}});else if(x||y){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const T=JI(v,S,C),_=mm({inputs:{x:r},backend:n,attrs:{begin:v,size:T}});k=wt({inputs:{x:_},backend:n,attrs:{shape:m}}),n.disposeData(_.dataId)}else if(n.shouldExecuteOnCPU([r])){const _=n.readSync(r.dataId),$=Kn(r.shape,r.dtype,_),R=exe(p,$,C,v);k=n.makeTensorInfo(m,r.dtype,R.values)}else{const _=new _2e(p),$=[{type:"int32",data:v},{type:"int32",data:C}],R=n.runWebGPUProgram(_,[r],r.dtype,$);k=wt({inputs:{x:R},backend:n,attrs:{shape:m}}),n.disposeData(R.dataId)}return k}const $2e={kernelName:hI,backendName:"webgpu",kernelFunc:E2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2e(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:d,dataSplits:h}=e,f=n.readSync(d.dataId),p=n.readSync(h.dataId),[m,g]=txe(f,p,r,i,o,a,l,c);return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(h.shape,"int32",g)]}const R2e={kernelName:fI,backendName:"webgpu",kernelFunc:I2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P2e=xr({opType:Bt.SUB,cpuKernelImpl:nxe,supportsComplex:!0}),A2e={kernelName:pI,backendName:"webgpu",kernelFunc:P2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j2e=Tn({opType:Ge.TAN}),D2e={kernelName:mI,backendName:"webgpu",kernelFunc:j2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O2e=Tn({opType:Ge.TANH}),F2e={kernelName:gI,backendName:"webgpu",kernelFunc:O2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M2e(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=zh(o,i,r.shape),f=[h/c,c];if(h===0)return n.makeTensorInfo(r.shape,i.dtype);const p=[],m=wt({inputs:{x:i},backend:n,attrs:{shape:[l,a]}});p.push(m);const g=wt({inputs:{x:o},backend:n,attrs:{shape:[l,c]}});p.push(g);const x=wt({inputs:{x:r},backend:n,attrs:{shape:f}});p.push(x);const y=$R({inputs:{x},backend:n,attrs:{reps:Array(f.length).fill(1)}}),v=new Mg([l,c],a,m.shape.length,g.shape.length,d,f,r.dtype,!1),S=be([l,c]),C=[{type:"int32",data:[a]},{type:"int32",data:d},{type:"int32",data:[S]}],k=n.runWebGPUProgram(v,[g,m],x.dtype,C,y);p.push(k);const T=wt({inputs:{x:k},backend:n,attrs:{shape:r.shape}});return p.forEach(_=>n.disposeData(_.dataId)),T}const L2e={kernelName:K$,backendName:"webgpu",kernelFunc:M2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let B2e=class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`inputSize : i32, firstPass : i32, negativeInf : f32,
        dir : i32, inc : i32,`,this.shaderKey="swap"}getUserCode(){return`
        ${Ke("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // We compare elements pair-wise within a group of size 2 * inc.
            // The comparing rule for each group alternates between ascending
            // and descending. Within each group, we compare each pair at
            // positions i and i+inc. To decide whether an element at position i
            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
            // inc, it is in the first half of the group, we denote it as x0,
            // otherwise we denote it as x1.
            // For example, as shown in the Bitonic top K paper referenced
            // above, Figure5(a) shows that element[1] is in the second half of
            // the group when group size is 2, but it is in the first half of
            // the group when group size is 4.
            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;
            var i = 0;
            if (isFirstInPair) {
              i = elemIdx;
            } else {
              i = elemIdx - uniforms.inc;
            }

            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }

            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.inc;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.inc));
            }

            var x0 = f32(0.0);
            var x1 = f32(0.0);
            if (i0 < uniforms.inputSize) {
              x0 = getX(batch, i0);
            } else {
              x0 = uniforms.negativeInf;
            }
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = uniforms.negativeInf;
            }

            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;
            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
            if (reverse == isGreater) {
              // Elements in opposite order of direction
              let iTemp = i0;
              i0 = i1;
              i1 = iTemp;
            }
            if (isFirstInPair) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}},V2e=class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}getUserCode(){return`
        ${Ke("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // The output size is half of the previous size.
            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _
            // (k=4), we only need to output the indices at positions |, the
            // indices at positions _ can be thrown away, see Figure5(b) After
            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced
            // above.
            // For example, the paper shows we only need to output the orange
            // bars. The output sequence should look like this | | | | | | | |.
            // Because the sequence is halved, to map the output index back to
            // the previous sequence to find the corresponding value, we need
            // to double the index. When we double the index, we basically
            // interpolate a position, so 2i looks like
            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k
            // position of each 2k positions by - elemIdx % k. E.g. for output
            // at index 4,5,6,7, we want to get the corresponding element at
            // original index 8,9,10,11, for output at index 8,9,10,11,
            // we want to get the corresponding element at original index
            // 16,17,18,19, so on and so forth.

            var i = 0;
            if (elemIdx < uniforms.k) {
              i = elemIdx;
            } else {
              i = elemIdx * 2 - elemIdx % uniforms.k;
            }
            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }
            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.k;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.k));
            }

            let x0 = getX(batch, i0);
            var x1 = f32(0.0);
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = x0;
            }

            if (x0 >= x1) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function df(t,e){e!==null&&t.disposeData(e.dataId)}function dD(t){let e=1;for(;e<t;)e*=2;return e}function z2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=r.shape,l=a[a.length-1];if(n.shouldExecuteOnCPU([r])){const k=n.readSync(r.dataId),[T,_]=rxe(k,a,r.dtype,i,o);return[n.makeTensorInfo(T.shape,T.dtype,T.values),n.makeTensorInfo(_.shape,_.dtype,_.values)]}if(i===0)return a[a.length-1]=0,[n.makeTensorInfo(a,r.dtype,[]),n.makeTensorInfo(a,"int32",[])];if(l===1)return[r,vi({attrs:{shape:a,dtype:"int32",value:0},backend:n})];const d=be(a)/l,h=wt({inputs:{x:r},attrs:{shape:[d,l]},backend:n}),f=dD(i),p=dD(l);let m=null;const g=()=>m===null?[h,h]:[h,m],x=(k,T,_)=>{const $=g(),R=new B2e(_),j=[{type:"int32",data:[l]},{type:"int32",data:[m===null?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[k]},{type:"int32",data:[T]}],F=m;m=n.runWebGPUProgram(R,$,"int32",j),df(n,F)};for(let k=1;k<f;k*=2){const T=k*2;for(let _=k;_>=1;_/=2)x(T,_,[d,p])}for(let k=p;k>f;k/=2){const T=g(),_=new V2e([d,k/2]),R=[{type:"int32",data:[l]},{type:"int32",data:[m===null?1:0]},{type:"int32",data:[f]}],A=m;m=n.runWebGPUProgram(_,T,"int32",R),df(n,A);const j=f/2,F=j*2;for(let L=j;L>=1;L/=2)x(F,L,m.shape)}let y=m;m=mm({inputs:{x:m},backend:n,attrs:{begin:0,size:[d,i]}}),df(n,y);let v=jU({inputs:{x:h,indices:m},backend:n,attrs:{axis:1,batchDims:1}});df(n,h);const S=a.slice(0,-1);S.push(i),y=m,m=wt({inputs:{x:m},attrs:{shape:S},backend:n}),df(n,y);const C=v;return v=wt({inputs:{x:v},attrs:{shape:S},backend:n}),df(n,C),[v,m]}const W2e={kernelName:xI,backendName:"webgpu",kernelFunc:z2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let U2e=class{constructor(e){this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}getUserCode(){return`
          fn mapCoord(outCoord : f32, len : f32) -> f32{
            var inCoord = outCoord;
            if(uniforms.fillModeId == 2) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  if (inCoord < sz2) {
                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +
                    inCoord;
                  }
                  if (inCoord < -len) {
                    inCoord = inCoord + sz2;
                  } else {
                    inCoord = -inCoord - 1.0;
                  }
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));
                  if (inCoord >= len) {
                    inCoord = sz2 - inCoord - 1.0;
                  }
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 3) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 4) {
              return clamp(outCoord, 0.0, len - 1.0);
            }
            return outCoord;
          }
          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,
            channel : i32) -> f32 {
            var outputValue : f32;
            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {
                outputValue = getImage(batch, coordY, coordX, channel);
            } else {
              outputValue = uniforms.fillValue;
            }
            return outputValue;
          }

          ${Ke("index")} {
            if (index < uniforms.size) {
              let coords = getCoordsFromIndex(index);
              var outputValue : f32;
              let batch = coords[0];
              let x = coords[2];
              let y = coords[1];
              let channel = coords[3];
              let xf = f32(x);
              let yf = f32(y);
              let a1 = getTransforms(batch, 0);
              let a2 = getTransforms(batch, 1);
              let a3 = getTransforms(batch, 2);
              let b1 = getTransforms(batch, 3);
              let b2 = getTransforms(batch, 4);
              let b3 = getTransforms(batch, 5);
              let c1 = getTransforms(batch, 6);
              let c2 = getTransforms(batch, 7);
              let projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = uniforms.fillValue;
              } else {
                let inX = (a1 * xf + a2 * yf + a3) / projection;
                let inY = (b1 * xf + b2 * yf + b3) / projection;
                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));
                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));

                if (uniforms.interpolationModeId == 1) {
                  let coordY = i32(round(mapY));
                  let coordX = i32(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  let yFloor = floor(mapY);
                  let xFloor = floor(mapX);
                  let yCeil = yFloor + 1.0;
                  let xCeil = xFloor + 1.0;
                  let valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);
                  let valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutputAtIndex(index, outputValue);
            }
          }
        `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2e(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[d,h,f,p]=r.shape,[m,g]=c??[h,f],x=[d,m,g,p],y=new U2e(x),v=o==="nearest"?1:2;let S;switch(a){case"constant":S=1;break;case"reflect":S=2;break;case"wrap":S=3;break;case"nearest":S=4;break;default:S=1;break}const C=[{type:"int32",data:[v]},{type:"int32",data:[S]},{type:"float32",data:[l]}];return n.runWebGPUProgram(y,[r,i],"float32",C)}const G2e={kernelName:yI,backendName:"webgpu",kernelFunc:H2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K2e(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],c=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==i&&(c[d++]=o.shape[g]);const h=[],f=new Array(a).fill(0),p=o.shape.slice();p[i]=1;const m=new Array(l);for(let g=0;g<m.length;g++){f[i]=g;const x=mm({inputs:{x:o},backend:n,attrs:{begin:f,size:p}}),y=wt({inputs:{x},backend:n,attrs:{shape:c}});m[g]=y,h.push(x)}return h.forEach(g=>n.disposeData(g.dataId)),m}const q2e={kernelName:vI,backendName:"webgpu",kernelFunc:K2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X2e{constructor(e,n,s){if(this.outputShape=[],this.variableNames=["x","segmentIds"],this.uniforms="numSegments : i32, xSize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=n,this.dispatchLayout=at(e),this.dispatch=qe(this.dispatchLayout,e,this.workgroupSize),s!=="float32"&&s!=="int32")throw new Error(`UnsortedSegmentSum only supports float32 and int32
              types, does not support ${s} type.`);this.type=s,this.shaderKey="unsortedSegmentSum"}getUserCode(){return`
    ${Ke("index")} {
      if (index < uniforms.xSize) {
        let coords = getXCoordsFromIndex(index);
        let b = coords[0];
        let inCol = coords[1];

        let segmentId = i32(getSegmentIds(inCol));
        if (segmentId >= 0) {
          let flatIndex = b * uniforms.numSegments + segmentId % uniforms.numSegments;
          let value = getX(b, inCol);

          ${ld("&result[flatIndex]","value",this.type)}
        }
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let c=0;const d=Mr([c],a);let h=r;d!=null&&(h=Ol({inputs:{x:r},backend:n,attrs:{perm:d}}),l.push(h),c=Lr(1,a)[0]);const f=CR(h.shape,c,o),p=be([h.shape[c]]),m=wt({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(m);const g=r.dtype,x=[m.shape[0],o],y=vi({backend:n,attrs:{shape:x,value:0,dtype:g}}),v=new X2e(m.shape,x,g),S=[{type:"int32",data:[o]},{type:"int32",data:[be(m.shape)]}],C=n.runWebGPUProgram(v,[m,i],g,S,y),k=wt({inputs:{x:C},backend:n,attrs:{shape:f}});l.push(C);let T=k;if(d!=null){l.push(k);const _=$x(d);T=Ol({inputs:{x:T},backend:n,attrs:{perm:_}})}return l.forEach(_=>n.disposeData(_.dataId)),T}const Q2e={kernelName:bI,backendName:"webgpu",kernelFunc:Y2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2e=[vge,axe,cxe,dxe,fxe,gxe,Cxe,Nxe,_xe,$xe,Rxe,Axe,Dxe,Fxe,Lxe,Uxe,Gxe,Yxe,Zxe,eye,iye,cye,hye,gye,yye,Sye,wge,Nye,$ye,Fye,Wye,Kye,Yye,Zye,eve,nve,rve,ave,cve,dve,fve,gve,Cve,Nve,vve,Eve,Rve,Dve,Fve,Bve,Uve,Gve,qve,Yve,Zve,ebe,tbe,sbe,ibe,gge,abe,fbe,cbe,dbe,gbe,ybe,bbe,Cbe,Tbe,Ebe,Ibe,bge,Pbe,_ye,jbe,Obe,Mbe,Bbe,zbe,Ube,Kbe,Qbe,Xbe,Jbe,twe,swe,awe,uwe,Vxe,hwe,pwe,Swe,gwe,bwe,kwe,zxe,Twe,Ewe,Iwe,Pwe,Fwe,Vve,Lwe,Vwe,Wwe,fye,Gwe,qwe,Ywe,Jwe,t1e,s1e,i1e,a1e,pye,c1e,d1e,f1e,m1e,xge,y1e,w1e,k1e,_1e,I1e,P1e,j1e,O1e,M1e,V1e,U1e,G1e,q1e,Y1e,Z1e,e2e,sye,T2e,$2e,R2e,Dwe,n2e,i2e,u2e,h2e,x2e,v2e,w2e,S2e,k2e,A2e,zve,D2e,F2e,L2e,m2e,W2e,G2e,vxe,q2e,Q2e,Kwe];for(const t of Z2e)sW(t);/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var BU=function(t,e){return(BU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])})(t,e)};function VU(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}BU(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var ss=function(){return(ss=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function wn(t,e,n,s){return new(n||(n=Promise))(function(r,i){function o(c){try{l(s.next(c))}catch(d){i(d)}}function a(c){try{l(s.throw(c))}catch(d){i(d)}}function l(c){var d;c.done?r(c.value):(d=c.value,d instanceof n?d:new n(function(h){h(d)})).then(o,a)}l((s=s.apply(t,[])).next())})}function Sn(t,e){var n,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(c){return function(d){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&d[0]?s.return:d[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,d[1])).done)return r;switch(s=0,r&&(d=[2&d[0],r.value]),d[0]){case 0:case 1:r=d;break;case 4:return o.label++,{value:d[1],done:!1};case 5:o.label++,s=d[1],d=[0];continue;case 7:d=o.ops.pop(),o.trys.pop();continue;default:if(r=o.trys,!((r=r.length>0&&r[r.length-1])||d[0]!==6&&d[0]!==2)){o=0;continue}if(d[0]===3&&(!r||d[1]>r[0]&&d[1]<r[3])){o.label=d[1];break}if(d[0]===6&&o.label<r[1]){o.label=r[1],r=d;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(d);break}r[2]&&o.ops.pop(),o.trys.pop();continue}d=e.call(t,o)}catch(h){d=[6,h],s=0}finally{n=r=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}([l,c])}}}function Wd(t,e,n){if(n||arguments.length===2)for(var s,r=0,i=e.length;r<i;r++)!s&&r in e||(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var Fl=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],I0=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"];function Hb(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function zU(t){return wn(this,void 0,void 0,function(){var e,n;return Sn(this,function(s){switch(s.label){case 0:return e=document.createElement("canvas"),t instanceof js?[4,YI(t,e)]:[3,2];case 1:return s.sent(),[3,3];case 2:e.width=Hb(t.width),e.height=Hb(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),s.label=3;case 3:return[2,e]}})})}function WU(t){return wn(this,void 0,void 0,function(){var e,n,s,r,i,o;return Sn(this,function(a){switch(a.label){case 0:return t instanceof js?(e=t.shape.slice(0,2),n=e[0],s=e[1],r=ImageData.bind,[4,YI(t)]):[3,2];case 1:return[2,new(r.apply(ImageData,[void 0,a.sent(),s,n]))];case 2:return i=document.createElement("canvas"),o=i.getContext("2d"),i.width=Hb(t.width),i.height=Hb(t.height),o.drawImage(t,0,0),[2,o.getImageData(0,0,i.width,i.height)]}})})}function J2e(t){return wn(this,void 0,void 0,function(){var e,n;return Sn(this,function(s){switch(s.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,zU(t)]:[3,2];case 1:return n=s.sent(),[3,3];case 2:n=t,s.label=3;case 3:return e=n,[2,D6(e,4)]}})})}function UU(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(t));if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got ".concat(t))}var Wm={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},eSe=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,this.mask]})})},t.prototype.toImageData=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,WU(this.mask)]})})},t.prototype.toTensor=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,J2e(this.mask)]})})},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function tSe(t){return UU(t),"person"}var nSe=function(){function t(e){var n,s=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new _ne.Pose({locateFile:function(r,i){if(e.solutionPath){var o=e.solutionPath.replace(/\/+$/,"");return"".concat(o,"/").concat(r)}return"".concat(i,"/").concat(r)}}),e.modelType){case"lite":n=0;break;case"heavy":n=2;break;case"full":default:n=1}this.poseSolution.setOptions({modelComplexity:n,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults(function(r){if(s.height=r.image.height,s.width=r.image.width,r.poseLandmarks==null)s.poses=[];else{var i=s.translateOutput(r.poseLandmarks,r.poseWorldLandmarks);r.segmentationMask&&(i.segmentation={maskValueToLabel:tSe,mask:new eSe(r.segmentationMask)}),s.poses=[i]}})}return t.prototype.translateOutput=function(e,n){var s=this,r={keypoints:e.map(function(i,o){return{x:i.x*s.width,y:i.y*s.height,z:i.z,score:i.visibility,name:I0[o]}})};return n!=null&&(r.keypoints3D=n.map(function(i,o){return{x:i.x,y:i.y,z:i.z,score:i.visibility,name:I0[o]}})),r},t.prototype.estimatePoses=function(e,n,s){return wn(this,void 0,void 0,function(){var r,i;return Sn(this,function(o){switch(o.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof js?(i=ImageData.bind,[4,YI(e)]):[3,2];case 1:return r=new(i.apply(ImageData,[void 0,o.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,o.label=3;case 3:return e=r,[4,this.poseSolution.send({image:e},s)];case 4:return o.sent(),[2,this.poses]}})})},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function sSe(t){return wn(this,void 0,void 0,function(){var e,n;return Sn(this,function(s){switch(s.label){case 0:return e=function(r){if(r==null)return ss({},Wm);var i=ss({},r);return i.runtime="mediapipe",i.enableSegmentation==null&&(i.enableSegmentation=Wm.enableSegmentation),i.enableSmoothing==null&&(i.enableSmoothing=Wm.enableSmoothing),i.smoothSegmentation==null&&(i.smoothSegmentation=Wm.smoothSegmentation),i.modelType==null&&(i.modelType=Wm.modelType),i}(t),[4,(n=new nSe(e)).initialize()];case 1:return s.sent(),[2,n]}})})}function Vp(t){return t instanceof js?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function HU(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function IR(t){return t instanceof js?t:D6(t)}function GU(t,e,n){return pN(n,"inputResolution"),[1/n.width*t[0][0]*e.width,1/n.height*t[0][1]*e.width,t[0][3]*e.width,1/n.width*t[1][0]*e.height,1/n.height*t[1][1]*e.height,t[1][3]*e.height,0,0]}function pN(t,e){O(t.width!==0,function(){return"".concat(e," width cannot be 0.")}),O(t.height!==0,function(){return"".concat(e," height cannot be 0.")})}function nS(t,e,n){var s=n.rotationVectorStartKeypointIndex,r=n.rotationVectorEndKeypointIndex,i=t.locationData,o=i.relativeKeypoints[s].x*e.width,a=i.relativeKeypoints[s].y*e.height,l=i.relativeKeypoints[r].x*e.width,c=i.relativeKeypoints[r].y*e.height,d=2*Math.sqrt((l-o)*(l-o)+(c-a)*(c-a)),h=function(f,p,m){var g,x=f.locationData,y=m.rotationVectorStartKeypointIndex,v=m.rotationVectorEndKeypointIndex;g=m.rotationVectorTargetAngle?m.rotationVectorTargetAngle:Math.PI*m.rotationVectorTargetAngleDegree/180;var S=x.relativeKeypoints[y].x*p.width,C=x.relativeKeypoints[y].y*p.height,k=x.relativeKeypoints[v].x*p.width,T=x.relativeKeypoints[v].y*p.height;return HU(g-Math.atan2(-(T-C),k-S))}(t,e,n);return{xCenter:o/e.width,yCenter:a/e.height,width:d/e.width,height:d/e.height,rotation:h}}function KU(t){if(t.length!==16)throw new Error("Array length must be 16 but got ".concat(t.length));return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function sS(t,e,n,s,r,i,o){return t[e][r]*(t[n][i]*t[s][o]-t[n][o]*t[s][i])}function Wr(t,e,n){var s=(e+1)%4,r=(e+2)%4,i=(e+3)%4,o=(n+1)%4,a=(n+2)%4,l=(n+3)%4;return sS(t,s,r,i,o,a,l)+sS(t,r,i,s,o,a,l)+sS(t,i,s,r,o,a,l)}function hD(t,e,n){n===void 0&&(n={ignoreRotation:!1});for(var s=[],r=0,i=t;r<i.length;r++){var o=i[r],a=o.x-.5,l=o.y-.5,c=n.ignoreRotation?0:e.rotation,d=Math.cos(c)*a-Math.sin(c)*l,h=Math.sin(c)*a+Math.cos(c)*l;d=d*e.width+e.xCenter,h=h*e.height+e.yCenter;var f=o.z*e.width,p=ss({},o);p.x=d,p.y=h,p.z=f,s.push(p)}return s}function qU(t,e){var n=function(s,r,i,o){var a=r-s,l=o-i,c=l/a;return{scale:c,offset:i-s*c}}(0,255,e[0],e[1]);return Wt(function(){return Nt(We(t,n.scale),n.offset)})}function mN(t,e,n){var s,r,i,o,a,l,c,d,h,f,p,m,g,x,y=e.outputTensorSize,v=e.keepAspectRatio,S=e.borderMode,C=e.outputTensorFloatRange,k=Vp(t),T=function(R,A){return A?{xCenter:A.xCenter*R.width,yCenter:A.yCenter*R.height,width:A.width*R.width,height:A.height*R.height,rotation:A.rotation}:{xCenter:.5*R.width,yCenter:.5*R.height,width:R.width,height:R.height,rotation:0}}(k,n),_=function(R,A,j){if(j===void 0&&(j=!1),!j)return{top:0,left:0,right:0,bottom:0};var F=A.height,L=A.width;pN(A,"targetSize"),pN(R,"roi");var M,q,z=F/L,re=R.height/R.width,U=0,G=0;return z>re?(M=R.width,q=R.width*z,G=(1-re/z)/2):(M=R.height/z,q=R.height,U=(1-z/re)/2),R.width=M,R.height=q,{top:G,left:U,right:U,bottom:G}}(T,y,v),$=(s=T,r=k.width,i=k.height,o=!1,a=s.width,l=s.height,c=o?-1:1,d=Math.cos(s.rotation),h=Math.sin(s.rotation),f=s.xCenter,p=s.yCenter,m=1/r,g=1/i,(x=new Array(16))[0]=a*d*c*m,x[1]=-l*h*m,x[2]=0,x[3]=(-.5*a*d*c+.5*l*h+f)*m,x[4]=a*h*c*g,x[5]=l*d*g,x[6]=0,x[7]=(-.5*l*d-.5*a*h*c+p)*g,x[8]=0,x[9]=0,x[10]=a*m,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,KU(x));return{imageTensor:Wt(function(){var R=IR(t),A=ca(GU($,k,y),[1,8]),j=S==="zero"?"constant":"nearest",F=nh.transform(ho(rs(R,"float32")),A,"bilinear",j,0,[y.height,y.width]);return C!=null?qU(F,C):F}),padding:_,transformationMatrix:$}}function fD(t,e,n,s){return s===1?.5*(t+e):t+(e-t)*n/(s-1)}function rSe(t){return Wt(function(){var e=function(r){return Wt(function(){return[an(r,[0,0,0],[1,-1,1]),an(r,[0,0,1],[1,-1,-1])]})}(t),n=e[0],s=e[1];return{boxes:Yn(s),logits:Yn(n)}})}function XU(t){return t!=null&&t.currentTime!=null}function pD(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=0;o<t.length;++o){var a=t[o];n=Math.min(n,a.x),s=Math.max(s,a.x),r=Math.min(r,a.y),i=Math.max(i,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:r,xMax:s,yMax:i,width:s-n,height:i-r},e}function iSe(t,e,n,s){return wn(this,void 0,void 0,function(){var r,i,o,a,l;return Sn(this,function(c){switch(c.label){case 0:return t.sort(function(d,h){return Math.max.apply(Math,h.score)-Math.max.apply(Math,d.score)}),r=ca(t.map(function(d){return[d.locationData.relativeBoundingBox.yMin,d.locationData.relativeBoundingBox.xMin,d.locationData.relativeBoundingBox.yMax,d.locationData.relativeBoundingBox.xMax]})),i=Dr(t.map(function(d){return d.score[0]})),[4,nh.nonMaxSuppressionAsync(r,i,e,n)];case 1:return[4,(o=c.sent()).array()];case 2:return a=c.sent(),l=t.filter(function(d,h){return a.indexOf(h)>-1}),Un([r,i,o]),[2,l]}})})}function YU(t,e){return t.map(function(n){var s=ss(ss({},n),{x:n.x*e.width,y:n.y*e.height});return n.z!=null&&(s.z=n.z*e.width),s})}function oSe(t,e,n){return wn(this,void 0,void 0,function(){var s,r,i,o,a,l,c,d,h,f,p,m,g,x,y,v,S,C,k,T,_,$,R,A;return Sn(this,function(j){switch(j.label){case 0:if(s=Yn(e,[0]),r=s.shape,i=r[0],o=r[1],a=r[2],t.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(t.length,", heatmap length: ").concat(a));return l=[],[4,s.buffer()];case 1:for(c=j.sent(),d=0;d<t.length;d++)if(h=t[d],f=ss({},h),l.push(f),p=Math.trunc(f.x*o),m=Math.trunc(f.y*i),!(p<0||p>=o||m<0||p>=i)){for(g=Math.trunc((n.kernelSize-1)/2),x=Math.max(0,p-g),y=Math.min(o,p+g+1),v=Math.max(0,m-g),S=Math.min(i,m+g+1),C=0,k=0,T=0,_=0,$=v;$<S;++$)for(R=x;R<y;++R)A=c.get($,R,d),C+=A,_=Math.max(_,A),k+=R*A,T+=$*A;_>=n.minConfidenceToRefine&&C>0&&(f.x=k/o/C,f.y=T/i/C)}return s.dispose(),[2,l]}})})}function mD(t,e){var n=e.left,s=e.top,r=e.left+e.right,i=e.top+e.bottom;return t.map(function(o){return ss(ss({},o),{x:(o.x-n)/(1-r),y:(o.y-s)/(1-i),z:o.z/(1-r)})})}function aSe(t,e,n){return bh()==="webgl"?function(s,r,i){var o=i.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:s.shape,userCode:`
  void main() {
      ivec2 coords = getOutputCoords();
      int height = coords[0];
      int width = coords[1];

      float prevMaskValue = getPrevMask(height, width);
      float newMaskValue = getNewMask(height, width);

      /*
      * Assume p := newMaskValue
      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)
      * uncertainty alpha(p) =
      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the
      * uncertainty]
      *
      * The following polynomial approximates uncertainty alpha as a
      * function of (p + 0.5):
      */
      const float c1 = 5.68842;
      const float c2 = -0.748699;
      const float c3 = -57.8051;
      const float c4 = 291.309;
      const float c5 = -624.717;
      float t = newMaskValue - 0.5;
      float x = t * t;

      float uncertainty =
        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));

      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *
                             (uncertainty * `.concat(o,`);

      setOutput(outputValue);
    }
`)},l=Fp();return Wt(function(){var c=l.compileAndRun(a,[s,r]);return Li().makeTensorFromDataId(c.dataId,c.shape,c.dtype)})}(t,e,n):Wt(function(){var s=Qt(e,.5),r=la(s),i=Qt(1,C0(1,We(r,Nt(5.68842,We(r,Nt(-.748699,We(r,Nt(-57.8051,We(r,Nt(291.309,We(r,-624.717)))))))))));return Nt(e,We(Qt(t,e),We(i,n.combineWithPreviousRatio)))})}function lSe(t,e,n){return wn(this,void 0,void 0,function(){var s,r,i,o,a;return Sn(this,function(l){switch(l.label){case 0:return s=t[0],r=t[1],i=function(c,d,h){return Wt(function(){var f,p,m,g;h.reverseOutputOrder?(p=Yn(an(c,[0,h.boxCoordOffset+0],[-1,1])),f=Yn(an(c,[0,h.boxCoordOffset+1],[-1,1])),g=Yn(an(c,[0,h.boxCoordOffset+2],[-1,1])),m=Yn(an(c,[0,h.boxCoordOffset+3],[-1,1]))):(f=Yn(an(c,[0,h.boxCoordOffset+0],[-1,1])),p=Yn(an(c,[0,h.boxCoordOffset+1],[-1,1])),m=Yn(an(c,[0,h.boxCoordOffset+2],[-1,1])),g=Yn(an(c,[0,h.boxCoordOffset+3],[-1,1]))),p=Nt(We(dn(p,h.xScale),d.w),d.x),f=Nt(We(dn(f,h.yScale),d.h),d.y),h.applyExponentialOnBoxSize?(m=We($c(dn(m,h.hScale)),d.h),g=We($c(dn(g,h.wScale)),d.w)):(m=We(dn(m,h.hScale),d.h),g=We(dn(g,h.wScale),d.h));var x=Qt(f,dn(m,2)),y=Qt(p,dn(g,2)),v=Nt(f,dn(m,2)),S=Nt(p,dn(g,2)),C=gr([_e(x,[h.numBoxes,1]),_e(y,[h.numBoxes,1]),_e(v,[h.numBoxes,1]),_e(S,[h.numBoxes,1])],1);if(h.numKeypoints)for(var k=0;k<h.numKeypoints;++k){var T=h.keypointCoordOffset+k*h.numValuesPerKeypoint,_=void 0,$=void 0;h.reverseOutputOrder?(_=Yn(an(c,[0,T],[-1,1])),$=Yn(an(c,[0,T+1],[-1,1]))):($=Yn(an(c,[0,T],[-1,1])),_=Yn(an(c,[0,T+1],[-1,1])));var R=Nt(We(dn(_,h.xScale),d.w),d.x),A=Nt(We(dn($,h.yScale),d.h),d.y);C=gr([C,_e(R,[h.numBoxes,1]),_e(A,[h.numBoxes,1])],1)}return C})}(r,e,n),o=Wt(function(){var c=s;return n.sigmoidScore?(n.scoreClippingThresh!=null&&(c=UW(s,-n.scoreClippingThresh,n.scoreClippingThresh)),c=fc(c)):c}),[4,cSe(i,o,n)];case 1:return a=l.sent(),Un([i,o]),[2,a]}})})}function cSe(t,e,n){return wn(this,void 0,void 0,function(){var s,r,i,o,a,l,c,d,h,f,p,m;return Sn(this,function(g){switch(g.label){case 0:return s=[],[4,t.data()];case 1:return r=g.sent(),[4,e.data()];case 2:for(i=g.sent(),o=0;o<n.numBoxes;++o)if(!(n.minScoreThresh!=null&&i[o]<n.minScoreThresh||(a=o*n.numCoords,l=uSe(r[a+0],r[a+1],r[a+2],r[a+3],i[o],n.flipVertically,o),(c=l.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((d=l.locationData).relativeKeypoints=[],h=n.numKeypoints*n.numValuesPerKeypoint,f=0;f<h;f+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+f,m={x:r[p+0],y:n.flipVertically?1-r[p+1]:r[p+1]},d.relativeKeypoints.push(m);s.push(l)}return[2,s]}})})}function uSe(t,e,n,s,r,i,o){return{score:[r],ind:o,locationData:{relativeBoundingBox:{xMin:e,yMin:i?1-n:t,xMax:s,yMax:i?1-t:n,width:s-e,height:n-t}}}}function dSe(t,e){return t==="none"?e:function(n){return 1/(1+Math.exp(-n))}(e)}function gD(t,e,n,s){return wn(this,void 0,void 0,function(){var r,i,o,a,l,c,d,h;return Sn(this,function(f){switch(f.label){case 0:return n=n||e.flipHorizontally||!1,s=s||e.flipVertically||!1,r=t.size,i=r/e.numLandmarks,[4,t.data()];case 1:for(o=f.sent(),a=[],l=0;l<e.numLandmarks;++l)c=l*i,(h={x:0,y:0}).x=n?e.inputImageWidth-o[c]:o[c],i>1&&(h.y=s?e.inputImageHeight-o[c+1]:o[c+1]),i>2&&(h.z=o[c+2]),i>3&&(h.score=dSe(e.visibilityActivation,o[c+3])),a.push(h);for(d=0;d<a.length;++d)(h=a[d]).x=h.x/e.inputImageWidth,h.y=h.y/e.inputImageHeight,h.z=h.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}})})}function xD(t,e,n){var s=t.width,r=t.height,i=t.rotation;if(n.rotation==null&&n.rotationDegree==null||(i=function(c,d){return d.rotation!=null?c+=d.rotation:d.rotationDegree!=null&&(c+=Math.PI*d.rotationDegree/180),HU(c)}(i,n)),i===0)t.xCenter=t.xCenter+s*n.shiftX,t.yCenter=t.yCenter+r*n.shiftY;else{var o=(e.width*s*n.shiftX*Math.cos(i)-e.height*r*n.shiftY*Math.sin(i))/e.width,a=(e.width*s*n.shiftX*Math.sin(i)+e.height*r*n.shiftY*Math.cos(i))/e.height;t.xCenter=t.xCenter+o,t.yCenter=t.yCenter+a}{var l=Math.max(s*e.width,r*e.height);s=l/e.width,r=l/e.height}return t.width=s*n.scaleX,t.height=r*n.scaleY,t}function hSe(t,e){return t.map(function(n){var s=ss(ss({},n),{x:n.x/e.width,y:n.y/e.height});return n.z!=null&&(n.z=n.z/e.width),s})}var bu=function(){function t(e){this.alpha=e,this.initialized=!1}return t.prototype.apply=function(e,n){var s;return this.initialized?s=n==null?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*n*Math.asinh((e-this.storedValue)/n):(s=e,this.initialized=!0),this.rawValue=e,this.storedValue=s,s},t.prototype.applyWithAlpha=function(e,n,s){return this.alpha=n,this.apply(e,s)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),rS=function(){function t(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new bu(this.getAlpha(this.minCutOff)),this.dx=new bu(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(e,n,s){if(e==null)return e;var r=Math.trunc(n);if(this.lastTimestamp>=r)return e;this.lastTimestamp!==0&&r!==0&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var i=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*s*this.frequency:0,o=this.dx.applyWithAlpha(i,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(o),l=this.thresholdCutOff!=null?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(e,this.getAlpha(a),l)},t.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},t}(),gN=function(){function t(e){this.config=e}return t.prototype.apply=function(e,n,s){var r=this;if(e==null)return this.reset(),null;this.initializeFiltersIfEmpty(e);var i=1;if(!this.config.disableValueScaling){if(s<this.config.minAllowedObjectScale)return Wd([],e,!0);i=1/s}return e.map(function(o,a){var l=ss(ss({},o),{x:r.xFilters[a].apply(o.x,n,i),y:r.yFilters[a].apply(o.y,n,i)});return o.z!=null&&(l.z=r.zFilters[a].apply(o.z,n,i)),l})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var n=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(s){return new rS(n.config)}),this.yFilters=e.map(function(s){return new rS(n.config)}),this.zFilters=e.map(function(s){return new rS(n.config)}))},t}(),iS=function(){function t(e){this.config=e,this.window=[],this.lowPassFilter=new bu(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(e,n,s){if(e==null)return e;var r,i=Math.trunc(n);if(this.lastTimestamp>=i)return e;if(this.lastTimestamp===-1)r=1;else{for(var o=e*s-this.lastValue*this.lastValueScale,a=i-this.lastTimestamp,l=o,c=a,d=(1+this.window.length)*(1e6/30),h=0,f=this.window;h<f.length;h++){var p=f[h];if(c+p.duration>d)break;l+=p.distance,c+=p.duration}var m=l/(1e-6*c);r=1-1/(1+this.config.velocityScale*Math.abs(m)),this.window.unshift({distance:o,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=s,this.lastTimestamp=i,this.lowPassFilter.applyWithAlpha(e,r)},t}(),fSe=function(){function t(e){this.config=e}return t.prototype.apply=function(e,n,s){var r=this;if(e==null)return this.reset(),null;var i=1;if(!this.config.disableValueScaling){if(s<this.config.minAllowedObjectScale)return Wd([],e,!0);i=1/s}return this.initializeFiltersIfEmpty(e),e.map(function(o,a){var l=ss(ss({},o),{x:r.xFilters[a].apply(o.x,n,i),y:r.yFilters[a].apply(o.y,n,i)});return o.z!=null&&(l.z=r.zFilters[a].apply(o.z,n,i)),l})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var n=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(s){return new iS(n.config)}),this.yFilters=e.map(function(s){return new iS(n.config)}),this.zFilters=e.map(function(s){return new iS(n.config)}))},t}(),oS=function(){function t(e){if(e.velocityFilter!=null)this.keypointsFilter=new fSe(e.velocityFilter);else{if(e.oneEuroFilter==null)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(e,"."));this.keypointsFilter=new gN(e.oneEuroFilter)}}return t.prototype.apply=function(e,n,s,r,i){if(r===void 0&&(r=!1),e==null)return this.keypointsFilter.reset(),null;var o=i!=null?function(c,d){return(c.width*d.width+c.height*d.height)/2}(i,s):1,a=r?YU(e,s):e,l=this.keypointsFilter.apply(a,n,o);return r?hSe(l,s):l},t}(),yD=function(){function t(e){this.alpha=e.alpha}return t.prototype.apply=function(e){var n=this;if(e==null)return this.visibilityFilters=null,null;this.visibilityFilters!=null&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map(function(a){return new bu(n.alpha)}));for(var s=[],r=0;r<e.length;++r){var i=e[r],o=ss({},i);o.score=this.visibilityFilters[r].apply(i.score),s.push(o)}return s},t}(),pSe={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},hf={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},mSe={maxPoses:1,flipHorizontal:!1},gSe={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},xSe=.3,vD={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},ySe={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},vSe={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},bSe={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},wSe={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},SSe={kernelSize:7,minConfidenceToRefine:.5},bD={alpha:.1},CSe={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},kSe={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},NSe={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},TSe={activation:"none"},_Se={combineWithPreviousRatio:.7},ESe=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,zU(this.mask)]})})},t.prototype.toImageData=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,WU(this.mask)]})})},t.prototype.toTensor=function(){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,this.mask]})})},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function $Se(t){return UU(t),"person"}var ISe=function(){function t(e,n,s,r,i,o){this.detectorModel=e,this.landmarkModel=n,this.enableSmoothing=s,this.enableSegmentation=r,this.smoothSegmentation=i,this.modelType=o,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(h){h.reduceBoxesInLowestLayer==null&&(h.reduceBoxesInLowestLayer=!1),h.interpolatedScaleAspectRatio==null&&(h.interpolatedScaleAspectRatio=1),h.fixedAnchorSize==null&&(h.fixedAnchorSize=!1);for(var f=[],p=0;p<h.numLayers;){for(var m=[],g=[],x=[],y=[],v=p;v<h.strides.length&&h.strides[v]===h.strides[p];){var S=fD(h.minScale,h.maxScale,v,h.strides.length);if(v===0&&h.reduceBoxesInLowestLayer)x.push(1),x.push(2),x.push(.5),y.push(.1),y.push(S),y.push(S);else{for(var C=0;C<h.aspectRatios.length;++C)x.push(h.aspectRatios[C]),y.push(S);if(h.interpolatedScaleAspectRatio>0){var k=v===h.strides.length-1?1:fD(h.minScale,h.maxScale,v+1,h.strides.length);y.push(Math.sqrt(S*k)),x.push(h.interpolatedScaleAspectRatio)}}v++}for(var T=0;T<x.length;++T){var _=Math.sqrt(x[T]);m.push(y[T]/_),g.push(y[T]*_)}var $=0,R=0;if(h.featureMapHeight.length>0)$=h.featureMapHeight[p],R=h.featureMapWidth[p];else{var A=h.strides[p];$=Math.ceil(h.inputSizeHeight/A),R=Math.ceil(h.inputSizeWidth/A)}for(var j=0;j<$;++j)for(var F=0;F<R;++F)for(var L=0;L<m.length;++L){var M={xCenter:(F+h.anchorOffsetX)/R,yCenter:(j+h.anchorOffsetY)/$,width:0,height:0};h.fixedAnchorSize?(M.width=1,M.height=1):(M.width=g[L],M.height=m[L]),f.push(M)}p=v}return f}(pSe);var a=Dr(this.anchors.map(function(h){return h.width})),l=Dr(this.anchors.map(function(h){return h.height})),c=Dr(this.anchors.map(function(h){return h.xCenter})),d=Dr(this.anchors.map(function(h){return h.yCenter}));this.anchorTensor={x:c,y:d,w:a,h:l},this.prevFilteredSegmentationMask=this.enableSegmentation?ca([],[0,0]):null}return t.prototype.estimatePoses=function(e,n,s){return wn(this,void 0,void 0,function(){var r,i,o,a,l,c,d,h,f,p,m,g,x,y,v,S,C,k,T,_,$,R,A;return Sn(this,function(j){switch(j.label){case 0:return r=function(F){var L;if((L=F==null?mSe:ss({},F)).maxPoses==null&&(L.maxPoses=1),L.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(L.maxPoses,". Should be > 0."));if(L.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return L}(n),e==null?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=s!=null?1e3*s:XU(e)?1e6*e.currentTime:null,i=Vp(e),o=Wt(function(){return rs(IR(e),"float32")}),(a=this.regionOfInterest)!=null?[3,2]:[4,this.detectPose(o)]);case 1:if((l=j.sent()).length===0)return this.reset(),o.dispose(),[2,[]];c=l[0],a=this.poseDetectionToRoi(c,i),j.label=2;case 2:return[4,this.poseLandmarksByRoi(a,o)];case 3:return d=j.sent(),o.dispose(),d==null?(this.reset(),[2,[]]):(h=d.landmarks,f=d.auxiliaryLandmarks,p=d.poseScore,m=d.worldLandmarks,g=d.segmentationMask,x=this.poseLandmarkFiltering(h,f,m,i),y=x.actualLandmarksFiltered,v=x.auxiliaryLandmarksFiltered,S=x.actualWorldLandmarksFiltered,C=this.poseLandmarksToRoi(v,i),this.regionOfInterest=C,k=this.smoothSegmentation&&g!=null?this.poseSegmentationFiltering(g):g,(T=y!=null?YU(y,i):null)!=null&&T.forEach(function(F,L){F.name=I0[L]}),(_=S)!=null&&_.forEach(function(F,L){F.name=I0[L]}),$={score:p,keypoints:T,keypoints3D:_},k!==null&&(R=Wt(function(){var F=ho(k,2),L=Gu(F,[[0,0],[0,0],[0,1]]);return c6(L,[[0,0],[0,0],[0,2]],"symmetric")}),this.smoothSegmentation||Un(k),A={maskValueToLabel:$Se,mask:new ESe(R)},$.segmentation=A),[2,[$]])}})})},t.prototype.poseSegmentationFiltering=function(e){var n=this.prevFilteredSegmentationMask;return n.size===0?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=aSe(n,e,_Se),Un(e)),Un(n),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),Un([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(Un(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=ca([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(e){return wn(this,void 0,void 0,function(){var n,s,r,i,o,a,l,c,d,h;return Sn(this,function(f){switch(f.label){case 0:return n=mN(e,ySe),s=n.imageTensor,r=n.padding,i=this.detectorModel.predict(s),o=rSe(i),a=o.boxes,[4,lSe([l=o.logits,a],this.anchorTensor,gSe)];case 1:return(c=f.sent()).length===0?(Un([s,i,l,a]),[2,c]):[4,iSe(c,this.maxPoses,xSe)];case 2:return d=f.sent(),h=function(p,m){p===void 0&&(p=[]);for(var g=m.left,x=m.top,y=m.left+m.right,v=m.top+m.bottom,S=0;S<p.length;S++){var C=p[S],k=C.locationData.relativeBoundingBox,T=(k.xMin-g)/(1-y),_=(k.yMin-x)/(1-v),$=k.width/(1-y),R=k.height/(1-v);k.xMin=T,k.yMin=_,k.width=$,k.height=R,k.xMax=T+$,k.yMax=_+R;var A=C.locationData.relativeKeypoints;A&&A.forEach(function(j){var F=(j.x-g)/(1-y),L=(j.y-x)/(1-v);j.x=F,j.y=L})}return p}(d,r),Un([s,i,l,a]),[2,h]}})})},t.prototype.poseDetectionToRoi=function(e,n){return xD(nS(e,n,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),n,vD)},t.prototype.poseLandmarksByRoi=function(e,n){return wn(this,void 0,void 0,function(){var s,r,i,o,a,l,c,d,h,f,p,m,g,x;return Sn(this,function(y){switch(y.label){case 0:if(s=Vp(n),r=mN(n,vSe,e),i=r.imageTensor,o=r.padding,a=r.transformationMatrix,this.modelType!=="lite"&&this.modelType!=="full"&&this.modelType!=="heavy")throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return l=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&l.push("activation_segmentation"),c=this.landmarkModel.execute(i,l),[4,this.tensorsToPoseLandmarksAndSegmentation(c)];case 1:return(d=y.sent())==null?(Un(c),Un(i),[2,null]):(h=d.landmarks,f=d.auxiliaryLandmarks,p=d.poseScore,m=d.worldLandmarks,g=d.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(s,e,o,a,h,f,m,g)]);case 2:return x=y.sent(),Un(c),Un(i),[2,ss({poseScore:p},x)]}})})},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,n,s,r,i,o,a,l){return wn(this,void 0,void 0,function(){var c,d,h,f,p,m;return Sn(this,function(g){return c=mD(i,s),d=mD(o,s),h=hD(c,n),f=hD(d,n),p=function(x,y){for(var v=[],S=0,C=x;S<C.length;S++){var k=C[S],T=k.x,_=k.y,$=y.rotation,R=Math.cos($)*T-Math.sin($)*_,A=Math.sin($)*T+Math.cos($)*_,j=ss({},k);j.x=R,j.y=A,v.push(j)}return v}(a,n),m=null,this.enableSegmentation&&(m=Wt(function(){var x=l.shape,y=x[0],v=x[1],S=function(T){var _=KU(new Array(16).fill(0));_[0][0]=Wr(T,0,0),_[1][0]=-Wr(T,0,1),_[2][0]=Wr(T,0,2),_[3][0]=-Wr(T,0,3),_[0][2]=Wr(T,2,0),_[1][2]=-Wr(T,2,1),_[2][2]=Wr(T,2,2),_[3][2]=-Wr(T,2,3),_[0][1]=-Wr(T,1,0),_[1][1]=Wr(T,1,1),_[2][1]=-Wr(T,1,2),_[3][1]=Wr(T,1,3),_[0][3]=-Wr(T,3,0),_[1][3]=Wr(T,3,1),_[2][3]=-Wr(T,3,2),_[3][3]=Wr(T,3,3);for(var $=T[0][0]*_[0][0]+T[1][0]*_[0][1]+T[2][0]*_[0][2]+T[3][0]*_[0][3],R=0;R<_.length;R++)for(var A=0;A<_.length;A++)_[R][A]/=$;return _}(r),C=ca(GU(S,{width:v,height:y},e),[1,8]),k=[1,y,v,1];return Yn(nh.transform(_e(l,k),C,"bilinear","constant",0,[e.height,e.width]),[0,3])}),Un(l)),[2,{landmarks:h,auxiliaryLandmarks:f,worldLandmarks:p,segmentationMask:m}]})})},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return wn(this,void 0,void 0,function(){var n,s,r,i,o,a,l,c,d,h,f,p,m;return Sn(this,function(g){switch(g.label){case 0:return n=e[0],s=e[1],r=e[2],i=e[3],o=this.enableSegmentation?e[4]:null,[4,s.data()];case 1:return(a=g.sent()[0])<.5?[2,null]:[4,gD(n,bSe)];case 2:return[4,oSe(g.sent(),r,SSe)];case 3:return l=g.sent(),c=l.slice(0,33),d=l.slice(33,35),[4,gD(i,wSe)];case 4:return h=g.sent(),f=h.slice(0,33),p=function(x,y,v){for(var S=[],C=0;C<x.length;C++){var k=ss({},y[C]);k.score=x[C].score,S.push(k)}return S}(c,f),m=this.enableSegmentation?function(x,y,v){return Wt(function(){var S=Yn(x,[0]),C=S.shape[2];if(C===1){var k=S;switch(y.activation){case"none":break;case"sigmoid":k=fc(k);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(y.activation,")"))}var T=k;return Yn(T,[2])}throw new Error("Unsupported number of tensor channels ".concat(C))})}(o,TSe):null,[2,{landmarks:c,auxiliaryLandmarks:d,poseScore:a,worldLandmarks:p,segmentationMask:m}]}})})},t.prototype.poseLandmarksToRoi=function(e,n){return xD(nS(pD(e),n,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),n,vD)},t.prototype.poseLandmarkFiltering=function(e,n,s,r){var i,o,a;if(this.timestamp!=null&&this.enableSmoothing){var l=nS(pD(n),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});this.visibilitySmoothingFilterActual==null&&(this.visibilitySmoothingFilterActual=new yD(bD)),i=this.visibilitySmoothingFilterActual.apply(e),this.visibilitySmoothingFilterAuxiliary==null&&(this.visibilitySmoothingFilterAuxiliary=new yD(bD)),o=this.visibilitySmoothingFilterAuxiliary.apply(n),a=this.visibilitySmoothingFilterActual.apply(s),this.landmarksSmoothingFilterActual==null&&(this.landmarksSmoothingFilterActual=new oS(CSe)),i=this.landmarksSmoothingFilterActual.apply(i,this.timestamp,r,!0,l),this.landmarksSmoothingFilterAuxiliary==null&&(this.landmarksSmoothingFilterAuxiliary=new oS(kSe)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,l),this.worldLandmarksSmoothingFilterActual==null&&(this.worldLandmarksSmoothingFilterActual=new oS(NSe)),a=this.worldLandmarksSmoothingFilterActual.apply(s,this.timestamp)}else i=e,o=n,a=s;return{actualLandmarksFiltered:i,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:a}},t}();function RSe(t){return wn(this,void 0,void 0,function(){var e,n,s,r,i,o;return Sn(this,function(a){switch(a.label){case 0:return e=function(l){var c=ss({},l??hf);if(c.enableSmoothing==null&&(c.enableSmoothing=hf.enableSmoothing),c.enableSegmentation==null&&(c.enableSegmentation=hf.enableSegmentation),c.smoothSegmentation==null&&(c.smoothSegmentation=hf.smoothSegmentation),c.modelType==null&&(c.modelType=hf.modelType),c.detectorModelUrl==null&&(c.detectorModelUrl=hf.detectorModelUrl),c.landmarkModelUrl==null)switch(c.modelType){case"lite":c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;case"full":default:c.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return c}(t),n=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,s=typeof e.landmarkModelUrl=="string"&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([Lp(e.detectorModelUrl,{fromTFHub:n}),Lp(e.landmarkModelUrl,{fromTFHub:s})])];case 1:return r=a.sent(),i=r[0],o=r[1],[2,new ISe(i,o,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}})})}var rh,Wa,QU=function(){function t(e){(function(n){if(n.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(n.maxTracks));if(n.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(n.maxAge));if(n.keypointTrackerParams!==void 0){if(n.keypointTrackerParams.keypointConfidenceThreshold<0||n.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(n.keypointTrackerParams.keypointConfidenceThreshold));if(n.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(n.keypointTrackerParams.minNumberOfKeypoints));for(var s=0,r=n.keypointTrackerParams.keypointFalloff;s<r.length;s++){var i=r[s];if(i<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(i))}}})(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return t.prototype.apply=function(e,n){this.filterOldTracks(n);var s=this.computeSimilarity(e);return this.assignTracks(e,s,n),this.updateTracks(n),e},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map(function(e){return e.id}))},t.prototype.filterOldTracks=function(e){var n=this;this.tracks=this.tracks.filter(function(s){return e-s.lastTimestamp<=n.maxAge})},t.prototype.assignTracks=function(e,n,s){for(var r=Array.from(Array(n[0].length).keys()),i=[],o=0,a=Array.from(Array(e.length).keys());o<a.length;o++){var l=a[o];if(r.length!==0){for(var c=-1,d=-1,h=0,f=r;h<f.length;h++){var p=f[h],m=n[l][p];m>=this.minSimilarity&&m>d&&(c=p,d=m)}if(c>=0){var g=this.tracks[c];g=Object.assign(g,this.createTrack(e[l],s,g.id)),e[l].id=g.id;var x=r.indexOf(c);r.splice(x,1)}else i.push(l)}else i.push(l)}for(var y=0,v=i;y<v.length;y++){l=v[y];var S=this.createTrack(e[l],s);this.tracks.push(S),e[l].id=S.id}},t.prototype.updateTracks=function(e){this.tracks.sort(function(n,s){return s.lastTimestamp-n.lastTimestamp}),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(e,n,s){var r={id:s||this.nextTrackID(),lastTimestamp:n,keypoints:Wd([],e.keypoints,!0).map(function(i){return ss({},i)})};return e.box!==void 0&&(r.box=ss({},e.box)),r},t.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},t.prototype.remove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.tracks=this.tracks.filter(function(s){return!e.includes(s.id)})},t.prototype.reset=function(){this.tracks=[]},t}(),PSe=function(t){function e(n){return t.call(this,n)||this}return VU(e,t),e.prototype.computeSimilarity=function(n){var s=this;return n.length===0||this.tracks.length===0?[[]]:n.map(function(r){return s.tracks.map(function(i){return s.iou(r,i)})})},e.prototype.iou=function(n,s){var r=Math.max(n.box.xMin,s.box.xMin),i=Math.max(n.box.yMin,s.box.yMin),o=Math.min(n.box.xMax,s.box.xMax),a=Math.min(n.box.yMax,s.box.yMax);if(r>=o||i>=a)return 0;var l=(o-r)*(a-i);return l/(n.box.width*n.box.height+s.box.width*s.box.height-l)},e}(QU),ASe=function(t){function e(n){var s=t.call(this,n)||this;return s.keypointThreshold=n.keypointTrackerParams.keypointConfidenceThreshold,s.keypointFalloff=n.keypointTrackerParams.keypointFalloff,s.minNumKeyoints=n.keypointTrackerParams.minNumberOfKeypoints,s}return VU(e,t),e.prototype.computeSimilarity=function(n){if(n.length===0||this.tracks.length===0)return[[]];for(var s=[],r=0,i=n;r<i.length;r++){for(var o=i[r],a=[],l=0,c=this.tracks;l<c.length;l++){var d=c[l];a.push(this.oks(o,d))}s.push(a)}return s},e.prototype.oks=function(n,s){for(var r=this.area(s.keypoints)+1e-6,i=0,o=0,a=0;a<n.keypoints.length;++a){var l=n.keypoints[a],c=s.keypoints[a];if(!(l.score<this.keypointThreshold||c.score<this.keypointThreshold)){o+=1;var d=Math.pow(l.x-c.x,2)+Math.pow(l.y-c.y,2),h=2*this.keypointFalloff[a];i+=Math.exp(-1*d/(2*r*Math.pow(h,2)))}}return o<this.minNumKeyoints?0:i/o},e.prototype.area=function(n){var s=this,r=n.filter(function(l){return l.score>s.keypointThreshold}),i=Math.min.apply(Math,Wd([1],r.map(function(l){return l.x}),!1)),o=Math.max.apply(Math,Wd([0],r.map(function(l){return l.x}),!1)),a=Math.min.apply(Math,Wd([1],r.map(function(l){return l.y}),!1));return(o-i)*(Math.max.apply(Math,Wd([0],r.map(function(l){return l.y}),!1))-a)},e}(QU);function jSe(t){switch(t){case Wa.BlazePose:return I0.reduce(function(e,n,s){return e[n]=s,e},{});case Wa.PoseNet:case Wa.MoveNet:return Fl.reduce(function(e,n,s){return e[n]=s,e},{});default:throw new Error("Model ".concat(t," is not supported."))}}(function(t){t.Keypoint="keypoint",t.BoundingBox="boundingBox"})(rh||(rh={})),function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(Wa||(Wa={}));var wD=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],ZU={modelType:"SinglePose.Lightning",enableSmoothing:!0},SD={},CD={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},aS={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},kD={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function DSe(t,e,n,s){for(var r={},i=0,o=Fl;i<o.length;i++){var a=o[i];r[a]=[e[n[a]].y*s.height,e[n[a]].x*s.width]}if(function(v,S){return(v[S.left_hip].score>.2||v[S.right_hip].score>.2)&&(v[S.left_shoulder].score>.2||v[S.right_shoulder].score>.2)}(e,n)){var l=(r.left_hip[0]+r.right_hip[0])/2,c=(r.left_hip[1]+r.right_hip[1])/2,d=function(v,S,C,k,T){for(var _=["left_shoulder","right_shoulder","left_hip","right_hip"],$=0,R=0,A=0;A<_.length;A++)(q=Math.abs(k-C[_[A]][0]))>$&&($=q),(z=Math.abs(T-C[_[A]][1]))>R&&(R=z);for(var j=0,F=0,L=0,M=Object.keys(C);L<M.length;L++){var q,z,re=M[L];v[S[re]].score<.2||((q=Math.abs(k-C[re][0]))>j&&(j=q),(z=Math.abs(T-C[re][1]))>F&&(F=z))}return[$,R,j,F]}(e,n,r,l,c),h=d[0],f=d[1],p=d[2],m=d[3],g=Math.max(1.9*f,1.9*h,1.2*p,1.2*m),x=[l-(g=Math.min(g,Math.max(c,s.width-c,l,s.height-l))),c-g];if(g>Math.max(s.width,s.height)/2)return xN(t==null,s);var y=2*g;return{yMin:x[0]/s.height,xMin:x[1]/s.width,yMax:(x[0]+y)/s.height,xMax:(x[1]+y)/s.width,height:(x[0]+y)/s.height-x[0]/s.height,width:(x[1]+y)/s.width-x[1]/s.width}}return xN(t==null,s)}function xN(t,e){var n,s,r,i;return t?e.width>e.height?(n=1,s=e.height/e.width,r=0,i=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,s=1,r=(e.height/2-e.width/2)/e.height,i=0):e.width>e.height?(n=e.width/e.height,s=1,r=(e.height/2-e.width/2)/e.height,i=0):(n=1,s=e.height/e.width,r=0,i=(e.width/2-e.height/2)/e.width),{yMin:r,xMin:i,yMax:r+n,xMax:i+s,height:n,width:s}}function OSe(t){var e,n=t==null?ZU:ss({},t);if(n.modelType==null)n.modelType="SinglePose.Lightning";else if(wD.indexOf(n.modelType)<0)throw new Error("Invalid architecture ".concat(n.modelType,". ")+"Should be one of ".concat(wD));if(n.enableSmoothing==null&&(n.enableSmoothing=!0),n.minPoseScore!=null&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(n.multiPoseMaxDimension!=null&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if(n.modelType==="MultiPose.Lightning"&&n.enableTracking==null&&(n.enableTracking=!0),n.modelType==="MultiPose.Lightning"&&n.enableTracking===!0)if(n.trackerType==null&&(n.trackerType=rh.BoundingBox),n.trackerType===rh.Keypoint)n.trackerConfig!=null?n.trackerConfig=function(s){var r=ND(aS,s);return r.keypointTrackerParams=ss({},aS.keypointTrackerParams),s.keypointTrackerParams!=null&&(s.keypointTrackerParams.keypointConfidenceThreshold!=null&&(r.keypointTrackerParams.keypointConfidenceThreshold=s.keypointTrackerParams.keypointConfidenceThreshold),s.keypointTrackerParams.keypointFalloff!=null&&(r.keypointTrackerParams.keypointFalloff=s.keypointTrackerParams.keypointFalloff),s.keypointTrackerParams.minNumberOfKeypoints!=null&&(r.keypointTrackerParams.minNumberOfKeypoints=s.keypointTrackerParams.minNumberOfKeypoints)),r}(n.trackerConfig):n.trackerConfig=aS;else{if(n.trackerType!==rh.BoundingBox)throw new Error("Tracker type not supported by MoveNet");n.trackerConfig!=null?n.trackerConfig=(e=n.trackerConfig,ND(kD,e)):n.trackerConfig=kD}return n}function ND(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return e.maxTracks!=null&&(n.maxTracks=e.maxTracks),e.maxAge!=null&&(n.maxAge=e.maxAge),e.minSimilarity!=null&&(n.minSimilarity=e.minSimilarity),n}var FSe=function(){function t(e,n){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=jSe(Wa.MoveNet),n.modelType==="SinglePose.Lightning"?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):n.modelType==="SinglePose.Thunder"&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel=n.modelType==="MultiPose.Lightning",this.multiPoseModel||(this.keypointFilter=new gN(CD),this.cropRegionFilterYMin=new bu(.9),this.cropRegionFilterXMin=new bu(.9),this.cropRegionFilterYMax=new bu(.9),this.cropRegionFilterXMax=new bu(.9)),this.enableSmoothing=n.enableSmoothing,n.minPoseScore?this.minPoseScore=n.minPoseScore:this.minPoseScore=.25,n.multiPoseMaxDimension?this.multiPoseMaxDimension=n.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=n.enableTracking,this.multiPoseModel&&this.enableTracking&&(n.trackerType===rh.Keypoint?this.tracker=new ASe(n.trackerConfig):n.trackerType===rh.BoundingBox&&(this.tracker=new PSe(n.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(e){return wn(this,void 0,void 0,function(){var n,s,r,i,o;return Sn(this,function(a){switch(a.label){case 0:if((n=this.moveNetModel.execute(e)).shape.length!==4||n.shape[0]!==1||n.shape[1]!==1||n.shape[2]!==17||n.shape[3]!==3)throw n.dispose(),new Error("Unexpected output shape from model: [".concat(n.shape,"]"));return bh()==="webgpu"?[3,1]:(s=n.dataSync(),[3,3]);case 1:return[4,n.data()];case 2:s=a.sent(),a.label=3;case 3:for(n.dispose(),r={keypoints:[],score:0},i=0,o=0;o<17;++o)r.keypoints[o]={y:s[3*o],x:s[3*o+1],score:s[3*o+2]},r.keypoints[o].score>.2&&(++i,r.score+=r.keypoints[o].score);return i>0&&(r.score/=i),[2,r]}})})},t.prototype.runMultiPersonPoseModel=function(e){return wn(this,void 0,void 0,function(){var n,s,r,i,o,a,l,c;return Sn(this,function(d){switch(d.label){case 0:if((n=this.moveNetModel.execute(e)).shape.length!==3||n.shape[0]!==1||n.shape[2]!==56)throw n.dispose(),new Error("Unexpected output shape from model: [".concat(n.shape,"]"));return bh()==="webgpu"?[3,1]:(s=n.dataSync(),[3,3]);case 1:return[4,n.data()];case 2:s=d.sent(),d.label=3;case 3:for(n.dispose(),r=[],i=s.length/56,o=0;o<i;++o)for(r[o]={keypoints:[]},a=56*o+51,r[o].box={yMin:s[a],xMin:s[a+1],yMax:s[a+2],xMax:s[a+3],width:s[a+3]-s[a+1],height:s[a+2]-s[a]},l=56*o+55,r[o].score=s[l],r[o].keypoints=[],c=0;c<17;++c)r[o].keypoints[c]={y:s[56*o+3*c],x:s[56*o+3*c+1],score:s[56*o+3*c+2]};return[2,r]}})})},t.prototype.estimatePoses=function(e,n,s){return n===void 0&&(n=SD),wn(this,void 0,void 0,function(){var r,i,o,a,l,c;return Sn(this,function(d){switch(d.label){case 0:return n=function(h){return h==null?SD:ss({},h)}(n),e==null?(this.reset(),[2,[]]):(s==null?XU(e)&&(s=1e6*e.currentTime):s*=1e3,r=IR(e),i=Vp(r),o=ho(r,0),e instanceof js||r.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(o,i,s)]);case 1:return a=d.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(o,i,s)];case 3:a=d.sent(),d.label=4;case 4:for(l=0;l<a.length;++l)for(c=0;c<a[l].keypoints.length;++c)a[l].keypoints[c].name=Fl[c],a[l].keypoints[c].y*=i.height,a[l].keypoints[c].x*=i.width;return[2,a]}})})},t.prototype.estimateSinglePose=function(e,n,s){return wn(this,void 0,void 0,function(){var r,i,o,a,l=this;return Sn(this,function(c){switch(c.label){case 0:return this.cropRegion||(this.cropRegion=xN(this.cropRegion==null,n)),r=Wt(function(){var d=ca([[l.cropRegion.yMin,l.cropRegion.xMin,l.cropRegion.yMax,l.cropRegion.xMax]]),h=Rc([1],"int32"),f=[l.modelInputResolution.height,l.modelInputResolution.width];return rs(nh.cropAndResize(e,d,h,f,"bilinear",0),"int32")}),e.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(i=c.sent(),r.dispose(),i.score<this.minPoseScore)return this.reset(),[2,[]];for(o=0;o<i.keypoints.length;++o)i.keypoints[o].y=this.cropRegion.yMin+i.keypoints[o].y*this.cropRegion.height,i.keypoints[o].x=this.cropRegion.xMin+i.keypoints[o].x*this.cropRegion.width;return s!=null&&this.enableSmoothing&&(i.keypoints=this.keypointFilter.apply(i.keypoints,s,1)),a=DSe(this.cropRegion,i.keypoints,this.keypointIndexByName,n),this.cropRegion=this.filterCropRegion(a),[2,[i]]}})})},t.prototype.estimateMultiplePoses=function(e,n,s){return wn(this,void 0,void 0,function(){var r,i,o,a,l,c,d,h,f,p,m,g=this;return Sn(this,function(x){switch(x.label){case 0:return n.width>n.height?(i=this.multiPoseMaxDimension,o=Math.round(this.multiPoseMaxDimension*n.height/n.width),r=nh.resizeBilinear(e,[o,i]),l=i,c=32*Math.ceil(o/32),a=Gu(r,[[0,0],[0,c-o],[0,0],[0,0]])):(i=Math.round(this.multiPoseMaxDimension*n.width/n.height),o=this.multiPoseMaxDimension,r=nh.resizeBilinear(e,[o,i]),l=32*Math.ceil(i/32),c=o,a=Gu(r,[[0,0],[0,0],[0,l-i],[0,0]])),r.dispose(),e.dispose(),d=rs(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(d)];case 1:for(h=x.sent(),d.dispose(),h=h.filter(function(y){return y.score>=g.minPoseScore}),p=0;p<h.length;++p)for(f=0;f<h[p].keypoints.length;++f)h[p].keypoints[f].y*=c/o,h[p].keypoints[f].x*=l/i;if(this.enableTracking&&(this.tracker.apply(h,s),this.enableSmoothing)){for(p=0;p<h.length;++p)this.keypointFilterMap.has(h[p].id)||this.keypointFilterMap.set(h[p].id,new gN(CD)),h[p].keypoints=this.keypointFilterMap.get(h[p].id).apply(h[p].keypoints,s,1);m=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach(function(y,v){m.has(v)||g.keypointFilterMap.delete(v)})}return[2,h]}})})},t.prototype.filterCropRegion=function(e){if(e){var n=this.cropRegionFilterYMin.apply(e.yMin),s=this.cropRegionFilterXMin.apply(e.xMin),r=this.cropRegionFilterYMax.apply(e.yMax),i=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:n,xMin:s,yMax:r,xMax:i,height:r-n,width:i-s}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function MSe(t){return t===void 0&&(t=ZU),wn(this,void 0,void 0,function(){var e,n,s,r;return Sn(this,function(i){switch(i.label){case 0:return e=OSe(t),s=!0,e.modelUrl?(s=typeof e.modelUrl=="string"&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,Lp(e.modelUrl,{fromTFHub:s})]):[3,2];case 1:return n=i.sent(),[3,4];case 2:return r=void 0,e.modelType==="SinglePose.Lightning"?r="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":e.modelType==="SinglePose.Thunder"?r="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":e.modelType==="MultiPose.Lightning"&&(r="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,Lp(r,{fromTFHub:s})];case 3:n=i.sent(),i.label=4;case 4:return bh()==="webgl"&&ue().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new FSe(n,e)]}})})}var TD={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},_D=["MobileNetV1","ResNet50"],ED={MobileNetV1:[8,16],ResNet50:[16]},LSe=[8,16,32],$D={MobileNetV1:[.5,.75,1],ResNet50:[1]},ID=[1,2,4],RD={maxPoses:1,flipHorizontal:!1},BSe={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},VSe=[-123.15,-115.9,-103.06];function lS(t){return Math.floor(t/2)}var zSe=function(){function t(e,n){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=n}return t.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},t.prototype.empty=function(){return this.numberOfElements===-1},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(e){for(;e>0&&this.less(lS(e),e);)this.exchange(e,lS(e)),e=lS(e)},t.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var n=2*e;if(n<this.numberOfElements&&this.less(n,n+1)&&n++,!this.less(e,n))break;this.exchange(e,n),e=n}},t.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},t.prototype.less=function(e,n){return this.getValueAt(e)<this.getValueAt(n)},t.prototype.exchange=function(e,n){var s=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[n],this.priorityQueue[n]=s},t}();function WSe(t,e,n,s,r,i){for(var o=i.shape,a=o[0],l=o[1],c=!0,d=Math.max(n-r,0),h=Math.min(n+r+1,a),f=d;f<h;++f){for(var p=Math.max(s-r,0),m=Math.min(s+r+1,l),g=p;g<m;++g)if(i.get(f,g,t)>e){c=!1;break}if(!c)break}return c}function USe(t){return wn(this,void 0,void 0,function(){return Sn(this,function(e){return[2,Promise.all(t.map(function(n){return n.buffer()}))]})})}function JU(t,e,n,s){return{y:s.get(t,e,n),x:s.get(t,e,n+17)}}function e8(t,e,n){var s=JU(t.heatmapY,t.heatmapX,t.id,n),r=s.y,i=s.x;return{x:t.heatmapX*e+i,y:t.heatmapY*e+r}}function t8(t,e,n,s){var r=n.x,i=n.y;return t.some(function(o){var a,l,c,d,h,f,p=o.keypoints;return a=i,l=r,c=p[s].y,d=p[s].x,(h=c-a)*h+(f=d-l)*f<=e})}var PD=Fl.reduce(function(t,e,n){return t[e]=n,t},{}),n8=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map(function(t){var e=t[0],n=t[1];return[PD[e],PD[n]]}),cS=n8.map(function(t){return t[1]}),AD=n8.map(function(t){return t[0]});function jD(t,e,n){return t<e?e:t>n?n:t}function uS(t,e,n,s){return{y:jD(Math.round(t.y/e),0,n-1),x:jD(Math.round(t.x/e),0,s-1)}}function DD(t,e){return{x:t.x+e.x,y:t.y+e.y}}function OD(t,e,n,s,r,i,o,a){a===void 0&&(a=2);for(var l=s.shape,c=l[0],d=l[1],h={y:e.y,x:e.x},f=DD(h,function(v,S,C){var k=C.shape[2]/2;return{y:C.get(S.y,S.x,v),x:C.get(S.y,S.x,k+v)}}(t,uS(h,i,c,d),o)),p=0;p<a;p++){var m=uS(f,i,c,d),g=JU(m.y,m.x,n,r);f=DD({x:m.x*i,y:m.y*i},{x:g.x,y:g.y})}var x=uS(f,i,c,d),y=s.get(x.y,x.x,n);return{y:f.y,x:f.x,name:Fl[n],score:y}}function HSe(t,e,n,s,r,i){var o=e.shape[2],a=cS.length,l=new Array(o),c=t.part,d=t.score,h=e8(c,s,n);l[c.id]={score:d,name:Fl[c.id],y:h.y,x:h.x};for(var f=a-1;f>=0;--f){var p=cS[f],m=AD[f];l[p]&&!l[m]&&(l[m]=OD(f,l[p],m,e,n,s,i))}for(f=0;f<a;++f)p=AD[f],m=cS[f],l[p]&&!l[m]&&(l[m]=OD(f,l[p],m,e,n,s,r));return l}function GSe(t,e,n){return n.reduce(function(s,r,i){var o=r.y,a=r.x,l=r.score;return t8(t,e,{y:o,x:a},i)||(s+=l),s},0)/n.length}function KSe(t,e,n,s,r,i,o,a){return o===void 0&&(o=.5),a===void 0&&(a=20),wn(this,void 0,void 0,function(){var l,c,d,h,f,p,m,g,x,y,v,S;return Sn(this,function(C){switch(C.label){case 0:return[4,USe([t,e,n,s])];case 1:for(l=C.sent(),c=l[0],d=l[1],h=l[2],f=l[3],p=[],m=function(k,T,_){for(var $=_.shape,R=$[0],A=$[1],j=$[2],F=new zSe(R*A*j,function(re){return re.score}),L=0;L<R;++L)for(var M=0;M<A;++M)for(var q=0;q<j;++q){var z=_.get(L,M,q);z<k||WSe(q,z,L,M,T,_)&&F.enqueue({score:z,part:{heatmapY:L,heatmapX:M,id:q}})}return F}(o,1,c),g=a*a;p.length<i&&!m.empty();)x=m.dequeue(),y=e8(x.part,r,d),t8(p,g,y,x.part.id)||(v=HSe(x,c,d,r,h,f),S=GSe(p,g,v),p.push({keypoints:v,score:S}));return[2,p]}})})}function s8(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];switch(e.length){case 0:t="fn main() ";break;case 1:t="fn main(".concat(e[0]," : i32)");break;default:throw Error("Unreachable")}return t}var qSe=function(){function t(e){this.variableNames=["A","B"],this.size=!0,this.workgroupSize=[32,1,1],this.outputShape=[e[0],1],this.dispatchLayout=at(this.outputShape),this.dispatch=qe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return t.prototype.getUserCode=function(){return`
        `.concat(s8("index"),` {
          if (index < uniforms.size) {
            let y = B[index * 2];
            let x = B[index * 2 + 1];
            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;
            result[index] = A[outIndex];
          }
        }
        `)},t}();function XSe(t,e){if(Fp()instanceof fm)return function(n,s){var r=Fp(),i=new qSe(s.shape),o=r.runWebGPUProgram(i,[n,s],"float32");return Li().makeTensorFromTensorInfo(o)}(t,e);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}var YSe=function(){function t(e){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,e.length!==2||e[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(e));this.workgroupSize=[32,1,1],this.outputShape=e;var n=[e[0],1];this.dispatchLayout=at(n),this.dispatch=qe(this.dispatchLayout,n,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return t.prototype.getUserCode=function(){return`
    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {
      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;
      let outIndexX = outIndexY + uniforms.bShape.z;
      let outY = i32(B[outIndexY]);
      let outX = i32(B[outIndexX]);
      return vec2<i32>(outY, outX);
    }

    `.concat(s8("index"),` {
      if (index < uniforms.size) {
        let indexY = index * `).concat(this.supportedLastDimension,`;
        let indexX = indexY + 1;
        let heatmapY = A[indexY];
        let heatmapX = A[indexX];
        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);
        result[indexY] = f32(out[0]);
        result[indexX] = f32(out[1]);
      }
    }
    `)},t}();function QSe(t,e){if(Fp()instanceof fm)return function(n,s){var r=Fp(),i=new YSe(n.shape),o=r.runWebGPUProgram(i,[n,s],"float32");return Li().makeTensorFromTensorInfo(o)}(t,e);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}function r8(t){var e=t.shape,n=e[0],s=e[1],r=e[2];return Wt(function(){var i,o,a=_e(t,[n*s,r]),l=BW(a,0),c=ho(dn(l,ln(s,"int32")),1),d=ho((i=l,o=s,Wt(function(){var h=dn(i,ln(o,"int32"));return Qt(i,We(h,ln(o,"int32")))})),1);return gr([c,d],1)})}function ZSe(t,e,n){return Wt(function(){var s=function(r,i){for(var o=[],a=0;a<Fl.length;a++){var l=r.get(a,0).valueOf(),c=r.get(a,1).valueOf(),d=JSe(l,c,a,i),h=d.x,f=d.y;o.push(f),o.push(h)}return ca(o,[Fl.length,2])}(t,n);return Nt(rs(We(t.toTensor(),ln(e,"int32")),"float32"),s)})}function JSe(t,e,n,s){return{y:s.get(t,e,n),x:s.get(t,e,n+Fl.length)}}function eCe(t,e,n){return wn(this,void 0,void 0,function(){var s,r,i,o,a,l,c,d,h,f;return Sn(this,function(p){switch(p.label){case 0:return s=0,r=r8(t),[4,Promise.all([t.buffer(),e.buffer(),r.buffer()])];case 1:return i=p.sent(),o=i[0],a=i[1],l=i[2],[4,(c=ZSe(l,n,a)).buffer()];case 2:return d=p.sent(),h=Array.from(function(m,g){for(var x=g.shape[0],y=new Float32Array(x),v=0;v<x;v++){var S=g.get(v,0),C=g.get(v,1);y[v]=m.get(S,C,v)}return y}(o,l)),f=h.map(function(m,g){return s+=m,{y:d.get(g,0),x:d.get(g,1),score:m,name:Fl[g]}}),r.dispose(),c.dispose(),[2,{keypoints:f,score:s/f.length}]}})})}function tCe(t,e,n){return wn(this,void 0,void 0,function(){var s,r,i;return Sn(this,function(o){return s=r8(t),r=function(a,l,c){return Wt(function(){var d=QSe(a,c);return Nt(rs(We(a,ln(l,"int32")),"float32"),d)})}(s,n,e),i=XSe(t,s),[2,[r,i]]})})}function FD(t,e){return(t-1)%e==0}var MD="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",LD="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function BD(t,e){return function(n,s){return(n-1)%s==0}(t,e)?t:Math.floor(t/e)*e+1}var VD=function(){function t(e,n){this.posenetModel=e;var s=this.posenetModel.inputs[0].shape;O(s[1]===-1&&s[2]===-1,function(){return"Input shape [".concat(s[1],", ").concat(s[2],"] ")+"must both be equal to or -1"});var r,i,o=(r=n.inputResolution,i=n.outputStride,{height:BD(r.height,i),width:BD(r.width,i)});(function(a){O(LSe.indexOf(a)>=0,function(){return"outputStride of ".concat(a," is invalid. ")+"It must be either 8 or 16."})})(n.outputStride),function(a,l){O(FD(a.height,l),function(){return"height of ".concat(a.height," is invalid for output stride ")+"".concat(l,".")}),O(FD(a.width,l),function(){return"width of ".concat(a.width," is invalid for output stride ")+"".concat(l,".")})}(o,n.outputStride),this.inputResolution=o,this.outputStride=n.outputStride,this.architecture=n.architecture}return t.prototype.estimatePoses=function(e,n){return n===void 0&&(n=RD),wn(this,void 0,void 0,function(){return Sn(this,function(s){return[2,this.estimatePosesGPU(e,n,!1)]})})},t.prototype.estimatePosesGPU=function(e,n,s){return n===void 0&&(n=RD),s===void 0&&(s=!1),wn(this,void 0,void 0,function(){var r,i,o,a,l,c,d,h,f,p,m,g,x,y,v,S,C,k;return Sn(this,function(T){switch(T.label){case 0:return r=function(_){var $=_;if($.maxPoses==null&&($.maxPoses=1),$.maxPoses<=0)throw new Error("Invalid maxPoses ".concat($.maxPoses,". Should be > 0."));if($.maxPoses>1){if(($=ss(ss({},BSe),$)).scoreThreshold<0||$.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat($.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if($.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat($.nmsRadius,"."))}return $}(n),e==null?[2,s?[[],[]]:[]]:(this.maxPoses=r.maxPoses,i=mN(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),o=i.imageTensor,a=i.padding,l=this.architecture==="ResNet50"?Nt(o,VSe):qU(o,[-1,1]),c=this.posenetModel.predict(l),this.architecture==="ResNet50"?(d=Yn(c[2],[0]),h=Yn(c[3],[0]),f=Yn(c[0],[0]),p=Yn(c[1],[0])):(d=Yn(c[0],[0]),h=Yn(c[1],[0]),f=Yn(c[2],[0]),p=Yn(c[3],[0])),m=fc(h),this.maxPoses!==1?[3,5]:s?[4,tCe(m,d,this.outputStride)]:[3,2]);case 1:return x=T.sent(),v=x[0],y=x[1],g=[v,y],[3,4];case 2:return[4,eCe(m,d,this.outputStride)];case 3:v=T.sent(),g=[v],T.label=4;case 4:return[3,7];case 5:if(s)throw new Error("GPU renderer only supports single pose!");return[4,KSe(m,d,f,p,this.outputStride,this.maxPoses,r.scoreThreshold,r.nmsRadius)];case 6:g=T.sent(),T.label=7;case 7:if(s){if(r.flipHorizontal===!0)throw new Error("flipHorizontal is not supported!");S=this.getCanvasInfo(Vp(e),this.inputResolution,a)}else k=Vp(e),C=function(_,$,R,A){var j=$.height,F=$.width,L=j/(R.height*(1-A.top-A.bottom)),M=F/(R.width*(1-A.left-A.right)),q=-A.top*R.height,z=-A.left*R.width;if(M===1&&L===1&&q===0&&z===0)return _;for(var re=0,U=_;re<U.length;re++)for(var G=0,xe=U[re].keypoints;G<xe.length;G++){var Ce=xe[G];Ce.x=(Ce.x+z)*M,Ce.y=(Ce.y+q)*L}return _}(g,k,this.inputResolution,a),r.flipHorizontal&&(C=function(_,$){for(var R=0,A=_;R<A.length;R++)for(var j=0,F=A[R].keypoints;j<F.length;j++){var L=F[j];L.x=$.width-1-L.x}return _}(C,k));return o.dispose(),l.dispose(),Un(c),d.dispose(),h.dispose(),f.dispose(),p.dispose(),m.dispose(),[2,s?[g,S]:C]}})})},t.prototype.getCanvasInfo=function(e,n,s){var r=e.height,i=e.width,o=r/(n.height*(1-s.top-s.bottom)),a=i/(n.width*(1-s.left-s.right)),l=-s.top*n.height;return[-s.left*n.width,l,a,o,e.width,e.height]},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function nCe(t){return t===void 0&&(t=TD),wn(this,void 0,void 0,function(){var e,n,s,r,i;return Sn(this,function(o){switch(o.label){case 0:return(e=function(d){var h=d||TD;if(h.architecture==null&&(h.architecture="MobileNetV1"),_D.indexOf(h.architecture)<0)throw new Error("Invalid architecture ".concat(h.architecture,". ")+"Should be one of ".concat(_D));if(h.inputResolution==null&&(h.inputResolution={height:257,width:257}),h.outputStride==null&&(h.outputStride=16),ED[h.architecture].indexOf(h.outputStride)<0)throw new Error("Invalid outputStride ".concat(h.outputStride,". ")+"Should be one of ".concat(ED[h.architecture]," ")+"for architecture ".concat(h.architecture,"."));if(h.multiplier==null&&(h.multiplier=1),$D[h.architecture].indexOf(h.multiplier)<0)throw new Error("Invalid multiplier ".concat(h.multiplier,". ")+"Should be one of ".concat($D[h.architecture]," ")+"for architecture ".concat(h.architecture,"."));if(h.quantBytes==null&&(h.quantBytes=4),ID.indexOf(h.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(h.quantBytes,". ")+"Should be one of ".concat(ID," ")+"for architecture ".concat(h.architecture,"."));if(h.architecture==="MobileNetV1"&&h.outputStride===32&&h.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return h}(t)).architecture!=="ResNet50"?[3,2]:(a=e.outputStride,l=e.quantBytes,c="model-stride".concat(a,".json"),n=l===4?LD+"float/"+c:LD+"quant".concat(l,"/")+c,[4,Lp(e.modelUrl||n)]);case 1:return s=o.sent(),[2,new VD(s,e)];case 2:return r=function(d,h,f){var p={1:"100",.75:"075",.5:"050"},m="model-stride".concat(d,".json");return f===4?MD+"float/".concat(p[h],"/")+m:MD+"quant".concat(f,"/").concat(p[h],"/")+m}(e.outputStride,e.multiplier,e.quantBytes),[4,Lp(e.modelUrl||r)];case 3:return i=o.sent(),[2,new VD(i,e)]}var a,l,c})})}function i8(t,e){return wn(this,void 0,void 0,function(){var n,s;return Sn(this,function(r){switch(t){case Wa.PoseNet:return[2,nCe(e)];case Wa.BlazePose:if(s=void 0,(n=e)!=null){if(n.runtime==="tfjs")return[2,RSe(e)];if(n.runtime==="mediapipe")return[2,sSe(e)];s=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(s));case Wa.MoveNet:return[2,MSe(e)];default:throw new Error("".concat(t," is not a supported model name."))}})})}var Bf={modelType:{SINGLEPOSE_LIGHTNING:"SinglePose.Lightning",SINGLEPOSE_THUNDER:"SinglePose.Thunder",MULTIPOSE_LIGHTNING:"MultiPose.Lightning"}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dd={},Ey={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function sCe(t,e){Dd[t]=e}function Xa(t,e){if(!(t in Dd)||e!=null){const s=iCe(t,e);if(s!==null)Dd[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=Dd[t];return n==null||n.isContextLost()?(delete Dd[t],Xa(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Dd[t])}function rCe(t){if(!ue().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function iCe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??rCe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Dd[t]},!1),ue().getBool("SOFTWARE_WEBGL_ENABLED")&&(Ey.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Ey)||n.getContext("experimental-webgl",Ey):n.getContext("webgl2",Ey)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var R0;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(R0||(R0={}));var bo;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(bo||(bo={}));var Cr;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Cr||(Cr={}));function jx(t,e){return[e,t]}function oCe(t,e){return t*e}function $y(t){const e=be(t),n=Math.ceil(e/4);return Rk(n)}function gm(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function aCe(t,e){const[n,s]=gm(t,e);return n*s*4}function RR(t,e){const n=t;let s,r,i,o,a,l,c,d,h,f;return ue().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,d=1,h=n.HALF_FLOAT,f=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,d=4,h=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:d,textureTypeHalfFloat:h,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ut(t,e){const n=e();return ue().getBool("DEBUG")&&lCe(t),n}function lCe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+hCe(t,e))}const cCe=596e-10,uCe=65504;function dCe(t){return!!(ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||cCe<Math.abs(t)&&Math.abs(t)<uCe)}function hCe(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Iy(t,e){return Bc(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function fCe(t,e){const n=Bc(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ut(t,()=>t.shaderSource(n,e)),ut(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function pCe(t,e){const n=Bc(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ut(t,()=>t.shaderSource(n,e)),ut(t,()=>t.compileShader(n)),ue().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw o8(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const mCe=/ERROR: [0-9]+:([0-9]+):/g;function o8(t,e){const n=mCe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((h,f)=>np((f+1).toString(),i)+h);let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),d=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${np(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function gCe(t){return Bc(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function xCe(t,e){if(ut(t,()=>t.linkProgram(e)),!ue().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function dS(t,e){if(ut(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function yCe(t,e){const n=Bc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ut(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ut(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function vCe(t,e){const n=Bc(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ut(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ut(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function bCe(t){return Bc(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function wCe(t,e){const n=ue().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function SCe(t){return Bc(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function zD(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(ut(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),ut(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),ut(t,()=>t.enableVertexAttribArray(a)),!0)}function CCe(t,e,n){ECe(t,n),ut(t,()=>t.activeTexture(t.TEXTURE0+n)),ut(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function kCe(t,e,n){return Bc(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function NCe(t,e,n){return t.getUniformLocation(e,n)}function TCe(t,e,n,s){ut(t,()=>CCe(t,e,s)),ut(t,()=>t.uniform1i(n,s))}function hS(t,e,n){ut(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ut(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function WD(t,e){ut(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ut(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Ry(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+_Ce(t,e))}function _Ce(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Bc(t,e,n){const s=ut(t,()=>e());if(s==null)throw new Error(n);return s}function ECe(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function zp(t,e=2){return be(t.slice(0,t.length-e))}function Wp(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Py(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[zp(t),...Wp(t)]),e}function $Ce(t,e=!1){let n=ue().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ue().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ue().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?W_(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=rd(t).newShape);let r=be(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=zp(t);let l=2,c=2;t.length&&([l,c]=Wp(t)),r=a*(l/2)*(c/2),i=Rk(r).map(d=>d*2)}else i=Rk(r);return i}function Ay(t){return t%2===0}function Gb(t,e){if(t=t.slice(-2),e=e.slice(-2),Gn(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Ay(n)&&Ay(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Ay(t[0])&&Ay(e[0])}let fS,pS;function ICe(t){if(fS==null){const e=Xa(t);fS=e.getParameter(e.MAX_TEXTURE_SIZE)}return fS}function RCe(t){if(pS==null){const e=Xa(t);pS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,pS)}function PCe(t){if(t===0)return 0;let e;const n=Xa(t);return ra(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:ra(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function ra(t,e){return t.getExtension(e)!=null}function UD(t){try{if(Xa(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function ACe(t){if(t===0)return!1;const e=Xa(t);if(t===1){if(!ra(e,"OES_texture_float"))return!1}else if(!ra(e,"EXT_color_buffer_float"))return!1;return yN(e)}function jCe(t){if(t===0)return!1;const e=Xa(t);if(t===1){if(!ra(e,"OES_texture_float")||!ra(e,"WEBGL_color_buffer_float"))return!1}else{if(ra(e,"EXT_color_buffer_float"))return yN(e);const s="EXT_color_buffer_half_float";if(ra(e,s)){const r=e.getExtension(s);return DCe(e,r)}return!1}return yN(e)}function yN(t){const e=RR(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function DCe(t,e){const n=RR(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function OCe(t){return t!==2?!1:Xa(t).fenceSync!=null}function Dx(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&O(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ct=ue();Ct.registerFlag("HAS_WEBGL",()=>Ct.getNumber("WEBGL_VERSION")>0);Ct.registerFlag("WEBGL_VERSION",()=>UD(2)?2:UD(1)?1:0);Ct.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ct.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ct.get("WEBGL_VERSION")===2);Ct.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ct.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ct.registerFlag("WEBGL_PACK",()=>Ct.getBool("HAS_WEBGL"));Ct.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_CLIP",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_REDUCE",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_CONV_IM2COL",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>ICe(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>RCe(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Ct.getNumber("WEBGL_VERSION");return t===0?0:PCe(t)});Ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ct.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!wW());Ct.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>ACe(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ct.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ct.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ct.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>jCe(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_FENCE_API_ENABLED",()=>OCe(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ct.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ct.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Ct.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>wW()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Ct.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ct.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ct.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ct.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ct.registerFlag("WEBGL_EXP_CONV",()=>!1);Ct.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ct.getBool("IS_TEST"));Ct.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ct.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ct.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ct.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ii(){let t,e,n,s,r,i,o,a,l,c;return ue().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=ue().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qh(t,e,n="index"){const s=Ms(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function R1(t,e,n="index"){const s=Ms(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function FCe(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function MCe(t,e,n="index"){const s=t.map((i,o)=>o),r=FCe(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function PR(t){const e=Ms(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function AR(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const a8=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:l8}=Whe;function LCe(t,e,n){const s=[];if(t.forEach(p=>{const m=be(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:g}=jR(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(p=>BCe(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=ii(),l=WCe(a);let c,d,h=GCe(a);return e.isPacked?(c=VCe(e.logicalShape,o,n.enableShapeUniforms),d=HCe(a)):(c=zCe(e.logicalShape,o,n.enableShapeUniforms),d=UCe(a)),n.packedInputs&&(h+=YCe),[h,l,d,r,c,i,n.userCode].join(`
`)}function xm(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return lke(t,e);case 1:return uke(t,e);case 2:return hke(t,e);case 3:return pke(t,e);case 4:return gke(t,e);case 5:return xke(t);case 6:return yke(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function c8(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return ake(t);case 1:return cke(t,e);case 2:return dke(t,e);case 3:return fke(t,e);default:return mke(t,e)}}function BCe(t,e,n=!1,s){let r="";n?r+=c8(t,s):r+=xm(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=vke(t,e):r+=bke(t,e)),r}function VCe(t,e,n){switch(t.length){case 0:return u8();case 1:return QCe(t,e,n);case 2:return ike(t,e,n);case 3:return JCe(t,e,n);default:return tke(t,e,n)}}function zCe(t,e,n){switch(t.length){case 0:return u8();case 1:return ZCe(t,e,n);case 2:return oke(t,e,n);case 3:return eke(t,e,n);case 4:return nke(t,e,n);case 5:return ske(t,e);case 6:return rke(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function WCe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function UCe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function HCe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function GCe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${KCe}
    ${qCe}
    ${XCe}
  `}const KCe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,qCe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,XCe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,YCe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function u8(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function QCe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function ZCe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function JCe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function eke(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${R1(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=qh(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function tke(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function nke(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${R1(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=qh(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function ske(t,e){const n=qh(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function rke(t,e){const n=qh(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function ike(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Gn(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function oke(t,e,n){return Gn(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Xh(t){return`offset${t}`}function ake(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=ii();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function lke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=Xh(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function cke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=ii();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function uke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${ym(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Xh(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function dke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=ii();if(i!=null&&Gn(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],d=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function hke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&Gn(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=i[0],p=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=rd(n),l=o;if(l.length<n.length){const f=vm(t,l),p=["row","col"];return`
      ${xm(f,e)}
      float ${r}(int row, int col) {
        return ${r}(${bm(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${ym(t)}
      }
    `;const c=i[0],d=i[1],h=Xh(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${c}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function fke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const f=n.slice(1),p=[1,2],m=vm(t,f),g=["b","row","col"];return`
        ${c8(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${bm(g,p)});
        }
      `}const a=ii();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],d=Math.ceil(n[2]/2),h=d*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${h}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function pke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=rd(n),c=a;if(c.length<n.length){const g=vm(t,c),x=["row","col","depth"];return`
        ${xm(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${bm(x,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${ym(t)}
      }
    `;const d=t.shapeInfo.texShape,h=d[0],f=d[1],p=t.shapeInfo.flatOffset;if(f===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${h}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `;const m=Xh(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function mke(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=ii();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],d=l[1],h=Math.ceil(i[o-1]/2);let f=h*Math.ceil(i[o-2]/2),p="int b, int row, int col",m=`b * ${f} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<o-1;g++)p=`int b${g}, `+p,f*=i[o-g-1],m=`b${g} * ${f} + `+m;return`
    vec4 ${s}(${p}) {
      int index = ${m};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${c});
      return ${r.texture2D}(${n}, uv);
    }
  `}function gke(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:c}=rd(n);if(l.length<n.length){const v=vm(t,l),S=["row","col","depth","depth2"];return`
      ${xm(v,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${bm(S,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${ym(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1],m=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===i&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=Xh(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${f}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function xke(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:c}=rd(e);if(l.length<e.length){const g=vm(t,l),x=["row","col","depth","depth2","depth3"];return`
      ${xm(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${bm(x,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${ym(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];if(p===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Xh(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function yke(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=rd(e);if(r.length<e.length){const x=vm(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${xm(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${bm(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,d=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${ym(t)}
      }
    `;const h=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,p=f[0],m=f[1];if(m===d&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===o&&h==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=Xh(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function ym(t){const e=t.name,n=be(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function vke(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=l8(t.shapeInfo.logicalShape,e.logicalShape),l=es(o),c=o-i;let d;const h=["x","y","z","w","u","v"];i===0?d="":o<2&&a.length>=1?d="coords = 0;":d=a.map(v=>`coords.${h[v+c]} = 0;`).join(`
`);let f="";o<2&&i>0?f="coords":f=t.shapeInfo.logicalShape.map((v,S)=>`coords.${h[S+c]}`).join(", ");let p="return outputValue;";const g=be(t.shapeInfo.logicalShape)===1,y=be(e.logicalShape)===1;if(i===1&&!g&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const v=i-2,S=i-1;a.indexOf(v)>-1&&a.indexOf(S)>-1?p="return vec4(outputValue.x);":a.indexOf(v)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${f});
      ${p}
    }
  `}function bke(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&Gn(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=es(l),d=l8(t.shapeInfo.logicalShape,e.logicalShape),h=l-a;let f;const p=["x","y","z","w","u","v"];a===0?f="":l<2&&d.length>=1?f="coords = 0;":f=d.map(g=>`coords.${p[g+h]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((g,x)=>`coords.${p[x+h]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${s}(${m});
    }
  `}function es(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function jR(t,e,n){const{newShape:s,keptDims:r}=rd(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!Gn(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function vm(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function bm(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wke(t,e,n,s){const r=n.map((d,h)=>{const f={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(f.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:f}}),i=r.map(d=>d.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=LCe(r,o,e),l=pCe(t.gl,a),c=t.createProgram(l);return ue().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},d8(t,e,c)))}function d8(t,e,n){const s=[],r=[];let i,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),ue().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const d=!1;for(const h of e.variableNames){const f={name:h,uniform:t.getUniformLocation(n,h,d),offset:t.getUniformLocation(n,`offset${h}`,d)};e.enableShapeUniforms&&(f.shape=t.getUniformLocation(n,`${h}Shape`,d),f.texShape=t.getUniformLocation(n,`${h}TexShape`,d)),s.push(f)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",d),a=t.getUniformLocation(n,"outShapeStrides",d),o=t.getUniformLocation(n,"outTexShape",d)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(n,h.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function HD(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!Gn(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!Gn(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Ske(t,e,n,s,r){e.program.enableShapeUniforms||(HD(e.inShapeInfos,n),HD([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),ue().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:d,offset:h,shape:f,texShape:p}=e.variablesLocations[l];if(f){const{uniformShape:m}=jR(e.program.packedInputs,c.shape,c.texData.texShape);switch(m.length){case 1:t.gl.uniform1iv(f,new Int32Array(m));break;case 2:t.gl.uniform2iv(f,new Int32Array(m));break;case 3:t.gl.uniform3iv(f,new Int32Array(m));break;case 4:t.gl.uniform4iv(f,new Int32Array(m));break}}if(p&&t.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),d!=null){if(c.isUniform){if(be(c.shape)<2)t.gl.uniform1f(d,c.uniformValues[0]);else{let m=c.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),t.gl.uniform1fv(d,m)}continue}c.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ms(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],d=e.customUniformLocations[l],h=r[l];if(c.type==="float")t.gl.uniform1fv(d,h);else if(c.type==="vec2")t.gl.uniform2fv(d,h);else if(c.type==="vec3")t.gl.uniform3fv(d,h);else if(c.type==="vec4")t.gl.uniform4fv(d,h);else if(c.type==="int")t.gl.uniform1iv(d,h);else if(c.type==="ivec2")t.gl.uniform2iv(d,h);else if(c.type==="ivec3")t.gl.uniform3iv(d,h);else if(c.type==="ivec4")t.gl.uniform4iv(d,h);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function Cke(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:d,keptDims:h}=jR(t.packedInputs,o.shape,l);let f="",p="",m="";if(d.length===1&&t.packedInputs){const k=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${k[0]>1}_${k[1]>1}`}else if(d.length===2&&!t.packedInputs)p=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!t.packedInputs){const k=Ms(d);m=`${k[0]===l[1]}_${k[k.length-1]===l[1]}`}const g=o.shape.length,x=d.length===2&&Gn(o.shape,l),y=be(o.shape)===1,v=Mp(o.shape,n.shape),S=!t.packedInputs&&g===n.shape.length&&Gn(l,n.texData.texShape),C=t.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${g}_${S}_${c?h:""}_${d.length}_${y}_${v}_${x}_${f}_${p}_${m}_${C}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${ue().getNumber("WEBGL_VERSION")}`,i}function Br(t){return ue().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kke{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=R0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ii();this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?R1(["r","c","d"],e):qh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nke{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=R0.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=ii();this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?R1(["r","c","d"],e):qh(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tke{constructor(e){this.variableNames=["A"],this.outTexUsage=bo.DOWNLOAD;const n=ii();this.outputShape=e,this.userCode=`
      ${a8}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ke{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=bo.DOWNLOAD;const n=ii();this.outputShape=e,this.userCode=`
      ${a8}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eke={R:0,G:1,B:2,A:3};class GD{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=ii();this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${Eke[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?AR():PR(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ke{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=ii();this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?AR():PR(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(t){const e=ii(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return fCe(t,n)}function Rke(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return yCe(t,e)}function Pke(t){const e=new Uint16Array([0,1,2,2,1,3]);return vCe(t,e)}function Ox(t,e,n,s,r,i){wCe(e,n);const o=bCe(t),a=t.TEXTURE_2D;return ut(t,()=>t.bindTexture(a,o)),ut(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ut(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ut(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ut(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ue().getNumber("WEBGL_VERSION")===1?ut(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):ut(t,()=>t.texStorage2D(a,1,s,e,n)),ut(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function h8(t){return t.internalFormatFloat}function Ake(t,e,n,s){const[r,i]=jx(e,n);return Ox(t,r,i,h8(s),s.textureFormatFloat,t.FLOAT)}function f8(t){return t.internalFormatHalfFloat}function jke(t,e,n,s){const[r,i]=jx(e,n);return Ox(t,r,i,f8(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function p8(t){return t.downloadTextureFormat}function Dke(t,e,n,s){const[r,i]=jx(e,n);return Ox(t,r,i,p8(s),t.RGBA,t.UNSIGNED_BYTE)}function m8(t){return t.internalFormatPackedFloat}function Oke(t,e,n,s){const[r,i]=gm(e,n);return Ox(t,r,i,m8(s),t.RGBA,t.FLOAT)}function g8(t){return t.internalFormatPackedHalfFloat}function Fke(t,e,n,s){const[r,i]=gm(e,n);return Ox(t,r,i,g8(s),t.RGBA,s.textureTypeHalfFloat)}function Mke(t,e,n){return ut(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),zD(t,e,"clipSpacePos",n,3,20,0)&&zD(t,e,"uv",n,2,20,12)}function Lke(t,e,n,s,r,i){ut(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),ue().getNumber("WEBGL_VERSION")===2?ut(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):ut(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),ut(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Bke(t,e,n){ut(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?ue().getNumber("WEBGL_VERSION")===2?ut(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ut(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):ue().getNumber("WEBGL_VERSION")===2?ut(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ut(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ut(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Vke(t,e,n,s){const r=t.createBuffer();ut(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return ut(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ut(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ut(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function zke(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function Wke(t,e,n,s){const[r,i]=jx(e,n),o=4,a=new Uint8Array(oCe(e*n,o));return ut(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Uke(t,e,n,s,r,i,o,a){const l=t,c=new Float32Array(aCe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Hke(t,e,n){const s=new Float32Array(e*n*4);return ut(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mS{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=ue().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,sCe(n,e)):this.gl=Xa(n),e=this.gl,ue().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>ut(i,()=>i.createVertexArray()),this.bindVertexArray=o=>ut(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>ut(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>ut(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ut(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>ut(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>ut(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>ut(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ue().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Iy(this.gl,i),ra(this.gl,o))this.textureHalfFloatExtension=Iy(this.gl,o);else if(ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),ra(this.gl,r))this.colorBufferHalfFloatExtension=Iy(this.gl,r);else if(ue().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",ra(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(ra(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Rke(this.gl),this.indexBuffer=Pke(this.gl),this.framebuffer=SCe(this.gl),this.textureConfig=RR(this.gl,this.textureHalfFloatExtension)}get debug(){return ue().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ut(e,()=>e.finish()),ut(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ut(e,()=>e.deleteFramebuffer(this.framebuffer)),ut(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ut(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ut(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),Ake(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),jke(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),Dke(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),Bke(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),Lke(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),Fke(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Oke(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(WD(this.gl,this.framebuffer),this.outputTexture=null),ut(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Wke(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return Uke(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return zke(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=Vke(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(ue().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Hke(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Ike(n));const s=gCe(n);ut(n,()=>n.attachShader(s,this.vertexShader)),ut(n,()=>n.attachShader(s,e)),xCe(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&dS(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ut(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Mke(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ut(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&dS(this.gl,this.program),ut(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?kCe(this.gl,e,n):NCe(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ut(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),TCe(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=gm(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&dS(this.gl,this.program),Ry(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ut(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ut(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Iy(this.gl,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await fj(()=>this.disposed||this.isQueryAvailable(e,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Gke(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ue().platform&&(s=ue().platform.setTimeoutCustom.bind(ue().platform)),fj(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),hS(this.gl,e,this.framebuffer),this.debug&&Ry(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(hS(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ry(this.gl)):WD(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;hS(r,e,this.framebuffer),this.debug&&Ry(r),this.outputTexture=e,ut(r,()=>r.viewport(0,0,n,s)),ut(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),ut(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Gke(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Kke,bincountImpl:x8,bincountReduceImpl:qke,bitwiseAndImpl:Xke,castImpl:Yke,ceilImpl:Qke,concatImpl:Zke,equalImpl:Jke,expImpl:eNe,expm1Impl:tNe,floorImpl:nNe,gatherNdImpl:sNe,gatherV2Impl:rNe,greaterImpl:iNe,greaterEqualImpl:oNe,lessImpl:aNe,lessEqualImpl:lNe,linSpaceImpl:cNe,logImpl:uNe,maxImpl:dNe,maximumImpl:hNe,minimumImpl:fNe,multiplyImpl:pNe,negImpl:mNe,notEqualImpl:gNe,prodImpl:xNe,raggedGatherImpl:yNe,raggedRangeImpl:vNe,raggedTensorToTensorImpl:bNe,rangeImpl:wNe,rsqrtImpl:SNe,scatterImpl:CNe,sigmoidImpl:kNe,simpleAbsImpl:y8,sliceImpl:NNe,sparseFillEmptyRowsImpl:TNe,sparseReshapeImpl:_Ne,sparseSegmentReductionImpl:v8,sqrtImpl:ENe,staticRegexReplaceImpl:$Ne,stridedSliceImpl:INe,stringNGramsImpl:RNe,stringSplitImpl:PNe,stringToHashBucketFastImpl:ANe,subImpl:jNe,tileImpl:DNe,topKImpl:ONe,transposeImpl:DR,uniqueImpl:FNe}=yU;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Yr(t,e){return e===1?[t]:b8(t,e)}function MNe(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LNe{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Br(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Yr("rc",this.rank),s=es(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class w8{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${BNe(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?AR():PR(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function BNe(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?MCe(["r","c","d"],"inputShape"):qh(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VNe{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=qD(n,s),i=XD(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=KD(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===Cr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Cr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Cr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Cr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Cr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=qD(s,r),o=XD(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=KD(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=ue().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],d=c&&c.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[d]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function zNe(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function KD(t,e,n,s,r){const i=WNe(e,s);let o;if(r){const[l,c]=gm(t[0],t[1]);o=l*c}else{const[l,c]=jx(t[0],t[1]);o=l*c}const a=zNe(n,i);return o*a}function WNe(t,e){switch(t){case Cr.PACKED_2X2_FLOAT32:return m8(e);case Cr.PACKED_2X2_FLOAT16:return g8(e);case Cr.UNPACKED_FLOAT32:return h8(e);case Cr.UNPACKED_FLOAT16:return f8(e);case Cr.PACKED_4X1_UNSIGNED_BYTE:return p8(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function UNe(t){return ue().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Cr.PACKED_2X2_FLOAT32:Cr.UNPACKED_FLOAT32:t?Cr.PACKED_2X2_FLOAT16:Cr.UNPACKED_FLOAT16}function qD(t,e){if(t===bo.UPLOAD)return Cr.PACKED_2X2_FLOAT32;if(t===bo.RENDER||t==null)return UNe(e);if(t===bo.DOWNLOAD||t===bo.PIXELS)return Cr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function XD(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vl{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ba="if (isnan(x)) return x;",HNe="return x;",YD="return abs(x);",GNe="return (x >= 0.0) ? x : (exp(x) - 1.0);",KNe=ba+`
  return (x < 0.0) ? 0.0 : x;
`,qNe=ba+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,tu="return x;",XNe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YNe="return x;",QNe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ZNe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JNe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eTe="return 1.0 / (1.0 + exp(-1.0 * x));";class wu{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tTe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length);const n=e.length,s=Yr("rc",n),r=es(n),i=MNe(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nTe=S6,sTe=1e-7,rTe=1e-4,jy={};function iTe(t){return t in jy||(jy[t]={}),jy[t]}const oTe=ue().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),aTe=600;function lTe(){return ue().global.screen==null?1024:ue().global.screen.height*ue().global.screen.width*window.devicePixelRatio*aTe/1024/1024}class P1 extends z_{nextDataId(){return P1.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ue().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof mS)n=e;else{const s=Xa(ue().getNumber("WEBGL_VERSION"),e);n=new mS(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Xa(ue().getNumber("WEBGL_VERSION"));n=new mS(s),this.binaryCache=iTe(ue().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new VNe(this.gpgpu),this.numMBBeforeWarning=lTe(),this.texData=new _z(this,Li())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const c=Py(n),d=new GD(c,!1,o),h=this.runWebGLProgram(d,[a],s,[[r,i]]);return h.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),h.dataId}write(e,n,s){if((ue().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ue().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:bo.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(ue().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:bo.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let f;l?f=new wu(a,tu):f=new vl(a,tu);const p=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:r}],r),m=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),m}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let d;c&&(d=$a());let h;if(r==="complex64"){const f=this.readSync(i.real.dataId),p=this.readSync(i.imag.dataId);h=_0(f,p)}else h=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=$a()-d),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let m;l?m=new wu(r,tu):m=new vl(r,tu);const g=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:o}],o),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(ue().getBool("DEBUG")&&!ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ue().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,d;if(o!=="complex64"&&ue().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const m=this.texData.get(d.dataId);c=this.gpgpu.createBufferFromTexture(m.texture.texture,...$y(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=m[0],x=m[1];h=_0(g,x)}else if(c==null)h=this.getValuesFromTexture(e);else{const m=be(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(c,m)}if(d!=null&&this.disposeIntermediateTensorInfo(d),c!=null){const m=this.gpgpu.gl;ut(m,()=>m.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,h),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Li().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let p;l?p=new wu(i,tu):p=new vl(i,tu);const m=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:a}],a),g=this.readToGPU(m,n);return this.disposeIntermediateTensorInfo(m),g}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,n.customTexShape),h=Li().makeTensorFromTensorInfo(d),f=this.texData.get(d.dataId);return Object.assign({tensorRef:h},f.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Tc(r));return Kn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Kn(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!dCe(s))throw ue().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=be(n);if(ue().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),p=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...$y(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(f),m}const o=ue().getBool("WEBGL_PACK")&&r===!0,a=o?Py(n):n,l=o?new _ke(a):new Tke(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(c.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),h}timerAvailable(){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=_c(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=_c(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=Ez(l),a.getExtraProfileInfo=()=>l.map((c,d)=>({name:o[d],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$a(),endMs:null}}endTimer(e){return ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=$a(),e)}async getQueryTime(e){if(ue().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=oTe){return ue().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&be(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Da("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return nTe(e.shape,n)}packedUnaryOp(e,n,s){const r=new wu(e.shape,n),i=this.compileAndRun(r,[e],s);return Li().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=y8(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ue().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,YD,e.dtype);const n=new vl(e.shape,YD),s=this.compileAndRun(n,[e]);return Li().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Nx(s[0])){const i=s.map(o=>Au(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return Li().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new tTe(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new LNe(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[zp(e.shape),...Wp(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[zp(n),...Wp(n)],o=new w8(i,s),a=!0,l=[s],c=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const f=be(i),p=n[0]*n[1]*4;O(f<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Py(i);let l;r?l=new Nke(a):l=new kke(a);const c=!0,d=[n??$y(a)],h=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,d,c,n);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===R0.DENSE){const y=o??$y(e.outputShape);l.texShape=y.map(v=>v*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),be(a.shape)===0)return l.values=Dl(a.dtype,0),a;const c=[],d=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(y.dataId);if(v.texture==null){if(!e.packedInputs&&be(y.shape)<=ue().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:v.values};e.packedInputs&&(v.isPacked=!0,v.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!v.isPacked!=!!e.packedInputs)y=v.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),v=this.texData.get(y.dataId);else if(v.isPacked&&!Gb(v.shape,y.shape)){const S=y,C=y.shape;y.shape=v.shape,y=this.packedReshape(y,C),c.push(y),v=this.texData.get(y.dataId),S.shape=C}return{shape:y.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);const h={shape:a.shape,texData:l,isUniform:!1},f=Cke(e,d,h),p=this.getAndSaveBinary(f,()=>wke(this.gpgpu,e,d,h)),m=this.activeTimers!=null;let g;m&&(g=this.startTimer()),ue().get("ENGINE_COMPILE_ONLY")||Ske(this.gpgpu,p,d,h,r),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=ue().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const y=$a();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!ue().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ue().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Wt(()=>{if(!ue().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ue().getBool("DEBUG");ue().set("DEBUG",!1);const n=this.abs(ln(1e-8)).dataSync()[0];if(ue().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?sTe:rTe}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let d;c&&(d=$a());let h=n.texShape;if(h==null&&(h=$Ce(s,l),n.texShape=h),i!=null){const f=Py(s);let p,m=h[1],g=h[0];const x=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!x)&&([m,g]=gm(h[0],h[1])),l?p=new $ke(f,x):p=new GD(f,x);const y=x?[g,m]:h,v=this.makeTensorInfo(y,r),S=this.texData.get(v.dataId);x?S.usage=bo.PIXELS:S.usage=bo.UPLOAD,S.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),m,g,i);const C=[[g,m]],T=this.runWebGLProgram(p,[v],r,C,!0),_=this.texData.get(T.dataId);n.texShape=_.texShape,n.isPacked=_.isPacked,n.usage=_.usage,ue().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(n.texture=_.texture,n.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(v),c&&(this.uploadWaitMs+=$a()-d)}else{const f=this.acquireTexture(h,a,r,l);n.texture=f}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=cTe(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*Tb(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Phe(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(o8(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=d8(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=Li().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,n,s,i,o,a);return Li().makeTensorFromDataId(c,n,s,l)}}P1.nextDataId=0;function cTe(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */SW()&&NW("webgl",()=>new P1,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OR=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class _h{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=nn(n,s),this.enableShapeUniforms=Br(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class wm{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=nn(n,s);const i=this.outputShape.length;this.enableShapeUniforms=Br(i);let o="";if(r)if(i===0||be(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${es(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Yr("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const uTe={kernelName:d1,backendName:"webgl",kernelFunc:Yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cd(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=Yi({inputs:{x:s},backend:n}),l=Yi({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const dTe={kernelName:fE,backendName:"webgl",kernelFunc:cd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S8="return (a < 0.) ? b * a : a;",C8=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function hTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",dm(i,"float32")),a=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wm(C8,r.shape,o.shape):new _h(S8,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const fTe={kernelName:n$,backendName:"webgl",kernelFunc:hTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k8="return (a < 0.) ? b * a : a;",N8=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function pTe(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wm(N8,s.shape,r.shape):new _h(k8,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const mTe={kernelName:A$,backendName:"webgl",kernelFunc:pTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sm="if (isnan(x)) return x;";function _n({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const h=a.texData.get(o.dataId),f=n(h.values,l);return a.makeTensorInfo(o.shape,l,f)}const c=ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return c?d=new wu(o.shape,e):d=new vl(o.shape,t),a.runWebGLProgram(d,[o],l)}}function Er({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,d=a;if(s&&l.dtype==="complex64"){const m=d.texData.get(l.dataId),g=d.texData.get(c.dataId),[x,y]=[[m.complexTensorInfos.real,g.complexTensorInfos.real],[m.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(S=>{const[C,k]=S,T={dataId:C.dataId,dtype:C.dtype,shape:l.shape},_={dataId:k.dataId,dtype:k.dtype,shape:c.shape},$=new _h(t,l.shape,c.shape);return d.runWebGLProgram($,[T,_],wi(C.dtype,k.dtype))}),v=cd({inputs:{real:x,imag:y},backend:d});return d.disposeIntermediateTensorInfo(x),d.disposeIntermediateTensorInfo(y),v}const h=i||wi(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||d.shouldExecuteOnCPU([l,c]))&&r!=null){const m=d.texData.get(l.dataId).values,g=d.texData.get(c.dataId).values,x=l.dtype==="string"?Ku(m):m,y=l.dtype==="string"?Ku(g):g,[v,S]=r(l.shape,c.shape,x,y,h),C=d.makeTensorInfo(S,h),k=d.texData.get(C.dataId);return k.values=v,C}const f=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return f?p=new wm(e,l.shape,c.shape,n):p=new _h(t,l.shape,c.shape),d.runWebGLProgram(p,[l,c],h)}}function P0(t,e=!1){if(t==="linear")return e?YNe:HNe;if(t==="relu")return e?ZNe:KNe;if(t==="elu")return e?QNe:GNe;if(t==="relu6")return e?JNe:qNe;if(t==="prelu")return e?N8:k8;if(t==="leakyrelu")return e?C8:S8;if(t==="sigmoid")return e?eTe:XNe;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T8{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Br(this.outputShape.length);const d=r?e[1]:e[2],h=Math.ceil(d/2),f=r?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",y="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",C="rc.x";e[0]<n[0]?S=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(C=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${C};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${g[0]});
          result += (${m[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class ZD{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=nn(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JD="return a * b;";function FR(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=wi(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),c=new ZD(QD.REAL,s.shape,r.shape),d=new ZD(QD.IMAG,s.shape,r.shape),h=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],f=n.runWebGLProgram(c,h,"float32"),p=n.runWebGLProgram(d,h,"float32"),m=cd({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[c,d]=pNe(s.shape,r.shape,a.values,l.values,i),h=n.makeTensorInfo(d,i),f=n.texData.get(h.dataId);return f.values=c,h}let o;return ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new wm(JD,s.shape,r.shape):o=new _h(JD,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const gTe={kernelName:C$,backendName:"webgl",kernelFunc:FR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xTe(t,e,n){const s=[zp(t.shape),...Wp(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[zp(e),...Wp(e)],o=new w8(i,s),a=!0,l=[s],c=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function et(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=be(r.shape),l=$z(i,a),c=be(l);O(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=o.texData.get(r.dataId);return d.isPacked&&!Gb(r.shape,l)&&!(d.texture!==null&&Gb(d.shape,l))?xTe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const yTe={kernelName:L$,backendName:"webgl",kernelFunc:et};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eO{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const h=1/n;c=`sumValue += dot(values * ${Ap(h)?h.toPrecision(2):h}, ones);`}let d="";i%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vTe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const d=Math.floor(s/4)*4,h=s%4;let f=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let m="";i%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${h===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=T1(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Qh(t,e,n,s){const r=bTe(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:c}=r[o];let d,h;n==="mean"?d=o===0?new eO({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new eO({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):d=new vTe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),h=i,i=s.runWebGLProgram(d,[i],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wTe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=es(this.rank),i=STe(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function STe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CTe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[n[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=es(this.rank),i=b8("rc",this.rank),o=new Array(this.rank);for(let d=0;d<n.length;d++)o[n[d]]=i[d];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A1(t,e,n){const s=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CTe(t.shape,e):new wTe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kTe(t,e,n,s){const r=e,i=t.shape.length,o=bs(r,t.shape);let a=o;const l=Mr(a,i),c=l!=null;let d=t;c&&(d=A1(t,l,s),a=Lr(a.length,i)),eo("sum",a,i);const[h,f]=Oo(d.shape,a);let p=h;n&&(p=Ji(h,o));const m=be(f),x=be(t.shape)/m,y=et({inputs:{x:d},attrs:{shape:[x,m]},backend:s}),v=m1(t.dtype),S=Qh(y,v,"sum",s),C=et({inputs:{x:S},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(S),c&&s.disposeIntermediateTensorInfo(d),C}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j1(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return kTe(r,i,o,n)}const NTe={kernelName:rI,backendName:"webgl",kernelFunc:j1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ni(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[i[d]];let c;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,f=DR(h,r.shape,r.dtype,i,l);c=o.makeTensorInfo(l,r.dtype);const p=o.texData.get(c.dataId);p.values=f}else c=A1(r,i,o);return c}const TTe={kernelName:Dg,backendName:"webgl",kernelFunc:ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _8=1e3;function Kb({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,d=e.shape.length,h=n?t.shape[c-2]:t.shape[c-1],f=s?e.shape[d-1]:e.shape[d-2],p=n?t.shape[c-1]:t.shape[c-2],m=s?e.shape[d-2]:e.shape[d-1],g=t.shape.slice(0,-2),x=e.shape.slice(0,-2),y=be(g),v=be(x),C=nn(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,m]);O(h===f,()=>`Error in matMul: inner shapes (${h}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const k=n?[y,h,p]:[y,p,h],T=s?[v,m,f]:[v,f,m],_=et({inputs:{x:t},backend:r,attrs:{shape:k}}),$=et({inputs:{x:e},backend:r,attrs:{shape:T}}),R=[_,$],A=Math.max(y,v),j=n?_.shape[1]:_.shape[2],F=i!=null,L=o!=null,M=l==="leakyrelu",q=l!=null?P0(l,!0):null,z=F||L||M||q!=null;let re;if((p===1||m===1)&&j>_8&&z===!1){let G=_,xe=$;n&&(G=ni({inputs:{x:_},backend:r,attrs:{perm:[0,2,1]}}),R.push(G)),s&&(xe=ni({inputs:{x:$},backend:r,attrs:{perm:[0,2,1]}}),R.push(xe));const Ce=m!==1,De=m===1;let fe=G;Ce&&(fe=et({inputs:{x:G},backend:r,attrs:{shape:[A,j,1]}}),R.push(fe));const ee=m===1?2:1;let Pe=xe;De&&(Pe=et({inputs:{x:xe},backend:r,attrs:{shape:[A,1,j]}}),R.push(Pe));const Re=FR({inputs:{a:fe,b:Pe},backend:r});re=j1({inputs:{x:Re},backend:r,attrs:{axis:ee,keepDims:!0}}),R.push(Re)}else{const G=wi(t.dtype,e.dtype),xe=new T8(k,T,[A,p,m],n,s,F,q,L,M),Ce=[_,$];if(i!=null&&Ce.push(i),L&&Ce.push(o),M){const De=r.makeTensorInfo([],"float32",dm(a,"float32"));Ce.push(De),R.push(De)}re=r.runWebGLProgram(xe,Ce,G)}const U=et({inputs:{x:re},backend:r,attrs:{shape:C}});R.push(re);for(const G of R)r.disposeIntermediateTensorInfo(G);return U}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Te(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:d,leakyreluAlpha:h}=s;return Kb({a:r,b:i,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:d})}const ETe={kernelName:Eb,backendName:"webgl",kernelFunc:_Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tO="return abs(x);";function $Te(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=y8(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new wu(s.shape,tO):r=new vl(s.shape,tO),n.runWebGLProgram(r,[s],s.dtype)}const ITe={kernelName:G_,backendName:"webgl",kernelFunc:$Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RTe=ba+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,PTe=_n({opSnippet:RTe}),ATe={kernelName:K_,backendName:"webgl",kernelFunc:PTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jTe=ba+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,DTe=_n({opSnippet:jTe}),OTe={kernelName:q_,backendName:"webgl",kernelFunc:DTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nO="return a + b;",FTe=Er({opSnippet:nO,packedOpSnippet:nO,supportsComplex:!0,cpuKernelImpl:Kke}),MTe={kernelName:c1,backendName:"webgl",kernelFunc:FTe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LTe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BTe{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rv(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Yi({inputs:{x:s[0]},backend:n});if(s.length>ue().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=Rv({inputs:s.slice(0,l),backend:n}),d=Rv({inputs:s.slice(l),backend:n});return Rv({inputs:[c,d],backend:n})}const r=s.map(l=>l.dtype).reduce((l,c)=>wi(l,c)),i=s.map(l=>l.shape),a=ue().getBool("WEBGL_PACK")?new BTe(s[0].shape,i):new LTe(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const VTe={kernelName:X_,backendName:"webgl",kernelFunc:Rv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=bs(i,r.shape);let c=l;const d=Mr(c,a);let h=r;d!=null&&(h=ni({inputs:{x:r},backend:n,attrs:{perm:d}}),c=Lr(c.length,a)),eo("all",c,a);const[f,p]=Oo(h.shape,c),m=be(p),g=et({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}}),x=Qh(g,g.dtype,"all",n);let y;if(o){const v=Ji(f,l);y=et({inputs:{x},backend:n,attrs:{shape:v}})}else y=et({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),d!=null&&n.disposeIntermediateTensorInfo(h),y}const WTe={kernelName:Y_,backendName:"webgl",kernelFunc:zTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=bs(i,r.shape);let c=l;const d=Mr(c,a);let h=r;d!=null&&(h=ni({inputs:{x:r},backend:n,attrs:{perm:d}}),c=Lr(c.length,a)),eo("any",c,a);const[f,p]=Oo(h.shape,c),m=be(p),g=et({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}}),x=Qh(g,g.dtype,"any",n);let y;if(o){const v=Ji(f,l);y=et({inputs:{x},backend:n,attrs:{shape:v}})}else y=et({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),d!=null&&n.disposeIntermediateTensorInfo(h),y}const HTe={kernelName:Q_,backendName:"webgl",kernelFunc:UTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GTe{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KTe{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=es(l),d=Yr("coords",l);let h,f;if(o===1){f=l+1;const $=es(f);h=`
        ${$} sourceLocR = ${$}(${d.join()}, 0);
        ++${d[l-1]};
        ${$} sourceLocG = ${$}(${d.join()}, 0);
        ++${d[l-2]};
        ${$} sourceLocA = ${$}(${d.join()}, 0);
        --${d[l-1]};
        ${$} sourceLocB = ${$}(${d.join()}, 0);
        --${d[l-2]};`}else f=l,h=`
        ${c} sourceLocR = coords;
        ++${d[l-1]};
        ${c} sourceLocG = coords;
        ++${d[l-2]};
        ${c} sourceLocA = coords;
        --${d[l-1]};
        ${c} sourceLocB = coords;
        --${d[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,f),m="."+p[f-1],g=p.map($=>"int "+$),x=Yr("sourceLocR",f-1).concat("inIdx.r"),y=Yr("sourceLocG",f-1).concat("inIdx.g"),v=Yr("sourceLocB",f-1).concat("inIdx.b"),S=Yr("sourceLocA",f-1).concat("inIdx.a"),C=s==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${S.join()})));`,T=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,_=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${_}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${T};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${k}
          vec4 candidate = ${T};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=T1(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new GTe(a,n,s==null),c=[e];s!=null&&c.push(s);const d=t.runWebGLProgram(l,c,"int32");if(d.shape[1]===1)return d;const h=E8(t,e,n,d);return t.disposeIntermediateTensorInfo(d),h}function $8(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=T1(i),a=new KTe(r,o,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const d=$8(t,e,n,c);return t.disposeIntermediateTensorInfo(c),d}return c}function I8(t,e,n,s){const r=[n];if(eo("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!ue().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[c,d]=Oo(l.shape,r),h=be(d),f=et({inputs:{x:l},backend:t,attrs:{shape:[-1,h]}});i.push(f);const p=E8(t,f,s);i.push(p);const m=et({inputs:{x:p},backend:t,attrs:{shape:c}});return i.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}return $8(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=bs(i,r.shape);const a=Mr(o,r.shape.length);let l=r;const c=[];a!=null&&(l=ni({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=Lr(o.length,l.shape.length)),eo("argMax",[o[0]],l.shape.length);const d=I8(n,l,o[0],"max");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),d}const XTe={kernelName:Z_,backendName:"webgl",kernelFunc:qTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=bs(i,r.shape);const a=Mr(o,r.shape.length);let l=r;const c=[];a!=null&&(l=ni({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=Lr(o.length,l.shape.length)),eo("argMin",[o[0]],l.shape.length);const d=I8(n,l,o[0],"min");return c.forEach(h=>n.disposeIntermediateTensorInfo(h)),d}const QTe={kernelName:J_,backendName:"webgl",kernelFunc:YTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZTe=ba+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,JTe=_n({opSnippet:ZTe}),e_e={kernelName:eE,backendName:"webgl",kernelFunc:JTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t_e=ba+"return log(x + sqrt(x * x + 1.0));",n_e=_n({opSnippet:t_e}),s_e={kernelName:tE,backendName:"webgl",kernelFunc:n_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r_e=ba+`
  return atan(x);
`,i_e=_n({opSnippet:r_e}),o_e={kernelName:nE,backendName:"webgl",kernelFunc:i_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a_e=OR+`
  return atan(a, b);
`,l_e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yh+`
  return result;
`,c_e=Er({opSnippet:a_e,packedOpSnippet:l_e}),u_e={kernelName:rE,backendName:"webgl",kernelFunc:c_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d_e=ba+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,h_e=_n({opSnippet:d_e}),f_e={kernelName:sE,backendName:"webgl",kernelFunc:h_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A0{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const g=n==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let v="0.0";if(g||(v="-1.0 / 1e-20"),s){const $=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${$} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?x:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const k=Math.floor(o/4)*4,T=o%4,_=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${m});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${k}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${_}
          }

          int xC = xCCorner + ${k};
          if (${T===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${_}
          } else if (${T===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${_}
          } else if (${T===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${_}
          }
        }
        setOutput(${C});
      }
    `}}class MR{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,d=e.dilationDepth,h=e.dilationHeight,f=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,y=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;const S=n==="avg";let C="0.0";if(S||(C="-1.0 / 1e-20"),s){const A=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${x}, ${y}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${A} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const k="max";let T=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(T="avgValue / max(count, 1.0)");const _=Math.floor(o/4)*4,$=o%4,R=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${k}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${x}, ${y}, ${v});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${_}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${_};
            if (${$===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${$===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${$===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${T});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Dx(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ri(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=ya(r.shape,i,o,c,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Gn(d.inShape,d.outShape))return Yi({inputs:{x:r},backend:n});const h=new A0(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const m_e={kernelName:iE,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,d=[1,1,1],h=Oc(r.shape,i,o,d,a,l,c),f=new MR(h,"avg",!1);return n.runWebGLProgram(f,[r],"float32")}const x_e={kernelName:oE,backendName:"webgl",kernelFunc:g_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=l-1-e.padInfo.top,h=c-1-e.padInfo.left,f=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${h});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class v_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=h-1-e.padInfo.front,g=f-1-e.padInfo.top,x=p-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${g}, ${x});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=s,h=[1,1,1],f=Oc(o.shape,a,l,h,c,d),p=new v_e(f);return n.runWebGLProgram(p,[r],o.dtype)}const w_e={kernelName:Oz,backendName:"webgl",kernelFunc:b_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Dx([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,d=ya(o.shape,a,l,1,c),h=new y_e(d);return n.runWebGLProgram(h,[r],o.dtype)}const C_e={kernelName:Dz,backendName:"webgl",kernelFunc:S_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return Kb({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const N_e={kernelName:aE,backendName:"webgl",kernelFunc:k_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class T_e{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],nn(e,n),nn(e,s);let a="0.0";r!=null&&(nn(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(nn(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class __e{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],nn(e,n),nn(e,s);let a="vec4(0.0)";r!=null&&(nn(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(nn(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E_e=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;O(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,r,i];let d=null;o!=null&&(d=o.shape,c.push(o));let h=null;a!=null&&(h=a.shape,c.push(a));const f=ue().getBool("WEBGL_PACK_NORMALIZATION")?new __e(s.shape,r.shape,i.shape,d,h,l):new T_e(s.shape,r.shape,i.shape,d,h,l);return e.runWebGLProgram(f,c,c[0].dtype)},$_e={kernelName:GE,backendName:"webgl",kernelFunc:E_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class I_e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=es(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=R_e(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${vN[a]} = start[${a}] + coords.${vN[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const vN=["x","y","z","w","u","v"];function R_e(t){if(t===1)return"sourceLoc";if(t<=6)return vN.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P_e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=es(this.rank),s=Yr("coords",this.rank),r=Yr("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((d,h)=>`start[${h}]`).join()});`:e.map((d,h)=>`${r[h]} = ${s[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_e(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=tR(e,Ms(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function Cm(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=nR(r,i,o);if(ZI(r,a,l),be(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=n.texData.get(r.dataId),f=NNe(h.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,f)}const{isPacked:c}=n.texData.get(r.dataId),d=eR(r.shape,a,l);if(c||!d){const h=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new P_e(l):new I_e(l),f=[a];return n.runWebGLProgram(h,[r],r.dtype,f)}return n.uploadToGPU(r.dataId),A_e(r,a,l,n)}const j_e={kernelName:Q$,backendName:"webgl",kernelFunc:Cm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;O(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((v,S)=>v*S),l=Ix(r.shape,i,a),c=Rx(l.length,i.length),d=Px(r.shape,i,a),h=aR(o,i.length),f=lR(d,o,i.length),p=[],m=et({inputs:{x:r},backend:n,attrs:{shape:l}}),g=ni({inputs:{x:m},backend:n,attrs:{perm:c}}),x=et({inputs:{x:g},backend:n,attrs:{shape:d}}),y=Cm({inputs:{x},backend:n,attrs:{begin:h,size:f}});return p.push(m),p.push(g),p.push(x),p.forEach(v=>n.disposeIntermediateTensorInfo(v)),y},O_e={kernelName:lE,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=x8(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}const M_e={kernelName:cE,backendName:"webgl",kernelFunc:F_e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L_e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,B_e=`
  return float(int(a.r) & int(b.r));
`;function V_e(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=ue().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(r.dataId).values,[d,h]=Xke(s.shape,r.shape,l,c,s.dtype),f=n.makeTensorInfo(h,s.dtype),p=n.texData.get(f.dataId);return p.values=d,f}let a;return i?a=new wm(L_e,s.shape,r.shape,!1):a=new _h(B_e,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const z_e={kernelName:Fz,backendName:"webgl",kernelFunc:V_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=nn(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const U_e={kernelName:uE,backendName:"webgl",kernelFunc:W_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_e="return float(a != b);",R8=Er({opSnippet:H_e,cpuKernelImpl:gNe,dtype:"bool"}),G_e={kernelName:N$,backendName:"webgl",kernelFunc:R8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fx(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yi({inputs:{x:r.complexTensorInfos.real},backend:n})}const K_e={kernelName:O$,backendName:"webgl",kernelFunc:Fx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q_e="return float(int(x));";function X_e(t,e){const n=new vl(t.shape,q_e),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bN(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return Yi({inputs:{x:r},backend:n});const o=Rc(r.shape),a=bN({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=cd({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Fx({inputs:{input:r},backend:n}),a=bN({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!Iz(r.dtype,i)){const o=Yi({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,c]=Yke(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}if(i==="int32")return X_e(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",Dl("bool",1)),l=R8({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const Y_e={kernelName:u1,backendName:"webgl",kernelFunc:bN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sO="return ceil(x);",Q_e=_n({opSnippet:sO,packedOpSnippet:sO,cpuKernelImpl:Qke}),Z_e={kernelName:dE,backendName:"webgl",kernelFunc:Q_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J_e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;ue().getBool("WEBGL_PACK_CLIP")?a=new eEe(r.shape):a=new J_e(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const nEe={kernelName:hE,backendName:"webgl",kernelFunc:tEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sEe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rO(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function rEe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new sEe(s.shape),o=[rO(s,r.complexTensorInfos.real),rO(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const iEe={kernelName:pE,backendName:"webgl",kernelFunc:rEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oEe{constructor(e){this.outputShape=[],this.outputShape=ma(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aEe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ma(e,n);const s=this.outputShape,r=s.length,i=es(r),o=Yr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let g=1;g<l.length;g++)l[g]=l[g-1]+e[g][n];const c=a[n],d=a.slice(-2),h=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${h}), vec2(${d.join()}));
        }`;for(let g=1;g<l.length;g++){const x=l[g-1];f+=`
        if (${c} < ${l[g]}  && ${c} >= ${l[g-1]}) {
          return getChannel(
            getT${g}(${Dy(a,c,x)}),
            vec2(${Dy(d,c,x)}));
        }`}const p=l.length,m=l[l.length-1];f+=`
        return getChannel(
          getT${p}(${Dy(a,c,m)}),
          vec2(${Dy(d,c,m)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${f}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Dy(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D1(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yi({inputs:{x:r.complexTensorInfos.imag},backend:n})}const lEe={kernelName:ZE,backendName:"webgl",kernelFunc:D1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dg(t,e,n){const s=t[0].dtype;if(s==="complex64"){const p=t.map(v=>Fx({inputs:{input:v},backend:n})),m=t.map(v=>D1({inputs:{input:v},backend:n})),g=dg(p,e,n),x=dg(m,e,n),y=cd({inputs:{real:g,imag:x},backend:n});return p.forEach(v=>n.disposeIntermediateTensorInfo(v)),m.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const p=t.map(C=>{const T=[-1,be(C.shape.slice(e))];return et({inputs:{x:C},backend:n,attrs:{shape:T}})}),m=p.map(C=>({vals:n.readSync(C.dataId),shape:C.shape})),g=ma(p.map(C=>C.shape),1),x=p[0].shape[0]===1,y=Zke(m,g,s,x),v=ma(t.map(C=>C.shape),e),S=n.makeTensorInfo(v,s,y);return p.forEach(C=>n.disposeIntermediateTensorInfo(C)),S}const i=t.filter(p=>be(p.shape)>0),o=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const p=o?new vl(t[0].shape,tu):new wu(t[0].shape,tu);return n.runWebGLProgram(p,t,s)}const a=ue().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const p=[];for(let g=0;g<i.length;g+=a){const x=i.slice(g,g+a);p.push(dg(x,e,n))}const m=dg(p,e,n);for(const g of p)n.disposeIntermediateTensorInfo(g);return m}if(o){const p=new aEe(i.map(m=>m.shape),e);return n.runWebGLProgram(p,i,s)}const{tensors2D:l,outShape:c}=cEe(i,e,n),d=new oEe(l.map(p=>p.shape)),h=n.runWebGLProgram(d,l,s);l.forEach(p=>n.disposeIntermediateTensorInfo(p));const f=et({inputs:{x:h},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(h),f}function cEe(t,e,n){const s=ma(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>et({inputs:{x:i},attrs:{shape:[-1,be(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P8(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=bs(r,e[0].shape)[0],o=e.map(c=>c.shape);rR(o,i);const a=ma(e.map(c=>c.shape),i);if(be(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>be(c.shape)>0);return l.length===1?Yi({inputs:{x:l[0]},backend:n}):dg(l,i,n)}const uEe={kernelName:mE,backendName:"webgl",kernelFunc:P8};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A8{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",y=x?1:2,v=x?2:3,S=x?3:1;let C="",k="";s&&(r?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:C=`
          float activation(float x) {
            ${s}
          }
        `,k="result = activation(result);");const T=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${T}
        ${k}
        setOutput(result);
      }
    `}}class dEe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterDepth,f=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j8{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Br(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=d;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<d;x++)f+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<d;x++)f+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(h+1)/2;x++){const y=x*2;if(f+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<d&&(o%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?f+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<d)){const v=o%2===0?W_(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${v};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:f+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):v===1?f+=`
                     xC${y+1} = xTexelC${y};
                     `:f+=`
                     xCOffset = xC + ${v};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<d&&(o%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<d&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<d&&(f+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<d&&(f+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<d&&(f+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hEe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Br(this.outputShape.length);const{dataFormat:s}=n,r=ii(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let d=0;d<=1;d++)for(let h=0;h<=1;h++)c+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function D8({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),d=n.inChannels,h=l[0]*l[1]*l[2],f=n.outChannels,p=n.dataFormat==="channelsLast",m=!1,g=!1;let x;const y=[];if(i!=null){const C=qb(i.shape,p);C!=null&&(i=et({inputs:{x:i},backend:s,attrs:{shape:C}}),y.push(i))}if(r!=null){const C=qb(r.shape,p);C!=null&&(r=et({inputs:{x:r},backend:s,attrs:{shape:C}}),y.push(r))}if(!((h===1||f===1)&&d>_8)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&Gn(c.shape.slice(-3),l.slice(-3))){const C=l[0]*l[1]*(l[2]+1),k={dataId:t.dataId,shape:[1,C,n.inChannels],dtype:t.dtype},T=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,O(Gb(c.shape,k.shape),()=>`packed reshape ${c.shape} to ${k.shape} isn't free`);const _=et({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(_);const $=Kb({a:k,b:_,backend:s,transposeA:m,transposeB:g,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),R=s.texData.get($.dataId);O(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=T,R.shape=n.outShape,x=Yi({inputs:{x:$},backend:s}),x.shape=n.outShape,y.push($)}else{const C=n.outHeight*n.outWidth,k=et({inputs:{x:t},backend:s,attrs:{shape:p?[n.batchSize,C,n.inChannels]:[n.batchSize,n.inChannels,C]}}),T=et({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),_=Kb({a:p?k:T,b:p?T:k,transposeA:!p,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});x=et({inputs:{x:_},backend:s,attrs:{shape:n.outShape}}),y.push(k),y.push(T),y.push(_)}for(const C of y)s.disposeIntermediateTensorInfo(C);return x}function O8({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:d,outWidth:h,outHeight:f,dataFormat:p}=n,m=p==="channelsLast",g=l*c*d,x=f*h,y=[n.batchSize,g,x],v=!0,S=!1,C=[];if(i!=null){const U=qb(i.shape,m);U!=null&&(i=et({inputs:{x:i},backend:s,attrs:{shape:U}}),C.push(i))}if(r!=null){const U=qb(r.shape,m);U!=null&&(r=et({inputs:{x:r},backend:s,attrs:{shape:U}}),C.push(r))}const k=et({inputs:{x:e},backend:s,attrs:{shape:[1,g,be(e.shape)/g]}});C.push(k);const T=new hEe(y,n),_=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],$=s.runWebGLProgram(T,[t],"float32",_),R=et({inputs:{x:$},backend:s,attrs:{shape:y}});C.push($),C.push(R);const A=r!=null,j=i!=null,F=a==="leakyrelu",L=a?P0(a,!0):null,M=new T8(m?R.shape:k.shape,m?k.shape:R.shape,m?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],v,S,A,L,j,F),q=m?[R,k]:[k,R];if(r&&q.push(r),j&&q.push(i),F){const U=s.makeTensorInfo([],"float32",dm(o,"float32"));q.push(U),C.push(U)}const z=s.runWebGLProgram(M,q,"float32"),re=et({inputs:{x:z},backend:s,attrs:{shape:n.outShape}});C.push(z);for(const U of C)s.disposeIntermediateTensorInfo(U);return re}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:d}=s,h=el(l),f=sr(r.shape,i.shape,o,c,a,d,!1,h);let p;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))p=D8({x:r,filter:i,convInfo:f,backend:n});else if(f.strideWidth<=2&&h==="channelsLast"&&ue().getBool("WEBGL_EXP_CONV")){const g=new j8(f),x=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];p=n.runWebGLProgram(g,[r,i],"float32",x)}else if(ue().getBool("WEBGL_CONV_IM2COL"))p=O8({x:r,filter:i,convInfo:f,backend:n});else{const g=new A8(f);p=n.runWebGLProgram(g,[r,i],"float32")}const m=et({inputs:{x:p},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(p),m}const pEe={kernelName:gE,backendName:"webgl",kernelFunc:fEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mEe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class gEe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,d=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class xEe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class yEe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:d}=s,h=el(l),f=sr(r.shape,d,o,1,a,c,!1,h),p=new mEe(f);return n.runWebGLProgram(p,[r,i],"float32")}const bEe={kernelName:xE,backendName:"webgl",kernelFunc:vEe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wEe{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Br(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SEe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:d}=s,h=el(c),f=sr(o,i.shape,a,1,l,d,!1,h);if(ue().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const p=[[f.strideHeight,f.strideWidth]],m=new wEe(f);return n.runWebGLProgram(m,[r,i],"float32",p)}else{const p=new gEe(f);return n.runWebGLProgram(p,[r,i],"float32")}}const CEe={kernelName:yE,backendName:"webgl",kernelFunc:SEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=ad(r.shape,i.shape,o,l,a),d=new dEe(c);return n.runWebGLProgram(d,[r,i],"float32")}const NEe={kernelName:vE,backendName:"webgl",kernelFunc:kEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,c=ad(r.shape,l,o,1,a),d=new xEe(c);return n.runWebGLProgram(d,[r,i],"float32")}const _Ee={kernelName:Mz,backendName:"webgl",kernelFunc:TEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EEe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,c=ad(l,i.shape,a,1,o),d=new yEe(c);return n.runWebGLProgram(d,[r,i],"float32")}const $Ee={kernelName:bE,backendName:"webgl",kernelFunc:EEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IEe=Sm+`
  return cos(x);
`,REe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Yh}
  return result;
`,PEe=_n({opSnippet:IEe,packedOpSnippet:REe}),AEe={kernelName:wE,backendName:"webgl",kernelFunc:PEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jEe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,DEe=_n({opSnippet:jEe}),OEe={kernelName:SE,backendName:"webgl",kernelFunc:DEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FEe{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[d]=n,[h,f]=s;this.outputShape=[d,h,f,c];const p=r==="bilinear"?1:0,[m,g]=[`${a-1}.0`,`${l-1}.0`],[x,y,v]=h>1?[`${(a-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[S,C,k]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${C};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${k};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MEe=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,d=new FEe(r.shape,i.shape,a,l,c);return n.runWebGLProgram(d,[r,i,o],"float32")},LEe={kernelName:NE,backendName:"webgl",kernelFunc:MEe};var j0;(function(t){t.Prod="*",t.Sum="+"})(j0||(j0={}));class iO{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===j0.Prod?"1.0":"0.0",a=s?o:`getX(${oO(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",d="";s?(c=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${es(i)} coords = getOutputCoords();
        int end = ${aO(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${d};
          ${aO(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${oO(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function oO(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function aO(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(t,e,n,s,r,i){const o=e.shape.length,a=Mr([s],o);let l=e;a!=null&&(l=ni({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Lr(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[c];let h=Yi({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(d))-1;f++){const p=new iO(t,l.shape,!1,i),m=[[f]],g=h;h=n.runWebGLProgram(p,[h],h.dtype,m),n.disposeIntermediateTensorInfo(g)}if(r){const f=new iO(t,l.shape,r,i),p=h;h=n.runWebGLProgram(f,[h],h.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const f=$x(a),p=ni({inputs:{x:h},backend:n,attrs:{perm:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(l),p}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return F8(j0.Prod,r,n,i,o,a)}const VEe={kernelName:CE,backendName:"webgl",kernelFunc:BEe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return F8(j0.Sum,r,n,i,o,a)}const WEe={kernelName:kE,backendName:"webgl",kernelFunc:zEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),c=n.readSync(i.dataId),d=x8(l,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,d)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(i),d=qke(l,c,o,a);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const HEe={kernelName:TE,backendName:"webgl",kernelFunc:UEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GEe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],d=o==="NHWC"?r.shape[3]:r.shape[1],h=l*i,f=c*i,p=d/(i*i),m=o==="NHWC"?[a,h,f,p]:[a,p,h,f],g=new GEe(m,i,o);return n.runWebGLProgram(g,[r],r.dtype)}const qEe={kernelName:_E,backendName:"webgl",kernelFunc:KEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M8{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Br(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",d="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L8{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Br(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=h;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<h;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let y=0;y<h;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){const v=y*2;if(p+=`
          xC = xCCorner + ${v*c};
          `,l===1){if(v<h&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }
              `,c===1&&v>0?p+=`
                xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                  } else {
                    xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xC${v} = xTexelC${v};
                `,v+1<h)){const S=a%2===0?W_(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                    xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${v+1}.zw = vec2(0.0);
                    }
                    xTexelC${v+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                    } else {
                     xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                    }
                    `:p+=`
                    xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                    `):S===1?p+=`
                    xC${v+1} = xTexelC${v};
                    `:p+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                      xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${v+1}.zw = vec2(0.0);
                      }
                      xTexelC${v+1}Ready = 1;
                    }

                    xC${v+1} = xTexelC${v+1};
                    `}}else v<h&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.0);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
              `,v+1<h&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                  xTexelC${v} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${v}.zw = vec2(0.0);
                  }
                  xTexelC${v}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                  xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${v+1}.zw = vec2(0.);
                  }
                  xTexelC${v+1}Ready = 1;
                }

                xC${v} = vec4(
                  xTexelC${v}.xy, xTexelC${v+1}.xy);
              `,v+1<h&&(p+=`
                  xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                `)));v<h&&(p+=`
            wTexel = getW(r, ${v}, d1, q);
            dotProd += xC${v} * vec4(wTexel.xz, wTexel.xz);
          `,v+1<h&&(p+=`
              wTexel = getW(r, ${v+1}, d1, q);
              dotProd += xC${v+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let m="",g="";s&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:m=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let d=l;d==null&&(d=[1,1]),O(ri(o,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const h=sr(r.shape,i.shape,o,d,a,c,!0);let f;ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?f=new L8(h):f=new M8(h);const p=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(f,[r,i],"float32",p)}const YEe={kernelName:EE,backendName:"webgl",kernelFunc:XEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QEe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ZEe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:d}=s,h=sr(r.shape,d,o,a,l,c,!0),f=new QEe(h);return n.runWebGLProgram(f,[r,i],"float32")}const e$e={kernelName:$E,backendName:"webgl",kernelFunc:JEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t$e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:d}=s,h=sr(d,i.shape,o,a,l,c,!0),f=new ZEe(h);return n.runWebGLProgram(f,[r,i],"float32")}const n$e={kernelName:IE,backendName:"webgl",kernelFunc:t$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s$e{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r$e(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=be(s.shape),o=et({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new s$e(i),l=n.runWebGLProgram(a,[o],o.dtype),c=et({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const i$e={kernelName:RE,backendName:"webgl",kernelFunc:r$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o$e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:d}=e,{top:h,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=_x(r.shape,i.shape,o,a,"NHWC",l);let d;const h=new o$e(c);d=n.runWebGLProgram(h,[r,i],"float32");const f=et({inputs:{x:d},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(d),f}const l$e={kernelName:PE,backendName:"webgl",kernelFunc:a$e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c$e(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=xR(r,i.length);vR(o.length,l,i);const{path:c,steps:d}=bR(a,l),h=d.length;let f=null,p=o.length;const m=[];for(let g=0;g<h;++g){for(const x of d[g]){const{permutationIndices:y,expandDims:v}=yR(p,l[x]);let S;wR(y)?S=i[x]:(S=ni({inputs:{x:i[x]},backend:n,attrs:{perm:y}}),m.push(S));const C=S.shape.slice();for(let k=0;k<v.length;++k)C.splice(v[k],0,1);Gn(S.shape,C)||(S=et({inputs:{x:S},backend:n,attrs:{shape:C}}),m.push(S)),f===null?f=S:(f=FR({inputs:{a:S,b:f},backend:n}),m.push(f))}g<h-1&&(c[g]>=0&&(f=j1({inputs:{x:f},backend:n,attrs:{axis:c[g]-(o.length-p),keepDims:!1}}),m.push(f)),p--)}for(const g of m)g!==f&&n.disposeIntermediateTensorInfo(g);return f}const u$e={kernelName:jE,backendName:"webgl",kernelFunc:c$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",h$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,f$e=_n({opSnippet:d$e,packedOpSnippet:h$e}),p$e={kernelName:DE,backendName:"webgl",kernelFunc:f$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$e="return (b >= 0.0) ? a : a * (b + 1.0);",g$e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,x$e=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=ue().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wm(g$e,s.shape,r.shape):new _h(m$e,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},y$e={kernelName:Bz,backendName:"webgl",kernelFunc:x$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$e=`
  return vec4(equal(a, b));
`,b$e="return float(a == b);",w$e=Er({opSnippet:b$e,packedOpSnippet:v$e,dtype:"bool",cpuKernelImpl:Jke}),S$e={kernelName:FE,backendName:"webgl",kernelFunc:w$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C$e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${dR};
  float a1 = ${hR};
  float a2 = ${fR};
  float a3 = ${pR};
  float a4 = ${mR};
  float a5 = ${gR};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,k$e=_n({opSnippet:C$e}),N$e={kernelName:OE,backendName:"webgl",kernelFunc:k$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T$e=Sm+`
  return exp(x);
`,_$e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,B8=_n({opSnippet:T$e,packedOpSnippet:_$e,cpuKernelImpl:eNe,dtype:"float32"}),E$e={kernelName:ME,backendName:"webgl",kernelFunc:B8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wN(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(O(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),et({inputs:{x:i},backend:s,attrs:{shape:a}})}const $$e={kernelName:LE,backendName:"webgl",kernelFunc:wN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lO="return exp(x) - 1.0;",I$e=_n({opSnippet:lO,packedOpSnippet:lO,cpuKernelImpl:tNe}),R$e={kernelName:BE,backendName:"webgl",kernelFunc:I$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cO{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V8(t,e,n){const s=n.texData.get(t.dataId),r=be(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=et({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,c=new cO("real",l,e),d=new cO("imag",l,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],f=n.runWebGLProgram(c,h,"float32"),p=n.runWebGLProgram(d,h,"float32"),m=cd({inputs:{real:f,imag:p},backend:n});n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p);const g=et({inputs:{x:m},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(m),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$e(t){const{inputs:e,backend:n}=t,{input:s}=e;return V8(s,!1,n)}const A$e={kernelName:VE,backendName:"webgl",kernelFunc:P$e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j$e{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mx(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||um(r),i==="string"){const o=or(i,be(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new j$e(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const D$e={kernelName:zE,backendName:"webgl",kernelFunc:Mx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O$e{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F$e={kernelName:WE,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new O$e(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uO="return floor(x);",M$e=_n({opSnippet:uO,packedOpSnippet:uO,cpuKernelImpl:nNe}),L$e={kernelName:UE,backendName:"webgl",kernelFunc:M$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B$e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,V$e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,z$e=Er({opSnippet:B$e,packedOpSnippet:V$e,dtype:"int32"}),W$e={kernelName:HE,backendName:"webgl",kernelFunc:z$e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U$e{constructor(e){this.variableNames=["A"];const n=ii(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H$e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=ii(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G$e={kernelName:_b,backendName:"webgl",kernelFunc:K$e};let ff,gS=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function K$e(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[c,l],h=[c,l,i];if(a||o){const g=ue().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ff==null||g!==gS)&&(gS=g,ff=document.createElement("canvas").getContext("2d",{willReadFrequently:gS})),ff.canvas.width=l,ff.canvas.height=c,ff.drawImage(r,0,0,l,c),r=ff.canvas}const f=n.makeTensorInfo(d,"int32");n.texData.get(f.dataId).usage=bo.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),r);const p=ue().getBool("WEBGL_PACK")?new H$e(h):new U$e(h),m=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:d,dilations:h,dimRoundingMode:f,activation:p,leakyreluAlpha:m}=s,g=el(d),x=sr(r.shape,i.shape,l,h,c,f,!1,g);let y;const v=[],S=o!=null,C=a!=null,k=p==="leakyrelu",T=()=>{const $=[r,i],R=(A,j)=>{if(j==="NCHW"&&A.shape.length===1&&A.shape[0]!==1){const F=et({inputs:{x:A},backend:n,attrs:{shape:[A.shape[0],1,1]}});return v.push(F),F}return A};if(S&&$.push(R(o,d)),C&&$.push(R(a,d)),k){const A=n.makeTensorInfo([],"float32",dm(m,"float32"));$.push(A),v.push(A)}return $};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=D8({x:r,filter:i,convInfo:x,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&g==="channelsLast"&&ue().getBool("WEBGL_EXP_CONV")){const $=p?P0(p,!0):null,R=new j8(x,S,$,C,k),A=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],j=T();y=n.runWebGLProgram(R,j,"float32",A)}else if(ue().getBool("WEBGL_CONV_IM2COL"))y=O8({x:r,filter:i,convInfo:x,backend:n,bias:o,activation:p,preluActivationWeights:a,leakyreluAlpha:m});else{const $=p?P0(p,!1):null,R=new A8(x,S,$,C,k),A=T();y=n.runWebGLProgram(R,A,"float32")}const _=et({inputs:{x:y},backend:n,attrs:{shape:x.outShape}});return v.push(y),v.forEach($=>n.disposeIntermediateTensorInfo($)),_}const X$e={kernelName:$b,backendName:"webgl",kernelFunc:q$e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=[];let g=d;g==null&&(g=[1,1]),O(ri(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const x=sr(r.shape,i.shape,l,g,c,h,!0),y=ue().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,v=f?P0(f,y):null,S=[r,i],C=o!=null,k=a!=null,T=f==="leakyrelu";if(C&&S.push(o),k&&S.push(a),T){const A=n.makeTensorInfo([],"float32",dm(p,"float32"));S.push(A),m.push(A)}let _;y?_=new L8(x,C,v,k,T):_=new M8(x,C,v,k,T);const $=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],R=n.runWebGLProgram(_,S,"float32",$);return m.forEach(A=>n.disposeIntermediateTensorInfo(A)),R}const Q$e={kernelName:Ib,backendName:"webgl",kernelFunc:Y$e};class Z$e{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=es(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$e(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=be(s.shape),[l,c,d,h]=QI(s,r),f=et({inputs:{x:r},backend:n,attrs:{shape:[c,o]}}),p=et({inputs:{x:s},backend:n,attrs:{shape:[be(s.shape)/d,d]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),v=n.bufferSync(s),S=sNe(y,v,s.dtype,c,o,d,h,s.shape,a);return n.makeTensorInfo(l,s.dtype,S.values)}const m=new Z$e(o,h,[c,d],s.shape),g=n.runWebGLProgram(m,[p,f],p.dtype),x=et({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),x}const eIe={kernelName:qE,backendName:"webgl",kernelFunc:J$e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tIe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=es(this.rank),r=nIe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function nIe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=bs(o,r.shape)[0];if(ue().get("DEBUG")){const v=n.readSync(i.dataId),S=r.shape[l];for(let C=0;C<v.length;++C){const k=v[C];O(k<=S-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${S-1}]`)}}const c=kR(r,i,l,a),d=be(i.shape),h=[],f=et({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=et({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,d/c.batchSize]}});h.push(f),h.push(p);const m=[c.batchSize,c.outerSize,d/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const v=n.bufferSync(p),S=n.bufferSync(f),C=rNe(S,v,m);return h.forEach(k=>n.disposeIntermediateTensorInfo(k)),n.makeTensorInfo(c.outputShape,C.dtype,C.values)}const g=new tIe(f.shape,m),x=n.runWebGLProgram(g,[f,p],f.dtype);h.push(x);const y=et({inputs:{x},backend:n,attrs:{shape:c.outputShape}});return h.forEach(v=>n.disposeIntermediateTensorInfo(v)),y}const sIe={kernelName:KE,backendName:"webgl",kernelFunc:z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rIe="return float(a > b);",iIe=`
  return vec4(greaterThan(a, b));
`,oIe=Er({opSnippet:rIe,packedOpSnippet:iIe,cpuKernelImpl:iNe,dtype:"bool"}),aIe={kernelName:XE,backendName:"webgl",kernelFunc:oIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lIe="return float(a >= b);",cIe=`
  return vec4(greaterThanEqual(a, b));
`,uIe=Er({opSnippet:lIe,packedOpSnippet:cIe,dtype:"bool",cpuKernelImpl:oNe}),dIe={kernelName:YE,backendName:"webgl",kernelFunc:uIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hIe(t){const{inputs:e,backend:n}=t,{input:s}=e;return V8(s,!0,n)}const fIe={kernelName:QE,backendName:"webgl",kernelFunc:hIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pIe="return float(!isnan(x) && !isinf(x));",mIe=_n({opSnippet:pIe,dtype:"bool"}),gIe={kernelName:JE,backendName:"webgl",kernelFunc:mIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xIe="return float(isinf(x));",yIe=_n({opSnippet:xIe,dtype:"bool"}),vIe={kernelName:e$,backendName:"webgl",kernelFunc:yIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bIe="return float(isnan(x));",wIe=_n({opSnippet:bIe,dtype:"bool"}),SIe={kernelName:t$,backendName:"webgl",kernelFunc:wIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CIe="return float(a < b);",kIe=`
  return vec4(lessThan(a, b));
`,NIe=Er({opSnippet:CIe,packedOpSnippet:kIe,cpuKernelImpl:aNe,dtype:"bool"}),TIe={kernelName:s$,backendName:"webgl",kernelFunc:NIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Ie="return float(a <= b);",EIe=`
  return vec4(lessThanEqual(a, b));
`,$Ie=Er({opSnippet:_Ie,packedOpSnippet:EIe,cpuKernelImpl:lNe,dtype:"bool"}),IIe={kernelName:r$,backendName:"webgl",kernelFunc:$Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RIe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=cNe(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const PIe={kernelName:i$,backendName:"webgl",kernelFunc:RIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AIe=Sm+`
  return x < 0.0 ? 0./0. : log(x);
`,jIe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,DIe=_n({opSnippet:AIe,packedOpSnippet:jIe,cpuKernelImpl:uNe}),OIe={kernelName:o$,backendName:"webgl",kernelFunc:DIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FIe=Sm+`
  return log(1.0 + x);
`,MIe=_n({opSnippet:FIe}),LIe={kernelName:a$,backendName:"webgl",kernelFunc:MIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BIe="return float(a >= 1.0 && b >= 1.0);",VIe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,zIe=Er({opSnippet:BIe,packedOpSnippet:VIe,dtype:"bool"}),WIe={kernelName:l$,backendName:"webgl",kernelFunc:zIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UIe="return float(!(x >= 1.0));",HIe=_n({opSnippet:UIe}),GIe={kernelName:c$,backendName:"webgl",kernelFunc:HIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KIe="return float(a >= 1.0 || b >= 1.0);",qIe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,XIe=Er({opSnippet:KIe,packedOpSnippet:qIe,dtype:"bool"}),YIe={kernelName:u$,backendName:"webgl",kernelFunc:XIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QIe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZIe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JIe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,c=ue().getBool("WEBGL_PACK_NORMALIZATION")?new ZIe(r.shape,i,o,a,l):new QIe(r.shape,i,o,a,l);return n.runWebGLProgram(c,[r],r.dtype)},eRe={kernelName:d$,backendName:"webgl",kernelFunc:JIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tRe{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nRe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:d}=s,h=new tRe(r.shape,a,l,c,d);return n.runWebGLProgram(h,[r,i,o],r.dtype)},sRe={kernelName:Vz,backendName:"webgl",kernelFunc:nRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rRe(t,e,n,s){const r=be(e),o=be(t.shape)/r,a=et({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Qh(a,t.dtype,"max",s),c=et({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=bs(i,r.shape);let c=l;const d=Mr(c,a),h=d!=null,f=n.shouldExecuteOnCPU([r]);let p=r;if(h){if(f){const S=n.texData.get(p.dataId).values,C=new Array(a);for(let _=0;_<C.length;_++)C[_]=r.shape[d[_]];const k=DR(S,r.shape,r.dtype,d,C);p=n.makeTensorInfo(C,r.dtype);const T=n.texData.get(p.dataId);T.values=k}else p=A1(r,d,n);c=Lr(c.length,a)}eo("max",c,a);const[m,g]=Oo(p.shape,c);let x=m;o&&(x=Ji(m,l));let y;if(f){const S=n.texData.get(p.dataId).values,C=dNe(S,be(g),x,r.dtype);y=n.makeTensorInfo(x,r.dtype);const k=n.texData.get(y.dataId);k.values=C}else y=rRe(p,g,x,n);return h&&n.disposeIntermediateTensorInfo(p),y}const iRe={kernelName:h$,backendName:"webgl",kernelFunc:W8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oRe=OR+`
  return max(a, b);
`,aRe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yh+`
  return result;
`,lRe=Er({opSnippet:oRe,packedOpSnippet:aRe,cpuKernelImpl:hNe}),cRe={kernelName:f$,backendName:"webgl",kernelFunc:lRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Dx(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;O(ri(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const d=ya(r.shape,i,o,c,a,l);if(d.filterWidth===1&&d.filterHeight===1&&Gn(d.inShape,d.outShape))return Yi({inputs:{x:r},backend:n});const h=new A0(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const dRe={kernelName:p$,backendName:"webgl",kernelFunc:uRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,d=[1,1,1],h=Oc(r.shape,i,o,d,a,c,l),f=new MR(h,"max",!1);return n.runWebGLProgram(f,[r],r.dtype)}const fRe={kernelName:m$,backendName:"webgl",kernelFunc:hRe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pRe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class mRe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,f=c-1-e.padInfo.top,p=d-1-e.padInfo.left,m=l*c*d-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${f}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gRe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:d}=s,h=[1,1,1],f=Oc(o.shape,a,l,h,c,d),p=new MR(f,"max",!0),m=n.runWebGLProgram(p,[o],o.dtype),g=new mRe(f),x=n.runWebGLProgram(g,[r,m],o.dtype);return n.disposeIntermediateTensorInfo(m),x}const xRe={kernelName:Wz,backendName:"webgl",kernelFunc:gRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yRe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Dx([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:d,dimRoundingMode:h}=s,f=ya(a.shape,l,c,1,d,h),p=!0,m=new A0(f,"max",p),g=n.runWebGLProgram(m,[a],a.dtype),x=new pRe(f),y=n.runWebGLProgram(x,[r,g],a.dtype);return n.disposeIntermediateTensorInfo(g),y}const vRe={kernelName:zz,backendName:"webgl",kernelFunc:yRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bRe(t,e,n,s){let r=new A0(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new A0(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wRe={kernelName:g$,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;O(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];O(ri(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const d=ya(s.shape,r,i,c,o),[h,f]=bRe(s,a,d,l);return[h,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SRe(t,e,n,s){const r=be(e),o=be(t.shape)/r,a=et({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=Qh(a,"float32","mean",s),c=et({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CRe={kernelName:x$,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=bs(i,s.shape);let c=l;const d=Mr(c,a),h=d!=null,f=o.shouldExecuteOnCPU([s]),p=[];let m=s;if(h){if(f){const C=o.texData.get(m.dataId).values,k=new Array(a);for(let $=0;$<k.length;$++)k[$]=s.shape[d[$]];const T=DR(C,s.shape,s.dtype,d,k);m=o.makeTensorInfo(k,s.dtype);const _=o.texData.get(m.dataId);_.values=T}else m=A1(s,d,o);p.push(m),c=Lr(c.length,a)}eo("sum",c,a);const[g,x]=Oo(m.shape,c);let y=g;r&&(y=Ji(g,l));const v=SRe(m,x,y,o);for(const S of p)o.disposeIntermediateTensorInfo(S);return v}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kRe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=bs(i,r.shape);let c=l;const d=Mr(c,a);let h=r;d!=null&&(h=ni({inputs:{x:r},backend:n,attrs:{perm:d}}),c=Lr(c.length,r.shape.length)),eo("min",c,a);const[f,p]=Oo(h.shape,c),m=be(p),g=et({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}}),x=Qh(g,g.dtype,"min",n);let y;if(o){const v=Ji(f,l);y=et({inputs:{x},backend:n,attrs:{shape:v}})}else y=et({inputs:{x},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),d!=null&&n.disposeIntermediateTensorInfo(h),y}const NRe={kernelName:y$,backendName:"webgl",kernelFunc:kRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TRe=OR+`
  return min(a, b);
`,_Re=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Yh+`
  return result;
`,ERe=Er({opSnippet:TRe,packedOpSnippet:_Re,cpuKernelImpl:fNe}),$Re={kernelName:v$,backendName:"webgl",kernelFunc:ERe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IRe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((d,h)=>d[0]+e[h]+d[1]);const r=e.length,i=es(r),o=n.map(d=>d[0]).join(","),a=n.map((d,h)=>d[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RRe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,i=es(r),o=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=Yr("rc",r),c=Yr("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,f=s==="reflect"?0:1;let p="";if(r===1){const m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
      `}else{const m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;p=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${h});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${h});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${h});
          ${l[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PRe=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RRe(s.shape,r,i):new IRe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},ARe={kernelName:b$,backendName:"webgl",kernelFunc:PRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jRe=`if (b == 0.0) return NAN;
  return mod(a, b);`,DRe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Yh+`
  return result;
`,ORe=Er({opSnippet:jRe,packedOpSnippet:DRe}),FRe={kernelName:w$,backendName:"webgl",kernelFunc:ORe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MRe{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LRe=`
if (a == b) {
  return 1.0;
};
return a / b;`,BRe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,U8=Er({opSnippet:LRe,packedOpSnippet:BRe,checkOutOfBounds:!0}),VRe={kernelName:AE,backendName:"webgl",kernelFunc:U8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dO="return a - b;",H8=Er({opSnippet:dO,packedOpSnippet:dO,supportsComplex:!0,cpuKernelImpl:jNe}),zRe={kernelName:pI,backendName:"webgl",kernelFunc:H8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G8(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=bs([i],r.shape),a=W8({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=Ji(a.shape,o),c=et({inputs:{x:a},backend:n,attrs:{shape:l}}),d=H8({inputs:{a:r,b:c},backend:n}),h=B8({inputs:{x:d},backend:n}),f=j1({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),p=et({inputs:{x:f},backend:n,attrs:{shape:l}}),m=U8({inputs:{a:h,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}const WRe={kernelName:aI,backendName:"webgl",kernelFunc:G8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function URe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:G8({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],d=l.shape[1],h=new MRe(c,d,i),f=[[o]],p=n.runWebGLProgram(h,[l],"int32",f);return a||n.disposeIntermediateTensorInfo(l),p}const HRe={kernelName:S$,backendName:"webgl",kernelFunc:URe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GRe=ba+`
  return -x;
`,KRe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function qRe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=mNe(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return ue().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new wu(s.shape,KRe):r=new vl(s.shape,GRe),n.runWebGLProgram(r,[s],s.dtype)}const XRe={kernelName:k$,backendName:"webgl",kernelFunc:qRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YRe=HI;function QRe(t){Da("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(r.dataId),d=n.readSync(i.dataId),{selectedIndices:h}=YRe(c,d,o,a,l);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const ZRe={kernelName:T$,backendName:"webgl",kernelFunc:QRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JRe=_6;function ePe(t){Da("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,d=n.readSync(r.dataId),h=n.readSync(i.dataId),{selectedIndices:f,validOutputs:p}=JRe(d,h,o,a,l,c);return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const tPe={kernelName:Uz,backendName:"webgl",kernelFunc:ePe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nPe=GI;function sPe(t){Da("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,d=n.readSync(r.dataId),h=n.readSync(i.dataId),f=o,p=a,m=l,g=c,{selectedIndices:x,selectedScores:y}=nPe(d,h,f,p,m,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const rPe={kernelName:_$,backendName:"webgl",kernelFunc:sPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iPe{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oPe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,c=be(r.shape),d=new iPe(c,o,a,l),h=et({inputs:{x:r},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(d,[h],i);n.disposeIntermediateTensorInfo(h);const p=[...r.shape,o],m=et({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(f),m},aPe={kernelName:$$,backendName:"webgl",kernelFunc:oPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xb(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Fx({inputs:{input:s},backend:n}),i=Xb({inputs:{x:r},backend:n}),o=D1({inputs:{input:s},backend:n}),a=Xb({inputs:{x:o},backend:n}),l=cd({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Mx({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const lPe={kernelName:wI,backendName:"webgl",kernelFunc:Xb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K8(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Fx({inputs:{input:s},backend:n}),i=K8({inputs:{x:r},backend:n}),o=D1({inputs:{input:s},backend:n}),a=Xb({inputs:{x:o},backend:n}),l=cd({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Mx({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const cPe={kernelName:E$,backendName:"webgl",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uPe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return wN({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(d=>{Qi(i,d.shape,"All tensors passed to stack must have matching shapes"),O(o===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const h=wN({inputs:{input:d},backend:n,attrs:{dim:r}});return a.push(h),h}),c=P8({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(d=>n.disposeIntermediateTensorInfo(d)),c}const dPe={kernelName:I$,backendName:"webgl",kernelFunc:uPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hPe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,d)=>c[0]+e[d]+c[1]);const r=e.length,i=es(r),o=n.map(c=>c[0]).join(","),a=n.map((c,d)=>c[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fPe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,i=es(r),o=n.map(g=>g[0]).join(","),a=n.map((g,x)=>g[0]+e[x]).join(","),l=Yr("rc",r),c=Yr("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let g=0,x=r===1?2:4;g<x;g++)m+=`
        ${f[g]}
        if (${p}) {
          result[${g}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${g}] = getChannel(getX(${c.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q8=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(be(r.shape)===0){const c=i.map((d,h)=>d[0]+r.shape[h]+d[1]);return Mx({backend:n,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fPe(r.shape,i,o):new hPe(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},pPe={kernelName:R$,backendName:"webgl",kernelFunc:q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mPe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,gPe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Yh+`
  return result;
`,xPe=Er({opSnippet:mPe,packedOpSnippet:gPe}),yPe={kernelName:P$,backendName:"webgl",kernelFunc:xPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vPe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],c=bs(i,r.shape);let d=c;const h=Mr(d,a);let f=r;h!=null&&(f=ni({inputs:{x:r},backend:n,attrs:{perm:h}}),d=Lr(d.length,a),l.push(f)),eo("prod",d,a);let p;if(n.shouldExecuteOnCPU([f])){const m=n.texData.get(f.dataId).values,{outVals:g,outShape:x,outDtype:y}=xNe(f.shape,f.dtype,m,d);p=n.makeTensorInfo(x,y,g)}else{const[m,g]=Oo(f.shape,d),x=be(g),y=et({inputs:{x:f},backend:n,attrs:{shape:[-1,x]}}),v=m1(r.dtype),S=Qh(y,v,"prod",n);p=et({inputs:{x:S},backend:n,attrs:{shape:m}}),l.push(y),l.push(S)}if(o){l.push(p);const m=Ji(p.shape,c);p=et({inputs:{x:p},backend:n,attrs:{shape:m}})}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const bPe={kernelName:j$,backendName:"webgl",kernelFunc:vPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wPe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),c=r.map(y=>y.shape),d=n.readSync(i.dataId),h=n.readSync(o.dataId),[f,p,m]=yNe(l,c,d,i.shape,i.dtype,h,o.shape,a),g=f.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(m,i.dtype,p);return g.concat([x])}const SPe={kernelName:Hz,backendName:"webgl",kernelFunc:wPe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CPe(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,d]=vNe(o,s.shape,s.dtype,a,r.shape,l,i.shape),h=n.makeTensorInfo([c.length],"int32",c),f=n.makeTensorInfo([d.length],s.dtype,d);return[h,f]}const kPe={kernelName:Gz,backendName:"webgl",kernelFunc:CPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NPe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(r.dataId),d=n.readSync(i.dataId),h=n.readSync(o.dataId),f=a.map(x=>n.readSync(x.dataId)),p=a.map(x=>x.shape),[m,g]=bNe(c,r.shape,d,i.shape,i.dtype,h,o.shape,f,p,l);return n.makeTensorInfo(m,i.dtype,g)}const TPe={kernelName:Kz,backendName:"webgl",kernelFunc:NPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=wNe(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},_Pe={kernelName:D$,backendName:"webgl",kernelFunc:X8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EPe="return 1.0 / x;",$Pe=_n({opSnippet:EPe}),IPe={kernelName:F$,backendName:"webgl",kernelFunc:$Pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RPe=ba+`
  return (x < 0.0) ? 0.0 : x;
`,PPe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,APe=_n({opSnippet:RPe,packedOpSnippet:PPe}),jPe={kernelName:M$,backendName:"webgl",kernelFunc:APe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DPe=ba+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,OPe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FPe=_n({opSnippet:DPe,packedOpSnippet:OPe}),MPe={kernelName:z$,backendName:"webgl",kernelFunc:FPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LPe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const d=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let f;i?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BPe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const d=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s];let f;i?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VPe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,d=ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new BPe(r.shape,l,c,i,o):new LPe(r.shape,l,c,i,o);return n.runWebGLProgram(d,[r],"float32")}const zPe={kernelName:V$,backendName:"webgl",kernelFunc:VPe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WPe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UPe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new WPe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const HPe={kernelName:Xz,backendName:"webgl",kernelFunc:UPe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GPe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const d=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/h[0]},
          ${d[1]/h[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KPe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const d=[r&&n>1?a-1:a,r&&s>1?l-1:l],h=[r&&n>1?n-1:n,r&&s>1?s-1:s],f=r?"0.5":"0.0";let p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/h[0]},
          ${d[1]/h[1]},
          ${d[1]/h[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qPe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,d=ue().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new KPe(r.shape,l,c,i,o):new GPe(r.shape,l,c,i,o);return n.runWebGLProgram(d,[r],r.dtype)}const XPe={kernelName:B$,backendName:"webgl",kernelFunc:qPe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YPe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],d=l[0]/c[0],h=l[1]/c[1],f=1/d,p=1/h,m=Math.ceil(f)*2+2,g=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${h});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QPe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new YPe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const ZPe={kernelName:qz,backendName:"webgl",kernelFunc:QPe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JPe{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=es(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e3e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Yr("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=es(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${c(r.slice())};
          }
          if(${o}) {
            result.b = ${d(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return f(m)}function c(m){return m[s-1]="("+m[s-1]+" + 1)",f(m)}function d(m){return m[s-2]="("+m[s-2]+" + 1)",f(m)}function h(m){return m[s-1]="("+m[s-1]+" + 1)",m[s-2]="("+m[s-2]+" + 1)",f(m)}function f(m){const g=e.map((v,S)=>p(S,m)),x=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${y}))`}function p(m,g){return n.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${g[m]} - 1`:`${g[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t3e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=bs(i,r.shape);if(o===0)return Yi({inputs:{x:r},backend:n});const l=ue().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new e3e(r.shape,a):new JPe(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const n3e={kernelName:W$,backendName:"webgl",kernelFunc:t3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s3e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3e={kernelName:CI,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new s3e(s.shape,i),[c,d]=oR(o,s.shape[1],s.shape[2]),h=[[c,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i3e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,o3e=_n({opSnippet:i3e}),a3e={kernelName:U$,backendName:"webgl",kernelFunc:o3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3e="return inversesqrt(x);",c3e=_n({opSnippet:l3e,cpuKernelImpl:SNe}),u3e={kernelName:H$,backendName:"webgl",kernelFunc:c3e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LR{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=es(i.length),d=es(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d3e{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=es(i.length),d=es(o.length);let h="";s===1?h="i":s===2&&(h="i, j");const f=`getIndices(${h})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const m=`getUpdates(${p})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides",v=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${v};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h3e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=zh(i,r,o),f=[h/c,c];if(h===0)return n.makeTensorInfo(o,r.dtype);const p=et({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),m=et({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let x;ue().getBool("WEBGL_PACK")?x=new d3e(l,a,p.shape.length,m.shape.length,d,f):x=new LR(l,a,p.shape.length,m.shape.length,d,f);const y=n.runWebGLProgram(x,[m,p,g],m.dtype),v=et({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),v}const f3e={kernelName:G$,backendName:"webgl",kernelFunc:h3e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p3e{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=ue().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new p3e(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const g3e={kernelName:q$,backendName:"webgl",kernelFunc:m3e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x3e{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let d=0;d<n.length;d++)c.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),i=c.join()}const o=es(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y3e(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new x3e(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],wi(r.dtype,i.dtype))}const v3e={kernelName:X$,backendName:"webgl",kernelFunc:y3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b3e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${cR};
  float scale = ${uR};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,w3e=_n({opSnippet:b3e}),S3e={kernelName:Y$,backendName:"webgl",kernelFunc:w3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C3e=Sm+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,k3e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,N3e=_n({opSnippet:C3e,packedOpSnippet:k3e,cpuKernelImpl:kNe}),T3e={kernelName:tI,backendName:"webgl",kernelFunc:N3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _3e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,E3e=_n({opSnippet:_3e}),$3e={kernelName:eI,backendName:"webgl",kernelFunc:E3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I3e=Sm+`
  return sin(x);
`,R3e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Yh}
  return result;
`,P3e=_n({opSnippet:I3e,packedOpSnippet:R3e}),A3e={kernelName:Z$,backendName:"webgl",kernelFunc:P3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j3e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,D3e=_n({opSnippet:j3e}),O3e={kernelName:J$,backendName:"webgl",kernelFunc:D3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F3e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,M3e=_n({opSnippet:F3e}),L3e={kernelName:nI,backendName:"webgl",kernelFunc:M3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B3e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;O(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,v)=>y*v),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const c=[],d=q8({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),h=Ix(d.shape,i,a,!1),f=Rx(h.length,i.length,!1),p=Px(d.shape,i,a,!1),m=et({inputs:{x:d},backend:n,attrs:{shape:h}}),g=ni({inputs:{x:m},backend:n,attrs:{perm:f}}),x=et({inputs:{x:g},backend:n,attrs:{shape:p}});return c.push(d),c.push(m),c.push(g),c.forEach(y=>n.disposeIntermediateTensorInfo(y)),x},V3e={kernelName:iI,backendName:"webgl",kernelFunc:B3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3e(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),c=n.readSync(i.dataId),d=n.readSync(o.dataId)[0],[h,f,p,m,g]=TNe(a,s.shape,s.dtype,l,r.dtype,c,d);return[n.makeTensorInfo(f,s.dtype,h),n.makeTensorInfo([f[0]],r.dtype,p),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const W3e={kernelName:Yz,backendName:"webgl",kernelFunc:z3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U3e(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[c,d,h]=_Ne(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(d,s.dtype,c),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const H3e={kernelName:Qz,backendName:"webgl",kernelFunc:U3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,d]=v8(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(d,s.dtype,c)}const K3e={kernelName:lI,backendName:"webgl",kernelFunc:G3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q3e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,d]=v8(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(d,s.dtype,c)}const X3e={kernelName:cI,backendName:"webgl",kernelFunc:q3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y3e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:d,strides:h,outputSize:f}=zh(i,r,a),p=!1;if(i.dtype==="string"){const y=n.bufferSync(r),v=n.bufferSync(i),S=Tc(n.readSync(o.dataId)[0]),C=CNe(y,v,a,f,d,c,l,h,S,p);return n.makeTensorInfo(a,C.dtype,C.values)}const m=new LR(c,l,r.shape.length,i.shape.length,h,[f,1],p),g=n.runWebGLProgram(m,[i,r,o],i.dtype),x=et({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),x}const Q3e={kernelName:uI,backendName:"webgl",kernelFunc:Y3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=bs(o,r.shape)[0],l=SR(r,i,a),c=r.shape.length,d=new Array(c).fill(0),h=r.shape.slice();return l.map(f=>{const p=[...h];p[a]=f;const m=Cm({inputs:{x:r},backend:n,attrs:{begin:d,size:p}});return d[a]+=f,m})}const J3e={kernelName:oI,backendName:"webgl",kernelFunc:Z3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hO="return sqrt(x);",eAe=_n({opSnippet:hO,packedOpSnippet:hO,cpuKernelImpl:ENe}),tAe={kernelName:sI,backendName:"webgl",kernelFunc:eAe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nAe="return x * x;",sAe=_n({opSnippet:nAe}),rAe={kernelName:Zz,backendName:"webgl",kernelFunc:sAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fO="return (a - b) * (a - b);",iAe=Er({opSnippet:fO,packedOpSnippet:fO}),oAe={kernelName:dI,backendName:"webgl",kernelFunc:iAe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=Ku(i),a=$Ne(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const lAe={kernelName:Jz,backendName:"webgl",kernelFunc:aAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cAe({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=ba+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new vl(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const uAe={kernelName:SI,backendName:"webgl",kernelFunc:cAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dAe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=es(s.length),o=es(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((c,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:d,newAxisMask:h,shrinkAxisMask:f}=s,{finalShapeSparse:p,finalShape:m,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:v,end:S,strides:C}=sR(r.shape,i,o,a,l,c,d,h,f);let k;if(g)k=et({inputs:{x:r},backend:n,attrs:{shape:m}});else if(x||y){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const _=JI(v,S,C),$=Cm({inputs:{x:r},backend:n,attrs:{begin:v,size:_}});k=et({inputs:{x:$},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo($)}else if(n.shouldExecuteOnCPU([r])){const $=n.readSync(r.dataId),R=Kn(r.shape,r.dtype,$),A=INe(p,R,C,v);k=n.makeTensorInfo(m,r.dtype,A.values)}else{const $=new dAe(v,C,p);k=n.runWebGLProgram($,[r],r.dtype)}const T=et({inputs:{x:k},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(k),T}const fAe={kernelName:hI,backendName:"webgl",kernelFunc:hAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pAe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:d,dataSplits:h}=e,f=n.readSync(d.dataId),p=n.readSync(h.dataId),[m,g]=RNe(f,p,r,i,o,a,l,c);return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(h.shape,"int32",g)]}const mAe={kernelName:fI,backendName:"webgl",kernelFunc:pAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gAe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[c,d,h]=PNe(a,l,r),f=d.length;return[n.makeTensorInfo([f,2],"int32",c),n.makeTensorInfo([f],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(h))]}const xAe={kernelName:eW,backendName:"webgl",kernelFunc:gAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yAe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=ANe(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const vAe={kernelName:tW,backendName:"webgl",kernelFunc:yAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bAe="return tan(x);",wAe=_n({opSnippet:bAe}),SAe={kernelName:mI,backendName:"webgl",kernelFunc:wAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CAe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,kAe=_n({opSnippet:CAe}),NAe={kernelName:gI,backendName:"webgl",kernelFunc:kAe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TAe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:d,outputSize:h}=zh(o,i,r.shape),f=[h/c,c];if(h===0)return n.makeTensorInfo(r.shape,i.dtype);const p=et({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),m=et({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),g=et({inputs:{x:r},backend:n,attrs:{shape:f}}),x=new LR(l,a,p.shape.length,m.shape.length,d,f,!1,!0),y=n.runWebGLProgram(x,[m,p,g],g.dtype),v=et({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),v}const _Ae={kernelName:K$,backendName:"webgl",kernelFunc:TAe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EAe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=es(this.rank),i=$Ae(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function $Ae(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(f=>Tc(f)):l,d=Kn(r.shape,r.dtype,c),h=DNe(d,i);return n.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new EAe(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const IAe={kernelName:h1,backendName:"webgl",kernelFunc:Y8};class RAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class PAe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function md(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function pO(t){let e=1;for(;e<t;)e*=2;return e}function AAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=ue().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ue().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,d=c[c.length-1];if(n.shouldExecuteOnCPU([r])||d<a||i>l){const A=n.readSync(r.dataId),[j,F]=ONe(A,c,r.dtype,i,o);return[n.makeTensorInfo(j.shape,j.dtype,j.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(i===0)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(d===1)return[r,Mx({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const h=n.texData.get(r.dataId),f=h!==null&&h.isPacked,p=f?n.unpackTensor(r):r,g=be(c)/d,x=et({inputs:{x:p},attrs:{shape:[g,d]},backend:n});f&&md(n,p);const y=pO(i),v=pO(d);let S=null;const C=()=>S===null?[x,x]:[x,S],k=(A,j,F)=>{const L=C(),M=new RAe(F),z=[[d],[S===null?1:0],[Number.NEGATIVE_INFINITY],[A],[j]],re=S;S=n.runWebGLProgram(M,L,"int32",z),md(n,re)};for(let A=1;A<y;A*=2){const j=A*2;for(let F=A;F>=1;F/=2)k(j,F,[g,v])}for(let A=v;A>y;A/=2){const j=C(),F=new PAe([g,A/2]),M=[[d],[S===null?1:0],[y]],q=S;S=n.runWebGLProgram(F,j,"int32",M),md(n,q);const z=y/2,re=z*2;for(let U=z;U>=1;U/=2)k(re,U,S.shape)}let T=S;S=Cm({inputs:{x:S},backend:n,attrs:{begin:0,size:[g,i]}}),md(n,T);let _=z8({inputs:{x,indices:S},backend:n,attrs:{axis:1,batchDims:1}});md(n,x);const $=c.slice(0,-1);$.push(i),T=S,S=et({inputs:{x:S},attrs:{shape:$},backend:n}),md(n,T);const R=_;return _=et({inputs:{x:_},attrs:{shape:$},backend:n}),md(n,R),[_,S]}const jAe={kernelName:xI,backendName:"webgl",kernelFunc:AAe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DAe{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OAe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[d,h,f,p]=r.shape,[m,g]=c??[h,f],x=[d,m,g,p],y=new DAe(h,f,o,a,l,x);return n.runWebGLProgram(y,[r,i],"float32")}const FAe={kernelName:yI,backendName:"webgl",kernelFunc:OAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MAe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Dx(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=FNe(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const LAe={kernelName:nW,backendName:"webgl",kernelFunc:MAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BAe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],c=new Array(a-1);let d=0;for(let g=0;g<a;g++)g!==i&&(c[d++]=o.shape[g]);const h=[],f=new Array(a).fill(0),p=o.shape.slice();p[i]=1;const m=new Array(l);for(let g=0;g<m.length;g++){f[i]=g;const x=Cm({inputs:{x:o},backend:n,attrs:{begin:f,size:p}}),y=et({inputs:{x},backend:n,attrs:{shape:c}});m[g]=y,h.push(x)}return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const VAe={kernelName:vI,backendName:"webgl",kernelFunc:BAe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zAe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",c="sumValue",d=Math.floor(s/4)*4,h=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WAe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let c=0;const d=Mr([c],a);let h=r;d!=null&&(h=ni({inputs:{x:r},backend:n,attrs:{perm:d}}),l.push(h),c=Lr(1,a)[0]);const f=CR(h.shape,c,o),p=be([h.shape[c]]),m=et({inputs:{x:h},backend:n,attrs:{shape:[-1,p]}});l.push(m);const g=m1(r.dtype),x=(C,k,T,_,$)=>{const R=C.shape[0],A=C.shape[1],j=iU(A,$),F={windowSize:j,inSize:A,batchSize:R,numSegments:$},L=new zAe(F,k),M=n.compileAndRun(L,[C,T],_);if(l.push(M),M.shape[1]===$)return M;const q=X8({backend:n,attrs:{start:0,stop:$,step:1,dtype:"float32"}}),z=Y8({inputs:{x:q},backend:n,attrs:{reps:[A/j]}});return l.push(q),l.push(z),x(M,k,z,_,$)},y=x(m,"unsortedSegmentSum",i,g,o),v=et({inputs:{x:y},backend:n,attrs:{shape:f}});let S=v;if(d!=null){l.push(v);const C=$x(d);S=ni({inputs:{x:S},backend:n,attrs:{perm:C}})}return l.forEach(C=>n.disposeIntermediateTensorInfo(C)),S}const UAe={kernelName:bI,backendName:"webgl",kernelFunc:WAe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HAe=[ETe,ITe,ATe,OTe,MTe,VTe,WTe,HTe,XTe,QTe,e_e,s_e,o_e,u_e,f_e,m_e,x_e,w_e,C_e,N_e,$_e,O_e,M_e,z_e,U_e,Y_e,Z_e,nEe,dTe,iEe,uEe,pEe,bEe,CEe,NEe,_Ee,$Ee,AEe,OEe,LEe,VEe,WEe,HEe,qEe,YEe,e$e,n$e,i$e,l$e,u$e,p$e,y$e,S$e,N$e,E$e,$$e,R$e,A$e,D$e,F$e,L$e,W$e,G$e,X$e,Q$e,eIe,sIe,aIe,dIe,uTe,fIe,lEe,gIe,vIe,SIe,fTe,TIe,IIe,PIe,OIe,LIe,WIe,GIe,YIe,eRe,sRe,iRe,cRe,dRe,fRe,xRe,vRe,wRe,CRe,NRe,$Re,ARe,FRe,HRe,gTe,XRe,ZRe,tPe,rPe,G_e,aPe,cPe,dPe,pPe,yPe,mTe,bPe,SPe,kPe,TPe,_Pe,K_e,VRe,IPe,jPe,MPe,yTe,zPe,HPe,XPe,ZPe,n3e,r3e,a3e,u3e,f3e,g3e,v3e,S3e,T3e,$3e,A3e,O3e,j_e,WRe,L3e,V3e,W3e,H3e,K3e,X3e,Q3e,J3e,tAe,rAe,oAe,lAe,uAe,fAe,mAe,xAe,vAe,zRe,NTe,SAe,NAe,_Ae,IAe,jAe,FAe,TTe,LAe,VAe,UAe,lPe];for(const t of HAe)sW(t);let Od=null,pf={modelType:Bf.modelType.SINGLEPOSE_LIGHTNING,enableSmoothing:!0};async function go(t="lightning"){try{switch(console.log("Initializing pose detection with model:",t),Od&&(Od.dispose(),Od=null),await yse(),bh()!=="webgl"&&(console.log("Setting backend to WebGL"),await xse("webgl")),console.log("Current backend:",bh()),t){case"lightning":pf.modelType=Bf.modelType.SINGLEPOSE_LIGHTNING;break;case"thunder":pf.modelType=Bf.modelType.SINGLEPOSE_THUNDER;break;case"heavy":pf.modelType=Bf.modelType.MULTIPOSE_LIGHTNING;break;default:pf.modelType=Bf.modelType.SINGLEPOSE_LIGHTNING}return console.log("Creating detector with model config:",pf),Od=await i8(Wa.MoveNet,pf),console.log("Detector created successfully"),Od}catch(e){throw console.error("Error initializing pose detection:",e),e}}async function pr(t,e=1,n=.5){if(!Od)throw console.error("Detector not initialized. Call initPoseDetection first."),new Error("Detector not initialized. Call initPoseDetection first.");let s=!1,r=0,i=0;if(t instanceof HTMLVideoElement){if(s=t.readyState>=2,r=t.videoWidth,i=t.videoHeight,!s)return console.log("Video not ready yet, waiting for metadata"),[];if(r===0||i===0)return console.log("Video dimensions are zero, cannot detect poses"),[]}else if(t instanceof HTMLImageElement){if(s=t.complete&&t.naturalWidth>0,r=t.naturalWidth,i=t.naturalHeight,!s)return console.log("Image not fully loaded yet, waiting to complete"),[];if(r===0||i===0)return console.log("Image dimensions are zero, cannot detect poses"),[]}try{console.log(`Source dimensions: ${r}x${i}`),console.log(`Running pose detection with maxPoses: ${e}, confidence: ${n}`);const o={maxPoses:e,flipHorizontal:!1,scoreThreshold:Math.max(.3,n*.6)},a=await Od.estimatePoses(t,o);return!a||a.length===0?[]:a.map(c=>{const d=c.keypoints.filter(h=>typeof h.score=="number"&&h.score>n);return{...c,keypoints:d}})}catch(o){throw console.error("Error estimating poses:",o),o}}function Ac(){return[["left_shoulder","right_shoulder"],["left_shoulder","left_hip"],["right_shoulder","right_hip"],["left_hip","right_hip"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_hip","right_knee"],["right_knee","right_ankle"],["nose","left_eye"],["nose","right_eye"],["left_eye","left_ear"],["right_eye","right_ear"]]}const GAe=(t,e)=>Math.abs(t-e),KAe=(t,e)=>{if(t.length===0||e.length===0)return{distance:1/0,path:[],normalizedDistance:1/0};const n=[],s=[];for(let o=0;o<=t.length;o++){n[o]=[],s[o]=[];for(let a=0;a<=e.length;a++)n[o][a]=1/0,s[o][a]=[]}n[0][0]=0,s[0][0]=[];for(let o=1;o<=t.length;o++)for(let a=1;a<=e.length;a++){const l=GAe(t[o-1],e[a-1]),c=[{cost:n[o-1][a],idx:[o-1,a]},{cost:n[o][a-1],idx:[o,a-1]},{cost:n[o-1][a-1],idx:[o-1,a-1]}],d=c.reduce((f,p)=>p.cost<f.cost?p:f,c[0]);n[o][a]=l+d.cost;const h=[...s[d.idx[0]][d.idx[1]]];h.push([o-1,a-1]),s[o][a]=h}const r=s[t.length][e.length],i=n[t.length][e.length]/Math.max(t.length,e.length);return{distance:n[t.length][e.length],path:r,normalizedDistance:i}},mO=t=>{if(t.length===0)return[];const e=t.filter(r=>!isNaN(r)&&isFinite(r));if(e.length===0)return t.map(()=>.5);const n=Math.min(...e),s=Math.max(...e);if(s===n){const r=s===0?.5:s<0?.25:.75;return t.map(()=>r)}return t.map(r=>isNaN(r)||!isFinite(r)?.5:(r-n)/(s-n))},qAe=(t,e,n="unknown")=>{if(t.length<3||e.length<3)return console.log(`${n}: Insufficient data points`),{score:0,distance:1/0,path:[],alignment:[],errorWindows:[]};const s=t.filter(v=>!isNaN(v)&&isFinite(v)),r=e.filter(v=>!isNaN(v)&&isFinite(v));if(s.length<3||r.length<3)return console.log(`${n}: Invalid angle values filtered out`),{score:0,distance:1/0,path:[],alignment:[],errorWindows:[]};const i=mO(s),o=mO(r),a=KAe(i,o),{distance:l,path:c,normalizedDistance:d}=a,h=c.map(([v,S])=>({user:s[v],reference:r[S],distance:Math.abs(s[v]-r[S])})),f=15,p=3,m=[];let g=[],x=-1;if(h.forEach((v,S)=>{if(v.distance>f)x===-1&&(x=S),g.push(v.distance);else if(x!==-1){if(g.length>=p){const C=g.reduce((k,T)=>k+T,0)/g.length;m.push({start:x,end:S-1,avgError:C})}g=[],x=-1}}),x!==-1&&g.length>=p){const v=g.reduce((S,C)=>S+C,0)/g.length;m.push({start:x,end:h.length-1,avgError:v})}const y=Math.round(100/(1+Math.exp((d-.25)*12)));return console.log(`DTW Comparison for ${n}:`,{sequenceLengths:{user:t.length,reference:e.length,validUser:s.length,validRef:r.length},distance:d,score:y,errorWindows:m.length}),{score:y,distance:d,path:c,alignment:h,errorWindows:m}};function XAe({onRecordingComplete:t}){return u.jsx(u.Fragment,{})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Lx(t){return t+.5|0}const Su=(t,e,n)=>Math.max(Math.min(t,n),e);function hg(t){return Su(Lx(t*2.55),0,255)}function Ou(t){return Su(Lx(t*255),0,255)}function ic(t){return Su(Lx(t/2.55)/100,0,1)}function gO(t){return Su(Lx(t*100),0,100)}const Uo={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},SN=[..."0123456789ABCDEF"],YAe=t=>SN[t&15],QAe=t=>SN[(t&240)>>4]+SN[t&15],Oy=t=>(t&240)>>4===(t&15),ZAe=t=>Oy(t.r)&&Oy(t.g)&&Oy(t.b)&&Oy(t.a);function JAe(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&Uo[t[1]]*17,g:255&Uo[t[2]]*17,b:255&Uo[t[3]]*17,a:e===5?Uo[t[4]]*17:255}:(e===7||e===9)&&(n={r:Uo[t[1]]<<4|Uo[t[2]],g:Uo[t[3]]<<4|Uo[t[4]],b:Uo[t[5]]<<4|Uo[t[6]],a:e===9?Uo[t[7]]<<4|Uo[t[8]]:255})),n}const eje=(t,e)=>t<255?e(t):"";function tje(t){var e=ZAe(t)?YAe:QAe;return t?"#"+e(t.r)+e(t.g)+e(t.b)+eje(t.a,e):void 0}const nje=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Q8(t,e,n){const s=e*Math.min(n,1-n),r=(i,o=(i+t/30)%12)=>n-s*Math.max(Math.min(o-3,9-o,1),-1);return[r(0),r(8),r(4)]}function sje(t,e,n){const s=(r,i=(r+t/60)%6)=>n-n*e*Math.max(Math.min(i,4-i,1),0);return[s(5),s(3),s(1)]}function rje(t,e,n){const s=Q8(t,1,.5);let r;for(e+n>1&&(r=1/(e+n),e*=r,n*=r),r=0;r<3;r++)s[r]*=1-e-n,s[r]+=e;return s}function ije(t,e,n,s,r){return t===r?(e-n)/s+(e<n?6:0):e===r?(n-t)/s+2:(t-e)/s+4}function BR(t){const n=t.r/255,s=t.g/255,r=t.b/255,i=Math.max(n,s,r),o=Math.min(n,s,r),a=(i+o)/2;let l,c,d;return i!==o&&(d=i-o,c=a>.5?d/(2-i-o):d/(i+o),l=ije(n,s,r,d,i),l=l*60+.5),[l|0,c||0,a]}function VR(t,e,n,s){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,s)).map(Ou)}function zR(t,e,n){return VR(Q8,t,e,n)}function oje(t,e,n){return VR(rje,t,e,n)}function aje(t,e,n){return VR(sje,t,e,n)}function Z8(t){return(t%360+360)%360}function lje(t){const e=nje.exec(t);let n=255,s;if(!e)return;e[5]!==s&&(n=e[6]?hg(+e[5]):Ou(+e[5]));const r=Z8(+e[2]),i=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?s=oje(r,i,o):e[1]==="hsv"?s=aje(r,i,o):s=zR(r,i,o),{r:s[0],g:s[1],b:s[2],a:n}}function cje(t,e){var n=BR(t);n[0]=Z8(n[0]+e),n=zR(n),t.r=n[0],t.g=n[1],t.b=n[2]}function uje(t){if(!t)return;const e=BR(t),n=e[0],s=gO(e[1]),r=gO(e[2]);return t.a<255?`hsla(${n}, ${s}%, ${r}%, ${ic(t.a)})`:`hsl(${n}, ${s}%, ${r}%)`}const xO={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},yO={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function dje(){const t={},e=Object.keys(yO),n=Object.keys(xO);let s,r,i,o,a;for(s=0;s<e.length;s++){for(o=a=e[s],r=0;r<n.length;r++)i=n[r],a=a.replace(i,xO[i]);i=parseInt(yO[o],16),t[a]=[i>>16&255,i>>8&255,i&255]}return t}let Fy;function hje(t){Fy||(Fy=dje(),Fy.transparent=[0,0,0,0]);const e=Fy[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const fje=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function pje(t){const e=fje.exec(t);let n=255,s,r,i;if(e){if(e[7]!==s){const o=+e[7];n=e[8]?hg(o):Su(o*255,0,255)}return s=+e[1],r=+e[3],i=+e[5],s=255&(e[2]?hg(s):Su(s,0,255)),r=255&(e[4]?hg(r):Su(r,0,255)),i=255&(e[6]?hg(i):Su(i,0,255)),{r:s,g:r,b:i,a:n}}}function mje(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${ic(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const xS=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,mf=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function gje(t,e,n){const s=mf(ic(t.r)),r=mf(ic(t.g)),i=mf(ic(t.b));return{r:Ou(xS(s+n*(mf(ic(e.r))-s))),g:Ou(xS(r+n*(mf(ic(e.g))-r))),b:Ou(xS(i+n*(mf(ic(e.b))-i))),a:t.a+n*(e.a-t.a)}}function My(t,e,n){if(t){let s=BR(t);s[e]=Math.max(0,Math.min(s[e]+s[e]*n,e===0?360:1)),s=zR(s),t.r=s[0],t.g=s[1],t.b=s[2]}}function J8(t,e){return t&&Object.assign(e||{},t)}function vO(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Ou(t[3]))):(e=J8(t,{r:0,g:0,b:0,a:1}),e.a=Ou(e.a)),e}function xje(t){return t.charAt(0)==="r"?pje(t):lje(t)}class D0{constructor(e){if(e instanceof D0)return e;const n=typeof e;let s;n==="object"?s=vO(e):n==="string"&&(s=JAe(e)||hje(e)||xje(e)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var e=J8(this._rgb);return e&&(e.a=ic(e.a)),e}set rgb(e){this._rgb=vO(e)}rgbString(){return this._valid?mje(this._rgb):void 0}hexString(){return this._valid?tje(this._rgb):void 0}hslString(){return this._valid?uje(this._rgb):void 0}mix(e,n){if(e){const s=this.rgb,r=e.rgb;let i;const o=n===i?.5:n,a=2*o-1,l=s.a-r.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;i=1-c,s.r=255&c*s.r+i*r.r+.5,s.g=255&c*s.g+i*r.g+.5,s.b=255&c*s.b+i*r.b+.5,s.a=o*s.a+(1-o)*r.a,this.rgb=s}return this}interpolate(e,n){return e&&(this._rgb=gje(this._rgb,e._rgb,n)),this}clone(){return new D0(this.rgb)}alpha(e){return this._rgb.a=Ou(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=Lx(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return My(this._rgb,2,e),this}darken(e){return My(this._rgb,2,-e),this}saturate(e){return My(this._rgb,1,e),this}desaturate(e){return My(this._rgb,1,-e),this}rotate(e){return cje(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Kl(){}const yje=(()=>{let t=0;return()=>t++})();function Ds(t){return t==null}function kr(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Bn(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function ga(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function ol(t,e){return ga(t)?t:e}function In(t,e){return typeof t>"u"?e:t}const vje=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function Ns(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function Qn(t,e,n,s){let r,i,o;if(kr(t))for(i=t.length,r=0;r<i;r++)e.call(n,t[r],r);else if(Bn(t))for(o=Object.keys(t),i=o.length,r=0;r<i;r++)e.call(n,t[o[r]],o[r])}function Yb(t,e){let n,s,r,i;if(!t||!e||t.length!==e.length)return!1;for(n=0,s=t.length;n<s;++n)if(r=t[n],i=e[n],r.datasetIndex!==i.datasetIndex||r.index!==i.index)return!1;return!0}function Qb(t){if(kr(t))return t.map(Qb);if(Bn(t)){const e=Object.create(null),n=Object.keys(t),s=n.length;let r=0;for(;r<s;++r)e[n[r]]=Qb(t[n[r]]);return e}return t}function eH(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function bje(t,e,n,s){if(!eH(t))return;const r=e[t],i=n[t];Bn(r)&&Bn(i)?O0(r,i,s):e[t]=Qb(i)}function O0(t,e,n){const s=kr(e)?e:[e],r=s.length;if(!Bn(t))return t;n=n||{};const i=n.merger||bje;let o;for(let a=0;a<r;++a){if(o=s[a],!Bn(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)i(l[c],t,o,n)}return t}function Lg(t,e){return O0(t,e,{merger:wje})}function wje(t,e,n){if(!eH(t))return;const s=e[t],r=n[t];Bn(s)&&Bn(r)?Lg(s,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=Qb(r))}const bO={"":t=>t,x:t=>t.x,y:t=>t.y};function Sje(t){const e=t.split("."),n=[];let s="";for(const r of e)s+=r,s.endsWith("\\")?s=s.slice(0,-1)+".":(n.push(s),s="");return n}function Cje(t){const e=Sje(t);return n=>{for(const s of e){if(s==="")break;n=n&&n[s]}return n}}function Zb(t,e){return(bO[e]||(bO[e]=Cje(e)))(t)}function WR(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Jb=t=>typeof t<"u",qu=t=>typeof t=="function",wO=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};function kje(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const Tr=Math.PI,Il=2*Tr,Nje=Il+Tr,ew=Number.POSITIVE_INFINITY,Tje=Tr/180,Ma=Tr/2,gd=Tr/4,SO=Tr*2/3,CN=Math.log10,Up=Math.sign;function Bg(t,e,n){return Math.abs(t-e)<n}function CO(t){const e=Math.round(t);t=Bg(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(CN(t))),s=t/n;return(s<=1?1:s<=2?2:s<=5?5:10)*n}function _je(t){const e=[],n=Math.sqrt(t);let s;for(s=1;s<n;s++)t%s===0&&(e.push(s),e.push(t/s));return n===(n|0)&&e.push(n),e.sort((r,i)=>r-i).pop(),e}function Eje(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function tw(t){return!Eje(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function $je(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}function Ije(t,e,n){let s,r,i;for(s=0,r=t.length;s<r;s++)i=t[s][n],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function Ud(t){return t*(Tr/180)}function Rje(t){return t*(180/Tr)}function kO(t){if(!ga(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function Pje(t,e){const n=e.x-t.x,s=e.y-t.y,r=Math.sqrt(n*n+s*s);let i=Math.atan2(s,n);return i<-.5*Tr&&(i+=Il),{angle:i,distance:r}}function kN(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Aje(t,e){return(t-e+Nje)%Il-Tr}function Xc(t){return(t%Il+Il)%Il}function tH(t,e,n,s){const r=Xc(t),i=Xc(e),o=Xc(n),a=Xc(i-r),l=Xc(o-r),c=Xc(r-i),d=Xc(r-o);return r===i||r===o||s&&i===o||a>l&&c<d}function bl(t,e,n){return Math.max(e,Math.min(n,t))}function jje(t){return bl(t,-32768,32767)}function fg(t,e,n,s=1e-6){return t>=Math.min(e,n)-s&&t<=Math.max(e,n)+s}function UR(t,e,n){n=n||(o=>t[o]<e);let s=t.length-1,r=0,i;for(;s-r>1;)i=r+s>>1,n(i)?r=i:s=i;return{lo:r,hi:s}}const NN=(t,e,n,s)=>UR(t,n,s?r=>{const i=t[r][e];return i<n||i===n&&t[r+1][e]===n}:r=>t[r][e]<n),Dje=(t,e,n)=>UR(t,n,s=>t[s][e]>=n);function Oje(t,e,n){let s=0,r=t.length;for(;s<r&&t[s]<e;)s++;for(;r>s&&t[r-1]>n;)r--;return s>0||r<t.length?t.slice(s,r):t}const nH=["push","pop","shift","splice","unshift"];function Fje(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),nH.forEach(n=>{const s="_onData"+WR(n),r=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...i){const o=r.apply(this,i);return t._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...i)}),o}})})}function NO(t,e){const n=t._chartjs;if(!n)return;const s=n.listeners,r=s.indexOf(e);r!==-1&&s.splice(r,1),!(s.length>0)&&(nH.forEach(i=>{delete t[i]}),delete t._chartjs)}function Mje(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const sH=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function rH(t,e){let n=[],s=!1;return function(...r){n=r,s||(s=!0,sH.call(window,()=>{s=!1,t.apply(e,n)}))}}function Lje(t,e){let n;return function(...s){return e?(clearTimeout(n),n=setTimeout(t,e,s)):t.apply(this,s),e}}const HR=t=>t==="start"?"left":t==="end"?"right":"center",Hr=(t,e,n)=>t==="start"?e:t==="end"?n:(e+n)/2,Bje=(t,e,n,s)=>t===(s?"left":"right")?n:t==="center"?(e+n)/2:e,Ly=t=>t===0||t===1,TO=(t,e,n)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*Il/n)),_O=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*Il/n)+1,Vg={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*Ma)+1,easeOutSine:t=>Math.sin(t*Ma),easeInOutSine:t=>-.5*(Math.cos(Tr*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>Ly(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>Ly(t)?t:TO(t,.075,.3),easeOutElastic:t=>Ly(t)?t:_O(t,.075,.3),easeInOutElastic(t){return Ly(t)?t:t<.5?.5*TO(t*2,.1125,.45):.5+.5*_O(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-Vg.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?Vg.easeInBounce(t*2)*.5:Vg.easeOutBounce(t*2-1)*.5+.5};function GR(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function EO(t){return GR(t)?t:new D0(t)}function yS(t){return GR(t)?t:new D0(t).saturate(.5).darken(.1).hexString()}const Vje=["x","y","borderWidth","radius","tension"],zje=["color","borderColor","backgroundColor"];function Wje(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:zje},numbers:{type:"number",properties:Vje}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Uje(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const $O=new Map;function Hje(t,e){e=e||{};const n=t+JSON.stringify(e);let s=$O.get(n);return s||(s=new Intl.NumberFormat(t,e),$O.set(n,s)),s}function iH(t,e,n){return Hje(e,n).format(t)}const oH={values(t){return kr(t)?t:""+t},numeric(t,e,n){if(t===0)return"0";const s=this.chart.options.locale;let r,i=t;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(r="scientific"),i=Gje(t,n)}const o=CN(Math.abs(i)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:r,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),iH(t,s,l)},logarithmic(t,e,n){if(t===0)return"0";const s=n[e].significand||t/Math.pow(10,Math.floor(CN(t)));return[1,2,3,5,10,15].includes(s)||e>.8*n.length?oH.numeric.call(this,t,e,n):""}};function Gje(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}var aH={formatters:oH};function Kje(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:aH.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Eh=Object.create(null),TN=Object.create(null);function zg(t,e){if(!e)return t;const n=e.split(".");for(let s=0,r=n.length;s<r;++s){const i=n[s];t=t[i]||(t[i]=Object.create(null))}return t}function vS(t,e,n){return typeof e=="string"?O0(zg(t,e),n):O0(zg(t,""),e)}class qje{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,r)=>yS(r.backgroundColor),this.hoverBorderColor=(s,r)=>yS(r.borderColor),this.hoverColor=(s,r)=>yS(r.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return vS(this,e,n)}get(e){return zg(this,e)}describe(e,n){return vS(TN,e,n)}override(e,n){return vS(Eh,e,n)}route(e,n,s,r){const i=zg(this,e),o=zg(this,s),a="_"+n;Object.defineProperties(i,{[a]:{value:i[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=o[r];return Bn(l)?Object.assign({},c,l):In(l,c)},set(l){this[a]=l}}})}apply(e){e.forEach(n=>n(this))}}var tr=new qje({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Wje,Uje,Kje]);function Xje(t){return!t||Ds(t.size)||Ds(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function IO(t,e,n,s,r){let i=e[r];return i||(i=e[r]=t.measureText(r).width,n.push(r)),i>s&&(s=i),s}function xd(t,e,n){const s=t.currentDevicePixelRatio,r=n!==0?Math.max(n/2,.5):0;return Math.round((e-r)*s)/s+r}function RO(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function _N(t,e,n,s){lH(t,e,n,s,null)}function lH(t,e,n,s,r){let i,o,a,l,c,d,h,f;const p=e.pointStyle,m=e.rotation,g=e.radius;let x=(m||0)*Tje;if(p&&typeof p=="object"&&(i=p.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){t.save(),t.translate(n,s),t.rotate(x),t.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),t.restore();return}if(!(isNaN(g)||g<=0)){switch(t.beginPath(),p){default:r?t.ellipse(n,s,r/2,g,0,0,Il):t.arc(n,s,g,0,Il),t.closePath();break;case"triangle":d=r?r/2:g,t.moveTo(n+Math.sin(x)*d,s-Math.cos(x)*g),x+=SO,t.lineTo(n+Math.sin(x)*d,s-Math.cos(x)*g),x+=SO,t.lineTo(n+Math.sin(x)*d,s-Math.cos(x)*g),t.closePath();break;case"rectRounded":c=g*.516,l=g-c,o=Math.cos(x+gd)*l,h=Math.cos(x+gd)*(r?r/2-c:l),a=Math.sin(x+gd)*l,f=Math.sin(x+gd)*(r?r/2-c:l),t.arc(n-h,s-a,c,x-Tr,x-Ma),t.arc(n+f,s-o,c,x-Ma,x),t.arc(n+h,s+a,c,x,x+Ma),t.arc(n-f,s+o,c,x+Ma,x+Tr),t.closePath();break;case"rect":if(!m){l=Math.SQRT1_2*g,d=r?r/2:l,t.rect(n-d,s-l,2*d,2*l);break}x+=gd;case"rectRot":h=Math.cos(x)*(r?r/2:g),o=Math.cos(x)*g,a=Math.sin(x)*g,f=Math.sin(x)*(r?r/2:g),t.moveTo(n-h,s-a),t.lineTo(n+f,s-o),t.lineTo(n+h,s+a),t.lineTo(n-f,s+o),t.closePath();break;case"crossRot":x+=gd;case"cross":h=Math.cos(x)*(r?r/2:g),o=Math.cos(x)*g,a=Math.sin(x)*g,f=Math.sin(x)*(r?r/2:g),t.moveTo(n-h,s-a),t.lineTo(n+h,s+a),t.moveTo(n+f,s-o),t.lineTo(n-f,s+o);break;case"star":h=Math.cos(x)*(r?r/2:g),o=Math.cos(x)*g,a=Math.sin(x)*g,f=Math.sin(x)*(r?r/2:g),t.moveTo(n-h,s-a),t.lineTo(n+h,s+a),t.moveTo(n+f,s-o),t.lineTo(n-f,s+o),x+=gd,h=Math.cos(x)*(r?r/2:g),o=Math.cos(x)*g,a=Math.sin(x)*g,f=Math.sin(x)*(r?r/2:g),t.moveTo(n-h,s-a),t.lineTo(n+h,s+a),t.moveTo(n+f,s-o),t.lineTo(n-f,s+o);break;case"line":o=r?r/2:Math.cos(x)*g,a=Math.sin(x)*g,t.moveTo(n-o,s-a),t.lineTo(n+o,s+a);break;case"dash":t.moveTo(n,s),t.lineTo(n+Math.cos(x)*(r?r/2:g),s+Math.sin(x)*g);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function F0(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function KR(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function qR(t){t.restore()}function Yje(t,e,n,s,r){if(!e)return t.lineTo(n.x,n.y);if(r==="middle"){const i=(e.x+n.x)/2;t.lineTo(i,e.y),t.lineTo(i,n.y)}else r==="after"!=!!s?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function Qje(t,e,n,s){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?n.cp2x:n.cp1x,s?n.cp2y:n.cp1y,n.x,n.y)}function Zje(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),Ds(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function Jje(t,e,n,s,r){if(r.strikethrough||r.underline){const i=t.measureText(s),o=e-i.actualBoundingBoxLeft,a=e+i.actualBoundingBoxRight,l=n-i.actualBoundingBoxAscent,c=n+i.actualBoundingBoxDescent,d=r.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,d),t.lineTo(a,d),t.stroke()}}function eDe(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function M0(t,e,n,s,r,i={}){const o=kr(e)?e:[e],a=i.strokeWidth>0&&i.strokeColor!=="";let l,c;for(t.save(),t.font=r.string,Zje(t,i),l=0;l<o.length;++l)c=o[l],i.backdrop&&eDe(t,i.backdrop),a&&(i.strokeColor&&(t.strokeStyle=i.strokeColor),Ds(i.strokeWidth)||(t.lineWidth=i.strokeWidth),t.strokeText(c,n,s,i.maxWidth)),t.fillText(c,n,s,i.maxWidth),Jje(t,n,s,c,i),s+=Number(r.lineHeight);t.restore()}function EN(t,e){const{x:n,y:s,w:r,h:i,radius:o}=e;t.arc(n+o.topLeft,s+o.topLeft,o.topLeft,1.5*Tr,Tr,!0),t.lineTo(n,s+i-o.bottomLeft),t.arc(n+o.bottomLeft,s+i-o.bottomLeft,o.bottomLeft,Tr,Ma,!0),t.lineTo(n+r-o.bottomRight,s+i),t.arc(n+r-o.bottomRight,s+i-o.bottomRight,o.bottomRight,Ma,0,!0),t.lineTo(n+r,s+o.topRight),t.arc(n+r-o.topRight,s+o.topRight,o.topRight,0,-Ma,!0),t.lineTo(n+o.topLeft,s)}const tDe=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,nDe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function sDe(t,e){const n=(""+t).match(tDe);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const rDe=t=>+t||0;function cH(t,e){const n={},s=Bn(e),r=s?Object.keys(e):e,i=Bn(t)?s?o=>In(t[o],t[e[o]]):o=>t[o]:()=>t;for(const o of r)n[o]=rDe(i(o));return n}function iDe(t){return cH(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Wg(t){return cH(t,["topLeft","topRight","bottomLeft","bottomRight"])}function xa(t){const e=iDe(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function Qr(t,e){t=t||{},e=e||tr.font;let n=In(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let s=In(t.style,e.style);s&&!(""+s).match(nDe)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const r={family:In(t.family,e.family),lineHeight:sDe(In(t.lineHeight,e.lineHeight),n),size:n,style:s,weight:In(t.weight,e.weight),string:""};return r.string=Xje(r),r}function By(t,e,n,s){let r,i,o;for(r=0,i=t.length;r<i;++r)if(o=t[r],o!==void 0&&o!==void 0)return o}function oDe(t,e,n){const{min:s,max:r}=t,i=vje(e,(r-s)/2),o=(a,l)=>n&&a===0?0:a+l;return{min:o(s,-Math.abs(i)),max:o(r,i)}}function Zh(t,e){return Object.assign(Object.create(t),e)}function XR(t,e=[""],n,s,r=()=>t[0]){const i=n||t;typeof s>"u"&&(s=fH("_fallback",t));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:i,_fallback:s,_getTarget:r,override:a=>XR([a,...t],e,i,s)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete t[0][l],!0},get(a,l){return dH(a,l,()=>pDe(l,e,t,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(a,l){return AO(a).includes(l)},ownKeys(a){return AO(a)},set(a,l,c){const d=a._storage||(a._storage=r());return a[l]=d[l]=c,delete a._keys,!0}})}function Hp(t,e,n,s){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:uH(t,s),setContext:i=>Hp(t,i,n,s),override:i=>Hp(t.override(i),e,n,s)};return new Proxy(r,{deleteProperty(i,o){return delete i[o],delete t[o],!0},get(i,o,a){return dH(i,o,()=>lDe(i,o,a))},getOwnPropertyDescriptor(i,o){return i._descriptors.allKeys?Reflect.has(t,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,o)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(i,o){return Reflect.has(t,o)},ownKeys(){return Reflect.ownKeys(t)},set(i,o,a){return t[o]=a,delete i[o],!0}})}function uH(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:s=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:n,indexable:s,isScriptable:qu(n)?n:()=>n,isIndexable:qu(s)?s:()=>s}}const aDe=(t,e)=>t?t+WR(e):e,YR=(t,e)=>Bn(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function dH(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const s=n();return t[e]=s,s}function lDe(t,e,n){const{_proxy:s,_context:r,_subProxy:i,_descriptors:o}=t;let a=s[e];return qu(a)&&o.isScriptable(e)&&(a=cDe(e,a,t,n)),kr(a)&&a.length&&(a=uDe(e,a,t,o.isIndexable)),YR(e,a)&&(a=Hp(a,r,i&&i[e],o)),a}function cDe(t,e,n,s){const{_proxy:r,_context:i,_subProxy:o,_stack:a}=n;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);a.add(t);let l=e(i,o||s);return a.delete(t),YR(t,l)&&(l=QR(r._scopes,r,t,l)),l}function uDe(t,e,n,s){const{_proxy:r,_context:i,_subProxy:o,_descriptors:a}=n;if(typeof i.index<"u"&&s(t))return e[i.index%e.length];if(Bn(e[0])){const l=e,c=r._scopes.filter(d=>d!==l);e=[];for(const d of l){const h=QR(c,r,t,d);e.push(Hp(h,i,o&&o[t],a))}}return e}function hH(t,e,n){return qu(t)?t(e,n):t}const dDe=(t,e)=>t===!0?e:typeof t=="string"?Zb(e,t):void 0;function hDe(t,e,n,s,r){for(const i of e){const o=dDe(n,i);if(o){t.add(o);const a=hH(o._fallback,n,r);if(typeof a<"u"&&a!==n&&a!==s)return a}else if(o===!1&&typeof s<"u"&&n!==s)return null}return!1}function QR(t,e,n,s){const r=e._rootScopes,i=hH(e._fallback,n,s),o=[...t,...r],a=new Set;a.add(s);let l=PO(a,o,n,i||n,s);return l===null||typeof i<"u"&&i!==n&&(l=PO(a,o,i,l,s),l===null)?!1:XR(Array.from(a),[""],r,i,()=>fDe(e,n,s))}function PO(t,e,n,s,r){for(;n;)n=hDe(t,e,n,s,r);return n}function fDe(t,e,n){const s=t._getTarget();e in s||(s[e]={});const r=s[e];return kr(r)&&Bn(n)?n:r||{}}function pDe(t,e,n,s){let r;for(const i of e)if(r=fH(aDe(i,t),n),typeof r<"u")return YR(t,r)?QR(n,s,t,r):r}function fH(t,e){for(const n of e){if(!n)continue;const s=n[t];if(typeof s<"u")return s}}function AO(t){let e=t._keys;return e||(e=t._keys=mDe(t._scopes)),e}function mDe(t){const e=new Set;for(const n of t)for(const s of Object.keys(n).filter(r=>!r.startsWith("_")))e.add(s);return Array.from(e)}const gDe=Number.EPSILON||1e-14,Gp=(t,e)=>e<t.length&&!t[e].skip&&t[e],pH=t=>t==="x"?"y":"x";function xDe(t,e,n,s){const r=t.skip?e:t,i=e,o=n.skip?e:n,a=kN(i,r),l=kN(o,i);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const h=s*c,f=s*d;return{previous:{x:i.x-h*(o.x-r.x),y:i.y-h*(o.y-r.y)},next:{x:i.x+f*(o.x-r.x),y:i.y+f*(o.y-r.y)}}}function yDe(t,e,n){const s=t.length;let r,i,o,a,l,c=Gp(t,0);for(let d=0;d<s-1;++d)if(l=c,c=Gp(t,d+1),!(!l||!c)){if(Bg(e[d],0,gDe)){n[d]=n[d+1]=0;continue}r=n[d]/e[d],i=n[d+1]/e[d],a=Math.pow(r,2)+Math.pow(i,2),!(a<=9)&&(o=3/Math.sqrt(a),n[d]=r*o*e[d],n[d+1]=i*o*e[d])}}function vDe(t,e,n="x"){const s=pH(n),r=t.length;let i,o,a,l=Gp(t,0);for(let c=0;c<r;++c){if(o=a,a=l,l=Gp(t,c+1),!a)continue;const d=a[n],h=a[s];o&&(i=(d-o[n])/3,a[`cp1${n}`]=d-i,a[`cp1${s}`]=h-i*e[c]),l&&(i=(l[n]-d)/3,a[`cp2${n}`]=d+i,a[`cp2${s}`]=h+i*e[c])}}function bDe(t,e="x"){const n=pH(e),s=t.length,r=Array(s).fill(0),i=Array(s);let o,a,l,c=Gp(t,0);for(o=0;o<s;++o)if(a=l,l=c,c=Gp(t,o+1),!!l){if(c){const d=c[e]-l[e];r[o]=d!==0?(c[n]-l[n])/d:0}i[o]=a?c?Up(r[o-1])!==Up(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}yDe(t,r,i),vDe(t,i,e)}function Vy(t,e,n){return Math.max(Math.min(t,n),e)}function wDe(t,e){let n,s,r,i,o,a=F0(t[0],e);for(n=0,s=t.length;n<s;++n)o=i,i=a,a=n<s-1&&F0(t[n+1],e),i&&(r=t[n],o&&(r.cp1x=Vy(r.cp1x,e.left,e.right),r.cp1y=Vy(r.cp1y,e.top,e.bottom)),a&&(r.cp2x=Vy(r.cp2x,e.left,e.right),r.cp2y=Vy(r.cp2y,e.top,e.bottom)))}function SDe(t,e,n,s,r){let i,o,a,l;if(e.spanGaps&&(t=t.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")bDe(t,r);else{let c=s?t[t.length-1]:t[0];for(i=0,o=t.length;i<o;++i)a=t[i],l=xDe(c,a,t[Math.min(i+1,o-(s?0:1))%o],e.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}e.capBezierPoints&&wDe(t,n)}function ZR(){return typeof window<"u"&&typeof document<"u"}function JR(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function nw(t,e,n){let s;return typeof t=="string"?(s=parseInt(t,10),t.indexOf("%")!==-1&&(s=s/100*e.parentNode[n])):s=t,s}const O1=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function CDe(t,e){return O1(t).getPropertyValue(e)}const kDe=["top","right","bottom","left"];function ih(t,e,n){const s={};n=n?"-"+n:"";for(let r=0;r<4;r++){const i=kDe[r];s[i]=parseFloat(t[e+"-"+i+n])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const NDe=(t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot);function TDe(t,e){const n=t.touches,s=n&&n.length?n[0]:t,{offsetX:r,offsetY:i}=s;let o=!1,a,l;if(NDe(r,i,t.target))a=r,l=i;else{const c=e.getBoundingClientRect();a=s.clientX-c.left,l=s.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function Nd(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:s}=e,r=O1(n),i=r.boxSizing==="border-box",o=ih(r,"padding"),a=ih(r,"border","width"),{x:l,y:c,box:d}=TDe(t,n),h=o.left+(d&&a.left),f=o.top+(d&&a.top);let{width:p,height:m}=e;return i&&(p-=o.width+a.width,m-=o.height+a.height),{x:Math.round((l-h)/p*n.width/s),y:Math.round((c-f)/m*n.height/s)}}function _De(t,e,n){let s,r;if(e===void 0||n===void 0){const i=t&&JR(t);if(!i)e=t.clientWidth,n=t.clientHeight;else{const o=i.getBoundingClientRect(),a=O1(i),l=ih(a,"border","width"),c=ih(a,"padding");e=o.width-c.width-l.width,n=o.height-c.height-l.height,s=nw(a.maxWidth,i,"clientWidth"),r=nw(a.maxHeight,i,"clientHeight")}}return{width:e,height:n,maxWidth:s||ew,maxHeight:r||ew}}const zy=t=>Math.round(t*10)/10;function EDe(t,e,n,s){const r=O1(t),i=ih(r,"margin"),o=nw(r.maxWidth,t,"clientWidth")||ew,a=nw(r.maxHeight,t,"clientHeight")||ew,l=_De(t,e,n);let{width:c,height:d}=l;if(r.boxSizing==="content-box"){const f=ih(r,"border","width"),p=ih(r,"padding");c-=p.width+f.width,d-=p.height+f.height}return c=Math.max(0,c-i.width),d=Math.max(0,s?c/s:d-i.height),c=zy(Math.min(c,o,l.maxWidth)),d=zy(Math.min(d,a,l.maxHeight)),c&&!d&&(d=zy(c/2)),(e!==void 0||n!==void 0)&&s&&l.height&&d>l.height&&(d=l.height,c=zy(Math.floor(d*s))),{width:c,height:d}}function jO(t,e,n){const s=e||1,r=Math.floor(t.height*s),i=Math.floor(t.width*s);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const o=t.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),t.currentDevicePixelRatio!==s||o.height!==r||o.width!==i?(t.currentDevicePixelRatio=s,o.height=r,o.width=i,t.ctx.setTransform(s,0,0,s,0,0),!0):!1}const $De=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};ZR()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function DO(t,e){const n=CDe(t,e),s=n&&n.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function Td(t,e,n,s){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function IDe(t,e,n,s){return{x:t.x+n*(e.x-t.x),y:s==="middle"?n<.5?t.y:e.y:s==="after"?n<1?t.y:e.y:n>0?e.y:t.y}}function RDe(t,e,n,s){const r={x:t.cp2x,y:t.cp2y},i={x:e.cp1x,y:e.cp1y},o=Td(t,r,n),a=Td(r,i,n),l=Td(i,e,n),c=Td(o,a,n),d=Td(a,l,n);return Td(c,d,n)}const PDe=function(t,e){return{x(n){return t+t+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,s){return n-s},leftForLtr(n,s){return n-s}}},ADe=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function op(t,e,n){return t?PDe(e,n):ADe()}function mH(t,e){let n,s;(e==="ltr"||e==="rtl")&&(n=t.canvas.style,s=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=s)}function gH(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function xH(t){return t==="angle"?{between:tH,compare:Aje,normalize:Xc}:{between:fg,compare:(e,n)=>e-n,normalize:e=>e}}function OO({start:t,end:e,count:n,loop:s,style:r}){return{start:t%n,end:e%n,loop:s&&(e-t+1)%n===0,style:r}}function jDe(t,e,n){const{property:s,start:r,end:i}=n,{between:o,normalize:a}=xH(s),l=e.length;let{start:c,end:d,loop:h}=t,f,p;if(h){for(c+=l,d+=l,f=0,p=l;f<p&&o(a(e[c%l][s]),r,i);++f)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:h,style:t.style}}function DDe(t,e,n){if(!n)return[t];const{property:s,start:r,end:i}=n,o=e.length,{compare:a,between:l,normalize:c}=xH(s),{start:d,end:h,loop:f,style:p}=jDe(t,e,n),m=[];let g=!1,x=null,y,v,S;const C=()=>l(r,S,y)&&a(r,S)!==0,k=()=>a(i,y)===0||l(i,S,y),T=()=>g||C(),_=()=>!g||k();for(let $=d,R=d;$<=h;++$)v=e[$%o],!v.skip&&(y=c(v[s]),y!==S&&(g=l(y,r,i),x===null&&T()&&(x=a(y,r)===0?$:R),x!==null&&_()&&(m.push(OO({start:x,end:$,loop:f,count:o,style:p})),x=null),R=$,S=y));return x!==null&&m.push(OO({start:x,end:h,loop:f,count:o,style:p})),m}function ODe(t,e){const n=[],s=t.segments;for(let r=0;r<s.length;r++){const i=DDe(s[r],t.points,e);i.length&&n.push(...i)}return n}function FDe(t,e,n,s){let r=0,i=e-1;if(n&&!s)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,n&&(i+=r);i>r&&t[i%e].skip;)i--;return i%=e,{start:r,end:i}}function MDe(t,e,n,s){const r=t.length,i=[];let o=e,a=t[e],l;for(l=e+1;l<=n;++l){const c=t[l%r];c.skip||c.stop?a.skip||(s=!1,i.push({start:e%r,end:(l-1)%r,loop:s}),e=o=c.stop?l:null):(o=l,a.skip&&(e=l)),a=c}return o!==null&&i.push({start:e%r,end:o%r,loop:s}),i}function LDe(t,e){const n=t.points,s=t.options.spanGaps,r=n.length;if(!r)return[];const i=!!t._loop,{start:o,end:a}=FDe(n,r,i,s);if(s===!0)return FO(t,[{start:o,end:a,loop:i}],n,e);const l=a<o?a+r:a,c=!!t._fullLoop&&o===0&&a===r-1;return FO(t,MDe(n,o,l,c),n,e)}function FO(t,e,n,s){return!s||!s.setContext||!n?e:BDe(t,e,n,s)}function BDe(t,e,n,s){const r=t._chart.getContext(),i=MO(t.options),{_datasetIndex:o,options:{spanGaps:a}}=t,l=n.length,c=[];let d=i,h=e[0].start,f=h;function p(m,g,x,y){const v=a?-1:1;if(m!==g){for(m+=l;n[m%l].skip;)m-=v;for(;n[g%l].skip;)g+=v;m%l!==g%l&&(c.push({start:m%l,end:g%l,loop:x,style:y}),d=y,h=g%l)}}for(const m of e){h=a?h:m.start;let g=n[h%l],x;for(f=h+1;f<=m.end;f++){const y=n[f%l];x=MO(s.setContext(Zh(r,{type:"segment",p0:g,p1:y,p0DataIndex:(f-1)%l,p1DataIndex:f%l,datasetIndex:o}))),VDe(x,d)&&p(h,f-1,m.loop,d),g=y,d=x}h<f-1&&p(h,f-1,m.loop,d)}return c}function MO(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function VDe(t,e){if(!e)return!1;const n=[],s=function(r,i){return GR(i)?(n.includes(i)||n.push(i),n.indexOf(i)):i};return JSON.stringify(t,s)!==JSON.stringify(e,s)}function Wy(t,e,n){return t.options.clip?t[n]:e[n]}function zDe(t,e){const{xScale:n,yScale:s}=t;return n&&s?{left:Wy(n,e,"left"),right:Wy(n,e,"right"),top:Wy(s,e,"top"),bottom:Wy(s,e,"bottom")}:e}function WDe(t,e){const n=e._clip;if(n.disabled)return!1;const s=zDe(e,t.chartArea);return{left:n.left===!1?0:s.left-(n.left===!0?0:n.left),right:n.right===!1?t.width:s.right+(n.right===!0?0:n.right),top:n.top===!1?0:s.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?t.height:s.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class UDe{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,s,r){const i=n.listeners[r],o=n.duration;i.forEach(a=>a({chart:e,initial:n.initial,numSteps:o,currentStep:Math.min(s-n.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=sH.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((s,r)=>{if(!s.running||!s.items.length)return;const i=s.items;let o=i.length-1,a=!1,l;for(;o>=0;--o)l=i[o],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(e),a=!0):(i[o]=i[i.length-1],i.pop());a&&(r.draw(),this._notify(r,s,e,"progress")),i.length||(s.running=!1,this._notify(r,s,e,"complete"),s.initial=!1),n+=i.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let s=n.get(e);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,s)),s}listen(e,n,s){this._getAnims(e).listeners[n].push(s)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((s,r)=>Math.max(s,r._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const s=n.items;let r=s.length-1;for(;r>=0;--r)s[r].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Ql=new UDe;const LO="transparent",HDe={boolean(t,e,n){return n>.5?e:t},color(t,e,n){const s=EO(t||LO),r=s.valid&&EO(e||LO);return r&&r.valid?r.mix(s,n).hexString():e},number(t,e,n){return t+(e-t)*n}};class GDe{constructor(e,n,s,r){const i=n[s];r=By([e.to,r,i,e.from]);const o=By([e.from,i,r]);this._active=!0,this._fn=e.fn||HDe[e.type||typeof o],this._easing=Vg[e.easing]||Vg.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=s,this._from=o,this._to=r,this._promises=void 0}active(){return this._active}update(e,n,s){if(this._active){this._notify(!1);const r=this._target[this._prop],i=s-this._start,o=this._duration-i;this._start=s,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=By([e.to,n,r,e.from]),this._from=By([e.from,r,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,s=this._duration,r=this._prop,i=this._from,o=this._loop,a=this._to;let l;if(this._active=i!==a&&(o||n<s),!this._active){this._target[r]=a,this._notify(!0);return}if(n<0){this._target[r]=i;return}l=n/s%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[r]=this._fn(i,a,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,s)=>{e.push({res:n,rej:s})})}_notify(e){const n=e?"res":"rej",s=this._promises||[];for(let r=0;r<s.length;r++)s[r][n]()}}class yH{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!Bn(e))return;const n=Object.keys(tr.animation),s=this._properties;Object.getOwnPropertyNames(e).forEach(r=>{const i=e[r];if(!Bn(i))return;const o={};for(const a of n)o[a]=i[a];(kr(i.properties)&&i.properties||[r]).forEach(a=>{(a===r||!s.has(a))&&s.set(a,o)})})}_animateOptions(e,n){const s=n.options,r=qDe(e,s);if(!r)return[];const i=this._createAnimations(r,s);return s.$shared&&KDe(e.options.$animations,s).then(()=>{e.options=s},()=>{}),i}_createAnimations(e,n){const s=this._properties,r=[],i=e.$animations||(e.$animations={}),o=Object.keys(n),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){r.push(...this._animateOptions(e,n));continue}const d=n[c];let h=i[c];const f=s.get(c);if(h)if(f&&h.active()){h.update(f,d,a);continue}else h.cancel();if(!f||!f.duration){e[c]=d;continue}i[c]=h=new GDe(f,e,c,d),r.push(h)}return r}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const s=this._createAnimations(e,n);if(s.length)return Ql.add(this._chart,s),!0}}function KDe(t,e){const n=[],s=Object.keys(e);for(let r=0;r<s.length;r++){const i=t[s[r]];i&&i.active()&&n.push(i.wait())}return Promise.all(n)}function qDe(t,e){if(!e)return;let n=t.options;if(!n){t.options=e;return}return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function BO(t,e){const n=t&&t.options||{},s=n.reverse,r=n.min===void 0?e:0,i=n.max===void 0?e:0;return{start:s?i:r,end:s?r:i}}function XDe(t,e,n){if(n===!1)return!1;const s=BO(t,n),r=BO(e,n);return{top:r.end,right:s.end,bottom:r.start,left:s.start}}function YDe(t){let e,n,s,r;return Bn(t)?(e=t.top,n=t.right,s=t.bottom,r=t.left):e=n=s=r=t,{top:e,right:n,bottom:s,left:r,disabled:t===!1}}function vH(t,e){const n=[],s=t._getSortedDatasetMetas(e);let r,i;for(r=0,i=s.length;r<i;++r)n.push(s[r].index);return n}function VO(t,e,n,s={}){const r=t.keys,i=s.mode==="single";let o,a,l,c;if(e===null)return;let d=!1;for(o=0,a=r.length;o<a;++o){if(l=+r[o],l===n){if(d=!0,s.all)continue;break}c=t.values[l],ga(c)&&(i||e===0||Up(e)===Up(c))&&(e+=c)}return!d&&!s.all?0:e}function QDe(t,e){const{iScale:n,vScale:s}=e,r=n.axis==="x"?"x":"y",i=s.axis==="x"?"x":"y",o=Object.keys(t),a=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],a[l]={[r]:d,[i]:t[d]};return a}function bS(t,e){const n=t&&t.options.stacked;return n||n===void 0&&e.stack!==void 0}function ZDe(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}function JDe(t){const{min:e,max:n,minDefined:s,maxDefined:r}=t.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:r?n:Number.POSITIVE_INFINITY}}function eOe(t,e,n){const s=t[e]||(t[e]={});return s[n]||(s[n]={})}function zO(t,e,n,s){for(const r of e.getMatchingVisibleMetas(s).reverse()){const i=t[r.index];if(n&&i>0||!n&&i<0)return r.index}return null}function WO(t,e){const{chart:n,_cachedMeta:s}=t,r=n._stacks||(n._stacks={}),{iScale:i,vScale:o,index:a}=s,l=i.axis,c=o.axis,d=ZDe(i,o,s),h=e.length;let f;for(let p=0;p<h;++p){const m=e[p],{[l]:g,[c]:x}=m,y=m._stacks||(m._stacks={});f=y[c]=eOe(r,d,g),f[a]=x,f._top=zO(f,o,!0,s.type),f._bottom=zO(f,o,!1,s.type);const v=f._visualValues||(f._visualValues={});v[a]=x}}function wS(t,e){const n=t.scales;return Object.keys(n).filter(s=>n[s].axis===e).shift()}function tOe(t,e){return Zh(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function nOe(t,e,n){return Zh(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function Um(t,e){const n=t.controller.index,s=t.vScale&&t.vScale.axis;if(s){e=e||t._parsed;for(const r of e){const i=r._stacks;if(!i||i[s]===void 0||i[s][n]===void 0)return;delete i[s][n],i[s]._visualValues!==void 0&&i[s]._visualValues[n]!==void 0&&delete i[s]._visualValues[n]}}}const SS=t=>t==="reset"||t==="none",UO=(t,e)=>e?t:Object.assign({},t),sOe=(t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:vH(n,!0),values:null};class Pv{constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=bS(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Um(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,s=this.getDataset(),r=(h,f,p,m)=>h==="x"?f:h==="r"?m:p,i=n.xAxisID=In(s.xAxisID,wS(e,"x")),o=n.yAxisID=In(s.yAxisID,wS(e,"y")),a=n.rAxisID=In(s.rAxisID,wS(e,"r")),l=n.indexAxis,c=n.iAxisID=r(l,i,o,a),d=n.vAxisID=r(l,o,i,a);n.xScale=this.getScaleForId(i),n.yScale=this.getScaleForId(o),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&NO(this._data,this),e._stacked&&Um(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),s=this._data;if(Bn(n)){const r=this._cachedMeta;this._data=QDe(n,r)}else if(s!==n){if(s){NO(s,this);const r=this._cachedMeta;Um(r),r._parsed=[]}n&&Object.isExtensible(n)&&Fje(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,s=this.getDataset();let r=!1;this._dataCheck();const i=n._stacked;n._stacked=bS(n.vScale,n),n.stack!==s.stack&&(r=!0,Um(n),n.stack=s.stack),this._resyncElements(e),(r||i!==n._stacked)&&(WO(this,n._parsed),n._stacked=bS(n.vScale,n))}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),s=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:s,_data:r}=this,{iScale:i,_stacked:o}=s,a=i.axis;let l=e===0&&n===r.length?!0:s._sorted,c=e>0&&s._parsed[e-1],d,h,f;if(this._parsing===!1)s._parsed=r,s._sorted=!0,f=r;else{kr(r[e])?f=this.parseArrayData(s,r,e,n):Bn(r[e])?f=this.parseObjectData(s,r,e,n):f=this.parsePrimitiveData(s,r,e,n);const p=()=>h[a]===null||c&&h[a]<c[a];for(d=0;d<n;++d)s._parsed[d+e]=h=f[d],l&&(p()&&(l=!1),c=h);s._sorted=l}o&&WO(this,f)}parsePrimitiveData(e,n,s,r){const{iScale:i,vScale:o}=e,a=i.axis,l=o.axis,c=i.getLabels(),d=i===o,h=new Array(r);let f,p,m;for(f=0,p=r;f<p;++f)m=f+s,h[f]={[a]:d||i.parse(c[m],m),[l]:o.parse(n[m],m)};return h}parseArrayData(e,n,s,r){const{xScale:i,yScale:o}=e,a=new Array(r);let l,c,d,h;for(l=0,c=r;l<c;++l)d=l+s,h=n[d],a[l]={x:i.parse(h[0],d),y:o.parse(h[1],d)};return a}parseObjectData(e,n,s,r){const{xScale:i,yScale:o}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(r);let d,h,f,p;for(d=0,h=r;d<h;++d)f=d+s,p=n[f],c[d]={x:i.parse(Zb(p,a),f),y:o.parse(Zb(p,l),f)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,s){const r=this.chart,i=this._cachedMeta,o=n[e.axis],a={keys:vH(r,!0),values:n._stacks[e.axis]._visualValues};return VO(a,o,i.index,{mode:s})}updateRangeFromParsed(e,n,s,r){const i=s[n.axis];let o=i===null?NaN:i;const a=r&&s._stacks[n.axis];r&&a&&(r.values=a,o=VO(r,i,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,n){const s=this._cachedMeta,r=s._parsed,i=s._sorted&&e===s.iScale,o=r.length,a=this._getOtherScale(e),l=sOe(n,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:h}=JDe(a);let f,p;function m(){p=r[f];const g=p[a.axis];return!ga(p[e.axis])||d>g||h<g}for(f=0;f<o&&!(!m()&&(this.updateRangeFromParsed(c,e,p,l),i));++f);if(i){for(f=o-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(c,e,p,l);break}}return c}getAllParsedValues(e){const n=this._cachedMeta._parsed,s=[];let r,i,o;for(r=0,i=n.length;r<i;++r)o=n[r][e.axis],ga(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,s=n.iScale,r=n.vScale,i=this.getParsed(e);return{label:s?""+s.getLabelForValue(i[s.axis]):"",value:r?""+r.getLabelForValue(i[r.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=YDe(In(this.options.clip,XDe(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,s=this._cachedMeta,r=s.data||[],i=n.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||r.length-a,c=this.options.drawActiveElementsOnTop;let d;for(s.dataset&&s.dataset.draw(e,i,a,l),d=a;d<a+l;++d){const h=r[d];h.hidden||(h.active&&c?o.push(h):h.draw(e,i))}for(d=0;d<o.length;++d)o[d].draw(e,i)}getStyle(e,n){const s=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(e||0,s)}getContext(e,n,s){const r=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];i=o.$context||(o.$context=nOe(this.getContext(),e,o)),i.parsed=this.getParsed(e),i.raw=r.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=tOe(this.chart.getContext(),this.index)),i.dataset=r,i.index=i.datasetIndex=this.index;return i.active=!!n,i.mode=s,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",s){const r=n==="active",i=this._cachedDataOpts,o=e+"-"+n,a=i[o],l=this.enableOptionSharing&&Jb(s);if(a)return UO(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,e),h=r?[`${e}Hover`,"hover",e,""]:[e,""],f=c.getOptionScopes(this.getDataset(),d),p=Object.keys(tr.elements[e]),m=()=>this.getContext(s,r,n),g=c.resolveNamedOptions(f,p,m,h);return g.$shared&&(g.$shared=l,i[o]=Object.freeze(UO(g,l))),g}_resolveAnimations(e,n,s){const r=this.chart,i=this._cachedDataOpts,o=`animation-${n}`,a=i[o];if(a)return a;let l;if(r.options.animation!==!1){const d=this.chart.config,h=d.datasetAnimationScopeKeys(this._type,n),f=d.getOptionScopes(this.getDataset(),h);l=d.createResolver(f,this.getContext(e,s,n))}const c=new yH(r,l&&l.animations);return l&&l._cacheable&&(i[o]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||SS(e)||this.chart._animationsDisabled}_getSharedOptions(e,n){const s=this.resolveDataElementOptions(e,n),r=this._sharedOptions,i=this.getSharedOptions(s),o=this.includeOptions(n,i)||i!==r;return this.updateSharedOptions(i,n,s),{sharedOptions:i,includeOptions:o}}updateElement(e,n,s,r){SS(r)?Object.assign(e,s):this._resolveAnimations(n,r).update(e,s)}updateSharedOptions(e,n,s){e&&!SS(n)&&this._resolveAnimations(void 0,n).update(e,s)}_setStyle(e,n,s,r){e.active=r;const i=this.getStyle(n,r);this._resolveAnimations(n,s,r).update(e,{options:!r&&this.getSharedOptions(i)||i})}removeHoverStyle(e,n,s){this._setStyle(e,s,"active",!1)}setHoverStyle(e,n,s){this._setStyle(e,s,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,s=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const r=s.length,i=n.length,o=Math.min(i,r);o&&this.parse(0,o),i>r?this._insertElements(r,i-r,e):i<r&&this._removeElements(i,r-i)}_insertElements(e,n,s=!0){const r=this._cachedMeta,i=r.data,o=e+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=o;a--)c[a]=c[a-n]};for(l(i),a=e;a<o;++a)i[a]=new this.dataElementType;this._parsing&&l(r._parsed),this.parse(e,n),s&&this.updateElements(i,e,n,"reset")}updateElements(e,n,s,r){}_removeElements(e,n){const s=this._cachedMeta;if(this._parsing){const r=s._parsed.splice(e,n);s._stacked&&Um(s,r)}s.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,s,r]=e;this[n](s,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const s=arguments.length-2;s&&this._sync(["_insertElements",e,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}vn(Pv,"defaults",{}),vn(Pv,"datasetElementType",null),vn(Pv,"dataElementType",null);function yd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class eP{constructor(e){vn(this,"options");this.options=e||{}}static override(e){Object.assign(eP.prototype,e)}init(){}formats(){return yd()}parse(){return yd()}format(){return yd()}add(){return yd()}diff(){return yd()}startOf(){return yd()}endOf(){return yd()}}var rOe={_date:eP};function iOe(t,e,n,s){const{controller:r,data:i,_sorted:o}=t,a=r._cachedMeta.iScale,l=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(a&&e===a.axis&&e!=="r"&&o&&i.length){const c=a._reversePixels?Dje:NN;if(s){if(r._sharedOptions){const d=i[0],h=typeof d.getRange=="function"&&d.getRange(e);if(h){const f=c(i,e,n-h),p=c(i,e,n+h);return{lo:f.lo,hi:p.hi}}}}else{const d=c(i,e,n);if(l){const{vScale:h}=r._cachedMeta,{_parsed:f}=t,p=f.slice(0,d.lo+1).reverse().findIndex(g=>!Ds(g[h.axis]));d.lo-=Math.max(0,p);const m=f.slice(d.hi).findIndex(g=>!Ds(g[h.axis]));d.hi+=Math.max(0,m)}return d}}return{lo:0,hi:i.length-1}}function Bx(t,e,n,s,r){const i=t.getSortedVisibleDatasetMetas(),o=n[e];for(let a=0,l=i.length;a<l;++a){const{index:c,data:d}=i[a],{lo:h,hi:f}=iOe(i[a],e,o,r);for(let p=h;p<=f;++p){const m=d[p];m.skip||s(m,c,p)}}}function oOe(t){const e=t.indexOf("x")!==-1,n=t.indexOf("y")!==-1;return function(s,r){const i=e?Math.abs(s.x-r.x):0,o=n?Math.abs(s.y-r.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(o,2))}}function CS(t,e,n,s,r){const i=[];return!r&&!t.isPointInArea(e)||Bx(t,n,e,function(a,l,c){!r&&!F0(a,t.chartArea,0)||a.inRange(e.x,e.y,s)&&i.push({element:a,datasetIndex:l,index:c})},!0),i}function aOe(t,e,n,s){let r=[];function i(o,a,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],s),{angle:h}=Pje(o,{x:e.x,y:e.y});tH(h,c,d)&&r.push({element:o,datasetIndex:a,index:l})}return Bx(t,n,e,i),r}function lOe(t,e,n,s,r,i){let o=[];const a=oOe(n);let l=Number.POSITIVE_INFINITY;function c(d,h,f){const p=d.inRange(e.x,e.y,r);if(s&&!p)return;const m=d.getCenterPoint(r);if(!(!!i||t.isPointInArea(m))&&!p)return;const x=a(e,m);x<l?(o=[{element:d,datasetIndex:h,index:f}],l=x):x===l&&o.push({element:d,datasetIndex:h,index:f})}return Bx(t,n,e,c),o}function kS(t,e,n,s,r,i){return!i&&!t.isPointInArea(e)?[]:n==="r"&&!s?aOe(t,e,n,r):lOe(t,e,n,s,r,i)}function HO(t,e,n,s,r){const i=[],o=n==="x"?"inXRange":"inYRange";let a=!1;return Bx(t,n,e,(l,c,d)=>{l[o]&&l[o](e[n],r)&&(i.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(e.x,e.y,r))}),s&&!a?[]:i}var cOe={evaluateInteractionItems:Bx,modes:{index(t,e,n,s){const r=Nd(e,t),i=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?CS(t,r,i,s,o):kS(t,r,i,!1,s,o),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,h=c.data[d];h&&!h.skip&&l.push({element:h,datasetIndex:c.index,index:d})}),l):[]},dataset(t,e,n,s){const r=Nd(e,t),i=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?CS(t,r,i,s,o):kS(t,r,i,!1,s,o);if(a.length>0){const l=a[0].datasetIndex,c=t.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(t,e,n,s){const r=Nd(e,t),i=n.axis||"xy",o=n.includeInvisible||!1;return CS(t,r,i,s,o)},nearest(t,e,n,s){const r=Nd(e,t),i=n.axis||"xy",o=n.includeInvisible||!1;return kS(t,r,i,n.intersect,s,o)},x(t,e,n,s){const r=Nd(e,t);return HO(t,r,"x",n.intersect,s)},y(t,e,n,s){const r=Nd(e,t);return HO(t,r,"y",n.intersect,s)}}};const bH=["left","top","right","bottom"];function Hm(t,e){return t.filter(n=>n.pos===e)}function GO(t,e){return t.filter(n=>bH.indexOf(n.pos)===-1&&n.box.axis===e)}function Gm(t,e){return t.sort((n,s)=>{const r=e?s:n,i=e?n:s;return r.weight===i.weight?r.index-i.index:r.weight-i.weight})}function uOe(t){const e=[];let n,s,r,i,o,a;for(n=0,s=(t||[]).length;n<s;++n)r=t[n],{position:i,options:{stack:o,stackWeight:a=1}}=r,e.push({index:n,box:r,pos:i,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&i+o,stackWeight:a});return e}function dOe(t){const e={};for(const n of t){const{stack:s,pos:r,stackWeight:i}=n;if(!s||!bH.includes(r))continue;const o=e[s]||(e[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=i}return e}function hOe(t,e){const n=dOe(t),{vBoxMaxWidth:s,hBoxMaxHeight:r}=e;let i,o,a;for(i=0,o=t.length;i<o;++i){a=t[i];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*s:l&&e.availableWidth,a.height=r):(a.width=s,a.height=d?d*r:l&&e.availableHeight)}return n}function fOe(t){const e=uOe(t),n=Gm(e.filter(c=>c.box.fullSize),!0),s=Gm(Hm(e,"left"),!0),r=Gm(Hm(e,"right")),i=Gm(Hm(e,"top"),!0),o=Gm(Hm(e,"bottom")),a=GO(e,"x"),l=GO(e,"y");return{fullSize:n,leftAndTop:s.concat(i),rightAndBottom:r.concat(l).concat(o).concat(a),chartArea:Hm(e,"chartArea"),vertical:s.concat(r).concat(l),horizontal:i.concat(o).concat(a)}}function KO(t,e,n,s){return Math.max(t[n],e[n])+Math.max(t[s],e[s])}function wH(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function pOe(t,e,n,s){const{pos:r,box:i}=n,o=t.maxPadding;if(!Bn(r)){n.size&&(t[r]-=n.size);const h=s[n.stack]||{size:0,count:1};h.size=Math.max(h.size,n.horizontal?i.height:i.width),n.size=h.size/h.count,t[r]+=n.size}i.getPadding&&wH(o,i.getPadding());const a=Math.max(0,e.outerWidth-KO(o,t,"left","right")),l=Math.max(0,e.outerHeight-KO(o,t,"top","bottom")),c=a!==t.w,d=l!==t.h;return t.w=a,t.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function mOe(t){const e=t.maxPadding;function n(s){const r=Math.max(e[s]-t[s],0);return t[s]+=r,r}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}function gOe(t,e){const n=e.maxPadding;function s(r){const i={left:0,top:0,right:0,bottom:0};return r.forEach(o=>{i[o]=Math.max(e[o],n[o])}),i}return s(t?["left","right"]:["top","bottom"])}function pg(t,e,n,s){const r=[];let i,o,a,l,c,d;for(i=0,o=t.length,c=0;i<o;++i){a=t[i],l=a.box,l.update(a.width||e.w,a.height||e.h,gOe(a.horizontal,e));const{same:h,other:f}=pOe(e,n,a,s);c|=h&&r.length,d=d||f,l.fullSize||r.push(a)}return c&&pg(r,e,n,s)||d}function Uy(t,e,n,s,r){t.top=n,t.left=e,t.right=e+s,t.bottom=n+r,t.width=s,t.height=r}function qO(t,e,n,s){const r=n.padding;let{x:i,y:o}=e;for(const a of t){const l=a.box,c=s[a.stack]||{count:1,placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const h=e.w*d,f=c.size||l.height;Jb(c.start)&&(o=c.start),l.fullSize?Uy(l,r.left,o,n.outerWidth-r.right-r.left,f):Uy(l,e.left+c.placed,o,h,f),c.start=o,c.placed+=h,o=l.bottom}else{const h=e.h*d,f=c.size||l.width;Jb(c.start)&&(i=c.start),l.fullSize?Uy(l,i,r.top,f,n.outerHeight-r.bottom-r.top):Uy(l,i,e.top+c.placed,f,h),c.start=i,c.placed+=h,i=l.right}}e.x=i,e.y=o}var ia={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,s){if(!t)return;const r=xa(t.options.layout.padding),i=Math.max(e-r.width,0),o=Math.max(n-r.height,0),a=fOe(t.boxes),l=a.vertical,c=a.horizontal;Qn(t.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const d=l.reduce((g,x)=>x.box.options&&x.box.options.display===!1?g:g+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:n,padding:r,availableWidth:i,availableHeight:o,vBoxMaxWidth:i/2/d,hBoxMaxHeight:o/2}),f=Object.assign({},r);wH(f,xa(s));const p=Object.assign({maxPadding:f,w:i,h:o,x:r.left,y:r.top},r),m=hOe(l.concat(c),h);pg(a.fullSize,p,h,m),pg(l,p,h,m),pg(c,p,h,m)&&pg(l,p,h,m),mOe(p),qO(a.leftAndTop,p,h,m),p.x+=p.w,p.y+=p.h,qO(a.rightAndBottom,p,h,m),t.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},Qn(a.chartArea,g=>{const x=g.box;Object.assign(x,t.chartArea),x.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class SH{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,s){}removeEventListener(e,n,s){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,s,r){return n=Math.max(0,n||e.width),s=s||e.height,{width:n,height:Math.max(0,r?Math.floor(n/r):s)}}isAttached(e){return!0}updateConfig(e){}}class xOe extends SH{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Av="$chartjs",yOe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},XO=t=>t===null||t==="";function vOe(t,e){const n=t.style,s=t.getAttribute("height"),r=t.getAttribute("width");if(t[Av]={initial:{height:s,width:r,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",XO(r)){const i=DO(t,"width");i!==void 0&&(t.width=i)}if(XO(s))if(t.style.height==="")t.height=t.width/(e||2);else{const i=DO(t,"height");i!==void 0&&(t.height=i)}return t}const CH=$De?{passive:!0}:!1;function bOe(t,e,n){t&&t.addEventListener(e,n,CH)}function wOe(t,e,n){t&&t.canvas&&t.canvas.removeEventListener(e,n,CH)}function SOe(t,e){const n=yOe[t.type]||t.type,{x:s,y:r}=Nd(t,e);return{type:n,chart:e,native:t,x:s!==void 0?s:null,y:r!==void 0?r:null}}function sw(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function COe(t,e,n){const s=t.canvas,r=new MutationObserver(i=>{let o=!1;for(const a of i)o=o||sw(a.addedNodes,s),o=o&&!sw(a.removedNodes,s);o&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}function kOe(t,e,n){const s=t.canvas,r=new MutationObserver(i=>{let o=!1;for(const a of i)o=o||sw(a.removedNodes,s),o=o&&!sw(a.addedNodes,s);o&&n()});return r.observe(document,{childList:!0,subtree:!0}),r}const L0=new Map;let YO=0;function kH(){const t=window.devicePixelRatio;t!==YO&&(YO=t,L0.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function NOe(t,e){L0.size||window.addEventListener("resize",kH),L0.set(t,e)}function TOe(t){L0.delete(t),L0.size||window.removeEventListener("resize",kH)}function _Oe(t,e,n){const s=t.canvas,r=s&&JR(s);if(!r)return;const i=rH((a,l)=>{const c=r.clientWidth;n(a,l),c<r.clientWidth&&n()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||i(c,d)});return o.observe(r),NOe(t,i),o}function NS(t,e,n){n&&n.disconnect(),e==="resize"&&TOe(t)}function EOe(t,e,n){const s=t.canvas,r=rH(i=>{t.ctx!==null&&n(SOe(i,t))},t);return bOe(s,e,r),r}class $Oe extends SH{acquireContext(e,n){const s=e&&e.getContext&&e.getContext("2d");return s&&s.canvas===e?(vOe(e,n),s):null}releaseContext(e){const n=e.canvas;if(!n[Av])return!1;const s=n[Av].initial;["height","width"].forEach(i=>{const o=s[i];Ds(o)?n.removeAttribute(i):n.setAttribute(i,o)});const r=s.style||{};return Object.keys(r).forEach(i=>{n.style[i]=r[i]}),n.width=n.width,delete n[Av],!0}addEventListener(e,n,s){this.removeEventListener(e,n);const r=e.$proxies||(e.$proxies={}),o={attach:COe,detach:kOe,resize:_Oe}[n]||EOe;r[n]=o(e,n,s)}removeEventListener(e,n){const s=e.$proxies||(e.$proxies={}),r=s[n];if(!r)return;({attach:NS,detach:NS,resize:NS}[n]||wOe)(e,n,r),s[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,s,r){return EDe(e,n,s,r)}isAttached(e){const n=e&&JR(e);return!!(n&&n.isConnected)}}function IOe(t){return!ZR()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?xOe:$Oe}var av;let Jh=(av=class{constructor(){vn(this,"x");vn(this,"y");vn(this,"active",!1);vn(this,"options");vn(this,"$animations")}tooltipPosition(e){const{x:n,y:s}=this.getProps(["x","y"],e);return{x:n,y:s}}hasValue(){return tw(this.x)&&tw(this.y)}getProps(e,n){const s=this.$animations;if(!n||!s)return this;const r={};return e.forEach(i=>{r[i]=s[i]&&s[i].active()?s[i]._to:this[i]}),r}},vn(av,"defaults",{}),vn(av,"defaultRoutes"),av);function ROe(t,e){const n=t.options.ticks,s=POe(t),r=Math.min(n.maxTicksLimit||s,s),i=n.major.enabled?jOe(e):[],o=i.length,a=i[0],l=i[o-1],c=[];if(o>r)return DOe(e,c,i,o/r),c;const d=AOe(i,e,r);if(o>0){let h,f;const p=o>1?Math.round((l-a)/(o-1)):null;for(Hy(e,c,d,Ds(p)?0:a-p,a),h=0,f=o-1;h<f;h++)Hy(e,c,d,i[h],i[h+1]);return Hy(e,c,d,l,Ds(p)?e.length:l+p),c}return Hy(e,c,d),c}function POe(t){const e=t.options.offset,n=t._tickSize(),s=t._length/n+(e?0:1),r=t._maxLength/n;return Math.floor(Math.min(s,r))}function AOe(t,e,n){const s=OOe(t),r=e.length/n;if(!s)return Math.max(r,1);const i=_je(s);for(let o=0,a=i.length-1;o<a;o++){const l=i[o];if(l>r)return l}return Math.max(r,1)}function jOe(t){const e=[];let n,s;for(n=0,s=t.length;n<s;n++)t[n].major&&e.push(n);return e}function DOe(t,e,n,s){let r=0,i=n[0],o;for(s=Math.ceil(s),o=0;o<t.length;o++)o===i&&(e.push(t[o]),r++,i=n[r*s])}function Hy(t,e,n,s,r){const i=In(s,0),o=Math.min(In(r,t.length),t.length);let a=0,l,c,d;for(n=Math.ceil(n),r&&(l=r-s,n=l/Math.floor(l/n)),d=i;d<0;)a++,d=Math.round(i+a*n);for(c=Math.max(i,0);c<o;c++)c===d&&(e.push(t[c]),a++,d=Math.round(i+a*n))}function OOe(t){const e=t.length;let n,s;if(e<2)return!1;for(s=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==s)return!1;return s}const FOe=t=>t==="left"?"right":t==="right"?"left":t,QO=(t,e,n)=>e==="top"||e==="left"?t[e]+n:t[e]-n,ZO=(t,e)=>Math.min(e||t,t);function JO(t,e){const n=[],s=t.length/e,r=t.length;let i=0;for(;i<r;i+=s)n.push(t[Math.floor(i)]);return n}function MOe(t,e,n){const s=t.ticks.length,r=Math.min(e,s-1),i=t._startPixel,o=t._endPixel,a=1e-6;let l=t.getPixelForTick(r),c;if(!(n&&(s===1?c=Math.max(l-i,o-l):e===0?c=(t.getPixelForTick(1)-l)/2:c=(l-t.getPixelForTick(r-1))/2,l+=r<e?c:-c,l<i-a||l>o+a)))return l}function LOe(t,e){Qn(t,n=>{const s=n.gc,r=s.length/2;let i;if(r>e){for(i=0;i<r;++i)delete n.data[s[i]];s.splice(0,r)}})}function Km(t){return t.drawTicks?t.tickLength:0}function eF(t,e){if(!t.display)return 0;const n=Qr(t.font,e),s=xa(t.padding);return(kr(t.text)?t.text.length:1)*n.lineHeight+s.height}function BOe(t,e){return Zh(t,{scale:e,type:"scale"})}function VOe(t,e,n){return Zh(t,{tick:n,index:e,type:"tick"})}function zOe(t,e,n){let s=HR(t);return(n&&e!=="right"||!n&&e==="right")&&(s=FOe(s)),s}function WOe(t,e,n,s){const{top:r,left:i,bottom:o,right:a,chart:l}=t,{chartArea:c,scales:d}=l;let h=0,f,p,m;const g=o-r,x=a-i;if(t.isHorizontal()){if(p=Hr(s,i,a),Bn(n)){const y=Object.keys(n)[0],v=n[y];m=d[y].getPixelForValue(v)+g-e}else n==="center"?m=(c.bottom+c.top)/2+g-e:m=QO(t,n,e);f=a-i}else{if(Bn(n)){const y=Object.keys(n)[0],v=n[y];p=d[y].getPixelForValue(v)-x+e}else n==="center"?p=(c.left+c.right)/2-x+e:p=QO(t,n,e);m=Hr(s,o,r),h=n==="left"?-Ma:Ma}return{titleX:p,titleY:m,maxWidth:f,rotation:h}}class km extends Jh{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:s,_suggestedMax:r}=this;return e=ol(e,Number.POSITIVE_INFINITY),n=ol(n,Number.NEGATIVE_INFINITY),s=ol(s,Number.POSITIVE_INFINITY),r=ol(r,Number.NEGATIVE_INFINITY),{min:ol(e,s),max:ol(n,r),minDefined:ga(e),maxDefined:ga(n)}}getMinMax(e){let{min:n,max:s,minDefined:r,maxDefined:i}=this.getUserBounds(),o;if(r&&i)return{min:n,max:s};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,e),r||(n=Math.min(n,o.min)),i||(s=Math.max(s,o.max));return n=i&&n>s?s:n,s=r&&n>s?n:s,{min:ol(n,ol(s,n)),max:ol(s,ol(n,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ns(this.options.beforeUpdate,[this])}update(e,n,s){const{beginAtZero:r,grace:i,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=oDe(this,i,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?JO(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=ROe(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,s;this.isHorizontal()?(n=this.left,s=this.right):(n=this.top,s=this.bottom,e=!e),this._startPixel=n,this._endPixel=s,this._reversePixels=e,this._length=s-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ns(this.options.afterUpdate,[this])}beforeSetDimensions(){Ns(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ns(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Ns(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ns(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let s,r,i;for(s=0,r=e.length;s<r;s++)i=e[s],i.label=Ns(n.callback,[i.value,s,e],this)}afterTickToLabelConversion(){Ns(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ns(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,s=ZO(this.ticks.length,e.ticks.maxTicksLimit),r=n.minRotation||0,i=n.maxRotation;let o=r,a,l,c;if(!this._isVisible()||!n.display||r>=i||s<=1||!this.isHorizontal()){this.labelRotation=r;return}const d=this._getLabelSizes(),h=d.widest.width,f=d.highest.height,p=bl(this.chart.width-h,0,this.maxWidth);a=e.offset?this.maxWidth/s:p/(s-1),h+6>a&&(a=p/(s-(e.offset?.5:1)),l=this.maxHeight-Km(e.grid)-n.padding-eF(e.title,this.chart.options.font),c=Math.sqrt(h*h+f*f),o=Rje(Math.min(Math.asin(bl((d.highest.height+6)/a,-1,1)),Math.asin(bl(l/c,-1,1))-Math.asin(bl(f/c,-1,1)))),o=Math.max(r,Math.min(i,o))),this.labelRotation=o}afterCalculateLabelRotation(){Ns(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ns(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:s,title:r,grid:i}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=eF(r,n.options.font);if(a?(e.width=this.maxWidth,e.height=Km(i)+l):(e.height=this.maxHeight,e.width=Km(i)+l),s.display&&this.ticks.length){const{first:c,last:d,widest:h,highest:f}=this._getLabelSizes(),p=s.padding*2,m=Ud(this.labelRotation),g=Math.cos(m),x=Math.sin(m);if(a){const y=s.mirror?0:x*h.width+g*f.height;e.height=Math.min(this.maxHeight,e.height+y+p)}else{const y=s.mirror?0:g*h.width+x*f.height;e.width=Math.min(this.maxWidth,e.width+y+p)}this._calculatePadding(c,d,x,g)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,s,r){const{ticks:{align:i,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,p=0;l?c?(f=r*e.width,p=s*n.height):(f=s*e.height,p=r*n.width):i==="start"?p=n.width:i==="end"?f=e.width:i!=="inner"&&(f=e.width/2,p=n.width/2),this.paddingLeft=Math.max((f-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((p-h+o)*this.width/(this.width-h),0)}else{let d=n.height/2,h=e.height/2;i==="start"?(d=0,h=e.height):i==="end"&&(d=n.height,h=0),this.paddingTop=d+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ns(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,s;for(n=0,s=e.length;n<s;n++)Ds(e[n].label)&&(e.splice(n,1),s--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let s=this.ticks;n<s.length&&(s=JO(s,n)),this._labelSizes=e=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,n,s){const{ctx:r,_longestTextCache:i}=this,o=[],a=[],l=Math.floor(n/ZO(n,s));let c=0,d=0,h,f,p,m,g,x,y,v,S,C,k;for(h=0;h<n;h+=l){if(m=e[h].label,g=this._resolveTickFontOptions(h),r.font=x=g.string,y=i[x]=i[x]||{data:{},gc:[]},v=g.lineHeight,S=C=0,!Ds(m)&&!kr(m))S=IO(r,y.data,y.gc,S,m),C=v;else if(kr(m))for(f=0,p=m.length;f<p;++f)k=m[f],!Ds(k)&&!kr(k)&&(S=IO(r,y.data,y.gc,S,k),C+=v);o.push(S),a.push(C),c=Math.max(S,c),d=Math.max(C,d)}LOe(i,n);const T=o.indexOf(c),_=a.indexOf(d),$=R=>({width:o[R]||0,height:a[R]||0});return{first:$(0),last:$(n-1),widest:$(T),highest:$(_),widths:o,heights:a}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return jje(this._alignToPixels?xd(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const s=n[e];return s.$context||(s.$context=VOe(this.getContext(),e,s))}return this.$context||(this.$context=BOe(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=Ud(this.labelRotation),s=Math.abs(Math.cos(n)),r=Math.abs(Math.sin(n)),i=this._getLabelSizes(),o=e.autoSkipPadding||0,a=i?i.widest.width+o:0,l=i?i.highest.height+o:0;return this.isHorizontal()?l*s>a*r?a/s:l/r:l*r<a*s?l/s:a/r}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,s=this.chart,r=this.options,{grid:i,position:o,border:a}=r,l=i.offset,c=this.isHorizontal(),h=this.ticks.length+(l?1:0),f=Km(i),p=[],m=a.setContext(this.getContext()),g=m.display?m.width:0,x=g/2,y=function(z){return xd(s,z,g)};let v,S,C,k,T,_,$,R,A,j,F,L;if(o==="top")v=y(this.bottom),_=this.bottom-f,R=v-x,j=y(e.top)+x,L=e.bottom;else if(o==="bottom")v=y(this.top),j=e.top,L=y(e.bottom)-x,_=v+x,R=this.top+f;else if(o==="left")v=y(this.right),T=this.right-f,$=v-x,A=y(e.left)+x,F=e.right;else if(o==="right")v=y(this.left),A=e.left,F=y(e.right)-x,T=v+x,$=this.left+f;else if(n==="x"){if(o==="center")v=y((e.top+e.bottom)/2+.5);else if(Bn(o)){const z=Object.keys(o)[0],re=o[z];v=y(this.chart.scales[z].getPixelForValue(re))}j=e.top,L=e.bottom,_=v+x,R=_+f}else if(n==="y"){if(o==="center")v=y((e.left+e.right)/2);else if(Bn(o)){const z=Object.keys(o)[0],re=o[z];v=y(this.chart.scales[z].getPixelForValue(re))}T=v-x,$=T-f,A=e.left,F=e.right}const M=In(r.ticks.maxTicksLimit,h),q=Math.max(1,Math.ceil(h/M));for(S=0;S<h;S+=q){const z=this.getContext(S),re=i.setContext(z),U=a.setContext(z),G=re.lineWidth,xe=re.color,Ce=U.dash||[],De=U.dashOffset,fe=re.tickWidth,ee=re.tickColor,Pe=re.tickBorderDash||[],Re=re.tickBorderDashOffset;C=MOe(this,S,l),C!==void 0&&(k=xd(s,C,G),c?T=$=A=F=k:_=R=j=L=k,p.push({tx1:T,ty1:_,tx2:$,ty2:R,x1:A,y1:j,x2:F,y2:L,width:G,color:xe,borderDash:Ce,borderDashOffset:De,tickWidth:fe,tickColor:ee,tickBorderDash:Pe,tickBorderDashOffset:Re}))}return this._ticksLength=h,this._borderValue=v,p}_computeLabelItems(e){const n=this.axis,s=this.options,{position:r,ticks:i}=s,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:h}=i,f=Km(s.grid),p=f+d,m=h?-d:p,g=-Ud(this.labelRotation),x=[];let y,v,S,C,k,T,_,$,R,A,j,F,L="middle";if(r==="top")T=this.bottom-m,_=this._getXAxisLabelAlignment();else if(r==="bottom")T=this.top+m,_=this._getXAxisLabelAlignment();else if(r==="left"){const q=this._getYAxisLabelAlignment(f);_=q.textAlign,k=q.x}else if(r==="right"){const q=this._getYAxisLabelAlignment(f);_=q.textAlign,k=q.x}else if(n==="x"){if(r==="center")T=(e.top+e.bottom)/2+p;else if(Bn(r)){const q=Object.keys(r)[0],z=r[q];T=this.chart.scales[q].getPixelForValue(z)+p}_=this._getXAxisLabelAlignment()}else if(n==="y"){if(r==="center")k=(e.left+e.right)/2-p;else if(Bn(r)){const q=Object.keys(r)[0],z=r[q];k=this.chart.scales[q].getPixelForValue(z)}_=this._getYAxisLabelAlignment(f).textAlign}n==="y"&&(l==="start"?L="top":l==="end"&&(L="bottom"));const M=this._getLabelSizes();for(y=0,v=a.length;y<v;++y){S=a[y],C=S.label;const q=i.setContext(this.getContext(y));$=this.getPixelForTick(y)+i.labelOffset,R=this._resolveTickFontOptions(y),A=R.lineHeight,j=kr(C)?C.length:1;const z=j/2,re=q.color,U=q.textStrokeColor,G=q.textStrokeWidth;let xe=_;o?(k=$,_==="inner"&&(y===v-1?xe=this.options.reverse?"left":"right":y===0?xe=this.options.reverse?"right":"left":xe="center"),r==="top"?c==="near"||g!==0?F=-j*A+A/2:c==="center"?F=-M.highest.height/2-z*A+A:F=-M.highest.height+A/2:c==="near"||g!==0?F=A/2:c==="center"?F=M.highest.height/2-z*A:F=M.highest.height-j*A,h&&(F*=-1),g!==0&&!q.showLabelBackdrop&&(k+=A/2*Math.sin(g))):(T=$,F=(1-j)*A/2);let Ce;if(q.showLabelBackdrop){const De=xa(q.backdropPadding),fe=M.heights[y],ee=M.widths[y];let Pe=F-De.top,Re=0-De.left;switch(L){case"middle":Pe-=fe/2;break;case"bottom":Pe-=fe;break}switch(_){case"center":Re-=ee/2;break;case"right":Re-=ee;break;case"inner":y===v-1?Re-=ee:y>0&&(Re-=ee/2);break}Ce={left:Re,top:Pe,width:ee+De.width,height:fe+De.height,color:q.backdropColor}}x.push({label:C,font:R,textOffset:F,options:{rotation:g,color:re,strokeColor:U,strokeWidth:G,textAlign:xe,textBaseline:L,translation:[k,T],backdrop:Ce}})}return x}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-Ud(this.labelRotation))return e==="top"?"left":"right";let r="center";return n.align==="start"?r="left":n.align==="end"?r="right":n.align==="inner"&&(r="inner"),r}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:s,mirror:r,padding:i}}=this.options,o=this._getLabelSizes(),a=e+i,l=o.widest.width;let c,d;return n==="left"?r?(d=this.right+i,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?r?(d=this.left+i,s==="near"?c="right":s==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,s==="near"?c="left":s==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:s,top:r,width:i,height:o}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(s,r,i,o),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const r=this.ticks.findIndex(i=>i.value===e);return r>=0?n.setContext(this.getContext(r)).lineWidth:0}drawGrid(e){const n=this.options.grid,s=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,o;const a=(l,c,d)=>{!d.width||!d.color||(s.save(),s.lineWidth=d.width,s.strokeStyle=d.color,s.setLineDash(d.borderDash||[]),s.lineDashOffset=d.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(n.display)for(i=0,o=r.length;i<o;++i){const l=r[i];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{border:s,grid:r}}=this,i=s.setContext(this.getContext()),o=s.display?i.width:0;if(!o)return;const a=r.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,h,f;this.isHorizontal()?(c=xd(e,this.left,o)-o/2,d=xd(e,this.right,a)+a/2,h=f=l):(h=xd(e,this.top,o)-o/2,f=xd(e,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.beginPath(),n.moveTo(c,h),n.lineTo(d,f),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const s=this.ctx,r=this._computeLabelArea();r&&KR(s,r);const i=this.getLabelItems(e);for(const o of i){const a=o.options,l=o.font,c=o.label,d=o.textOffset;M0(s,c,0,d,l,a)}r&&qR(s)}drawTitle(){const{ctx:e,options:{position:n,title:s,reverse:r}}=this;if(!s.display)return;const i=Qr(s.font),o=xa(s.padding),a=s.align;let l=i.lineHeight/2;n==="bottom"||n==="center"||Bn(n)?(l+=o.bottom,kr(s.text)&&(l+=i.lineHeight*(s.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:h,rotation:f}=WOe(this,l,n,a);M0(e,s.text,0,0,i,{color:s.color,maxWidth:h,rotation:f,textAlign:zOe(a,n,r),textBaseline:"middle",translation:[c,d]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,s=In(e.grid&&e.grid.z,-1),r=In(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==km.prototype.draw?[{z:n,draw:i=>{this.draw(i)}}]:[{z:s,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:r,draw:()=>{this.drawBorder()}},{z:n,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",r=[];let i,o;for(i=0,o=n.length;i<o;++i){const a=n[i];a[s]===this.id&&(!e||a.type===e)&&r.push(a)}return r}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return Qr(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Gy{constructor(e,n,s){this.type=e,this.scope=n,this.override=s,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let s;GOe(n)&&(s=this.register(n));const r=this.items,i=e.id,o=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in r||(r[i]=e,UOe(e,o,s),this.override&&tr.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const n=this.items,s=e.id,r=this.scope;s in n&&delete n[s],r&&s in tr[r]&&(delete tr[r][s],this.override&&delete Eh[s])}}function UOe(t,e,n){const s=O0(Object.create(null),[n?tr.get(n):{},tr.get(e),t.defaults]);tr.set(e,s),t.defaultRoutes&&HOe(e,t.defaultRoutes),t.descriptors&&tr.describe(e,t.descriptors)}function HOe(t,e){Object.keys(e).forEach(n=>{const s=n.split("."),r=s.pop(),i=[t].concat(s).join("."),o=e[n].split("."),a=o.pop(),l=o.join(".");tr.route(i,r,l,a)})}function GOe(t){return"id"in t&&"defaults"in t}class KOe{constructor(){this.controllers=new Gy(Pv,"datasets",!0),this.elements=new Gy(Jh,"elements"),this.plugins=new Gy(Object,"plugins"),this.scales=new Gy(km,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,s){[...n].forEach(r=>{const i=s||this._getRegistryForType(r);s||i.isForType(r)||i===this.plugins&&r.id?this._exec(e,i,r):Qn(r,o=>{const a=s||this._getRegistryForType(o);this._exec(e,a,o)})})}_exec(e,n,s){const r=WR(e);Ns(s["before"+r],[],s),n[e](s),Ns(s["after"+r],[],s)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const s=this._typedRegistries[n];if(s.isForType(e))return s}return this.plugins}_get(e,n,s){const r=n.get(e);if(r===void 0)throw new Error('"'+e+'" is not a registered '+s+".");return r}}var ul=new KOe;class qOe{constructor(){this._init=[]}notify(e,n,s,r){n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const i=r?this._descriptors(e).filter(r):this._descriptors(e),o=this._notify(i,e,n,s);return n==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall")),o}_notify(e,n,s,r){r=r||{};for(const i of e){const o=i.plugin,a=o[s],l=[n,r,i.options];if(Ns(a,l,o)===!1&&r.cancelable)return!1}return!0}invalidate(){Ds(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const s=e&&e.config,r=In(s.options&&s.options.plugins,{}),i=XOe(s);return r===!1&&!n?[]:QOe(e,i,r,n)}_notifyStateChanges(e){const n=this._oldCache||[],s=this._cache,r=(i,o)=>i.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(r(n,s),e,"stop"),this._notify(r(s,n),e,"start")}}function XOe(t){const e={},n=[],s=Object.keys(ul.plugins.items);for(let i=0;i<s.length;i++)n.push(ul.getPlugin(s[i]));const r=t.plugins||[];for(let i=0;i<r.length;i++){const o=r[i];n.indexOf(o)===-1&&(n.push(o),e[o.id]=!0)}return{plugins:n,localIds:e}}function YOe(t,e){return!e&&t===!1?null:t===!0?{}:t}function QOe(t,{plugins:e,localIds:n},s,r){const i=[],o=t.getContext();for(const a of e){const l=a.id,c=YOe(s[l],r);c!==null&&i.push({plugin:a,options:ZOe(t.config,{plugin:a,local:n[l]},c,o)})}return i}function ZOe(t,{plugin:e,local:n},s,r){const i=t.pluginScopeKeys(e),o=t.getOptionScopes(s,i);return n&&e.defaults&&o.push(e.defaults),t.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function $N(t,e){const n=tr.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function JOe(t,e){let n=t;return t==="_index_"?n=e:t==="_value_"&&(n=e==="x"?"y":"x"),n}function eFe(t,e){return t===e?"_index_":"_value_"}function tF(t){if(t==="x"||t==="y"||t==="r")return t}function tFe(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function IN(t,...e){if(tF(t))return t;for(const n of e){const s=n.axis||tFe(n.position)||t.length>1&&tF(t[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function nF(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function nFe(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(s=>s.xAxisID===t||s.yAxisID===t);if(n.length)return nF(t,"x",n[0])||nF(t,"y",n[0])}return{}}function sFe(t,e){const n=Eh[t.type]||{scales:{}},s=e.scales||{},r=$N(t.type,e),i=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!Bn(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=IN(o,a,nFe(o,t),tr.scales[a.type]),c=eFe(l,r),d=n.scales||{};i[o]=Lg(Object.create(null),[{axis:l},a,d[l],d[c]])}),t.data.datasets.forEach(o=>{const a=o.type||t.type,l=o.indexAxis||$N(a,e),d=(Eh[a]||{}).scales||{};Object.keys(d).forEach(h=>{const f=JOe(h,l),p=o[f+"AxisID"]||f;i[p]=i[p]||Object.create(null),Lg(i[p],[{axis:f},s[p],d[h]])})}),Object.keys(i).forEach(o=>{const a=i[o];Lg(a,[tr.scales[a.type],tr.scale])}),i}function NH(t){const e=t.options||(t.options={});e.plugins=In(e.plugins,{}),e.scales=sFe(t,e)}function TH(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function rFe(t){return t=t||{},t.data=TH(t.data),NH(t),t}const sF=new Map,_H=new Set;function Ky(t,e){let n=sF.get(t);return n||(n=e(),sF.set(t,n),_H.add(n)),n}const qm=(t,e,n)=>{const s=Zb(e,n);s!==void 0&&t.add(s)};class iFe{constructor(e){this._config=rFe(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=TH(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),NH(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Ky(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return Ky(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return Ky(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,s=this.type;return Ky(`${s}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const s=this._scopeCache;let r=s.get(e);return(!r||n)&&(r=new Map,s.set(e,r)),r}getOptionScopes(e,n,s){const{options:r,type:i}=this,o=this._cachedScopes(e,s),a=o.get(n);if(a)return a;const l=new Set;n.forEach(d=>{e&&(l.add(e),d.forEach(h=>qm(l,e,h))),d.forEach(h=>qm(l,r,h)),d.forEach(h=>qm(l,Eh[i]||{},h)),d.forEach(h=>qm(l,tr,h)),d.forEach(h=>qm(l,TN,h))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),_H.has(n)&&o.set(n,c),c}chartOptionScopes(){const{options:e,type:n}=this;return[e,Eh[n]||{},tr.datasets[n]||{},{type:n},tr,TN]}resolveNamedOptions(e,n,s,r=[""]){const i={$shared:!0},{resolver:o,subPrefixes:a}=rF(this._resolverCache,e,r);let l=o;if(aFe(o,n)){i.$shared=!1,s=qu(s)?s():s;const c=this.createResolver(e,s,a);l=Hp(o,s,c)}for(const c of n)i[c]=l[c];return i}createResolver(e,n,s=[""],r){const{resolver:i}=rF(this._resolverCache,e,s);return Bn(n)?Hp(i,n,void 0,r):i}}function rF(t,e,n){let s=t.get(e);s||(s=new Map,t.set(e,s));const r=n.join();let i=s.get(r);return i||(i={resolver:XR(e,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},s.set(r,i)),i}const oFe=t=>Bn(t)&&Object.getOwnPropertyNames(t).some(e=>qu(t[e]));function aFe(t,e){const{isScriptable:n,isIndexable:s}=uH(t);for(const r of e){const i=n(r),o=s(r),a=(o||i)&&t[r];if(i&&(qu(a)||oFe(a))||o&&kr(a))return!0}return!1}var lFe="4.4.9";const cFe=["top","bottom","left","right","chartArea"];function iF(t,e){return t==="top"||t==="bottom"||cFe.indexOf(t)===-1&&e==="x"}function oF(t,e){return function(n,s){return n[t]===s[t]?n[e]-s[e]:n[t]-s[t]}}function aF(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),Ns(n&&n.onComplete,[t],e)}function uFe(t){const e=t.chart,n=e.options.animation;Ns(n&&n.onProgress,[t],e)}function EH(t){return ZR()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const jv={},lF=t=>{const e=EH(t);return Object.values(jv).filter(n=>n.canvas===e).pop()};function dFe(t,e,n){const s=Object.keys(t);for(const r of s){const i=+r;if(i>=e){const o=t[r];delete t[r],(n>0||i>e)&&(t[i+n]=o)}}}function hFe(t,e,n,s){return!n||t.type==="mouseout"?null:s?e:t}class nu{static register(...e){ul.add(...e),cF()}static unregister(...e){ul.remove(...e),cF()}constructor(e,n){const s=this.config=new iFe(n),r=EH(e),i=lF(r);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const o=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||IOe(r)),this.platform.updateConfig(s);const a=this.platform.acquireContext(r,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=yje(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new qOe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Lje(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],jv[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Ql.listen(this,"complete",aF),Ql.listen(this,"progress",uFe),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:s,height:r,_aspectRatio:i}=this;return Ds(e)?n&&i?i:r?s/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return ul}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():jO(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return RO(this.canvas,this.ctx),this}stop(){return Ql.stop(this),this}resize(e,n){Ql.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const s=this.options,r=this.canvas,i=s.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(r,e,n,i),a=s.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,jO(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),Ns(s.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};Qn(n,(s,r)=>{s.id=r})}buildOrUpdateScales(){const e=this.options,n=e.scales,s=this.scales,r=Object.keys(s).reduce((o,a)=>(o[a]=!1,o),{});let i=[];n&&(i=i.concat(Object.keys(n).map(o=>{const a=n[o],l=IN(o,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),Qn(i,o=>{const a=o.options,l=a.id,c=IN(l,a),d=In(a.type,o.dtype);(a.position===void 0||iF(a.position,c)!==iF(o.dposition))&&(a.position=o.dposition),r[l]=!0;let h=null;if(l in s&&s[l].type===d)h=s[l];else{const f=ul.getScale(d);h=new f({id:l,type:d,ctx:this.ctx,chart:this}),s[h.id]=h}h.init(a,e)}),Qn(r,(o,a)=>{o||delete s[a]}),Qn(s,o=>{ia.configure(this,o,o.options),ia.addBox(this,o)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,s=e.length;if(e.sort((r,i)=>r.index-i.index),s>n){for(let r=n;r<s;++r)this._destroyDatasetMeta(r);e.splice(n,s-n)}this._sortedMetasets=e.slice(0).sort(oF("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((s,r)=>{n.filter(i=>i===s._dataset).length===0&&this._destroyDatasetMeta(r)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let s,r;for(this._removeUnreferencedMetasets(),s=0,r=n.length;s<r;s++){const i=n[s];let o=this.getDatasetMeta(s);const a=i.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(s),o=this.getDatasetMeta(s)),o.type=a,o.indexAxis=i.indexAxis||$N(a,this.options),o.order=i.order||0,o.index=s,o.label=""+i.label,o.visible=this.isDatasetVisible(s),o.controller)o.controller.updateIndex(s),o.controller.linkScales();else{const l=ul.getController(a),{datasetElementType:c,dataElementType:d}=tr.datasets[a];Object.assign(l,{dataElementType:ul.getElement(d),datasetElementType:c&&ul.getElement(c)}),o.controller=new l(this,s),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){Qn(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const s=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!s.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:h}=this.getDatasetMeta(c),f=!r&&i.indexOf(h)===-1;h.buildOrUpdateElements(f),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=s.layout.autoPadding?o:0,this._updateLayout(o),r||Qn(i,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(oF("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){Qn(this.scales,e=>{ia.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),s=new Set(e.events);(!wO(n,s)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:s,start:r,count:i}of n){const o=s==="_removeElements"?-i:i;dFe(e,r,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,s=i=>new Set(e.filter(o=>o[0]===i).map((o,a)=>a+","+o.splice(1).join(","))),r=s(0);for(let i=1;i<n;i++)if(!wO(r,s(i)))return;return Array.from(r).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ia.update(this,this.width,this.height,e);const n=this.chartArea,s=n.width<=0||n.height<=0;this._layers=[],Qn(this.boxes,r=>{s&&r.position==="chartArea"||(r.configure&&r.configure(),this._layers.push(...r._layers()))},this),this._layers.forEach((r,i)=>{r._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,s=this.data.datasets.length;n<s;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,s=this.data.datasets.length;n<s;++n)this._updateDataset(n,qu(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const s=this.getDatasetMeta(e),r={meta:s,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",r)!==!1&&(s.controller._update(n),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Ql.has(this)?this.attached&&!Ql.running(this)&&Ql.start(this):(this.draw(),aF({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:s,height:r}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(s,r)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,s=[];let r,i;for(r=0,i=n.length;r<i;++r){const o=n[r];(!e||o.visible)&&s.push(o)}return s}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,s={meta:e,index:e.index,cancelable:!0},r=WDe(this,e);this.notifyPlugins("beforeDatasetDraw",s)!==!1&&(r&&KR(n,r),e.controller.draw(),r&&qR(n),s.cancelable=!1,this.notifyPlugins("afterDatasetDraw",s))}isPointInArea(e){return F0(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,n,s,r){const i=cOe.modes[n];return typeof i=="function"?i(this,e,s,r):[]}getDatasetMeta(e){const n=this.data.datasets[e],s=this._metasets;let r=s.filter(i=>i&&i._dataset===n).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},s.push(r)),r}getContext(){return this.$context||(this.$context=Zh(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const s=this.getDatasetMeta(e);return typeof s.hidden=="boolean"?!s.hidden:!n.hidden}setDatasetVisibility(e,n){const s=this.getDatasetMeta(e);s.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,s){const r=s?"show":"hide",i=this.getDatasetMeta(e),o=i.controller._resolveAnimations(void 0,r);Jb(n)?(i.data[n].hidden=!s,this.update()):(this.setDatasetVisibility(e,s),o.update(i,{visible:s}),this.update(a=>a.datasetIndex===e?r:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),Ql.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),RO(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete jv[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,s=(i,o)=>{n.addEventListener(this,i,o),e[i]=o},r=(i,o,a)=>{i.offsetX=o,i.offsetY=a,this._eventHandler(i)};Qn(this.options.events,i=>s(i,r))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,s=(l,c)=>{n.addEventListener(this,l,c),e[l]=c},r=(l,c)=>{e[l]&&(n.removeEventListener(this,l,c),delete e[l])},i=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{r("attach",a),this.attached=!0,this.resize(),s("resize",i),s("detach",o)};o=()=>{this.attached=!1,r("resize",i),this._stop(),this._resize(0,0),s("attach",a)},n.isAttached(this.canvas)?a():o()}unbindEvents(){Qn(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},Qn(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,s){const r=s?"set":"remove";let i,o,a,l;for(n==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+r+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){o=e[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[r+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],s=e.map(({datasetIndex:i,index:o})=>{const a=this.getDatasetMeta(i);if(!a)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:a.data[o],index:o}});!Yb(s,n)&&(this._active=s,this._lastEvent=null,this._updateHoverStyles(s,n))}notifyPlugins(e,n,s){return this._plugins.notify(this,e,n,s)}isPluginEnabled(e){return this._plugins._cache.filter(n=>n.plugin.id===e).length===1}_updateHoverStyles(e,n,s){const r=this.options.hover,i=(l,c)=>l.filter(d=>!c.some(h=>d.datasetIndex===h.datasetIndex&&d.index===h.index)),o=i(n,e),a=s?e:i(e,n);o.length&&this.updateHoverStyle(o,r.mode,!1),a.length&&r.mode&&this.updateHoverStyle(a,r.mode,!0)}_eventHandler(e,n){const s={event:e,replay:n,cancelable:!0,inChartArea:this.isPointInArea(e)},r=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",s,r)===!1)return;const i=this._handleEvent(e,n,s.inChartArea);return s.cancelable=!1,this.notifyPlugins("afterEvent",s,r),(i||s.changed)&&this.render(),this}_handleEvent(e,n,s){const{_active:r=[],options:i}=this,o=n,a=this._getActiveElements(e,r,s,o),l=kje(e),c=hFe(e,this._lastEvent,s,l);s&&(this._lastEvent=null,Ns(i.onHover,[e,a,this],this),l&&Ns(i.onClick,[e,a,this],this));const d=!Yb(a,r);return(d||n)&&(this._active=a,this._updateHoverStyles(a,r,n)),this._lastEvent=c,d}_getActiveElements(e,n,s,r){if(e.type==="mouseout")return[];if(!s)return n;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,r)}}vn(nu,"defaults",tr),vn(nu,"instances",jv),vn(nu,"overrides",Eh),vn(nu,"registry",ul),vn(nu,"version",lFe),vn(nu,"getChart",lF);function cF(){return Qn(nu.instances,t=>t._plugins.invalidate())}function $H(t,e,n=e){t.lineCap=In(n.borderCapStyle,e.borderCapStyle),t.setLineDash(In(n.borderDash,e.borderDash)),t.lineDashOffset=In(n.borderDashOffset,e.borderDashOffset),t.lineJoin=In(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=In(n.borderWidth,e.borderWidth),t.strokeStyle=In(n.borderColor,e.borderColor)}function fFe(t,e,n){t.lineTo(n.x,n.y)}function pFe(t){return t.stepped?Yje:t.tension||t.cubicInterpolationMode==="monotone"?Qje:fFe}function IH(t,e,n={}){const s=t.length,{start:r=0,end:i=s-1}=n,{start:o,end:a}=e,l=Math.max(r,o),c=Math.min(i,a),d=r<o&&i<o||r>a&&i>a;return{count:s,start:l,loop:e.loop,ilen:c<l&&!d?s+c-l:c-l}}function mFe(t,e,n,s){const{points:r,options:i}=e,{count:o,start:a,loop:l,ilen:c}=IH(r,n,s),d=pFe(i);let{move:h=!0,reverse:f}=s||{},p,m,g;for(p=0;p<=c;++p)m=r[(a+(f?c-p:p))%o],!m.skip&&(h?(t.moveTo(m.x,m.y),h=!1):d(t,g,m,f,i.stepped),g=m);return l&&(m=r[(a+(f?c:0))%o],d(t,g,m,f,i.stepped)),!!l}function gFe(t,e,n,s){const r=e.points,{count:i,start:o,ilen:a}=IH(r,n,s),{move:l=!0,reverse:c}=s||{};let d=0,h=0,f,p,m,g,x,y;const v=C=>(o+(c?a-C:C))%i,S=()=>{g!==x&&(t.lineTo(d,x),t.lineTo(d,g),t.lineTo(d,y))};for(l&&(p=r[v(0)],t.moveTo(p.x,p.y)),f=0;f<=a;++f){if(p=r[v(f)],p.skip)continue;const C=p.x,k=p.y,T=C|0;T===m?(k<g?g=k:k>x&&(x=k),d=(h*d+C)/++h):(S(),t.lineTo(C,k),m=T,h=0,g=x=k),y=k}S()}function RN(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?gFe:mFe}function xFe(t){return t.stepped?IDe:t.tension||t.cubicInterpolationMode==="monotone"?RDe:Td}function yFe(t,e,n,s){let r=e._path;r||(r=e._path=new Path2D,e.path(r,n,s)&&r.closePath()),$H(t,e.options),t.stroke(r)}function vFe(t,e,n,s){const{segments:r,options:i}=e,o=RN(e);for(const a of r)$H(t,i,a.style),t.beginPath(),o(t,e,a,{start:n,end:n+s-1})&&t.closePath(),t.stroke()}const bFe=typeof Path2D=="function";function wFe(t,e,n,s){bFe&&!e.options.segment?yFe(t,e,n,s):vFe(t,e,n,s)}class mg extends Jh{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const r=s.spanGaps?this._loop:this._fullLoop;SDe(this._points,s,e,r,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=LDe(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,s=e.length;return s&&n[e[s-1].end]}interpolate(e,n){const s=this.options,r=e[n],i=this.points,o=ODe(this,{property:n,start:r,end:r});if(!o.length)return;const a=[],l=xFe(s);let c,d;for(c=0,d=o.length;c<d;++c){const{start:h,end:f}=o[c],p=i[h],m=i[f];if(p===m){a.push(p);continue}const g=Math.abs((r-p[n])/(m[n]-p[n])),x=l(p,m,g,s.stepped);x[n]=e[n],a.push(x)}return a.length===1?a[0]:a}pathSegment(e,n,s){return RN(this)(e,this,n,s)}path(e,n,s){const r=this.segments,i=RN(this);let o=this._loop;n=n||0,s=s||this.points.length-n;for(const a of r)o&=i(e,this,a,{start:n,end:n+s-1});return!!o}draw(e,n,s,r){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),wFe(e,this,s,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}vn(mg,"id","line"),vn(mg,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),vn(mg,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),vn(mg,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function uF(t,e,n,s){const r=t.options,{[n]:i}=t.getProps([n],s);return Math.abs(e-i)<r.radius+r.hitRadius}class Dv extends Jh{constructor(n){super();vn(this,"parsed");vn(this,"skip");vn(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,s,r){const i=this.options,{x:o,y:a}=this.getProps(["x","y"],r);return Math.pow(n-o,2)+Math.pow(s-a,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(n,s){return uF(this,n,"x",s)}inYRange(n,s){return uF(this,n,"y",s)}getCenterPoint(n){const{x:s,y:r}=this.getProps(["x","y"],n);return{x:s,y:r}}size(n){n=n||this.options||{};let s=n.radius||0;s=Math.max(s,s&&n.hoverRadius||0);const r=s&&n.borderWidth||0;return(s+r)*2}draw(n,s){const r=this.options;this.skip||r.radius<.1||!F0(this,s,this.size(r)/2)||(n.strokeStyle=r.borderColor,n.lineWidth=r.borderWidth,n.fillStyle=r.backgroundColor,_N(n,r,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}vn(Dv,"id","point"),vn(Dv,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),vn(Dv,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const dF=(t,e)=>{let{boxHeight:n=e,boxWidth:s=e}=t;return t.usePointStyle&&(n=Math.min(n,e),s=t.pointStyleWidth||Math.min(s,e)),{boxWidth:s,boxHeight:n,itemHeight:Math.max(e,n)}},SFe=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class hF extends Jh{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,s){this.maxWidth=e,this.maxHeight=n,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=Ns(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(s=>e.filter(s,this.chart.data))),e.sort&&(n=n.sort((s,r)=>e.sort(s,r,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const s=e.labels,r=Qr(s.font),i=r.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=dF(s,i);let c,d;n.font=r.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,i,a,l)+10):(d=this.maxHeight,c=this._fitCols(o,r,a,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(d,e.maxHeight||this.maxHeight)}_fitRows(e,n,s,r){const{ctx:i,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=r+a;let h=e;i.textAlign="left",i.textBaseline="middle";let f=-1,p=-d;return this.legendItems.forEach((m,g)=>{const x=s+n/2+i.measureText(m.text).width;(g===0||c[c.length-1]+x+2*a>o)&&(h+=d,c[c.length-(g>0?0:1)]=0,p+=d,f++),l[g]={left:0,top:p,row:f,width:x,height:r},c[c.length-1]+=x+a}),h}_fitCols(e,n,s,r){const{ctx:i,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-e;let h=a,f=0,p=0,m=0,g=0;return this.legendItems.forEach((x,y)=>{const{itemWidth:v,itemHeight:S}=CFe(s,n,i,x,r);y>0&&p+S+2*a>d&&(h+=f+a,c.push({width:f,height:p}),m+=f+a,g++,f=p=0),l[y]={left:m,top:p,col:g,width:v,height:S},f=Math.max(f,v),p+=S+a}),h+=f,c.push({width:f,height:p}),h}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:s,labels:{padding:r},rtl:i}}=this,o=op(i,this.left,this.width);if(this.isHorizontal()){let a=0,l=Hr(s,this.left+r,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=Hr(s,this.left+r,this.right-this.lineWidths[a])),c.top+=this.top+e+r,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+r}else{let a=0,l=Hr(s,this.top+e+r,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=Hr(s,this.top+e+r,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+r,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+r}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;KR(e,this),this._draw(),qR(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:s,ctx:r}=this,{align:i,labels:o}=e,a=tr.color,l=op(e.rtl,this.left,this.width),c=Qr(o.font),{padding:d}=o,h=c.size,f=h/2;let p;this.drawTitle(),r.textAlign=l.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=c.string;const{boxWidth:m,boxHeight:g,itemHeight:x}=dF(o,h),y=function(T,_,$){if(isNaN(m)||m<=0||isNaN(g)||g<0)return;r.save();const R=In($.lineWidth,1);if(r.fillStyle=In($.fillStyle,a),r.lineCap=In($.lineCap,"butt"),r.lineDashOffset=In($.lineDashOffset,0),r.lineJoin=In($.lineJoin,"miter"),r.lineWidth=R,r.strokeStyle=In($.strokeStyle,a),r.setLineDash(In($.lineDash,[])),o.usePointStyle){const A={radius:g*Math.SQRT2/2,pointStyle:$.pointStyle,rotation:$.rotation,borderWidth:R},j=l.xPlus(T,m/2),F=_+f;lH(r,A,j,F,o.pointStyleWidth&&m)}else{const A=_+Math.max((h-g)/2,0),j=l.leftForLtr(T,m),F=Wg($.borderRadius);r.beginPath(),Object.values(F).some(L=>L!==0)?EN(r,{x:j,y:A,w:m,h:g,radius:F}):r.rect(j,A,m,g),r.fill(),R!==0&&r.stroke()}r.restore()},v=function(T,_,$){M0(r,$.text,T,_+x/2,c,{strikethrough:$.hidden,textAlign:l.textAlign($.textAlign)})},S=this.isHorizontal(),C=this._computeTitleHeight();S?p={x:Hr(i,this.left+d,this.right-s[0]),y:this.top+d+C,line:0}:p={x:this.left+d,y:Hr(i,this.top+C+d,this.bottom-n[0].height),line:0},mH(this.ctx,e.textDirection);const k=x+d;this.legendItems.forEach((T,_)=>{r.strokeStyle=T.fontColor,r.fillStyle=T.fontColor;const $=r.measureText(T.text).width,R=l.textAlign(T.textAlign||(T.textAlign=o.textAlign)),A=m+f+$;let j=p.x,F=p.y;l.setWidth(this.width),S?_>0&&j+A+d>this.right&&(F=p.y+=k,p.line++,j=p.x=Hr(i,this.left+d,this.right-s[p.line])):_>0&&F+k>this.bottom&&(j=p.x=j+n[p.line].width+d,p.line++,F=p.y=Hr(i,this.top+C+d,this.bottom-n[p.line].height));const L=l.x(j);if(y(L,F,T),j=Bje(R,j+m+f,S?j+A:this.right,e.rtl),v(l.x(j),F,T),S)p.x+=A+d;else if(typeof T.text!="string"){const M=c.lineHeight;p.y+=RH(T,M)+d}else p.y+=k}),gH(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,s=Qr(n.font),r=xa(n.padding);if(!n.display)return;const i=op(e.rtl,this.left,this.width),o=this.ctx,a=n.position,l=s.size/2,c=r.top+l;let d,h=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),d=this.top+c,h=Hr(e.align,h,this.right-f);else{const m=this.columnSizes.reduce((g,x)=>Math.max(g,x.height),0);d=c+Hr(e.align,this.top,this.bottom-m-e.labels.padding-this._computeTitleHeight())}const p=Hr(a,h,h+f);o.textAlign=i.textAlign(HR(a)),o.textBaseline="middle",o.strokeStyle=n.color,o.fillStyle=n.color,o.font=s.string,M0(o,n.text,p,d,s)}_computeTitleHeight(){const e=this.options.title,n=Qr(e.font),s=xa(e.padding);return e.display?n.lineHeight+s.height:0}_getLegendItemAt(e,n){let s,r,i;if(fg(e,this.left,this.right)&&fg(n,this.top,this.bottom)){for(i=this.legendHitBoxes,s=0;s<i.length;++s)if(r=i[s],fg(e,r.left,r.left+r.width)&&fg(n,r.top,r.top+r.height))return this.legendItems[s]}return null}handleEvent(e){const n=this.options;if(!TFe(e.type,n))return;const s=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const r=this._hoveredItem,i=SFe(r,s);r&&!i&&Ns(n.onLeave,[e,r,this],this),this._hoveredItem=s,s&&!i&&Ns(n.onHover,[e,s,this],this)}else s&&Ns(n.onClick,[e,s,this],this)}}function CFe(t,e,n,s,r){const i=kFe(s,t,e,n),o=NFe(r,s,e.lineHeight);return{itemWidth:i,itemHeight:o}}function kFe(t,e,n,s){let r=t.text;return r&&typeof r!="string"&&(r=r.reduce((i,o)=>i.length>o.length?i:o)),e+n.size/2+s.measureText(r).width}function NFe(t,e,n){let s=t;return typeof e.text!="string"&&(s=RH(e,n)),s}function RH(t,e){const n=t.text?t.text.length:0;return e*n}function TFe(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var _Fe={id:"legend",_element:hF,start(t,e,n){const s=t.legend=new hF({ctx:t.ctx,options:n,chart:t});ia.configure(t,s,n),ia.addBox(t,s)},stop(t){ia.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const s=t.legend;ia.configure(t,s,n),s.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const s=e.datasetIndex,r=n.chart;r.isDatasetVisible(s)?(r.hide(s),e.hidden=!0):(r.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:s,textAlign:r,color:i,useBorderRadius:o,borderRadius:a}}=t.legend.options;return t._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=xa(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:i,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:r||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};let PH=class extends Jh{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=n;const r=kr(s.text)?s.text.length:1;this._padding=xa(s.padding);const i=r*Qr(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:n,left:s,bottom:r,right:i,options:o}=this,a=o.align;let l=0,c,d,h;return this.isHorizontal()?(d=Hr(a,s,i),h=n+e,c=i-s):(o.position==="left"?(d=s+e,h=Hr(a,r,n),l=Tr*-.5):(d=i-e,h=Hr(a,n,r),l=Tr*.5),c=r-n),{titleX:d,titleY:h,maxWidth:c,rotation:l}}draw(){const e=this.ctx,n=this.options;if(!n.display)return;const s=Qr(n.font),i=s.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(i);M0(e,n.text,0,0,s,{color:n.color,maxWidth:l,rotation:c,textAlign:HR(n.align),textBaseline:"middle",translation:[o,a]})}};function EFe(t,e){const n=new PH({ctx:t.ctx,options:e,chart:t});ia.configure(t,n,e),ia.addBox(t,n),t.titleBlock=n}var $Fe={id:"title",_element:PH,start(t,e,n){EFe(t,n)},stop(t){const e=t.titleBlock;ia.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,n){const s=t.titleBlock;ia.configure(t,s,n),s.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const gg={average(t){if(!t.length)return!1;let e,n,s=new Set,r=0,i=0;for(e=0,n=t.length;e<n;++e){const a=t[e].element;if(a&&a.hasValue()){const l=a.tooltipPosition();s.add(l.x),r+=l.y,++i}}return i===0||s.size===0?!1:{x:[...s].reduce((a,l)=>a+l)/s.size,y:r/i}},nearest(t,e){if(!t.length)return!1;let n=e.x,s=e.y,r=Number.POSITIVE_INFINITY,i,o,a;for(i=0,o=t.length;i<o;++i){const l=t[i].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=kN(e,c);d<r&&(r=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,s=l.y}return{x:n,y:s}}};function al(t,e){return e&&(kr(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Zl(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function IFe(t,e){const{element:n,datasetIndex:s,index:r}=e,i=t.getDatasetMeta(s).controller,{label:o,value:a}=i.getLabelAndValue(r);return{chart:t,label:o,parsed:i.getParsed(r),raw:t.data.datasets[s].data[r],formattedValue:a,dataset:i.getDataset(),dataIndex:r,datasetIndex:s,element:n}}function fF(t,e){const n=t.chart.ctx,{body:s,footer:r,title:i}=t,{boxWidth:o,boxHeight:a}=e,l=Qr(e.bodyFont),c=Qr(e.titleFont),d=Qr(e.footerFont),h=i.length,f=r.length,p=s.length,m=xa(e.padding);let g=m.height,x=0,y=s.reduce((C,k)=>C+k.before.length+k.lines.length+k.after.length,0);if(y+=t.beforeBody.length+t.afterBody.length,h&&(g+=h*c.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),y){const C=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;g+=p*C+(y-p)*l.lineHeight+(y-1)*e.bodySpacing}f&&(g+=e.footerMarginTop+f*d.lineHeight+(f-1)*e.footerSpacing);let v=0;const S=function(C){x=Math.max(x,n.measureText(C).width+v)};return n.save(),n.font=c.string,Qn(t.title,S),n.font=l.string,Qn(t.beforeBody.concat(t.afterBody),S),v=e.displayColors?o+2+e.boxPadding:0,Qn(s,C=>{Qn(C.before,S),Qn(C.lines,S),Qn(C.after,S)}),v=0,n.font=d.string,Qn(t.footer,S),n.restore(),x+=m.width,{width:x,height:g}}function RFe(t,e){const{y:n,height:s}=e;return n<s/2?"top":n>t.height-s/2?"bottom":"center"}function PFe(t,e,n,s){const{x:r,width:i}=s,o=n.caretSize+n.caretPadding;if(t==="left"&&r+i+o>e.width||t==="right"&&r-i-o<0)return!0}function AFe(t,e,n,s){const{x:r,width:i}=n,{width:o,chartArea:{left:a,right:l}}=t;let c="center";return s==="center"?c=r<=(a+l)/2?"left":"right":r<=i/2?c="left":r>=o-i/2&&(c="right"),PFe(c,t,e,n)&&(c="center"),c}function pF(t,e,n){const s=n.yAlign||e.yAlign||RFe(t,n);return{xAlign:n.xAlign||e.xAlign||AFe(t,e,n,s),yAlign:s}}function jFe(t,e){let{x:n,width:s}=t;return e==="right"?n-=s:e==="center"&&(n-=s/2),n}function DFe(t,e,n){let{y:s,height:r}=t;return e==="top"?s+=n:e==="bottom"?s-=r+n:s-=r/2,s}function mF(t,e,n,s){const{caretSize:r,caretPadding:i,cornerRadius:o}=t,{xAlign:a,yAlign:l}=n,c=r+i,{topLeft:d,topRight:h,bottomLeft:f,bottomRight:p}=Wg(o);let m=jFe(e,a);const g=DFe(e,l,c);return l==="center"?a==="left"?m+=c:a==="right"&&(m-=c):a==="left"?m-=Math.max(d,f)+r:a==="right"&&(m+=Math.max(h,p)+r),{x:bl(m,0,s.width-e.width),y:bl(g,0,s.height-e.height)}}function qy(t,e,n){const s=xa(n.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-s.right:t.x+s.left}function gF(t){return al([],Zl(t))}function OFe(t,e,n){return Zh(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}function xF(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const AH={beforeTitle:Kl,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,s=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return n[e.dataIndex]}return""},afterTitle:Kl,beforeBody:Kl,beforeLabel:Kl,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return Ds(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Kl,afterBody:Kl,beforeFooter:Kl,footer:Kl,afterFooter:Kl};function ji(t,e,n,s){const r=t[e].call(n,s);return typeof r>"u"?AH[e].call(n,s):r}class PN extends Jh{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,s=this.options.setContext(this.getContext()),r=s.enabled&&n.options.animation&&s.animations,i=new yH(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=OFe(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:s}=n,r=ji(s,"beforeTitle",this,e),i=ji(s,"title",this,e),o=ji(s,"afterTitle",this,e);let a=[];return a=al(a,Zl(r)),a=al(a,Zl(i)),a=al(a,Zl(o)),a}getBeforeBody(e,n){return gF(ji(n.callbacks,"beforeBody",this,e))}getBody(e,n){const{callbacks:s}=n,r=[];return Qn(e,i=>{const o={before:[],lines:[],after:[]},a=xF(s,i);al(o.before,Zl(ji(a,"beforeLabel",this,i))),al(o.lines,ji(a,"label",this,i)),al(o.after,Zl(ji(a,"afterLabel",this,i))),r.push(o)}),r}getAfterBody(e,n){return gF(ji(n.callbacks,"afterBody",this,e))}getFooter(e,n){const{callbacks:s}=n,r=ji(s,"beforeFooter",this,e),i=ji(s,"footer",this,e),o=ji(s,"afterFooter",this,e);let a=[];return a=al(a,Zl(r)),a=al(a,Zl(i)),a=al(a,Zl(o)),a}_createItems(e){const n=this._active,s=this.chart.data,r=[],i=[],o=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(IFe(this.chart,n[l]));return e.filter&&(a=a.filter((d,h,f)=>e.filter(d,h,f,s))),e.itemSort&&(a=a.sort((d,h)=>e.itemSort(d,h,s))),Qn(a,d=>{const h=xF(e.callbacks,d);r.push(ji(h,"labelColor",this,d)),i.push(ji(h,"labelPointStyle",this,d)),o.push(ji(h,"labelTextColor",this,d))}),this.labelColors=r,this.labelPointStyles=i,this.labelTextColors=o,this.dataPoints=a,a}update(e,n){const s=this.options.setContext(this.getContext()),r=this._active;let i,o=[];if(!r.length)this.opacity!==0&&(i={opacity:0});else{const a=gg[s.position].call(this,r,this._eventPosition);o=this._createItems(s),this.title=this.getTitle(o,s),this.beforeBody=this.getBeforeBody(o,s),this.body=this.getBody(o,s),this.afterBody=this.getAfterBody(o,s),this.footer=this.getFooter(o,s);const l=this._size=fF(this,s),c=Object.assign({},a,l),d=pF(this.chart,s,c),h=mF(s,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,i={opacity:1,x:h.x,y:h.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&s.external&&s.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,s,r){const i=this.getCaretPosition(e,s,r);n.lineTo(i.x1,i.y1),n.lineTo(i.x2,i.y2),n.lineTo(i.x3,i.y3)}getCaretPosition(e,n,s){const{xAlign:r,yAlign:i}=this,{caretSize:o,cornerRadius:a}=s,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:h}=Wg(a),{x:f,y:p}=e,{width:m,height:g}=n;let x,y,v,S,C,k;return i==="center"?(C=p+g/2,r==="left"?(x=f,y=x-o,S=C+o,k=C-o):(x=f+m,y=x+o,S=C-o,k=C+o),v=x):(r==="left"?y=f+Math.max(l,d)+o:r==="right"?y=f+m-Math.max(c,h)-o:y=this.caretX,i==="top"?(S=p,C=S-o,x=y-o,v=y+o):(S=p+g,C=S+o,x=y+o,v=y-o),k=S),{x1:x,x2:y,x3:v,y1:S,y2:C,y3:k}}drawTitle(e,n,s){const r=this.title,i=r.length;let o,a,l;if(i){const c=op(s.rtl,this.x,this.width);for(e.x=qy(this,s.titleAlign,s),n.textAlign=c.textAlign(s.titleAlign),n.textBaseline="middle",o=Qr(s.titleFont),a=s.titleSpacing,n.fillStyle=s.titleColor,n.font=o.string,l=0;l<i;++l)n.fillText(r[l],c.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+a,l+1===i&&(e.y+=s.titleMarginBottom-a)}}_drawColorBox(e,n,s,r,i){const o=this.labelColors[s],a=this.labelPointStyles[s],{boxHeight:l,boxWidth:c}=i,d=Qr(i.bodyFont),h=qy(this,"left",i),f=r.x(h),p=l<d.lineHeight?(d.lineHeight-l)/2:0,m=n.y+p;if(i.usePointStyle){const g={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},x=r.leftForLtr(f,c)+c/2,y=m+l/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,_N(e,g,x,y),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,_N(e,g,x,y)}else{e.lineWidth=Bn(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const g=r.leftForLtr(f,c),x=r.leftForLtr(r.xPlus(f,1),c-2),y=Wg(o.borderRadius);Object.values(y).some(v=>v!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,EN(e,{x:g,y:m,w:c,h:l,radius:y}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),EN(e,{x,y:m+1,w:c-2,h:l-2,radius:y}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(g,m,c,l),e.strokeRect(g,m,c,l),e.fillStyle=o.backgroundColor,e.fillRect(x,m+1,c-2,l-2))}e.fillStyle=this.labelTextColors[s]}drawBody(e,n,s){const{body:r}=this,{bodySpacing:i,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=s,h=Qr(s.bodyFont);let f=h.lineHeight,p=0;const m=op(s.rtl,this.x,this.width),g=function($){n.fillText($,m.x(e.x+p),e.y+f/2),e.y+=f+i},x=m.textAlign(o);let y,v,S,C,k,T,_;for(n.textAlign=o,n.textBaseline="middle",n.font=h.string,e.x=qy(this,x,s),n.fillStyle=s.bodyColor,Qn(this.beforeBody,g),p=a&&x!=="right"?o==="center"?c/2+d:c+2+d:0,C=0,T=r.length;C<T;++C){for(y=r[C],v=this.labelTextColors[C],n.fillStyle=v,Qn(y.before,g),S=y.lines,a&&S.length&&(this._drawColorBox(n,e,C,m,s),f=Math.max(h.lineHeight,l)),k=0,_=S.length;k<_;++k)g(S[k]),f=h.lineHeight;Qn(y.after,g)}p=0,f=h.lineHeight,Qn(this.afterBody,g),e.y-=i}drawFooter(e,n,s){const r=this.footer,i=r.length;let o,a;if(i){const l=op(s.rtl,this.x,this.width);for(e.x=qy(this,s.footerAlign,s),e.y+=s.footerMarginTop,n.textAlign=l.textAlign(s.footerAlign),n.textBaseline="middle",o=Qr(s.footerFont),n.fillStyle=s.footerColor,n.font=o.string,a=0;a<i;++a)n.fillText(r[a],l.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+s.footerSpacing}}drawBackground(e,n,s,r){const{xAlign:i,yAlign:o}=this,{x:a,y:l}=e,{width:c,height:d}=s,{topLeft:h,topRight:f,bottomLeft:p,bottomRight:m}=Wg(r.cornerRadius);n.fillStyle=r.backgroundColor,n.strokeStyle=r.borderColor,n.lineWidth=r.borderWidth,n.beginPath(),n.moveTo(a+h,l),o==="top"&&this.drawCaret(e,n,s,r),n.lineTo(a+c-f,l),n.quadraticCurveTo(a+c,l,a+c,l+f),o==="center"&&i==="right"&&this.drawCaret(e,n,s,r),n.lineTo(a+c,l+d-m),n.quadraticCurveTo(a+c,l+d,a+c-m,l+d),o==="bottom"&&this.drawCaret(e,n,s,r),n.lineTo(a+p,l+d),n.quadraticCurveTo(a,l+d,a,l+d-p),o==="center"&&i==="left"&&this.drawCaret(e,n,s,r),n.lineTo(a,l+h),n.quadraticCurveTo(a,l,a+h,l),n.closePath(),n.fill(),r.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,s=this.$animations,r=s&&s.x,i=s&&s.y;if(r||i){const o=gg[e.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=fF(this,e),l=Object.assign({},o,this._size),c=pF(n,e,l),d=mF(e,l,c,n);(r._to!==d.x||i._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(e){const n=this.options.setContext(this.getContext());let s=this.opacity;if(!s)return;this._updateAnimationTarget(n);const r={width:this.width,height:this.height},i={x:this.x,y:this.y};s=Math.abs(s)<.001?0:s;const o=xa(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(e.save(),e.globalAlpha=s,this.drawBackground(i,e,r,n),mH(e,n.textDirection),i.y+=o.top,this.drawTitle(i,e,n),this.drawBody(i,e,n),this.drawFooter(i,e,n),gH(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const s=this._active,r=e.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),i=!Yb(s,r),o=this._positionChanged(r,n);(i||o)&&(this._active=r,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,s=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,i=this._active||[],o=this._getActiveElements(e,i,n,s),a=this._positionChanged(o,e),l=n||!Yb(o,i)||a;return l&&(this._active=o,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),l}_getActiveElements(e,n,s,r){const i=this.options;if(e.type==="mouseout")return[];if(!r)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(e,i.mode,i,s);return i.reverse&&o.reverse(),o}_positionChanged(e,n){const{caretX:s,caretY:r,options:i}=this,o=gg[i.position].call(this,e,n);return o!==!1&&(s!==o.x||r!==o.y)}}vn(PN,"positioners",gg);var FFe={id:"tooltip",_element:PN,positioners:gg,afterInit(t,e,n){n&&(t.tooltip=new PN({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:AH},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const MFe=(t,e,n,s)=>(typeof e=="string"?(n=t.push(e)-1,s.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function LFe(t,e,n,s){const r=t.indexOf(e);if(r===-1)return MFe(t,e,n,s);const i=t.lastIndexOf(e);return r!==i?n:r}const BFe=(t,e)=>t===null?null:bl(Math.round(t),0,e);function yF(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class AN extends km{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const s=this.getLabels();for(const{index:r,label:i}of n)s[r]===i&&s.splice(r,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(Ds(e))return null;const s=this.getLabels();return n=isFinite(n)&&s[n]===e?n:LFe(s,e,In(n,e),this._addedLabels),BFe(n,s.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:s,max:r}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(s=0),n||(r=this.getLabels().length-1)),this.min=s,this.max=r}buildTicks(){const e=this.min,n=this.max,s=this.options.offset,r=[];let i=this.getLabels();i=e===0&&n===i.length-1?i:i.slice(e,n+1),this._valueRange=Math.max(i.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=e;o<=n;o++)r.push({value:o});return r}getLabelForValue(e){return yF.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}vn(AN,"id","category"),vn(AN,"defaults",{ticks:{callback:yF}});function VFe(t,e){const n=[],{bounds:r,step:i,min:o,max:a,precision:l,count:c,maxTicks:d,maxDigits:h,includeBounds:f}=t,p=i||1,m=d-1,{min:g,max:x}=e,y=!Ds(o),v=!Ds(a),S=!Ds(c),C=(x-g)/(h+1);let k=CO((x-g)/m/p)*p,T,_,$,R;if(k<1e-14&&!y&&!v)return[{value:g},{value:x}];R=Math.ceil(x/k)-Math.floor(g/k),R>m&&(k=CO(R*k/m/p)*p),Ds(l)||(T=Math.pow(10,l),k=Math.ceil(k*T)/T),r==="ticks"?(_=Math.floor(g/k)*k,$=Math.ceil(x/k)*k):(_=g,$=x),y&&v&&i&&$je((a-o)/i,k/1e3)?(R=Math.round(Math.min((a-o)/k,d)),k=(a-o)/R,_=o,$=a):S?(_=y?o:_,$=v?a:$,R=c-1,k=($-_)/R):(R=($-_)/k,Bg(R,Math.round(R),k/1e3)?R=Math.round(R):R=Math.ceil(R));const A=Math.max(kO(k),kO(_));T=Math.pow(10,Ds(l)?A:l),_=Math.round(_*T)/T,$=Math.round($*T)/T;let j=0;for(y&&(f&&_!==o?(n.push({value:o}),_<o&&j++,Bg(Math.round((_+j*k)*T)/T,o,vF(o,C,t))&&j++):_<o&&j++);j<R;++j){const F=Math.round((_+j*k)*T)/T;if(v&&F>a)break;n.push({value:F})}return v&&f&&$!==a?n.length&&Bg(n[n.length-1].value,a,vF(a,C,t))?n[n.length-1].value=a:n.push({value:a}):(!v||$===a)&&n.push({value:$}),n}function vF(t,e,{horizontal:n,minRotation:s}){const r=Ud(s),i=(n?Math.sin(r):Math.cos(r))||.001,o=.75*e*(""+t).length;return Math.min(e/i,o)}class zFe extends km{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return Ds(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:s}=this.getUserBounds();let{min:r,max:i}=this;const o=l=>r=n?r:l,a=l=>i=s?i:l;if(e){const l=Up(r),c=Up(i);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(r===i){let l=i===0?1:Math.abs(i*.05);a(i+l),e||o(r-l)}this.min=r,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:s}=e,r;return s?(r=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,r>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${r} ticks. Limiting to 1000.`),r=1e3)):(r=this.computeTickLimit(),n=n||11),n&&(r=Math.min(n,r)),r}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let s=this.getTickLimit();s=Math.max(2,s);const r={maxTicks:s,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},i=this._range||this,o=VFe(r,i);return e.bounds==="ticks"&&Ije(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let n=this.min,s=this.max;if(super.configure(),this.options.offset&&e.length){const r=(s-n)/Math.max(e.length-1,1)/2;n-=r,s+=r}this._startValue=n,this._endValue=s,this._valueRange=s-n}getLabelForValue(e){return iH(e,this.chart.options.locale,this.options.ticks.format)}}class jN extends zFe{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=ga(e)?e:0,this.max=ga(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,s=Ud(this.options.ticks.minRotation),r=(e?Math.sin(s):Math.cos(s))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,i.lineHeight/r))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}vn(jN,"id","linear"),vn(jN,"defaults",{ticks:{callback:aH.formatters.numeric}});const F1={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Wi=Object.keys(F1);function bF(t,e){return t-e}function wF(t,e){if(Ds(e))return null;const n=t._adapter,{parser:s,round:r,isoWeekday:i}=t._parseOpts;let o=e;return typeof s=="function"&&(o=s(o)),ga(o)||(o=typeof s=="string"?n.parse(o,s):n.parse(o)),o===null?null:(r&&(o=r==="week"&&(tw(i)||i===!0)?n.startOf(o,"isoWeek",i):n.startOf(o,r)),+o)}function SF(t,e,n,s){const r=Wi.length;for(let i=Wi.indexOf(t);i<r-1;++i){const o=F1[Wi[i]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((n-e)/(a*o.size))<=s)return Wi[i]}return Wi[r-1]}function WFe(t,e,n,s,r){for(let i=Wi.length-1;i>=Wi.indexOf(n);i--){const o=Wi[i];if(F1[o].common&&t._adapter.diff(r,s,o)>=e-1)return o}return Wi[n?Wi.indexOf(n):0]}function UFe(t){for(let e=Wi.indexOf(t)+1,n=Wi.length;e<n;++e)if(F1[Wi[e]].common)return Wi[e]}function CF(t,e,n){if(!n)t[e]=!0;else if(n.length){const{lo:s,hi:r}=UR(n,e),i=n[s]>=e?n[s]:n[r];t[i]=!0}}function HFe(t,e,n,s){const r=t._adapter,i=+r.startOf(e[0].value,s),o=e[e.length-1].value;let a,l;for(a=i;a<=o;a=+r.add(a,1,s))l=n[a],l>=0&&(e[l].major=!0);return e}function kF(t,e,n){const s=[],r={},i=e.length;let o,a;for(o=0;o<i;++o)a=e[o],r[a]=o,s.push({value:a,major:!1});return i===0||!n?s:HFe(t,s,r,n)}class rw extends km{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n={}){const s=e.time||(e.time={}),r=this._adapter=new rOe._date(e.adapters.date);r.init(n),Lg(s.displayFormats,r.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:wF(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,s=e.time.unit||"day";let{min:r,max:i,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(r=Math.min(r,c.min)),!a&&!isNaN(c.max)&&(i=Math.max(i,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),r=ga(r)&&!isNaN(r)?r:+n.startOf(Date.now(),s),i=ga(i)&&!isNaN(i)?i:+n.endOf(Date.now(),s)+1,this.min=Math.min(r,i-1),this.max=Math.max(r+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],s=e[e.length-1]),{min:n,max:s}}buildTicks(){const e=this.options,n=e.time,s=e.ticks,r=s.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const i=this.min,o=this.max,a=Oje(r,i,o);return this._unit=n.unit||(s.autoSkip?SF(n.minUnit,this.min,this.max,this._getLabelCapacity(i)):WFe(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:UFe(this._unit),this.initOffsets(r),e.reverse&&a.reverse(),kF(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let n=0,s=0,r,i;this.options.offset&&e.length&&(r=this.getDecimalForValue(e[0]),e.length===1?n=1-r:n=(this.getDecimalForValue(e[1])-r)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?s=i:s=(i-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;n=bl(n,0,o),s=bl(s,0,o),this._offsets={start:n,end:s,factor:1/(n+1+s)}}_generate(){const e=this._adapter,n=this.min,s=this.max,r=this.options,i=r.time,o=i.unit||SF(i.minUnit,n,s,this._getLabelCapacity(n)),a=In(r.ticks.stepSize,1),l=o==="week"?i.isoWeekday:!1,c=tw(l)||l===!0,d={};let h=n,f,p;if(c&&(h=+e.startOf(h,"isoWeek",l)),h=+e.startOf(h,c?"day":o),e.diff(s,n,o)>1e5*a)throw new Error(n+" and "+s+" are too far apart with stepSize of "+a+" "+o);const m=r.ticks.source==="data"&&this.getDataTimestamps();for(f=h,p=0;f<s;f=+e.add(f,a,o),p++)CF(d,f,m);return(f===s||r.bounds==="ticks"||p===1)&&CF(d,f,m),Object.keys(d).sort(bF).map(g=>+g)}getLabelForValue(e){const n=this._adapter,s=this.options.time;return s.tooltipFormat?n.format(e,s.tooltipFormat):n.format(e,s.displayFormats.datetime)}format(e,n){const r=this.options.time.displayFormats,i=this._unit,o=n||r[i];return this._adapter.format(e,o)}_tickFormatFunction(e,n,s,r){const i=this.options,o=i.ticks.callback;if(o)return Ns(o,[e,n,s],this);const a=i.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],h=c&&a[c],f=s[n],p=c&&h&&f&&f.major;return this._adapter.format(e,r||(p?h:d))}generateTickLabels(e){let n,s,r;for(n=0,s=e.length;n<s;++n)r=e[n],r.label=this._tickFormatFunction(r.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,s=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+s)*n.factor)}getValueForPixel(e){const n=this._offsets,s=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+s*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,s=this.ctx.measureText(e).width,r=Ud(this.isHorizontal()?n.maxRotation:n.minRotation),i=Math.cos(r),o=Math.sin(r),a=this._resolveTickFontOptions(0).size;return{w:s*i+a*o,h:s*o+a*i}}_getLabelCapacity(e){const n=this.options.time,s=n.displayFormats,r=s[n.unit]||s.millisecond,i=this._tickFormatFunction(e,0,kF(this,[e],this._majorUnit),r),o=this._getLabelSize(i),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],n,s;if(e.length)return e;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(n=0,s=r.length;n<s;++n)e=e.concat(r[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,s;if(e.length)return e;const r=this.getLabels();for(n=0,s=r.length;n<s;++n)e.push(wF(this,r[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Mje(e.sort(bF))}}vn(rw,"id","time"),vn(rw,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Xy(t,e,n){let s=0,r=t.length-1,i,o,a,l;n?(e>=t[s].pos&&e<=t[r].pos&&({lo:s,hi:r}=NN(t,"pos",e)),{pos:i,time:a}=t[s],{pos:o,time:l}=t[r]):(e>=t[s].time&&e<=t[r].time&&({lo:s,hi:r}=NN(t,"time",e)),{time:i,pos:a}=t[s],{time:o,pos:l}=t[r]);const c=o-i;return c?a+(l-a)*(e-i)/c:a}class NF extends rw{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=Xy(n,this.min),this._tableRange=Xy(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:s}=this,r=[],i=[];let o,a,l,c,d;for(o=0,a=e.length;o<a;++o)c=e[o],c>=n&&c<=s&&r.push(c);if(r.length<2)return[{time:n,pos:0},{time:s,pos:1}];for(o=0,a=r.length;o<a;++o)d=r[o+1],l=r[o-1],c=r[o],Math.round((d+l)/2)!==c&&i.push({time:c,pos:o/(a-1)});return i}_generate(){const e=this.min,n=this.max;let s=super.getDataTimestamps();return(!s.includes(e)||!s.length)&&s.splice(0,0,e),(!s.includes(n)||s.length===1)&&s.push(n),s.sort((r,i)=>r-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),s=this.getLabelTimestamps();return n.length&&s.length?e=this.normalize(n.concat(s)):e=n.length?n:s,e=this._cache.all=e,e}getDecimalForValue(e){return(Xy(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,s=this.getDecimalForPixel(e)/n.factor-n.end;return Xy(this._table,s*this._tableRange+this._minPos,!0)}}vn(NF,"id","timeseries"),vn(NF,"defaults",rw.defaults);var DN={exports:{}},TS,TF;function GFe(){if(TF)return TS;TF=1;var t=1e3,e=t*60,n=e*60,s=n*24,r=s*7,i=s*365.25;TS=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return o(d);if(f==="number"&&isFinite(d))return h.long?l(d):a(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function o(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),p=(h[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*r;case"days":case"day":case"d":return f*s;case"hours":case"hour":case"hrs":case"hr":case"h":return f*n;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(d){var h=Math.abs(d);return h>=s?Math.round(d/s)+"d":h>=n?Math.round(d/n)+"h":h>=e?Math.round(d/e)+"m":h>=t?Math.round(d/t)+"s":d+"ms"}function l(d){var h=Math.abs(d);return h>=s?c(d,h,s,"day"):h>=n?c(d,h,n,"hour"):h>=e?c(d,h,e,"minute"):h>=t?c(d,h,t,"second"):d+" ms"}function c(d,h,f,p){var m=h>=f*1.5;return Math.round(d/f)+" "+p+(m?"s":"")}return TS}function KFe(t){n.debug=n,n.default=n,n.coerce=l,n.disable=o,n.enable=r,n.enabled=a,n.humanize=GFe(),n.destroy=c,Object.keys(t).forEach(d=>{n[d]=t[d]}),n.names=[],n.skips=[],n.formatters={};function e(d){let h=0;for(let f=0;f<d.length;f++)h=(h<<5)-h+d.charCodeAt(f),h|=0;return n.colors[Math.abs(h)%n.colors.length]}n.selectColor=e;function n(d){let h,f=null,p,m;function g(...x){if(!g.enabled)return;const y=g,v=Number(new Date),S=v-(h||v);y.diff=S,y.prev=h,y.curr=v,h=v,x[0]=n.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let C=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(T,_)=>{if(T==="%%")return"%";C++;const $=n.formatters[_];if(typeof $=="function"){const R=x[C];T=$.call(y,R),x.splice(C,1),C--}return T}),n.formatArgs.call(y,x),(y.log||n.log).apply(y,x)}return g.namespace=d,g.useColors=n.useColors(),g.color=n.selectColor(d),g.extend=s,g.destroy=n.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(p!==n.namespaces&&(p=n.namespaces,m=n.enabled(d)),m),set:x=>{f=x}}),typeof n.init=="function"&&n.init(g),g}function s(d,h){const f=n(this.namespace+(typeof h>"u"?":":h)+d);return f.log=this.log,f}function r(d){n.save(d),n.namespaces=d,n.names=[],n.skips=[];const h=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const f of h)f[0]==="-"?n.skips.push(f.slice(1)):n.names.push(f)}function i(d,h){let f=0,p=0,m=-1,g=0;for(;f<d.length;)if(p<h.length&&(h[p]===d[f]||h[p]==="*"))h[p]==="*"?(m=p,g=f,p++):(f++,p++);else if(m!==-1)p=m+1,g++,f=g;else return!1;for(;p<h.length&&h[p]==="*";)p++;return p===h.length}function o(){const d=[...n.names,...n.skips.map(h=>"-"+h)].join(",");return n.enable(""),d}function a(d){for(const h of n.skips)if(i(d,h))return!1;for(const h of n.names)if(i(d,h))return!0;return!1}function l(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var qFe=KFe;(function(t,e){var n={};e.formatArgs=r,e.save=i,e.load=o,e.useColors=s,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;c.splice(1,0,d,"color: inherit");let h=0,f=0;c[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(h++,p==="%c"&&(f=h))}),c.splice(f,0,d)}e.log=console.debug||console.log||(()=>{});function i(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function o(){let c;try{c=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=n.DEBUG),c}function a(){try{return localStorage}catch{}}t.exports=qFe(e);const{formatters:l}=t.exports;l.j=function(c){try{return JSON.stringify(c)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}})(DN,DN.exports);var XFe=DN.exports;function YFe(t,e){if(!(t instanceof Array))throw new TypeError("Invalid sequence '"+e+"' type: expected an array");if(t.length<1)throw new Error("Invalid number of sequence data points for '"+e+"': expected at least one");if(typeof t[0]!="number")throw new TypeError("Invalid data points types for sequence '"+e+"': expected a number")}var QFe={sequence:YFe},ZFe=function(t,e){if(typeof t!="number")throw new TypeError("Invalid length type");if(typeof e>"u")throw new Error("Invalid value: expected a value to be provided");for(var n=new Array(t),s=0;s<t;s++)n[s]=e;return n},JFe=function(t,e,n){for(var s=[],r=0;r<t;r++)s.push(ZFe(e,n));return s},eMe={create:JFe},jH=2220446049250313e-31,tMe=function(t,e,n){var s=Math.abs(t),r=Math.abs(e),i=Math.abs(t-e),o=t===e;return o||(o=i<jH,o||(o=i<=Math.max(s,r)*n)),o},nMe={EPSILON:jH,nearlyEqual:tMe},_S,_F;function sMe(){if(_F)return _S;_F=1;var t=function(e,n){var s=e-n,r=Math.abs(s);return r};return _S={distance:t},_S}var ES,EF;function rMe(){if(EF)return ES;EF=1;var t=function(e,n){var s=e-n,r=Math.sqrt(s*s);return r};return ES={distance:t},ES}var $S,$F;function DH(){if($F)return $S;$F=1;var t=function(e,n){var s=e-n,r=s*s;return r};return $S={distance:t},$S}var Kp=XFe("dtw"),IF=QFe,OH=eMe,IS=nMe;function iMe(t){if(typeof t!="object")throw new TypeError("Invalid options type: expected an object");if(typeof t.distanceMetric!="string"&&typeof t.distanceFunction!="function")throw new TypeError("Invalid distance types: expected a string distance type or a distance function");if(typeof t.distanceMetric=="string"&&typeof t.distanceFunction=="function")throw new Error("Invalid parameters: provide either a distance metric or function but not both");if(typeof t.distanceMetric=="string"){var e=t.distanceMetric.toLowerCase();if(e!=="manhattan"&&e!=="euclidean"&&e!=="squaredeuclidean")throw new Error("Invalid parameter value: Unknown distance metric '"+t.distanceMetric+"'")}}function oMe(t){var e=t.toLowerCase(),n=null;return e==="manhattan"?n=sMe().distance:e==="euclidean"?n=rMe().distance:e==="squaredeuclidean"&&(n=DH().distance),n}var aMe=function(t){var e={distanceCostMatrix:null};typeof t>"u"?e.distance=DH().distance:(iMe(t),typeof t.distanceMetric=="string"?e.distance=oMe(t.distanceMetric):typeof t.distanceFunction=="function"&&(e.distance=t.distanceFunction)),this.compute=function(n,s,r){var i=Number.POSITIVE_INFINITY;if(typeof r>"u")i=lMe(n,s,e);else if(typeof r=="number")i=cMe(n,s,r,e);else throw new TypeError("Invalid window parameter type: expected a number");return i},this.path=function(){var n=null;return e.distanceCostMatrix instanceof Array&&(n=uMe(e)),n}};function FH(t,e){IF.sequence(t,"firstSequence"),IF.sequence(e,"secondSequence")}function lMe(t,e,n){Kp("> computeOptimalPath"),FH(t,e);var s=new Date().getTime();n.m=t.length,n.n=e.length;var r=OH.create(n.m,n.n,Number.POSITIVE_INFINITY);r[0][0]=n.distance(t[0],e[0]);for(var i=1;i<n.m;i++){var o=n.distance(t[i],e[0]);r[i][0]=o+r[i-1][0]}for(var a=1;a<n.n;a++){var o=n.distance(t[0],e[a]);r[0][a]=o+r[0][a-1]}for(var i=1;i<n.m;i++)for(var a=1;a<n.n;a++){var o=n.distance(t[i],e[a]);r[i][a]=o+Math.min(r[i-1][a],r[i][a-1],r[i-1][a-1])}var l=new Date().getTime(),c=l-s;return Kp("< computeOptimalPath ("+c+" ms)"),n.distanceCostMatrix=r,n.similarity=r[n.m-1][n.n-1],n.similarity}function cMe(t,e,n,s){Kp("> computeOptimalPathWithWindow"),FH(t,e);var r=new Date().getTime();s.m=t.length,s.n=e.length;var i=Math.max(n,Math.abs(t.length-e.length)),o=OH.create(s.m+1,s.n+1,Number.POSITIVE_INFINITY);o[0][0]=0;for(var a=1;a<=s.m;a++)for(var l=Math.max(1,a-i);l<=Math.min(s.n,a+i);l++){var c=s.distance(t[a-1],e[l-1]);o[a][l]=c+Math.min(o[a-1][l],o[a][l-1],o[a-1][l-1])}var d=new Date().getTime(),h=d-r;return Kp("< computeOptimalPathWithWindow ("+h+" ms)"),o.shift(),o=o.map(function(f){return f.slice(1,f.length)}),s.distanceCostMatrix=o,s.similarity=o[s.m-1][s.n-1],s.similarity}function uMe(t){Kp("> retrieveOptimalPath");for(var e=new Date().getTime(),n=t.m-1,s=t.n-1,r=[[n,s]],i=1e-14;n>0||s>0;){if(n>0&&s>0){var o=Math.min(t.distanceCostMatrix[n-1][s],t.distanceCostMatrix[n][s-1],t.distanceCostMatrix[n-1][s-1]);IS.nearlyEqual(o,t.distanceCostMatrix[n-1][s-1],i)?(n--,s--):IS.nearlyEqual(o,t.distanceCostMatrix[n-1][s],i)?n--:IS.nearlyEqual(o,t.distanceCostMatrix[n][s-1],i)&&s--}else n>0&&s===0?n--:n===0&&s>0&&s--;r.push([n,s])}var a=new Date().getTime(),l=a-e;return Kp("< retrieveOptimalPath ("+l+" ms)"),r.reverse()}var dMe=aMe,hMe=dMe;const MH=Pw(hMe);nu.register(AN,jN,Dv,mg,$Fe,FFe,_Fe);const RF=({timestamps:t,angles:e,title:n,isLoading:s})=>{if(s)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"Loading angle data..."});if(!t||t.length===0)return u.jsxs("p",{className:"text-gray-400 text-center py-4",children:["No ",n.toLowerCase()," data available."]});const r=Object.keys(e);if(r.length===0)return u.jsxs("p",{className:"text-gray-400 text-center py-4",children:["No joint data found for ",n.toLowerCase(),"."]});const i={};return r.forEach(o=>{i[o]=t.map((a,l)=>{var c;return((c=e[o])==null?void 0:c[l])??null})}),u.jsxs("div",{className:"my-4 rounded-lg bg-gray-800/50 p-1 shadow-inner",children:[u.jsx("h4",{className:"text-white font-semibold mb-2 text-lg px-3 pt-2",children:n}),u.jsxs("div",{className:"max-h-72 overflow-y-auto styled-scrollbar",children:[" ",u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-700/60 sticky top-0 z-10",children:u.jsxs("tr",{children:[u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"Time"}),r.map(o=>u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:o.replace(/_/g," ")},o))]})}),u.jsx("tbody",{className:"divide-y divide-gray-700/50",children:t.map((o,a)=>u.jsxs("tr",{className:`${a%2===0?"bg-gray-800/70":"bg-gray-900/70"} hover:bg-gray-700/80 transition-colors duration-150 ease-in-out`,children:[u.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:o}),r.map(l=>{var c;return u.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:i[l][a]!==null?`${(c=i[l][a])==null?void 0:c.toFixed(1)}°`:"N/A"},`${l}-${a}`)})]},a))})]})]})]})},fMe=({overallScore:t,detailedJointScores:e,isLoading:n})=>{if(n)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"Loading comparison data..."});if(!e||e.length===0)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"No comparison data available."});const s=i=>i>=90?{label:"Excellent",color:"text-green-500"}:i>=80?{label:"Good",color:"text-green-300"}:i>=70?{label:"Fair",color:"text-yellow-400"}:i>=50?{label:"Okay",color:"text-orange-400"}:{label:"Needs Improvement",color:"text-red-500"},r=[...e].sort((i,o)=>i.score-o.score);return u.jsxs("div",{className:"my-4 rounded-lg bg-gray-800/50 p-1 shadow-inner",children:[u.jsx("h4",{className:"text-white font-semibold mb-2 text-lg px-3 pt-2",children:"Routine Comparison Analysis"}),u.jsxs("div",{className:"text-xs text-gray-400 mb-3 flex flex-wrap gap-2",children:[u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 rounded mr-2",children:"Excellent: 0-5°"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 rounded mr-2",children:"Good: 6-15°"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 rounded mr-2",children:"Fair: 16-30°"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-700 rounded",children:"Poor: >30°"})]}),u.jsx("div",{className:"max-h-72 overflow-y-auto styled-scrollbar",children:u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-700/60 sticky top-0 z-10",children:u.jsxs("tr",{children:[u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"Joint"}),u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"Alignment Score (%)"}),u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"DTW Cost"}),u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"Quality"}),u.jsx("th",{scope:"col",className:"px-4 py-3 whitespace-nowrap",children:"Recommendation"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-700/50",children:r.map((i,o)=>{if(i.cost===-1)return u.jsxs("tr",{className:`${o%2===0?"bg-gray-800/40":"bg-gray-900/40"} hover:bg-gray-700/50 transition-colors duration-150 ease-in-out`,children:[u.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-gray-500",children:i.name.replace(/_/g," ")}),u.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-500",colSpan:4,children:"Not enough data to process for DTW."})]},i.name);const{label:a,color:l}=s(i.score),c=d=>d>=90?"Excellent form! Maintain consistency.":d>=80?"Good alignment. Minor refinements possible.":d>=70?"Fair. Focus on matching timing and angles more closely.":d>=50?"Okay. Consider breaking down the movement.":"Significant practice needed. Review reference carefully.";return u.jsxs("tr",{className:`${o%2===0?"bg-gray-800/70":"bg-gray-900/70"} hover:bg-gray-700/80 transition-colors duration-150 ease-in-out`,children:[u.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium",children:i.name.replace(/_/g," ")}),u.jsxs("td",{className:`px-4 py-2 whitespace-nowrap font-semibold ${l}`,children:[i.score,"%"]}),u.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:i.cost.toFixed(2)}),u.jsx("td",{className:`px-4 py-2 whitespace-nowrap ${l}`,children:a}),u.jsx("td",{className:"px-4 py-2",children:c(i.score)})]},i.name)})})]})})]})};function PF({isOpen:t,onClose:e,scores:n=[],overallScore:s=0,feedback:r="No feedback available.",timing:i,recordedVideo:o,routineNotes:a,angleData:l,dtwResults:c,userAngleTable:d,instructorAngleTable:h,fastDtwResults:f}){const[p,m]=b.useState(!1),[g,x]=b.useState("routine"),[y,v]=b.useState(!1),[S,C]=b.useState(null),[k,T]=b.useState(!1),_=()=>{const j=[];if(S&&S.detailedJointScores){const F=S.detailedJointScores.filter(q=>q.cost!==-1).length,L=S.detailedJointScores.filter(q=>q.score<70&&q.cost!==-1);L.length>0&&j.push(`Focus on improving: ${L.map(q=>q.name.replace("_"," ")).join(", ")}. Aim for an alignment score of 70% or higher.`);const M=S.detailedJointScores.filter(q=>q.score>=90&&q.cost!==-1);M.length>0&&L.length===0&&F===M.length?j.push("Fantastic work! All joints show excellent alignment."):M.length>0&&L.length===0&&j.push("Great job on maintaining good to excellent form across all processable joints!"),F===0&&!S.error&&j.push("Not enough data points for a reliable comparison for any joint.")}else S&&S.error&&j.push(S.error);return j.length===0&&(!S||!S.detailedJointScores&&!S.error)&&j.push('Click "Process Results" to analyze your routine alignment.'),j};b.useEffect(()=>{g==="routine"&&k&&!y&&(d&&d.angles&&d.timestamps.length>0&&h&&h.angles&&h.timestamps.length>0?(v(!0),C(null),setTimeout(()=>{const j=d.angles,F=h.angles,L=Object.keys(j).filter(re=>{var U,G;return F[re]&&((U=j[re])==null?void 0:U.length)>0&&((G=F[re])==null?void 0:G.length)>0});if(L.length===0){C({error:"No common joint data with sufficient recordings found between user and instructor."}),v(!1),T(!1);return}const M=[];L.forEach(re=>{const U=j[re].filter(Pe=>typeof Pe=="number"),G=F[re].filter(Pe=>typeof Pe=="number");if(U.length<2||G.length<2){M.push({name:re,score:0,cost:-1});return}const Ce=new MH().compute(U,G),fe=Math.max(U.length,G.length)*180;let ee=0;fe>0&&(ee=Math.max(0,(1-Ce/fe)*100)),M.push({name:re,score:Math.round(ee),cost:parseFloat(Ce.toFixed(2))})});const q=M.filter(re=>re.cost!==-1),z=q.length>0?Math.round(q.reduce((re,U)=>re+U.score,0)/q.length):0;C({overallScore:z,detailedJointScores:M,jointErrors:M.map(re=>re.cost),jointNames:M.map(re=>re.name.replace(/_/g," ")),perFrameScores:M.map(re=>re.score/100)}),v(!1),T(!1)},500)):(C({error:"User or Instructor angle data is not available for analysis. Ensure both have recorded data."}),v(!1),T(!1)))},[g,k,d,h,y]);const $=()=>{T(!0)};if(!t)return null;const R=d&&d.timestamps&&d.timestamps.length>0,A=h&&h.timestamps&&h.timestamps.length>0;return u.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[u.jsx("div",{className:"absolute inset-0 bg-black/80 modal-overlay",onClick:e}),u.jsxs("div",{className:"relative bg-gray-900 rounded-lg shadow-xl border border-red-900/30 w-full max-w-4xl h-[90vh] overflow-y-auto modal-content",children:[u.jsx("div",{className:"bg-gradient-to-r from-red-900 to-red-700 p-6 sticky top-0 z-10",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h3",{className:"text-2xl font-bold text-white",children:"Test Results"}),u.jsx("button",{onClick:e,className:"text-white hover:text-red-200",children:u.jsx("span",{className:"material-icons",children:"close"})})]})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"bg-black/30 p-4 rounded-lg mb-6",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Feedback"}),u.jsx("ul",{className:"list-disc list-inside text-gray-300",children:_().map((j,F)=>u.jsx("li",{children:j},F))})]}),u.jsx("div",{className:"mb-6",children:u.jsxs("div",{className:"flex border-b border-gray-700 overflow-x-auto",children:[u.jsx("button",{onClick:()=>x("user"),className:`py-2 px-4 font-medium whitespace-nowrap ${g==="user"?"text-red-500 border-b-2 border-red-500":"text-gray-400 hover:text-white"}`,children:"Your Angles"}),u.jsx("button",{onClick:()=>x("instructor"),className:`py-2 px-4 font-medium whitespace-nowrap ${g==="instructor"?"text-red-500 border-b-2 border-red-500":"text-gray-400 hover:text-white"}`,children:"Instructor Angles"}),u.jsx("button",{onClick:()=>x("routine"),className:`py-2 px-4 font-medium whitespace-nowrap ${g==="routine"?"text-red-500 border-b-2 border-red-500":"text-gray-400 hover:text-white"}`,children:"Routine Analysis"})]})}),g==="user"&&u.jsx(RF,{timestamps:(d==null?void 0:d.timestamps)||[],angles:(d==null?void 0:d.angles)||{},title:"Your Joint Angles",isLoading:!R}),g==="instructor"&&u.jsx(RF,{timestamps:(h==null?void 0:h.timestamps)||[],angles:(h==null?void 0:h.angles)||{},title:"Instructor Joint Angles",isLoading:!A}),g==="routine"&&u.jsxs("div",{children:[u.jsxs("div",{className:"bg-black/30 p-3 rounded mb-4",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Routine DTW Analysis"}),u.jsx("p",{className:"text-gray-300 text-sm",children:"Compare your entire movement sequence against the instructor using Dynamic Time Warping (DTW) for each joint. Lower DTW cost signifies better alignment. Scores are normalized (0-100)."})]}),!S&&!y&&u.jsxs("div",{className:"text-center py-12",children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("div",{className:"inline-block p-4 bg-gradient-to-br from-green-500/20 to-blue-500/20 rounded-full mb-4",children:u.jsx("span",{className:"material-icons text-4xl text-green-400",children:"analytics"})}),u.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Ready to Analyze Your Performance"}),u.jsx("p",{className:"text-gray-300 text-sm max-w-md mx-auto",children:"Get detailed insights into your movement technique and compare it against the instructor's form"})]}),u.jsxs("button",{onClick:$,className:"relative bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-xl shadow-2xl text-lg transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-green-500/25 focus:outline-none focus:ring-4 focus:ring-green-500/50 group overflow-hidden",children:[u.jsxs("span",{className:"relative z-10 flex items-center",children:[u.jsx("span",{className:"material-icons mr-2 group-hover:rotate-12 transition-transform duration-300",children:"rocket_launch"}),"Process Results"]}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-400 to-blue-500 opacity-0 group-hover:opacity-20 transition-opacity duration-300"})]}),u.jsx("p",{className:"text-gray-400 text-xs mt-3",children:"Advanced DTW analysis • Joint-by-joint comparison • Performance scoring"})]}),y&&u.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-400",children:[u.jsxs("svg",{className:"animate-spin h-8 w-8 mb-4 text-red-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[u.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),u.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),u.jsx("p",{className:"text-lg mb-2",children:"Processing DTW Analysis..."}),u.jsx("p",{className:"text-sm",children:"This may take a moment."})]}),S&&!y&&(S.error?u.jsxs("div",{className:"text-center py-10 text-red-400",children:[u.jsx("p",{className:"text-lg mb-2",children:"Error during analysis:"}),u.jsx("p",{className:"text-sm",children:S.error})]}):u.jsxs(u.Fragment,{children:[u.jsx(fMe,{overallScore:S.overallScore,detailedJointScores:S.detailedJointScores,isLoading:y}),u.jsxs("div",{className:"mt-2 text-xs text-gray-400 px-3",children:[u.jsx("p",{children:u.jsx("strong",{children:"How scoring works:"})}),u.jsxs("ul",{className:"list-disc list-inside ml-4",children:[u.jsx("li",{children:"DTW (Dynamic Time Warping) calculates a 'cost' for aligning your joint movements with the instructor's. Lower cost is better."}),u.jsx("li",{children:"This cost is normalized to a score from 0 to 100 for each joint."}),u.jsx("li",{children:"The overall score is the average of these individual joint scores."}),u.jsx("li",{children:"'Joint Errors' in the table above represent the raw DTW cost for that joint."})]})]})]}))]}),o&&u.jsxs("div",{className:"mt-4",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Your Performance"}),u.jsx("video",{src:o,controls:!0,className:"w-full rounded shadow-lg border border-red-900/30"}),u.jsx("div",{className:"mt-2 flex justify-end",children:u.jsxs("button",{onClick:()=>{const j=document.createElement("a");j.href=o,j.download=`CoachT-Training-${new Date().toISOString().slice(0,10)}.webm`,document.body.appendChild(j),j.click(),document.body.removeChild(j)},className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded-full flex items-center",title:"Download video",children:[u.jsx("span",{className:"material-icons mr-1",children:"download"}),"Download Recording"]})})]}),u.jsxs("div",{className:"bg-black/30 p-4 rounded-lg mt-4",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Share Your Progress"}),u.jsxs("div",{className:"flex justify-center space-x-4",children:[o&&u.jsx("button",{onClick:()=>{const j=document.createElement("div");j.className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",j.innerHTML=`
                      <div class="bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-3xl border border-red-700/50">
                        <div class="flex justify-between items-center mb-4">
                          <h3 class="text-xl font-semibold text-white">Movement Recording</h3>
                          <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                        </div>
                        <video src="${o}" controls autoplay class="w-full rounded-lg max-h-[70vh] mb-4 border border-gray-700"></video>
                        <div class="flex justify-end">
                          <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg">Close</button>
                        </div>
                      </div>
                    `,document.body.appendChild(j)},className:"bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-full flex items-center justify-center w-12 h-12",title:"View Recording",children:u.jsx("span",{className:"material-icons",children:"play_arrow"})}),u.jsx("button",{onClick:()=>{const j=`
My CoachT Training Score: ${s}%
Joint Scores: ${n.map(F=>`${F.joint.replace("_"," ")}: ${F.score}%`).join(", ")}
Feedback: ${r}
                  `.trim();navigator.clipboard.writeText(j).then(()=>{m(!0),setTimeout(()=>m(!1),3e3)})},className:"bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full flex items-center justify-center w-12 h-12",title:"Share",children:u.jsx("span",{className:"material-icons",children:"share"})}),u.jsx("button",{onClick:()=>{const j=`
CoachT Training Results:
Overall Score: ${s}%
Joint Analysis:
${n.map(F=>`- ${F.joint.replace("_"," ")}: ${F.score}%`).join(`
`)}
${c?`
DTW Analysis:
${Object.entries(c).map(([F,L])=>`- ${F.replace("_"," ")}: ${L.score}%`).join(`
`)}`:""}
Areas to Improve:
${_().map(F=>`- ${F}`).join(`
`)}
                  `.trim();navigator.clipboard.writeText(j).then(()=>{m(!0),setTimeout(()=>m(!1),3e3)})},className:"bg-gray-600 hover:bg-gray-700 text-white p-3 rounded-full flex items-center justify-center w-12 h-12",title:"Copy to clipboard",children:u.jsx("span",{className:"material-icons",children:"content_copy"})})]})]}),u.jsx("div",{className:"mt-6",children:u.jsx("button",{onClick:e,className:"w-full py-3 bg-gradient-to-r from-red-800 to-red-700 hover:from-red-700 hover:to-red-600 text-white font-bold rounded-md shadow-lg transition-all hover:shadow-red-900/30",children:"Close"})})]})]}),p&&u.jsxs("div",{className:"fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded-lg shadow-lg border border-green-500 z-50 modal-content flex items-center",children:[u.jsx("span",{className:"material-icons text-green-500 mr-2",children:"check_circle"}),"Results copied to clipboard!"]})]})}function pMe({initialNotes:t="",onChange:e,onStartRoutine:n,onStopRoutine:s,onStartTest:r,onStopTest:i,onShowResults:o,isTracking:a=!1,hasReferenceMedia:l=!1,hasCompletedTest:c=!1,onRecord:d,isRecording:h=!1,onToggleScreenRecording:f,isScreenRecording:p=!1,isTestRunning:m=!1}){const[g,x]=b.useState(t);b.useEffect(()=>{e(g)},[g,e]);const y=v=>{const S=document.getElementById("routineNotesTextarea");if(!S)return;const C=S.selectionStart,k=S.selectionEnd,T=g.substring(C,k);let _=g;switch(v){case"bold":_=g.substring(0,C)+`**${T}**`+g.substring(k);break;case"italic":_=g.substring(0,C)+`*${T}*`+g.substring(k);break;case"heading":_=g.substring(0,C)+`# ${T}`+g.substring(k);break;case"subheading":_=g.substring(0,C)+`### ${T}`+g.substring(k);break}x(_)};return u.jsxs("div",{className:"bg-black border-t border-red-900/50 py-1 px-3 mt-0 w-full",children:[u.jsxs("div",{className:"flex items-center justify-between py-1",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-red-600 mr-2",children:"edit_note"}),u.jsx("h3",{className:"text-red-100 font-semibold",children:"Routine Notes"})]}),u.jsxs("div",{className:"flex gap-1",children:[u.jsx("button",{onClick:()=>y("bold"),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 rounded p-1",children:u.jsx("span",{className:"material-icons text-xs",children:"format_bold"})}),u.jsx("button",{onClick:()=>y("italic"),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 rounded p-1",children:u.jsx("span",{className:"material-icons text-xs",children:"format_italic"})}),u.jsx("button",{onClick:()=>y("heading"),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 rounded p-1",children:u.jsx("span",{className:"material-icons text-xs",children:"format_size"})}),u.jsx("button",{onClick:()=>y("subheading"),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 rounded p-1",children:u.jsx("span",{className:"material-icons text-xs",children:"text_fields"})})]})]}),u.jsx("textarea",{id:"routineNotesTextarea",value:g,onChange:v=>x(v.target.value),className:"w-full bg-gray-900 border border-red-900/30 rounded-md p-2 text-white min-h-[70px] focus:ring-1 focus:ring-red-500",placeholder:"Enter your notes about this routine here..."}),u.jsx("div",{className:"flex justify-center space-x-2 sm:space-x-4 mt-3 mb-1 flex-wrap",children:m?u.jsxs("button",{onClick:i,className:"px-5 sm:px-6 py-3 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-sm sm:text-base bg-gradient-to-r from-orange-600 to-orange-500 text-white hover:from-orange-700 hover:to-orange-600 animate-pulse",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-base sm:text-lg",children:"stop"}),"Stop Test"]}):u.jsxs(u.Fragment,{children:[a?u.jsxs("button",{onClick:s,className:"px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-xs sm:text-sm bg-gradient-to-r from-orange-600 to-orange-500 text-white hover:from-orange-700 hover:to-orange-600",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:"stop"}),"Stop Routine"]}):u.jsxs("button",{onClick:n,className:"px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-xs sm:text-sm bg-gradient-to-r from-red-700 to-red-600 text-white hover:from-red-800 hover:to-red-700",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:"play_arrow"}),"Start Routine"]}),d&&u.jsxs("button",{onClick:d,className:`px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-xs sm:text-sm ${h?"bg-red-500 text-white animate-pulse":"bg-purple-600 hover:bg-purple-700 text-white"}`,title:h?"Stop Recording":"Record Camera",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:h?"stop":"videocam"}),h?"Stop":"Record Camera"]}),f&&u.jsxs("button",{onClick:f,className:`px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-xs sm:text-sm ${p?"bg-red-500 text-white animate-pulse":"bg-blue-600 hover:bg-blue-700 text-white"}`,title:p?"Stop Screen Recording":"Record Entire Screen",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:p?"stop_screen_share":"screen_share"}),p?"Stop Record":"Record Screen"]}),u.jsxs("button",{onClick:r,className:`px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors text-xs sm:text-sm ${l?"bg-gradient-to-r from-green-500 to-green-400 text-white hover:from-green-600 hover:to-green-500 border-2 border-green-300 shadow-xl":"bg-gray-700 text-gray-300 cursor-not-allowed"}`,disabled:!l||h||p,title:l?h||p?"Recording in progress":"Start test against reference media":"Add reference media first",children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:"fitness_center"}),"Test"]}),c&&u.jsxs("button",{onClick:o,className:"px-3 sm:px-4 py-2 rounded-md font-medium shadow-lg flex items-center justify-center transition-colors bg-gradient-to-r from-green-600 to-green-500 text-white hover:from-green-700 hover:to-green-600 text-xs sm:text-sm",title:"View your test results",disabled:h||p,children:[u.jsx("span",{className:"material-icons mr-1 sm:mr-2 text-sm sm:text-base",children:"analytics"}),"Test Results"]})]})})]})}const mMe=(t,e,n)=>{const s={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},i=s.x*r.x+s.y*r.y,o=Math.sqrt(s.x*s.x+s.y*s.y),a=Math.sqrt(r.x*r.x+r.y*r.y);let c=Math.acos(i/(o*a))*180/Math.PI;return isNaN(c)?0:Math.round(c)},Xm=t=>!!(t!=null&&t.includes("#video")||t!=null&&t.startsWith("blob:")&&(t!=null&&t.includes("video"))||t!=null&&t.match(/\.(mp4|mov|webm|avi|wmv|flv|mkv)$/i)),_d=["left_elbow","right_elbow","left_shoulder","right_shoulder","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],AF=(t,e)=>{var s;return((s={left_elbow:{start:"left_shoulder",end:"left_wrist"},right_elbow:{start:"right_shoulder",end:"right_wrist"},left_shoulder:{start:"left_hip",end:"left_elbow"},right_shoulder:{start:"right_hip",end:"right_elbow"},left_wrist:{start:"left_elbow",end:"left_index"},right_wrist:{start:"right_elbow",end:"right_index"},left_knee:{start:"left_hip",end:"left_ankle"},right_knee:{start:"right_hip",end:"right_ankle"},left_ankle:{start:"left_knee",end:"left_foot_index"},right_ankle:{start:"right_knee",end:"right_foot_index"},left_hip:{start:"left_knee",end:"left_shoulder"},right_hip:{start:"right_knee",end:"right_shoulder"}}[t])==null?void 0:s[e])||t},tc=t=>{if(!t||!t.keypoints)return{};const e=new Map;t.keypoints.forEach(s=>{s.score>.1&&e.set(s.name,s)});const n={};return _d.forEach(s=>{const r=e.get(s);if(!r)return;const i=AF(s,"start"),o=AF(s,"end"),a=e.get(i),l=e.get(o);if(r&&a&&l&&r.score>.1&&a.score>.1&&l.score>.1){const c=mMe({x:a.x,y:a.y},{x:r.x,y:r.y},{x:l.x,y:l.y});n[s]=c}}),n},jF=t=>{if(t.length<3)return[];const e=[],n=.08;for(let s=2;s<t.length;s++){const r=t[s-2].pose,i=t[s].pose;let o=!1;if(r!=null&&r.keypoints&&(i!=null&&i.keypoints)){let a=0,l=0;i.keypoints.forEach(d=>{const h=r.keypoints.find(f=>f.name===d.name);if(h&&d.score>.4&&h.score>.4){const f=d.x-h.x,p=d.y-h.y;a+=Math.sqrt(f*f+p*p),l++}}),(l>0?a/l:0)>n&&(o=!0)}o&&e.push(t[s].timestamp)}return e},DF=t=>{if(t.length<5)return[];const e=[],n=.05;let s=-1;for(let r=2;r<t.length-2;r++){const i=t[r-2].pose,o=t[r].pose;let a=0,l=0;i.keypoints&&o.keypoints&&o.keypoints.forEach(d=>{const h=i.keypoints.find(f=>f.name===d.name);if(h&&d.score>.5&&h.score>.5){const f=d.x-h.x,p=d.y-h.y;a+=Math.sqrt(f*f+p*p),l++}});const c=l>0?a/l:0;c<n&&s===-1?s=t[r].timestamp:c>=n&&s!==-1&&(e.push({start:s,end:t[r-1].timestamp}),s=-1)}return s!==-1&&e.push({start:s,end:t[t.length-1].timestamp}),e.filter(r=>r.end-r.start>500)},OF=({timestamps:t,angles:e})=>{if(!t||t.length===0)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"No angle data available."});const n=Object.keys(e);return u.jsxs("div",{className:"mb-6 overflow-x-auto",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Joint Angle Data"}),u.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-800 sticky top-0",children:u.jsxs("tr",{children:[u.jsx("th",{scope:"col",className:"px-4 py-3",children:"Time"}),n.map(s=>u.jsx("th",{scope:"col",className:"px-4 py-3",children:s.replace(/_/g," ")},s))]})}),u.jsx("tbody",{children:t.map((s,r)=>u.jsxs("tr",{className:r%2===0?"bg-gray-900":"bg-gray-800",children:[u.jsx("td",{className:"px-4 py-2",children:s}),n.map(i=>{var o,a;return u.jsxs("td",{className:"px-4 py-2",children:[((a=(o=e[i])==null?void 0:o[r])==null?void 0:a.toFixed(1))||"0","°"]},`${i}-${r}`)})]},r))})]})})]})},gMe=({timestamps:t,userAngles:e,referenceAngles:n})=>{if(!t||t.length===0)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"No timestamp data available for comparison."});const s=Object.keys(e),r=Object.keys(n),i=Array.from(new Set([...s,...r])).filter(c=>{var d,h;return((d=e[c])==null?void 0:d.length)&&((h=n[c])==null?void 0:h.length)});if(i.length===0)return u.jsx("p",{className:"text-gray-400 text-center py-4",children:"No matching joint data available for comparison."});function o(c,d){const f=new MH().compute(c,d),p=Math.max(c.length,d.length)*180,m=Math.max(0,100-f/p*100);return{cost:f,score:Math.round(m)}}const a=i.map(c=>{const d=e[c]||[],h=n[c]||[];return{joint:c,...o(d,h)}}),l=a.length?Math.round(a.reduce((c,d)=>c+d.score,0)/a.length):0;return u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h4",{className:"text-white font-semibold text-lg",children:"DTW Comparison Analysis"}),u.jsxs("div",{className:"bg-gray-800 px-3 py-1 rounded-full",children:[u.jsx("span",{className:"text-gray-300 text-sm mr-2",children:"Overall DTW Score:"}),u.jsxs("span",{className:`font-bold text-lg ${l>=85?"text-green-500":l>=70?"text-yellow-400":l>=50?"text-orange-500":"text-red-500"}`,children:[l,"%"]})]})]}),u.jsxs("div",{className:"text-xs text-gray-300 mb-3 flex flex-wrap gap-2",children:[u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-800 rounded",children:"Excellent: ≥90%"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-800 rounded",children:"Good: 70-89%"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-800 rounded",children:"Fair: 50-69%"}),u.jsx("span",{className:"inline-block px-2 py-1 bg-gray-800 rounded",children:"Poor: <50%"})]}),u.jsx("div",{className:"bg-gray-800/50 p-1 rounded-lg shadow-inner",children:u.jsx("div",{className:"max-h-[400px] overflow-y-auto styled-scrollbar",children:u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-800 sticky top-0 z-10",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"Joint"}),u.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"DTW Score"}),u.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:"DTW Cost"})]})}),u.jsx("tbody",{className:"divide-y divide-gray-700/50",children:a.map(({joint:c,score:d,cost:h})=>{let f="";return d>=90?f="text-green-500":d>=70?f="text-yellow-400":d>=50?f="text-orange-500":f="text-red-500",u.jsxs("tr",{children:[u.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:c.replace(/_/g," ")}),u.jsxs("td",{className:`px-4 py-2 whitespace-nowrap font-semibold ${f}`,children:[d,"%"]}),u.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:h.toFixed(2)})]},c)})})]})})})]})},LH=({isOpen:t,onClose:e,userAngleData:n,referenceAngleData:s})=>t?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-4xl border border-red-600/50 max-h-[90vh] overflow-y-auto",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h3",{className:"text-2xl font-semibold text-white",children:"Test Results"}),u.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:u.jsx("span",{className:"material-icons",children:"close"})})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-xl font-semibold text-white mb-4",children:"Your Joint Angles"}),u.jsx(OF,{timestamps:n.timestamps,angles:n.angles})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-xl font-semibold text-white mb-4",children:"Instructor Joint Angles"}),u.jsx(OF,{timestamps:s.timestamps,angles:s.angles})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-xl font-semibold text-white mb-4",children:"Comparison Analysis (DTW)"}),u.jsx("p",{className:"text-gray-300 mb-4",children:"This analysis uses Dynamic Time Warping (DTW) to compare your movement with the instructor's, providing a robust score for each joint and overall. Lower DTW cost and higher score means your movement closely matches the instructor."}),u.jsx(gMe,{timestamps:n.timestamps,userAngles:n.angles,referenceAngles:s.angles})]}),u.jsx("div",{className:"flex justify-end mt-6",children:u.jsx("button",{onClick:e,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium",children:"Close"})})]})}):null,FF=({timestamps:t,angles:e,title:n})=>{if(!t||t.length===0)return u.jsxs("p",{className:"text-gray-400",children:["No ",n.toLowerCase()," data available."]});const s=Object.keys(e);return u.jsxs("div",{className:"mb-6 overflow-x-auto",children:[u.jsx("h4",{className:"text-white font-medium mb-2 text-lg",children:n}),u.jsx("div",{className:"max-h-60 overflow-y-auto",children:u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-800 sticky top-0",children:u.jsxs("tr",{children:[u.jsx("th",{scope:"col",className:"px-4 py-3",children:"Time"}),s.map(r=>u.jsx("th",{scope:"col",className:"px-4 py-3",children:r.replace(/_/g," ")},r))]})}),u.jsx("tbody",{children:t.map((r,i)=>u.jsxs("tr",{className:i%2===0?"bg-gray-900":"bg-gray-800",children:[u.jsx("td",{className:"px-4 py-2",children:r}),s.map(o=>{var a,l;return u.jsxs("td",{className:"px-4 py-2",children:[((l=(a=e[o])==null?void 0:a[i])==null?void 0:l.toFixed(1))||"N/A","°"]},`${o}-${i}`)})]},i))})]})})]})},xMe=({isOpen:t,onClose:e,onContinue:n,userAngleData:s,referenceAngleData:r})=>{const[i,o]=b.useState(!1),[a,l]=b.useState(!1);return t?u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-md border border-blue-600/50",children:[u.jsx("h3",{className:"text-2xl font-semibold text-white mb-6 text-center",children:"Test Stopped"}),!i&&!a?u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("button",{onClick:()=>o(!0),className:"py-4 bg-blue-600 hover:bg-blue-700 text-white text-lg font-bold rounded-lg shadow-lg flex items-center justify-center gap-2 transition-colors",children:[u.jsx("span",{className:"material-icons",children:"format_list_bulleted"}),"Open Routine Results"]}),u.jsxs("button",{onClick:()=>l(!0),className:"py-4 bg-green-600 hover:bg-green-700 text-white text-lg font-bold rounded-lg shadow-lg flex items-center justify-center gap-2 transition-colors",children:[u.jsx("span",{className:"material-icons",children:"assessment"}),"Open Test Results"]}),u.jsxs("button",{onClick:e,className:"py-4 bg-gray-700 hover:bg-gray-600 text-white text-lg font-bold rounded-lg shadow-lg flex items-center justify-center gap-2 transition-colors mt-2",children:[u.jsx("span",{className:"material-icons",children:"close"}),"Close"]})]}):a?u.jsx(LH,{isOpen:a,onClose:()=>l(!1),userAngleData:s,referenceAngleData:r}):u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-xl font-semibold text-white",children:"Routine Results"}),u.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-white",children:u.jsx("span",{className:"material-icons",children:"arrow_back"})})]}),s&&u.jsx(FF,{timestamps:s.timestamps,angles:s.angles,title:"Your Captured Angles"}),r&&u.jsx(FF,{timestamps:r.timestamps,angles:r.angles,title:"Reference Angles (Expected)"}),!s&&!r&&u.jsx("p",{className:"text-gray-400 text-center py-8",children:"Angle data is being processed or is not available."})]})]})}):null},yMe=[{id:"taekwondo-form-1",name:"Taegeuk 1 - Il Jang",description:"First taekwondo poomsae with basic stances and blocks",category:"taekwondo",difficulty:"beginner",duration:"2:30",videoUrl:"/videos/taekwondo/Taegeuk 1 Il Jang.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 1 Il Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-2",name:"Taegeuk 2 - Ee Jang",description:"Second taekwondo poomsae with advancing techniques",category:"taekwondo",difficulty:"beginner",duration:"2:03",videoUrl:"/videos/taekwondo/Taegeuk 2 Ee Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 2 Ee Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-3",name:"Taegeuk 3 - Sam Jang",description:"Third taekwondo poomsae with enhanced stance work and kicking techniques",category:"taekwondo",difficulty:"intermediate",duration:"2:12",videoUrl:"/videos/taekwondo/Taegeuk 3 Sam Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 3 Sam Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-4",name:"Taegeuk 4 - Sa Jang",description:"Fourth taekwondo poomsae with advanced combinations and footwork",category:"taekwondo",difficulty:"intermediate",duration:"2:05",videoUrl:"/videos/taekwondo/Taegeuk 4 Sa Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 4 Sa Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-5",name:"Taegeuk 5 - Oh Jang",description:"Fifth taekwondo poomsae with complex turning movements and techniques",category:"taekwondo",difficulty:"intermediate",duration:"2:18",videoUrl:"/videos/taekwondo/Taegeuk 5 Oh Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 5 Oh Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-6",name:"Taegeuk 6 - Yook Jang",description:"Sixth taekwondo poomsae with advanced kicking and defensive techniques",category:"taekwondo",difficulty:"advanced",duration:"2:14",videoUrl:"/videos/taekwondo/Taegeuk 6 Yook Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 6 Yook Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-7",name:"Taegeuk 7 - Chil Jang",description:"Seventh taekwondo poomsae with sophisticated movements and advanced techniques",category:"taekwondo",difficulty:"advanced",duration:"2:45",videoUrl:"/videos/taekwondo/Taegeuk 7 Chil Jang June 16 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 7 Chil Jang.jpg",isLocalFile:!0},{id:"taekwondo-form-8",name:"Taegeuk 8 - Pal Jang",description:"Eighth taekwondo poomsae with master-level techniques and complex combinations",category:"taekwondo",difficulty:"advanced",duration:"2:29",videoUrl:"/videos/taekwondo/Taegeuk 8 Pal Jang June 17 2025.mp4",thumbnailUrl:"/videos/taekwondo/Taegeuk 8 Pal Jang.jpg",isLocalFile:!0},{id:"karate-kata-1",name:"Heian Shodan",description:"First kata in the Heian series - fundamental Shotokan karate form with basic blocks, punches and stances",category:"karate",difficulty:"beginner",duration:"2:28",videoUrl:"/videos/karate/Heian Shodan June 17 2025.mp4",thumbnailUrl:"/videos/karate/Heian Shodan.jpg",isLocalFile:!0},{id:"karate-kata-2",name:"Heian Nidan",description:"Second kata in the Heian series - builds on Heian Shodan with new techniques including knife hand and side kicks",category:"karate",difficulty:"beginner",duration:"2:42",videoUrl:"/videos/karate/Heian Nidan June 18 2025.mp4",thumbnailUrl:"/videos/karate/Heian Nidan.jpg",isLocalFile:!0},{id:"karate-kata-3",name:"Heian Sandan",description:"Third kata in the Heian series - introduces more complex movements, turns, and advanced techniques",category:"karate",difficulty:"intermediate",duration:"2:32",videoUrl:"/videos/karate/Heian Sandan June 18 2025.mp4",thumbnailUrl:"/videos/karate/Heian Sandan.jpg",isLocalFile:!0}],vMe=()=>yMe.reduce((e,n)=>(e[n.category]||(e[n.category]=[]),e[n.category].push(n),e),{});function BH({onVideoSelect:t,onCancel:e}){var l,c;const[n,s]=b.useState("taekwondo");b.useState(null),b.useRef(null);const r=vMe(),i=Object.keys(r),o=d=>{const h=document.createElement("video");h.src=d.videoUrl,h.crossOrigin="anonymous",h.muted=!0,h.playsInline=!0,h.onloadedmetadata=()=>{t(h,d.videoUrl,d)},h.onerror=()=>{console.error("Failed to load video:",d.videoUrl),t(null,d.videoUrl,d)}},a=d=>{switch(d){case"beginner":return"text-green-500";case"intermediate":return"text-yellow-500";case"advanced":return"text-red-500";default:return"text-gray-500"}};return u.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Select Reference Video"}),u.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white text-2xl",children:"✕"})]}),u.jsx("div",{className:"flex space-x-2 mb-6 overflow-x-auto",children:i.map(d=>u.jsx("button",{onClick:()=>s(d),className:`px-4 py-2 rounded-lg capitalize whitespace-nowrap ${n===d?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:d.replace("-"," ")},d))}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(l=r[n])==null?void 0:l.map(d=>u.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden hover:bg-gray-700 transition-colors cursor-pointer",onClick:()=>o(d),children:[u.jsx("div",{className:"aspect-video bg-gray-700 flex items-center justify-center",children:u.jsx("img",{src:d.thumbnailUrl,alt:d.name,className:"w-full h-full object-cover",onError:h=>{const f=h.target;f.style.display="none",f.parentElement.innerHTML=`
                    <div class="flex items-center justify-center h-full text-gray-400">
                      <span class="text-4xl">🎥</span>
                    </div>
                  `}})}),u.jsxs("div",{className:"p-4",children:[u.jsx("h3",{className:"text-white font-semibold mb-2 line-clamp-2",children:d.name}),u.jsx("p",{className:"text-gray-400 text-sm mb-3 line-clamp-2",children:d.description}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:`font-medium ${a(d.difficulty)}`,children:d.difficulty.charAt(0).toUpperCase()+d.difficulty.slice(1)}),u.jsx("span",{className:"text-gray-500",children:d.duration})]})]})]},d.id))}),((c=r[n])==null?void 0:c.length)===0&&u.jsxs("div",{className:"text-center py-12",children:[u.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No videos available"}),u.jsxs("div",{className:"text-gray-500 text-sm",children:["Videos for ",n," category will appear here when added"]})]}),u.jsx("div",{className:"flex justify-center mt-6",children:u.jsx("button",{onClick:e,className:"px-6 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"})})]})}function bMe({stream:t,isTracking:e,confidenceThreshold:n,modelSelection:s,maxPoses:r,skeletonColor:i,showSkeleton:o,showPoints:a,showBackground:l,backgroundOpacity:c,backgroundBlur:d,sourceType:h,imageElement:f,videoElement:p,mediaUrl:m,showReferenceOverlay:g=!1,isFullscreenMode:x=!1,onScreenshot:y,toggleTracking:v,toggleReferenceOverlay:S,cameraFacing:C,setCameraFacing:k,externalIsRecording:T,onRecordClick:_,routineNotes:$="",setRoutineNotes:R,customBackground:A}){const j=v||(()=>{console.log("Toggle tracking clicked, but no handler was provided")}),F=S||(()=>{console.log("Toggle reference overlay clicked, but no handler was provided")}),L=b.useRef(null),M=b.useRef(null);b.useRef(null),b.useRef(null);const q=b.useRef(null),z=b.useRef(null),[re,U]=b.useState(!1),[G,xe]=b.useState(!1),[Ce,De]=b.useState(!1),[fe,ee]=b.useState(!1),[Pe,Re]=b.useState(1),[ce,me]=b.useState(!1),[ie,Q]=b.useState(""),[oe,ae]=b.useState({isRunning:!1,processing:!1,scores:[],overallScore:0,feedback:"",dtwScores:{},dtwResults:{}}),[Ae,Be]=b.useState(!1);b.useState(!1);const[Xe,lt]=b.useState(!1),[Me,je]=b.useState(!1),[Ze,Ye]=b.useState(void 0),[Ie,B]=b.useState(!1),[Z,te]=b.useState(!1),[ve,we]=b.useState(!1),[de,Ee]=b.useState(null),[mt,It]=b.useState([]),[jt,hs]=b.useState(void 0),[fn,dt]=b.useState(!1);b.useEffect(()=>{T!==void 0&&T!==fn&&dt(T)},[T]);const[At,Vs]=b.useState(null),[Ln,lr]=b.useState(null),[qn,Ei]=b.useState([]),[is,Mo]=b.useState([]);b.useState([]),b.useState([]),b.useState([]);const fs=b.useRef(0),pe=3,$e=6,Te=b.useRef(0),Je=b.useRef([]),He=b.useRef(3),it=()=>{const le=performance.now();if(Je.current.push(le),Je.current.length>10&&Je.current.shift(),Je.current.length>=10){const Fe=le-Je.current[0],Ve=(Je.current.length-1)/(Fe/1e3);if(Ve<15&&G){const Qe=He.current;He.current=Math.min(6,He.current+1),He.current!==Qe&&console.log(`⚡ Performance optimization: Increased frame skip rate to ${He.current} (FPS: ${Ve.toFixed(1)})`)}else if(Ve>25&&!G){const Qe=He.current;He.current=Math.max(2,He.current-1),He.current!==Qe&&console.log(`⚡ Performance restored: Decreased frame skip rate to ${He.current} (FPS: ${Ve.toFixed(1)})`)}}},[Ot,Yt]=b.useState({scale:1,isCorrect:!1,message:"",showMeter:!1}),[On,en]=b.useState([]),[An,os]=b.useState(!1),[Ht,zs]=b.useState(0),[nl,Lo]=b.useState(3),[ts,$i]=b.useState([]),[wa,Bo]=b.useState({}),[zl,Vo]=b.useState({}),[oi,Wl]=b.useState({}),[$r,Xs]=b.useState(!1),[Ii,sl]=b.useState(null),[as,Oe]=b.useState({}),[_t,Zt]=b.useState({}),Es=b.useRef(!1),Ri=b.useRef(!1),[yr,to]=b.useState(null);b.useEffect(()=>{if(A){const le=new Image;le.onload=()=>to(le),le.src=A}else to(null)},[A]),b.useEffect(()=>{const le=localStorage.getItem("routineNotes");le&&R&&(Q(le),R(le))},[R]),b.useEffect(()=>{$&&(localStorage.setItem("routineNotes",$),Q($))},[$]),b.useEffect(()=>{const le=L.current;if(!le)return;const Fe=()=>{console.log("Camera metadata loaded, video dimensions:",le.videoWidth,"x",le.videoHeight),le.videoWidth>0&&le.videoHeight>0&&U(!0)};return(G||h==="camera")&&t?(le.srcObject=t,le.addEventListener("loadedmetadata",Fe),le.play().catch(Ve=>{console.error("Error playing camera stream:",Ve)})):!G&&h==="video"&&p&&m?(le.srcObject=null,le.src=m,le.loop=!0,le.muted=!0,le.addEventListener("loadedmetadata",Fe),Ce?le.pause():le.play().catch(Ve=>{console.error("Error playing video file:",Ve)})):U(!1),()=>{q.current&&cancelAnimationFrame(q.current),le.removeEventListener("loadedmetadata",Fe),le&&!le.srcObject&&(le.pause(),le.src="",le.load())}},[t,h,m,p,Ce,G]),b.useEffect(()=>{console.log("Running pose detection with parameters:",{sourceType:h,modelSelection:s,confidenceThreshold:n,showSkeleton:o,maxPoses:r,isFullscreenMode:x});let le=null;if(h==="image"&&f){if(le=f,console.log(`Using image source: ${f.naturalWidth}x${f.naturalHeight}, loaded: ${f.complete}`),!f.complete||f.naturalWidth===0){console.log("Image not fully loaded, waiting..."),re&&U(!1);return}}else if(h==="camera"&&L.current){le=L.current;const pt=le.videoWidth>0&&le.videoHeight>0;if(!(le.readyState>=HTMLMediaElement.HAVE_METADATA)||!pt){console.log("Camera not ready yet (readyState < 1 or dimensions are zero). Waiting..."),re&&U(!1);return}}else if((h==="video"||G)&&L.current){le=L.current;const pt=le.videoWidth>0&&le.videoHeight>0;if(!(le.readyState>=HTMLMediaElement.HAVE_ENOUGH_DATA)||!pt){console.log("Video not ready yet, waiting for more data"),re&&U(!1);return}}else{console.log("No valid source element found for pose detection useEffect."),re&&U(!1);return}const Fe=M.current;if(!le||!Fe){console.log("Source or canvas element not available");return}if(x){const pt=document.getElementById("cameraContainer");if(pt){console.log("Adjusting canvas for fullscreen mode"),pt.clientWidth,pt.clientHeight,Fe.style.width="100%",Fe.style.height="100%",Fe.style.objectFit="contain";const Ne=document.querySelector(".camera-container");Ne&&(Ne.style.display="flex",Ne.style.justifyContent="center",Ne.style.alignItems="center")}}let Ve=null;const Qe=pt=>pt==="blue"?{r:59,g:130,b:246}:pt==="green"?{r:16,g:185,b:129}:pt==="purple"?{r:139,g:92,b:246}:pt==="orange"?{r:249,g:115,b:22}:{r:239,g:68,b:68},rt=async()=>{var pt;try{if(fs.current=(fs.current+1)%pe,!e){Ri.current=!1,q.current=requestAnimationFrame(rt);return}if(fs.current!==0){q.current=requestAnimationFrame(rt);return}const Ne=(pt=M.current)==null?void 0:pt.getContext("2d"),St=L.current;if(!Ne||!St){q.current=requestAnimationFrame(rt);return}const gt=Ne.canvas,vt=gt.clientWidth||gt.width,Xt=gt.clientHeight||gt.height;if(Ne.canvas.width=vt,Ne.canvas.height=Xt,Ne.clearRect(0,0,vt,Xt),l&&(A&&yr?(Ne.globalAlpha=c,d>0&&(Ne.filter=`blur(${d}px)`),Ne.drawImage(yr,0,0,vt,Xt),Ne.filter="none",Ne.globalAlpha=1):(Ne.globalAlpha=c,d>0&&(Ne.filter=`blur(${d}px)`),Ne.drawImage(St,0,0,vt,Xt),Ne.filter="none",Ne.globalAlpha=1)),e&&re)try{Ri.current||(Ri.current=!0);const ws=G?He.current:pe,$n=fs.current%ws!==0;fs.current=(fs.current+1)%(ws*10);const rn=await pr(le,r,n);it();const Fn=St.videoWidth||St.width||vt,Vt=St.videoHeight||St.height||Xt,yn=vt/Fn,Rs=Xt/Vt;if(le===L.current&&rn&&rn.length>0){if(Vs(rn[0]),G&&z.current&&z.current.readyState>=2&&(Te.current=(Te.current+1)%$e,Te.current===0&&!oe.isRunning))try{const xn=await pr(z.current,1,n);xn&&xn.length>0&&(lr(xn[0]),G&&z.current&&he(rn[0],xn[0]))}catch(xn){console.error("Error detecting pose on reference video:",xn)}if(oe.isRunning&&z.current&&z.current.readyState>=2)try{const xn=await pr(z.current,1,n);if(xn&&xn.length>0){console.log("Setting reference pose with keypoints:",xn[0].keypoints.length),lr(xn[0]),An&&en(Jt=>[...Jt,xn[0]]);const Et=Date.now();if(Ht>0&&Et-Ht<1e3)console.log(`In grace period: ${Math.round((Et-Ht)/100)/10}s elapsed, pausing comparisons`);else{let Jt=xn[0];if(is.length>0){const cn=ge(Et,is);cn&&(Jt=cn)}const kn=ke(rn[0],Jt);ae(cn=>({...cn,scores:kn.jointScores,overallScore:kn.overallScore}))}}}catch(xn){console.error("Error detecting poses on reference video:",xn)}rn.forEach(xn=>{const Et=xn.keypoints,pn=[["left_shoulder","right_shoulder"],["left_shoulder","left_hip"],["right_shoulder","right_hip"],["left_hip","right_hip"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_hip","right_knee"],["right_knee","right_ankle"],["nose","left_eye"],["nose","right_eye"],["left_eye","left_ear"],["right_eye","right_ear"]];if(oe.isRunning&&h==="camera"&&(console.log("TEST MODE ACTIVE - Should draw green skeleton"),z.current&&z.current.readyState>=2?console.log("Using reference video for overlay - video is ready"):Ln?console.log("Using cached reference pose with keypoints:",Ln.keypoints.length):console.log("NO REFERENCE POSE AVAILABLE YET"),Ln&&Ln.keypoints)){const Jt=Ln.keypoints;if(Jt&&Jt.length>0){console.log("Reference keypoints found:",Jt.length);const kn=new Date().toISOString().substr(11,8),cn=tc(Ln);if(!Es.current){const ls=Date.now();Object.entries(cn).forEach(([Qs,Ws])=>{Zt(cs=>({...cs,[Qs]:[...cs[Qs]||[],{angle:Ws,timestamp:ls}]}))}),ae(Qs=>{const Ws=Qs.instructorAngleTable||{timestamps:[],angles:{}},cs={...Ws.angles};return Object.entries(cn).forEach(([vr,li])=>{cs[vr]||(cs[vr]=[]),cs[vr].push(li)}),{...Qs,instructorAngleTable:{timestamps:[...Ws.timestamps,kn],angles:cs}}})}}}if(o){const Jt=cn=>cn==="blue"?{r:59,g:130,b:246}:cn==="green"?{r:16,g:185,b:129}:cn==="purple"?{r:139,g:92,b:246}:cn==="orange"?{r:249,g:115,b:22}:{r:239,g:68,b:68},kn=Jt(i);Ne.strokeStyle=i==="blue"?"#3b82f6":i==="green"?"#10b981":i==="purple"?"#8b5cf6":i==="orange"?"#f97316":"#ef4444",Ne.lineWidth=3,pn.forEach(cn=>{const ls=cn[0],Qs=cn[1],Ws=Et.find(vr=>vr.name===ls),cs=Et.find(vr=>vr.name===Qs);if(Ws&&cs&&typeof Ws.score=="number"&&typeof cs.score=="number"&&Ws.score>n&&cs.score>n){const vr=Jt(i);Ne.shadowColor=`rgba(${vr.r}, ${vr.g}, ${vr.b}, 0.7)`,Ne.shadowBlur=10,Ne.beginPath(),Ne.moveTo(Ws.x*yn,Ws.y*Rs),Ne.lineTo(cs.x*yn,cs.y*Rs),Ne.stroke(),Ne.shadowColor="transparent",Ne.shadowBlur=0}})}if(a){const Jt=i==="blue"?"#3b82f6":i==="green"?"#10b981":i==="purple"?"#8b5cf6":i==="orange"?"#f97316":"#ef4444";Et.forEach(kn=>{if(typeof kn.score=="number"&&kn.score>n){const{x:cn,y:ls}=kn,Qs=Qe(i);Ne.shadowColor=`rgba(${Qs.r}, ${Qs.g}, ${Qs.b}, 0.7)`,Ne.shadowBlur=15,Ne.fillStyle=Jt,Ne.beginPath(),Ne.arc(cn*yn,ls*Rs,6,0,2*Math.PI),Ne.fill(),Ne.shadowColor="transparent",Ne.shadowBlur=0}})}if(o&&e){Ne.font="bold 16px Arial",Ne.textAlign="center",Ne.textBaseline="middle",Ne.lineWidth=2;const Jt=tc(rn[0]);Bo(Jt),e&&fd(Jt),Object.entries(Jt).forEach(([kn,cn])=>{if(["nose","left_eye","right_eye","left_ear","right_ear"].includes(kn))return;const ls=Et.find(Qs=>Qs.name===kn);if(ls&&typeof ls.score=="number"&&ls.score>.3){const Qs=Yy(kn,"start"),Ws=Yy(kn,"end"),cs=Et.find(li=>li.name===Qs),vr=Et.find(li=>li.name===Ws);if(cs&&vr){const li=ls.x*yn,Sa=ls.y*Rs,Vc=li>vt/2?-30:30,Hl=Sa>Xt/2?-30:30;Ne.fillStyle="rgba(0, 0, 0, 0.8)",Ne.beginPath(),Ne.arc(li+Vc/2,Sa+Hl/2,22,0,2*Math.PI),Ne.fill(),Ne.strokeStyle="#ef4444",Ne.lineWidth=2,Ne.shadowColor="#ef4444",Ne.shadowBlur=5,Ne.beginPath(),Ne.arc(li+Vc/2,Sa+Hl/2,22,0,2*Math.PI),Ne.stroke(),Ne.shadowBlur=0,Ne.shadowColor="transparent",Ne.fillStyle="white",Ne.fillText(`${cn}°`,li+Vc/2,Sa+Hl/2),Ne.strokeStyle="#ef4444",Ne.lineWidth=1.5,Ne.beginPath(),Ne.moveTo(li,Sa),Ne.lineTo(li+Vc/2,Sa+Hl/2),Ne.stroke()}}})}})}}catch(ws){console.error("Error during pose detection:",ws)}else e&&!re?console.log("detect(): Tracking active, but media not loaded. Skipping pose drawing."):!e&&l&&re?Ne.drawImage(le,0,0,gt.width,gt.height):!e&&l&&!re&&Ne&&Ne.clearRect(0,0,Ne.canvas.width,Ne.canvas.height);Ve=requestAnimationFrame(rt)}catch(Ne){console.error("Error during pose detection:",Ne),Ve=requestAnimationFrame(rt)}};return rt(),()=>{Ve&&cancelAnimationFrame(Ve)}},[t,e,n,r,i,o,a,h,f,l,c,d,x,s,oe.isRunning,re]),b.useEffect(()=>{if(!g||!e||!m||!re)return;let le=null;if(Xm(m))le=document.querySelector(".reference-video");else{const rt=document.querySelectorAll('img[alt="Reference image"]');rt.length>0&&(le=rt[0])}if(!le){console.error("Could not find reference media element for skeleton overlay");return}let Fe=document.querySelector(".reference-skeleton-canvas");if(!Fe){Fe=document.createElement("canvas"),Fe.className="reference-skeleton-canvas absolute top-0 left-0 w-full h-full z-10";const rt=le.parentElement;if(rt)rt.appendChild(Fe);else{console.error("Could not find reference panel to append skeleton canvas");return}}let Ve=null;const Qe=async()=>{if(!le||!Fe)return;if(le instanceof HTMLImageElement&&!le.complete){Ve=requestAnimationFrame(Qe);return}if(le instanceof HTMLVideoElement&&(le.readyState<2||le.videoWidth===0)){Ve=requestAnimationFrame(Qe);return}const rt=le instanceof HTMLImageElement?le.naturalWidth:le.videoWidth,pt=le instanceof HTMLImageElement?le.naturalHeight:le.videoHeight,Ne=Fe.parentElement;Ne?(Fe.width=Ne.clientWidth,Fe.height=Ne.clientHeight):(Fe.width=rt,Fe.height=pt);const St=Fe.getContext("2d");if(St){St.clearRect(0,0,Fe.width,Fe.height);try{const gt=await pr(le,1,n);if(Math.random()<.1&&console.log("📊 Reference pose data collection (visual rendering disabled for performance):",gt==null?void 0:gt.length),gt&&gt.length>0){const vt=Fe.width/rt,Xt=Fe.height/pt,ws=gt[0],$n=ws.keypoints,rn=tc(ws);if(console.log("Reference pose angles:",rn),!Es.current){const yn=Date.now();Object.entries(rn).forEach(([xn,Et])=>{rn[xn]&&Zt(pn=>({...pn,[xn]:[...pn[xn]||[],{angle:Et,timestamp:yn}]}))});const Rs=new Date().toISOString().substr(11,8);ae(xn=>{const Et=xn.instructorAngleTable||{timestamps:[],angles:{}},pn={...Et.angles};return Object.entries(rn).forEach(([Jt,kn])=>{pn[Jt]||(pn[Jt]=[]),pn[Jt].push(kn)}),{...xn,instructorAngleTable:{timestamps:[...Et.timestamps,Rs],angles:pn}}}),console.log("Stored reference angles in history with timestamp:",yn)}const Vt=(yn=>yn==="blue"?{r:59,g:130,b:246}:yn==="green"?{r:16,g:185,b:129}:yn==="purple"?{r:139,g:92,b:246}:yn==="orange"?{r:249,g:115,b:22}:{r:239,g:68,b:68})(i);console.log("🚀 Reference skeleton visual rendering disabled for performance")}}catch(gt){console.error("Error during reference pose detection:",gt)}le instanceof HTMLVideoElement&&!Ce?setTimeout(()=>{Ve&&cancelAnimationFrame(Ve),Ve=requestAnimationFrame(Qe)},G?200:33):le instanceof HTMLImageElement&&setTimeout(()=>{Ve&&cancelAnimationFrame(Ve),Ve=requestAnimationFrame(Qe)},G?500:100)}};return Qe(),()=>{Ve&&cancelAnimationFrame(Ve);const rt=document.querySelector(".reference-skeleton-canvas");rt&&rt.remove()}},[G,g,e,m,Ce,n,r,i,a,x,s,oe.isRunning,re]);const of=()=>{if(m&&Xm(m)&&z.current){const Fe=z.current;console.log("Toggling reference video playback",Ce?"playing":"pausing"),Ce?Fe.play().catch(Ve=>console.error("Error playing reference video:",Ve)):Fe.pause(),De(!Ce);return}const le=L.current;le&&(Ce?le.play().catch(Fe=>console.error("Error playing main video:",Fe)):le.pause(),De(!Ce))},rl=le=>{Re(le),z.current&&(z.current.playbackRate=le),L.current&&!z.current&&(L.current.playbackRate=le)},[Ul,af]=b.useState({delays:!1,gaps:!1,speed:"good"}),ne=()=>{if(qn.length>10&&is.length>10){const le=jF(qn),Fe=jF(is);let Ve=0,Qe=0;const rt=[],pt=300;for(let pn=0;pn<le.length;pn++){let Jt=-1,kn=Number.MAX_VALUE;for(let cn=0;cn<Fe.length;cn++){const ls=Math.abs(le[pn]-Fe[cn]);ls<kn&&(kn=ls,Jt=cn)}if(Jt>=0&&kn<=pt){const cn=le[pn]-Fe[Jt];rt.push(cn),Ve+=cn,Qe++,$i(ls=>[...ls,cn])}}const Ne=Qe>0?Ve/Qe:0,St=Math.abs(Ne)>300;let gt=0,vt=0;rt.forEach(pn=>{pn>0?gt++:pn<0&&vt++});const ws=(rt.length>0?Math.max(gt,vt)/rt.length:0)>=.7,$n=St&&ws,rn=DF(qn),Fn=DF(is),Vt=rn.length>Fn.length+1,yn=qn.length>1?qn[qn.length-1].timestamp-qn[0].timestamp:0,Rs=is.length>1?is[is.length-1].timestamp-is[0].timestamp:0;let xn="good";if(Rs>0){const pn=yn/Rs;pn>1.25?xn="slow":pn<.75&&(xn="fast")}return af({delays:$n,gaps:Vt,speed:xn}),{delayDirection:$n?Ne>0?"behind":"ahead":void 0,delayMs:Math.round(Ne),gaps:Vt,speed:xn,matchQuality:Qe/Math.max(le.length,Fe.length,1)}}return null},he=(le,Fe)=>{if(!(!le||!Fe))try{const Ve=le.keypoints.find(Fn=>Fn.name==="left_shoulder"),Qe=le.keypoints.find(Fn=>Fn.name==="right_shoulder"),rt=Fe.keypoints.find(Fn=>Fn.name==="left_shoulder"),pt=Fe.keypoints.find(Fn=>Fn.name==="right_shoulder");if(!(Ve!=null&&Ve.score)||!(Qe!=null&&Qe.score)||!(rt!=null&&rt.score)||!(pt!=null&&pt.score)||Ve.score<.5||Qe.score<.5||rt.score<.5||pt.score<.5){Yt({scale:1,isCorrect:!1,message:"Position yourself clearly in view",showMeter:G&&!oe.isRunning});return}const Ne=Math.abs(Ve.x-Qe.x),St=Math.abs(rt.x-pt.x),gt=Ne/St,vt=gt>1.3,Xt=gt<.7,ws=gt>.9&&gt<1.1;let $n="",rn=!1;vt?($n="Step back",rn=!1):Xt?($n="Step closer",rn=!1):ws?($n="Perfect distance",rn=!0):($n="Good distance",rn=!0),Yt({scale:gt,isCorrect:rn,message:$n,showMeter:G&&!oe.isRunning})}catch(Ve){console.error("Error updating distance meter:",Ve)}},ge=(le,Fe,Ve=300)=>{if(!Fe.length)return null;const Qe=le-Ve,rt=le+Ve,pt=Fe.filter(vt=>vt.timestamp>=Qe&&vt.timestamp<=rt);if(!pt.length){let vt=Fe[0],Xt=Math.abs(Fe[0].timestamp-le);for(let $n=1;$n<Fe.length;$n++){const rn=Math.abs(Fe[$n].timestamp-le);rn<Xt&&(Xt=rn,vt=Fe[$n])}const ws=vt.timestamp-le;return $i($n=>[...$n,ws]),vt.pose}let Ne=pt[0],St=Math.abs(pt[0].timestamp-le);for(let vt=1;vt<pt.length;vt++){const Xt=Math.abs(pt[vt].timestamp-le);Xt<St&&(St=Xt,Ne=pt[vt])}const gt=Ne.timestamp-le;return $i(vt=>[...vt,gt]),Ne.pose},ke=(le,Fe)=>{var rn,Fn;if(console.log("=== Starting Pose Comparison ==="),console.log("User Pose:",(rn=le==null?void 0:le.keypoints)==null?void 0:rn.length,"keypoints"),console.log("Reference Pose:",(Fn=Fe==null?void 0:Fe.keypoints)==null?void 0:Fn.length,"keypoints"),!le||!Fe)return{jointScores:[],overallScore:0};const Ve=Date.now();if(Ht>0&&Ve<Ht+1e3)return{jointScores:[],overallScore:0};Ei(Vt=>[...Vt.slice(-50),{pose:le,timestamp:Ve}]),Mo(Vt=>[...Vt.slice(-50),{pose:Fe,timestamp:Ve}]);const Qe=tc(le),rt=tc(Fe);_d.forEach(Vt=>{Qe[Vt]!==void 0&&Vo(yn=>({...yn,[Vt]:[...(yn[Vt]||[]).slice(-100),Qe[Vt]]})),rt[Vt]!==void 0&&Wl(yn=>({...yn,[Vt]:[...(yn[Vt]||[]).slice(-100),rt[Vt]]}))});const pt=le.keypoints||[],Ne=Fe.keypoints||[],St=new Map,gt=new Map;pt.forEach(Vt=>{Vt.score>.3&&St.set(Vt.name,Vt)}),Ne.forEach(Vt=>{Vt.score>.3&&gt.set(Vt.name,Vt)});const vt=["left_knee","right_knee","left_ankle","right_ankle","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip"],Xt=[];let ws=0;console.log("=== Joint Angle Comparisons ==="),vt.forEach(Vt=>{const yn=St.get(Vt),Rs=gt.get(Vt),xn=Yy(Vt,"start"),Et=Yy(Vt,"end"),pn=St.get(xn),Jt=St.get(Et),kn=gt.get(xn),cn=gt.get(Et);if(yn&&Rs&&pn&&Jt&&kn&&cn){console.log(`
Comparing angles for ${Vt}:`);const ls=MF({x:pn.x,y:pn.y},{x:yn.x,y:yn.y},{x:Jt.x,y:Jt.y}),Qs=MF({x:kn.x,y:kn.y},{x:Rs.x,y:Rs.y},{x:cn.x,y:cn.y});console.log(`${Vt} angles: User=${ls}°, Reference=${Qs}°`);let Ws=Math.abs(Qs-ls);Ws>180&&(Ws=360-Ws),console.log(`${Vt} angle difference: ${Ws}°`);const cs=Math.round(100*Math.exp(-Ws/10));console.log(`${Vt} score (from angle diff): ${cs}`);const vr=cs>=85?"good":cs>=70?"fair":cs>=50?"poor":"bad",Sa=(ls-Qs+360)%360<180?"left":"right",Vc=Math.abs(Ws)>45?"major":"minor",Hl=Math.min(3,Math.floor(Ws/30));Xt.push({joint:Vt,score:cs,severity:vr,direction:{x:Sa,y:Vc==="major"?"major":"minor",xMagnitude:Hl,yMagnitude:Hl}}),ws+=cs}});const $n=ne();return $n&&(console.log("Sequence analysis:",$n),$n.delayDirection==="behind"?console.log("User is consistently behind the reference"):$n.delayDirection==="ahead"&&console.log("User is consistently ahead of the reference"),$n.gaps&&console.log("User has extra pauses in their movements"),$n.speed!=="good"&&console.log(`User is moving ${$n.speed} compared to reference`)),{jointScores:Xt,overallScore:ws}},ft=()=>{G?(xe(!1),ee(!1)):(xe(!0),ee(!0))},Tt=()=>{_&&_(),fn?(zn(),oe.isRunning&&ae(le=>({...le,isRunning:!1}))):gn()},gn=()=>{if(fn||!M.current){console.log("Recording already in progress or canvas not ready.");return}console.log("Attempting to start recording...");const le=M.current.captureStream(30);if(!le){console.error("Failed to capture stream from canvas.");return}const Ve=["video/webm;codecs=vp9,opus","video/webm;codecs=vp9","video/webm;codecs=vp8,opus","video/webm;codecs=vp8","video/webm","video/mp4;codecs=h264","video/mp4"].find(Qe=>MediaRecorder.isTypeSupported(Qe));if(!Ve){console.error("No supported MIME type found for MediaRecorder."),alert("Video recording is not supported by your browser or no suitable codec found.");return}console.log("Using MIME type:",Ve);try{const Qe=new MediaRecorder(le,{mimeType:Ve});Ee(Qe),It([]),Qe.ondataavailable=rt=>{rt.data.size>0&&It(pt=>[...pt,rt.data])},Qe.onstop=()=>{console.log("Recording stopped. Chunks collected:",mt.length),It(rt=>{if(rt.length===0)return console.warn("No data chunks recorded."),[];const pt=new Blob(rt,{type:Ve}),Ne=URL.createObjectURL(pt);return console.log("Blob created, URL:",Ne),hs(Ne),An?console.log("Test recording completed, skipping popup and going to results"):lt(!0),le.getTracks().forEach(St=>St.stop()),console.log("Canvas stream tracks stopped."),rt})},Qe.onerror=rt=>{console.error("MediaRecorder error:",rt),alert("An error occurred during recording."),dt(!1),le.getTracks().forEach(pt=>pt.stop())},Qe.start(),console.log("Recording started successfully."),dt(!0)}catch(Qe){console.error("Error initializing MediaRecorder:",Qe),alert("Failed to initialize video recorder. Your browser might not support the required features."),le.getTracks().forEach(rt=>rt.stop())}},zn=()=>{console.log("Attempting to stop recording..."),de&&de.state==="recording"?(de.stop(),console.log("MediaRecorder.stop() called.")):console.log("MediaRecorder not recording or not available."),An&&(os(!1),setTimeout(()=>{ae(le=>({...le,isRunning:!1,processing:!0})),setTimeout(()=>{var pt,Ne;const le=Ys.timestamps.length>0?{timestamps:Ys.timestamps,angles:Ys.angles}:((pt=as[Object.keys(as)[0]])==null?void 0:pt.length)>0?{timestamps:as[Object.keys(as)[0]].map(St=>new Date(St.timestamp).toISOString().substr(11,8)),angles:Object.fromEntries(Object.entries(as).map(([St,gt])=>[St,gt.map(vt=>vt.angle)]))}:{timestamps:[],angles:{}},Fe=100,Ve=Object.keys(_t)[0],rt=Ve&&((Ne=_t[Ve])==null?void 0:Ne.length)>0?{timestamps:_t[Ve].slice(-Fe).map(St=>new Date(St.timestamp).toISOString().substr(11,8)),angles:Object.fromEntries(Object.entries(_t).map(([St,gt])=>[St,gt.slice(-Fe).map(vt=>vt.angle)]))}:{timestamps:[],angles:{}};ae(St=>({...St,processing:!1,userAngleTable:le,instructorAngleTable:rt})),Xs(!0),Be(!0)},1e3)},500))},Cn=()=>{if(lt(!1),jt&&(URL.revokeObjectURL(jt),console.log("Revoked recorded video URL:",jt)),hs(void 0),It([]),de&&de.state!=="inactive")try{de.stream&&de.stream.getTracks().forEach(le=>le.stop())}catch(le){console.warn("Error stopping tracks on mediaRecorder cleanup",le)}Ee(null),dt(!1)};b.useEffect(()=>{if(Ht>0&&oe.isRunning){const le=()=>{const Ve=Date.now()-Ht;if(Ve<1e3){const Qe=Math.ceil((1e3-Ve)/1e3);Lo(Qe),requestAnimationFrame(le)}else Lo(0)},Fe=requestAnimationFrame(le);return()=>cancelAnimationFrame(Fe)}},[Ht,oe.isRunning]),b.useEffect(()=>()=>{jt&&Xe===!1&&(URL.revokeObjectURL(jt),console.log("Cleaned up orphaned recorded video URL on effect cleanup:",jt))},[jt,Xe]);const En=()=>{const le=[],Fe={},Ve={};_d.forEach(St=>{Fe[St]=[],Ve[St]=[]});let Qe=1/0,rt=0;for(const St of _d){const gt=as[St]||[],vt=_t[St]||[];gt.length>0&&(Qe=Math.min(Qe,gt[0].timestamp),rt=Math.max(rt,gt[gt.length-1].timestamp)),vt.length>0&&(Qe=Math.min(Qe,vt[0].timestamp),rt=Math.max(rt,vt[vt.length-1].timestamp))}if(Qe===1/0)return console.error("No angle data available"),{timestamps:[],userAngles:{},expectedAngles:{}};const pt=[];let Ne=Qe;for(;Ne<=rt;)pt.push(Ne),le.push(new Date(Ne-Qe).toISOString().substr(14,5)),Ne+=100;return _d.forEach(St=>{const gt=as[St]||[],vt=_t[St]||[];pt.forEach(Xt=>{let ws=0;if(gt.length>0){const rn=gt.findIndex(Fn=>Fn.timestamp>=Xt);if(rn===0)ws=gt[0].angle;else if(rn===-1)ws=gt[gt.length-1].angle;else{const Fn=gt[rn-1],Vt=gt[rn],yn=(Xt-Fn.timestamp)/(Vt.timestamp-Fn.timestamp);ws=Fn.angle*(1-yn)+Vt.angle*yn}}let $n=0;if(vt.length>0){const rn=vt.findIndex(Fn=>Fn.timestamp>=Xt);if(rn===0)$n=vt[0].angle;else if(rn===-1)$n=vt[vt.length-1].angle;else{const Fn=vt[rn-1],Vt=vt[rn],yn=(Xt-Fn.timestamp)/(Vt.timestamp-Fn.timestamp);$n=Fn.angle*(1-yn)+Vt.angle*yn}}Fe[St].push(ws),Ve[St].push($n)})}),{timestamps:le,userAngles:Fe,expectedAngles:Ve}},[ps,Dt]=b.useState(!1),ns=()=>{console.log("FORCE STOPPING ALL ANGLE RECORDING VIA REF AND STATE"),Es.current=!0,Dt(!0),Ii&&(clearInterval(Ii),sl(null)),os(!1),ae(le=>{if(!le.userAngleTable||!le.instructorAngleTable)return le;const Fe=le.userAngleTable.timestamps.length,Ve=le.userAngleTable.timestamps,Qe=le.userAngleTable.angles;console.log(`FORCING BOTH TABLES TO EXACT LENGTH: ${Fe}`);const rt={timestamps:le.instructorAngleTable.timestamps.slice(0,Fe),angles:Object.fromEntries(Object.entries(le.instructorAngleTable.angles||{}).map(([Ne,St])=>[Ne,St.slice(0,Fe)]))},pt={timestamps:Ve.slice(0,Fe),angles:Object.fromEntries(Object.entries(Qe||{}).map(([Ne,St])=>[Ne,St.slice(0,Fe)]))};return console.log(`User table length: ${pt.timestamps.length}`),console.log(`Instructor table length: ${rt.timestamps.length}`),{...le,userAngleTable:pt,instructorAngleTable:rt}})},ai=()=>{console.log("Starting synchronized angle recording for both user and instructor"),Es.current=!1,Dt(!1),Oe({}),Zt({}),ae(Qe=>({...Qe,userAngleTable:{timestamps:[],angles:{}},instructorAngleTable:{timestamps:[],angles:{}}})),Ii&&clearInterval(Ii);const le={},Fe={};_d.forEach(Qe=>{le[Qe]=[],Fe[Qe]=[]}),Oe(le),Zt(Fe);const Ve=setInterval(()=>{if(Es.current){console.log("Angle recording stopped (via ref) - ignoring interval update");return}const Qe=Date.now(),rt=new Date(Qe).toISOString().substr(11,8);if(At!=null&&At.keypoints){const pt=tc(At);Object.entries(pt).forEach(([Ne,St])=>{Oe(gt=>({...gt,[Ne]:[...gt[Ne]||[],{angle:St,timestamp:Qe}]}))}),ae(Ne=>{const St=Ne.userAngleTable||{timestamps:[],angles:{}},gt={...St.angles};return Object.entries(pt).forEach(([vt,Xt])=>{gt[vt]||(gt[vt]=[]),gt[vt].push(Xt)}),{...Ne,userAngleTable:{timestamps:[...St.timestamps,rt],angles:gt}}})}if(!Es.current&&(Ln!=null&&Ln.keypoints)){const pt=tc(Ln);Object.entries(pt).forEach(([Ne,St])=>{Zt(gt=>({...gt,[Ne]:[...gt[Ne]||[],{angle:St,timestamp:Qe}]}))}),ae(Ne=>{const St=Ne.instructorAngleTable||{timestamps:[],angles:{}},gt={...St.angles};return Object.entries(pt).forEach(([vt,Xt])=>{gt[vt]||(gt[vt]=[]),gt[vt].push(Xt)}),{...Ne,instructorAngleTable:{timestamps:[...St.timestamps,rt],angles:gt}}})}},100);sl(Ve)},[no,Ir]=b.useState(!1),[Ys,lf]=b.useState({timestamps:[],angles:{}}),fd=le=>{if(!e)return;const Fe=new Date().toISOString().substr(11,8);lf(Ve=>{const Qe={...Ve.angles};return Object.entries(le).forEach(([rt,pt])=>{Qe[rt]||(Qe[rt]=[]),Qe[rt].push(pt)}),{timestamps:[...Ve.timestamps,Fe],angles:Qe}})},Jx=()=>{var le,Fe;if(e){if(j(),An){B(!0);const Ve=((le=as[Object.keys(as)[0]])==null?void 0:le.length)>0?{timestamps:as[Object.keys(as)[0]].map(rt=>new Date(rt.timestamp).toISOString().substr(11,8)),angles:Object.fromEntries(Object.entries(as).map(([rt,pt])=>[rt,pt.map(Ne=>Ne.angle)]))}:Ys.timestamps.length>0?{timestamps:Ys.timestamps,angles:Ys.angles}:{timestamps:[],angles:{}},Qe=((Fe=_t[Object.keys(_t)[0]])==null?void 0:Fe.length)>0?{timestamps:_t[Object.keys(_t)[0]].map(rt=>new Date(rt.timestamp).toISOString().substr(11,8)),angles:Object.fromEntries(Object.entries(_t).map(([rt,pt])=>[rt,pt.map(Ne=>Ne.angle)]))}:{timestamps:[],angles:{}};console.log(`User angle data: ${Ve.timestamps.length} frames, ${Object.keys(Ve.angles).length} joints`),console.log(`Instructor angle data: ${Qe.timestamps.length} frames, ${Object.keys(Qe.angles).length} joints`),ae(rt=>({...rt,processing:!1,userAngleTable:Ve,instructorAngleTable:Qe})),Xs(!0),te(!0);return}Ir(!0)}};b.useState(void 0),b.useState(!1),b.useEffect(()=>{},[]);const i2=()=>{Ir(!1),Ie&&(B(!1),ns(),we(!0))},ey=()=>{console.log("[proceedToResultsModal] Entered function."),ae(le=>({...le,isRunning:!1,processing:!0})),ns(),setTimeout(()=>{var Vt,yn,Rs,xn;if(console.log("[proceedToResultsModal] Starting data processing inside setTimeout."),qn.length<5||is.length<5){console.log("[proceedToResultsModal] Not enough pose data. Setting error feedback."),ae(Et=>({...Et,isRunning:!1,processing:!1,feedback:"Not enough pose data. Please try again.",overallScore:0})),Xs(!0),console.log("[proceedToResultsModal] Attempting to show ResultsModal (due to insufficient data)."),Be(!0);return}console.log("[proceedToResultsModal] Processing test results..."),console.log("User pose history:",qn.length,"frames"),console.log("Reference pose history:",is.length,"frames");const le={},Fe={};_d.forEach(Et=>{var pn,Jt,kn,cn;(pn=as[Et])!=null&&pn.length&&((Jt=_t[Et])!=null&&Jt.length)?(le[Et]=as[Et].map(ls=>ls.angle),Fe[Et]=_t[Et].map(ls=>ls.angle)):(kn=zl[Et])!=null&&kn.length&&((cn=oi[Et])!=null&&cn.length)&&(le[Et]=zl[Et],Fe[Et]=oi[Et])});const Ve={},Qe={};let rt=0,pt=0;Object.keys(le).forEach(Et=>{if(le[Et].length>=5&&Fe[Et].length>=5){const pn=qAe(le[Et],Fe[Et],Et),Jt=pn.score;Ve[Et]=Jt,Qe[Et]=pn,rt+=Jt,pt++}});const Ne=pt>0?Math.round(rt/pt):0,St=(Vt=qn[qn.length-1])==null?void 0:Vt.pose,gt=(yn=is[is.length-1])==null?void 0:yn.pose;let vt={jointScores:[],overallScore:0};if(St&&gt){const Et=ke(St,gt);if(Et.jointScores&&Array.isArray(Et.jointScores)){const pn=Et.overallScore,Jt=Et.jointScores.filter(cn=>cn.score>0).length,kn=Jt>0?Math.round(pn/Jt):0;vt={jointScores:Et.jointScores,overallScore:kn}}}let Xt=Math.round(.7*Ne+.3*vt.overallScore);Xt=Math.max(0,Math.min(100,Xt));const ws=En(),$n=Ys.timestamps.length>0?{timestamps:Ys.timestamps,angles:Ys.angles}:{timestamps:((Rs=as[Object.keys(as)[0]])==null?void 0:Rs.map(Et=>new Date(Et.timestamp).toISOString().substr(11,8)))||[],angles:Object.fromEntries(Object.entries(as).map(([Et,pn])=>[Et,pn.map(Jt=>Jt.angle)]))},rn={timestamps:((xn=_t[Object.keys(_t)[0]])==null?void 0:xn.map(Et=>new Date(Et.timestamp).toISOString().substr(11,8)))||[],angles:Object.fromEntries(Object.entries(_t).map(([Et,pn])=>[Et,pn.map(Jt=>Jt.angle)]))},Fn=`Test completed. Overall Score: ${Xt}%. DTW Score: ${Ne}%. Frame Score: ${vt.overallScore}%.`;ae({isRunning:!1,processing:!1,scores:vt.jointScores,overallScore:Xt,feedback:Fn,timing:Ul,dtwScores:Ve,angleData:ws,userAngleTable:$n,instructorAngleTable:rn,dtwResults:Qe}),console.log("Test completed with score:",Xt),console.log("Joint scores (last frame):",vt.jointScores),console.log("DTW scores:",Ve),console.log("Timing issues:",Ul),Xs(!0),console.log("[proceedToResultsModal] Test data processing complete."),Be(!0),te(!1)},500)},o2=()=>{te(!1),ns(),ey()};return b.useEffect(()=>{},[]),Z&&(oe.userAngleTable,oe.instructorAngleTable),u.jsxs("div",{className:"m-0 p-0",children:[u.jsx(XAe,{onRecordingComplete:le=>hs(le)}),u.jsx("div",{id:"cameraContainer",className:`${x?"border-0 rounded-none shadow-none h-[calc(100vh-72px)] w-screen":"border-0 border-red-900 overflow-hidden relative h-[calc(80vh-100px)]"}`,children:u.jsxs("div",{className:`relative w-full ${x?"h-full":""} flex flex-col`,children:[u.jsxs("div",{className:`flex ${G?"md:flex-row flex-col":""} ${x?"h-full":""} h-full gap-0`,children:[u.jsxs("div",{className:`camera-container relative ${G?"md:w-1/2 w-full":"w-full"} ${x?"h-full":G?"":"aspect-[16/12]"}`,children:[(G||h==="camera")&&t&&u.jsx("video",{ref:L,className:`absolute top-0 left-0 w-full h-full ${x?"object-contain mx-auto":"object-contain"}`,playsInline:!0,muted:!0,style:x?{display:"block",maxHeight:"100%",maxWidth:"100%"}:{}}),!G&&h==="video"&&u.jsx("video",{ref:L,className:`absolute top-0 left-0 w-full h-full ${x?"object-contain mx-auto":"object-contain"}`,playsInline:!0,muted:!0,style:x?{display:"block",maxHeight:"100%",maxWidth:"100%"}:{}}),!G&&h==="image"&&f&&u.jsx("div",{className:`absolute top-0 left-0 w-full h-full flex items-center justify-center ${x?"flex-grow":""}`,children:u.jsx("img",{src:m,alt:"Uploaded for pose detection",className:`max-h-full max-w-full object-contain invisible ${x?"mx-auto":""}`,style:x?{display:"block"}:{}})}),u.jsx("canvas",{id:"outputCanvas",ref:M,className:`absolute top-0 left-0 w-full h-full ${x?"object-contain mx-auto my-auto":"object-contain"}`,style:x?{display:"block",maxHeight:"100%",maxWidth:"100%"}:{}}),!1,!re&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-black/70",children:u.jsxs("div",{className:"text-center p-4 bg-black/80 rounded border border-red-900/30",children:[u.jsx("div",{className:"loader mx-auto mb-3 border-t-red-500"}),u.jsx("p",{className:"text-red-100 font-medium",children:"Loading media..."})]})}),re&&!e&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-black/70",children:u.jsxs("div",{className:"text-center p-3 backdrop-blur-sm bg-black/80 rounded-lg border border-red-900/30",children:[u.jsx("span",{className:"material-icons text-4xl text-red-500 mb-2",children:"sports_martial_arts"}),u.jsx("p",{className:"text-white font-medium",children:"Start tracking to begin pose analysis"})]})}),e&&!oe.isRunning&&u.jsxs("div",{className:"absolute top-2 right-2 bg-gradient-to-r from-red-800 to-red-700 text-white px-3 py-1.5 rounded-full text-xs font-medium flex items-center shadow-lg",children:[u.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-white animate-pulse mr-1.5"}),"Tracking Active"]}),oe.isRunning&&u.jsxs("div",{className:"absolute top-2 right-2 bg-gradient-to-r from-red-900 to-red-600 text-white px-3 py-1.5 rounded-full text-xs font-medium flex items-center shadow-lg",children:[u.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-white animate-pulse mr-1.5"}),"Test in progress"]}),u.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 border border-red-900/50 text-red-100 px-2 py-1 rounded-md text-xs font-medium shadow-md",children:[(G||h==="camera")&&u.jsxs("span",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-xs mr-1 text-red-500",children:"videocam"}),"Camera Feed"]}),!G&&h==="image"&&u.jsxs("span",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-xs mr-1 text-red-500",children:"image"}),"Image"]}),!G&&h==="video"&&u.jsxs("span",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-xs mr-1 text-red-500",children:"movie"}),"Video"]})]})]}),!fe&&m&&u.jsxs("div",{className:`reference-panel bg-black/90 relative ${G?"md:w-1/2 w-full":x?"fixed bottom-14 right-2 w-40 h-40 rounded-lg border border-red-900/50 shadow-lg z-40":"hidden"}`,children:[Xm(m)&&u.jsx("video",{ref:z,className:"w-full h-full object-cover reference-video",playsInline:!0,src:m.split("#")[0],muted:!0,onError:le=>console.error("Video error:",le),onLoadedData:()=>{console.log("Reference video loaded. Pausing."),z.current&&(z.current.pause(),z.current.currentTime=0,z.current.playbackRate=Pe),De(!0)}}),!Xm(m)&&u.jsx("img",{src:m,alt:"Reference image",className:"w-full h-full object-cover"}),u.jsxs("div",{className:`absolute bottom-0 left-0 right-0 ${x?"p-1":"p-2"} flex justify-between items-center bg-black/90 border-t border-red-900/30`,children:[!x&&u.jsx("div",{className:"bg-red-900/40 text-white px-2 py-1 rounded-md text-xs font-medium shadow-md border border-red-900/30",children:u.jsxs("span",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-xs mr-1 text-red-500",children:"compare"}),"Reference"]})}),u.jsxs("div",{className:`flex gap-1 ${x?"w-full justify-evenly":""}`,children:[Xm(m)&&u.jsxs(u.Fragment,{children:[u.jsxs("button",{onClick:of,className:`bg-red-600 hover:bg-red-700 text-white rounded shadow-md ${x?"px-1 py-0.5 text-[10px]":"px-2 py-1 text-xs font-medium"}`,children:[u.jsx("span",{className:`material-icons align-middle ${x?"text-[10px]":"text-xs mr-1"}`,children:Ce?"play_arrow":"pause"}),!x&&(Ce?"Play":"Pause")]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx("button",{onClick:()=>rl(.5),className:`text-white rounded shadow-md text-xs px-1 py-1 ${Pe===.5?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,title:"0.5x speed",children:"0.5x"}),u.jsx("button",{onClick:()=>rl(1),className:`text-white rounded shadow-md text-xs px-1 py-1 ${Pe===1?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,title:"Normal speed",children:"1x"}),u.jsx("button",{onClick:()=>rl(1.5),className:`text-white rounded shadow-md text-xs px-1 py-1 ${Pe===1.5?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,title:"1.5x speed",children:"1.5x"}),u.jsx("button",{onClick:()=>rl(2),className:`text-white rounded shadow-md text-xs px-1 py-1 ${Pe===2?"bg-orange-600":"bg-gray-700 hover:bg-gray-600"}`,title:"2x speed",children:"2x"})]})]}),u.jsxs("button",{onClick:F,className:`text-white rounded shadow-md ${g?"bg-red-600 hover:bg-red-700":"bg-gray-900 hover:bg-gray-800"} ${x?"px-1 py-0.5 text-[10px]":"px-2 py-1 text-xs font-medium"}`,children:[u.jsx("span",{className:`material-icons align-middle ${x?"text-[10px]":"text-xs mr-1"}`,children:g?"filter_alt":"filter_alt_off"}),!x&&(g?"Skeleton On":"Skeleton Off")]})]})]})]}),G&&fe&&u.jsx("div",{className:"bg-black/90 border border-red-900/40 relative md:w-1/2 w-full flex flex-col items-center justify-center p-4",children:u.jsxs("div",{className:"w-full max-w-md",children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("h3",{className:"text-xl font-bold text-red-500 mb-2",children:"Select Reference Media"}),u.jsx("p",{className:"text-red-100 text-sm",children:"Choose a pre-loaded martial arts form or upload your own media"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("button",{onClick:()=>{ee(!1),me(!0)},className:"w-full h-16 bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 text-white font-semibold text-lg flex items-center justify-center gap-3 rounded-lg shadow-lg",children:[u.jsx("span",{className:"material-icons text-2xl",children:"video_library"}),"Choose Pre-loaded Video"]}),u.jsxs("button",{onClick:()=>{const le=document.createElement("input");le.type="file",le.accept="video/mp4,video/webm,video/ogg,video/*",le.onchange=Fe=>{var Qe;const Ve=(Qe=Fe.target.files)==null?void 0:Qe[0];if(Ve){if(!Ve.type.startsWith("video/")){console.error("Not a video file:",Ve.type);return}console.log("Selected video file:",Ve.name,Ve.type);const pt=URL.createObjectURL(Ve)+"#video";y&&(console.log("Sending video URL to parent:",pt),y(pt)),ee(!1)}},le.click()},className:"w-full h-16 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-gray-800 hover:to-gray-700 text-white font-semibold text-lg flex items-center justify-center gap-3 rounded-lg shadow-lg",children:[u.jsx("span",{className:"material-icons text-2xl",children:"file_upload"}),"Upload Video"]}),u.jsxs("button",{onClick:()=>ee(!1),className:"w-full border-red-900/30 bg-transparent text-gray-300 hover:bg-red-900/20 hover:text-white p-3 rounded-lg flex items-center justify-center shadow-lg border",children:[u.jsx("span",{className:"material-icons mr-2",children:"close"}),"Cancel"]})]}),u.jsx("div",{className:"mt-6 pt-4 border-t border-red-900/30",children:u.jsxs("div",{className:"text-xs text-gray-500 text-center space-y-1",children:[u.jsx("p",{children:"Pre-loaded videos include martial arts forms and techniques"}),u.jsx("p",{children:"Upload supports: MP4, WEBM, OGG"})]})})]})}),ce&&u.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:u.jsx(BH,{onVideoSelect:(le,Fe,Ve)=>{if(le){const Qe=Fe+"#video";y&&y(Qe)}me(!1)},onCancel:()=>{me(!1),ee(!0)}})})]}),!G&&u.jsx("button",{onClick:ft,className:"absolute top-1/2 right-4 transform -translate-y-1/2 bg-gradient-to-r from-red-700 to-red-600 text-white p-2 rounded-full shadow-lg hover:from-red-800 hover:to-red-700 z-20",title:"Add reference media",children:u.jsx("span",{className:"material-icons",children:"add"})})]})}),u.jsx(pMe,{initialNotes:$||ie,onChange:le=>{Q(le),R&&R(le)},onStartRoutine:()=>{lf({timestamps:[],angles:{}}),j()},onStopRoutine:Jx,onStartTest:()=>{if(!G||!m&&!z.current){alert("Please select a reference video in split view first."),G||ft();return}lf({timestamps:[],angles:{}});const le={timestamps:[],angles:{}},Fe={userAngleTable:{...le},instructorAngleTable:{...le}};os(!0),ae({isRunning:!0,processing:!1,scores:[],overallScore:0,feedback:"Follow the green guide to match the reference movement",...Fe}),zs(Date.now()),Lo(0),e||j(),!g&&S&&S();const Ve=z.current;Ve&&Ve instanceof HTMLVideoElement?(Ve.currentTime=0,Ve.loop=!1,Ce&&(Ve.play().catch(Qe=>console.error("Error playing reference video:",Qe)),De(!1)),gn(),Ve.onended=()=>{console.log("Reference video ended. Test angle recording will continue until explicitly stopped."),fn&&de&&de.state==="recording"&&console.log("Reference video ended. Screen recording will continue until test is explicitly stopped.")}):h==="image"&&(m||f)&&(gn(),setTimeout(()=>{console.log("Image test duration ended."),os(!1),de&&de.state==="recording"&&(console.log("Stopping screen recording for image test..."),de.stop()),Jx()},5e3)),ai()},onStopTest:()=>{oe.isRunning&&(fn&&zn(),z.current&&z.current instanceof HTMLVideoElement&&(z.current.pause(),z.current.onended=null,z.current.onpause=null,z.current.onerror=null,z.current.loop=!1),ns(),os(!1),e&&j(),ae(le=>({...le,isRunning:!1,processing:!1})),Xs(!0),te(!0),Ir(!1),lt(!1))},isTracking:e,hasReferenceMedia:G&&(!!f||!!z.current),hasCompletedTest:$r,onShowResults:()=>Be(!0),onRecord:Tt,isRecording:fn,isTestRunning:oe.isRunning}),u.jsx(PF,{isOpen:Ae,onClose:()=>Be(!1),scores:oe.scores,overallScore:oe.overallScore,feedback:oe.feedback,timing:oe.timing,recordedVideo:jt,routineNotes:$||ie,angleData:oe.angleData,dtwResults:oe.dtwResults,userAngleTable:oe.userAngleTable,instructorAngleTable:oe.instructorAngleTable}),!1,Xe&&jt&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-3xl border border-red-700/50",children:[u.jsx("h3",{className:"text-xl font-semibold text-white mb-4 text-center",children:"Screen Recording Complete"}),u.jsx("video",{src:jt,controls:!0,autoPlay:!0,className:"w-full rounded-lg max-h-[70vh] mb-4 border border-gray-700"}),u.jsxs("div",{className:"flex flex-row gap-4 justify-end",children:[u.jsx("button",{onClick:()=>{const le=document.createElement("a");le.href=jt,le.download=`CoachT-Training-${new Date().toISOString().slice(0,10)}.webm`,document.body.appendChild(le),le.click(),document.body.removeChild(le)},className:"px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold shadow-md",children:"Download Recording"}),u.jsx("button",{onClick:Cn,className:"px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg font-semibold hover:from-red-700 hover:to-red-800 transition-colors shadow-md",children:"Close"})]})]})}),no&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-4xl border border-orange-600/50 max-h-[90vh] overflow-auto",children:[u.jsx("h3",{className:"text-xl font-semibold text-white mb-3 text-center",children:"Routine Stopped"}),u.jsx("p",{className:"text-gray-300 mb-4 text-center",children:"Your routine has been stopped. Review your joint angle data below."}),u.jsxs("div",{className:"mb-6 overflow-x-auto",children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Joint Angle Data"}),Ys.timestamps.length>0?u.jsxs("table",{className:"min-w-full text-sm text-left text-gray-300",children:[u.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-800 sticky top-0",children:u.jsxs("tr",{children:[u.jsx("th",{scope:"col",className:"px-4 py-3",children:"Time"}),Object.keys(Ys.angles).map(le=>u.jsx("th",{scope:"col",className:"px-4 py-3",children:le.replace("_"," ")},le))]})}),u.jsx("tbody",{children:Ys.timestamps.map((le,Fe)=>u.jsxs("tr",{className:Fe%2===0?"bg-gray-900":"bg-gray-800",children:[u.jsx("td",{className:"px-4 py-2",children:le}),Object.keys(Ys.angles).map(Ve=>{var Qe;return u.jsxs("td",{className:"px-4 py-2",children:[((Qe=Ys.angles[Ve][Fe])==null?void 0:Qe.toFixed(1))||"0","°"]},`${Ve}-${Fe}`)})]},Fe))})]}):u.jsx("p",{className:"text-gray-400 text-center p-4",children:"No angle data recorded."})]}),u.jsxs("div",{className:"flex flex-row gap-3 justify-center",children:[Ie&&u.jsx("button",{onClick:i2,className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold shadow-md text-lg",children:"Continue to Test Results"}),u.jsx("button",{onClick:()=>Ir(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium",children:"Close"})]})]})}),ve&&u.jsx(LH,{isOpen:ve,onClose:()=>we(!1),userAngleData:oe.userAngleTable||{timestamps:[],angles:{}},referenceAngleData:oe.instructorAngleTable||{timestamps:[],angles:{}}}),Me&&Ze&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4",children:u.jsxs("div",{className:"bg-gray-900 p-6 rounded-xl shadow-2xl w-full max-w-3xl border border-blue-700/50",children:[u.jsx("h3",{className:"text-xl font-semibold text-white mb-4 text-center",children:"Test Recording"}),u.jsx("video",{src:Ze,controls:!0,autoPlay:!0,className:"w-full rounded-lg max-h-[70vh] mb-4 border border-gray-700"}),u.jsx("div",{className:"flex flex-row gap-4 justify-end",children:u.jsx("button",{onClick:()=>{je(!1),ey()},className:"px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-colors shadow-md",children:"View Results"})})]})}),Ae&&u.jsx(PF,{isOpen:Ae,onClose:()=>Be(!1),scores:oe.scores,overallScore:oe.overallScore,feedback:oe.feedback,timing:oe.timing,recordedVideo:jt,routineNotes:$||ie,angleData:oe.angleData,dtwResults:oe.dtwResults,userAngleTable:oe.userAngleTable,instructorAngleTable:oe.instructorAngleTable})]})}const Yy=(t,e)=>{var s;return((s={left_elbow:{start:"left_shoulder",end:"left_wrist"},right_elbow:{start:"right_shoulder",end:"right_wrist"},left_shoulder:{start:"left_hip",end:"left_elbow"},right_shoulder:{start:"right_hip",end:"right_elbow"},left_wrist:{start:"left_elbow",end:"left_index"},right_wrist:{start:"right_elbow",end:"right_index"},left_knee:{start:"left_hip",end:"left_ankle"},right_knee:{start:"right_hip",end:"right_ankle"},left_ankle:{start:"left_knee",end:"left_foot_index"},right_ankle:{start:"right_knee",end:"right_foot_index"},left_hip:{start:"left_knee",end:"left_shoulder"},right_hip:{start:"right_knee",end:"right_shoulder"}}[t])==null?void 0:s[e])||t},MF=(t,e,n)=>{const s={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},i=s.x*r.x+s.y*r.y,o=Math.sqrt(s.x*s.x+s.y*s.y),a=Math.sqrt(r.x*r.x+r.y*r.y);let c=Math.acos(i/(o*a))*180/Math.PI;return isNaN(c)?0:Math.round(c)},wMe=Sx("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Se=b.forwardRef(({className:t,variant:e,size:n,asChild:s=!1,...r},i)=>{const o=s?iV:"button";return u.jsx(o,{className:Pt(wMe({variant:e,size:n,className:t})),ref:i,...r})});Se.displayName="Button";function SMe({onRequestPermission:t}){return u.jsxs("div",{className:"p-6 rounded-xl text-center relative overflow-hidden bg-gray-900 border border-red-900/30 shadow-lg",children:[u.jsx("div",{className:"mb-5 text-center z-10 relative",children:u.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-r from-red-700 to-red-600 flex items-center justify-center mx-auto animate-pulse",children:u.jsx("span",{className:"material-icons text-white text-3xl",children:"camera_alt"})})}),u.jsx("h2",{className:"text-xl font-medium mb-3 text-red-500",children:"Camera Access"}),u.jsxs("div",{className:"max-w-md mx-auto z-10 relative",children:[u.jsx("p",{className:"text-sm text-gray-400 mb-5",children:"Process happens locally in your browser."}),u.jsxs(Se,{onClick:t,className:"bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 px-6 py-4 w-full",size:"lg",children:[u.jsx("span",{className:"material-icons mr-2",children:"videocam"}),"Enable Camera"]})]})]})}const tP=b.createContext({});function ef(t){const e=b.useRef(null);return e.current===null&&(e.current=t()),e.current}const M1=b.createContext(null),L1=b.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class CMe extends b.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function kMe({children:t,isPresent:e}){const n=b.useId(),s=b.useRef(null),r=b.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=b.useContext(L1);return b.useInsertionEffect(()=>{const{width:o,height:a,top:l,left:c}=r.current;if(e||!s.current||!o||!a)return;s.current.dataset.motionPopId=n;const d=document.createElement("style");return i&&(d.nonce=i),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),u.jsx(CMe,{isPresent:e,childRef:s,sizeRef:r,children:b.cloneElement(t,{ref:s})})}const NMe=({children:t,initial:e,isPresent:n,onExitComplete:s,custom:r,presenceAffectsLayout:i,mode:o})=>{const a=ef(TMe),l=b.useId(),c=b.useCallback(h=>{a.set(h,!0);for(const f of a.values())if(!f)return;s&&s()},[a,s]),d=b.useMemo(()=>({id:l,initial:e,isPresent:n,custom:r,onExitComplete:c,register:h=>(a.set(h,!1),()=>a.delete(h))}),i?[Math.random(),c]:[n,c]);return b.useMemo(()=>{a.forEach((h,f)=>a.set(f,!1))},[n]),b.useEffect(()=>{!n&&!a.size&&s&&s()},[n]),o==="popLayout"&&(t=u.jsx(kMe,{isPresent:n,children:t})),u.jsx(M1.Provider,{value:d,children:t})};function TMe(){return new Map}function VH(t=!0){const e=b.useContext(M1);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:s,register:r}=e,i=b.useId();b.useEffect(()=>{t&&r(i)},[t]);const o=b.useCallback(()=>t&&s&&s(i),[i,s,t]);return!n&&s?[!1,o]:[!0]}const Qy=t=>t.key||"";function LF(t){const e=[];return b.Children.forEach(t,n=>{b.isValidElement(n)&&e.push(n)}),e}const nP=typeof window<"u",Vx=nP?b.useLayoutEffect:b.useEffect,ko=({children:t,custom:e,initial:n=!0,onExitComplete:s,presenceAffectsLayout:r=!0,mode:i="sync",propagate:o=!1})=>{const[a,l]=VH(o),c=b.useMemo(()=>LF(t),[t]),d=o&&!a?[]:c.map(Qy),h=b.useRef(!0),f=b.useRef(c),p=ef(()=>new Map),[m,g]=b.useState(c),[x,y]=b.useState(c);Vx(()=>{h.current=!1,f.current=c;for(let C=0;C<x.length;C++){const k=Qy(x[C]);d.includes(k)?p.delete(k):p.get(k)!==!0&&p.set(k,!1)}},[x,d.length,d.join("-")]);const v=[];if(c!==m){let C=[...c];for(let k=0;k<x.length;k++){const T=x[k],_=Qy(T);d.includes(_)||(C.splice(k,0,T),v.push(T))}i==="wait"&&v.length&&(C=v),y(LF(C)),g(c);return}const{forceRender:S}=b.useContext(tP);return u.jsx(u.Fragment,{children:x.map(C=>{const k=Qy(C),T=o&&!a?!1:c===x||d.includes(k),_=()=>{if(p.has(k))p.set(k,!0);else return;let $=!0;p.forEach(R=>{R||($=!1)}),$&&(S==null||S(),y(f.current),o&&(l==null||l()),s&&s())};return u.jsx(NMe,{isPresent:T,initial:!h.current||n?void 0:!1,custom:T?void 0:e,presenceAffectsLayout:r,mode:i,onExitComplete:T?void 0:_,children:C},k)})})},bi=t=>t;let _Me=bi,ON=bi;function sP(t){let e;return()=>(e===void 0&&(e=t()),e)}const $h=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s},mc=t=>t*1e3,gc=t=>t/1e3,EMe={skipAnimations:!1,useManualTiming:!1};function $Me(t){let e=new Set,n=new Set,s=!1,r=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(c){i.has(c)&&(l.schedule(c),t()),c(o)}const l={schedule:(c,d=!1,h=!1)=>{const p=h&&s?e:n;return d&&i.add(c),p.has(c)||p.add(c),c},cancel:c=>{n.delete(c),i.delete(c)},process:c=>{if(o=c,s){r=!0;return}s=!0,[e,n]=[n,e],e.forEach(a),e.clear(),s=!1,r&&(r=!1,l.process(c))}};return l}const Zy=["read","resolveKeyframes","update","preRender","render","postRender"],IMe=40;function zH(t,e){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=()=>n=!0,o=Zy.reduce((y,v)=>(y[v]=$Me(i),y),{}),{read:a,resolveKeyframes:l,update:c,preRender:d,render:h,postRender:f}=o,p=()=>{const y=performance.now();n=!1,r.delta=s?1e3/60:Math.max(Math.min(y-r.timestamp,IMe),1),r.timestamp=y,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),d.process(r),h.process(r),f.process(r),r.isProcessing=!1,n&&e&&(s=!1,t(p))},m=()=>{n=!0,s=!0,r.isProcessing||t(p)};return{schedule:Zy.reduce((y,v)=>{const S=o[v];return y[v]=(C,k=!1,T=!1)=>(n||m(),S.schedule(C,k,T)),y},{}),cancel:y=>{for(let v=0;v<Zy.length;v++)o[Zy[v]].cancel(y)},state:r,steps:o}}const{schedule:Vn,cancel:Ya,state:br,steps:RS}=zH(typeof requestAnimationFrame<"u"?requestAnimationFrame:bi,!0),WH=b.createContext({strict:!1}),BF={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},qp={};for(const t in BF)qp[t]={isEnabled:e=>BF[t].some(n=>!!e[n])};function RMe(t){for(const e in t)qp[e]={...qp[e],...t[e]}}const PMe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function iw(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||PMe.has(t)}let UH=t=>!iw(t);function AMe(t){t&&(UH=e=>e.startsWith("on")?!iw(e):t(e))}try{AMe(require("@emotion/is-prop-valid").default)}catch{}function jMe(t,e,n){const s={};for(const r in t)r==="values"&&typeof t.values=="object"||(UH(r)||n===!0&&iw(r)||!e&&!iw(r)||t.draggable&&r.startsWith("onDrag"))&&(s[r]=t[r]);return s}function DMe(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...s)=>t(...s);return new Proxy(n,{get:(s,r)=>r==="create"?t:(e.has(r)||e.set(r,t(r)),e.get(r))})}const B1=b.createContext({});function B0(t){return typeof t=="string"||Array.isArray(t)}function V1(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const rP=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],iP=["initial",...rP];function z1(t){return V1(t.animate)||iP.some(e=>B0(t[e]))}function HH(t){return!!(z1(t)||t.variants)}function OMe(t,e){if(z1(t)){const{initial:n,animate:s}=t;return{initial:n===!1||B0(n)?n:void 0,animate:B0(s)?s:void 0}}return t.inherit!==!1?e:{}}function FMe(t){const{initial:e,animate:n}=OMe(t,b.useContext(B1));return b.useMemo(()=>({initial:e,animate:n}),[VF(e),VF(n)])}function VF(t){return Array.isArray(t)?t.join(" "):t}const MMe=Symbol.for("motionComponentSymbol");function Vf(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function LMe(t,e,n){return b.useCallback(s=>{s&&t.onMount&&t.onMount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):Vf(n)&&(n.current=s))},[e])}const oP=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),BMe="framerAppearId",GH="data-"+oP(BMe),{schedule:aP,cancel:N7e}=zH(queueMicrotask,!1),KH=b.createContext({});function VMe(t,e,n,s,r){var i,o;const{visualElement:a}=b.useContext(B1),l=b.useContext(WH),c=b.useContext(M1),d=b.useContext(L1).reducedMotion,h=b.useRef(null);s=s||l.renderer,!h.current&&s&&(h.current=s(t,{visualState:e,parent:a,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const f=h.current,p=b.useContext(KH);f&&!f.projection&&r&&(f.type==="html"||f.type==="svg")&&zMe(h.current,n,r,p);const m=b.useRef(!1);b.useInsertionEffect(()=>{f&&m.current&&f.update(n,c)});const g=n[GH],x=b.useRef(!!g&&!(!((i=window.MotionHandoffIsComplete)===null||i===void 0)&&i.call(window,g))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return Vx(()=>{f&&(m.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),aP.render(f.render),x.current&&f.animationState&&f.animationState.animateChanges())}),b.useEffect(()=>{f&&(!x.current&&f.animationState&&f.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{var y;(y=window.MotionHandoffMarkAsComplete)===null||y===void 0||y.call(window,g)}),x.current=!1))}),f}function zMe(t,e,n,s){const{layoutId:r,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:qH(t.parent)),t.projection.setOptions({layoutId:r,layout:i,alwaysMeasureLayout:!!o||a&&Vf(a),visualElement:t,animationType:typeof i=="string"?i:"both",initialPromotionConfig:s,layoutScroll:l,layoutRoot:c})}function qH(t){if(t)return t.options.allowProjection!==!1?t.projection:qH(t.parent)}function WMe({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:s,Component:r}){var i,o;t&&RMe(t);function a(c,d){let h;const f={...b.useContext(L1),...c,layoutId:UMe(c)},{isStatic:p}=f,m=FMe(c),g=s(c,p);if(!p&&nP){HMe();const x=GMe(f);h=x.MeasureLayout,m.visualElement=VMe(r,g,f,e,x.ProjectionNode)}return u.jsxs(B1.Provider,{value:m,children:[h&&m.visualElement?u.jsx(h,{visualElement:m.visualElement,...f}):null,n(r,c,LMe(g,m.visualElement,d),g,p,m.visualElement)]})}a.displayName=`motion.${typeof r=="string"?r:`create(${(o=(i=r.displayName)!==null&&i!==void 0?i:r.name)!==null&&o!==void 0?o:""})`}`;const l=b.forwardRef(a);return l[MMe]=r,l}function UMe({layoutId:t}){const e=b.useContext(tP).id;return e&&t!==void 0?e+"-"+t:t}function HMe(t,e){b.useContext(WH).strict}function GMe(t){const{drag:e,layout:n}=qp;if(!e&&!n)return{};const s={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const KMe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function lP(t){return typeof t!="string"||t.includes("-")?!1:!!(KMe.indexOf(t)>-1||/[A-Z]/u.test(t))}function zF(t){const e=[{},{}];return t==null||t.values.forEach((n,s)=>{e[0][s]=n.get(),e[1][s]=n.getVelocity()}),e}function cP(t,e,n,s){if(typeof e=="function"){const[r,i]=zF(s);e=e(n!==void 0?n:t.custom,r,i)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[r,i]=zF(s);e=e(n!==void 0?n:t.custom,r,i)}return e}const FN=t=>Array.isArray(t),qMe=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),XMe=t=>FN(t)?t[t.length-1]||0:t,Zr=t=>!!(t&&t.getVelocity);function Ov(t){const e=Zr(t)?t.get():t;return qMe(e)?e.toValue():e}function YMe({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},s,r,i){const o={latestValues:QMe(s,r,i,t),renderState:e()};return n&&(o.onMount=a=>n({props:s,current:a,...o}),o.onUpdate=a=>n(a)),o}const XH=t=>(e,n)=>{const s=b.useContext(B1),r=b.useContext(M1),i=()=>YMe(t,e,s,r);return n?i():ef(i)};function QMe(t,e,n,s){const r={},i=s(t,{});for(const f in i)r[f]=Ov(i[f]);let{initial:o,animate:a}=t;const l=z1(t),c=HH(t);e&&c&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=n?n.initial===!1:!1;d=d||o===!1;const h=d?a:o;if(h&&typeof h!="boolean"&&!V1(h)){const f=Array.isArray(h)?h:[h];for(let p=0;p<f.length;p++){const m=cP(t,f[p]);if(m){const{transitionEnd:g,transition:x,...y}=m;for(const v in y){let S=y[v];if(Array.isArray(S)){const C=d?S.length-1:0;S=S[C]}S!==null&&(r[v]=S)}for(const v in g)r[v]=g[v]}}}return r}const Nm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],tf=new Set(Nm),YH=t=>e=>typeof e=="string"&&e.startsWith(t),QH=YH("--"),ZMe=YH("var(--"),uP=t=>ZMe(t)?JMe.test(t.split("/*")[0].trim()):!1,JMe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ZH=(t,e)=>e&&typeof t=="number"?e.transform(t):t,Ml=(t,e,n)=>n>e?e:n<t?t:n,Tm={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},V0={...Tm,transform:t=>Ml(0,1,t)},Jy={...Tm,default:1},zx=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Yc=zx("deg"),Rl=zx("%"),Lt=zx("px"),e4e=zx("vh"),t4e=zx("vw"),WF={...Rl,parse:t=>Rl.parse(t)/100,transform:t=>Rl.transform(t*100)},n4e={borderWidth:Lt,borderTopWidth:Lt,borderRightWidth:Lt,borderBottomWidth:Lt,borderLeftWidth:Lt,borderRadius:Lt,radius:Lt,borderTopLeftRadius:Lt,borderTopRightRadius:Lt,borderBottomRightRadius:Lt,borderBottomLeftRadius:Lt,width:Lt,maxWidth:Lt,height:Lt,maxHeight:Lt,top:Lt,right:Lt,bottom:Lt,left:Lt,padding:Lt,paddingTop:Lt,paddingRight:Lt,paddingBottom:Lt,paddingLeft:Lt,margin:Lt,marginTop:Lt,marginRight:Lt,marginBottom:Lt,marginLeft:Lt,backgroundPositionX:Lt,backgroundPositionY:Lt},s4e={rotate:Yc,rotateX:Yc,rotateY:Yc,rotateZ:Yc,scale:Jy,scaleX:Jy,scaleY:Jy,scaleZ:Jy,skew:Yc,skewX:Yc,skewY:Yc,distance:Lt,translateX:Lt,translateY:Lt,translateZ:Lt,x:Lt,y:Lt,z:Lt,perspective:Lt,transformPerspective:Lt,opacity:V0,originX:WF,originY:WF,originZ:Lt},UF={...Tm,transform:Math.round},dP={...n4e,...s4e,zIndex:UF,size:Lt,fillOpacity:V0,strokeOpacity:V0,numOctaves:UF},r4e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},i4e=Nm.length;function o4e(t,e,n){let s="",r=!0;for(let i=0;i<i4e;i++){const o=Nm[i],a=t[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||n){const c=ZH(a,dP[o]);if(!l){r=!1;const d=r4e[o]||o;s+=`${d}(${c}) `}n&&(e[o]=c)}}return s=s.trim(),n?s=n(e,r?"":s):r&&(s="none"),s}function hP(t,e,n){const{style:s,vars:r,transformOrigin:i}=t;let o=!1,a=!1;for(const l in e){const c=e[l];if(tf.has(l)){o=!0;continue}else if(QH(l)){r[l]=c;continue}else{const d=ZH(c,dP[l]);l.startsWith("origin")?(a=!0,i[l]=d):s[l]=d}}if(e.transform||(o||n?s.transform=o4e(e,t.transform,n):s.transform&&(s.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:d=0}=i;s.transformOrigin=`${l} ${c} ${d}`}}const a4e={offset:"stroke-dashoffset",array:"stroke-dasharray"},l4e={offset:"strokeDashoffset",array:"strokeDasharray"};function c4e(t,e,n=1,s=0,r=!0){t.pathLength=1;const i=r?a4e:l4e;t[i.offset]=Lt.transform(-s);const o=Lt.transform(e),a=Lt.transform(n);t[i.array]=`${o} ${a}`}function HF(t,e,n){return typeof t=="string"?t:Lt.transform(e+n*t)}function u4e(t,e,n){const s=HF(e,t.x,t.width),r=HF(n,t.y,t.height);return`${s} ${r}`}function fP(t,{attrX:e,attrY:n,attrScale:s,originX:r,originY:i,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},d,h){if(hP(t,c,h),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:p,dimensions:m}=t;f.transform&&(m&&(p.transform=f.transform),delete f.transform),m&&(r!==void 0||i!==void 0||p.transform)&&(p.transformOrigin=u4e(m,r!==void 0?r:.5,i!==void 0?i:.5)),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),o!==void 0&&c4e(f,o,a,l,!1)}const pP=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),JH=()=>({...pP(),attrs:{}}),mP=t=>typeof t=="string"&&t.toLowerCase()==="svg";function eG(t,{style:e,vars:n},s,r){Object.assign(t.style,e,r&&r.getProjectionStyles(s));for(const i in n)t.style.setProperty(i,n[i])}const tG=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function nG(t,e,n,s){eG(t,e,void 0,s);for(const r in e.attrs)t.setAttribute(tG.has(r)?r:oP(r),e.attrs[r])}const ow={};function d4e(t){Object.assign(ow,t)}function sG(t,{layout:e,layoutId:n}){return tf.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!ow[t]||t==="opacity")}function gP(t,e,n){var s;const{style:r}=t,i={};for(const o in r)(Zr(r[o])||e.style&&Zr(e.style[o])||sG(o,t)||((s=n==null?void 0:n.getValue(o))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(i[o]=r[o]);return i}function rG(t,e,n){const s=gP(t,e,n);for(const r in t)if(Zr(t[r])||Zr(e[r])){const i=Nm.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[i]=t[r]}return s}function h4e(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const GF=["x","y","width","height","cx","cy","r"],f4e={useVisualState:XH({scrapeMotionValuesFromProps:rG,createRenderState:JH,onUpdate:({props:t,prevProps:e,current:n,renderState:s,latestValues:r})=>{if(!n)return;let i=!!t.drag;if(!i){for(const a in r)if(tf.has(a)){i=!0;break}}if(!i)return;let o=!e;if(e)for(let a=0;a<GF.length;a++){const l=GF[a];t[l]!==e[l]&&(o=!0)}o&&Vn.read(()=>{h4e(n,s),Vn.render(()=>{fP(s,r,mP(n.tagName),t.transformTemplate),nG(n,s)})})}})},p4e={useVisualState:XH({scrapeMotionValuesFromProps:gP,createRenderState:pP})};function iG(t,e,n){for(const s in e)!Zr(e[s])&&!sG(s,n)&&(t[s]=e[s])}function m4e({transformTemplate:t},e){return b.useMemo(()=>{const n=pP();return hP(n,e,t),Object.assign({},n.vars,n.style)},[e])}function g4e(t,e){const n=t.style||{},s={};return iG(s,n,t),Object.assign(s,m4e(t,e)),s}function x4e(t,e){const n={},s=g4e(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=s,n}function y4e(t,e,n,s){const r=b.useMemo(()=>{const i=JH();return fP(i,e,mP(s),t.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};iG(i,t.style,t),r.style={...i,...r.style}}return r}function v4e(t=!1){return(n,s,r,{latestValues:i},o)=>{const l=(lP(n)?y4e:x4e)(s,i,o,n),c=jMe(s,typeof n=="string",t),d=n!==b.Fragment?{...c,...l,ref:r}:{},{children:h}=s,f=b.useMemo(()=>Zr(h)?h.get():h,[h]);return b.createElement(n,{...d,children:f})}}function b4e(t,e){return function(s,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...lP(s)?f4e:p4e,preloadedFeatures:t,useRender:v4e(r),createVisualElement:e,Component:s};return WMe(o)}}function oG(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function W1(t,e,n){const s=t.getProps();return cP(s,e,n!==void 0?n:s.custom,t)}const aG=sP(()=>window.ScrollTimeline!==void 0);class w4e{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=n}attachTimeline(e,n){const s=this.animations.map(r=>{if(aG()&&r.attachTimeline)return r.attachTimeline(e);if(typeof n=="function")return n(r)});return()=>{s.forEach((r,i)=>{r&&r(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class S4e extends w4e{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function xP(t,e){return t?t[e]||t.default||t:void 0}const MN=2e4;function lG(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<MN;)e+=n,s=t.next(e);return e>=MN?1/0:e}function yP(t){return typeof t=="function"}function KF(t,e){t.timeline=e,t.onfinish=null}const vP=t=>Array.isArray(t)&&typeof t[0]=="number",C4e={linearEasing:void 0};function k4e(t,e){const n=sP(t);return()=>{var s;return(s=C4e[e])!==null&&s!==void 0?s:n()}}const aw=k4e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cG=(t,e,n=10)=>{let s="";const r=Math.max(Math.round(e/n),2);for(let i=0;i<r;i++)s+=t($h(0,r-1,i))+", ";return`linear(${s.substring(0,s.length-2)})`};function uG(t){return!!(typeof t=="function"&&aw()||!t||typeof t=="string"&&(t in LN||aw())||vP(t)||Array.isArray(t)&&t.every(uG))}const xg=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,LN={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:xg([0,.65,.55,1]),circOut:xg([.55,0,1,.45]),backIn:xg([.31,.01,.66,-.59]),backOut:xg([.33,1.53,.69,.99])};function dG(t,e){if(t)return typeof t=="function"&&aw()?cG(t,e):vP(t)?xg(t):Array.isArray(t)?t.map(n=>dG(n,e)||LN.easeOut):LN[t]}const ka={x:!1,y:!1};function hG(){return ka.x||ka.y}function fG(t,e,n){var s;if(t instanceof Element)return[t];if(typeof t=="string"){let r=document;const i=(s=void 0)!==null&&s!==void 0?s:r.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}function pG(t,e){const n=fG(t),s=new AbortController,r={passive:!0,...e,signal:s.signal};return[n,r,()=>s.abort()]}function qF(t){return e=>{e.pointerType==="touch"||hG()||t(e)}}function N4e(t,e,n={}){const[s,r,i]=pG(t,n),o=qF(a=>{const{target:l}=a,c=e(a);if(typeof c!="function"||!l)return;const d=qF(h=>{c(h),l.removeEventListener("pointerleave",d)});l.addEventListener("pointerleave",d,r)});return s.forEach(a=>{a.addEventListener("pointerenter",o,r)}),i}const mG=(t,e)=>e?t===e?!0:mG(t,e.parentElement):!1,bP=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,T4e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function _4e(t){return T4e.has(t.tagName)||t.tabIndex!==-1}const yg=new WeakSet;function XF(t){return e=>{e.key==="Enter"&&t(e)}}function PS(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const E4e=(t,e)=>{const n=t.currentTarget;if(!n)return;const s=XF(()=>{if(yg.has(n))return;PS(n,"down");const r=XF(()=>{PS(n,"up")}),i=()=>PS(n,"cancel");n.addEventListener("keyup",r,e),n.addEventListener("blur",i,e)});n.addEventListener("keydown",s,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),e)};function YF(t){return bP(t)&&!hG()}function $4e(t,e,n={}){const[s,r,i]=pG(t,n),o=a=>{const l=a.currentTarget;if(!YF(a)||yg.has(l))return;yg.add(l);const c=e(a),d=(p,m)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",f),!(!YF(p)||!yg.has(l))&&(yg.delete(l),typeof c=="function"&&c(p,{success:m}))},h=p=>{d(p,n.useGlobalTarget||mG(l,p.target))},f=p=>{d(p,!1)};window.addEventListener("pointerup",h,r),window.addEventListener("pointercancel",f,r)};return s.forEach(a=>{!_4e(a)&&a.getAttribute("tabindex")===null&&(a.tabIndex=0),(n.useGlobalTarget?window:a).addEventListener("pointerdown",o,r),a.addEventListener("focus",c=>E4e(c,r),r)}),i}function I4e(t){return t==="x"||t==="y"?ka[t]?null:(ka[t]=!0,()=>{ka[t]=!1}):ka.x||ka.y?null:(ka.x=ka.y=!0,()=>{ka.x=ka.y=!1})}const gG=new Set(["width","height","top","left","right","bottom",...Nm]);let Fv;function R4e(){Fv=void 0}const Pl={now:()=>(Fv===void 0&&Pl.set(br.isProcessing||EMe.useManualTiming?br.timestamp:performance.now()),Fv),set:t=>{Fv=t,queueMicrotask(R4e)}};function wP(t,e){t.indexOf(e)===-1&&t.push(e)}function SP(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class CP{constructor(){this.subscriptions=[]}add(e){return wP(this.subscriptions,e),()=>SP(this.subscriptions,e)}notify(e,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,s);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function kP(t,e){return e?t*(1e3/e):0}const QF=30,P4e=t=>!isNaN(parseFloat(t)),Ug={current:void 0};class A4e{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,r=!0)=>{const i=Pl.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=Pl.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=P4e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new CP);const s=this.events[e].add(n);return e==="change"?()=>{s(),Vn.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Ug.current&&Ug.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Pl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>QF)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,QF);return kP(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wl(t,e){return new A4e(t,e)}function j4e(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,wl(n))}function NP(t,e){const n=W1(t,e);let{transitionEnd:s={},transition:r={},...i}=n||{};i={...i,...s};for(const o in i){const a=XMe(i[o]);j4e(t,o,a)}}function D4e(t){return!!(Zr(t)&&t.add)}function BN(t,e){const n=t.getValue("willChange");if(D4e(n))return n.add(e)}function xG(t){return t.props[GH]}const yG=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,O4e=1e-7,F4e=12;function M4e(t,e,n,s,r){let i,o,a=0;do o=e+(n-e)/2,i=yG(o,s,r)-t,i>0?n=o:e=o;while(Math.abs(i)>O4e&&++a<F4e);return o}function Wx(t,e,n,s){if(t===e&&n===s)return bi;const r=i=>M4e(i,0,1,t,n);return i=>i===0||i===1?i:yG(r(i),e,s)}const vG=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,bG=t=>e=>1-t(1-e),wG=Wx(.33,1.53,.69,.99),TP=bG(wG),SG=vG(TP),CG=t=>(t*=2)<1?.5*TP(t):.5*(2-Math.pow(2,-10*(t-1))),_P=t=>1-Math.sin(Math.acos(t)),kG=bG(_P),NG=vG(_P),TG=t=>/^0[^.\s]+$/u.test(t);function L4e(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||TG(t):!0}const Hg=t=>Math.round(t*1e5)/1e5,EP=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function B4e(t){return t==null}const V4e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,$P=(t,e)=>n=>!!(typeof n=="string"&&V4e.test(n)&&n.startsWith(t)||e&&!B4e(n)&&Object.prototype.hasOwnProperty.call(n,e)),_G=(t,e,n)=>s=>{if(typeof s!="string")return s;const[r,i,o,a]=s.match(EP);return{[t]:parseFloat(r),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},z4e=t=>Ml(0,255,t),AS={...Tm,transform:t=>Math.round(z4e(t))},Hd={test:$P("rgb","red"),parse:_G("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+AS.transform(t)+", "+AS.transform(e)+", "+AS.transform(n)+", "+Hg(V0.transform(s))+")"};function W4e(t){let e="",n="",s="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const VN={test:$P("#"),parse:W4e,transform:Hd.transform},zf={test:$P("hsl","hue"),parse:_G("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+Rl.transform(Hg(e))+", "+Rl.transform(Hg(n))+", "+Hg(V0.transform(s))+")"},Gr={test:t=>Hd.test(t)||VN.test(t)||zf.test(t),parse:t=>Hd.test(t)?Hd.parse(t):zf.test(t)?zf.parse(t):VN.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Hd.transform(t):zf.transform(t)},U4e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function H4e(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(EP))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(U4e))===null||n===void 0?void 0:n.length)||0)>0}const EG="number",$G="color",G4e="var",K4e="var(",ZF="${}",q4e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function z0(t){const e=t.toString(),n=[],s={color:[],number:[],var:[]},r=[];let i=0;const a=e.replace(q4e,l=>(Gr.test(l)?(s.color.push(i),r.push($G),n.push(Gr.parse(l))):l.startsWith(K4e)?(s.var.push(i),r.push(G4e),n.push(l)):(s.number.push(i),r.push(EG),n.push(parseFloat(l))),++i,ZF)).split(ZF);return{values:n,split:a,indexes:s,types:r}}function IG(t){return z0(t).values}function RG(t){const{split:e,types:n}=z0(t),s=e.length;return r=>{let i="";for(let o=0;o<s;o++)if(i+=e[o],r[o]!==void 0){const a=n[o];a===EG?i+=Hg(r[o]):a===$G?i+=Gr.transform(r[o]):i+=r[o]}return i}}const X4e=t=>typeof t=="number"?0:t;function Y4e(t){const e=IG(t);return RG(t)(e.map(X4e))}const Xu={test:H4e,parse:IG,createTransformer:RG,getAnimatableNone:Y4e},Q4e=new Set(["brightness","contrast","saturate","opacity"]);function Z4e(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(EP)||[];if(!s)return t;const r=n.replace(s,"");let i=Q4e.has(e)?1:0;return s!==n&&(i*=100),e+"("+i+r+")"}const J4e=/\b([a-z-]*)\(.*?\)/gu,zN={...Xu,getAnimatableNone:t=>{const e=t.match(J4e);return e?e.map(Z4e).join(" "):t}},eLe={...dP,color:Gr,backgroundColor:Gr,outlineColor:Gr,fill:Gr,stroke:Gr,borderColor:Gr,borderTopColor:Gr,borderRightColor:Gr,borderBottomColor:Gr,borderLeftColor:Gr,filter:zN,WebkitFilter:zN},IP=t=>eLe[t];function PG(t,e){let n=IP(t);return n!==zN&&(n=Xu),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const tLe=new Set(["auto","none","0"]);function nLe(t,e,n){let s=0,r;for(;s<t.length&&!r;){const i=t[s];typeof i=="string"&&!tLe.has(i)&&z0(i).values.length&&(r=t[s]),s++}if(r&&n)for(const i of e)t[i]=PG(n,r)}const JF=t=>t===Tm||t===Lt,eM=(t,e)=>parseFloat(t.split(", ")[e]),tM=(t,e)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/u);if(r)return eM(r[1],e);{const i=s.match(/^matrix\((.+)\)$/u);return i?eM(i[1],t):0}},sLe=new Set(["x","y","z"]),rLe=Nm.filter(t=>!sLe.has(t));function iLe(t){const e=[];return rLe.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e}const Xp={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:tM(4,13),y:tM(5,14)};Xp.translateX=Xp.x;Xp.translateY=Xp.y;const oh=new Set;let WN=!1,UN=!1;function AG(){if(UN){const t=Array.from(oh).filter(s=>s.needsMeasurement),e=new Set(t.map(s=>s.element)),n=new Map;e.forEach(s=>{const r=iLe(s);r.length&&(n.set(s,r),s.render())}),t.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=n.get(s);r&&r.forEach(([i,o])=>{var a;(a=s.getValue(i))===null||a===void 0||a.set(o)})}),t.forEach(s=>s.measureEndState()),t.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}UN=!1,WN=!1,oh.forEach(t=>t.complete()),oh.clear()}function jG(){oh.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(UN=!0)})}function oLe(){jG(),AG()}class RP{constructor(e,n,s,r,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=s,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(oh.add(this),WN||(WN=!0,Vn.read(jG),Vn.resolveKeyframes(AG))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:s,motionValue:r}=this;for(let i=0;i<e.length;i++)if(e[i]===null)if(i===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(s&&n){const l=s.readValue(n,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),oh.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,oh.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const DG=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),aLe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function lLe(t){const e=aLe.exec(t);if(!e)return[,];const[,n,s,r]=e;return[`--${n??s}`,r]}function OG(t,e,n=1){const[s,r]=lLe(t);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return DG(o)?parseFloat(o):o}return uP(r)?OG(r,e,n+1):r}const FG=t=>e=>e.test(t),cLe={test:t=>t==="auto",parse:t=>t},MG=[Tm,Lt,Rl,Yc,t4e,e4e,cLe],nM=t=>MG.find(FG(t));class LG extends RP{constructor(e,n,s,r,i){super(e,n,s,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),uP(c))){const d=OG(c,n.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!gG.has(s)||e.length!==2)return;const[r,i]=e,o=nM(r),a=nM(i);if(o!==a)if(JF(o)&&JF(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,s=[];for(let r=0;r<e.length;r++)L4e(e[r])&&s.push(r);s.length&&nLe(e,s,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Xp[s](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const r=n[n.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){var e;const{element:n,name:s,unresolvedKeyframes:r}=this;if(!n||!n.current)return;const i=n.getValue(s);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Xp[s](n.measureViewportBox(),window.getComputedStyle(n.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,c])=>{n.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const sM=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Xu.test(t)||t==="0")&&!t.startsWith("url("));function uLe(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function dLe(t,e,n,s){const r=t[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const i=t[t.length-1],o=sM(r,e),a=sM(i,e);return!o||!a?!1:uLe(t)||(n==="spring"||yP(n))&&s}const hLe=t=>t!==null;function U1(t,{repeat:e,repeatType:n="loop"},s){const r=t.filter(hLe),i=e&&n!=="loop"&&e%2===1?0:r.length-1;return!i||s===void 0?r[i]:s}const fLe=40;class BG{constructor({autoplay:e=!0,delay:n=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Pl.now(),this.options={autoplay:e,delay:n,type:s,repeat:r,repeatDelay:i,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>fLe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&oLe(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=Pl.now(),this.hasAttemptedResolve=!0;const{name:s,type:r,velocity:i,delay:o,onComplete:a,onUpdate:l,isGenerator:c}=this.options;if(!c&&!dLe(e,s,r,i))if(o)this.options.duration=0;else{l&&l(U1(e,this.options,n)),a&&a(),this.resolveFinishedPromise();return}const d=this.initPlayback(e,n);d!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...d},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Os=(t,e,n)=>t+(e-t)*n;function jS(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function pLe({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let r=0,i=0,o=0;if(!e)r=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=jS(l,a,t+1/3),i=jS(l,a,t),o=jS(l,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}function lw(t,e){return n=>n>0?e:t}const DS=(t,e,n)=>{const s=t*t,r=n*(e*e-s)+s;return r<0?0:Math.sqrt(r)},mLe=[VN,Hd,zf],gLe=t=>mLe.find(e=>e.test(t));function rM(t){const e=gLe(t);if(!e)return!1;let n=e.parse(t);return e===zf&&(n=pLe(n)),n}const iM=(t,e)=>{const n=rM(t),s=rM(e);if(!n||!s)return lw(t,e);const r={...n};return i=>(r.red=DS(n.red,s.red,i),r.green=DS(n.green,s.green,i),r.blue=DS(n.blue,s.blue,i),r.alpha=Os(n.alpha,s.alpha,i),Hd.transform(r))},xLe=(t,e)=>n=>e(t(n)),Ux=(...t)=>t.reduce(xLe),HN=new Set(["none","hidden"]);function yLe(t,e){return HN.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function vLe(t,e){return n=>Os(t,e,n)}function PP(t){return typeof t=="number"?vLe:typeof t=="string"?uP(t)?lw:Gr.test(t)?iM:SLe:Array.isArray(t)?VG:typeof t=="object"?Gr.test(t)?iM:bLe:lw}function VG(t,e){const n=[...t],s=n.length,r=t.map((i,o)=>PP(i)(i,e[o]));return i=>{for(let o=0;o<s;o++)n[o]=r[o](i);return n}}function bLe(t,e){const n={...t,...e},s={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(s[r]=PP(t[r])(t[r],e[r]));return r=>{for(const i in s)n[i]=s[i](r);return n}}function wLe(t,e){var n;const s=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const o=e.types[i],a=t.indexes[o][r[o]],l=(n=t.values[a])!==null&&n!==void 0?n:0;s[i]=l,r[o]++}return s}const SLe=(t,e)=>{const n=Xu.createTransformer(e),s=z0(t),r=z0(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?HN.has(t)&&!r.values.length||HN.has(e)&&!s.values.length?yLe(t,e):Ux(VG(wLe(s,r),r.values),n):lw(t,e)};function zG(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?Os(t,e,n):PP(t)(t,e)}const CLe=5;function WG(t,e,n){const s=Math.max(e-CLe,0);return kP(n-t(s),e-s)}const Hs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},OS=.001;function kLe({duration:t=Hs.duration,bounce:e=Hs.bounce,velocity:n=Hs.velocity,mass:s=Hs.mass}){let r,i,o=1-e;o=Ml(Hs.minDamping,Hs.maxDamping,o),t=Ml(Hs.minDuration,Hs.maxDuration,gc(t)),o<1?(r=c=>{const d=c*o,h=d*t,f=d-n,p=GN(c,o),m=Math.exp(-h);return OS-f/p*m},i=c=>{const h=c*o*t,f=h*n+n,p=Math.pow(o,2)*Math.pow(c,2)*t,m=Math.exp(-h),g=GN(Math.pow(c,2),o);return(-r(c)+OS>0?-1:1)*((f-p)*m)/g}):(r=c=>{const d=Math.exp(-c*t),h=(c-n)*t+1;return-OS+d*h},i=c=>{const d=Math.exp(-c*t),h=(n-c)*(t*t);return d*h});const a=5/t,l=TLe(r,i,a);if(t=mc(t),isNaN(l))return{stiffness:Hs.stiffness,damping:Hs.damping,duration:t};{const c=Math.pow(l,2)*s;return{stiffness:c,damping:o*2*Math.sqrt(s*c),duration:t}}}const NLe=12;function TLe(t,e,n){let s=n;for(let r=1;r<NLe;r++)s=s-t(s)/e(s);return s}function GN(t,e){return t*Math.sqrt(1-e*e)}const _Le=["duration","bounce"],ELe=["stiffness","damping","mass"];function oM(t,e){return e.some(n=>t[n]!==void 0)}function $Le(t){let e={velocity:Hs.velocity,stiffness:Hs.stiffness,damping:Hs.damping,mass:Hs.mass,isResolvedFromDuration:!1,...t};if(!oM(t,ELe)&&oM(t,_Le))if(t.visualDuration){const n=t.visualDuration,s=2*Math.PI/(n*1.2),r=s*s,i=2*Ml(.05,1,1-(t.bounce||0))*Math.sqrt(r);e={...e,mass:Hs.mass,stiffness:r,damping:i}}else{const n=kLe(t);e={...e,...n,mass:Hs.mass},e.isResolvedFromDuration=!0}return e}function UG(t=Hs.visualDuration,e=Hs.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:s,restDelta:r}=n;const i=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:d,duration:h,velocity:f,isResolvedFromDuration:p}=$Le({...n,velocity:-gc(n.velocity||0)}),m=f||0,g=c/(2*Math.sqrt(l*d)),x=o-i,y=gc(Math.sqrt(l/d)),v=Math.abs(x)<5;s||(s=v?Hs.restSpeed.granular:Hs.restSpeed.default),r||(r=v?Hs.restDelta.granular:Hs.restDelta.default);let S;if(g<1){const k=GN(y,g);S=T=>{const _=Math.exp(-g*y*T);return o-_*((m+g*y*x)/k*Math.sin(k*T)+x*Math.cos(k*T))}}else if(g===1)S=k=>o-Math.exp(-y*k)*(x+(m+y*x)*k);else{const k=y*Math.sqrt(g*g-1);S=T=>{const _=Math.exp(-g*y*T),$=Math.min(k*T,300);return o-_*((m+g*y*x)*Math.sinh($)+k*x*Math.cosh($))/k}}const C={calculatedDuration:p&&h||null,next:k=>{const T=S(k);if(p)a.done=k>=h;else{let _=0;g<1&&(_=k===0?mc(m):WG(S,k,T));const $=Math.abs(_)<=s,R=Math.abs(o-T)<=r;a.done=$&&R}return a.value=a.done?o:T,a},toString:()=>{const k=Math.min(lG(C),MN),T=cG(_=>C.next(k*_).value,k,30);return k+"ms "+T}};return C}function aM({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:d}){const h=t[0],f={done:!1,value:h},p=$=>a!==void 0&&$<a||l!==void 0&&$>l,m=$=>a===void 0?l:l===void 0||Math.abs(a-$)<Math.abs(l-$)?a:l;let g=n*e;const x=h+g,y=o===void 0?x:o(x);y!==x&&(g=y-h);const v=$=>-g*Math.exp(-$/s),S=$=>y+v($),C=$=>{const R=v($),A=S($);f.done=Math.abs(R)<=c,f.value=f.done?y:A};let k,T;const _=$=>{p(f.value)&&(k=$,T=UG({keyframes:[f.value,m(f.value)],velocity:WG(S,$,f.value),damping:r,stiffness:i,restDelta:c,restSpeed:d}))};return _(0),{calculatedDuration:null,next:$=>{let R=!1;return!T&&k===void 0&&(R=!0,C($),_($)),k!==void 0&&$>=k?T.next($-k):(!R&&C($),f)}}}const ILe=Wx(.42,0,1,1),RLe=Wx(0,0,.58,1),HG=Wx(.42,0,.58,1),PLe=t=>Array.isArray(t)&&typeof t[0]!="number",lM={linear:bi,easeIn:ILe,easeInOut:HG,easeOut:RLe,circIn:_P,circInOut:NG,circOut:kG,backIn:TP,backInOut:SG,backOut:wG,anticipate:CG},cM=t=>{if(vP(t)){ON(t.length===4);const[e,n,s,r]=t;return Wx(e,n,s,r)}else if(typeof t=="string")return ON(lM[t]!==void 0),lM[t];return t};function ALe(t,e,n){const s=[],r=n||zG,i=t.length-1;for(let o=0;o<i;o++){let a=r(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||bi:e;a=Ux(l,a)}s.push(a)}return s}function AP(t,e,{clamp:n=!0,ease:s,mixer:r}={}){const i=t.length;if(ON(i===e.length),i===1)return()=>e[0];if(i===2&&e[0]===e[1])return()=>e[1];const o=t[0]===t[1];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const a=ALe(e,s,r),l=a.length,c=d=>{if(o&&d<t[0])return e[0];let h=0;if(l>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const f=$h(t[h],t[h+1],d);return a[h](f)};return n?d=>c(Ml(t[0],t[i-1],d)):c}function jLe(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const r=$h(0,e,s);t.push(Os(n,1,r))}}function GG(t){const e=[0];return jLe(e,t.length-1),e}function DLe(t,e){return t.map(n=>n*e)}function OLe(t,e){return t.map(()=>e||HG).splice(0,t.length-1)}function cw({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const r=PLe(s)?s.map(cM):cM(s),i={done:!1,value:e[0]},o=DLe(n&&n.length===e.length?n:GG(e),t),a=AP(o,e,{ease:Array.isArray(r)?r:OLe(e,r)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}const FLe=t=>{const e=({timestamp:n})=>t(n);return{start:()=>Vn.update(e,!0),stop:()=>Ya(e),now:()=>br.isProcessing?br.timestamp:Pl.now()}},MLe={decay:aM,inertia:aM,tween:cw,keyframes:cw,spring:UG},LLe=t=>t/100;class jP extends BG{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:n,motionValue:s,element:r,keyframes:i}=this.options,o=(r==null?void 0:r.KeyframeResolver)||RP,a=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new o(i,a,n,s,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=this.options,a=yP(n)?n:MLe[n]||cw;let l,c;a!==cw&&typeof e[0]!="number"&&(l=Ux(LLe,zG(e[0],e[1])),e=[0,100]);const d=a({...this.options,keyframes:e});i==="mirror"&&(c=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=lG(d));const{calculatedDuration:h}=d,f=h+r,p=f*(s+1)-r;return{generator:d,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:h,resolvedDuration:f,totalDuration:p}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:s}=this;if(!s){const{keyframes:$}=this.options;return{done:!0,value:$[$.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:c,totalDuration:d,resolvedDuration:h}=s;if(this.startTime===null)return i.next(0);const{delay:f,repeat:p,repeatType:m,repeatDelay:g,onUpdate:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-d/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const y=this.currentTime-f*(this.speed>=0?1:-1),v=this.speed>=0?y<0:y>d;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=d);let S=this.currentTime,C=i;if(p){const $=Math.min(this.currentTime,d)/h;let R=Math.floor($),A=$%1;!A&&$>=1&&(A=1),A===1&&R--,R=Math.min(R,p+1),!!(R%2)&&(m==="reverse"?(A=1-A,g&&(A-=g/h)):m==="mirror"&&(C=o)),S=Ml(0,1,A)*h}const k=v?{done:!1,value:l[0]}:C.next(S);a&&(k.value=a(k.value));let{done:T}=k;!v&&c!==null&&(T=this.speed>=0?this.currentTime>=d:this.currentTime<=0);const _=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&T);return _&&r!==void 0&&(k.value=U1(l,this.options,r)),x&&x(k.value),_&&this.finish(),k}get duration(){const{resolved:e}=this;return e?gc(e.calculatedDuration):0}get time(){return gc(this.currentTime)}set time(e){e=mc(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=gc(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=FLe,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),n&&n();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const BLe=new Set(["opacity","clipPath","filter","transform"]);function VLe(t,e,n,{delay:s=0,duration:r=300,repeat:i=0,repeatType:o="loop",ease:a="easeInOut",times:l}={}){const c={[e]:n};l&&(c.offset=l);const d=dG(a,r);return Array.isArray(d)&&(c.easing=d),t.animate(c,{delay:s,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}const zLe=sP(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),uw=10,WLe=2e4;function ULe(t){return yP(t.type)||t.type==="spring"||!uG(t.ease)}function HLe(t,e){const n=new jP({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:t[0]};const r=[];let i=0;for(;!s.done&&i<WLe;)s=n.sample(i),r.push(s.value),i+=uw;return{times:void 0,keyframes:r,duration:i-uw,ease:"linear"}}const KG={anticipate:CG,backInOut:SG,circInOut:NG};function GLe(t){return t in KG}class uM extends BG{constructor(e){super(e);const{name:n,motionValue:s,element:r,keyframes:i}=this.options;this.resolver=new LG(i,(o,a)=>this.onKeyframesResolved(o,a),n,s,r),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:s=300,times:r,ease:i,type:o,motionValue:a,name:l,startTime:c}=this.options;if(!a.owner||!a.owner.current)return!1;if(typeof i=="string"&&aw()&&GLe(i)&&(i=KG[i]),ULe(this.options)){const{onComplete:h,onUpdate:f,motionValue:p,element:m,...g}=this.options,x=HLe(e,g);e=x.keyframes,e.length===1&&(e[1]=e[0]),s=x.duration,r=x.times,i=x.ease,o="keyframes"}const d=VLe(a.owner.current,l,e,{...this.options,duration:s,times:r,ease:i});return d.startTime=c??this.calcStartTime(),this.pendingTimeline?(KF(d,this.pendingTimeline),this.pendingTimeline=void 0):d.onfinish=()=>{const{onComplete:h}=this.options;a.set(U1(e,this.options,n)),h&&h(),this.cancel(),this.resolveFinishedPromise()},{animation:d,duration:s,times:r,type:o,ease:i,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return gc(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return gc(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=mc(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return bi;const{animation:s}=n;KF(s,e)}return bi}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:s,duration:r,type:i,ease:o,times:a}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:d,onComplete:h,element:f,...p}=this.options,m=new jP({...p,keyframes:s,duration:r,type:i,ease:o,times:a,isGenerator:!0}),g=mc(this.time);c.setWithVelocity(m.sample(g-uw).value,m.sample(g).value,uw)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:s,repeatDelay:r,repeatType:i,damping:o,type:a}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=n.owner.getProps();return zLe()&&s&&BLe.has(s)&&!l&&!c&&!r&&i!=="mirror"&&o!==0&&a!=="inertia"}}const KLe={type:"spring",stiffness:500,damping:25,restSpeed:10},qLe=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),XLe={type:"keyframes",duration:.8},YLe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},QLe=(t,{keyframes:e})=>e.length>2?XLe:tf.has(t)?t.startsWith("scale")?qLe(e[1]):KLe:YLe;function ZLe({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...d}){return!!Object.keys(d).length}const DP=(t,e,n,s={},r,i)=>o=>{const a=xP(s,t)||{},l=a.delay||s.delay||0;let{elapsed:c=0}=s;c=c-mc(l);let d={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:f=>{e.set(f),a.onUpdate&&a.onUpdate(f)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:t,motionValue:e,element:i?void 0:r};ZLe(a)||(d={...d,...QLe(t,d)}),d.duration&&(d.duration=mc(d.duration)),d.repeatDelay&&(d.repeatDelay=mc(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(d.duration=0,d.delay===0&&(h=!0)),h&&!i&&e.get()!==void 0){const f=U1(d.keyframes,a);if(f!==void 0)return Vn.update(()=>{d.onUpdate(f),d.onComplete()}),new S4e([])}return!i&&uM.supports(d)?new uM(d):new jP(d)};function JLe({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function qG(t,e,{delay:n=0,transitionOverride:s,type:r}={}){var i;let{transition:o=t.getDefaultTransition(),transitionEnd:a,...l}=e;s&&(o=s);const c=[],d=r&&t.animationState&&t.animationState.getState()[r];for(const h in l){const f=t.getValue(h,(i=t.latestValues[h])!==null&&i!==void 0?i:null),p=l[h];if(p===void 0||d&&JLe(d,h))continue;const m={delay:n,...xP(o||{},h)};let g=!1;if(window.MotionHandoffAnimation){const y=xG(t);if(y){const v=window.MotionHandoffAnimation(y,h,Vn);v!==null&&(m.startTime=v,g=!0)}}BN(t,h),f.start(DP(h,f,p,t.shouldReduceMotion&&gG.has(h)?{type:!1}:m,t,g));const x=f.animation;x&&c.push(x)}return a&&Promise.all(c).then(()=>{Vn.update(()=>{a&&NP(t,a)})}),c}function KN(t,e,n={}){var s;const r=W1(t,e,n.type==="exit"?(s=t.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(qG(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:f}=i;return e5e(t,e,d+c,h,f,n)}:()=>Promise.resolve(),{when:l}=i;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(n.delay)])}function e5e(t,e,n=0,s=0,r=1,i){const o=[],a=(t.variantChildren.size-1)*s,l=r===1?(c=0)=>c*s:(c=0)=>a-c*s;return Array.from(t.variantChildren).sort(t5e).forEach((c,d)=>{c.notify("AnimationStart",e),o.push(KN(c,e,{...i,delay:n+l(d)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function t5e(t,e){return t.sortNodePosition(e)}function XG(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(i=>KN(t,i,n));s=Promise.all(r)}else if(typeof e=="string")s=KN(t,e,n);else{const r=typeof e=="function"?W1(t,e,n.custom):e;s=Promise.all(qG(t,r,n))}return s.then(()=>{t.notify("AnimationComplete",e)})}const n5e=iP.length;function YG(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?YG(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<n5e;n++){const s=iP[n],r=t.props[s];(B0(r)||r===!1)&&(e[s]=r)}return e}const s5e=[...rP].reverse(),r5e=rP.length;function i5e(t){return e=>Promise.all(e.map(({animation:n,options:s})=>XG(t,n,s)))}function o5e(t){let e=i5e(t),n=dM(),s=!0;const r=l=>(c,d)=>{var h;const f=W1(t,d,l==="exit"?(h=t.presenceContext)===null||h===void 0?void 0:h.custom:void 0);if(f){const{transition:p,transitionEnd:m,...g}=f;c={...c,...g,...m}}return c};function i(l){e=l(t)}function o(l){const{props:c}=t,d=YG(t.parent)||{},h=[],f=new Set;let p={},m=1/0;for(let x=0;x<r5e;x++){const y=s5e[x],v=n[y],S=c[y]!==void 0?c[y]:d[y],C=B0(S),k=y===l?v.isActive:null;k===!1&&(m=x);let T=S===d[y]&&S!==c[y]&&C;if(T&&s&&t.manuallyAnimateOnMount&&(T=!1),v.protectedKeys={...p},!v.isActive&&k===null||!S&&!v.prevProp||V1(S)||typeof S=="boolean")continue;const _=a5e(v.prevProp,S);let $=_||y===l&&v.isActive&&!T&&C||x>m&&C,R=!1;const A=Array.isArray(S)?S:[S];let j=A.reduce(r(y),{});k===!1&&(j={});const{prevResolvedValues:F={}}=v,L={...F,...j},M=re=>{$=!0,f.has(re)&&(R=!0,f.delete(re)),v.needsAnimating[re]=!0;const U=t.getValue(re);U&&(U.liveStyle=!1)};for(const re in L){const U=j[re],G=F[re];if(p.hasOwnProperty(re))continue;let xe=!1;FN(U)&&FN(G)?xe=!oG(U,G):xe=U!==G,xe?U!=null?M(re):f.add(re):U!==void 0&&f.has(re)?M(re):v.protectedKeys[re]=!0}v.prevProp=S,v.prevResolvedValues=j,v.isActive&&(p={...p,...j}),s&&t.blockInitialAnimation&&($=!1),$&&(!(T&&_)||R)&&h.push(...A.map(re=>({animation:re,options:{type:y}})))}if(f.size){const x={};f.forEach(y=>{const v=t.getBaseTarget(y),S=t.getValue(y);S&&(S.liveStyle=!0),x[y]=v??null}),h.push({animation:x})}let g=!!h.length;return s&&(c.initial===!1||c.initial===c.animate)&&!t.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function a(l,c){var d;if(n[l].isActive===c)return Promise.resolve();(d=t.variantChildren)===null||d===void 0||d.forEach(f=>{var p;return(p=f.animationState)===null||p===void 0?void 0:p.setActive(l,c)}),n[l].isActive=c;const h=o(l);for(const f in n)n[f].protectedKeys={};return h}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n,reset:()=>{n=dM(),s=!0}}}function a5e(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!oG(e,t):!1}function vd(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dM(){return{animate:vd(!0),whileInView:vd(),whileHover:vd(),whileTap:vd(),whileDrag:vd(),whileFocus:vd(),exit:vd()}}class ud{constructor(e){this.isMounted=!1,this.node=e}update(){}}class l5e extends ud{constructor(e){super(e),e.animationState||(e.animationState=o5e(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();V1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let c5e=0;class u5e extends ud{constructor(){super(...arguments),this.id=c5e++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);n&&!e&&r.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const d5e={animation:{Feature:l5e},exit:{Feature:u5e}};function W0(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}function Hx(t){return{point:{x:t.pageX,y:t.pageY}}}const h5e=t=>e=>bP(e)&&t(e,Hx(e));function Gg(t,e,n,s){return W0(t,e,h5e(n),s)}const hM=(t,e)=>Math.abs(t-e);function f5e(t,e){const n=hM(t.x,e.x),s=hM(t.y,e.y);return Math.sqrt(n**2+s**2)}class QG{constructor(e,n,{transformPagePoint:s,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=MS(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,p=f5e(h.offset,{x:0,y:0})>=3;if(!f&&!p)return;const{point:m}=h,{timestamp:g}=br;this.history.push({...m,timestamp:g});const{onStart:x,onMove:y}=this.handlers;f||(x&&x(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=FS(f,this.transformPagePoint),Vn.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:p,onSessionEnd:m,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=MS(h.type==="pointercancel"?this.lastMoveEventInfo:FS(f,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,x),m&&m(h,x)},!bP(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=s,this.contextWindow=r||window;const o=Hx(e),a=FS(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=br;this.history=[{...l,timestamp:c}];const{onSessionStart:d}=n;d&&d(e,MS(a,this.history)),this.removeListeners=Ux(Gg(this.contextWindow,"pointermove",this.handlePointerMove),Gg(this.contextWindow,"pointerup",this.handlePointerUp),Gg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ya(this.updatePoint)}}function FS(t,e){return e?{point:e(t.point)}:t}function fM(t,e){return{x:t.x-e.x,y:t.y-e.y}}function MS({point:t},e){return{point:t,delta:fM(t,ZG(e)),offset:fM(t,p5e(e)),velocity:m5e(e,.1)}}function p5e(t){return t[0]}function ZG(t){return t[t.length-1]}function m5e(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const r=ZG(t);for(;n>=0&&(s=t[n],!(r.timestamp-s.timestamp>mc(e)));)n--;if(!s)return{x:0,y:0};const i=gc(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}const JG=1e-4,g5e=1-JG,x5e=1+JG,e9=.01,y5e=0-e9,v5e=0+e9;function $o(t){return t.max-t.min}function b5e(t,e,n){return Math.abs(t-e)<=n}function pM(t,e,n,s=.5){t.origin=s,t.originPoint=Os(e.min,e.max,t.origin),t.scale=$o(n)/$o(e),t.translate=Os(n.min,n.max,t.origin)-t.originPoint,(t.scale>=g5e&&t.scale<=x5e||isNaN(t.scale))&&(t.scale=1),(t.translate>=y5e&&t.translate<=v5e||isNaN(t.translate))&&(t.translate=0)}function Kg(t,e,n,s){pM(t.x,e.x,n.x,s?s.originX:void 0),pM(t.y,e.y,n.y,s?s.originY:void 0)}function mM(t,e,n){t.min=n.min+e.min,t.max=t.min+$o(e)}function w5e(t,e,n){mM(t.x,e.x,n.x),mM(t.y,e.y,n.y)}function gM(t,e,n){t.min=e.min-n.min,t.max=t.min+$o(e)}function qg(t,e,n){gM(t.x,e.x,n.x),gM(t.y,e.y,n.y)}function S5e(t,{min:e,max:n},s){return e!==void 0&&t<e?t=s?Os(e,t,s.min):Math.max(t,e):n!==void 0&&t>n&&(t=s?Os(n,t,s.max):Math.min(t,n)),t}function xM(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function C5e(t,{top:e,left:n,bottom:s,right:r}){return{x:xM(t.x,n,r),y:xM(t.y,e,s)}}function yM(t,e){let n=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,s]=[s,n]),{min:n,max:s}}function k5e(t,e){return{x:yM(t.x,e.x),y:yM(t.y,e.y)}}function N5e(t,e){let n=.5;const s=$o(t),r=$o(e);return r>s?n=$h(e.min,e.max-s,t.min):s>r&&(n=$h(t.min,t.max-r,e.min)),Ml(0,1,n)}function T5e(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const qN=.35;function _5e(t=qN){return t===!1?t=0:t===!0&&(t=qN),{x:vM(t,"left","right"),y:vM(t,"top","bottom")}}function vM(t,e,n){return{min:bM(t,e),max:bM(t,n)}}function bM(t,e){return typeof t=="number"?t:t[e]||0}const wM=()=>({translate:0,scale:1,origin:0,originPoint:0}),Wf=()=>({x:wM(),y:wM()}),SM=()=>({min:0,max:0}),Zs=()=>({x:SM(),y:SM()});function Go(t){return[t("x"),t("y")]}function t9({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function E5e({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function $5e(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function LS(t){return t===void 0||t===1}function XN({scale:t,scaleX:e,scaleY:n}){return!LS(t)||!LS(e)||!LS(n)}function Ed(t){return XN(t)||n9(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function n9(t){return CM(t.x)||CM(t.y)}function CM(t){return t&&t!=="0%"}function dw(t,e,n){const s=t-n,r=e*s;return n+r}function kM(t,e,n,s,r){return r!==void 0&&(t=dw(t,r,s)),dw(t,n,s)+e}function YN(t,e=0,n=1,s,r){t.min=kM(t.min,e,n,s,r),t.max=kM(t.max,e,n,s,r)}function s9(t,{x:e,y:n}){YN(t.x,e.translate,e.scale,e.originPoint),YN(t.y,n.translate,n.scale,n.originPoint)}const NM=.999999999999,TM=1.0000000000001;function I5e(t,e,n,s=!1){const r=n.length;if(!r)return;e.x=e.y=1;let i,o;for(let a=0;a<r;a++){i=n[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Hf(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,s9(t,o)),s&&Ed(i.latestValues)&&Hf(t,i.latestValues))}e.x<TM&&e.x>NM&&(e.x=1),e.y<TM&&e.y>NM&&(e.y=1)}function Uf(t,e){t.min=t.min+e,t.max=t.max+e}function _M(t,e,n,s,r=.5){const i=Os(t.min,t.max,r);YN(t,e,n,i,s)}function Hf(t,e){_M(t.x,e.x,e.scaleX,e.scale,e.originX),_M(t.y,e.y,e.scaleY,e.scale,e.originY)}function r9(t,e){return t9($5e(t.getBoundingClientRect(),e))}function R5e(t,e,n){const s=r9(t,n),{scroll:r}=e;return r&&(Uf(s.x,r.offset.x),Uf(s.y,r.offset.y)),s}const i9=({current:t})=>t?t.ownerDocument.defaultView:null,P5e=new WeakMap;class A5e{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Zs(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const r=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Hx(d).point)},i=(d,h)=>{const{drag:f,dragPropagation:p,onDragStart:m}=this.getProps();if(f&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=I4e(f),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Go(x=>{let y=this.getAxisMotionValue(x).get()||0;if(Rl.test(y)){const{projection:v}=this.visualElement;if(v&&v.layout){const S=v.layout.layoutBox[x];S&&(y=$o(S)*(parseFloat(y)/100))}}this.originPoint[x]=y}),m&&Vn.postRender(()=>m(d,h)),BN(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},o=(d,h)=>{const{dragPropagation:f,dragDirectionLock:p,onDirectionLock:m,onDrag:g}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:x}=h;if(p&&this.currentDirection===null){this.currentDirection=j5e(x),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",h.point,x),this.updateAxis("y",h.point,x),this.visualElement.render(),g&&g(d,h)},a=(d,h)=>this.stop(d,h),l=()=>Go(d=>{var h;return this.getAnimationState(d)==="paused"&&((h=this.getAxisMotionValue(d).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new QG(e,{onSessionStart:r,onStart:i,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:i9(this.visualElement)})}stop(e,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&Vn.postRender(()=>i(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,s){const{drag:r}=this.getProps();if(!s||!ev(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=S5e(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:s}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;n&&Vf(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=C5e(r.layoutBox,n):this.constraints=!1,this.elastic=_5e(s),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Go(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=T5e(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Vf(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=R5e(s,r.root,this.visualElement.getTransformPagePoint());let o=k5e(r.layout.layoutBox,i);if(n){const a=n(E5e(o));this.hasMutatedConstraints=!!a,a&&(o=t9(a))}return o}startAnimation(e){const{drag:n,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=Go(d=>{if(!ev(d,n,this.currentDirection))return;let h=l&&l[d]||{};o&&(h={min:0,max:0});const f=r?200:1e6,p=r?40:1e7,m={type:"inertia",velocity:s?e[d]:0,bounceStiffness:f,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(d,m)});return Promise.all(c).then(a)}startAxisValueAnimation(e,n){const s=this.getAxisMotionValue(e);return BN(this.visualElement,e),s.start(DP(e,s,0,n,this.visualElement,!1))}stopAnimation(){Go(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Go(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[n];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Go(n=>{const{drag:s}=this.getProps();if(!ev(n,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];i.set(e[n]-Os(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!Vf(n)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Go(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=N5e({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Go(o=>{if(!ev(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(Os(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;P5e.set(this.visualElement,this);const e=this.visualElement.current,n=Gg(e,"pointerdown",l=>{const{drag:c,dragListener:d=!0}=this.getProps();c&&d&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();Vf(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),Vn.read(s);const o=W0(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Go(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=l[d].translate,h.set(h.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=qN,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function ev(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function j5e(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class D5e extends ud{constructor(e){super(e),this.removeGroupControls=bi,this.removeListeners=bi,this.controls=new A5e(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||bi}unmount(){this.removeGroupControls(),this.removeListeners()}}const EM=t=>(e,n)=>{t&&Vn.postRender(()=>t(e,n))};class O5e extends ud{constructor(){super(...arguments),this.removePointerDownListener=bi}onPointerDown(e){this.session=new QG(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:i9(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:EM(e),onStart:EM(n),onMove:s,onEnd:(i,o)=>{delete this.session,r&&Vn.postRender(()=>r(i,o))}}}mount(){this.removePointerDownListener=Gg(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Mv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function $M(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ym={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Lt.test(t))t=parseFloat(t);else return t;const n=$M(t,e.target.x),s=$M(t,e.target.y);return`${n}% ${s}%`}},F5e={correct:(t,{treeScale:e,projectionDelta:n})=>{const s=t,r=Xu.parse(t);if(r.length>5)return s;const i=Xu.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=Os(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),i(r)}};class M5e extends b.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=e;d4e(L5e),i&&(n.group&&n.group.add(i),s&&s.register&&r&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Mv.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:s,drag:r,isPresent:i}=this.props,o=s.projection;return o&&(o.isPresent=i,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Vn.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),aP.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function o9(t){const[e,n]=VH(),s=b.useContext(tP);return u.jsx(M5e,{...t,layoutGroup:s,switchLayoutGroup:b.useContext(KH),isPresent:e,safeToRemove:n})}const L5e={borderRadius:{...Ym,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ym,borderTopRightRadius:Ym,borderBottomLeftRadius:Ym,borderBottomRightRadius:Ym,boxShadow:F5e};function B5e(t,e,n){const s=Zr(t)?t:wl(t);return s.start(DP("",s,e,n)),s.animation}function V5e(t){return t instanceof SVGElement&&t.tagName!=="svg"}const z5e=(t,e)=>t.depth-e.depth;class W5e{constructor(){this.children=[],this.isDirty=!1}add(e){wP(this.children,e),this.isDirty=!0}remove(e){SP(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(z5e),this.isDirty=!1,this.children.forEach(e)}}function U5e(t,e){const n=Pl.now(),s=({timestamp:r})=>{const i=r-n;i>=e&&(Ya(s),t(i-e))};return Vn.read(s,!0),()=>Ya(s)}const a9=["TopLeft","TopRight","BottomLeft","BottomRight"],H5e=a9.length,IM=t=>typeof t=="string"?parseFloat(t):t,RM=t=>typeof t=="number"||Lt.test(t);function G5e(t,e,n,s,r,i){r?(t.opacity=Os(0,n.opacity!==void 0?n.opacity:1,K5e(s)),t.opacityExit=Os(e.opacity!==void 0?e.opacity:1,0,q5e(s))):i&&(t.opacity=Os(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let o=0;o<H5e;o++){const a=`border${a9[o]}Radius`;let l=PM(e,a),c=PM(n,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||RM(l)===RM(c)?(t[a]=Math.max(Os(IM(l),IM(c),s),0),(Rl.test(c)||Rl.test(l))&&(t[a]+="%")):t[a]=c}(e.rotate||n.rotate)&&(t.rotate=Os(e.rotate||0,n.rotate||0,s))}function PM(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const K5e=l9(0,.5,kG),q5e=l9(.5,.95,bi);function l9(t,e,n){return s=>s<t?0:s>e?1:n($h(t,e,s))}function AM(t,e){t.min=e.min,t.max=e.max}function Ho(t,e){AM(t.x,e.x),AM(t.y,e.y)}function jM(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function DM(t,e,n,s,r){return t-=e,t=dw(t,1/n,s),r!==void 0&&(t=dw(t,1/r,s)),t}function X5e(t,e=0,n=1,s=.5,r,i=t,o=t){if(Rl.test(e)&&(e=parseFloat(e),e=Os(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=Os(i.min,i.max,s);t===i&&(a-=e),t.min=DM(t.min,e,n,a,r),t.max=DM(t.max,e,n,a,r)}function OM(t,e,[n,s,r],i,o){X5e(t,e[n],e[s],e[r],e.scale,i,o)}const Y5e=["x","scaleX","originX"],Q5e=["y","scaleY","originY"];function FM(t,e,n,s){OM(t.x,e,Y5e,n?n.x:void 0,s?s.x:void 0),OM(t.y,e,Q5e,n?n.y:void 0,s?s.y:void 0)}function MM(t){return t.translate===0&&t.scale===1}function c9(t){return MM(t.x)&&MM(t.y)}function LM(t,e){return t.min===e.min&&t.max===e.max}function Z5e(t,e){return LM(t.x,e.x)&&LM(t.y,e.y)}function BM(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function u9(t,e){return BM(t.x,e.x)&&BM(t.y,e.y)}function VM(t){return $o(t.x)/$o(t.y)}function zM(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class J5e{constructor(){this.members=[]}add(e){wP(this.members,e),e.scheduleRender()}remove(e){if(SP(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let s;for(let r=n;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,n){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,n&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:s}=e;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function eBe(t,e,n){let s="";const r=t.x.translate/e.x,i=t.y.translate/e.y,o=(n==null?void 0:n.z)||0;if((r||i||o)&&(s=`translate3d(${r}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:c,rotate:d,rotateX:h,rotateY:f,skewX:p,skewY:m}=n;c&&(s=`perspective(${c}px) ${s}`),d&&(s+=`rotate(${d}deg) `),h&&(s+=`rotateX(${h}deg) `),f&&(s+=`rotateY(${f}deg) `),p&&(s+=`skewX(${p}deg) `),m&&(s+=`skewY(${m}deg) `)}const a=t.x.scale*e.x,l=t.y.scale*e.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const $d={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},vg=typeof window<"u"&&window.MotionDebug!==void 0,BS=["","X","Y","Z"],tBe={visibility:"hidden"},WM=1e3;let nBe=0;function VS(t,e,n,s){const{latestValues:r}=e;r[t]&&(n[t]=r[t],e.setStaticValue(t,0),s&&(s[t]=0))}function d9(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=xG(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:r,layoutId:i}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Vn,!(r||i))}const{parent:s}=t;s&&!s.hasCheckedOptimisedAppear&&d9(s)}function h9({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=nBe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,vg&&($d.totalNodes=$d.resolvedTargetDeltas=$d.recalculatedProjection=0),this.nodes.forEach(iBe),this.nodes.forEach(uBe),this.nodes.forEach(dBe),this.nodes.forEach(oBe),vg&&window.MotionDebug.record($d)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new W5e)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new CP),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=V5e(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),t){let h;const f=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=U5e(f,250),Mv.hasAnimatedSinceResize&&(Mv.hasAnimatedSinceResize=!1,this.nodes.forEach(HM))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:f,hasRelativeTargetChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const g=this.options.transition||d.getDefaultTransition()||gBe,{onLayoutAnimationStart:x,onLayoutAnimationComplete:y}=d.getProps(),v=!this.targetLayout||!u9(this.targetLayout,m)||p,S=!f&&p;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||S||f&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,S);const C={...xP(g,"layout"),onPlay:x,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(C.delay=0,C.type=!1),this.startAnimation(C)}else f||HM(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ya(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(hBe),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&d9(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(UM);return}this.isUpdating||this.nodes.forEach(lBe),this.isUpdating=!1,this.nodes.forEach(cBe),this.nodes.forEach(sBe),this.nodes.forEach(rBe),this.clearAllSnapshots();const a=Pl.now();br.delta=Ml(0,1e3/60,a-br.timestamp),br.timestamp=a,br.isProcessing=!0,RS.update.process(br),RS.preRender.process(br),RS.render.process(br),br.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,aP.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(aBe),this.sharedNodes.forEach(fBe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Vn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Vn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Zs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!c9(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,d=c!==this.prevTransformTemplateValue;o&&(a||Ed(this.latestValues)||d)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),xBe(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return Zs();const l=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(yBe))){const{scroll:d}=this.root;d&&(Uf(l.x,d.offset.x),Uf(l.y,d.offset.y))}return l}removeElementScroll(o){var a;const l=Zs();if(Ho(l,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:h,options:f}=d;d!==this.root&&h&&f.layoutScroll&&(h.wasRoot&&Ho(l,o),Uf(l.x,h.offset.x),Uf(l.y,h.offset.y))}return l}applyTransform(o,a=!1){const l=Zs();Ho(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Hf(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),Ed(d.latestValues)&&Hf(l,d.latestValues)}return Ed(this.latestValues)&&Hf(l,this.latestValues),l}removeTransform(o){const a=Zs();Ho(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Ed(c.latestValues))continue;XN(c.latestValues)&&c.updateSnapshot();const d=Zs(),h=c.measurePageBox();Ho(d,h),FM(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,d)}return Ed(this.latestValues)&&FM(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==br.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:f}=this.options;if(!(!this.layout||!(h||f))){if(this.resolvedRelativeTargetAt=br.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zs(),this.relativeTargetOrigin=Zs(),qg(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),Ho(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Zs(),this.targetWithTransforms=Zs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),w5e(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ho(this.target,this.layout.layoutBox),s9(this.target,this.targetDelta)):Ho(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zs(),this.relativeTargetOrigin=Zs(),qg(this.relativeTargetOrigin,this.target,p.target),Ho(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}vg&&$d.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||XN(this.parent.latestValues)||n9(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===br.timestamp&&(c=!1),c)return;const{layout:d,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||h))return;Ho(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,p=this.treeScale.y;I5e(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Zs());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(jM(this.prevProjectionDelta.x,this.projectionDelta.x),jM(this.prevProjectionDelta.y,this.projectionDelta.y)),Kg(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==p||!zM(this.projectionDelta.x,this.prevProjectionDelta.x)||!zM(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),vg&&$d.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Wf(),this.projectionDelta=Wf(),this.projectionDeltaWithTransform=Wf()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},d={...this.latestValues},h=Wf();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const f=Zs(),p=l?l.source:void 0,m=this.layout?this.layout.source:void 0,g=p!==m,x=this.getStack(),y=!x||x.members.length<=1,v=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(mBe));this.animationProgress=0;let S;this.mixTargetDelta=C=>{const k=C/1e3;GM(h.x,o.x,k),GM(h.y,o.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(qg(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),pBe(this.relativeTarget,this.relativeTargetOrigin,f,k),S&&Z5e(this.relativeTarget,S)&&(this.isProjectionDirty=!1),S||(S=Zs()),Ho(S,this.relativeTarget)),g&&(this.animationValues=d,G5e(d,c,this.latestValues,k,v,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ya(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Vn.update(()=>{Mv.hasAnimatedSinceResize=!0,this.currentAnimation=B5e(0,WM,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(WM),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:d}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&f9(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||Zs();const h=$o(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+h;const f=$o(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+f}Ho(a,l),Hf(a,d),Kg(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new J5e),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&VS("z",o,c,this.animationValues);for(let d=0;d<BS.length;d++)VS(`rotate${BS[d]}`,o,c,this.animationValues),VS(`skew${BS[d]}`,o,c,this.animationValues);o.render();for(const d in c)o.setStaticValue(d,c[d]),this.animationValues&&(this.animationValues[d]=c[d]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return tBe;const c={visibility:""},d=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=Ov(o==null?void 0:o.pointerEvents)||"",c.transform=d?d(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const g={};return this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=Ov(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Ed(this.latestValues)&&(g.transform=d?d({},""):"none",this.hasProjected=!1),g}const f=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=eBe(this.projectionDeltaWithTransform,this.treeScale,f),d&&(c.transform=d(f,c.transform));const{x:p,y:m}=this.projectionDelta;c.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(a=f.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:c.opacity=h===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const g in ow){if(f[g]===void 0)continue;const{correct:x,applyTo:y}=ow[g],v=c.transform==="none"?f[g]:x(f[g],h);if(y){const S=y.length;for(let C=0;C<S;C++)c[y[C]]=v}else c[g]=v}return this.options.layoutId&&(c.pointerEvents=h===this?Ov(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(UM),this.root.sharedNodes.clear()}}}function sBe(t){t.updateLayout()}function rBe(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=t.layout,{animationType:i}=t.options,o=n.source!==t.layout.source;i==="size"?Go(h=>{const f=o?n.measuredBox[h]:n.layoutBox[h],p=$o(f);f.min=s[h].min,f.max=f.min+p}):f9(i,n.layoutBox,s)&&Go(h=>{const f=o?n.measuredBox[h]:n.layoutBox[h],p=$o(s[h]);f.max=f.min+p,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[h].max=t.relativeTarget[h].min+p)});const a=Wf();Kg(a,s,n.layoutBox);const l=Wf();o?Kg(l,t.applyTransform(r,!0),n.measuredBox):Kg(l,s,n.layoutBox);const c=!c9(a);let d=!1;if(!t.resumeFrom){const h=t.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:p}=h;if(f&&p){const m=Zs();qg(m,n.layoutBox,f.layoutBox);const g=Zs();qg(g,s,p.layoutBox),u9(m,g)||(d=!0),h.options.layoutRoot&&(t.relativeTarget=g,t.relativeTargetOrigin=m,t.relativeParent=h)}}}t.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:d})}else if(t.isLead()){const{onExitComplete:s}=t.options;s&&s()}t.options.transition=void 0}function iBe(t){vg&&$d.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function oBe(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function aBe(t){t.clearSnapshot()}function UM(t){t.clearMeasurements()}function lBe(t){t.isLayoutDirty=!1}function cBe(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function HM(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function uBe(t){t.resolveTargetDelta()}function dBe(t){t.calcProjection()}function hBe(t){t.resetSkewAndRotation()}function fBe(t){t.removeLeadSnapshot()}function GM(t,e,n){t.translate=Os(e.translate,0,n),t.scale=Os(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function KM(t,e,n,s){t.min=Os(e.min,n.min,s),t.max=Os(e.max,n.max,s)}function pBe(t,e,n,s){KM(t.x,e.x,n.x,s),KM(t.y,e.y,n.y,s)}function mBe(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const gBe={duration:.45,ease:[.4,0,.1,1]},qM=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),XM=qM("applewebkit/")&&!qM("chrome/")?Math.round:bi;function YM(t){t.min=XM(t.min),t.max=XM(t.max)}function xBe(t){YM(t.x),YM(t.y)}function f9(t,e,n){return t==="position"||t==="preserve-aspect"&&!b5e(VM(e),VM(n),.2)}function yBe(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const vBe=h9({attachResizeListener:(t,e)=>W0(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zS={current:void 0},p9=h9({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!zS.current){const t=new vBe({});t.mount(window),t.setOptions({layoutScroll:!0}),zS.current=t}return zS.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),bBe={pan:{Feature:O5e},drag:{Feature:D5e,ProjectionNode:p9,MeasureLayout:o9}};function QM(t,e,n){const{props:s}=t;t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",n==="Start");const r="onHover"+n,i=s[r];i&&Vn.postRender(()=>i(e,Hx(e)))}class wBe extends ud{mount(){const{current:e}=this.node;e&&(this.unmount=N4e(e,n=>(QM(this.node,n,"Start"),s=>QM(this.node,s,"End"))))}unmount(){}}class SBe extends ud{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ux(W0(this.node.current,"focus",()=>this.onFocus()),W0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function ZM(t,e,n){const{props:s}=t;t.animationState&&s.whileTap&&t.animationState.setActive("whileTap",n==="Start");const r="onTap"+(n==="End"?"":n),i=s[r];i&&Vn.postRender(()=>i(e,Hx(e)))}class CBe extends ud{mount(){const{current:e}=this.node;e&&(this.unmount=$4e(e,n=>(ZM(this.node,n,"Start"),(s,{success:r})=>ZM(this.node,s,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const QN=new WeakMap,WS=new WeakMap,kBe=t=>{const e=QN.get(t.target);e&&e(t)},NBe=t=>{t.forEach(kBe)};function TBe({root:t,...e}){const n=t||document;WS.has(n)||WS.set(n,{});const s=WS.get(n),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(NBe,{root:t,...e})),s[r]}function _Be(t,e,n){const s=TBe(e);return QN.set(t,n),s.observe(t),()=>{QN.delete(t),s.unobserve(t)}}const EBe={some:0,all:1};class $Be extends ud{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:EBe[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),f=c?d:h;f&&f(l)};return _Be(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(IBe(e,n))&&this.startObserver()}unmount(){}}function IBe({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const RBe={inView:{Feature:$Be},tap:{Feature:CBe},focus:{Feature:SBe},hover:{Feature:wBe}},PBe={layout:{ProjectionNode:p9,MeasureLayout:o9}},ZN={current:null},m9={current:!1};function ABe(){if(m9.current=!0,!!nP)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>ZN.current=t.matches;t.addListener(e),e()}else ZN.current=!1}const jBe=[...MG,Gr,Xu],DBe=t=>jBe.find(FG(t)),JM=new WeakMap;function OBe(t,e,n){for(const s in e){const r=e[s],i=n[s];if(Zr(r))t.addValue(s,r);else if(Zr(i))t.addValue(s,wl(r,{owner:t}));else if(i!==r)if(t.hasValue(s)){const o=t.getValue(s);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=t.getStaticValue(s);t.addValue(s,wl(o!==void 0?o:r,{owner:t}))}}for(const s in n)e[s]===void 0&&t.removeValue(s);return e}const e4=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class FBe{scrapeMotionValuesFromProps(e,n,s){return{}}constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=RP,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=Pl.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Vn.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:d}=o;this.onUpdate=d,this.latestValues=l,this.baseTarget={...l},this.initialValues=n.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=z1(n),this.isVariantNode=HH(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:h,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in f){const m=f[p];l[p]!==void 0&&Zr(m)&&m.set(l[p],!1)}}mount(e){this.current=e,JM.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),m9.current||ABe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ZN.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){JM.delete(this.current),this.projection&&this.projection.unmount(),Ya(this.notifyUpdate),Ya(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=tf.has(e),r=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Vn.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{r(),i(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in qp){const n=qp[e];if(!n)continue;const{isEnabled:s,Feature:r}=n;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Zs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<e4.length;s++){const r=e4[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,o=e[i];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=OBe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const s=this.values.get(e);n!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=wl(n===null?void 0:n,{owner:this}),this.addValue(e,s)),s}readValue(e,n){var s;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(s=this.getBaseTargetFromProps(this.props,e))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(DG(r)||TG(r))?r=parseFloat(r):!DBe(r)&&Xu.test(n)&&(r=PG(e,n)),this.setBaseTarget(e,Zr(r)?r.get():r)),Zr(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:s}=this.props;let r;if(typeof s=="string"||typeof s=="object"){const o=cP(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);o&&(r=o[e])}if(s&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Zr(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new CP),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class g9 extends FBe{constructor(){super(...arguments),this.KeyframeResolver=LG}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Zr(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function MBe(t){return window.getComputedStyle(t)}class LBe extends g9{constructor(){super(...arguments),this.type="html",this.renderInstance=eG}readValueFromInstance(e,n){if(tf.has(n)){const s=IP(n);return s&&s.default||0}else{const s=MBe(e),r=(QH(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return r9(e,n)}build(e,n,s){hP(e,n,s.transformTemplate)}scrapeMotionValuesFromProps(e,n,s){return gP(e,n,s)}}class BBe extends g9{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Zs}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(tf.has(n)){const s=IP(n);return s&&s.default||0}return n=tG.has(n)?n:oP(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,s){return rG(e,n,s)}build(e,n,s){fP(e,n,this.isSVGTag,s.transformTemplate)}renderInstance(e,n,s,r){nG(e,n,s,r)}mount(e){this.isSVGTag=mP(e.tagName),super.mount(e)}}const VBe=(t,e)=>lP(t)?new BBe(e):new LBe(e,{allowProjection:t!==b.Fragment}),zBe=b4e({...d5e,...RBe,...bBe,...PBe},VBe),X=DMe(zBe);function x9(t,e){let n;const s=()=>{const{currentTime:r}=e,o=(r===null?0:r.value)/100;n!==o&&t(o),n=o};return Vn.update(s,!0),()=>Ya(s)}const Lv=new WeakMap;let Qc;function WBe(t,e){if(e){const{inlineSize:n,blockSize:s}=e[0];return{width:n,height:s}}else return t instanceof SVGElement&&"getBBox"in t?t.getBBox():{width:t.offsetWidth,height:t.offsetHeight}}function UBe({target:t,contentRect:e,borderBoxSize:n}){var s;(s=Lv.get(t))===null||s===void 0||s.forEach(r=>{r({target:t,contentSize:e,get size(){return WBe(t,n)}})})}function HBe(t){t.forEach(UBe)}function GBe(){typeof ResizeObserver>"u"||(Qc=new ResizeObserver(HBe))}function KBe(t,e){Qc||GBe();const n=fG(t);return n.forEach(s=>{let r=Lv.get(s);r||(r=new Set,Lv.set(s,r)),r.add(e),Qc==null||Qc.observe(s)}),()=>{n.forEach(s=>{const r=Lv.get(s);r==null||r.delete(e),r!=null&&r.size||Qc==null||Qc.unobserve(s)})}}const Bv=new Set;let Xg;function qBe(){Xg=()=>{const t={width:window.innerWidth,height:window.innerHeight},e={target:window,size:t,contentSize:t};Bv.forEach(n=>n(e))},window.addEventListener("resize",Xg)}function XBe(t){return Bv.add(t),Xg||qBe(),()=>{Bv.delete(t),!Bv.size&&Xg&&(Xg=void 0)}}function YBe(t,e){return typeof t=="function"?XBe(t):KBe(t,e)}const QBe=50,t4=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),ZBe=()=>({time:0,x:t4(),y:t4()}),JBe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function n4(t,e,n,s){const r=n[e],{length:i,position:o}=JBe[e],a=r.current,l=n.time;r.current=t[`scroll${o}`],r.scrollLength=t[`scroll${i}`]-t[`client${i}`],r.offset.length=0,r.offset[0]=0,r.offset[1]=r.scrollLength,r.progress=$h(0,r.scrollLength,r.current);const c=s-l;r.velocity=c>QBe?0:kP(r.current-a,c)}function eVe(t,e,n){n4(t,"x",e,n),n4(t,"y",e,n),e.time=n}function tVe(t,e){const n={x:0,y:0};let s=t;for(;s&&s!==e;)if(s instanceof HTMLElement)n.x+=s.offsetLeft,n.y+=s.offsetTop,s=s.offsetParent;else if(s.tagName==="svg"){const r=s.getBoundingClientRect();s=s.parentElement;const i=s.getBoundingClientRect();n.x+=r.left-i.left,n.y+=r.top-i.top}else if(s instanceof SVGGraphicsElement){const{x:r,y:i}=s.getBBox();n.x+=r,n.y+=i;let o=null,a=s.parentNode;for(;!o;)a.tagName==="svg"&&(o=a),a=s.parentNode;s=o}else break;return n}const JN={start:0,center:.5,end:1};function s4(t,e,n=0){let s=0;if(t in JN&&(t=JN[t]),typeof t=="string"){const r=parseFloat(t);t.endsWith("px")?s=r:t.endsWith("%")?t=r/100:t.endsWith("vw")?s=r/100*document.documentElement.clientWidth:t.endsWith("vh")?s=r/100*document.documentElement.clientHeight:t=r}return typeof t=="number"&&(s=e*t),n+s}const nVe=[0,0];function sVe(t,e,n,s){let r=Array.isArray(t)?t:nVe,i=0,o=0;return typeof t=="number"?r=[t,t]:typeof t=="string"&&(t=t.trim(),t.includes(" ")?r=t.split(" "):r=[t,JN[t]?t:"0"]),i=s4(r[0],n,s),o=s4(r[1],e),i-o}const rVe={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},iVe={x:0,y:0};function oVe(t){return"getBBox"in t&&t.tagName!=="svg"?t.getBBox():{width:t.clientWidth,height:t.clientHeight}}function aVe(t,e,n){const{offset:s=rVe.All}=n,{target:r=t,axis:i="y"}=n,o=i==="y"?"height":"width",a=r!==t?tVe(r,t):iVe,l=r===t?{width:t.scrollWidth,height:t.scrollHeight}:oVe(r),c={width:t.clientWidth,height:t.clientHeight};e[i].offset.length=0;let d=!e[i].interpolate;const h=s.length;for(let f=0;f<h;f++){const p=sVe(s[f],c[o],l[o],a[i]);!d&&p!==e[i].interpolatorOffsets[f]&&(d=!0),e[i].offset[f]=p}d&&(e[i].interpolate=AP(e[i].offset,GG(s),{clamp:!1}),e[i].interpolatorOffsets=[...e[i].offset]),e[i].progress=Ml(0,1,e[i].interpolate(e[i].current))}function lVe(t,e=t,n){if(n.x.targetOffset=0,n.y.targetOffset=0,e!==t){let s=e;for(;s&&s!==t;)n.x.targetOffset+=s.offsetLeft,n.y.targetOffset+=s.offsetTop,s=s.offsetParent}n.x.targetLength=e===t?e.scrollWidth:e.clientWidth,n.y.targetLength=e===t?e.scrollHeight:e.clientHeight,n.x.containerLength=t.clientWidth,n.y.containerLength=t.clientHeight}function cVe(t,e,n,s={}){return{measure:()=>lVe(t,s.target,n),update:r=>{eVe(t,n,r),(s.offset||s.target)&&aVe(t,n,s)},notify:()=>e(n)}}const Qm=new WeakMap,r4=new WeakMap,US=new WeakMap,i4=t=>t===document.documentElement?window:t;function OP(t,{container:e=document.documentElement,...n}={}){let s=US.get(e);s||(s=new Set,US.set(e,s));const r=ZBe(),i=cVe(e,t,r,n);if(s.add(i),!Qm.has(e)){const a=()=>{for(const f of s)f.measure()},l=()=>{for(const f of s)f.update(br.timestamp)},c=()=>{for(const f of s)f.notify()},d=()=>{Vn.read(a,!1,!0),Vn.read(l,!1,!0),Vn.update(c,!1,!0)};Qm.set(e,d);const h=i4(e);window.addEventListener("resize",d,{passive:!0}),e!==document.documentElement&&r4.set(e,YBe(e,d)),h.addEventListener("scroll",d,{passive:!0})}const o=Qm.get(e);return Vn.read(o,!1,!0),()=>{var a;Ya(o);const l=US.get(e);if(!l||(l.delete(i),l.size))return;const c=Qm.get(e);Qm.delete(e),c&&(i4(e).removeEventListener("scroll",c),(a=r4.get(e))===null||a===void 0||a(),window.removeEventListener("resize",c))}}function uVe({source:t,container:e,axis:n="y"}){t&&(e=t);const s={value:0},r=OP(i=>{s.value=i[n].progress*100},{container:e,axis:n});return{currentTime:s,cancel:r}}const HS=new Map;function y9({source:t,container:e=document.documentElement,axis:n="y"}={}){t&&(e=t),HS.has(e)||HS.set(e,{});const s=HS.get(e);return s[n]||(s[n]=aG()?new ScrollTimeline({source:e,axis:n}):uVe({source:e,axis:n})),s[n]}function dVe(t){return t.length===2}function v9(t){return t&&(t.target||t.offset)}function hVe(t,e){return dVe(t)||v9(e)?OP(n=>{t(n[e.axis].progress,n)},e):x9(t,y9(e))}function fVe(t,e){if(t.flatten(),v9(e))return t.pause(),OP(n=>{t.time=t.duration*n[e.axis].progress},e);{const n=y9(e);return t.attachTimeline?t.attachTimeline(n,s=>(s.pause(),x9(r=>{s.time=s.duration*r},n))):bi}}function pVe(t,{axis:e="y",...n}={}){const s={axis:e,...n};return typeof t=="function"?hVe(t,s):fVe(t,s)}function o4(t,e){_Me(!!(!e||e.current))}const mVe=()=>({scrollX:wl(0),scrollY:wl(0),scrollXProgress:wl(0),scrollYProgress:wl(0)});function FP({container:t,target:e,layoutEffect:n=!0,...s}={}){const r=ef(mVe);return(n?Vx:b.useEffect)(()=>(o4("target",e),o4("container",t),pVe((o,{x:a,y:l})=>{r.scrollX.set(a.current),r.scrollXProgress.set(a.progress),r.scrollY.set(l.current),r.scrollYProgress.set(l.progress)},{...s,container:(t==null?void 0:t.current)||void 0,target:(e==null?void 0:e.current)||void 0})),[t,e,JSON.stringify(s.offset)]),r}function eT(t){const e=ef(()=>wl(t)),{isStatic:n}=b.useContext(L1);if(n){const[,s]=b.useState(t);b.useEffect(()=>e.on("change",s),[])}return e}function b9(t,e){const n=eT(e()),s=()=>n.set(e());return s(),Vx(()=>{const r=()=>Vn.preRender(s,!1,!0),i=t.map(o=>o.on("change",r));return()=>{i.forEach(o=>o()),Ya(s)}}),n}const gVe=t=>t&&typeof t=="object"&&t.mix,xVe=t=>gVe(t)?t.mix:void 0;function yVe(...t){const e=!Array.isArray(t[0]),n=e?0:-1,s=t[0+n],r=t[1+n],i=t[2+n],o=t[3+n],a=AP(r,i,{mixer:xVe(i[0]),...o});return e?a(s):a}function vVe(t){Ug.current=[],t();const e=b9(Ug.current,t);return Ug.current=void 0,e}function ja(t,e,n,s){if(typeof t=="function")return vVe(t);const r=typeof e=="function"?e:yVe(e,n,s);return Array.isArray(t)?a4(t,r):a4([t],([i])=>r(i))}function a4(t,e){const n=ef(()=>[]);return b9(t,()=>{n.length=0;const s=t.length;for(let r=0;r<s;r++)n[r]=t[r].get();return e(n)})}function bVe(t){t.values.forEach(e=>e.stop())}function tT(t,e){[...e].reverse().forEach(s=>{const r=t.getVariant(s);r&&NP(t,r),t.variantChildren&&t.variantChildren.forEach(i=>{tT(i,e)})})}function wVe(t,e){if(Array.isArray(e))return tT(t,e);if(typeof e=="string")return tT(t,[e]);NP(t,e)}function SVe(){const t=new Set,e={subscribe(n){return t.add(n),()=>void t.delete(n)},start(n,s){const r=[];return t.forEach(i=>{r.push(XG(i,n,{transitionOverride:s}))}),Promise.all(r)},set(n){return t.forEach(s=>{wVe(s,n)})},stop(){t.forEach(n=>{bVe(n)})},mount(){return()=>{e.stop()}}};return e}function CVe(){const t=ef(SVe);return Vx(t.mount,[]),t}const kVe=CVe;function NVe({progress:t,message:e}){const[n,s]=b.useState(""),r="CoachT";return b.useEffect(()=>{if(t>30){const i=setTimeout(()=>{n.length<r.length&&s(r.slice(0,n.length+1))},150);return()=>clearTimeout(i)}},[n,t]),u.jsxs("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50 overflow-hidden",children:[u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-b from-red-600/80 via-red-500/60 to-transparent",initial:{y:"-100%"},animate:{y:"100%"},transition:{duration:2,ease:"easeInOut"}}),u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-b from-transparent via-red-400/40 to-transparent",initial:{y:"-100%"},animate:{y:"100%"},transition:{duration:2.5,ease:"easeInOut",delay:.3}}),u.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center px-6 sm:px-8 max-w-sm w-full",children:[u.jsxs(X.div,{className:"text-4xl sm:text-5xl md:text-6xl font-bold mb-6 text-white flex items-center justify-center min-h-[4rem]",initial:{opacity:0},animate:{opacity:t>30?1:0},transition:{delay:1.5,duration:.5},children:[u.jsx("span",{className:"bg-gradient-to-r from-red-400 via-orange-500 to-red-400 bg-clip-text text-transparent",children:n}),t>30&&u.jsx(X.span,{className:"ml-1 text-red-400 text-3xl sm:text-4xl md:text-5xl",animate:{opacity:[0,1,0]},transition:{duration:1,repeat:1/0},children:"|"})]}),t>60&&u.jsxs(X.div,{className:"text-gray-300 text-sm sm:text-base mb-8 font-medium flex items-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:2.5},children:[u.jsx("span",{children:e||(t<70?"Initializing AI modules":t<85?"Loading pose detection":t<95?"Calibrating algorithms":"Almost ready")}),u.jsx(X.span,{className:"ml-1 text-red-400",animate:{opacity:[0,1,0]},transition:{duration:1,repeat:1/0},children:"..."})]}),t>80&&u.jsxs(X.div,{className:"w-full space-y-3",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:3},children:[u.jsx("div",{className:"relative",children:u.jsx("div",{className:"w-full h-1 bg-gray-800/60 rounded-full overflow-hidden backdrop-blur-sm",children:u.jsx(X.div,{className:"h-full bg-gradient-to-r from-red-500 via-orange-500 to-red-600 rounded-full relative",initial:{width:0},animate:{width:`${t}%`},transition:{duration:.5,ease:"easeOut"},children:u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent w-full",animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})})})}),u.jsxs("div",{className:"flex justify-between items-center text-xs sm:text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Training AI"}),u.jsxs(X.span,{className:"text-red-400 font-bold tabular-nums",initial:{scale:1.1,color:"#f97316"},animate:{scale:1,color:"#ef4444"},transition:{duration:.3},children:[t,"%"]},t)]})]}),t>95&&u.jsx(X.p,{className:"text-xs text-gray-500 mt-6 max-w-xs leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:3.5},children:"Preparing your personal AI sensei"})]})]})}var GS="focusScope.autoFocusOnMount",KS="focusScope.autoFocusOnUnmount",l4={bubbles:!1,cancelable:!0},TVe="FocusScope",H1=b.forwardRef((t,e)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:r,onUnmountAutoFocus:i,...o}=t,[a,l]=b.useState(null),c=ei(r),d=ei(i),h=b.useRef(null),f=Pn(e,g=>l(g)),p=b.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;b.useEffect(()=>{if(s){let g=function(S){if(p.paused||!a)return;const C=S.target;a.contains(C)?h.current=C:Zc(h.current,{select:!0})},x=function(S){if(p.paused||!a)return;const C=S.relatedTarget;C!==null&&(a.contains(C)||Zc(h.current,{select:!0}))},y=function(S){if(document.activeElement===document.body)for(const k of S)k.removedNodes.length>0&&Zc(a)};document.addEventListener("focusin",g),document.addEventListener("focusout",x);const v=new MutationObserver(y);return a&&v.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",x),v.disconnect()}}},[s,a,p.paused]),b.useEffect(()=>{if(a){u4.add(p);const g=document.activeElement;if(!a.contains(g)){const y=new CustomEvent(GS,l4);a.addEventListener(GS,c),a.dispatchEvent(y),y.defaultPrevented||(_Ve(PVe(w9(a)),{select:!0}),document.activeElement===g&&Zc(a))}return()=>{a.removeEventListener(GS,c),setTimeout(()=>{const y=new CustomEvent(KS,l4);a.addEventListener(KS,d),a.dispatchEvent(y),y.defaultPrevented||Zc(g??document.body,{select:!0}),a.removeEventListener(KS,d),u4.remove(p)},0)}}},[a,c,d,p]);const m=b.useCallback(g=>{if(!n&&!s||p.paused)return;const x=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,y=document.activeElement;if(x&&y){const v=g.currentTarget,[S,C]=EVe(v);S&&C?!g.shiftKey&&y===C?(g.preventDefault(),n&&Zc(S,{select:!0})):g.shiftKey&&y===S&&(g.preventDefault(),n&&Zc(C,{select:!0})):y===v&&g.preventDefault()}},[n,s,p.paused]);return u.jsx(Mt.div,{tabIndex:-1,...o,ref:f,onKeyDown:m})});H1.displayName=TVe;function _Ve(t,{select:e=!1}={}){const n=document.activeElement;for(const s of t)if(Zc(s,{select:e}),document.activeElement!==n)return}function EVe(t){const e=w9(t),n=c4(e,t),s=c4(e.reverse(),t);return[n,s]}function w9(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function c4(t,e){for(const n of t)if(!$Ve(n,{upTo:e}))return n}function $Ve(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function IVe(t){return t instanceof HTMLInputElement&&"select"in t}function Zc(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&IVe(t)&&e&&t.select()}}var u4=RVe();function RVe(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=d4(t,e),t.unshift(e)},remove(e){var n;t=d4(t,e),(n=t[0])==null||n.resume()}}}function d4(t,e){const n=[...t],s=n.indexOf(e);return s!==-1&&n.splice(s,1),n}function PVe(t){return t.filter(e=>e.tagName!=="A")}var qS=0;function MP(){b.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??h4()),document.body.insertAdjacentElement("beforeend",t[1]??h4()),qS++,()=>{qS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),qS--}},[])}function h4(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var xl=function(){return xl=Object.assign||function(e){for(var n,s=1,r=arguments.length;s<r;s++){n=arguments[s];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},xl.apply(this,arguments)};function S9(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n}function AVe(t,e,n){if(n||arguments.length===2)for(var s=0,r=e.length,i;s<r;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))}var Vv="right-scroll-bar-position",zv="width-before-scroll-bar",jVe="with-scroll-bars-hidden",DVe="--removed-body-scroll-bar-size";function XS(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function OVe(t,e){var n=b.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(s){var r=n.value;r!==s&&(n.value=s,n.callback(s,r))}}}})[0];return n.callback=e,n.facade}var FVe=typeof window<"u"?b.useLayoutEffect:b.useEffect,f4=new WeakMap;function MVe(t,e){var n=OVe(null,function(s){return t.forEach(function(r){return XS(r,s)})});return FVe(function(){var s=f4.get(n);if(s){var r=new Set(s),i=new Set(t),o=n.current;r.forEach(function(a){i.has(a)||XS(a,null)}),i.forEach(function(a){r.has(a)||XS(a,o)})}f4.set(n,t)},[t]),n}function LVe(t){return t}function BVe(t,e){e===void 0&&(e=LVe);var n=[],s=!1,r={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(i){var o=e(i,s);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(s=!0;n.length;){var o=n;n=[],o.forEach(i)}n={push:function(a){return i(a)},filter:function(){return n}}},assignMedium:function(i){s=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(i),o=n}var l=function(){var d=o;o=[],d.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(d){o.push(d),c()},filter:function(d){return o=o.filter(d),n}}}};return r}function VVe(t){t===void 0&&(t={});var e=BVe(null);return e.options=xl({async:!0,ssr:!1},t),e}var C9=function(t){var e=t.sideCar,n=S9(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return b.createElement(s,xl({},n))};C9.isSideCarExport=!0;function zVe(t,e){return t.useMedium(e),C9}var k9=VVe(),YS=function(){},G1=b.forwardRef(function(t,e){var n=b.useRef(null),s=b.useState({onScrollCapture:YS,onWheelCapture:YS,onTouchMoveCapture:YS}),r=s[0],i=s[1],o=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,d=t.enabled,h=t.shards,f=t.sideCar,p=t.noIsolation,m=t.inert,g=t.allowPinchZoom,x=t.as,y=x===void 0?"div":x,v=t.gapMode,S=S9(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=f,k=MVe([n,e]),T=xl(xl({},S),r);return b.createElement(b.Fragment,null,d&&b.createElement(C,{sideCar:k9,removeScrollBar:c,shards:h,noIsolation:p,inert:m,setCallbacks:i,allowPinchZoom:!!g,lockRef:n,gapMode:v}),o?b.cloneElement(b.Children.only(a),xl(xl({},T),{ref:k})):b.createElement(y,xl({},T,{className:l,ref:k}),a))});G1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};G1.classNames={fullWidth:zv,zeroRight:Vv};var WVe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function UVe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=WVe();return e&&t.setAttribute("nonce",e),t}function HVe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function GVe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var KVe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=UVe())&&(HVe(e,n),GVe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},qVe=function(){var t=KVe();return function(e,n){b.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},N9=function(){var t=qVe(),e=function(n){var s=n.styles,r=n.dynamic;return t(s,r),null};return e},XVe={left:0,top:0,right:0,gap:0},QS=function(t){return parseInt(t||"",10)||0},YVe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],s=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[QS(n),QS(s),QS(r)]},QVe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return XVe;var e=YVe(t),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-n+e[2]-e[0])}},ZVe=N9(),ap="data-scroll-locked",JVe=function(t,e,n,s){var r=t.left,i=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(jVe,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(a,"px ").concat(s,`;
  }
  body[`).concat(ap,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Vv,` {
    right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(zv,` {
    margin-right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(Vv," .").concat(Vv,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(zv," .").concat(zv,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(ap,`] {
    `).concat(DVe,": ").concat(a,`px;
  }
`)},p4=function(){var t=parseInt(document.body.getAttribute(ap)||"0",10);return isFinite(t)?t:0},eze=function(){b.useEffect(function(){return document.body.setAttribute(ap,(p4()+1).toString()),function(){var t=p4()-1;t<=0?document.body.removeAttribute(ap):document.body.setAttribute(ap,t.toString())}},[])},tze=function(t){var e=t.noRelative,n=t.noImportant,s=t.gapMode,r=s===void 0?"margin":s;eze();var i=b.useMemo(function(){return QVe(r)},[r]);return b.createElement(ZVe,{styles:JVe(i,!e,r,n?"":"!important")})},nT=!1;if(typeof window<"u")try{var tv=Object.defineProperty({},"passive",{get:function(){return nT=!0,!0}});window.addEventListener("test",tv,tv),window.removeEventListener("test",tv,tv)}catch{nT=!1}var gf=nT?{passive:!1}:!1,nze=function(t){return t.tagName==="TEXTAREA"},T9=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!nze(t)&&n[e]==="visible")},sze=function(t){return T9(t,"overflowY")},rze=function(t){return T9(t,"overflowX")},m4=function(t,e){var n=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var r=_9(t,s);if(r){var i=E9(t,s),o=i[1],a=i[2];if(o>a)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},ize=function(t){var e=t.scrollTop,n=t.scrollHeight,s=t.clientHeight;return[e,n,s]},oze=function(t){var e=t.scrollLeft,n=t.scrollWidth,s=t.clientWidth;return[e,n,s]},_9=function(t,e){return t==="v"?sze(e):rze(e)},E9=function(t,e){return t==="v"?ize(e):oze(e)},aze=function(t,e){return t==="h"&&e==="rtl"?-1:1},lze=function(t,e,n,s,r){var i=aze(t,window.getComputedStyle(e).direction),o=i*s,a=n.target,l=e.contains(a),c=!1,d=o>0,h=0,f=0;do{var p=E9(t,a),m=p[0],g=p[1],x=p[2],y=g-x-i*m;(m||y)&&_9(t,a)&&(h+=y,f+=m),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(d&&(Math.abs(h)<1||!r)||!d&&(Math.abs(f)<1||!r))&&(c=!0),c},nv=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},g4=function(t){return[t.deltaX,t.deltaY]},x4=function(t){return t&&"current"in t?t.current:t},cze=function(t,e){return t[0]===e[0]&&t[1]===e[1]},uze=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},dze=0,xf=[];function hze(t){var e=b.useRef([]),n=b.useRef([0,0]),s=b.useRef(),r=b.useState(dze++)[0],i=b.useState(N9)[0],o=b.useRef(t);b.useEffect(function(){o.current=t},[t]),b.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var g=AVe([t.lockRef.current],(t.shards||[]).map(x4),!0).filter(Boolean);return g.forEach(function(x){return x.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),g.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var a=b.useCallback(function(g,x){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var y=nv(g),v=n.current,S="deltaX"in g?g.deltaX:v[0]-y[0],C="deltaY"in g?g.deltaY:v[1]-y[1],k,T=g.target,_=Math.abs(S)>Math.abs(C)?"h":"v";if("touches"in g&&_==="h"&&T.type==="range")return!1;var $=m4(_,T);if(!$)return!0;if($?k=_:(k=_==="v"?"h":"v",$=m4(_,T)),!$)return!1;if(!s.current&&"changedTouches"in g&&(S||C)&&(s.current=k),!k)return!0;var R=s.current||k;return lze(R,x,g,R==="h"?S:C,!0)},[]),l=b.useCallback(function(g){var x=g;if(!(!xf.length||xf[xf.length-1]!==i)){var y="deltaY"in x?g4(x):nv(x),v=e.current.filter(function(k){return k.name===x.type&&(k.target===x.target||x.target===k.shadowParent)&&cze(k.delta,y)})[0];if(v&&v.should){x.cancelable&&x.preventDefault();return}if(!v){var S=(o.current.shards||[]).map(x4).filter(Boolean).filter(function(k){return k.contains(x.target)}),C=S.length>0?a(x,S[0]):!o.current.noIsolation;C&&x.cancelable&&x.preventDefault()}}},[]),c=b.useCallback(function(g,x,y,v){var S={name:g,delta:x,target:y,should:v,shadowParent:fze(y)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(C){return C!==S})},1)},[]),d=b.useCallback(function(g){n.current=nv(g),s.current=void 0},[]),h=b.useCallback(function(g){c(g.type,g4(g),g.target,a(g,t.lockRef.current))},[]),f=b.useCallback(function(g){c(g.type,nv(g),g.target,a(g,t.lockRef.current))},[]);b.useEffect(function(){return xf.push(i),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:f}),document.addEventListener("wheel",l,gf),document.addEventListener("touchmove",l,gf),document.addEventListener("touchstart",d,gf),function(){xf=xf.filter(function(g){return g!==i}),document.removeEventListener("wheel",l,gf),document.removeEventListener("touchmove",l,gf),document.removeEventListener("touchstart",d,gf)}},[]);var p=t.removeScrollBar,m=t.inert;return b.createElement(b.Fragment,null,m?b.createElement(i,{styles:uze(r)}):null,p?b.createElement(tze,{gapMode:t.gapMode}):null)}function fze(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const pze=zVe(k9,hze);var K1=b.forwardRef(function(t,e){return b.createElement(G1,xl({},t,{ref:e,sideCar:pze}))});K1.classNames=G1.classNames;var mze=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},yf=new WeakMap,sv=new WeakMap,rv={},ZS=0,$9=function(t){return t&&(t.host||$9(t.parentNode))},gze=function(t,e){return e.map(function(n){if(t.contains(n))return n;var s=$9(n);return s&&t.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},xze=function(t,e,n,s){var r=gze(e,Array.isArray(t)?t:[t]);rv[n]||(rv[n]=new WeakMap);var i=rv[n],o=[],a=new Set,l=new Set(r),c=function(h){!h||a.has(h)||(a.add(h),c(h.parentNode))};r.forEach(c);var d=function(h){!h||l.has(h)||Array.prototype.forEach.call(h.children,function(f){if(a.has(f))d(f);else try{var p=f.getAttribute(s),m=p!==null&&p!=="false",g=(yf.get(f)||0)+1,x=(i.get(f)||0)+1;yf.set(f,g),i.set(f,x),o.push(f),g===1&&m&&sv.set(f,!0),x===1&&f.setAttribute(n,"true"),m||f.setAttribute(s,"true")}catch(y){console.error("aria-hidden: cannot operate on ",f,y)}})};return d(e),a.clear(),ZS++,function(){o.forEach(function(h){var f=yf.get(h)-1,p=i.get(h)-1;yf.set(h,f),i.set(h,p),f||(sv.has(h)||h.removeAttribute(s),sv.delete(h)),p||h.removeAttribute(n)}),ZS--,ZS||(yf=new WeakMap,yf=new WeakMap,sv=new WeakMap,rv={})}},LP=function(t,e,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(t)?t:[t]),r=mze(t);return r?(s.push.apply(s,Array.from(r.querySelectorAll("[aria-live]"))),xze(s,r,n,"aria-hidden")):function(){return null}},BP="Dialog",[I9,_7e]=Ao(BP),[yze,tl]=I9(BP),R9=t=>{const{__scopeDialog:e,children:n,open:s,defaultOpen:r,onOpenChange:i,modal:o=!0}=t,a=b.useRef(null),l=b.useRef(null),[c=!1,d]=Sc({prop:s,defaultProp:r,onChange:i});return u.jsx(yze,{scope:e,triggerRef:a,contentRef:l,contentId:Tl(),titleId:Tl(),descriptionId:Tl(),open:c,onOpenChange:d,onOpenToggle:b.useCallback(()=>d(h=>!h),[d]),modal:o,children:n})};R9.displayName=BP;var P9="DialogTrigger",A9=b.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=tl(P9,n),i=Pn(e,r.triggerRef);return u.jsx(Mt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":WP(r.open),...s,ref:i,onClick:nt(t.onClick,r.onOpenToggle)})});A9.displayName=P9;var VP="DialogPortal",[vze,j9]=I9(VP,{forceMount:void 0}),D9=t=>{const{__scopeDialog:e,forceMount:n,children:s,container:r}=t,i=tl(VP,e);return u.jsx(vze,{scope:e,forceMount:n,children:b.Children.map(s,o=>u.jsx(jo,{present:n||i.open,children:u.jsx(bx,{asChild:!0,container:r,children:o})}))})};D9.displayName=VP;var hw="DialogOverlay",O9=b.forwardRef((t,e)=>{const n=j9(hw,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,i=tl(hw,t.__scopeDialog);return i.modal?u.jsx(jo,{present:s||i.open,children:u.jsx(wze,{...r,ref:e})}):null});O9.displayName=hw;var bze=mh("DialogOverlay.RemoveScroll"),wze=b.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=tl(hw,n);return u.jsx(K1,{as:bze,allowPinchZoom:!0,shards:[r.contentRef],children:u.jsx(Mt.div,{"data-state":WP(r.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),Ih="DialogContent",F9=b.forwardRef((t,e)=>{const n=j9(Ih,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,i=tl(Ih,t.__scopeDialog);return u.jsx(jo,{present:s||i.open,children:i.modal?u.jsx(Sze,{...r,ref:e}):u.jsx(Cze,{...r,ref:e})})});F9.displayName=Ih;var Sze=b.forwardRef((t,e)=>{const n=tl(Ih,t.__scopeDialog),s=b.useRef(null),r=Pn(e,n.contentRef,s);return b.useEffect(()=>{const i=s.current;if(i)return LP(i)},[]),u.jsx(M9,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:nt(t.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:nt(t.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:nt(t.onFocusOutside,i=>i.preventDefault())})}),Cze=b.forwardRef((t,e)=>{const n=tl(Ih,t.__scopeDialog),s=b.useRef(!1),r=b.useRef(!1);return u.jsx(M9,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,i),i.defaultPrevented||(s.current||(a=n.triggerRef.current)==null||a.focus(),i.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:i=>{var l,c;(l=t.onInteractOutside)==null||l.call(t,i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=i.target;((c=n.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&r.current&&i.preventDefault()}})}),M9=b.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:i,...o}=t,a=tl(Ih,n),l=b.useRef(null),c=Pn(e,l);return MP(),u.jsxs(u.Fragment,{children:[u.jsx(H1,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:i,children:u.jsx(rm,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":WP(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),u.jsxs(u.Fragment,{children:[u.jsx(kze,{titleId:a.titleId}),u.jsx(Tze,{contentRef:l,descriptionId:a.descriptionId})]})]})}),zP="DialogTitle",L9=b.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=tl(zP,n);return u.jsx(Mt.h2,{id:r.titleId,...s,ref:e})});L9.displayName=zP;var B9="DialogDescription",V9=b.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=tl(B9,n);return u.jsx(Mt.p,{id:r.descriptionId,...s,ref:e})});V9.displayName=B9;var z9="DialogClose",W9=b.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,r=tl(z9,n);return u.jsx(Mt.button,{type:"button",...s,ref:e,onClick:nt(t.onClick,()=>r.onOpenChange(!1))})});W9.displayName=z9;function WP(t){return t?"open":"closed"}var U9="DialogTitleWarning",[E7e,H9]=pJ(U9,{contentName:Ih,titleName:zP,docsSlug:"dialog"}),kze=({titleId:t})=>{const e=H9(U9),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return b.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Nze="DialogDescriptionWarning",Tze=({contentRef:t,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${H9(Nze).contentName}}.`;return b.useEffect(()=>{var i;const r=(i=t.current)==null?void 0:i.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(s))},[s,t,e]),null},_ze=R9,Eze=A9,$ze=D9,G9=O9,K9=F9,q9=L9,X9=V9,Y9=W9;const zi=_ze,Ize=Eze,Rze=$ze,Pze=Y9,Q9=b.forwardRef(({className:t,...e},n)=>u.jsx(G9,{ref:n,className:Pt("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));Q9.displayName=G9.displayName;const pi=b.forwardRef(({className:t,children:e,...n},s)=>u.jsxs(Rze,{children:[u.jsx(Q9,{}),u.jsxs(K9,{ref:s,className:Pt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[e,u.jsxs(Y9,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[u.jsx(Lh,{className:"h-4 w-4"}),u.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));pi.displayName=K9.displayName;const mi=({className:t,...e})=>u.jsx("div",{className:Pt("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});mi.displayName="DialogHeader";const xo=({className:t,...e})=>u.jsx("div",{className:Pt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...e});xo.displayName="DialogFooter";const gi=b.forwardRef(({className:t,...e},n)=>u.jsx(q9,{ref:n,className:Pt("text-lg font-semibold leading-none tracking-tight",t),...e}));gi.displayName=q9.displayName;const yo=b.forwardRef(({className:t,...e},n)=>u.jsx(X9,{ref:n,className:Pt("text-sm text-muted-foreground",t),...e}));yo.displayName=X9.displayName;function Aze({isOpen:t=!0,onClose:e,screenshotData:n}){const s=()=>{if(!n)return;const i=document.createElement("a");i.href=n,i.download=`taekwondo-form-${new Date().toISOString().slice(0,10)}.png`,i.click()},r=async()=>{if(!(!n||!navigator.share))try{const i=await fetch(n).then(a=>a.blob()),o=new File([i],"taekwondo-form-analysis.png",{type:"image/png"});await navigator.share({title:"My Taekwondo Form AI Analysis",text:"Check out my martial arts form analysis!",files:[o]})}catch(i){console.error("Error sharing screenshot:",i),alert("Could not share the image. Your browser may not support this feature.")}};return u.jsx(zi,{open:t,onOpenChange:e,children:u.jsxs(pi,{className:"bg-gray-900 border border-red-900/30 text-foreground sm:max-w-3xl shadow-lg",children:[u.jsxs(mi,{className:"border-b border-red-900/30 bg-black",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-red-500 mr-2",children:"photo_camera"}),u.jsx(gi,{className:"font-serif text-red-500",children:"Form Captured"})]}),u.jsx(Pze,{className:"text-gray-400 hover:text-white rounded-full h-8 w-8 flex items-center justify-center hover:bg-gray-800 absolute right-4 top-4"})]}),u.jsxs("div",{className:"p-4",children:[u.jsx("div",{className:"bg-black rounded-lg overflow-hidden mb-6 border border-red-900/30 shadow-md",children:n&&u.jsx("img",{src:n,alt:"Taekwondo form analysis",className:"w-full h-full object-contain"})}),u.jsxs("div",{className:"flex flex-wrap gap-3 justify-between items-center",children:[u.jsx("div",{className:"text-sm text-gray-300 italic",children:"Perfect form analysis with CoachT"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(Se,{variant:"outline",onClick:s,className:"border-red-900 hover:bg-red-950 text-gray-300",children:[u.jsx("span",{className:"material-icons mr-2 text-sm",children:"file_download"}),"Download"]}),u.jsxs(Se,{onClick:r,disabled:!navigator.share,className:"bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700",children:[u.jsx("span",{className:"material-icons mr-2 text-sm",children:"share"}),"Share"]})]})]})]})]})})}const Ks=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));Ks.displayName="Card";const No=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("flex flex-col space-y-1.5 p-6",t),...e}));No.displayName="CardHeader";const To=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("text-2xl font-semibold leading-none tracking-tight",t),...e}));To.displayName="CardTitle";const Ua=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("text-sm text-muted-foreground",t),...e}));Ua.displayName="CardDescription";const rr=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("p-6 pt-0",t),...e}));rr.displayName="CardContent";const Z9=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("flex items-center p-6 pt-0",t),...e}));Z9.displayName="CardFooter";const JS=({expression:t,size:e="large"})=>{const n=()=>({neutral:"/images/shifu_coacht.png",happy:"/images/shifuhappy_ct.png",encouraging:"/images/shifuhappy_ct.png"})[t],s={small:"w-12 h-12",medium:"w-16 h-16",large:"w-20 h-20"},r={neutral:{},happy:{y:[0,-5,0]},encouraging:{rotate:[0,5,-5,0]}};return u.jsx(X.div,{animate:r[t],transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`${s[e]} relative`,children:u.jsx("img",{src:n(),alt:`Shifu ${t}`,className:`${s[e]} object-contain rounded-lg shadow-lg`,style:{imageRendering:"pixelated"}})})};function jze(){const[t,e]=b.useState(!1),[n,s]=b.useState(!1),r=Yw(),{data:i,isLoading:o,error:a}=sm({queryKey:["/api/shifu/daily-goal"],queryFn:()=>aa("GET","/api/shifu/daily-goal").then(p=>p.json()),refetchOnWindowFocus:!1,staleTime:5*60*1e3}),l=za({mutationFn:()=>aa("POST","/api/shifu/start-session",{}),onSuccess:()=>{e(!0),s(!0),r.invalidateQueries({queryKey:["/api/shifu/logs"]}),setTimeout(()=>s(!1),3e3)}}),c=p=>{switch(p){case"taekwondo":return u.jsx(N_,{className:"h-5 w-5"});case"karate":return u.jsx(ea,{className:"h-5 w-5"});case"general":return u.jsx(s1,{className:"h-5 w-5"});default:return u.jsx(ea,{className:"h-5 w-5"})}},d=p=>{switch(p){case"beginner":return"text-green-400 bg-green-500/20";case"intermediate":return"text-yellow-400 bg-yellow-500/20";case"advanced":return"text-red-400 bg-red-500/20";default:return"text-blue-400 bg-blue-500/20"}},h=()=>{l.mutate()};if(o)return u.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"w-full max-w-lg mx-auto",children:u.jsx(Ks,{className:"bg-gradient-to-br from-red-900/30 to-red-950/20 border-red-600/30 backdrop-blur",children:u.jsxs(rr,{className:"p-6",children:[u.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[u.jsx("div",{className:"w-20 h-20 bg-red-400/20 rounded-full animate-pulse"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"h-4 bg-red-400/20 rounded w-3/4 mb-2 animate-pulse"}),u.jsx("div",{className:"h-6 bg-red-400/20 rounded animate-pulse"})]})]}),u.jsxs("div",{className:"animate-pulse space-y-3",children:[u.jsx("div",{className:"h-8 bg-red-400/20 rounded"}),u.jsx("div",{className:"h-4 bg-red-400/20 rounded w-1/2"})]})]})})});if(a||!i)return null;const{goal:f}=i;return u.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"w-full max-w-lg mx-auto",children:u.jsxs(Ks,{className:"bg-gradient-to-br from-red-900/30 to-red-950/20 border-red-600/30 backdrop-blur hover:border-red-500/50 transition-all duration-300 relative overflow-hidden",children:[u.jsx(rr,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsx(JS,{expression:t?"happy":"neutral",size:"large"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-white font-bold text-lg",children:"Shifu's Daily Goal"}),u.jsxs("p",{className:"text-red-200 text-sm opacity-80",children:["Master ",f.category," today"]})]})]}),u.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${d(f.difficulty)}`,children:f.difficulty})]}),u.jsxs("div",{className:"bg-black/40 rounded-lg p-4 border border-red-600/20",children:[u.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[c(f.category),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"text-white font-semibold text-lg",children:f.dailyGoal}),u.jsxs("p",{className:"text-red-200 text-sm",children:["Aim for ",f.targetAccuracy,"% accuracy"]})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"text-2xl font-bold text-red-400",children:[f.targetAccuracy,"%"]}),u.jsx("div",{className:"text-xs text-gray-400",children:"target"})]})]}),u.jsx("div",{className:"pt-3 border-t border-red-600/20",children:u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx(JS,{expression:"encouraging",size:"small"}),u.jsxs("p",{className:"text-gray-300 text-sm italic flex-1",children:['"',f.reasoning,'"']})]})})]}),u.jsx("div",{className:"flex space-x-3",children:t?u.jsxs("div",{className:"flex-1 bg-green-600/20 border border-green-500/30 text-green-400 font-semibold py-2 px-4 rounded-lg flex items-center justify-center space-x-2",children:[u.jsx(jV,{className:"h-4 w-4"}),u.jsx("span",{children:"Session Started!"})]}):u.jsx(Se,{onClick:h,disabled:l.isPending,className:"flex-1 bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2",children:l.isPending?u.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}):u.jsxs(u.Fragment,{children:[u.jsx(Mf,{className:"h-4 w-4"}),u.jsx("span",{children:"Start Session"})]})})})]})}),n&&u.jsx(X.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},className:"absolute inset-0 bg-green-600/20 backdrop-blur-sm flex items-center justify-center rounded-lg",children:u.jsxs("div",{className:"text-center",children:[u.jsx(JS,{expression:"happy",size:"large"}),u.jsx(X.p,{className:"text-green-300 font-semibold mt-2",animate:{y:[0,-5,0]},transition:{duration:.6,repeat:3},children:"Great! Let's train! 🥋"})]})})]})})}function iu({expression:t,message:e,position:n="top-right",pointingDirection:s="left",autoShow:r=!0,showDelay:i=1e3,onDismiss:o,dismissible:a=!0,size:l="medium",className:c=""}){const[d,h]=b.useState(!r),[f,p]=b.useState(!1);b.useEffect(()=>{if(r){const k=setTimeout(()=>{h(!0),setTimeout(()=>p(!0),500)},i);return()=>clearTimeout(k)}},[r,i]);const m=()=>{p(!1),setTimeout(()=>{h(!1),o==null||o()},200)},g=()=>({neutral:"/images/shifu_coacht.png",happy:"/images/shifuhappy_ct.png",sad:"/images/shifusad_ct.png",pointing:"/images/shifupointleft_ct.png"})[t],x=()=>({"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4",center:"top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})[n],y=()=>({small:"w-16 h-16",medium:"w-20 h-20",large:"w-24 h-24"})[l],v=()=>t!=="pointing"?{}:{animate:{left:{x:[0,-10,0]},right:{x:[0,10,0]},up:{y:[0,-10,0]},down:{y:[0,10,0]}}[s],transition:{duration:1,repeat:1/0,ease:"easeInOut"}},S=()=>n.includes("right")?"right-20 top-2":n.includes("left")?"left-20 top-2":"left-1/2 transform -translate-x-1/2 -top-16",C=()=>u.jsx("img",{src:g(),alt:`Shifu ${t}`,className:`${y()} object-contain rounded-lg shadow-lg`,style:{imageRendering:"pixelated"}});return d?u.jsx(X.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:`fixed ${x()} z-50 ${c}`,children:u.jsxs("div",{className:"relative",children:[u.jsxs(X.div,{...v(),className:"relative cursor-pointer",whileHover:{scale:1.1},onClick:()=>p(!f),children:[u.jsx(C,{}),t==="pointing"&&u.jsx(X.div,{className:"absolute inset-0 rounded-full border-2 border-red-400",animate:{scale:[1,1.3,1],opacity:[.7,0,.7]},transition:{duration:2,repeat:1/0}})]}),u.jsx(ko,{children:f&&u.jsx(X.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:`absolute ${S()} w-64`,children:u.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 relative",children:[u.jsx("div",{className:`absolute ${n.includes("right")?"-left-2":n.includes("left")?"-right-2":"bottom-full left-1/2 transform -translate-x-1/2"} w-0 h-0 border-8 ${n.includes("right")?"border-r-white border-l-transparent border-t-transparent border-b-transparent":n.includes("left")?"border-l-white border-r-transparent border-t-transparent border-b-transparent":"border-b-white border-l-transparent border-r-transparent border-t-transparent"}`}),u.jsx("div",{className:"text-sm text-gray-800 font-medium mb-2",children:e}),a&&u.jsx(Se,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0 text-gray-400 hover:text-gray-600",onClick:m,children:u.jsx(Lh,{className:"h-3 w-3"})})]})})})]})}):null}const ar=b.forwardRef(({className:t,type:e,...n},s)=>u.jsx("input",{type:e,className:Pt("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...n}));ar.displayName="Input";function Dze({position:t="bottom-right",autoShow:e=!1,showDelay:n=1e3,onDismiss:s,size:r="medium",className:i=""}){const[o,a]=b.useState(!e),[l,c]=b.useState(!1),[d,h]=b.useState([]),[f,p]=b.useState(""),[m,g]=b.useState(!1),[x,y]=b.useState("neutral"),[v,S]=b.useState(""),C=b.useRef(null);b.useEffect(()=>{if(e){const L=setTimeout(()=>{a(!0),T()},n);return()=>clearTimeout(L)}else T()},[e,n]),b.useEffect(()=>{k()},[d]);const k=()=>{var L;(L=C.current)==null||L.scrollIntoView({behavior:"smooth"})},T=async()=>{try{const M=await(await fetch("/api/shifu/daily-wisdom")).json();M.wisdom&&(S(M.wisdom),y(M.expression||"neutral"))}catch(L){console.error("Failed to load daily wisdom:",L),S("Welcome, young warrior. I am here to guide you on your martial arts journey.")}},_=async()=>{if(!f.trim()||m)return;const L={id:Date.now().toString(),text:f,sender:"user",timestamp:new Date};h(M=>[...M,L]),p(""),g(!0);try{const M=d.map(re=>({role:re.sender==="user"?"user":"assistant",content:re.text})),z=await(await fetch("/api/shifu/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:f,conversationHistory:M})})).json();if(z.message){const re={id:(Date.now()+1).toString(),text:z.message,sender:"shifu",timestamp:new Date,expression:z.expression||"neutral"};h(U=>[...U,re]),y(z.expression||"neutral")}else throw new Error(z.error||"Failed to get response")}catch(M){console.error("Chat error:",M);const q={id:(Date.now()+1).toString(),text:"Hmm... even a master sometimes needs a moment to gather his thoughts. Please try again, young grasshopper.",sender:"shifu",timestamp:new Date,expression:"sad"};h(z=>[...z,q]),y("sad")}finally{g(!1)}},$=L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),_())},R=()=>({neutral:"/images/shifu_coacht.png",happy:"/images/shifuhappy_ct.png",sad:"/images/shifusad_ct.png",pointing:"/images/shifupointleft_ct.png"})[x],A=()=>({"top-left":"top-4 left-4","top-right":"top-4 right-4","bottom-left":"bottom-4 left-4","bottom-right":"bottom-4 right-4"})[t],j=()=>({small:"w-16 h-16",medium:"w-20 h-20",large:"w-24 h-24"})[r],F=()=>t.includes("right")?"right-0 bottom-24":t.includes("left")?"left-0 bottom-24":"right-0 bottom-24";return o?u.jsxs("div",{className:`fixed ${A()} z-50 ${i}`,children:[u.jsx(ko,{children:l&&u.jsxs(X.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:`absolute ${F()} w-80 h-96 bg-white rounded-lg shadow-2xl border border-gray-200 flex flex-col mb-2`,children:[u.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-amber-50 to-yellow-50",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("img",{src:R(),alt:"Master Shifu",className:"w-8 h-8 rounded-full",style:{imageRendering:"pixelated"}}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold text-gray-900",children:"Master Shifu"}),u.jsx("p",{className:"text-xs text-gray-500",children:"Your AI Martial Arts Coach"})]})]}),u.jsx(Se,{variant:"ghost",size:"sm",onClick:()=>c(!1),className:"h-8 w-8 p-0",children:u.jsx(Lh,{className:"h-4 w-4"})})]}),u.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[v&&d.length===0&&u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx("img",{src:R(),alt:"Shifu",className:"w-6 h-6 rounded-full mt-1",style:{imageRendering:"pixelated"}}),u.jsxs("div",{className:"bg-gradient-to-r from-amber-100 to-yellow-100 rounded-lg p-3 max-w-64 border border-amber-200",children:[u.jsx("p",{className:"text-sm text-gray-800",children:v}),u.jsxs("div",{className:"flex items-center mt-1 space-x-1",children:[u.jsx(gh,{className:"h-3 w-3 text-amber-500"}),u.jsx("span",{className:"text-xs text-amber-600",children:"Daily Wisdom"})]})]})]}),d.map(L=>u.jsxs("div",{className:`flex ${L.sender==="user"?"justify-end":"items-start space-x-2"}`,children:[L.sender==="shifu"&&u.jsx("img",{src:R(),alt:"Shifu",className:"w-6 h-6 rounded-full mt-1",style:{imageRendering:"pixelated"}}),u.jsx("div",{className:`rounded-lg p-3 max-w-64 ${L.sender==="user"?"bg-blue-500 text-white":"bg-gradient-to-r from-amber-100 to-yellow-100 text-gray-800 border border-amber-200"}`,children:u.jsx("p",{className:"text-sm",children:L.text})})]},L.id)),m&&u.jsxs("div",{className:"flex items-start space-x-2",children:[u.jsx("img",{src:R(),alt:"Shifu",className:"w-6 h-6 rounded-full mt-1",style:{imageRendering:"pixelated"}}),u.jsx("div",{className:"bg-gradient-to-r from-amber-100 to-yellow-100 rounded-lg p-3 border border-amber-200",children:u.jsxs("div",{className:"flex space-x-1",children:[u.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-bounce"}),u.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),u.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]}),u.jsx("div",{ref:C})]}),u.jsx("div",{className:"p-4 border-t border-gray-200",children:u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(ar,{value:f,onChange:L=>p(L.target.value),onKeyPress:$,placeholder:"Ask Master Shifu for guidance...",disabled:m,className:"flex-1"}),u.jsx(Se,{onClick:_,disabled:!f.trim()||m,size:"sm",className:"bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600",children:u.jsx(BV,{className:"h-4 w-4"})})]})})]})}),u.jsxs(X.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"relative",children:[u.jsxs(X.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>c(!l),className:`${j()} rounded-full shadow-lg border-2 border-amber-300 bg-gradient-to-r from-amber-100 to-yellow-100 p-1 relative overflow-hidden`,children:[u.jsx("img",{src:R(),alt:`Master Shifu ${x}`,className:"w-full h-full object-contain rounded-full",style:{imageRendering:"pixelated"}}),!l&&u.jsx(X.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center",children:u.jsx(fee,{className:"h-2 w-2 text-white"})})]}),!l&&v&&u.jsxs(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-full mb-2 right-0 w-64 bg-white rounded-lg shadow-lg border border-gray-200 p-3",children:[u.jsxs("div",{className:"text-xs text-gray-600 mb-1 flex items-center space-x-1",children:[u.jsx(gh,{className:"h-3 w-3 text-amber-500"}),u.jsx("span",{children:"Daily Wisdom"})]}),u.jsx("p",{className:"text-sm text-gray-800",children:v}),u.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-white"})]})]})]}):null}async function Oze(){try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),!0}catch(t){return console.error("Error requesting camera permission:",t),!1}}async function Fze(t="user"){try{try{return await navigator.mediaDevices.getUserMedia({video:{facingMode:t}})}catch{return console.warn(`Couldn't get ${t} camera, trying default camera`),await navigator.mediaDevices.getUserMedia({video:!0})}}catch(e){throw console.error("Error getting camera stream:",e),e}}const J9=b.createContext(null);function e7({children:t}){const[e,n]=b.useState(null),[s,r]=b.useState(!1),[i,o]=b.useState(!1);b.useEffect(()=>{const h=()=>{const f=window.innerWidth<768,p=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),m=/iPad/i.test(navigator.userAgent);o(f&&p&&!m)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const a=za({mutationFn:async h=>{console.log("Login attempt:",h);const f=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include"});if(!f.ok){const p=await f.json();throw new Error(p.message||"Login failed")}return await f.json()},onSuccess:h=>{n(h),console.log("Login successful:",h);const f=sessionStorage.getItem("mobileWarningShown");i&&!f&&(r(!0),sessionStorage.setItem("mobileWarningShown","true"))},onError:h=>{console.error("Login failed:",h.message)}}),l=za({mutationFn:async h=>{console.log("Register attempt:",h);const f=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h),credentials:"include"});if(!f.ok){const p=await f.json();throw new Error(p.message||"Registration failed")}return await f.json()},onSuccess:h=>{n(h),console.log("Registration successful:",h);const f=sessionStorage.getItem("mobileWarningShown");i&&!f&&(r(!0),sessionStorage.setItem("mobileWarningShown","true"))}}),c=za({mutationFn:async()=>{if(!(await fetch("/api/logout",{method:"POST",credentials:"include"})).ok)throw new Error("Logout failed")},onSuccess:()=>{n(null),console.log("Logout successful")},onError:h=>{console.error("Logout failed:",h.message)}}),d={user:e,loginMutation:a,registerMutation:l,logoutMutation:c,showMobileWarning:s,setShowMobileWarning:r,isMobileDevice:i};return u.jsx(J9.Provider,{value:d,children:t})}function nf(){const t=b.useContext(J9);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}const Mze={theme:"dark",setTheme:()=>null},Lze=b.createContext(Mze),t7=()=>{const t=b.useContext(Lze);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t};var Bze=b.createContext(void 0);function Gx(t){const e=b.useContext(Bze);return t||e||"ltr"}var eC="rovingFocusGroup.onEntryFocus",Vze={bubbles:!1,cancelable:!0},q1="RovingFocusGroup",[sT,n7,zze]=Jw(q1),[Wze,_m]=Ao(q1,[zze]),[Uze,Hze]=Wze(q1),s7=b.forwardRef((t,e)=>u.jsx(sT.Provider,{scope:t.__scopeRovingFocusGroup,children:u.jsx(sT.Slot,{scope:t.__scopeRovingFocusGroup,children:u.jsx(Gze,{...t,ref:e})})}));s7.displayName=q1;var Gze=b.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:r=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...h}=t,f=b.useRef(null),p=Pn(e,f),m=Gx(i),[g=null,x]=Sc({prop:o,defaultProp:a,onChange:l}),[y,v]=b.useState(!1),S=ei(c),C=n7(n),k=b.useRef(!1),[T,_]=b.useState(0);return b.useEffect(()=>{const $=f.current;if($)return $.addEventListener(eC,S),()=>$.removeEventListener(eC,S)},[S]),u.jsx(Uze,{scope:n,orientation:s,dir:m,loop:r,currentTabStopId:g,onItemFocus:b.useCallback($=>x($),[x]),onItemShiftTab:b.useCallback(()=>v(!0),[]),onFocusableItemAdd:b.useCallback(()=>_($=>$+1),[]),onFocusableItemRemove:b.useCallback(()=>_($=>$-1),[]),children:u.jsx(Mt.div,{tabIndex:y||T===0?-1:0,"data-orientation":s,...h,ref:p,style:{outline:"none",...t.style},onMouseDown:nt(t.onMouseDown,()=>{k.current=!0}),onFocus:nt(t.onFocus,$=>{const R=!k.current;if($.target===$.currentTarget&&R&&!y){const A=new CustomEvent(eC,Vze);if($.currentTarget.dispatchEvent(A),!A.defaultPrevented){const j=C().filter(z=>z.focusable),F=j.find(z=>z.active),L=j.find(z=>z.id===g),q=[F,L,...j].filter(Boolean).map(z=>z.ref.current);o7(q,d)}}k.current=!1}),onBlur:nt(t.onBlur,()=>v(!1))})})}),r7="RovingFocusGroupItem",i7=b.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:r=!1,tabStopId:i,...o}=t,a=Tl(),l=i||a,c=Hze(r7,n),d=c.currentTabStopId===l,h=n7(n),{onFocusableItemAdd:f,onFocusableItemRemove:p}=c;return b.useEffect(()=>{if(s)return f(),()=>p()},[s,f,p]),u.jsx(sT.ItemSlot,{scope:n,id:l,focusable:s,active:r,children:u.jsx(Mt.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...o,ref:e,onMouseDown:nt(t.onMouseDown,m=>{s?c.onItemFocus(l):m.preventDefault()}),onFocus:nt(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:nt(t.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){c.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const g=Xze(m,c.orientation,c.dir);if(g!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let y=h().filter(v=>v.focusable).map(v=>v.ref.current);if(g==="last")y.reverse();else if(g==="prev"||g==="next"){g==="prev"&&y.reverse();const v=y.indexOf(m.currentTarget);y=c.loop?Yze(y,v+1):y.slice(v+1)}setTimeout(()=>o7(y))}})})})});i7.displayName=r7;var Kze={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qze(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Xze(t,e,n){const s=qze(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Kze[s]}function o7(t,e=!1){const n=document.activeElement;for(const s of t)if(s===n||(s.focus({preventScroll:e}),document.activeElement!==n))return}function Yze(t,e){return t.map((n,s)=>t[(e+s)%t.length])}var UP=s7,HP=i7,rT=["Enter"," "],Qze=["ArrowDown","PageUp","Home"],a7=["ArrowUp","PageDown","End"],Zze=[...Qze,...a7],Jze={ltr:[...rT,"ArrowRight"],rtl:[...rT,"ArrowLeft"]},eWe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Kx="Menu",[U0,tWe,nWe]=Jw(Kx),[sf,l7]=Ao(Kx,[nWe,lm,_m]),X1=lm(),c7=_m(),[sWe,rf]=sf(Kx),[rWe,qx]=sf(Kx),u7=t=>{const{__scopeMenu:e,open:n=!1,children:s,dir:r,onOpenChange:i,modal:o=!0}=t,a=X1(e),[l,c]=b.useState(null),d=b.useRef(!1),h=ei(i),f=Gx(r);return b.useEffect(()=>{const p=()=>{d.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>d.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),u.jsx(yz,{...a,children:u.jsx(sWe,{scope:e,open:n,onOpenChange:h,content:l,onContentChange:c,children:u.jsx(rWe,{scope:e,onClose:b.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:f,modal:o,children:s})})})};u7.displayName=Kx;var iWe="MenuAnchor",GP=b.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t,r=X1(n);return u.jsx(M_,{...r,...s,ref:e})});GP.displayName=iWe;var KP="MenuPortal",[oWe,d7]=sf(KP,{forceMount:void 0}),h7=t=>{const{__scopeMenu:e,forceMount:n,children:s,container:r}=t,i=rf(KP,e);return u.jsx(oWe,{scope:e,forceMount:n,children:u.jsx(jo,{present:n||i.open,children:u.jsx(bx,{asChild:!0,container:r,children:s})})})};h7.displayName=KP;var ua="MenuContent",[aWe,qP]=sf(ua),f7=b.forwardRef((t,e)=>{const n=d7(ua,t.__scopeMenu),{forceMount:s=n.forceMount,...r}=t,i=rf(ua,t.__scopeMenu),o=qx(ua,t.__scopeMenu);return u.jsx(U0.Provider,{scope:t.__scopeMenu,children:u.jsx(jo,{present:s||i.open,children:u.jsx(U0.Slot,{scope:t.__scopeMenu,children:o.modal?u.jsx(lWe,{...r,ref:e}):u.jsx(cWe,{...r,ref:e})})})})}),lWe=b.forwardRef((t,e)=>{const n=rf(ua,t.__scopeMenu),s=b.useRef(null),r=Pn(e,s);return b.useEffect(()=>{const i=s.current;if(i)return LP(i)},[]),u.jsx(XP,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:nt(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),cWe=b.forwardRef((t,e)=>{const n=rf(ua,t.__scopeMenu);return u.jsx(XP,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),uWe=mh("MenuContent.ScrollLock"),XP=b.forwardRef((t,e)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:p,disableOutsideScroll:m,...g}=t,x=rf(ua,n),y=qx(ua,n),v=X1(n),S=c7(n),C=tWe(n),[k,T]=b.useState(null),_=b.useRef(null),$=Pn(e,_,x.onContentChange),R=b.useRef(0),A=b.useRef(""),j=b.useRef(0),F=b.useRef(null),L=b.useRef("right"),M=b.useRef(0),q=m?K1:b.Fragment,z=m?{as:uWe,allowPinchZoom:!0}:void 0,re=G=>{var ce,me;const xe=A.current+G,Ce=C().filter(ie=>!ie.disabled),De=document.activeElement,fe=(ce=Ce.find(ie=>ie.ref.current===De))==null?void 0:ce.textValue,ee=Ce.map(ie=>ie.textValue),Pe=SWe(ee,xe,fe),Re=(me=Ce.find(ie=>ie.textValue===Pe))==null?void 0:me.ref.current;(function ie(Q){A.current=Q,window.clearTimeout(R.current),Q!==""&&(R.current=window.setTimeout(()=>ie(""),1e3))})(xe),Re&&setTimeout(()=>Re.focus())};b.useEffect(()=>()=>window.clearTimeout(R.current),[]),MP();const U=b.useCallback(G=>{var Ce,De;return L.current===((Ce=F.current)==null?void 0:Ce.side)&&kWe(G,(De=F.current)==null?void 0:De.area)},[]);return u.jsx(aWe,{scope:n,searchRef:A,onItemEnter:b.useCallback(G=>{U(G)&&G.preventDefault()},[U]),onItemLeave:b.useCallback(G=>{var xe;U(G)||((xe=_.current)==null||xe.focus(),T(null))},[U]),onTriggerLeave:b.useCallback(G=>{U(G)&&G.preventDefault()},[U]),pointerGraceTimerRef:j,onPointerGraceIntentChange:b.useCallback(G=>{F.current=G},[]),children:u.jsx(q,{...z,children:u.jsx(H1,{asChild:!0,trapped:r,onMountAutoFocus:nt(i,G=>{var xe;G.preventDefault(),(xe=_.current)==null||xe.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:u.jsx(rm,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:p,children:u.jsx(UP,{asChild:!0,...S,dir:y.dir,orientation:"vertical",loop:s,currentTabStopId:k,onCurrentTabStopIdChange:T,onEntryFocus:nt(l,G=>{y.isUsingKeyboardRef.current||G.preventDefault()}),preventScrollOnEntryFocus:!0,children:u.jsx(L_,{role:"menu","aria-orientation":"vertical","data-state":$7(x.open),"data-radix-menu-content":"",dir:y.dir,...v,...g,ref:$,style:{outline:"none",...g.style},onKeyDown:nt(g.onKeyDown,G=>{const Ce=G.target.closest("[data-radix-menu-content]")===G.currentTarget,De=G.ctrlKey||G.altKey||G.metaKey,fe=G.key.length===1;Ce&&(G.key==="Tab"&&G.preventDefault(),!De&&fe&&re(G.key));const ee=_.current;if(G.target!==ee||!Zze.includes(G.key))return;G.preventDefault();const Re=C().filter(ce=>!ce.disabled).map(ce=>ce.ref.current);a7.includes(G.key)&&Re.reverse(),bWe(Re)}),onBlur:nt(t.onBlur,G=>{G.currentTarget.contains(G.target)||(window.clearTimeout(R.current),A.current="")}),onPointerMove:nt(t.onPointerMove,H0(G=>{const xe=G.target,Ce=M.current!==G.clientX;if(G.currentTarget.contains(xe)&&Ce){const De=G.clientX>M.current?"right":"left";L.current=De,M.current=G.clientX}}))})})})})})})});f7.displayName=ua;var dWe="MenuGroup",YP=b.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return u.jsx(Mt.div,{role:"group",...s,ref:e})});YP.displayName=dWe;var hWe="MenuLabel",p7=b.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return u.jsx(Mt.div,{...s,ref:e})});p7.displayName=hWe;var fw="MenuItem",y4="menu.itemSelect",Y1=b.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:s,...r}=t,i=b.useRef(null),o=qx(fw,t.__scopeMenu),a=qP(fw,t.__scopeMenu),l=Pn(e,i),c=b.useRef(!1),d=()=>{const h=i.current;if(!n&&h){const f=new CustomEvent(y4,{bubbles:!0,cancelable:!0});h.addEventListener(y4,p=>s==null?void 0:s(p),{once:!0}),v_(h,f),f.defaultPrevented?c.current=!1:o.onClose()}};return u.jsx(m7,{...r,ref:l,disabled:n,onClick:nt(t.onClick,d),onPointerDown:h=>{var f;(f=t.onPointerDown)==null||f.call(t,h),c.current=!0},onPointerUp:nt(t.onPointerUp,h=>{var f;c.current||(f=h.currentTarget)==null||f.click()}),onKeyDown:nt(t.onKeyDown,h=>{const f=a.searchRef.current!=="";n||f&&h.key===" "||rT.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});Y1.displayName=fw;var m7=b.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:s=!1,textValue:r,...i}=t,o=qP(fw,n),a=c7(n),l=b.useRef(null),c=Pn(e,l),[d,h]=b.useState(!1),[f,p]=b.useState("");return b.useEffect(()=>{const m=l.current;m&&p((m.textContent??"").trim())},[i.children]),u.jsx(U0.ItemSlot,{scope:n,disabled:s,textValue:r??f,children:u.jsx(HP,{asChild:!0,...a,focusable:!s,children:u.jsx(Mt.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:c,onPointerMove:nt(t.onPointerMove,H0(m=>{s?o.onItemLeave(m):(o.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:nt(t.onPointerLeave,H0(m=>o.onItemLeave(m))),onFocus:nt(t.onFocus,()=>h(!0)),onBlur:nt(t.onBlur,()=>h(!1))})})})}),fWe="MenuCheckboxItem",g7=b.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:s,...r}=t;return u.jsx(w7,{scope:t.__scopeMenu,checked:n,children:u.jsx(Y1,{role:"menuitemcheckbox","aria-checked":pw(n)?"mixed":n,...r,ref:e,"data-state":ZP(n),onSelect:nt(r.onSelect,()=>s==null?void 0:s(pw(n)?!0:!n),{checkForDefaultPrevented:!1})})})});g7.displayName=fWe;var x7="MenuRadioGroup",[pWe,mWe]=sf(x7,{value:void 0,onValueChange:()=>{}}),y7=b.forwardRef((t,e)=>{const{value:n,onValueChange:s,...r}=t,i=ei(s);return u.jsx(pWe,{scope:t.__scopeMenu,value:n,onValueChange:i,children:u.jsx(YP,{...r,ref:e})})});y7.displayName=x7;var v7="MenuRadioItem",b7=b.forwardRef((t,e)=>{const{value:n,...s}=t,r=mWe(v7,t.__scopeMenu),i=n===r.value;return u.jsx(w7,{scope:t.__scopeMenu,checked:i,children:u.jsx(Y1,{role:"menuitemradio","aria-checked":i,...s,ref:e,"data-state":ZP(i),onSelect:nt(s.onSelect,()=>{var o;return(o=r.onValueChange)==null?void 0:o.call(r,n)},{checkForDefaultPrevented:!1})})})});b7.displayName=v7;var QP="MenuItemIndicator",[w7,gWe]=sf(QP,{checked:!1}),S7=b.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:s,...r}=t,i=gWe(QP,n);return u.jsx(jo,{present:s||pw(i.checked)||i.checked===!0,children:u.jsx(Mt.span,{...r,ref:e,"data-state":ZP(i.checked)})})});S7.displayName=QP;var xWe="MenuSeparator",C7=b.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return u.jsx(Mt.div,{role:"separator","aria-orientation":"horizontal",...s,ref:e})});C7.displayName=xWe;var yWe="MenuArrow",k7=b.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t,r=X1(n);return u.jsx(B_,{...r,...s,ref:e})});k7.displayName=yWe;var vWe="MenuSub",[$7e,N7]=sf(vWe),bg="MenuSubTrigger",T7=b.forwardRef((t,e)=>{const n=rf(bg,t.__scopeMenu),s=qx(bg,t.__scopeMenu),r=N7(bg,t.__scopeMenu),i=qP(bg,t.__scopeMenu),o=b.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=i,c={__scopeMenu:t.__scopeMenu},d=b.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return b.useEffect(()=>d,[d]),b.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),l(null)}},[a,l]),u.jsx(GP,{asChild:!0,...c,children:u.jsx(m7,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":r.contentId,"data-state":$7(n.open),...t,ref:Zw(e,r.onTriggerChange),onClick:h=>{var f;(f=t.onClick)==null||f.call(t,h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:nt(t.onPointerMove,H0(h=>{i.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:nt(t.onPointerLeave,H0(h=>{var p,m;d();const f=(p=n.content)==null?void 0:p.getBoundingClientRect();if(f){const g=(m=n.content)==null?void 0:m.dataset.side,x=g==="right",y=x?-5:5,v=f[x?"left":"right"],S=f[x?"right":"left"];i.onPointerGraceIntentChange({area:[{x:h.clientX+y,y:h.clientY},{x:v,y:f.top},{x:S,y:f.top},{x:S,y:f.bottom},{x:v,y:f.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(h),h.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:nt(t.onKeyDown,h=>{var p;const f=i.searchRef.current!=="";t.disabled||f&&h.key===" "||Jze[s.dir].includes(h.key)&&(n.onOpenChange(!0),(p=n.content)==null||p.focus(),h.preventDefault())})})})});T7.displayName=bg;var _7="MenuSubContent",E7=b.forwardRef((t,e)=>{const n=d7(ua,t.__scopeMenu),{forceMount:s=n.forceMount,...r}=t,i=rf(ua,t.__scopeMenu),o=qx(ua,t.__scopeMenu),a=N7(_7,t.__scopeMenu),l=b.useRef(null),c=Pn(e,l);return u.jsx(U0.Provider,{scope:t.__scopeMenu,children:u.jsx(jo,{present:s||i.open,children:u.jsx(U0.Slot,{scope:t.__scopeMenu,children:u.jsx(XP,{id:a.contentId,"aria-labelledby":a.triggerId,...r,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var h;o.isUsingKeyboardRef.current&&((h=l.current)==null||h.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:nt(t.onFocusOutside,d=>{d.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:nt(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:nt(t.onKeyDown,d=>{var p;const h=d.currentTarget.contains(d.target),f=eWe[o.dir].includes(d.key);h&&f&&(i.onOpenChange(!1),(p=a.trigger)==null||p.focus(),d.preventDefault())})})})})})});E7.displayName=_7;function $7(t){return t?"open":"closed"}function pw(t){return t==="indeterminate"}function ZP(t){return pw(t)?"indeterminate":t?"checked":"unchecked"}function bWe(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function wWe(t,e){return t.map((n,s)=>t[(e+s)%t.length])}function SWe(t,e,n){const r=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=n?t.indexOf(n):-1;let o=wWe(t,Math.max(i,0));r.length===1&&(o=o.filter(c=>c!==n));const l=o.find(c=>c.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}function CWe(t,e){const{x:n,y:s}=t;let r=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i].x,l=e[i].y,c=e[o].x,d=e[o].y;l>s!=d>s&&n<(c-a)*(s-l)/(d-l)+a&&(r=!r)}return r}function kWe(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return CWe(n,e)}function H0(t){return e=>e.pointerType==="mouse"?t(e):void 0}var NWe=u7,TWe=GP,_We=h7,EWe=f7,$We=YP,IWe=p7,RWe=Y1,PWe=g7,AWe=y7,jWe=b7,DWe=S7,OWe=C7,FWe=k7,MWe=T7,LWe=E7,JP="DropdownMenu",[BWe,I7e]=Ao(JP,[l7]),_i=l7(),[VWe,I7]=BWe(JP),R7=t=>{const{__scopeDropdownMenu:e,children:n,dir:s,open:r,defaultOpen:i,onOpenChange:o,modal:a=!0}=t,l=_i(e),c=b.useRef(null),[d=!1,h]=Sc({prop:r,defaultProp:i,onChange:o});return u.jsx(VWe,{scope:e,triggerId:Tl(),triggerRef:c,contentId:Tl(),open:d,onOpenChange:h,onOpenToggle:b.useCallback(()=>h(f=>!f),[h]),modal:a,children:u.jsx(NWe,{...l,open:d,onOpenChange:h,dir:s,modal:a,children:n})})};R7.displayName=JP;var P7="DropdownMenuTrigger",A7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...r}=t,i=I7(P7,n),o=_i(n);return u.jsx(TWe,{asChild:!0,...o,children:u.jsx(Mt.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...r,ref:Zw(e,i.triggerRef),onPointerDown:nt(t.onPointerDown,a=>{!s&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:nt(t.onKeyDown,a=>{s||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});A7.displayName=P7;var zWe="DropdownMenuPortal",j7=t=>{const{__scopeDropdownMenu:e,...n}=t,s=_i(e);return u.jsx(_We,{...s,...n})};j7.displayName=zWe;var D7="DropdownMenuContent",O7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=I7(D7,n),i=_i(n),o=b.useRef(!1);return u.jsx(EWe,{id:r.contentId,"aria-labelledby":r.triggerId,...i,...s,ref:e,onCloseAutoFocus:nt(t.onCloseAutoFocus,a=>{var l;o.current||(l=r.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:nt(t.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!r.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});O7.displayName=D7;var WWe="DropdownMenuGroup",UWe=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx($We,{...r,...s,ref:e})});UWe.displayName=WWe;var HWe="DropdownMenuLabel",F7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(IWe,{...r,...s,ref:e})});F7.displayName=HWe;var GWe="DropdownMenuItem",M7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(RWe,{...r,...s,ref:e})});M7.displayName=GWe;var KWe="DropdownMenuCheckboxItem",L7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(PWe,{...r,...s,ref:e})});L7.displayName=KWe;var qWe="DropdownMenuRadioGroup",XWe=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(AWe,{...r,...s,ref:e})});XWe.displayName=qWe;var YWe="DropdownMenuRadioItem",B7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(jWe,{...r,...s,ref:e})});B7.displayName=YWe;var QWe="DropdownMenuItemIndicator",V7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(DWe,{...r,...s,ref:e})});V7.displayName=QWe;var ZWe="DropdownMenuSeparator",z7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(OWe,{...r,...s,ref:e})});z7.displayName=ZWe;var JWe="DropdownMenuArrow",e6e=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(FWe,{...r,...s,ref:e})});e6e.displayName=JWe;var t6e="DropdownMenuSubTrigger",W7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(MWe,{...r,...s,ref:e})});W7.displayName=t6e;var n6e="DropdownMenuSubContent",U7=b.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,r=_i(n);return u.jsx(LWe,{...r,...s,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});U7.displayName=n6e;var s6e=R7,r6e=A7,i6e=j7,H7=O7,G7=F7,K7=M7,q7=L7,X7=B7,Y7=V7,Q7=z7,Z7=W7,J7=U7;const iT=s6e,oT=r6e,o6e=b.forwardRef(({className:t,inset:e,children:n,...s},r)=>u.jsxs(Z7,{ref:r,className:Pt("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...s,children:[n,u.jsx(yk,{className:"ml-auto"})]}));o6e.displayName=Z7.displayName;const a6e=b.forwardRef(({className:t,...e},n)=>u.jsx(J7,{ref:n,className:Pt("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...e}));a6e.displayName=J7.displayName;const mw=b.forwardRef(({className:t,sideOffset:e=4,...n},s)=>u.jsx(i6e,{children:u.jsx(H7,{ref:s,sideOffset:e,className:Pt("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})}));mw.displayName=H7.displayName;const lp=b.forwardRef(({className:t,inset:e,...n},s)=>u.jsx(K7,{ref:s,className:Pt("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",t),...n}));lp.displayName=K7.displayName;const l6e=b.forwardRef(({className:t,children:e,checked:n,...s},r)=>u.jsxs(q7,{ref:r,className:Pt("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...s,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(Y7,{children:u.jsx(n1,{className:"h-4 w-4"})})}),e]}));l6e.displayName=q7.displayName;const c6e=b.forwardRef(({className:t,children:e,...n},s)=>u.jsxs(X7,{ref:s,className:Pt("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(Y7,{children:u.jsx(DV,{className:"h-2 w-2 fill-current"})})}),e]}));c6e.displayName=X7.displayName;const u6e=b.forwardRef(({className:t,inset:e,...n},s)=>u.jsx(G7,{ref:s,className:Pt("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...n}));u6e.displayName=G7.displayName;const eK=b.forwardRef(({className:t,...e},n)=>u.jsx(Q7,{ref:n,className:Pt("-mx-1 my-1 h-px bg-muted",t),...e}));eK.displayName=Q7.displayName;var e3="Tabs",[d6e,R7e]=Ao(e3,[_m]),tK=_m(),[h6e,t3]=d6e(e3),nK=b.forwardRef((t,e)=>{const{__scopeTabs:n,value:s,onValueChange:r,defaultValue:i,orientation:o="horizontal",dir:a,activationMode:l="automatic",...c}=t,d=Gx(a),[h,f]=Sc({prop:s,onChange:r,defaultProp:i});return u.jsx(h6e,{scope:n,baseId:Tl(),value:h,onValueChange:f,orientation:o,dir:d,activationMode:l,children:u.jsx(Mt.div,{dir:d,"data-orientation":o,...c,ref:e})})});nK.displayName=e3;var sK="TabsList",rK=b.forwardRef((t,e)=>{const{__scopeTabs:n,loop:s=!0,...r}=t,i=t3(sK,n),o=tK(n);return u.jsx(UP,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:s,children:u.jsx(Mt.div,{role:"tablist","aria-orientation":i.orientation,...r,ref:e})})});rK.displayName=sK;var iK="TabsTrigger",oK=b.forwardRef((t,e)=>{const{__scopeTabs:n,value:s,disabled:r=!1,...i}=t,o=t3(iK,n),a=tK(n),l=cK(o.baseId,s),c=uK(o.baseId,s),d=s===o.value;return u.jsx(HP,{asChild:!0,...a,focusable:!r,active:d,children:u.jsx(Mt.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":c,"data-state":d?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:l,...i,ref:e,onMouseDown:nt(t.onMouseDown,h=>{!r&&h.button===0&&h.ctrlKey===!1?o.onValueChange(s):h.preventDefault()}),onKeyDown:nt(t.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&o.onValueChange(s)}),onFocus:nt(t.onFocus,()=>{const h=o.activationMode!=="manual";!d&&!r&&h&&o.onValueChange(s)})})})});oK.displayName=iK;var aK="TabsContent",lK=b.forwardRef((t,e)=>{const{__scopeTabs:n,value:s,forceMount:r,children:i,...o}=t,a=t3(aK,n),l=cK(a.baseId,s),c=uK(a.baseId,s),d=s===a.value,h=b.useRef(d);return b.useEffect(()=>{const f=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(f)},[]),u.jsx(jo,{present:r||d,children:({present:f})=>u.jsx(Mt.div,{"data-state":d?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!f,id:c,tabIndex:0,...o,ref:e,style:{...t.style,animationDuration:h.current?"0s":void 0},children:f&&i})})});lK.displayName=aK;function cK(t,e){return`${t}-trigger-${e}`}function uK(t,e){return`${t}-content-${e}`}var f6e=nK,dK=rK,hK=oK,fK=lK;const n3=f6e,Q1=b.forwardRef(({className:t,...e},n)=>u.jsx(dK,{ref:n,className:Pt("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));Q1.displayName=dK.displayName;const Fu=b.forwardRef(({className:t,...e},n)=>u.jsx(hK,{ref:n,className:Pt("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...e}));Fu.displayName=hK.displayName;const G0=b.forwardRef(({className:t,...e},n)=>u.jsx(fK,{ref:n,className:Pt("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));G0.displayName=fK.displayName;const p6e=[{id:1,username:"taekwondo_master",streak:42,belt:"black"},{id:2,username:"kick_champion",streak:38,belt:"black"},{id:3,username:"ojaskandy",streak:30,belt:"red"},{id:4,username:"martial_artist",streak:25,belt:"blue"},{id:5,username:"tkd_beginner",streak:20,belt:"green"}],m6e=[{id:2,username:"kick_champion",timeSpent:12800,belt:"black"},{id:1,username:"taekwondo_master",timeSpent:11500,belt:"black"},{id:3,username:"ojaskandy",timeSpent:8900,belt:"red"},{id:5,username:"tkd_beginner",timeSpent:5200,belt:"green"},{id:4,username:"martial_artist",timeSpent:4300,belt:"blue"}],g6e=t=>{const e=Math.floor(t/60),n=t%60;return e>0?`${e}h ${n}m`:`${n}m`};function x6e({currentUsername:t}){const[e,n]=b.useState("consistency"),[s,r]=b.useState(!1);b.useEffect(()=>(r(!0),()=>r(!1)),[e]);const i=l=>{switch(l){case 0:return u.jsx(X.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,type:"spring",stiffness:500},className:"absolute -left-3 -top-3 bg-yellow-500 rounded-full h-7 w-7 flex items-center justify-center shadow-lg",children:u.jsx(lc,{className:"h-4 w-4 text-black"})});case 1:return u.jsx(X.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.3,type:"spring",stiffness:400},className:"absolute -left-3 -top-3 bg-gray-300 rounded-full h-6 w-6 flex items-center justify-center shadow-md",children:u.jsx(QA,{className:"h-3 w-3 text-gray-800"})});case 2:return u.jsx(X.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.4,type:"spring",stiffness:300},className:"absolute -left-3 -top-3 bg-amber-700 rounded-full h-5 w-5 flex items-center justify-center shadow-sm",children:u.jsx(QA,{className:"h-3 w-3 text-amber-200"})});default:return null}},o={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},a={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:100}}};return u.jsxs("div",{className:"w-full",children:[u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex items-center justify-center mb-6 space-x-2",children:[u.jsx(Nk,{className:"h-6 w-6 text-yellow-500"}),u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Leaderboard"}),u.jsx(Nk,{className:"h-6 w-6 text-yellow-500"})]}),u.jsxs(n3,{defaultValue:"consistency",onValueChange:n,className:"w-full",children:[u.jsxs(Q1,{className:"grid w-full grid-cols-2 mb-6 h-14 bg-gradient-to-r from-gray-900 to-gray-800 border border-red-900/30 rounded-lg overflow-hidden",children:[u.jsx(Fu,{value:"consistency",className:"h-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-700 data-[state=active]:to-red-600 data-[state=active]:text-white rounded-none",children:u.jsxs("div",{className:"flex flex-col items-center",children:[u.jsx(Cx,{className:"h-5 w-5 mb-1"}),u.jsx("span",{className:"font-medium",children:"Consistency"})]})}),u.jsx(Fu,{value:"time-spent",className:"h-full data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-700 data-[state=active]:to-red-600 data-[state=active]:text-white rounded-none",children:u.jsxs("div",{className:"flex flex-col items-center",children:[u.jsx(Mh,{className:"h-5 w-5 mb-1"}),u.jsx("span",{className:"font-medium",children:"Time Spent"})]})})]}),u.jsx(G0,{value:"consistency",className:"mt-0",children:u.jsxs("div",{className:"bg-gradient-to-b from-gray-900 to-black rounded-xl border border-red-900/30 p-5 shadow-lg",children:[u.jsxs(X.div,{initial:"hidden",animate:"visible",variants:o,className:"grid grid-cols-3 gap-6 font-medium text-gray-400 mb-4 text-sm px-4",children:[u.jsx("div",{children:"Rank"}),u.jsx("div",{children:"User"}),u.jsx("div",{className:"text-right",children:"Streak"})]}),u.jsx(X.div,{initial:"hidden",animate:s?"visible":"hidden",variants:o,className:"space-y-4",children:p6e.map((l,c)=>u.jsxs(X.div,{variants:a,className:`relative flex items-center bg-gradient-to-r ${l.username===t?"from-red-900/40 to-red-800/20 border-red-500/50":"from-gray-800/40 to-transparent hover:from-gray-800/60"} rounded-lg p-4 border border-gray-800/70 shadow-md cursor-pointer transition-all hover:transform hover:-translate-y-1 hover:shadow-lg hover:shadow-red-900/5`,children:[i(c),u.jsxs("div",{className:"grid grid-cols-3 gap-6 w-full items-center",children:[u.jsx("div",{className:"flex items-center justify-center",children:u.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center text-lg font-bold ${c<3?"bg-gradient-to-r from-yellow-500 to-amber-400 text-black":"bg-gray-800 text-gray-200"}`,children:c+1})}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:`h-3 w-3 rounded-full mr-2 bg-${l.belt}-600 ${l.belt==="black"?"border border-white/50":""}`}),u.jsx("span",{className:`font-semibold ${l.username===t?"text-white":"text-gray-200"}`,children:l.username})]}),u.jsxs("div",{className:"text-right font-bold text-lg",children:[u.jsx("span",{className:l.username===t?"text-red-500":"text-white",children:l.streak}),u.jsx("span",{className:"text-xs font-normal text-gray-400 ml-1",children:"days"})]})]})]},l.id))}),u.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"mt-6 pt-4 border-t border-red-900/20 text-center",children:u.jsxs("p",{className:"text-sm text-gray-400",children:["Keep your streak going! ",u.jsx("span",{className:"text-red-500 font-medium",children:"Log in daily"})," to climb the ranks."]})})]})}),u.jsx(G0,{value:"time-spent",className:"mt-0",children:u.jsxs("div",{className:"bg-gradient-to-b from-gray-900 to-black rounded-xl border border-red-900/30 p-5 shadow-lg",children:[u.jsxs(X.div,{initial:"hidden",animate:"visible",variants:o,className:"grid grid-cols-3 gap-6 font-medium text-gray-400 mb-4 text-sm px-4",children:[u.jsx("div",{children:"Rank"}),u.jsx("div",{children:"User"}),u.jsx("div",{className:"text-right",children:"Time"})]}),u.jsx(X.div,{initial:"hidden",animate:s?"visible":"hidden",variants:o,className:"space-y-4",children:m6e.map((l,c)=>u.jsxs(X.div,{variants:a,className:`relative flex items-center bg-gradient-to-r ${l.username===t?"from-red-900/40 to-red-800/20 border-red-500/50":"from-gray-800/40 to-transparent hover:from-gray-800/60"} rounded-lg p-4 border border-gray-800/70 shadow-md cursor-pointer transition-all hover:transform hover:-translate-y-1 hover:shadow-lg hover:shadow-red-900/5`,children:[i(c),u.jsxs("div",{className:"grid grid-cols-3 gap-6 w-full items-center",children:[u.jsx("div",{className:"flex items-center justify-center",children:u.jsx("div",{className:`h-8 w-8 rounded-full flex items-center justify-center text-lg font-bold ${c<3?"bg-gradient-to-r from-yellow-500 to-amber-400 text-black":"bg-gray-800 text-gray-200"}`,children:c+1})}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:`h-3 w-3 rounded-full mr-2 bg-${l.belt}-600 ${l.belt==="black"?"border border-white/50":""}`}),u.jsx("span",{className:`font-semibold ${l.username===t?"text-white":"text-gray-200"}`,children:l.username})]}),u.jsxs("div",{className:"text-right",children:[u.jsx("span",{className:`font-bold text-lg ${l.username===t?"text-red-500":"text-white"}`,children:g6e(Math.floor(l.timeSpent/60))}),u.jsx("span",{className:"block text-xs font-normal text-gray-400",children:"total time"})]})]})]},l.id))}),u.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"mt-6 pt-4 border-t border-red-900/20 text-center",children:u.jsxs("p",{className:"text-sm text-gray-400",children:["Practice makes perfect! ",u.jsx("span",{className:"text-red-500 font-medium",children:"More training time"})," means better skills."]})})]})})]})]})}const v4={white:{bg:"bg-white",text:"text-black",border:"border-gray-300"},yellow:{bg:"bg-yellow-400",text:"text-black",border:"border-yellow-500"},green:{bg:"bg-green-500",text:"text-white",border:"border-green-600"},blue:{bg:"bg-blue-600",text:"text-white",border:"border-blue-700"},red:{bg:"bg-red-600",text:"text-white",border:"border-red-700"},black:{bg:"bg-black",text:"text-white",border:"border-white"}};function pK({beltColor:t,beltName:e,beltLevel:n=1,showLevel:s=!1,size:r="medium",stretched:i=!1,username:o}){const a=v4[t]||v4.white,c=(()=>{switch(r){case"small":return{container:"h-8 text-xs",belt:"w-16",level:"h-4 w-4 text-[9px]"};case"large":return{container:"h-14 text-lg",belt:"w-40",level:"h-7 w-7 text-sm"};case"medium":default:return{container:"h-10 text-sm",belt:"w-28",level:"h-5 w-5 text-xs"}}})();return i?u.jsx("div",{className:"w-full my-6",children:u.jsxs("div",{className:`relative w-full h-24 ${a.bg} rounded-lg shadow-lg overflow-hidden border-2 ${a.border}`,children:[u.jsx("div",{className:"absolute left-0 inset-y-0 w-32 border-r-2 border-dashed border-white/30 flex items-center justify-center",children:u.jsx("div",{className:`w-6 h-[90%] ${a.border} bg-gradient-to-r from-transparent to-${t==="white"?"gray":t}-500/30`})}),u.jsx("div",{className:"absolute right-0 inset-y-0 w-32 border-l-2 border-dashed border-white/30 flex items-center justify-center",children:u.jsx("div",{className:`w-6 h-[90%] ${a.border} bg-gradient-to-l from-transparent to-${t==="white"?"gray":t}-500/30`})}),o&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:`text-3xl font-bold tracking-widest uppercase ${a.text} opacity-80 engraved-text`,children:o}),u.jsx("div",{className:"mt-1 flex items-center justify-center",children:[...Array(n)].map((d,h)=>u.jsx("div",{className:"mx-0.5 h-2 w-2 bg-white/70 rounded-full"},h))})]})}),u.jsxs("div",{className:"absolute bottom-2 right-2",children:[u.jsx("span",{className:`text-sm font-semibold ${a.text} opacity-70`,children:e}),s&&n>1&&u.jsxs("span",{className:`ml-1 text-sm font-bold ${a.text}`,children:["Level ",n]})]})]})}):u.jsx("div",{className:"flex flex-col items-center",children:u.jsxs("div",{className:`relative flex items-center justify-center ${c.container} px-3 rounded-sm ${a.bg} ${a.text} shadow-md ${t==="black"?"border border-white/50":""}`,children:[u.jsx("div",{className:`absolute left-0 inset-y-0 ${c.belt} border-t-2 border-b-2 ${a.border} flex items-center justify-start px-2`,children:s&&n>1&&u.jsx("div",{className:"flex",children:[...Array(n)].map((d,h)=>u.jsx("div",{className:"mr-0.5 h-1.5 w-1.5 bg-white/70 rounded-full"},h))})}),u.jsx("span",{className:"font-semibold",children:e}),s&&n>1&&u.jsx("div",{className:`absolute -top-2 -right-2 ${c.level} rounded-full bg-white flex items-center justify-center shadow-md`,children:u.jsx("span",{className:"font-bold text-black",children:n})})]})})}function y6e({className:t=""}){const[e,n]=b.useState(0),[s,r]=b.useState(!1),[i,o]=b.useState(!0);b.useEffect(()=>(r(!0),n(0),document.addEventListener("visibilitychange",a),window.addEventListener("focus",l),window.addEventListener("blur",c),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("focus",l),window.removeEventListener("blur",c)}),[]);const a=()=>{o(!document.hidden)},l=()=>{o(!0)},c=()=>{o(!1)};b.useEffect(()=>{let h=null;return s&&i?h=setInterval(()=>{n(f=>f+1)},1e3):h&&clearInterval(h),()=>{h&&clearInterval(h)}},[s,i]);const d=h=>{const f=Math.floor(h/3600),p=Math.floor(h%3600/60),m=h%60,g=f.toString().padStart(2,"0"),x=p.toString().padStart(2,"0"),y=m.toString().padStart(2,"0");return`${g}:${x}:${y}`};return u.jsxs("div",{className:`flex items-center ${t}`,children:[u.jsx(Mh,{className:"w-5 h-5 mr-2 text-white"}),u.jsx("div",{className:"text-white font-mono text-lg",children:d(e)})]})}function v6e({className:t="",showSeconds:e=!0,showIcon:n=!0}){const[s,r]=b.useState(new Date);b.useEffect(()=>{const o=setInterval(()=>{r(new Date)},1e3);return()=>clearInterval(o)},[]);const i=o=>{const a=o.getHours(),l=o.getMinutes(),c=o.getSeconds(),d=a%12||12,h=a>=12?"PM":"AM",f=d.toString().padStart(2,"0"),p=l.toString().padStart(2,"0");if(e){const m=c.toString().padStart(2,"0");return`${f}:${p}:${m} ${h}`}return`${f}:${p} ${h}`};return u.jsxs("div",{className:`flex items-center ${t}`,children:[n&&u.jsx(Mh,{className:"w-5 h-5 mr-2 text-white"}),u.jsx("div",{className:"text-white font-mono",children:i(s)})]})}const b6e=()=>{if(typeof window>"u")return!1;const t=navigator.userAgent||navigator.vendor||window.opera,e=/android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t.toLowerCase());return/ipad/i.test(t.toLowerCase())?!1:e};function w6e(){var as;const{user:t,logoutMutation:e}=nf(),{theme:n,setTheme:s}=t7(),[r,i]=b.useState("inactive"),[o,a]=b.useState(null),[l,c]=b.useState(!1),[d,h]=b.useState(0),[f,p]=b.useState(!1),[m,g]=b.useState("camera"),[x,y]=b.useState(null),[v,S]=b.useState("user"),[C,k]=b.useState(null),[T,_]=b.useState(null),[$,R]=b.useState(void 0),[A,j]=b.useState(.5),[F,L]=b.useState("lightning"),[M,q]=b.useState(1),[z,re]=b.useState(!0),[U,G]=b.useState(!0),[xe,Ce]=b.useState(!0),[De,fe]=b.useState(.8),[ee,Pe]=b.useState(0),[Re,ce]=b.useState(!1),[me,ie]=b.useState(!1),[Q,oe]=b.useState(!0);b.useState(!1);const[ae,Ae]=b.useState("red"),[Be,Xe]=b.useState(!0),[lt,Me]=b.useState(!1),[je,Ze]=b.useState(!1),[Ye,Ie]=b.useState(!1),[B,Z]=b.useState(!1),[te,ve]=b.useState(!1),[we,de]=b.useState(!1),[Ee,mt]=b.useState([]),[It,jt]=b.useState(null),[hs,fn]=b.useState({color:"red",name:"Red Belt",level:2}),[dt,At]=b.useState("sky"),[Vs,Ln]=b.useState(!1),[lr,qn]=b.useState(!1),[Ei,is]=b.useState(!1),[Mo,fs]=b.useState(!1),[pe,$e]=b.useState(!1),[Te,Je]=b.useState(null);sm({queryKey:["/api/recordings",t==null?void 0:t.id],queryFn:()=>aa("GET","/api/recordings").then(Oe=>Oe.json()),enabled:!!t}),b.useEffect(()=>{const Oe=localStorage.getItem("userBelt");Oe&&fn(JSON.parse(Oe));const _t=localStorage.getItem("backgroundImages");_t&&mt(JSON.parse(_t));const Zt=localStorage.getItem("selectedBackground");Zt&&jt(Zt);const Es=localStorage.getItem("buttonTheme");Es&&At(Es),localStorage.getItem("hasSeenWelcomeGuide")||Me(!0),t&&b6e()&&de(!0)},[t]);const[He,it]=b.useState(null),[Ot,Yt]=b.useState(!1),On=async()=>{try{if(c(!0),h(0),m==="camera"&&!x){const Oe=await Fze(v);y(Oe)}await go(F),i("ready"),c(!1)}catch(Oe){console.error("Error loading pose detection models:",Oe),i("error"),c(!1)}},en=async()=>{try{c(!0);const Oe=await Oze();a(Oe),Oe?(i("loading"),g("camera"),await On()):(i("error"),c(!1))}catch(Oe){console.error("Error requesting camera permission:",Oe),i("error"),c(!1)}},An=()=>{p(!f),r==="ready"&&i("active")},os=()=>{ce(!Re)},Ht=Oe=>{Oe.startsWith("blob:")?R(Oe):Oe.includes("#youtube")||Oe.includes("#video")?(g("video"),R(Oe),i("ready")):(it(Oe),Yt(!0))},zs=()=>{const Oe=n==="dark"?"light":"dark";s(Oe),oe(Oe==="dark")},nl=()=>{ve(!te)},Lo=()=>{const Oe=(t==null?void 0:t.username)||"User",_t=encodeURIComponent(`Feedback on CoachT by ${Oe}`),Zt=encodeURIComponent(`Please type your feedback here:

`);window.location.href=`mailto:ojaskandy@gmail.com?subject=${_t}&body=${Zt}`},ts=(Oe,_t)=>({sky:{primary:"bg-gradient-to-r from-sky-600 to-cyan-500 hover:from-sky-700 hover:to-cyan-600 text-white shadow-lg hover:shadow-sky-500/40 focus:ring-sky-500",outline:"border-sky-700 text-sky-400 hover:bg-sky-900/30 hover:text-sky-300 focus:ring-sky-500"},crimson:{primary:"bg-gradient-to-r from-red-600 to-rose-500 hover:from-red-700 hover:to-rose-600 text-white shadow-lg hover:shadow-red-500/40 focus:ring-red-500",outline:"border-red-700 text-red-400 hover:bg-red-900/30 hover:text-red-300 focus:ring-red-500"},emerald:{primary:"bg-gradient-to-r from-emerald-600 to-green-500 hover:from-emerald-700 hover:to-green-600 text-white shadow-lg hover:shadow-emerald-500/40 focus:ring-emerald-500",outline:"border-emerald-700 text-emerald-400 hover:bg-emerald-900/30 hover:text-emerald-300 focus:ring-emerald-500"},amber:{primary:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white shadow-lg hover:shadow-amber-500/40 focus:ring-amber-500",outline:"border-amber-700 text-amber-400 hover:bg-amber-900/30 hover:text-amber-300 focus:ring-amber-500"}})[Oe][_t];b.useEffect(()=>{Ce(!Be)},[Be]),b.useEffect(()=>{!localStorage.getItem("hasSeenShifuGuides")&&t&&!Mo&&setTimeout(()=>{Ln(!0),fs(!0)},3e3)},[t,Mo]);const $i=()=>{setTimeout(()=>{qn(!0)},2e3)},wa=()=>{setTimeout(()=>{is(!0)},4e3)},Bo=()=>{localStorage.setItem("hasSeenShifuGuides","true"),Ln(!1),$i()},zl=()=>{const Oe={lastActivity:null,recentActivities:[],currentStreak:0,preferredTechniques:[],weakAreas:[],strengths:[],sessionTime:0,lastLogin:new Date},_t=localStorage.getItem("userContext");if(_t)try{const Zt=JSON.parse(_t);return Zt.lastLogin=new Date(Zt.lastLogin),Zt.lastActivity&&(Zt.lastActivity.startTime=new Date(Zt.lastActivity.startTime),Zt.lastActivity.endTime&&(Zt.lastActivity.endTime=new Date(Zt.lastActivity.endTime))),Zt.recentActivities=Zt.recentActivities.map(Es=>({...Es,startTime:new Date(Es.startTime),endTime:Es.endTime?new Date(Es.endTime):void 0})),Zt}catch(Zt){console.error("Error parsing saved context:",Zt)}return Oe},Vo=Oe=>{localStorage.setItem("userContext",JSON.stringify(Oe))},oi=(Oe,_t,Zt,Es,Ri)=>{const yr={id:Date.now().toString(),type:Oe,title:_t,status:Zt,startTime:new Date,details:Es,accuracy:Ri},to={...Te,lastActivity:yr,recentActivities:[yr,...Te.recentActivities.slice(0,9)]};Je(to),Vo(to)},Wl=(Oe,_t)=>{if(Te!=null&&Te.lastActivity&&Te.lastActivity.status==="started"){const Zt={...Te.lastActivity,status:"completed",endTime:new Date,accuracy:Oe},Es={...Te,lastActivity:Zt,recentActivities:[Zt,...Te.recentActivities.slice(1)],currentStreak:Te.currentStreak+1,weakAreas:_t!=null&&_t.weakAreas?Array.from(new Set([...Te.weakAreas,..._t.weakAreas])):Te.weakAreas,strengths:_t!=null&&_t.strengths?Array.from(new Set([...Te.strengths,..._t.strengths])):Te.strengths};Je(Es),Vo(Es)}},$r=()=>{if(Te){const Oe={...Te,sessionTime:Te.sessionTime+1};Je(Oe),Vo(Oe)}};b.useEffect(()=>{t&&!Te&&Je(zl())},[t]),b.useEffect(()=>{if(Te){const Oe=setInterval($r,6e4);return()=>clearInterval(Oe)}},[Te]);const Xs=()=>{oi("practice","Round Kick Drills","started","Practicing round kicks with focus on form and balance"),setTimeout(()=>{Wl(85,{strengths:["Balance","Flexibility"],weakAreas:["Power generation"]})},3e3)},Ii=()=>{oi("challenge","Speed Challenge: 50 Kicks","started","Attempting to complete 50 kicks in under 2 minutes"),setTimeout(()=>{Wl(92,{strengths:["Speed","Endurance"],weakAreas:["Accuracy under pressure"]})},5e3)},sl=()=>{oi("workout","Full Body Conditioning","paused","Taking a break during intense conditioning workout")};return u.jsxs("div",{className:"min-h-screen flex flex-col bg-black overflow-hidden",children:[u.jsxs("header",{className:"bg-gradient-to-r from-black to-red-950/90 border-b border-red-900/30 px-3 sm:px-6 py-2 sm:py-3 flex justify-between items-center shadow-md",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[u.jsx(jn,{to:"/welcome",className:"cursor-pointer",children:u.jsxs("h1",{className:"text-lg sm:text-2xl font-bold gradient-heading flex items-center group z-50 relative",children:[u.jsx(X.span,{className:"material-icons text-red-600 mr-1 sm:mr-2 text-base sm:text-lg",whileHover:{rotate:360},transition:{duration:.5},children:"sports_martial_arts"}),u.jsx("span",{className:"group-hover:text-red-500 transition-colors",children:"CoachT"})]})}),u.jsx("div",{className:"hidden sm:block h-8 w-px bg-red-900/30 mx-2"}),u.jsx("div",{className:"hidden md:block",children:u.jsx(v6e,{className:"ml-2",showSeconds:!1})})]}),u.jsx("div",{className:"flex-1 mx-2 sm:mx-4 max-w-lg",children:u.jsx(X.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:100,damping:15},children:u.jsx(pK,{beltColor:hs.color,beltName:hs.name,beltLevel:hs.level,stretched:!0,username:(as=t==null?void 0:t.username)==null?void 0:as.toUpperCase()})})}),u.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-3",children:[u.jsxs(X.div,{className:"relative group hidden sm:block",whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},children:[u.jsx(y6e,{className:"transition-transform duration-300"}),u.jsx("div",{className:"absolute inset-0 bg-red-500/10 rounded-md scale-105 animate-pulse -z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),u.jsx(jn,{href:"/profile",children:u.jsx(X.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"relative group",children:u.jsxs(Se,{variant:"outline",className:"h-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20 flex items-center px-2 sm:px-3 transition-all duration-300 hover:shadow-red-500/30 hover:shadow-sm",children:[u.jsx(Ru,{className:"h-4 w-4 text-white sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline text-sm text-white font-medium",children:"Profile"})]})})}),u.jsxs(iT,{children:[u.jsx(oT,{asChild:!0,children:u.jsx(X.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:u.jsxs(Se,{variant:"outline",className:"h-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20 flex items-center px-2 sm:px-3",children:[u.jsx(vb,{className:"h-4 w-4 text-white sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline text-sm text-white font-medium",children:"Menu"})]})})}),u.jsxs(mw,{align:"end",className:"w-40 border border-red-600 bg-gray-900",children:[u.jsxs(lp,{className:"cursor-pointer flex items-center text-white hover:bg-red-700/30",onClick:()=>Z(!0),children:[u.jsx(vb,{className:"mr-2 h-4 w-4"}),u.jsx("span",{children:"Settings"})]}),u.jsxs(lp,{className:"cursor-pointer flex items-center text-white hover:bg-red-700/30",onClick:()=>Ie(!0),children:[u.jsx(W2,{className:"mr-2 h-4 w-4"}),u.jsx("span",{children:"Training Tips"})]}),u.jsx(eK,{className:"bg-red-900/30"}),u.jsxs(lp,{className:"cursor-pointer flex items-center text-white hover:bg-red-700/30",onClick:()=>e.mutate(),children:[u.jsx(vk,{className:"mr-2 h-4 w-4"}),u.jsx("span",{children:"Logout"})]})]})]})]})]}),u.jsx("div",{className:"bg-black/70 border-b border-red-900/30 px-3 sm:px-6 py-2 flex justify-center items-center shadow-md overflow-x-auto",children:u.jsxs("div",{className:"w-full max-w-4xl flex justify-between min-w-fit",children:[u.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[u.jsxs(X.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-8 sm:h-10 rounded-full px-2 sm:px-4 py-1 sm:py-2 border border-red-600 bg-transparent hover:bg-red-700/20 flex items-center text-white transition-colors whitespace-nowrap",onClick:()=>Me(!0),children:[u.jsx(YA,{className:"h-3 sm:h-4 w-3 sm:w-4 sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline font-medium text-sm",children:"How it Works"}),u.jsx("span",{className:"sm:hidden font-medium text-xs ml-1",children:"Help"})]}),u.jsxs(X.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-8 sm:h-10 rounded-full px-2 sm:px-4 py-1 sm:py-2 border border-red-600 bg-transparent hover:bg-red-700/20 flex items-center text-white transition-colors whitespace-nowrap",onClick:()=>Ze(!0),children:[u.jsx(Nv,{className:"h-3 sm:h-4 w-3 sm:w-4 sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline font-medium text-sm",children:"Leaderboard"}),u.jsx("span",{className:"sm:hidden font-medium text-xs ml-1",children:"Stats"})]}),u.jsx(jn,{href:"/welcome",children:u.jsxs(X.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-8 sm:h-10 rounded-full px-2 sm:px-4 py-1 sm:py-2 border border-red-600 bg-transparent hover:bg-red-700/20 flex items-center text-white transition-colors whitespace-nowrap",children:[u.jsx(dee,{className:"h-3 sm:h-4 w-3 sm:w-4 sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline font-medium text-sm",children:"View Welcome Page"}),u.jsx("span",{className:"sm:hidden font-medium text-xs ml-1",children:"Home"})]})})]}),u.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[u.jsxs(X.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"h-8 sm:h-10 rounded-full px-2 sm:px-4 py-1 sm:py-2 border border-red-600 bg-transparent hover:bg-red-700/20 flex items-center text-white transition-colors whitespace-nowrap",onClick:Lo,children:[u.jsx(bk,{className:"h-3 sm:h-4 w-3 sm:w-4 sm:mr-2"}),u.jsx("span",{className:"hidden sm:inline font-medium text-sm",children:"Feedback"})]}),u.jsx(Se,{variant:"outline",size:"icon",onClick:zs,className:"h-8 w-8 sm:h-10 sm:w-10 rounded-full border-red-600 bg-transparent hover:bg-red-700/20",children:Q?u.jsx(kk,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"}):u.jsx(wk,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})})]})]})}),u.jsx("main",{className:"flex-1 flex flex-col",children:u.jsxs("div",{className:"flex-1 p-8 md:p-10",children:[l&&u.jsx(NVe,{progress:d,message:"Loading pose detection models..."}),(!o||r==="inactive")&&!f?u.jsx("div",{className:"flex-1 flex items-center justify-center max-w-screen-xl mx-auto w-full h-full",children:u.jsxs("div",{className:"space-y-6 sm:space-y-8 flex flex-col items-center mt-8 sm:mt-16 md:mt-24 px-4 sm:px-0 w-full max-w-lg",children:[u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-center w-full",children:[u.jsxs("h1",{className:"text-2xl sm:text-4xl md:text-5xl font-bold text-white leading-tight",children:["Ready to train, ",u.jsx("span",{className:"gradient-heading",children:(t==null?void 0:t.username)||"User"}),"?"]}),u.jsx(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4 flex justify-center",children:u.jsxs(Se,{onClick:()=>$e(!0),className:"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold py-2 px-4 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center space-x-2",children:[u.jsx(kv,{className:"h-4 w-4"}),u.jsx("span",{children:"Activity"})]})})]}),u.jsx(jze,{}),u.jsxs(X.div,{className:"grid grid-cols-1 gap-4 pt-2 sm:pt-4 relative group w-full max-w-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[u.jsx(jn,{href:"/challenges",children:u.jsxs(X.button,{className:`w-full py-3 sm:py-4 md:py-5 text-base sm:text-lg font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-opacity-50 flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-103 ${ts(dt,"primary")}`,whileTap:{scale:.97},children:[u.jsx(ea,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),u.jsx("span",{className:"whitespace-nowrap",children:"Challenges"})]})}),u.jsx("div",{className:"relative group",children:u.jsxs(X.button,{onClick:en,className:`w-full py-3 sm:py-4 md:py-5 text-base sm:text-lg font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-opacity-50 flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-103 ${ts(dt,"primary")}`,whileTap:{scale:.97},children:[u.jsx(Mf,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),u.jsx("span",{className:"whitespace-nowrap",children:"Start Live Routine"})]})}),u.jsx(jn,{href:"/practice",children:u.jsxs(X.button,{className:`w-full py-3 sm:py-4 md:py-5 text-base sm:text-lg font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-opacity-50 flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-103 ${ts(dt,"primary")}`,whileTap:{scale:.97},children:[u.jsx(z2,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),u.jsx("span",{className:"whitespace-nowrap",children:"Practice Library"})]})}),u.jsx(jn,{href:"/workouts",children:u.jsxs(X.button,{className:`w-full py-3 sm:py-4 md:py-5 text-base sm:text-lg font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-opacity-50 flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-103 ${ts(dt,"primary")}`,whileTap:{scale:.97},children:[u.jsx(z2,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),u.jsx("span",{className:"whitespace-nowrap",children:"Workouts"})]})})]}),u.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"pt-6",children:u.jsxs(Se,{onClick:()=>Z(!0),variant:"outline",className:`px-6 py-3 text-base transition-all duration-300 ease-in-out rounded-lg ${ts(dt,"outline")}`,children:[u.jsx(ZA,{className:"mr-2 h-4 w-4"}),"Theme Settings"]})})]})}):u.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[(o||m!=="camera")&&u.jsx(bMe,{stream:x,isTracking:f,confidenceThreshold:A,modelSelection:F,maxPoses:M,skeletonColor:ae,showSkeleton:z,showPoints:U,showBackground:xe,backgroundOpacity:De,backgroundBlur:ee,sourceType:m,imageElement:C,videoElement:T,mediaUrl:$,showReferenceOverlay:Re,isFullscreenMode:me,onScreenshot:Ht,toggleTracking:An,toggleReferenceOverlay:os,cameraFacing:v,setCameraFacing:S,externalIsRecording:te,onRecordClick:nl,customBackground:It}),m==="camera"&&o&&!l&&u.jsxs("div",{className:"absolute bottom-2 sm:bottom-4 left-2 sm:left-4 bg-black/90 border border-red-900/40 rounded-lg p-3 sm:p-4 shadow-lg z-20 max-w-[calc(100vw-1rem)] sm:max-w-none",children:[u.jsx("h3",{className:`text-sm font-semibold mb-2 ${dt==="sky"?"text-sky-400":dt==="crimson"?"text-red-400":dt==="emerald"?"text-emerald-400":"text-amber-400"}`,children:"Camera Options"}),u.jsx("div",{className:"space-y-3",children:u.jsxs("div",{children:[u.jsx("label",{className:"text-xs text-gray-400 block mb-2",children:"Skeleton Color"}),u.jsx("div",{className:"flex space-x-3 sm:space-x-2",children:["red","blue","green","purple","orange"].map(Oe=>u.jsx("button",{onClick:()=>Ae(Oe),className:`w-8 h-8 sm:w-6 sm:h-6 rounded-full border ${ae===Oe?"border-white border-2":"border-gray-600"} transition-all duration-200 hover:scale-110 active:scale-95`,style:{backgroundColor:Oe==="red"?"#ef4444":Oe==="blue"?"#3b82f6":Oe==="green"?"#10b981":Oe==="purple"?"#8b5cf6":"#f97316"},"aria-label":`Set skeleton color to ${Oe}`},Oe))})]})})]})]}),r==="error"&&o===!1&&u.jsx(SMe,{onRequestPermission:en})]})}),Ot&&He&&u.jsx(Aze,{screenshotData:He,onClose:()=>Yt(!1)}),u.jsx(zi,{open:lt,onOpenChange:Oe=>{Me(Oe),Oe||localStorage.setItem("hasSeenWelcomeGuide","true")},children:u.jsxs(pi,{className:"bg-gradient-to-br from-gray-950 to-black border border-red-600/30 text-white max-w-4xl max-h-[85vh] flex flex-col",children:[u.jsxs(mi,{className:"pb-4 flex-shrink-0",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs(gi,{className:"text-3xl font-bold flex items-center text-red-400",children:[u.jsx("div",{className:"w-10 h-10 bg-red-600 rounded-full flex items-center justify-center mr-3",children:u.jsx(YA,{className:"h-5 w-5 text-white"})}),"How CoachT Works"]}),u.jsx("button",{onClick:()=>Me(!1),className:"p-2 hover:bg-red-600/20 rounded-full transition-colors border border-red-600/50 hover:border-red-400","aria-label":"Close dialog",children:u.jsx(Lh,{className:"h-6 w-6 text-red-400 hover:text-red-300"})})]}),u.jsx(yo,{className:"text-gray-300 text-base mt-2",children:"Master Taekwondo with AI-powered training. Here's your complete guide."})]}),u.jsx("div",{className:"flex-1 overflow-y-auto pr-2 scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-red-600",children:u.jsxs("div",{className:"space-y-6",children:[u.jsx("div",{className:"bg-gradient-to-r from-red-900/20 to-red-800/10 border border-red-600/30 rounded-xl p-6",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-12 h-12 bg-red-600 rounded-full flex items-center justify-center flex-shrink-0",children:u.jsx("span",{className:"text-white font-bold text-lg",children:"1"})}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("h3",{className:"text-2xl font-bold text-red-400 mb-3 flex items-center",children:[u.jsx(Mf,{className:"mr-3 h-6 w-6"}),"Start Live Training"]}),u.jsx("p",{className:"text-gray-200 text-lg mb-4",children:'Click "Start Live Routine" to begin AI-powered pose tracking with your camera.'}),u.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-red-300 mb-2",children:"🎥 Camera Setup"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Allow camera access when prompted. Position yourself 3-6 feet from your device."})]}),u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-red-300 mb-2",children:"⚡ Real-Time Analysis"}),u.jsx("p",{className:"text-sm text-gray-300",children:"AI tracks your movements and provides instant visual feedback on your form."})]})]})]})]})}),u.jsx("div",{className:"bg-gradient-to-r from-blue-900/20 to-blue-800/10 border border-blue-600/30 rounded-xl p-6",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:u.jsx("span",{className:"text-white font-bold text-lg",children:"2"})}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("h3",{className:"text-2xl font-bold text-blue-400 mb-3 flex items-center",children:[u.jsx(z2,{className:"mr-3 h-6 w-6"}),"Practice Library"]}),u.jsx("p",{className:"text-gray-200 text-lg mb-4",children:"Explore and master individual Taekwondo techniques with guided practice sessions."}),u.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-blue-300 mb-2",children:"📚 Browse Techniques"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Navigate categories to find specific moves, forms, and drills organized by skill level."})]}),u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-blue-300 mb-2",children:"🎯 Focused Training"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Practice individual moves with detailed reference poses and angle analysis."})]})]})]})]})}),u.jsx("div",{className:"bg-gradient-to-r from-purple-900/20 to-purple-800/10 border border-purple-600/30 rounded-xl p-6",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0",children:u.jsx("span",{className:"text-white font-bold text-lg",children:"3"})}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("h3",{className:"text-2xl font-bold text-purple-400 mb-3 flex items-center",children:[u.jsx(bk,{className:"mr-3 h-6 w-6"}),"Get Instant Feedback"]}),u.jsx("p",{className:"text-gray-200 text-lg mb-4",children:"Receive real-time analysis and improve your technique with AI-powered guidance."}),u.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-purple-300 mb-2",children:"🎯 Real-Time Scoring"}),u.jsx("p",{className:"text-sm text-gray-300",children:"See your form accuracy instantly with joint angle analysis and pose comparison."})]}),u.jsxs("div",{className:"bg-black/30 rounded-lg p-4",children:[u.jsx("h4",{className:"font-semibold text-purple-300 mb-2",children:"📧 Share Feedback"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Help improve CoachT by sharing your experience and suggestions with our team."})]})]})]})]})}),u.jsx("div",{className:"bg-gradient-to-r from-amber-900/20 to-amber-800/10 border border-amber-600/30 rounded-xl p-6",children:u.jsxs("div",{className:"flex items-start space-x-4",children:[u.jsx("div",{className:"w-12 h-12 bg-amber-600 rounded-full flex items-center justify-center flex-shrink-0",children:u.jsx(W2,{className:"h-6 w-6 text-white"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-2xl font-bold text-amber-400 mb-3",children:"Pro Tips for Best Results"}),u.jsxs("div",{className:"grid gap-3",children:[u.jsxs("div",{className:"flex items-center space-x-3 bg-black/30 rounded-lg p-3",children:[u.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),u.jsx("p",{className:"text-gray-200",children:"Position yourself 6-8 feet from camera for full-body tracking"})]}),u.jsxs("div",{className:"flex items-center space-x-3 bg-black/30 rounded-lg p-3",children:[u.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),u.jsx("p",{className:"text-gray-200",children:"Train in well-lit area with contrasting background"})]}),u.jsxs("div",{className:"flex items-center space-x-3 bg-black/30 rounded-lg p-3",children:[u.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),u.jsx("p",{className:"text-gray-200",children:"Wear clothing that contrasts with your surroundings"})]}),u.jsxs("div",{className:"flex items-center space-x-3 bg-black/30 rounded-lg p-3",children:[u.jsx("div",{className:"w-2 h-2 bg-amber-400 rounded-full"}),u.jsx("p",{className:"text-gray-200",children:"Start with slower movements to help AI calibration"})]})]})]})]})})]})}),u.jsx(xo,{className:"mt-6 pt-4 border-t border-red-600/30 flex-shrink-0 bg-gradient-to-br from-gray-950 to-black",children:u.jsxs("div",{className:"flex gap-3 w-full",children:[u.jsx(Se,{onClick:()=>Me(!1),variant:"outline",className:"border-red-600/50 text-red-400 hover:bg-red-600/10 hover:border-red-400 px-6 py-3 text-base font-medium rounded-lg transition-colors",children:"Close"}),u.jsx(Se,{onClick:()=>{Me(!1),localStorage.setItem("hasSeenWelcomeGuide","true")},className:"bg-red-600 hover:bg-red-700 text-white px-8 py-3 text-base font-semibold rounded-lg transition-colors flex-1",children:"Got it, Let's Train!"})]})})]})}),u.jsx(zi,{open:je,onOpenChange:Ze,children:u.jsxs(pi,{className:`bg-gray-950 border text-white max-w-3xl ${ts(dt,"outline").split(" ").find(Oe=>Oe.startsWith("border-"))||"border-sky-800"}`,children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:`text-2xl flex items-center ${dt==="sky"?"text-sky-400":dt==="crimson"?"text-red-400":dt==="emerald"?"text-emerald-400":"text-amber-400"}`,children:[u.jsx(Nv,{className:"mr-2 h-5 w-5"}),"Leaderboard"]}),u.jsx(yo,{className:"text-gray-400",children:"See how you rank among other CoachT practitioners"})]}),u.jsx("div",{className:"py-4",children:u.jsx(x6e,{currentUsername:t==null?void 0:t.username})}),u.jsx(xo,{children:u.jsx(Se,{onClick:()=>Ze(!1),className:`text-white ${ts(dt,"primary")}`,children:"Close"})})]})}),u.jsx(zi,{open:Ye,onOpenChange:Ie,children:u.jsxs(pi,{className:`bg-gray-950 border text-white ${ts(dt,"outline").split(" ").find(Oe=>Oe.startsWith("border-"))||"border-sky-800"}`,children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:`text-2xl flex items-center ${dt==="sky"?"text-sky-400":dt==="crimson"?"text-red-400":dt==="emerald"?"text-emerald-400":"text-amber-400"}`,children:[u.jsx(W2,{className:"mr-2 h-5 w-5"}),"Training Tips"]}),u.jsx(yo,{className:"text-gray-400",children:"Expert advice to help improve your technique"})]}),u.jsxs("div",{className:"grid gap-4 py-4",children:[u.jsxs("div",{className:"bg-black/50 p-4 rounded-lg border border-red-900/30",children:[u.jsx("h3",{className:"font-bold text-lg mb-2",children:"Stance Tips"}),u.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-gray-300",children:[u.jsx("li",{children:"Keep your knees bent at the proper angle"}),u.jsx("li",{children:"Distribute weight evenly between feet"}),u.jsx("li",{children:"Maintain straight back and proper posture"})]})]}),u.jsxs("div",{className:"bg-black/50 p-4 rounded-lg border border-red-900/30",children:[u.jsx("h3",{className:"font-bold text-lg mb-2",children:"Kick Techniques"}),u.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-gray-300",children:[u.jsx("li",{children:"Chamber your knee properly before extending"}),u.jsx("li",{children:"Keep your supporting foot firmly planted"}),u.jsx("li",{children:"Focus on hip rotation for power"})]})]}),u.jsxs("div",{className:"bg-black/50 p-4 rounded-lg border border-red-900/30",children:[u.jsx("h3",{className:"font-bold text-lg mb-2",children:"Training Consistency"}),u.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-gray-300",children:[u.jsx("li",{children:"Train at least 3-4 times per week"}),u.jsx("li",{children:"Balance technical practice with conditioning"}),u.jsx("li",{children:"Record and review your movements regularly"})]})]})]}),u.jsx(xo,{children:u.jsx(Se,{onClick:()=>Ie(!1),className:`text-white ${ts(dt,"primary")}`,children:"Got it"})})]})}),u.jsx(zi,{open:B,onOpenChange:Z,children:u.jsxs(pi,{className:`bg-gray-950 border text-white max-w-lg ${ts(dt,"outline").split(" ").find(Oe=>Oe.startsWith("border-"))||"border-sky-800"}`,children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:`text-2xl flex items-center ${dt==="sky"?"text-sky-400":dt==="crimson"?"text-red-400":dt==="emerald"?"text-emerald-400":"text-amber-400"}`,children:[u.jsx(ZA,{className:"mr-3 h-6 w-6"}),"Customize UI Theme"]}),u.jsx(yo,{className:"text-gray-400 mt-1",children:"Change the primary color theme for buttons and accents."})]}),u.jsx("div",{className:"grid gap-6 py-6",children:u.jsxs("div",{className:"space-y-3",children:[u.jsx("h3",{className:"font-semibold text-lg text-gray-200",children:"Select a Color Theme:"}),["sky","crimson","emerald","amber"].map(Oe=>u.jsxs(Se,{onClick:()=>{At(Oe),localStorage.setItem("buttonTheme",Oe)},className:`w-full justify-start py-3 px-4 text-base rounded-md transition-all duration-200 ease-in-out ${ts(Oe,"primary")} ${dt===Oe?"ring-2 ring-offset-2 ring-offset-gray-950 "+(Oe==="sky"?"ring-sky-400":Oe==="crimson"?"ring-red-400":Oe==="emerald"?"ring-emerald-400":"ring-amber-400"):""}`,children:[u.jsx("span",{className:`w-4 h-4 rounded-full mr-3 ${Oe==="sky"?"bg-sky-500":Oe==="crimson"?"bg-red-500":Oe==="emerald"?"bg-emerald-500":"bg-amber-500"}`}),Oe.charAt(0).toUpperCase()+Oe.slice(1)]},Oe))]})}),u.jsx(xo,{className:"mt-2",children:u.jsx(Se,{onClick:()=>Z(!1),className:`px-6 py-2 text-base font-semibold ${ts(dt,"primary")}`,children:"Done"})})]})}),t&&we&&u.jsx(zi,{open:we,onOpenChange:de,children:u.jsxs(pi,{className:`bg-gray-950 border text-white max-w-md ${ts(dt,"outline").split(" ").find(Oe=>Oe.startsWith("border-"))||"border-sky-800"}`,children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:`text-2xl flex items-center ${dt==="sky"?"text-sky-400":dt==="crimson"?"text-red-400":dt==="emerald"?"text-emerald-400":"text-amber-400"}`,children:[u.jsx(mee,{className:"mr-3 h-6 w-6"}),"Mobile Device Detected"]}),u.jsx(yo,{className:"text-gray-400 mt-2",children:"For the best experience with CoachT, including optimal pose tracking and interface usability, we recommend using a tablet or laptop/desktop computer."})]}),u.jsx("div",{className:"py-4 text-gray-300",children:u.jsx("p",{children:"While CoachT may function on mobile devices, its features are optimized for larger screens. You might experience layout issues or reduced performance on a smaller screen."})}),u.jsx(xo,{className:"mt-2",children:u.jsx(Se,{onClick:()=>de(!1),className:`text-white px-6 py-2 text-base ${ts(dt,"primary")}`,children:"Understood, Continue"})})]})}),(!o||r==="inactive")&&!f&&Ee.length>0&&u.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",style:{zIndex:-1},children:[u.jsxs("div",{className:"flex h-full items-center justify-between",children:[u.jsx("div",{className:"hidden md:flex flex-col ml-8 space-y-8",style:{position:"absolute",left:"2rem",top:"50%",transform:"translateY(-50%)"},children:Ee.slice(0,Math.min(3,Math.ceil(Ee.length/2))).map((Oe,_t)=>u.jsx(X.div,{className:"picture-frame pointer-events-auto",initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{delay:.2+_t*.1},whileHover:{scale:1.05,rotate:_t%2===0?-8:-4},style:{transform:`rotate(${_t%2===0?-10:-5}deg)`,width:"180px",height:"200px",transformOrigin:"center center"},children:u.jsxs("div",{className:"relative w-full h-full",children:[u.jsx("div",{className:"absolute inset-0 border-[12px] rounded-lg shadow-[0_8px_30px_rgb(0,0,0,0.6)]",style:{borderImage:"linear-gradient(45deg, #0c2a4d 0%, #1f6bac 50%, #0c2a4d 100%) 1",boxShadow:"inset 0 0 20px rgba(0,0,0,0.8), 0 10px 25px rgba(0,0,0,0.7)"}}),u.jsx("div",{className:"absolute inset-[12px] border-2 border-sky-900/40 backdrop-blur-sm bg-white/5 rounded"}),u.jsx("div",{className:"absolute top-[-5px] left-[-5px] w-8 h-8 bg-gradient-to-br from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform -rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute top-[-5px] right-[-5px] w-8 h-8 bg-gradient-to-bl from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute bottom-[-5px] left-[-5px] w-8 h-8 bg-gradient-to-tr from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute bottom-[-5px] right-[-5px] w-8 h-8 bg-gradient-to-tl from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform -rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("img",{src:Oe,alt:"Gallery",className:"absolute inset-[16px] object-cover w-[calc(100%-32px)] h-[calc(100%-32px)]"}),u.jsx("div",{className:"absolute inset-[16px] bg-gradient-to-br from-white/20 to-transparent pointer-events-none"}),u.jsx("div",{className:"absolute inset-[16px] overflow-hidden rounded",children:u.jsx("div",{className:"absolute top-0 left-[-100%] w-[300%] h-[50%] bg-gradient-to-br from-white/30 to-transparent transform rotate-45 opacity-60"})})]})},`left-${_t}`))}),u.jsx("div",{className:"hidden md:flex flex-col mr-8 space-y-8",style:{position:"absolute",right:"2rem",top:"50%",transform:"translateY(-50%)"},children:Ee.slice(Math.ceil(Ee.length/2),Math.min(6,Ee.length)).map((Oe,_t)=>u.jsx(X.div,{className:"picture-frame pointer-events-auto",initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{delay:.3+_t*.1},whileHover:{scale:1.05,rotate:_t%2===0?8:4},style:{transform:`rotate(${_t%2===0?10:5}deg)`,width:"180px",height:"200px",transformOrigin:"center center"},children:u.jsxs("div",{className:"relative w-full h-full",children:[u.jsx("div",{className:"absolute inset-0 border-[12px] rounded-lg shadow-[0_8px_30px_rgb(0,0,0,0.6)]",style:{borderImage:"linear-gradient(45deg, #0c2a4d 0%, #1f6bac 50%, #0c2a4d 100%) 1",boxShadow:"inset 0 0 20px rgba(0,0,0,0.8), 0 10px 25px rgba(0,0,0,0.7)"}}),u.jsx("div",{className:"absolute inset-[12px] border-2 border-sky-900/40 backdrop-blur-sm bg-white/5 rounded"}),u.jsx("div",{className:"absolute top-[-5px] left-[-5px] w-8 h-8 bg-gradient-to-br from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform -rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute top-[-5px] right-[-5px] w-8 h-8 bg-gradient-to-bl from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute bottom-[-5px] left-[-5px] w-8 h-8 bg-gradient-to-tr from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("div",{className:"absolute bottom-[-5px] right-[-5px] w-8 h-8 bg-gradient-to-tl from-sky-900 to-sky-700 rounded-full flex items-center justify-center transform -rotate-45",children:u.jsx("span",{className:"text-white text-xs",children:"◆"})}),u.jsx("img",{src:Oe,alt:"Gallery",className:"absolute inset-[16px] object-cover w-[calc(100%-32px)] h-[calc(100%-32px)]"}),u.jsx("div",{className:"absolute inset-[16px] bg-gradient-to-br from-white/20 to-transparent pointer-events-none"}),u.jsx("div",{className:"absolute inset-[16px] overflow-hidden rounded",children:u.jsx("div",{className:"absolute top-0 left-[-100%] w-[300%] h-[50%] bg-gradient-to-br from-white/30 to-transparent transform rotate-45 opacity-60"})})]})},`right-${_t}`))})]}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-40 overflow-hidden",children:u.jsxs("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",children:[u.jsxs("defs",{children:[u.jsxs("linearGradient",{id:"grad1",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[u.jsx("stop",{offset:"0%",stopColor:"#ff3366",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0;0.3;0",dur:"10s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"30%",stopColor:"#4f6df5",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.3;0.6;0.3",dur:"10s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"60%",stopColor:"#11d3f3",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.6;0.9;0.6",dur:"10s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"90%",stopColor:"#ff9933",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.9;1.0;0.9",dur:"10s",repeatCount:"indefinite"})})]}),u.jsxs("linearGradient",{id:"grad2",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[u.jsx("stop",{offset:"0%",stopColor:"#11d3f3",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0;0.3;0",dur:"8s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"30%",stopColor:"#ff9933",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.3;0.6;0.3",dur:"8s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"60%",stopColor:"#ff3366",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.6;0.9;0.6",dur:"8s",repeatCount:"indefinite"})}),u.jsx("stop",{offset:"90%",stopColor:"#4f6df5",stopOpacity:"0.8",children:u.jsx("animate",{attributeName:"offset",values:"0.9;1.0;0.9",dur:"8s",repeatCount:"indefinite"})})]})]}),u.jsx("path",{d:"M0,40 Q250,5 500,40 T1000,40 T1500,40 T2000,40 T2500,40 V100 H0 V40",fill:"url(#grad1)",children:u.jsx("animate",{attributeName:"d",values:`M0,40 Q250,5 500,40 T1000,40 T1500,40 T2000,40 T2500,40 V100 H0 V40;
                          M0,40 Q250,20 500,35 T1000,35 T1500,45 T2000,30 T2500,40 V100 H0 V40;
                          M0,40 Q250,40 500,20 T1000,30 T1500,25 T2000,40 T2500,40 V100 H0 V40;
                          M0,40 Q250,5 500,40 T1000,40 T1500,40 T2000,40 T2500,40 V100 H0 V40`,dur:"20s",repeatCount:"indefinite"})}),u.jsx("path",{d:"M0,65 Q250,45 500,65 T1000,65 T1500,65 T2000,65 T2500,65 V100 H0 V65",fill:"url(#grad2)",children:u.jsx("animate",{attributeName:"d",values:`M0,65 Q250,45 500,65 T1000,65 T1500,65 T2000,65 T2500,65 V100 H0 V65;
                          M0,65 Q250,75 500,60 T1000,60 T1500,70 T2000,55 T2500,65 V100 H0 V65;
                          M0,65 Q250,65 500,45 T1000,55 T1500,50 T2000,65 T2500,65 V100 H0 V65;
                          M0,65 Q250,45 500,65 T1000,65 T1500,65 T2000,65 T2500,65 V100 H0 V65`,dur:"15s",repeatCount:"indefinite"})}),u.jsx("path",{d:"M0,80 Q250,105 500,80 T1000,80 T1500,80 T2000,80 T2500,80 V100 H0 V80",fill:"url(#grad1)",opacity:"0.6",children:u.jsx("animate",{attributeName:"d",values:`M0,80 Q250,105 500,80 T1000,80 T1500,80 T2000,80 T2500,80 V100 H0 V80;
                          M0,80 Q250,70 500,80 T1000,90 T1500,75 T2000,85 T2500,80 V100 H0 V80;
                          M0,80 Q250,85 500,70 T1000,75 T1500,90 T2000,80 T2500,80 V100 H0 V80;
                          M0,80 Q250,105 500,80 T1000,80 T1500,80 T2000,80 T2500,80 V100 H0 V80`,dur:"25s",repeatCount:"indefinite"})}),u.jsxs("circle",{cx:"10%",cy:"85%",r:"5",fill:"#ff3366",children:[u.jsx("animate",{attributeName:"cx",values:"10%;90%;10%",dur:"20s",repeatCount:"indefinite"}),u.jsx("animate",{attributeName:"opacity",values:"0.8;0.4;0.8",dur:"5s",repeatCount:"indefinite"})]}),u.jsxs("circle",{cx:"20%",cy:"75%",r:"3",fill:"#4f6df5",children:[u.jsx("animate",{attributeName:"cx",values:"20%;70%;20%",dur:"15s",repeatCount:"indefinite"}),u.jsx("animate",{attributeName:"opacity",values:"0.7;0.3;0.7",dur:"7s",repeatCount:"indefinite"})]}),u.jsxs("circle",{cx:"80%",cy:"80%",r:"6",fill:"#11d3f3",children:[u.jsx("animate",{attributeName:"cx",values:"80%;30%;80%",dur:"25s",repeatCount:"indefinite"}),u.jsx("animate",{attributeName:"opacity",values:"0.6;0.2;0.6",dur:"8s",repeatCount:"indefinite"})]}),u.jsxs("circle",{cx:"65%",cy:"90%",r:"4",fill:"#ff9933",children:[u.jsx("animate",{attributeName:"cx",values:"65%;25%;65%",dur:"18s",repeatCount:"indefinite"}),u.jsx("animate",{attributeName:"opacity",values:"0.5;0.3;0.5",dur:"6s",repeatCount:"indefinite"})]})]})})]}),Vs&&u.jsx(iu,{expression:"happy",message:"Welcome to CoachT! I'm your AI coach Shifu. Let me guide you through your training journey!",position:"top-right",onDismiss:Bo,showDelay:0,autoShow:!0}),lr&&u.jsx(iu,{expression:"pointing",message:"Practice your round kicks in the Practice Library! Perfect for building fundamentals.",position:"top-right",pointingDirection:"left",onDismiss:()=>{qn(!1),wa()},showDelay:0,autoShow:!0}),Ei&&u.jsx(iu,{expression:"pointing",message:"Ready for a challenge? Test your skills and compete with other martial artists!",position:"top-right",pointingDirection:"left",onDismiss:()=>is(!1),showDelay:0,autoShow:!0}),u.jsx(zi,{open:pe,onOpenChange:$e,children:u.jsxs(pi,{className:"bg-gradient-to-br from-gray-950 to-black border border-blue-600/30 text-white max-w-2xl max-h-[85vh] overflow-hidden",children:[u.jsx(mi,{children:u.jsxs(gi,{className:"text-xl font-bold flex items-center text-blue-400",children:[u.jsx(kv,{className:"w-6 h-6 mr-3"}),"Activity Dashboard"]})}),u.jsx("div",{className:"space-y-4 overflow-y-auto pr-2",style:{maxHeight:"calc(85vh - 120px)"},children:Te?u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"bg-gradient-to-r from-blue-900/40 to-purple-900/40 rounded-lg p-4 border border-blue-600/20",children:[u.jsxs("h3",{className:"text-lg font-semibold text-blue-300 mb-3 flex items-center",children:[u.jsx(Mh,{className:"w-5 h-5 mr-2"}),"Current Session"]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"bg-black/40 rounded-lg p-3",children:[u.jsx("div",{className:"text-2xl font-bold text-white",children:Te.sessionTime}),u.jsx("div",{className:"text-blue-300 text-sm",children:"Minutes Today"})]}),u.jsxs("div",{className:"bg-black/40 rounded-lg p-3",children:[u.jsx("div",{className:"text-2xl font-bold text-white",children:Te.currentStreak}),u.jsx("div",{className:"text-blue-300 text-sm",children:"Day Streak"})]})]})]}),Te.lastActivity&&u.jsxs("div",{className:"bg-gradient-to-r from-green-900/40 to-blue-900/40 rounded-lg p-4 border border-green-600/20",children:[u.jsxs("h3",{className:"text-lg font-semibold text-green-300 mb-3 flex items-center",children:[u.jsx(Mf,{className:"w-5 h-5 mr-2"}),"Latest Activity"]}),u.jsxs("div",{className:"bg-black/40 rounded-lg p-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("span",{className:"font-semibold text-white",children:Te.lastActivity.title}),u.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Te.lastActivity.status==="completed"?"bg-green-600/20 text-green-300":Te.lastActivity.status==="started"?"bg-blue-600/20 text-blue-300":Te.lastActivity.status==="paused"?"bg-yellow-600/20 text-yellow-300":"bg-red-600/20 text-red-300"}`,children:Te.lastActivity.status})]}),u.jsx("div",{className:"text-gray-400 text-sm mb-2",children:Te.lastActivity.details}),u.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[u.jsxs("span",{children:["Type: ",Te.lastActivity.type]}),u.jsx("span",{children:Te.lastActivity.startTime.toLocaleTimeString()})]}),Te.lastActivity.accuracy&&u.jsxs("div",{className:"mt-2",children:[u.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["Accuracy: ",Te.lastActivity.accuracy,"%"]}),u.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:u.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full",style:{width:`${Te.lastActivity.accuracy}%`}})})]})]})]}),Te.recentActivities.length>0&&u.jsxs("div",{className:"bg-gradient-to-r from-purple-900/40 to-pink-900/40 rounded-lg p-4 border border-purple-600/20",children:[u.jsxs("h3",{className:"text-lg font-semibold text-purple-300 mb-3 flex items-center",children:[u.jsx(Nv,{className:"w-5 h-5 mr-2"}),"Recent Activities"]}),u.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Te.recentActivities.slice(0,5).map(Oe=>u.jsxs("div",{className:"bg-black/40 rounded-lg p-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-1",children:[u.jsx("span",{className:"font-medium text-white text-sm",children:Oe.title}),u.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Oe.status==="completed"?"bg-green-600/20 text-green-300":Oe.status==="started"?"bg-blue-600/20 text-blue-300":Oe.status==="paused"?"bg-yellow-600/20 text-yellow-300":"bg-red-600/20 text-red-300"}`,children:Oe.status})]}),u.jsxs("div",{className:"text-xs text-gray-400",children:[Oe.type," • ",Oe.startTime.toLocaleDateString()]})]},Oe.id))})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.strengths.length>0&&u.jsxs("div",{className:"bg-gradient-to-r from-emerald-900/40 to-green-900/40 rounded-lg p-4 border border-emerald-600/20",children:[u.jsxs("h3",{className:"text-lg font-semibold text-emerald-300 mb-3 flex items-center",children:[u.jsx(jg,{className:"w-5 h-5 mr-2"}),"Strengths"]}),u.jsx("div",{className:"space-y-2",children:Te.strengths.slice(0,3).map((Oe,_t)=>u.jsx("div",{className:"bg-black/40 rounded-lg p-2",children:u.jsx("span",{className:"text-emerald-200 text-sm",children:Oe})},_t))})]}),Te.weakAreas.length>0&&u.jsxs("div",{className:"bg-gradient-to-r from-amber-900/40 to-orange-900/40 rounded-lg p-4 border border-amber-600/20",children:[u.jsxs("h3",{className:"text-lg font-semibold text-amber-300 mb-3 flex items-center",children:[u.jsx(ea,{className:"w-5 h-5 mr-2"}),"Focus Areas"]}),u.jsx("div",{className:"space-y-2",children:Te.weakAreas.slice(0,3).map((Oe,_t)=>u.jsx("div",{className:"bg-black/40 rounded-lg p-2",children:u.jsx("span",{className:"text-amber-200 text-sm",children:Oe})},_t))})]})]}),u.jsxs("div",{className:"bg-gradient-to-r from-red-900/40 to-orange-900/40 rounded-lg p-4 border border-red-600/20",children:[u.jsx("h3",{className:"text-lg font-semibold text-red-300 mb-3",children:"Quick Actions"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[u.jsxs(Se,{onClick:()=>{oi("practice","New Practice Session","started","Starting a new practice session"),$e(!1)},className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg flex items-center justify-center space-x-2",children:[u.jsx(Mf,{className:"w-4 h-4"}),u.jsx("span",{children:"Start Practice"})]}),u.jsxs(Se,{onClick:()=>{oi("challenge","New Challenge","started","Taking on a new challenge"),$e(!1)},className:"bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg flex items-center justify-center space-x-2",children:[u.jsx(ea,{className:"w-4 h-4"}),u.jsx("span",{children:"Start Challenge"})]})]}),u.jsxs("div",{className:"border-t border-red-600/20 pt-3",children:[u.jsx("h4",{className:"text-sm font-medium text-red-200 mb-2",children:"Demo Context Tracking:"}),u.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[u.jsx(Se,{onClick:()=>{Xs(),setTimeout(()=>$e(!1),500)},className:"bg-purple-600 hover:bg-purple-700 text-white py-1 px-3 rounded text-xs",children:"🥋 Simulate Practice (Round Kicks)"}),u.jsx(Se,{onClick:()=>{Ii(),setTimeout(()=>$e(!1),500)},className:"bg-yellow-600 hover:bg-yellow-700 text-white py-1 px-3 rounded text-xs",children:"⚡ Simulate Challenge (Speed Test)"}),u.jsx(Se,{onClick:()=>{sl(),setTimeout(()=>$e(!1),500)},className:"bg-gray-600 hover:bg-gray-700 text-white py-1 px-3 rounded text-xs",children:"⏸️ Simulate Paused Workout"})]}),u.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Try these demos, then chat with Shifu to see context awareness!"})]})]})]}):u.jsxs("div",{className:"text-center py-8",children:[u.jsx(kv,{className:"w-16 h-16 mx-auto text-gray-500 mb-4"}),u.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"No Activity Data"}),u.jsx("p",{className:"text-gray-500",children:"Start training to see your activity dashboard!"})]})})]})}),u.jsx(Dze,{position:"bottom-right",autoShow:!0,showDelay:3e3,size:"medium"})]})}function ds(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function Yu(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}const mK=6048e5,S6e=864e5,iv=43200,b4=1440;let C6e={};function Xx(){return C6e}function K0(t,e){var a,l,c,d;const n=Xx(),s=(e==null?void 0:e.weekStartsOn)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((d=(c=n.locale)==null?void 0:c.options)==null?void 0:d.weekStartsOn)??0,r=ds(t),i=r.getDay(),o=(i<s?7:0)+i-s;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function gw(t){return K0(t,{weekStartsOn:1})}function gK(t){const e=ds(t),n=e.getFullYear(),s=Yu(t,0);s.setFullYear(n+1,0,4),s.setHours(0,0,0,0);const r=gw(s),i=Yu(t,0);i.setFullYear(n,0,4),i.setHours(0,0,0,0);const o=gw(i);return e.getTime()>=r.getTime()?n+1:e.getTime()>=o.getTime()?n:n-1}function w4(t){const e=ds(t);return e.setHours(0,0,0,0),e}function xw(t){const e=ds(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function k6e(t,e){const n=w4(t),s=w4(e),r=+n-xw(n),i=+s-xw(s);return Math.round((r-i)/S6e)}function N6e(t){const e=gK(t),n=Yu(t,0);return n.setFullYear(e,0,4),n.setHours(0,0,0,0),gw(n)}function Wv(t,e){const n=ds(t),s=ds(e),r=n.getTime()-s.getTime();return r<0?-1:r>0?1:r}function T6e(t){return Yu(t,Date.now())}function _6e(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function aT(t){if(!_6e(t)&&typeof t!="number")return!1;const e=ds(t);return!isNaN(Number(e))}function E6e(t,e){const n=ds(t),s=ds(e),r=n.getFullYear()-s.getFullYear(),i=n.getMonth()-s.getMonth();return r*12+i}function $6e(t){return e=>{const s=(t?Math[t]:Math.trunc)(e);return s===0?0:s}}function I6e(t,e){return+ds(t)-+ds(e)}function R6e(t){const e=ds(t);return e.setHours(23,59,59,999),e}function P6e(t){const e=ds(t),n=e.getMonth();return e.setFullYear(e.getFullYear(),n+1,0),e.setHours(23,59,59,999),e}function A6e(t){const e=ds(t);return+R6e(e)==+P6e(e)}function j6e(t,e){const n=ds(t),s=ds(e),r=Wv(n,s),i=Math.abs(E6e(n,s));let o;if(i<1)o=0;else{n.getMonth()===1&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-r*i);let a=Wv(n,s)===-r;A6e(ds(t))&&i===1&&Wv(t,s)===1&&(a=!1),o=r*(i-Number(a))}return o===0?0:o}function D6e(t,e,n){const s=I6e(t,e)/1e3;return $6e(n==null?void 0:n.roundingMethod)(s)}function O6e(t){const e=ds(t),n=Yu(t,0);return n.setFullYear(e.getFullYear(),0,1),n.setHours(0,0,0,0),n}const F6e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},M6e=(t,e,n)=>{let s;const r=F6e[t];return typeof r=="string"?s=r:e===1?s=r.one:s=r.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function tC(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const L6e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},B6e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},V6e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},z6e={date:tC({formats:L6e,defaultWidth:"full"}),time:tC({formats:B6e,defaultWidth:"full"}),dateTime:tC({formats:V6e,defaultWidth:"full"})},W6e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},U6e=(t,e,n,s)=>W6e[t];function Zm(t){return(e,n)=>{const s=n!=null&&n.context?String(n.context):"standalone";let r;if(s==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,a=n!=null&&n.width?String(n.width):o;r=t.formattingValues[a]||t.formattingValues[o]}else{const o=t.defaultWidth,a=n!=null&&n.width?String(n.width):t.defaultWidth;r=t.values[a]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return r[i]}}const H6e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},G6e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},K6e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},q6e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},X6e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Y6e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Q6e=(t,e)=>{const n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Z6e={ordinalNumber:Q6e,era:Zm({values:H6e,defaultWidth:"wide"}),quarter:Zm({values:G6e,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Zm({values:K6e,defaultWidth:"wide"}),day:Zm({values:q6e,defaultWidth:"wide"}),dayPeriod:Zm({values:X6e,defaultWidth:"wide",formattingValues:Y6e,defaultFormattingWidth:"wide"})};function Jm(t){return(e,n={})=>{const s=n.width,r=s&&t.matchPatterns[s]||t.matchPatterns[t.defaultMatchWidth],i=e.match(r);if(!i)return null;const o=i[0],a=s&&t.parsePatterns[s]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(a)?eUe(a,h=>h.test(o)):J6e(a,h=>h.test(o));let c;c=t.valueCallback?t.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;const d=e.slice(o.length);return{value:c,rest:d}}}function J6e(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function eUe(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function tUe(t){return(e,n={})=>{const s=e.match(t.matchPattern);if(!s)return null;const r=s[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=n.valueCallback?n.valueCallback(o):o;const a=e.slice(r.length);return{value:o,rest:a}}}const nUe=/^(\d+)(th|st|nd|rd)?/i,sUe=/\d+/i,rUe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},iUe={any:[/^b/i,/^(a|c)/i]},oUe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},aUe={any:[/1/i,/2/i,/3/i,/4/i]},lUe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},cUe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},uUe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},dUe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},hUe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},fUe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},pUe={ordinalNumber:tUe({matchPattern:nUe,parsePattern:sUe,valueCallback:t=>parseInt(t,10)}),era:Jm({matchPatterns:rUe,defaultMatchWidth:"wide",parsePatterns:iUe,defaultParseWidth:"any"}),quarter:Jm({matchPatterns:oUe,defaultMatchWidth:"wide",parsePatterns:aUe,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Jm({matchPatterns:lUe,defaultMatchWidth:"wide",parsePatterns:cUe,defaultParseWidth:"any"}),day:Jm({matchPatterns:uUe,defaultMatchWidth:"wide",parsePatterns:dUe,defaultParseWidth:"any"}),dayPeriod:Jm({matchPatterns:hUe,defaultMatchWidth:"any",parsePatterns:fUe,defaultParseWidth:"any"})},xK={code:"en-US",formatDistance:M6e,formatLong:z6e,formatRelative:U6e,localize:Z6e,match:pUe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function mUe(t){const e=ds(t);return k6e(e,O6e(e))+1}function gUe(t){const e=ds(t),n=+gw(e)-+N6e(e);return Math.round(n/mK)+1}function yK(t,e){var d,h,f,p;const n=ds(t),s=n.getFullYear(),r=Xx(),i=(e==null?void 0:e.firstWeekContainsDate)??((h=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??r.firstWeekContainsDate??((p=(f=r.locale)==null?void 0:f.options)==null?void 0:p.firstWeekContainsDate)??1,o=Yu(t,0);o.setFullYear(s+1,0,i),o.setHours(0,0,0,0);const a=K0(o,e),l=Yu(t,0);l.setFullYear(s,0,i),l.setHours(0,0,0,0);const c=K0(l,e);return n.getTime()>=a.getTime()?s+1:n.getTime()>=c.getTime()?s:s-1}function xUe(t,e){var a,l,c,d;const n=Xx(),s=(e==null?void 0:e.firstWeekContainsDate)??((l=(a=e==null?void 0:e.locale)==null?void 0:a.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((d=(c=n.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??1,r=yK(t,e),i=Yu(t,0);return i.setFullYear(r,0,s),i.setHours(0,0,0,0),K0(i,e)}function yUe(t,e){const n=ds(t),s=+K0(n,e)-+xUe(n,e);return Math.round(s/mK)+1}function Xn(t,e){const n=t<0?"-":"",s=Math.abs(t).toString().padStart(e,"0");return n+s}const Gc={y(t,e){const n=t.getFullYear(),s=n>0?n:1-n;return Xn(e==="yy"?s%100:s,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Xn(n+1,2)},d(t,e){return Xn(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Xn(t.getHours()%12||12,e.length)},H(t,e){return Xn(t.getHours(),e.length)},m(t,e){return Xn(t.getMinutes(),e.length)},s(t,e){return Xn(t.getSeconds(),e.length)},S(t,e){const n=e.length,s=t.getMilliseconds(),r=Math.trunc(s*Math.pow(10,n-3));return Xn(r,e.length)}},vf={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},S4={G:function(t,e,n){const s=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const s=t.getFullYear(),r=s>0?s:1-s;return n.ordinalNumber(r,{unit:"year"})}return Gc.y(t,e)},Y:function(t,e,n,s){const r=yK(t,s),i=r>0?r:1-r;if(e==="YY"){const o=i%100;return Xn(o,2)}return e==="Yo"?n.ordinalNumber(i,{unit:"year"}):Xn(i,e.length)},R:function(t,e){const n=gK(t);return Xn(n,e.length)},u:function(t,e){const n=t.getFullYear();return Xn(n,e.length)},Q:function(t,e,n){const s=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(s);case"QQ":return Xn(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,e,n){const s=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(s);case"qq":return Xn(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,e,n){const s=t.getMonth();switch(e){case"M":case"MM":return Gc.M(t,e);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,e,n){const s=t.getMonth();switch(e){case"L":return String(s+1);case"LL":return Xn(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,e,n,s){const r=yUe(t,s);return e==="wo"?n.ordinalNumber(r,{unit:"week"}):Xn(r,e.length)},I:function(t,e,n){const s=gUe(t);return e==="Io"?n.ordinalNumber(s,{unit:"week"}):Xn(s,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):Gc.d(t,e)},D:function(t,e,n){const s=mUe(t);return e==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):Xn(s,e.length)},E:function(t,e,n){const s=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,e,n,s){const r=t.getDay(),i=(r-s.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Xn(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(r,{width:"short",context:"formatting"});case"eeee":default:return n.day(r,{width:"wide",context:"formatting"})}},c:function(t,e,n,s){const r=t.getDay(),i=(r-s.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Xn(i,e.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(r,{width:"narrow",context:"standalone"});case"cccccc":return n.day(r,{width:"short",context:"standalone"});case"cccc":default:return n.day(r,{width:"wide",context:"standalone"})}},i:function(t,e,n){const s=t.getDay(),r=s===0?7:s;switch(e){case"i":return String(r);case"ii":return Xn(r,e.length);case"io":return n.ordinalNumber(r,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,e,n){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,e,n){const s=t.getHours();let r;switch(s===12?r=vf.noon:s===0?r=vf.midnight:r=s/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,e,n){const s=t.getHours();let r;switch(s>=17?r=vf.evening:s>=12?r=vf.afternoon:s>=4?r=vf.morning:r=vf.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let s=t.getHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return Gc.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):Gc.H(t,e)},K:function(t,e,n){const s=t.getHours()%12;return e==="Ko"?n.ordinalNumber(s,{unit:"hour"}):Xn(s,e.length)},k:function(t,e,n){let s=t.getHours();return s===0&&(s=24),e==="ko"?n.ordinalNumber(s,{unit:"hour"}):Xn(s,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):Gc.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):Gc.s(t,e)},S:function(t,e){return Gc.S(t,e)},X:function(t,e,n){const s=t.getTimezoneOffset();if(s===0)return"Z";switch(e){case"X":return k4(s);case"XXXX":case"XX":return Id(s);case"XXXXX":case"XXX":default:return Id(s,":")}},x:function(t,e,n){const s=t.getTimezoneOffset();switch(e){case"x":return k4(s);case"xxxx":case"xx":return Id(s);case"xxxxx":case"xxx":default:return Id(s,":")}},O:function(t,e,n){const s=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+C4(s,":");case"OOOO":default:return"GMT"+Id(s,":")}},z:function(t,e,n){const s=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+C4(s,":");case"zzzz":default:return"GMT"+Id(s,":")}},t:function(t,e,n){const s=Math.trunc(t.getTime()/1e3);return Xn(s,e.length)},T:function(t,e,n){const s=t.getTime();return Xn(s,e.length)}};function C4(t,e=""){const n=t>0?"-":"+",s=Math.abs(t),r=Math.trunc(s/60),i=s%60;return i===0?n+String(r):n+String(r)+e+Xn(i,2)}function k4(t,e){return t%60===0?(t>0?"-":"+")+Xn(Math.abs(t)/60,2):Id(t,e)}function Id(t,e=""){const n=t>0?"-":"+",s=Math.abs(t),r=Xn(Math.trunc(s/60),2),i=Xn(s%60,2);return n+r+e+i}const N4=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},vK=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},vUe=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],s=n[1],r=n[2];if(!r)return N4(t,e);let i;switch(s){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",N4(s,e)).replace("{{time}}",vK(r,e))},bUe={p:vK,P:vUe},wUe=/^D+$/,SUe=/^Y+$/,CUe=["D","DD","YY","YYYY"];function kUe(t){return wUe.test(t)}function NUe(t){return SUe.test(t)}function TUe(t,e,n){const s=_Ue(t,e,n);if(console.warn(s),CUe.includes(t))throw new RangeError(s)}function _Ue(t,e,n){const s=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${s} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const EUe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,$Ue=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,IUe=/^'([^]*?)'?$/,RUe=/''/g,PUe=/[a-zA-Z]/;function bK(t,e,n){var d,h,f,p;const s=Xx(),r=s.locale??xK,i=s.firstWeekContainsDate??((h=(d=s.locale)==null?void 0:d.options)==null?void 0:h.firstWeekContainsDate)??1,o=s.weekStartsOn??((p=(f=s.locale)==null?void 0:f.options)==null?void 0:p.weekStartsOn)??0,a=ds(t);if(!aT(a))throw new RangeError("Invalid time value");let l=e.match($Ue).map(m=>{const g=m[0];if(g==="p"||g==="P"){const x=bUe[g];return x(m,r.formatLong)}return m}).join("").match(EUe).map(m=>{if(m==="''")return{isToken:!1,value:"'"};const g=m[0];if(g==="'")return{isToken:!1,value:AUe(m)};if(S4[g])return{isToken:!0,value:m};if(g.match(PUe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:m}});r.localize.preprocessor&&(l=r.localize.preprocessor(a,l));const c={firstWeekContainsDate:i,weekStartsOn:o,locale:r};return l.map(m=>{if(!m.isToken)return m.value;const g=m.value;(NUe(g)||kUe(g))&&TUe(g,e,String(t));const x=S4[g[0]];return x(a,g,r.localize,c)}).join("")}function AUe(t){const e=t.match(IUe);return e?e[1].replace(RUe,"'"):t}function jUe(t,e,n){const s=Xx(),r=(n==null?void 0:n.locale)??s.locale??xK,i=2520,o=Wv(t,e);if(isNaN(o))throw new RangeError("Invalid time value");const a=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:o});let l,c;o>0?(l=ds(e),c=ds(t)):(l=ds(t),c=ds(e));const d=D6e(c,l),h=(xw(c)-xw(l))/1e3,f=Math.round((d-h)/60);let p;if(f<2)return n!=null&&n.includeSeconds?d<5?r.formatDistance("lessThanXSeconds",5,a):d<10?r.formatDistance("lessThanXSeconds",10,a):d<20?r.formatDistance("lessThanXSeconds",20,a):d<40?r.formatDistance("halfAMinute",0,a):d<60?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",1,a):f===0?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",f,a);if(f<45)return r.formatDistance("xMinutes",f,a);if(f<90)return r.formatDistance("aboutXHours",1,a);if(f<b4){const m=Math.round(f/60);return r.formatDistance("aboutXHours",m,a)}else{if(f<i)return r.formatDistance("xDays",1,a);if(f<iv){const m=Math.round(f/b4);return r.formatDistance("xDays",m,a)}else if(f<iv*2)return p=Math.round(f/iv),r.formatDistance("aboutXMonths",p,a)}if(p=j6e(c,l),p<12){const m=Math.round(f/iv);return r.formatDistance("xMonths",m,a)}else{const m=p%12,g=Math.trunc(p/12);return m<3?r.formatDistance("aboutXYears",g,a):m<9?r.formatDistance("overXYears",g,a):r.formatDistance("almostXYears",g+1,a)}}function DUe(t,e){return jUe(t,T6e(t),e)}const q0=b.forwardRef(({className:t,...e},n)=>u.jsx("textarea",{className:Pt("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...e}));q0.displayName="Textarea";function OUe(){const{user:t}=nf(),{toast:e}=Qw(),[n,s]=b.useState(""),[r,i]=b.useState(""),[o,a]=b.useState(!1),[l,c]=b.useState(!1),[d,h]=b.useState(null),{data:f,isLoading:p}=sm({queryKey:["/api/profile"],enabled:!!t}),m=za({mutationFn:async({goal:T,goalDueDate:_})=>await(await aa("POST","/api/goal",{goal:T,goalDueDate:_})).json(),onSuccess:()=>{wv.invalidateQueries({queryKey:["/api/profile"]}),a(!1),e({title:"Goal updated",description:"Your training goal has been updated."})},onError:T=>{e({title:"Failed to update goal",description:T.message,variant:"destructive"})}}),g=za({mutationFn:async T=>await(await aa("POST","/api/gallery",{imageUrl:T})).json(),onSuccess:()=>{wv.invalidateQueries({queryKey:["/api/profile"]}),c(!1),h(null),e({title:"Image added",description:"New image has been added to your gallery."})},onError:T=>{e({title:"Failed to add image",description:T.message,variant:"destructive"})}}),x=za({mutationFn:async T=>await(await aa("DELETE","/api/gallery",{imageUrl:T})).json(),onSuccess:()=>{wv.invalidateQueries({queryKey:["/api/profile"]}),e({title:"Image removed",description:"The image has been removed from your gallery."})},onError:T=>{e({title:"Failed to remove image",description:T.message,variant:"destructive"})}});b.useEffect(()=>{f&&(s(f.goal||""),i(f.goalDueDate||""))},[f]);const y=()=>{m.mutate({goal:n,goalDueDate:r||void 0})},v=T=>{var R;const _=(R=T.target.files)==null?void 0:R[0];if(!_)return;const $=new FileReader;$.onload=A=>{var j;typeof((j=A.target)==null?void 0:j.result)=="string"&&h(A.target.result)},$.readAsDataURL(_)},S=()=>{d&&g.mutate(d)},C=T=>{if(!T)return"Not set";const _=new Date(T);return aT(_)?bK(_,"PPP"):"Invalid date"},k=T=>{if(!T)return"No practice sessions yet";const _=new Date(T);return aT(_)?`Last practice: ${DUe(_,{addSuffix:!0})}`:"Invalid date"};return p?u.jsxs(Ks,{className:"w-full",children:[u.jsxs(No,{children:[u.jsx(To,{className:"text-2xl font-bold animate-pulse bg-secondary h-8 rounded"}),u.jsx(Ua,{className:"animate-pulse bg-secondary h-4 w-3/4 rounded"})]}),u.jsx(rr,{children:u.jsx("div",{className:"animate-pulse bg-secondary h-48 rounded"})})]}):f?u.jsxs(Ks,{className:"w-full bg-background border border-red-900/30",children:[u.jsxs(No,{className:"bg-gradient-to-r from-black to-red-950 text-white",children:[u.jsxs(To,{className:"text-2xl font-bold flex items-center justify-between",children:[u.jsxs("span",{children:["Welcome, ",f.username]}),u.jsxs("span",{className:"text-sm font-normal flex items-center gap-2",children:[u.jsx(Mh,{size:16}),k(f.lastPracticeDate)]})]}),u.jsxs(Ua,{className:"text-gray-300",children:["You have completed ",f.recordingsCount," training sessions"]})]}),u.jsxs(rr,{className:"pt-6 grid gap-6",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[u.jsx(jg,{className:"h-5 w-5 text-red-500"}),"Training Goal"]}),u.jsxs(Se,{variant:"ghost",size:"sm",onClick:()=>a(!o),className:"h-8 px-2 text-primary",children:[u.jsx(gee,{size:16,className:"mr-1"}),o?"Cancel":"Edit"]})]}),o?u.jsxs("div",{className:"space-y-3 mt-2",children:[u.jsx(q0,{value:n,onChange:T=>s(T.target.value),placeholder:"What's your next taekwondo goal?",className:"min-h-[80px]"}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("label",{className:"text-sm text-muted-foreground mb-1 block",children:"Target date (optional):"}),u.jsx(ar,{type:"date",value:r?r.substring(0,10):"",onChange:T=>i(T.target.value)})]}),u.jsx(Se,{onClick:y,disabled:!n||m.isPending,className:"mt-5",children:m.isPending?"Saving...":"Save Goal"})]})]}):u.jsxs("div",{className:"border rounded-md p-3 bg-secondary/20",children:[u.jsx("p",{className:"mb-2",children:f.goal||"No goal set yet. Click Edit to add one!"}),f.goalDueDate&&u.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[u.jsx(Cx,{size:14}),"Target date: ",C(f.goalDueDate)]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[u.jsx(hee,{className:"h-5 w-5 text-red-500"}),"My Gallery"]}),u.jsxs(zi,{children:[u.jsx(Ize,{asChild:!0,children:u.jsxs(Se,{variant:"outline",size:"sm",className:"h-8 px-2",children:[u.jsx(bb,{size:16,className:"mr-1"})," Add Photo"]})}),u.jsxs(pi,{children:[u.jsxs(mi,{children:[u.jsx(gi,{children:"Add Photo to Gallery"}),u.jsx(yo,{children:"Upload a photo from your practice or competition."})]}),u.jsx("div",{className:"grid gap-4 py-4",children:d?u.jsxs("div",{className:"relative",children:[u.jsx("img",{src:d,alt:"Preview",className:"w-full h-auto max-h-80 object-contain rounded-md"}),u.jsx(Se,{size:"sm",variant:"outline",className:"absolute top-2 right-2",onClick:()=>h(null),children:u.jsx(yu,{size:16})})]}):u.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 border-2 border-dashed p-8 rounded-md",children:[u.jsx(C_,{size:40,className:"text-muted-foreground"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to select an image"}),u.jsx(ar,{type:"file",accept:"image/*",onChange:v,className:"mt-2"})]})}),u.jsx(xo,{children:u.jsx(Se,{onClick:S,disabled:!d||g.isPending,children:g.isPending?"Uploading...":"Add to Gallery"})})]})]})]}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mt-2",children:f.galleryImages&&f.galleryImages.length>0?f.galleryImages.map((T,_)=>u.jsxs("div",{className:"relative group aspect-square",children:[u.jsx("img",{src:T,alt:`Gallery item ${_+1}`,className:"w-full h-full object-cover rounded-md"}),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:u.jsxs(Se,{variant:"destructive",size:"sm",onClick:()=>x.mutate(T),className:"h-8 px-2",children:[u.jsx(yu,{size:16,className:"mr-1"})," Remove"]})})]},_)):u.jsx("div",{className:"col-span-full border rounded-md p-4 text-center text-muted-foreground",children:"No photos in your gallery yet. Add your first photo!"})})]})]})]}):u.jsx(Ks,{className:"w-full",children:u.jsxs(No,{children:[u.jsx(To,{className:"text-2xl font-bold",children:"Profile not available"}),u.jsx(Ua,{children:"There was an error loading your profile information."})]})})}const wK=b.createContext(null);function FUe({children:t}){const e=window.matchMedia("(prefers-color-scheme: dark)").matches,[n,s]=b.useState(()=>localStorage.getItem("theme")||(e?"dark":"light")),r=o=>{s(o),localStorage.setItem("theme",o)},i=()=>{r(n==="dark"?"light":"dark")};return b.useEffect(()=>{var l;const o=window.document.documentElement;o.classList.remove(n==="dark"?"light":"dark"),o.classList.add(n);const a=n==="dark"?"#000000":"#ffffff";(l=document.querySelector('meta[name="theme-color"]'))==null||l.setAttribute("content",a)},[n]),b.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),a=l=>{localStorage.getItem("theme")===null&&s(l.matches?"dark":"light")};return o.addEventListener("change",a),()=>o.removeEventListener("change",a)},[]),u.jsx(wK.Provider,{value:{theme:n,isDarkMode:n==="dark",toggleTheme:i,setTheme:r},children:t})}function SK(){const t=b.useContext(wK);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t}function MUe(){const[t,e]=b.useState(0),[n,s]=b.useState(""),{user:r,isLoading:i,logoutMutation:o}=nf(),{isDarkMode:a,toggleTheme:l}=SK(),[,c]=Po();b.useEffect(()=>{const h=()=>{e(window.scrollY)};return window.addEventListener("scroll",h),()=>window.removeEventListener("scroll",h)},[]),b.useEffect(()=>{const h=localStorage.getItem("routineNotes");h&&s(h)},[]),b.useEffect(()=>{localStorage.setItem("routineNotes",n)},[n]);const d=()=>{o.mutate(void 0,{onSuccess:()=>{c("/auth")}})};return b.useEffect(()=>{},[r,i,c]),u.jsxs("div",{className:`min-h-screen flex flex-col overflow-hidden relative ${a?"bg-black":"bg-white"}`,children:[u.jsxs("div",{className:"absolute w-full h-full overflow-hidden z-0",children:[u.jsx("div",{className:"absolute top-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-red-900/10 blur-3xl animate-pulse"}),u.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-red-800/10 blur-3xl animate-pulse",style:{animationDelay:"1s"}}),u.jsx("div",{className:"absolute top-[30%] left-[20%] w-[30%] h-[30%] rounded-full bg-red-700/10 blur-3xl animate-pulse",style:{animationDelay:"2s"}})]}),u.jsx("header",{className:`${a?"bg-black/50":"bg-white/70"} backdrop-blur-sm py-4 border-b ${a?"border-red-900/20":"border-red-300/30"} sticky top-0 z-50`,children:u.jsxs("div",{className:"container mx-auto px-4 flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-10 h-10 text-red-600 mr-2 animate-bounce",style:{animationDuration:"3s"},children:u.jsx("span",{className:"material-icons text-3xl",children:"sports_martial_arts"})}),u.jsxs("div",{className:"relative",children:[a?u.jsxs(u.Fragment,{children:[u.jsx("h1",{className:"text-2xl font-serif font-bold logo-dark absolute",children:"CoachT"}),u.jsx("h1",{className:"text-2xl font-serif font-bold logo-dark-glow absolute",children:"CoachT"})]}):u.jsxs(u.Fragment,{children:[u.jsx("h1",{className:"text-2xl font-serif font-bold logo-light absolute",children:"CoachT"}),u.jsx("h1",{className:"text-2xl font-serif font-bold logo-light-glow absolute",children:"CoachT"})]}),u.jsx("h1",{className:"text-2xl font-serif font-bold invisible",children:"CoachT"})]})]}),u.jsx("button",{onClick:l,className:`p-2 rounded-full ${a?"bg-black/60 border-red-900/50":"bg-white/60 border-red-300/50"} border transition-all duration-300 mr-4`,"aria-label":"Toggle theme",children:a?u.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"rgba(220, 38, 38, 0.8)",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[u.jsx("circle",{cx:"12",cy:"12",r:"5"}),u.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),u.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),u.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),u.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),u.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),u.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),u.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),u.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}):u.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#9f1239",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:u.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})}),u.jsx("div",{className:"flex items-center space-x-4",children:i?u.jsx(yb,{className:"h-5 w-5 animate-spin text-red-500"}):r?u.jsxs(u.Fragment,{children:[u.jsx(jn,{to:"/app",children:u.jsxs("button",{className:"px-5 py-2 rounded-md bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 text-white transition duration-300 flex items-center space-x-1",children:[u.jsx("span",{className:"material-icons text-sm",children:"play_arrow"}),u.jsx("span",{children:"Start Routine"})]})}),u.jsxs("button",{onClick:d,className:"px-5 py-2 rounded-md border border-red-700/50 text-red-500 hover:bg-red-900/20 transition duration-300 flex items-center space-x-1",children:[u.jsx("span",{className:"material-icons text-sm",children:"logout"}),u.jsx("span",{children:"Logout"})]})]}):u.jsxs(u.Fragment,{children:[u.jsx(jn,{to:"/auth",children:u.jsxs("button",{className:"px-5 py-2 rounded-md border border-red-700/50 text-red-500 hover:bg-red-900/20 transition duration-300 flex items-center space-x-1",children:[u.jsx("span",{className:"material-icons text-sm",children:"login"}),u.jsx("span",{children:"Login"})]})}),u.jsx(jn,{to:"/auth?tab=register",children:u.jsxs("button",{className:"px-5 py-2 rounded-md bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 text-white transition duration-300 flex items-center space-x-1",children:[u.jsx("span",{className:"material-icons text-sm",children:"person_add"}),u.jsx("span",{children:"Register"})]})})]})})]})}),u.jsx("main",{className:"flex-1 relative z-10",children:i?u.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:u.jsx(yb,{className:"h-10 w-10 animate-spin text-red-500"})}):r?u.jsxs("div",{className:"container mx-auto px-4 py-8",children:[u.jsx(OUe,{}),u.jsxs("div",{className:"mt-8 w-full bg-black/30 border border-red-900/30 rounded-lg p-4 animate-fade-in",children:[u.jsxs("div",{className:"flex items-center mb-3",children:[u.jsx("span",{className:"material-icons text-red-500 mr-2",children:"edit_note"}),u.jsx("h3",{className:"text-lg font-medium text-red-100",children:"Routine Notes"})]}),u.jsx("textarea",{className:`w-full h-32 bg-black/70 border border-red-900/40 rounded p-3 text-white placeholder-red-200/50
                  focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500`,placeholder:"Write your notes for this training session here...",value:n,onChange:h=>s(h.target.value)})]}),u.jsx("div",{className:"mt-8 flex justify-center",children:u.jsx(jn,{to:"/app",children:u.jsxs("div",{className:"inline-block relative group animate-fade-in",children:[u.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-red-600 to-red-400 rounded-lg blur-xl opacity-70 group-hover:opacity-100 transition duration-1000 animate-pulse"}),u.jsxs("div",{className:"relative px-12 py-6 bg-black border border-red-800/50 rounded-lg leading-none flex items-center",children:[u.jsx("span",{className:"flex items-center space-x-5",children:u.jsx("span",{className:"pr-6 text-gray-100 text-2xl font-bold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent",children:"START TRAINING"})}),u.jsx("span",{className:"material-icons text-red-500 text-xl group-hover:translate-x-2 transition-transform",children:"arrow_forward"})]})]})})})]}):u.jsxs("div",{className:"min-h-[90vh] flex flex-col items-center justify-center relative",children:[u.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[u.jsx("div",{className:"absolute top-[10%] left-[10%] text-red-900/20 animate-float",style:{animationDuration:"15s"},children:u.jsx("span",{className:"material-icons text-[120px]",children:"sports_martial_arts"})}),u.jsx("div",{className:"absolute top-[30%] right-[15%] text-red-900/20 animate-float",style:{animationDuration:"20s",animationDelay:"2s"},children:u.jsx("span",{className:"material-icons text-[80px]",children:"sports_kabaddi"})}),u.jsx("div",{className:"absolute bottom-[20%] left-[20%] text-red-900/20 animate-float",style:{animationDuration:"18s",animationDelay:"1s"},children:u.jsx("span",{className:"material-icons text-[100px]",children:"fitness_center"})})]}),u.jsxs("div",{className:"text-center px-4 py-16 transform transition-all duration-1000",style:{transform:`translateY(${t*.2}px)`,opacity:1-t/500},children:[u.jsxs("div",{className:"animate-fade-in",children:[u.jsxs("div",{className:"relative mb-6",children:[a?u.jsxs(u.Fragment,{children:[u.jsx("h2",{className:"text-7xl sm:text-8xl md:text-9xl font-serif font-bold logo-dark absolute inset-0",children:"CoachT"}),u.jsx("h2",{className:"text-7xl sm:text-8xl md:text-9xl font-serif font-bold logo-dark-glow absolute inset-0",children:"CoachT"})]}):u.jsxs(u.Fragment,{children:[u.jsx("h2",{className:"text-7xl sm:text-8xl md:text-9xl font-serif font-bold logo-light absolute inset-0",children:"CoachT"}),u.jsx("h2",{className:"text-7xl sm:text-8xl md:text-9xl font-serif font-bold logo-light-glow absolute inset-0",children:"CoachT"})]}),u.jsx("h2",{className:"text-7xl sm:text-8xl md:text-9xl font-serif font-bold invisible",children:"CoachT"})]}),u.jsx("p",{className:`text-xl md:text-2xl max-w-2xl mx-auto mb-10 ${a?"text-red-100":"text-red-800"}`,children:"AI-powered martial arts form perfection."})]}),u.jsxs("div",{className:"flex justify-center gap-8 md:gap-16 mb-16 flex-wrap",children:[u.jsxs("div",{className:"feature-icon-container animate-float",style:{animationDelay:"0.2s"},children:[u.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-gradient-to-br from-red-800 to-red-600 flex items-center justify-center shadow-lg shadow-red-900/30 hover:shadow-red-500/30 transition-all duration-300 hover:scale-110",children:u.jsx("span",{className:"material-icons text-white text-3xl md:text-4xl",children:"motion_photos_on"})}),u.jsx("p",{className:`text-sm mt-2 ${a?"text-gray-300":"text-gray-700"}`,children:"Real-time tracking"})]}),u.jsxs("div",{className:"feature-icon-container animate-float",style:{animationDelay:"0.4s"},children:[u.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-gradient-to-br from-red-800 to-red-600 flex items-center justify-center shadow-lg shadow-red-900/30 hover:shadow-red-500/30 transition-all duration-300 hover:scale-110",children:u.jsx("span",{className:"material-icons text-white text-3xl md:text-4xl",children:"auto_fix_high"})}),u.jsx("p",{className:`text-sm mt-2 ${a?"text-gray-300":"text-gray-700"}`,children:"Form analysis"})]}),u.jsxs("div",{className:"feature-icon-container animate-float",style:{animationDelay:"0.6s"},children:[u.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-gradient-to-br from-red-800 to-red-600 flex items-center justify-center shadow-lg shadow-red-900/30 hover:shadow-red-500/30 transition-all duration-300 hover:scale-110",children:u.jsx("span",{className:"material-icons text-white text-3xl md:text-4xl",children:"compare"})}),u.jsx("p",{className:`text-sm mt-2 ${a?"text-gray-300":"text-gray-700"}`,children:"Video comparison"})]})]}),u.jsxs("div",{className:`w-full max-w-lg mx-auto mb-10 ${a?"bg-black/30 border-red-900/30":"bg-white/70 border-red-300/40"} border rounded-lg p-4 animate-fade-in`,children:[u.jsxs("div",{className:"flex items-center mb-3",children:[u.jsx("span",{className:"material-icons text-red-500 mr-2",children:"edit_note"}),u.jsx("h3",{className:`text-lg font-medium ${a?"text-red-100":"text-red-700"}`,children:"Routine Notes"})]}),u.jsx("textarea",{className:`w-full h-32 rounded p-3 ${a?"bg-black/70 border-red-900/40 text-white placeholder-red-200/50":"bg-white/80 border-red-300/40 text-gray-800 placeholder-red-300"} border
                    focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500`,placeholder:"Write your notes for this training session here...",value:n,onChange:h=>s(h.target.value)})]}),u.jsx(jn,{to:"/auth",children:u.jsxs("div",{className:"inline-block relative group animate-fade-in mt-6",children:[u.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-red-600 to-red-400 rounded-lg blur-xl opacity-70 group-hover:opacity-100 transition duration-1000 animate-pulse"}),u.jsxs("div",{className:`relative px-12 py-6 ${a?"bg-black border-red-800/50":"bg-white border-red-300/50"} border rounded-lg leading-none flex items-center`,children:[u.jsx("span",{className:"flex items-center space-x-5",children:u.jsx("span",{className:"pr-6 text-2xl font-bold bg-gradient-to-r from-red-600 to-red-500 bg-clip-text text-transparent",children:"LAUNCH APP"})}),u.jsx("span",{className:"material-icons text-red-500 text-xl group-hover:translate-x-2 transition-transform",children:"arrow_forward"})]})]})})]})]})}),u.jsx("footer",{className:`mt-auto backdrop-blur-sm py-6 border-t relative z-10 ${a?"bg-black/80 border-red-900/20":"bg-white/80 border-red-300/20"}`,children:u.jsxs("div",{className:"container mx-auto px-4 text-center",children:[u.jsx("p",{className:a?"text-gray-400":"text-gray-600",children:"© 2025 CoachT"}),u.jsx("p",{className:`${a?"text-gray-600":"text-gray-500"} text-sm mt-1`,children:"Powered by TensorFlow.js"})]})})]})}function LUe(){return u.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:u.jsx(Ks,{className:"w-full max-w-md mx-4",children:u.jsxs(rr,{className:"pt-6",children:[u.jsxs("div",{className:"flex mb-4 gap-2",children:[u.jsx(aee,{className:"h-8 w-8 text-red-500"}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),u.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}var Yx=t=>t.type==="checkbox",Gd=t=>t instanceof Date,fi=t=>t==null;const CK=t=>typeof t=="object";var nr=t=>!fi(t)&&!Array.isArray(t)&&CK(t)&&!Gd(t),kK=t=>nr(t)&&t.target?Yx(t.target)?t.target.checked:t.target.value:t,BUe=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,NK=(t,e)=>t.has(BUe(e)),VUe=t=>{const e=t.constructor&&t.constructor.prototype;return nr(e)&&e.hasOwnProperty("isPrototypeOf")},s3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ar(t){let e;const n=Array.isArray(t),s=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set(t);else if(!(s3&&(t instanceof Blob||s))&&(n||nr(t)))if(e=n?[]:{},!n&&!VUe(t))e=t;else for(const r in t)t.hasOwnProperty(r)&&(e[r]=Ar(t[r]));else return t;return e}var Z1=t=>Array.isArray(t)?t.filter(Boolean):[],Js=t=>t===void 0,ot=(t,e,n)=>{if(!e||!nr(t))return n;const s=Z1(e.split(/[,[\].]+?/)).reduce((r,i)=>fi(r)?r:r[i],t);return Js(s)||s===t?Js(t[e])?n:t[e]:s},co=t=>typeof t=="boolean",r3=t=>/^\w*$/.test(t),TK=t=>Z1(t.replace(/["|']|\]/g,"").split(/\.|\[/)),Wn=(t,e,n)=>{let s=-1;const r=r3(e)?[e]:TK(e),i=r.length,o=i-1;for(;++s<i;){const a=r[s];let l=n;if(s!==o){const c=t[a];l=nr(c)||Array.isArray(c)?c:isNaN(+r[s+1])?{}:[]}if(a==="__proto__"||a==="constructor"||a==="prototype")return;t[a]=l,t=t[a]}};const yw={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Oa={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ql={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},_K=zt.createContext(null),J1=()=>zt.useContext(_K),zUe=t=>{const{children:e,...n}=t;return zt.createElement(_K.Provider,{value:n},e)};var EK=(t,e,n,s=!0)=>{const r={defaultValues:e._defaultValues};for(const i in t)Object.defineProperty(r,i,{get:()=>{const o=i;return e._proxyFormState[o]!==Oa.all&&(e._proxyFormState[o]=!s||Oa.all),n&&(n[o]=!0),t[o]}});return r};function WUe(t){const e=J1(),{control:n=e.control,disabled:s,name:r,exact:i}=t||{},[o,a]=zt.useState(n._formState),l=zt.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),c=zt.useRef(r);return c.current=r,zt.useEffect(()=>n._subscribe({name:c.current,formState:l.current,exact:i,callback:d=>{!s&&a({...n._formState,...d})}}),[n,s,i]),zt.useEffect(()=>{l.current.isValid&&n._setValid(!0)},[n]),zt.useMemo(()=>EK(o,n,l.current,!1),[o,n])}var Sl=t=>typeof t=="string",$K=(t,e,n,s,r)=>Sl(t)?(s&&e.watch.add(t),ot(n,t,r)):Array.isArray(t)?t.map(i=>(s&&e.watch.add(i),ot(n,i))):(s&&(e.watchAll=!0),n);function UUe(t){const e=J1(),{control:n=e.control,name:s,defaultValue:r,disabled:i,exact:o}=t||{},a=zt.useRef(s),l=zt.useRef(r);a.current=s,zt.useEffect(()=>n._subscribe({name:a.current,formState:{values:!0},exact:o,callback:h=>!i&&d($K(a.current,n._names,h.values||n._formValues,!1,l.current))}),[n,i,o]);const[c,d]=zt.useState(n._getWatch(s,r));return zt.useEffect(()=>n._removeUnmounted()),c}function HUe(t){const e=J1(),{name:n,disabled:s,control:r=e.control,shouldUnregister:i}=t,o=NK(r._names.array,n),a=UUe({control:r,name:n,defaultValue:ot(r._formValues,n,ot(r._defaultValues,n,t.defaultValue)),exact:!0}),l=WUe({control:r,name:n,exact:!0}),c=zt.useRef(t),d=zt.useRef(r.register(n,{...t.rules,value:a,...co(t.disabled)?{disabled:t.disabled}:{}})),h=zt.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!ot(l.errors,n)},isDirty:{enumerable:!0,get:()=>!!ot(l.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!ot(l.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!ot(l.validatingFields,n)},error:{enumerable:!0,get:()=>ot(l.errors,n)}}),[l,n]),f=zt.useCallback(x=>d.current.onChange({target:{value:kK(x),name:n},type:yw.CHANGE}),[n]),p=zt.useCallback(()=>d.current.onBlur({target:{value:ot(r._formValues,n),name:n},type:yw.BLUR}),[n,r._formValues]),m=zt.useCallback(x=>{const y=ot(r._fields,n);y&&x&&(y._f.ref={focus:()=>x.focus(),select:()=>x.select(),setCustomValidity:v=>x.setCustomValidity(v),reportValidity:()=>x.reportValidity()})},[r._fields,n]),g=zt.useMemo(()=>({name:n,value:a,...co(s)||l.disabled?{disabled:l.disabled||s}:{},onChange:f,onBlur:p,ref:m}),[n,s,l.disabled,f,p,m,a]);return zt.useEffect(()=>{const x=r._options.shouldUnregister||i;r.register(n,{...c.current.rules,...co(c.current.disabled)?{disabled:c.current.disabled}:{}});const y=(v,S)=>{const C=ot(r._fields,v);C&&C._f&&(C._f.mount=S)};if(y(n,!0),x){const v=Ar(ot(r._options.defaultValues,n));Wn(r._defaultValues,n,v),Js(ot(r._formValues,n))&&Wn(r._formValues,n,v)}return!o&&r.register(n),()=>{(o?x&&!r._state.action:x)?r.unregister(n):y(n,!1)}},[n,r,o,i]),zt.useEffect(()=>{r._setDisabledField({disabled:s,name:n})},[s,n,r]),zt.useMemo(()=>({field:g,formState:l,fieldState:h}),[g,l,h])}const GUe=t=>t.render(HUe(t));var IK=(t,e,n,s,r)=>e?{...n[t],types:{...n[t]&&n[t].types?n[t].types:{},[s]:r||!0}}:{},Yg=t=>Array.isArray(t)?t:[t],T4=()=>{let t=[];return{get observers(){return t},next:r=>{for(const i of t)i.next&&i.next(r)},subscribe:r=>(t.push(r),{unsubscribe:()=>{t=t.filter(i=>i!==r)}}),unsubscribe:()=>{t=[]}}},lT=t=>fi(t)||!CK(t);function ou(t,e){if(lT(t)||lT(e))return t===e;if(Gd(t)&&Gd(e))return t.getTime()===e.getTime();const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n){const i=t[r];if(!s.includes(r))return!1;if(r!=="ref"){const o=e[r];if(Gd(i)&&Gd(o)||nr(i)&&nr(o)||Array.isArray(i)&&Array.isArray(o)?!ou(i,o):i!==o)return!1}}return!0}var di=t=>nr(t)&&!Object.keys(t).length,i3=t=>t.type==="file",Fa=t=>typeof t=="function",vw=t=>{if(!s3)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},RK=t=>t.type==="select-multiple",o3=t=>t.type==="radio",KUe=t=>o3(t)||Yx(t),nC=t=>vw(t)&&t.isConnected;function qUe(t,e){const n=e.slice(0,-1).length;let s=0;for(;s<n;)t=Js(t)?s++:t[e[s++]];return t}function XUe(t){for(const e in t)if(t.hasOwnProperty(e)&&!Js(t[e]))return!1;return!0}function cr(t,e){const n=Array.isArray(e)?e:r3(e)?[e]:TK(e),s=n.length===1?t:qUe(t,n),r=n.length-1,i=n[r];return s&&delete s[i],r!==0&&(nr(s)&&di(s)||Array.isArray(s)&&XUe(s))&&cr(t,n.slice(0,-1)),t}var PK=t=>{for(const e in t)if(Fa(t[e]))return!0;return!1};function bw(t,e={}){const n=Array.isArray(t);if(nr(t)||n)for(const s in t)Array.isArray(t[s])||nr(t[s])&&!PK(t[s])?(e[s]=Array.isArray(t[s])?[]:{},bw(t[s],e[s])):fi(t[s])||(e[s]=!0);return e}function AK(t,e,n){const s=Array.isArray(t);if(nr(t)||s)for(const r in t)Array.isArray(t[r])||nr(t[r])&&!PK(t[r])?Js(e)||lT(n[r])?n[r]=Array.isArray(t[r])?bw(t[r],[]):{...bw(t[r])}:AK(t[r],fi(e)?{}:e[r],n[r]):n[r]=!ou(t[r],e[r]);return n}var eg=(t,e)=>AK(t,e,bw(e));const _4={value:!1,isValid:!1},E4={value:!0,isValid:!0};var jK=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Js(t[0].attributes.value)?Js(t[0].value)||t[0].value===""?E4:{value:t[0].value,isValid:!0}:E4:_4}return _4},DK=(t,{valueAsNumber:e,valueAsDate:n,setValueAs:s})=>Js(t)?t:e?t===""?NaN:t&&+t:n&&Sl(t)?new Date(t):s?s(t):t;const $4={isValid:!1,value:null};var OK=t=>Array.isArray(t)?t.reduce((e,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:e,$4):$4;function I4(t){const e=t.ref;return i3(e)?e.files:o3(e)?OK(t.refs).value:RK(e)?[...e.selectedOptions].map(({value:n})=>n):Yx(e)?jK(t.refs).value:DK(Js(e.value)?t.ref.value:e.value,t)}var YUe=(t,e,n,s)=>{const r={};for(const i of t){const o=ot(e,i);o&&Wn(r,i,o._f)}return{criteriaMode:n,names:[...t],fields:r,shouldUseNativeValidation:s}},ww=t=>t instanceof RegExp,tg=t=>Js(t)?t:ww(t)?t.source:nr(t)?ww(t.value)?t.value.source:t.value:t,R4=t=>({isOnSubmit:!t||t===Oa.onSubmit,isOnBlur:t===Oa.onBlur,isOnChange:t===Oa.onChange,isOnAll:t===Oa.all,isOnTouch:t===Oa.onTouched});const P4="AsyncFunction";var QUe=t=>!!t&&!!t.validate&&!!(Fa(t.validate)&&t.validate.constructor.name===P4||nr(t.validate)&&Object.values(t.validate).find(e=>e.constructor.name===P4)),ZUe=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),A4=(t,e,n)=>!n&&(e.watchAll||e.watch.has(t)||[...e.watch].some(s=>t.startsWith(s)&&/^\.\w+/.test(t.slice(s.length))));const Qg=(t,e,n,s)=>{for(const r of n||Object.keys(t)){const i=ot(t,r);if(i){const{_f:o,...a}=i;if(o){if(o.refs&&o.refs[0]&&e(o.refs[0],r)&&!s)return!0;if(o.ref&&e(o.ref,o.name)&&!s)return!0;if(Qg(a,e))break}else if(nr(a)&&Qg(a,e))break}}};function j4(t,e,n){const s=ot(t,n);if(s||r3(n))return{error:s,name:n};const r=n.split(".");for(;r.length;){const i=r.join("."),o=ot(e,i),a=ot(t,i);if(o&&!Array.isArray(o)&&n!==i)return{name:n};if(a&&a.type)return{name:i,error:a};r.pop()}return{name:n}}var JUe=(t,e,n,s)=>{n(t);const{name:r,...i}=t;return di(i)||Object.keys(i).length>=Object.keys(e).length||Object.keys(i).find(o=>e[o]===(!s||Oa.all))},e8e=(t,e,n)=>!t||!e||t===e||Yg(t).some(s=>s&&(n?s===e:s.startsWith(e)||e.startsWith(s))),t8e=(t,e,n,s,r)=>r.isOnAll?!1:!n&&r.isOnTouch?!(e||t):(n?s.isOnBlur:r.isOnBlur)?!t:(n?s.isOnChange:r.isOnChange)?t:!0,n8e=(t,e)=>!Z1(ot(t,e)).length&&cr(t,e),s8e=(t,e,n)=>{const s=Yg(ot(t,n));return Wn(s,"root",e[n]),Wn(t,n,s),t},Uv=t=>Sl(t);function D4(t,e,n="validate"){if(Uv(t)||Array.isArray(t)&&t.every(Uv)||co(t)&&!t)return{type:n,message:Uv(t)?t:"",ref:e}}var bf=t=>nr(t)&&!ww(t)?t:{value:t,message:""},O4=async(t,e,n,s,r,i)=>{const{ref:o,refs:a,required:l,maxLength:c,minLength:d,min:h,max:f,pattern:p,validate:m,name:g,valueAsNumber:x,mount:y}=t._f,v=ot(n,g);if(!y||e.has(g))return{};const S=a?a[0]:o,C=F=>{r&&S.reportValidity&&(S.setCustomValidity(co(F)?"":F||""),S.reportValidity())},k={},T=o3(o),_=Yx(o),$=T||_,R=(x||i3(o))&&Js(o.value)&&Js(v)||vw(o)&&o.value===""||v===""||Array.isArray(v)&&!v.length,A=IK.bind(null,g,s,k),j=(F,L,M,q=ql.maxLength,z=ql.minLength)=>{const re=F?L:M;k[g]={type:F?q:z,message:re,ref:o,...A(F?q:z,re)}};if(i?!Array.isArray(v)||!v.length:l&&(!$&&(R||fi(v))||co(v)&&!v||_&&!jK(a).isValid||T&&!OK(a).isValid)){const{value:F,message:L}=Uv(l)?{value:!!l,message:l}:bf(l);if(F&&(k[g]={type:ql.required,message:L,ref:S,...A(ql.required,L)},!s))return C(L),k}if(!R&&(!fi(h)||!fi(f))){let F,L;const M=bf(f),q=bf(h);if(!fi(v)&&!isNaN(v)){const z=o.valueAsNumber||v&&+v;fi(M.value)||(F=z>M.value),fi(q.value)||(L=z<q.value)}else{const z=o.valueAsDate||new Date(v),re=xe=>new Date(new Date().toDateString()+" "+xe),U=o.type=="time",G=o.type=="week";Sl(M.value)&&v&&(F=U?re(v)>re(M.value):G?v>M.value:z>new Date(M.value)),Sl(q.value)&&v&&(L=U?re(v)<re(q.value):G?v<q.value:z<new Date(q.value))}if((F||L)&&(j(!!F,M.message,q.message,ql.max,ql.min),!s))return C(k[g].message),k}if((c||d)&&!R&&(Sl(v)||i&&Array.isArray(v))){const F=bf(c),L=bf(d),M=!fi(F.value)&&v.length>+F.value,q=!fi(L.value)&&v.length<+L.value;if((M||q)&&(j(M,F.message,L.message),!s))return C(k[g].message),k}if(p&&!R&&Sl(v)){const{value:F,message:L}=bf(p);if(ww(F)&&!v.match(F)&&(k[g]={type:ql.pattern,message:L,ref:o,...A(ql.pattern,L)},!s))return C(L),k}if(m){if(Fa(m)){const F=await m(v,n),L=D4(F,S);if(L&&(k[g]={...L,...A(ql.validate,L.message)},!s))return C(L.message),k}else if(nr(m)){let F={};for(const L in m){if(!di(F)&&!s)break;const M=D4(await m[L](v,n),S,L);M&&(F={...M,...A(L,M.message)},C(M.message),s&&(k[g]=F))}if(!di(F)&&(k[g]={ref:S,...F},!s))return k}}return C(!0),k};const r8e={mode:Oa.onSubmit,reValidateMode:Oa.onChange,shouldFocusError:!0};function i8e(t={}){let e={...r8e,...t},n={submitCount:0,isDirty:!1,isLoading:Fa(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1};const s={};let r=nr(e.defaultValues)||nr(e.values)?Ar(e.values||e.defaultValues)||{}:{},i=e.shouldUnregister?{}:Ar(r),o={action:!1,mount:!1,watch:!1},a={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},l,c=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let h={...d};const f={array:T4(),state:T4()},p=R4(e.mode),m=R4(e.reValidateMode),g=e.criteriaMode===Oa.all,x=B=>Z=>{clearTimeout(c),c=setTimeout(B,Z)},y=async B=>{if(!e.disabled&&(d.isValid||h.isValid||B)){const Z=e.resolver?di((await R()).errors):await j(s,!0);Z!==n.isValid&&f.state.next({isValid:Z})}},v=(B,Z)=>{!e.disabled&&(d.isValidating||d.validatingFields||h.isValidating||h.validatingFields)&&((B||Array.from(a.mount)).forEach(te=>{te&&(Z?Wn(n.validatingFields,te,Z):cr(n.validatingFields,te))}),f.state.next({validatingFields:n.validatingFields,isValidating:!di(n.validatingFields)}))},S=(B,Z=[],te,ve,we=!0,de=!0)=>{if(ve&&te&&!e.disabled){if(o.action=!0,de&&Array.isArray(ot(s,B))){const Ee=te(ot(s,B),ve.argA,ve.argB);we&&Wn(s,B,Ee)}if(de&&Array.isArray(ot(n.errors,B))){const Ee=te(ot(n.errors,B),ve.argA,ve.argB);we&&Wn(n.errors,B,Ee),n8e(n.errors,B)}if((d.touchedFields||h.touchedFields)&&de&&Array.isArray(ot(n.touchedFields,B))){const Ee=te(ot(n.touchedFields,B),ve.argA,ve.argB);we&&Wn(n.touchedFields,B,Ee)}(d.dirtyFields||h.dirtyFields)&&(n.dirtyFields=eg(r,i)),f.state.next({name:B,isDirty:L(B,Z),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Wn(i,B,Z)},C=(B,Z)=>{Wn(n.errors,B,Z),f.state.next({errors:n.errors})},k=B=>{n.errors=B,f.state.next({errors:n.errors,isValid:!1})},T=(B,Z,te,ve)=>{const we=ot(s,B);if(we){const de=ot(i,B,Js(te)?ot(r,B):te);Js(de)||ve&&ve.defaultChecked||Z?Wn(i,B,Z?de:I4(we._f)):z(B,de),o.mount&&y()}},_=(B,Z,te,ve,we)=>{let de=!1,Ee=!1;const mt={name:B};if(!e.disabled){if(!te||ve){(d.isDirty||h.isDirty)&&(Ee=n.isDirty,n.isDirty=mt.isDirty=L(),de=Ee!==mt.isDirty);const It=ou(ot(r,B),Z);Ee=!!ot(n.dirtyFields,B),It?cr(n.dirtyFields,B):Wn(n.dirtyFields,B,!0),mt.dirtyFields=n.dirtyFields,de=de||(d.dirtyFields||h.dirtyFields)&&Ee!==!It}if(te){const It=ot(n.touchedFields,B);It||(Wn(n.touchedFields,B,te),mt.touchedFields=n.touchedFields,de=de||(d.touchedFields||h.touchedFields)&&It!==te)}de&&we&&f.state.next(mt)}return de?mt:{}},$=(B,Z,te,ve)=>{const we=ot(n.errors,B),de=(d.isValid||h.isValid)&&co(Z)&&n.isValid!==Z;if(e.delayError&&te?(l=x(()=>C(B,te)),l(e.delayError)):(clearTimeout(c),l=null,te?Wn(n.errors,B,te):cr(n.errors,B)),(te?!ou(we,te):we)||!di(ve)||de){const Ee={...ve,...de&&co(Z)?{isValid:Z}:{},errors:n.errors,name:B};n={...n,...Ee},f.state.next(Ee)}},R=async B=>{v(B,!0);const Z=await e.resolver(i,e.context,YUe(B||a.mount,s,e.criteriaMode,e.shouldUseNativeValidation));return v(B),Z},A=async B=>{const{errors:Z}=await R(B);if(B)for(const te of B){const ve=ot(Z,te);ve?Wn(n.errors,te,ve):cr(n.errors,te)}else n.errors=Z;return Z},j=async(B,Z,te={valid:!0})=>{for(const ve in B){const we=B[ve];if(we){const{_f:de,...Ee}=we;if(de){const mt=a.array.has(de.name),It=we._f&&QUe(we._f);It&&d.validatingFields&&v([ve],!0);const jt=await O4(we,a.disabled,i,g,e.shouldUseNativeValidation&&!Z,mt);if(It&&d.validatingFields&&v([ve]),jt[de.name]&&(te.valid=!1,Z))break;!Z&&(ot(jt,de.name)?mt?s8e(n.errors,jt,de.name):Wn(n.errors,de.name,jt[de.name]):cr(n.errors,de.name))}!di(Ee)&&await j(Ee,Z,te)}}return te.valid},F=()=>{for(const B of a.unMount){const Z=ot(s,B);Z&&(Z._f.refs?Z._f.refs.every(te=>!nC(te)):!nC(Z._f.ref))&&ie(B)}a.unMount=new Set},L=(B,Z)=>!e.disabled&&(B&&Z&&Wn(i,B,Z),!ou(De(),r)),M=(B,Z,te)=>$K(B,a,{...o.mount?i:Js(Z)?r:Sl(B)?{[B]:Z}:Z},te,Z),q=B=>Z1(ot(o.mount?i:r,B,e.shouldUnregister?ot(r,B,[]):[])),z=(B,Z,te={})=>{const ve=ot(s,B);let we=Z;if(ve){const de=ve._f;de&&(!de.disabled&&Wn(i,B,DK(Z,de)),we=vw(de.ref)&&fi(Z)?"":Z,RK(de.ref)?[...de.ref.options].forEach(Ee=>Ee.selected=we.includes(Ee.value)):de.refs?Yx(de.ref)?de.refs.length>1?de.refs.forEach(Ee=>(!Ee.defaultChecked||!Ee.disabled)&&(Ee.checked=Array.isArray(we)?!!we.find(mt=>mt===Ee.value):we===Ee.value)):de.refs[0]&&(de.refs[0].checked=!!we):de.refs.forEach(Ee=>Ee.checked=Ee.value===we):i3(de.ref)?de.ref.value="":(de.ref.value=we,de.ref.type||f.state.next({name:B,values:Ar(i)})))}(te.shouldDirty||te.shouldTouch)&&_(B,we,te.shouldTouch,te.shouldDirty,!0),te.shouldValidate&&Ce(B)},re=(B,Z,te)=>{for(const ve in Z){const we=Z[ve],de=`${B}.${ve}`,Ee=ot(s,de);(a.array.has(B)||nr(we)||Ee&&!Ee._f)&&!Gd(we)?re(de,we,te):z(de,we,te)}},U=(B,Z,te={})=>{const ve=ot(s,B),we=a.array.has(B),de=Ar(Z);Wn(i,B,de),we?(f.array.next({name:B,values:Ar(i)}),(d.isDirty||d.dirtyFields||h.isDirty||h.dirtyFields)&&te.shouldDirty&&f.state.next({name:B,dirtyFields:eg(r,i),isDirty:L(B,de)})):ve&&!ve._f&&!fi(de)?re(B,de,te):z(B,de,te),A4(B,a)&&f.state.next({...n}),f.state.next({name:o.mount?B:void 0,values:Ar(i)})},G=async B=>{o.mount=!0;const Z=B.target;let te=Z.name,ve=!0;const we=ot(s,te),de=Ee=>{ve=Number.isNaN(Ee)||Gd(Ee)&&isNaN(Ee.getTime())||ou(Ee,ot(i,te,Ee))};if(we){let Ee,mt;const It=Z.type?I4(we._f):kK(B),jt=B.type===yw.BLUR||B.type===yw.FOCUS_OUT,hs=!ZUe(we._f)&&!e.resolver&&!ot(n.errors,te)&&!we._f.deps||t8e(jt,ot(n.touchedFields,te),n.isSubmitted,m,p),fn=A4(te,a,jt);Wn(i,te,It),jt?(we._f.onBlur&&we._f.onBlur(B),l&&l(0)):we._f.onChange&&we._f.onChange(B);const dt=_(te,It,jt),At=!di(dt)||fn;if(!jt&&f.state.next({name:te,type:B.type,values:Ar(i)}),hs)return(d.isValid||h.isValid)&&(e.mode==="onBlur"?jt&&y():jt||y()),At&&f.state.next({name:te,...fn?{}:dt});if(!jt&&fn&&f.state.next({...n}),e.resolver){const{errors:Vs}=await R([te]);if(de(It),ve){const Ln=j4(n.errors,s,te),lr=j4(Vs,s,Ln.name||te);Ee=lr.error,te=lr.name,mt=di(Vs)}}else v([te],!0),Ee=(await O4(we,a.disabled,i,g,e.shouldUseNativeValidation))[te],v([te]),de(It),ve&&(Ee?mt=!1:(d.isValid||h.isValid)&&(mt=await j(s,!0)));ve&&(we._f.deps&&Ce(we._f.deps),$(te,mt,Ee,dt))}},xe=(B,Z)=>{if(ot(n.errors,Z)&&B.focus)return B.focus(),1},Ce=async(B,Z={})=>{let te,ve;const we=Yg(B);if(e.resolver){const de=await A(Js(B)?B:we);te=di(de),ve=B?!we.some(Ee=>ot(de,Ee)):te}else B?(ve=(await Promise.all(we.map(async de=>{const Ee=ot(s,de);return await j(Ee&&Ee._f?{[de]:Ee}:Ee)}))).every(Boolean),!(!ve&&!n.isValid)&&y()):ve=te=await j(s);return f.state.next({...!Sl(B)||(d.isValid||h.isValid)&&te!==n.isValid?{}:{name:B},...e.resolver||!B?{isValid:te}:{},errors:n.errors}),Z.shouldFocus&&!ve&&Qg(s,xe,B?we:a.mount),ve},De=B=>{const Z={...o.mount?i:r};return Js(B)?Z:Sl(B)?ot(Z,B):B.map(te=>ot(Z,te))},fe=(B,Z)=>({invalid:!!ot((Z||n).errors,B),isDirty:!!ot((Z||n).dirtyFields,B),error:ot((Z||n).errors,B),isValidating:!!ot(n.validatingFields,B),isTouched:!!ot((Z||n).touchedFields,B)}),ee=B=>{B&&Yg(B).forEach(Z=>cr(n.errors,Z)),f.state.next({errors:B?n.errors:{}})},Pe=(B,Z,te)=>{const ve=(ot(s,B,{_f:{}})._f||{}).ref,we=ot(n.errors,B)||{},{ref:de,message:Ee,type:mt,...It}=we;Wn(n.errors,B,{...It,...Z,ref:ve}),f.state.next({name:B,errors:n.errors,isValid:!1}),te&&te.shouldFocus&&ve&&ve.focus&&ve.focus()},Re=(B,Z)=>Fa(B)?f.state.subscribe({next:te=>B(M(void 0,Z),te)}):M(B,Z,!0),ce=B=>f.state.subscribe({next:Z=>{e8e(B.name,Z.name,B.exact)&&JUe(Z,B.formState||d,Ze,B.reRenderRoot)&&B.callback({values:{...i},...n,...Z})}}).unsubscribe,me=B=>(o.mount=!0,h={...h,...B.formState},ce({...B,formState:h})),ie=(B,Z={})=>{for(const te of B?Yg(B):a.mount)a.mount.delete(te),a.array.delete(te),Z.keepValue||(cr(s,te),cr(i,te)),!Z.keepError&&cr(n.errors,te),!Z.keepDirty&&cr(n.dirtyFields,te),!Z.keepTouched&&cr(n.touchedFields,te),!Z.keepIsValidating&&cr(n.validatingFields,te),!e.shouldUnregister&&!Z.keepDefaultValue&&cr(r,te);f.state.next({values:Ar(i)}),f.state.next({...n,...Z.keepDirty?{isDirty:L()}:{}}),!Z.keepIsValid&&y()},Q=({disabled:B,name:Z})=>{(co(B)&&o.mount||B||a.disabled.has(Z))&&(B?a.disabled.add(Z):a.disabled.delete(Z))},oe=(B,Z={})=>{let te=ot(s,B);const ve=co(Z.disabled)||co(e.disabled);return Wn(s,B,{...te||{},_f:{...te&&te._f?te._f:{ref:{name:B}},name:B,mount:!0,...Z}}),a.mount.add(B),te?Q({disabled:co(Z.disabled)?Z.disabled:e.disabled,name:B}):T(B,!0,Z.value),{...ve?{disabled:Z.disabled||e.disabled}:{},...e.progressive?{required:!!Z.required,min:tg(Z.min),max:tg(Z.max),minLength:tg(Z.minLength),maxLength:tg(Z.maxLength),pattern:tg(Z.pattern)}:{},name:B,onChange:G,onBlur:G,ref:we=>{if(we){oe(B,Z),te=ot(s,B);const de=Js(we.value)&&we.querySelectorAll&&we.querySelectorAll("input,select,textarea")[0]||we,Ee=KUe(de),mt=te._f.refs||[];if(Ee?mt.find(It=>It===de):de===te._f.ref)return;Wn(s,B,{_f:{...te._f,...Ee?{refs:[...mt.filter(nC),de,...Array.isArray(ot(r,B))?[{}]:[]],ref:{type:de.type,name:B}}:{ref:de}}}),T(B,!1,void 0,de)}else te=ot(s,B,{}),te._f&&(te._f.mount=!1),(e.shouldUnregister||Z.shouldUnregister)&&!(NK(a.array,B)&&o.action)&&a.unMount.add(B)}}},ae=()=>e.shouldFocusError&&Qg(s,xe,a.mount),Ae=B=>{co(B)&&(f.state.next({disabled:B}),Qg(s,(Z,te)=>{const ve=ot(s,te);ve&&(Z.disabled=ve._f.disabled||B,Array.isArray(ve._f.refs)&&ve._f.refs.forEach(we=>{we.disabled=ve._f.disabled||B}))},0,!1))},Be=(B,Z)=>async te=>{let ve;te&&(te.preventDefault&&te.preventDefault(),te.persist&&te.persist());let we=Ar(i);if(f.state.next({isSubmitting:!0}),e.resolver){const{errors:de,values:Ee}=await R();n.errors=de,we=Ee}else await j(s);if(a.disabled.size)for(const de of a.disabled)Wn(we,de,void 0);if(cr(n.errors,"root"),di(n.errors)){f.state.next({errors:{}});try{await B(we,te)}catch(de){ve=de}}else Z&&await Z({...n.errors},te),ae(),setTimeout(ae);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:di(n.errors)&&!ve,submitCount:n.submitCount+1,errors:n.errors}),ve)throw ve},Xe=(B,Z={})=>{ot(s,B)&&(Js(Z.defaultValue)?U(B,Ar(ot(r,B))):(U(B,Z.defaultValue),Wn(r,B,Ar(Z.defaultValue))),Z.keepTouched||cr(n.touchedFields,B),Z.keepDirty||(cr(n.dirtyFields,B),n.isDirty=Z.defaultValue?L(B,Ar(ot(r,B))):L()),Z.keepError||(cr(n.errors,B),d.isValid&&y()),f.state.next({...n}))},lt=(B,Z={})=>{const te=B?Ar(B):r,ve=Ar(te),we=di(B),de=we?r:ve;if(Z.keepDefaultValues||(r=te),!Z.keepValues){if(Z.keepDirtyValues){const Ee=new Set([...a.mount,...Object.keys(eg(r,i))]);for(const mt of Array.from(Ee))ot(n.dirtyFields,mt)?Wn(de,mt,ot(i,mt)):U(mt,ot(de,mt))}else{if(s3&&Js(B))for(const Ee of a.mount){const mt=ot(s,Ee);if(mt&&mt._f){const It=Array.isArray(mt._f.refs)?mt._f.refs[0]:mt._f.ref;if(vw(It)){const jt=It.closest("form");if(jt){jt.reset();break}}}}for(const Ee of a.mount)U(Ee,ot(de,Ee))}i=Ar(de),f.array.next({values:{...de}}),f.state.next({values:{...de}})}a={mount:Z.keepDirtyValues?a.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!d.isValid||!!Z.keepIsValid||!!Z.keepDirtyValues,o.watch=!!e.shouldUnregister,f.state.next({submitCount:Z.keepSubmitCount?n.submitCount:0,isDirty:we?!1:Z.keepDirty?n.isDirty:!!(Z.keepDefaultValues&&!ou(B,r)),isSubmitted:Z.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:we?{}:Z.keepDirtyValues?Z.keepDefaultValues&&i?eg(r,i):n.dirtyFields:Z.keepDefaultValues&&B?eg(r,B):Z.keepDirty?n.dirtyFields:{},touchedFields:Z.keepTouched?n.touchedFields:{},errors:Z.keepErrors?n.errors:{},isSubmitSuccessful:Z.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},Me=(B,Z)=>lt(Fa(B)?B(i):B,Z),je=(B,Z={})=>{const te=ot(s,B),ve=te&&te._f;if(ve){const we=ve.refs?ve.refs[0]:ve.ref;we.focus&&(we.focus(),Z.shouldSelect&&Fa(we.select)&&we.select())}},Ze=B=>{n={...n,...B}},Ie={control:{register:oe,unregister:ie,getFieldState:fe,handleSubmit:Be,setError:Pe,_subscribe:ce,_runSchema:R,_getWatch:M,_getDirty:L,_setValid:y,_setFieldArray:S,_setDisabledField:Q,_setErrors:k,_getFieldArray:q,_reset:lt,_resetDefaultValues:()=>Fa(e.defaultValues)&&e.defaultValues().then(B=>{Me(B,e.resetOptions),f.state.next({isLoading:!1})}),_removeUnmounted:F,_disableForm:Ae,_subjects:f,_proxyFormState:d,get _fields(){return s},get _formValues(){return i},get _state(){return o},set _state(B){o=B},get _defaultValues(){return r},get _names(){return a},set _names(B){a=B},get _formState(){return n},get _options(){return e},set _options(B){e={...e,...B}}},subscribe:me,trigger:Ce,register:oe,handleSubmit:Be,watch:Re,setValue:U,getValues:De,reset:Me,resetField:Xe,clearErrors:ee,unregister:ie,setError:Pe,setFocus:je,getFieldState:fe};return{...Ie,formControl:Ie}}function a3(t={}){const e=zt.useRef(void 0),n=zt.useRef(void 0),[s,r]=zt.useState({isDirty:!1,isValidating:!1,isLoading:Fa(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:Fa(t.defaultValues)?void 0:t.defaultValues});e.current||(e.current={...t.formControl?t.formControl:i8e(t),formState:s},t.formControl&&t.defaultValues&&!Fa(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions));const i=e.current.control;return i._options=t,zt.useLayoutEffect(()=>i._subscribe({formState:i._proxyFormState,callback:()=>r({...i._formState}),reRenderRoot:!0}),[i]),zt.useEffect(()=>i._disableForm(t.disabled),[i,t.disabled]),zt.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==s.isDirty&&i._subjects.state.next({isDirty:o})}},[i,s.isDirty]),zt.useEffect(()=>{t.values&&!ou(t.values,n.current)?(i._reset(t.values,i._options.resetOptions),n.current=t.values,r(o=>({...o}))):i._resetDefaultValues()},[t.values,i]),zt.useEffect(()=>{t.errors&&!di(t.errors)&&i._setErrors(t.errors)},[t.errors,i]),zt.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),zt.useEffect(()=>{t.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[t.shouldUnregister,i]),e.current.formState=EK(s,i),e.current}var Rn;(function(t){t.assertEqual=r=>r;function e(r){}t.assertIs=e;function n(r){throw new Error}t.assertNever=n,t.arrayToEnum=r=>{const i={};for(const o of r)i[o]=o;return i},t.getValidEnumValues=r=>{const i=t.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),o={};for(const a of i)o[a]=r[a];return t.objectValues(o)},t.objectValues=r=>t.objectKeys(r).map(function(i){return r[i]}),t.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&i.push(o);return i},t.find=(r,i)=>{for(const o of r)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,i=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=s,t.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(Rn||(Rn={}));var cT;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(cT||(cT={}));const yt=Rn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),oc=t=>{switch(typeof t){case"undefined":return yt.undefined;case"string":return yt.string;case"number":return isNaN(t)?yt.nan:yt.number;case"boolean":return yt.boolean;case"function":return yt.function;case"bigint":return yt.bigint;case"symbol":return yt.symbol;case"object":return Array.isArray(t)?yt.array:t===null?yt.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?yt.promise:typeof Map<"u"&&t instanceof Map?yt.map:typeof Set<"u"&&t instanceof Set?yt.set:typeof Date<"u"&&t instanceof Date?yt.date:yt.object;default:return yt.unknown}},ze=Rn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),o8e=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class _o extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(i){return i.message},s={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)s._errors.push(n(o));else{let a=s,l=0;for(;l<o.path.length;){const c=o.path[l];l===o.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(n(o))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return r(this),s}static assert(e){if(!(e instanceof _o))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Rn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},s=[];for(const r of this.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:n}}get formErrors(){return this.flatten()}}_o.create=t=>new _o(t);const Yp=(t,e)=>{let n;switch(t.code){case ze.invalid_type:t.received===yt.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case ze.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Rn.jsonStringifyReplacer)}`;break;case ze.unrecognized_keys:n=`Unrecognized key(s) in object: ${Rn.joinValues(t.keys,", ")}`;break;case ze.invalid_union:n="Invalid input";break;case ze.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Rn.joinValues(t.options)}`;break;case ze.invalid_enum_value:n=`Invalid enum value. Expected ${Rn.joinValues(t.options)}, received '${t.received}'`;break;case ze.invalid_arguments:n="Invalid function arguments";break;case ze.invalid_return_type:n="Invalid function return type";break;case ze.invalid_date:n="Invalid date";break;case ze.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Rn.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case ze.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case ze.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case ze.custom:n="Invalid input";break;case ze.invalid_intersection_types:n="Intersection results could not be merged";break;case ze.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case ze.not_finite:n="Number must be finite";break;default:n=e.defaultError,Rn.assertNever(t)}return{message:n}};let FK=Yp;function a8e(t){FK=t}function Sw(){return FK}const Cw=t=>{const{data:e,path:n,errorMaps:s,issueData:r}=t,i=[...n,...r.path||[]],o={...r,path:i};if(r.message!==void 0)return{...r,path:i,message:r.message};let a="";const l=s.filter(c=>!!c).slice().reverse();for(const c of l)a=c(o,{data:e,defaultError:a}).message;return{...r,path:i,message:a}},l8e=[];function ct(t,e){const n=Sw(),s=Cw({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Yp?void 0:Yp].filter(r=>!!r)});t.common.issues.push(s)}class si{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const s=[];for(const r of n){if(r.status==="aborted")return qt;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,n){const s=[];for(const r of n){const i=await r.key,o=await r.value;s.push({key:i,value:o})}return si.mergeObjectSync(e,s)}static mergeObjectSync(e,n){const s={};for(const r of n){const{key:i,value:o}=r;if(i.status==="aborted"||o.status==="aborted")return qt;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}}const qt=Object.freeze({status:"aborted"}),Gf=t=>({status:"dirty",value:t}),Ci=t=>({status:"valid",value:t}),uT=t=>t.status==="aborted",dT=t=>t.status==="dirty",Rh=t=>t.status==="valid",X0=t=>typeof Promise<"u"&&t instanceof Promise;function kw(t,e,n,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function MK(t,e,n,s,r){if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var $t;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})($t||($t={}));var wg,Sg;class Ll{constructor(e,n,s,r){this._cachedPath=[],this.parent=e,this.data=n,this._path=s,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const F4=(t,e)=>{if(Rh(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new _o(t.common.issues);return this._error=n,this._error}}};function sn(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:s,description:r}=t;if(e&&(n||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,a)=>{var l,c;const{message:d}=t;return o.code==="invalid_enum_value"?{message:d??a.defaultError}:typeof a.data>"u"?{message:(l=d??s)!==null&&l!==void 0?l:a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:(c=d??n)!==null&&c!==void 0?c:a.defaultError}},description:r}}class hn{get description(){return this._def.description}_getType(e){return oc(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:oc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new si,ctx:{common:e.parent.common,data:e.data,parsedType:oc(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(X0(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const s=this.safeParse(e,n);if(s.success)return s.data;throw s.error}safeParse(e,n){var s;const r={common:{issues:[],async:(s=n==null?void 0:n.async)!==null&&s!==void 0?s:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:oc(e)},i=this._parseSync({data:e,path:r.path,parent:r});return F4(r,i)}"~validate"(e){var n,s;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:oc(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:r});return Rh(i)?{value:i.value}:{issues:r.common.issues}}catch(i){!((s=(n=i==null?void 0:i.message)===null||n===void 0?void 0:n.toLowerCase())===null||s===void 0)&&s.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(i=>Rh(i)?{value:i.value}:{issues:r.common.issues})}async parseAsync(e,n){const s=await this.safeParseAsync(e,n);if(s.success)return s.data;throw s.error}async safeParseAsync(e,n){const s={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:oc(e)},r=this._parse({data:e,path:s.path,parent:s}),i=await(X0(r)?r:Promise.resolve(r));return F4(s,i)}refine(e,n){const s=r=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(r):n;return this._refinement((r,i)=>{const o=e(r),a=()=>i.addIssue({code:ze.custom,...s(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,n){return this._refinement((s,r)=>e(s)?!0:(r.addIssue(typeof n=="function"?n(s,r):n),!1))}_refinement(e){return new Qa({schema:this,typeName:Ut.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Al.create(this,this._def)}nullable(){return ed.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ha.create(this)}promise(){return Zp.create(this,this._def)}or(e){return J0.create([this,e],this._def)}and(e){return ex.create(this,e,this._def)}transform(e){return new Qa({...sn(this._def),schema:this,typeName:Ut.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ix({...sn(this._def),innerType:this,defaultValue:n,typeName:Ut.ZodDefault})}brand(){return new l3({typeName:Ut.ZodBranded,type:this,...sn(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new ox({...sn(this._def),innerType:this,catchValue:n,typeName:Ut.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Qx.create(this,e)}readonly(){return ax.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const c8e=/^c[^\s-]{8,}$/i,u8e=/^[0-9a-z]+$/,d8e=/^[0-9A-HJKMNP-TV-Z]{26}$/i,h8e=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,f8e=/^[a-z0-9_-]{21}$/i,p8e=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,m8e=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,g8e=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,x8e="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let sC;const y8e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,v8e=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,b8e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,w8e=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,S8e=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,C8e=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,LK="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",k8e=new RegExp(`^${LK}$`);function BK(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function N8e(t){return new RegExp(`^${BK(t)}$`)}function VK(t){let e=`${LK}T${BK(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function T8e(t,e){return!!((e==="v4"||!e)&&y8e.test(t)||(e==="v6"||!e)&&b8e.test(t))}function _8e(t,e){if(!p8e.test(t))return!1;try{const[n]=t.split("."),s=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(s));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function E8e(t,e){return!!((e==="v4"||!e)&&v8e.test(t)||(e==="v6"||!e)&&w8e.test(t))}class La extends hn{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==yt.string){const i=this._getOrReturnCtx(e);return ct(i,{code:ze.invalid_type,expected:yt.string,received:i.parsedType}),qt}const s=new si;let r;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(r=this._getOrReturnCtx(e,r),o?ct(r,{code:ze.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&ct(r,{code:ze.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")g8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"email",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")sC||(sC=new RegExp(x8e,"u")),sC.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"emoji",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")h8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"uuid",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")f8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"nanoid",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")c8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"cuid",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")u8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"cuid2",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")d8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"ulid",code:ze.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),ct(r,{validation:"url",code:ze.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"regex",code:ze.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?VK(i).test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?k8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?N8e(i).test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?m8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"duration",code:ze.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?T8e(e.data,i.version)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"ip",code:ze.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?_8e(e.data,i.alg)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"jwt",code:ze.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?E8e(e.data,i.version)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"cidr",code:ze.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?S8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"base64",code:ze.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?C8e.test(e.data)||(r=this._getOrReturnCtx(e,r),ct(r,{validation:"base64url",code:ze.invalid_string,message:i.message}),s.dirty()):Rn.assertNever(i);return{status:s.value,value:e.data}}_regex(e,n,s){return this.refinement(r=>e.test(r),{validation:n,code:ze.invalid_string,...$t.errToObj(s)})}_addCheck(e){return new La({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$t.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$t.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$t.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$t.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$t.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$t.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$t.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$t.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$t.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...$t.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...$t.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$t.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...$t.errToObj(e)})}datetime(e){var n,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...$t.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...$t.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...$t.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...$t.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...$t.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...$t.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...$t.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...$t.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...$t.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...$t.errToObj(n)})}nonempty(e){return this.min(1,$t.errToObj(e))}trim(){return new La({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new La({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new La({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}La.create=t=>{var e;return new La({checks:[],typeName:Ut.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...sn(t)})};function $8e(t,e){const n=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=n>s?n:s,i=parseInt(t.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return i%o/Math.pow(10,r)}class Qu extends hn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==yt.number){const i=this._getOrReturnCtx(e);return ct(i,{code:ze.invalid_type,expected:yt.number,received:i.parsedType}),qt}let s;const r=new si;for(const i of this._def.checks)i.kind==="int"?Rn.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?$8e(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.not_finite,message:i.message}),r.dirty()):Rn.assertNever(i);return{status:r.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,$t.toString(n))}gt(e,n){return this.setLimit("min",e,!1,$t.toString(n))}lte(e,n){return this.setLimit("max",e,!0,$t.toString(n))}lt(e,n){return this.setLimit("max",e,!1,$t.toString(n))}setLimit(e,n,s,r){return new Qu({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:$t.toString(r)}]})}_addCheck(e){return new Qu({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$t.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$t.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$t.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$t.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$t.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:$t.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:$t.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$t.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$t.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Rn.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(n===null||s.value>n)&&(n=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Qu.create=t=>new Qu({checks:[],typeName:Ut.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...sn(t)});class Zu extends hn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==yt.bigint)return this._getInvalidInput(e);let s;const r=new si;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),ct(s,{code:ze.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):Rn.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return ct(n,{code:ze.invalid_type,expected:yt.bigint,received:n.parsedType}),qt}gte(e,n){return this.setLimit("min",e,!0,$t.toString(n))}gt(e,n){return this.setLimit("min",e,!1,$t.toString(n))}lte(e,n){return this.setLimit("max",e,!0,$t.toString(n))}lt(e,n){return this.setLimit("max",e,!1,$t.toString(n))}setLimit(e,n,s,r){return new Zu({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:s,message:$t.toString(r)}]})}_addCheck(e){return new Zu({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$t.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$t.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$t.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$t.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:$t.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Zu.create=t=>{var e;return new Zu({checks:[],typeName:Ut.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...sn(t)})};class Y0 extends hn{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==yt.boolean){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.boolean,received:s.parsedType}),qt}return Ci(e.data)}}Y0.create=t=>new Y0({typeName:Ut.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...sn(t)});class Ph extends hn{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==yt.date){const i=this._getOrReturnCtx(e);return ct(i,{code:ze.invalid_type,expected:yt.date,received:i.parsedType}),qt}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return ct(i,{code:ze.invalid_date}),qt}const s=new si;let r;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),ct(r,{code:ze.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):Rn.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ph({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:$t.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:$t.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Ph.create=t=>new Ph({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Ut.ZodDate,...sn(t)});class Nw extends hn{_parse(e){if(this._getType(e)!==yt.symbol){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.symbol,received:s.parsedType}),qt}return Ci(e.data)}}Nw.create=t=>new Nw({typeName:Ut.ZodSymbol,...sn(t)});class Q0 extends hn{_parse(e){if(this._getType(e)!==yt.undefined){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.undefined,received:s.parsedType}),qt}return Ci(e.data)}}Q0.create=t=>new Q0({typeName:Ut.ZodUndefined,...sn(t)});class Z0 extends hn{_parse(e){if(this._getType(e)!==yt.null){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.null,received:s.parsedType}),qt}return Ci(e.data)}}Z0.create=t=>new Z0({typeName:Ut.ZodNull,...sn(t)});class Qp extends hn{constructor(){super(...arguments),this._any=!0}_parse(e){return Ci(e.data)}}Qp.create=t=>new Qp({typeName:Ut.ZodAny,...sn(t)});class ah extends hn{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ci(e.data)}}ah.create=t=>new ah({typeName:Ut.ZodUnknown,...sn(t)});class jc extends hn{_parse(e){const n=this._getOrReturnCtx(e);return ct(n,{code:ze.invalid_type,expected:yt.never,received:n.parsedType}),qt}}jc.create=t=>new jc({typeName:Ut.ZodNever,...sn(t)});class Tw extends hn{_parse(e){if(this._getType(e)!==yt.undefined){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.void,received:s.parsedType}),qt}return Ci(e.data)}}Tw.create=t=>new Tw({typeName:Ut.ZodVoid,...sn(t)});class Ha extends hn{_parse(e){const{ctx:n,status:s}=this._processInputParams(e),r=this._def;if(n.parsedType!==yt.array)return ct(n,{code:ze.invalid_type,expected:yt.array,received:n.parsedType}),qt;if(r.exactLength!==null){const o=n.data.length>r.exactLength.value,a=n.data.length<r.exactLength.value;(o||a)&&(ct(n,{code:o?ze.too_big:ze.too_small,minimum:a?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&n.data.length<r.minLength.value&&(ct(n,{code:ze.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&n.data.length>r.maxLength.value&&(ct(n,{code:ze.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),n.common.async)return Promise.all([...n.data].map((o,a)=>r.type._parseAsync(new Ll(n,o,n.path,a)))).then(o=>si.mergeArray(s,o));const i=[...n.data].map((o,a)=>r.type._parseSync(new Ll(n,o,n.path,a)));return si.mergeArray(s,i)}get element(){return this._def.type}min(e,n){return new Ha({...this._def,minLength:{value:e,message:$t.toString(n)}})}max(e,n){return new Ha({...this._def,maxLength:{value:e,message:$t.toString(n)}})}length(e,n){return new Ha({...this._def,exactLength:{value:e,message:$t.toString(n)}})}nonempty(e){return this.min(1,e)}}Ha.create=(t,e)=>new Ha({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Ut.ZodArray,...sn(e)});function kf(t){if(t instanceof Ps){const e={};for(const n in t.shape){const s=t.shape[n];e[n]=Al.create(kf(s))}return new Ps({...t._def,shape:()=>e})}else return t instanceof Ha?new Ha({...t._def,type:kf(t.element)}):t instanceof Al?Al.create(kf(t.unwrap())):t instanceof ed?ed.create(kf(t.unwrap())):t instanceof Bl?Bl.create(t.items.map(e=>kf(e))):t}class Ps extends hn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Rn.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==yt.object){const c=this._getOrReturnCtx(e);return ct(c,{code:ze.invalid_type,expected:yt.object,received:c.parsedType}),qt}const{status:s,ctx:r}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof jc&&this._def.unknownKeys==="strip"))for(const c in r.data)o.includes(c)||a.push(c);const l=[];for(const c of o){const d=i[c],h=r.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new Ll(r,h,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof jc){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of a)l.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(c==="strict")a.length>0&&(ct(r,{code:ze.unrecognized_keys,keys:a}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of a){const h=r.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new Ll(r,h,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of l){const h=await d.key,f=await d.value;c.push({key:h,value:f,alwaysSet:d.alwaysSet})}return c}).then(c=>si.mergeObjectSync(s,c)):si.mergeObjectSync(s,l)}get shape(){return this._def.shape()}strict(e){return $t.errToObj,new Ps({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,s)=>{var r,i,o,a;const l=(o=(i=(r=this._def).errorMap)===null||i===void 0?void 0:i.call(r,n,s).message)!==null&&o!==void 0?o:s.defaultError;return n.code==="unrecognized_keys"?{message:(a=$t.errToObj(e).message)!==null&&a!==void 0?a:l}:{message:l}}}:{}})}strip(){return new Ps({...this._def,unknownKeys:"strip"})}passthrough(){return new Ps({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ps({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ps({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ut.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new Ps({...this._def,catchall:e})}pick(e){const n={};return Rn.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(n[s]=this.shape[s])}),new Ps({...this._def,shape:()=>n})}omit(e){const n={};return Rn.objectKeys(this.shape).forEach(s=>{e[s]||(n[s]=this.shape[s])}),new Ps({...this._def,shape:()=>n})}deepPartial(){return kf(this)}partial(e){const n={};return Rn.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?n[s]=r:n[s]=r.optional()}),new Ps({...this._def,shape:()=>n})}required(e){const n={};return Rn.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])n[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Al;)i=i._def.innerType;n[s]=i}}),new Ps({...this._def,shape:()=>n})}keyof(){return zK(Rn.objectKeys(this.shape))}}Ps.create=(t,e)=>new Ps({shape:()=>t,unknownKeys:"strip",catchall:jc.create(),typeName:Ut.ZodObject,...sn(e)});Ps.strictCreate=(t,e)=>new Ps({shape:()=>t,unknownKeys:"strict",catchall:jc.create(),typeName:Ut.ZodObject,...sn(e)});Ps.lazycreate=(t,e)=>new Ps({shape:t,unknownKeys:"strip",catchall:jc.create(),typeName:Ut.ZodObject,...sn(e)});class J0 extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),s=this._def.options;function r(i){for(const a of i)if(a.result.status==="valid")return a.result;for(const a of i)if(a.result.status==="dirty")return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(a=>new _o(a.ctx.common.issues));return ct(n,{code:ze.invalid_union,unionErrors:o}),qt}if(n.common.async)return Promise.all(s.map(async i=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(r);{let i;const o=[];for(const l of s){const c={...n,common:{...n.common,issues:[]},parent:null},d=l._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;const a=o.map(l=>new _o(l));return ct(n,{code:ze.invalid_union,unionErrors:a}),qt}}get options(){return this._def.options}}J0.create=(t,e)=>new J0({options:t,typeName:Ut.ZodUnion,...sn(e)});const Jl=t=>t instanceof nx?Jl(t.schema):t instanceof Qa?Jl(t.innerType()):t instanceof sx?[t.value]:t instanceof Ju?t.options:t instanceof rx?Rn.objectValues(t.enum):t instanceof ix?Jl(t._def.innerType):t instanceof Q0?[void 0]:t instanceof Z0?[null]:t instanceof Al?[void 0,...Jl(t.unwrap())]:t instanceof ed?[null,...Jl(t.unwrap())]:t instanceof l3||t instanceof ax?Jl(t.unwrap()):t instanceof ox?Jl(t._def.innerType):[];class e2 extends hn{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==yt.object)return ct(n,{code:ze.invalid_type,expected:yt.object,received:n.parsedType}),qt;const s=this.discriminator,r=n.data[s],i=this.optionsMap.get(r);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(ct(n,{code:ze.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),qt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,s){const r=new Map;for(const i of n){const o=Jl(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(r.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);r.set(a,i)}}return new e2({typeName:Ut.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:r,...sn(s)})}}function hT(t,e){const n=oc(t),s=oc(e);if(t===e)return{valid:!0,data:t};if(n===yt.object&&s===yt.object){const r=Rn.objectKeys(e),i=Rn.objectKeys(t).filter(a=>r.indexOf(a)!==-1),o={...t,...e};for(const a of i){const l=hT(t[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(n===yt.array&&s===yt.array){if(t.length!==e.length)return{valid:!1};const r=[];for(let i=0;i<t.length;i++){const o=t[i],a=e[i],l=hT(o,a);if(!l.valid)return{valid:!1};r.push(l.data)}return{valid:!0,data:r}}else return n===yt.date&&s===yt.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class ex extends hn{_parse(e){const{status:n,ctx:s}=this._processInputParams(e),r=(i,o)=>{if(uT(i)||uT(o))return qt;const a=hT(i.value,o.value);return a.valid?((dT(i)||dT(o))&&n.dirty(),{status:n.value,value:a.data}):(ct(s,{code:ze.invalid_intersection_types}),qt)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>r(i,o)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}ex.create=(t,e,n)=>new ex({left:t,right:e,typeName:Ut.ZodIntersection,...sn(n)});class Bl extends hn{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==yt.array)return ct(s,{code:ze.invalid_type,expected:yt.array,received:s.parsedType}),qt;if(s.data.length<this._def.items.length)return ct(s,{code:ze.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),qt;!this._def.rest&&s.data.length>this._def.items.length&&(ct(s,{code:ze.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const i=[...s.data].map((o,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new Ll(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>si.mergeArray(n,o)):si.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new Bl({...this._def,rest:e})}}Bl.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Bl({items:t,typeName:Ut.ZodTuple,rest:null,...sn(e)})};class tx extends hn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==yt.object)return ct(s,{code:ze.invalid_type,expected:yt.object,received:s.parsedType}),qt;const r=[],i=this._def.keyType,o=this._def.valueType;for(const a in s.data)r.push({key:i._parse(new Ll(s,a,s.path,a)),value:o._parse(new Ll(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?si.mergeObjectAsync(n,r):si.mergeObjectSync(n,r)}get element(){return this._def.valueType}static create(e,n,s){return n instanceof hn?new tx({keyType:e,valueType:n,typeName:Ut.ZodRecord,...sn(s)}):new tx({keyType:La.create(),valueType:e,typeName:Ut.ZodRecord,...sn(n)})}}class _w extends hn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==yt.map)return ct(s,{code:ze.invalid_type,expected:yt.map,received:s.parsedType}),qt;const r=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([a,l],c)=>({key:r._parse(new Ll(s,a,s.path,[c,"key"])),value:i._parse(new Ll(s,l,s.path,[c,"value"]))}));if(s.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of o){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return qt;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}})}else{const a=new Map;for(const l of o){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return qt;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),a.set(c.value,d.value)}return{status:n.value,value:a}}}}_w.create=(t,e,n)=>new _w({valueType:e,keyType:t,typeName:Ut.ZodMap,...sn(n)});class Ah extends hn{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.parsedType!==yt.set)return ct(s,{code:ze.invalid_type,expected:yt.set,received:s.parsedType}),qt;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(ct(s,{code:ze.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),n.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(ct(s,{code:ze.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),n.dirty());const i=this._def.valueType;function o(l){const c=new Set;for(const d of l){if(d.status==="aborted")return qt;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}const a=[...s.data.values()].map((l,c)=>i._parse(new Ll(s,l,s.path,c)));return s.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,n){return new Ah({...this._def,minSize:{value:e,message:$t.toString(n)}})}max(e,n){return new Ah({...this._def,maxSize:{value:e,message:$t.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Ah.create=(t,e)=>new Ah({valueType:t,minSize:null,maxSize:null,typeName:Ut.ZodSet,...sn(e)});class cp extends hn{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==yt.function)return ct(n,{code:ze.invalid_type,expected:yt.function,received:n.parsedType}),qt;function s(a,l){return Cw({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Sw(),Yp].filter(c=>!!c),issueData:{code:ze.invalid_arguments,argumentsError:l}})}function r(a,l){return Cw({data:a,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Sw(),Yp].filter(c=>!!c),issueData:{code:ze.invalid_return_type,returnTypeError:l}})}const i={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof Zp){const a=this;return Ci(async function(...l){const c=new _o([]),d=await a._def.args.parseAsync(l,i).catch(p=>{throw c.addIssue(s(l,p)),c}),h=await Reflect.apply(o,this,d);return await a._def.returns._def.type.parseAsync(h,i).catch(p=>{throw c.addIssue(r(h,p)),c})})}else{const a=this;return Ci(function(...l){const c=a._def.args.safeParse(l,i);if(!c.success)throw new _o([s(l,c.error)]);const d=Reflect.apply(o,this,c.data),h=a._def.returns.safeParse(d,i);if(!h.success)throw new _o([r(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new cp({...this._def,args:Bl.create(e).rest(ah.create())})}returns(e){return new cp({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,s){return new cp({args:e||Bl.create([]).rest(ah.create()),returns:n||ah.create(),typeName:Ut.ZodFunction,...sn(s)})}}class nx extends hn{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}nx.create=(t,e)=>new nx({getter:t,typeName:Ut.ZodLazy,...sn(e)});class sx extends hn{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return ct(n,{received:n.data,code:ze.invalid_literal,expected:this._def.value}),qt}return{status:"valid",value:e.data}}get value(){return this._def.value}}sx.create=(t,e)=>new sx({value:t,typeName:Ut.ZodLiteral,...sn(e)});function zK(t,e){return new Ju({values:t,typeName:Ut.ZodEnum,...sn(e)})}class Ju extends hn{constructor(){super(...arguments),wg.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),s=this._def.values;return ct(n,{expected:Rn.joinValues(s),received:n.parsedType,code:ze.invalid_type}),qt}if(kw(this,wg)||MK(this,wg,new Set(this._def.values)),!kw(this,wg).has(e.data)){const n=this._getOrReturnCtx(e),s=this._def.values;return ct(n,{received:n.data,code:ze.invalid_enum_value,options:s}),qt}return Ci(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Ju.create(e,{...this._def,...n})}exclude(e,n=this._def){return Ju.create(this.options.filter(s=>!e.includes(s)),{...this._def,...n})}}wg=new WeakMap;Ju.create=zK;class rx extends hn{constructor(){super(...arguments),Sg.set(this,void 0)}_parse(e){const n=Rn.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==yt.string&&s.parsedType!==yt.number){const r=Rn.objectValues(n);return ct(s,{expected:Rn.joinValues(r),received:s.parsedType,code:ze.invalid_type}),qt}if(kw(this,Sg)||MK(this,Sg,new Set(Rn.getValidEnumValues(this._def.values))),!kw(this,Sg).has(e.data)){const r=Rn.objectValues(n);return ct(s,{received:s.data,code:ze.invalid_enum_value,options:r}),qt}return Ci(e.data)}get enum(){return this._def.values}}Sg=new WeakMap;rx.create=(t,e)=>new rx({values:t,typeName:Ut.ZodNativeEnum,...sn(e)});class Zp extends hn{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==yt.promise&&n.common.async===!1)return ct(n,{code:ze.invalid_type,expected:yt.promise,received:n.parsedType}),qt;const s=n.parsedType===yt.promise?n.data:Promise.resolve(n.data);return Ci(s.then(r=>this._def.type.parseAsync(r,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Zp.create=(t,e)=>new Zp({type:t,typeName:Ut.ZodPromise,...sn(e)});class Qa extends hn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ut.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:s}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:o=>{ct(s,o),o.fatal?n.abort():n.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),r.type==="preprocess"){const o=r.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async a=>{if(n.value==="aborted")return qt;const l=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return l.status==="aborted"?qt:l.status==="dirty"||n.value==="dirty"?Gf(l.value):l});{if(n.value==="aborted")return qt;const a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?qt:a.status==="dirty"||n.value==="dirty"?Gf(a.value):a}}if(r.type==="refinement"){const o=a=>{const l=r.refinement(a,i);if(s.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?qt:(a.status==="dirty"&&n.dirty(),o(a.value),{status:n.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?qt:(a.status==="dirty"&&n.dirty(),o(a.value).then(()=>({status:n.value,value:a.value}))))}if(r.type==="transform")if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Rh(o))return o;const a=r.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>Rh(o)?Promise.resolve(r.transform(o.value,i)).then(a=>({status:n.value,value:a})):o);Rn.assertNever(r)}}Qa.create=(t,e,n)=>new Qa({schema:t,typeName:Ut.ZodEffects,effect:e,...sn(n)});Qa.createWithPreprocess=(t,e,n)=>new Qa({schema:e,effect:{type:"preprocess",transform:t},typeName:Ut.ZodEffects,...sn(n)});class Al extends hn{_parse(e){return this._getType(e)===yt.undefined?Ci(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Al.create=(t,e)=>new Al({innerType:t,typeName:Ut.ZodOptional,...sn(e)});class ed extends hn{_parse(e){return this._getType(e)===yt.null?Ci(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ed.create=(t,e)=>new ed({innerType:t,typeName:Ut.ZodNullable,...sn(e)});class ix extends hn{_parse(e){const{ctx:n}=this._processInputParams(e);let s=n.data;return n.parsedType===yt.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ix.create=(t,e)=>new ix({innerType:t,typeName:Ut.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...sn(e)});class ox extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),s={...n,common:{...n.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return X0(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new _o(s.common.issues)},input:s.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new _o(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}ox.create=(t,e)=>new ox({innerType:t,typeName:Ut.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...sn(e)});class Ew extends hn{_parse(e){if(this._getType(e)!==yt.nan){const s=this._getOrReturnCtx(e);return ct(s,{code:ze.invalid_type,expected:yt.nan,received:s.parsedType}),qt}return{status:"valid",value:e.data}}}Ew.create=t=>new Ew({typeName:Ut.ZodNaN,...sn(t)});const I8e=Symbol("zod_brand");class l3 extends hn{_parse(e){const{ctx:n}=this._processInputParams(e),s=n.data;return this._def.type._parse({data:s,path:n.path,parent:n})}unwrap(){return this._def.type}}class Qx extends hn{_parse(e){const{status:n,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?qt:i.status==="dirty"?(n.dirty(),Gf(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?qt:r.status==="dirty"?(n.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,n){return new Qx({in:e,out:n,typeName:Ut.ZodPipeline})}}class ax extends hn{_parse(e){const n=this._def.innerType._parse(e),s=r=>(Rh(r)&&(r.value=Object.freeze(r.value)),r);return X0(n)?n.then(r=>s(r)):s(n)}unwrap(){return this._def.innerType}}ax.create=(t,e)=>new ax({innerType:t,typeName:Ut.ZodReadonly,...sn(e)});function M4(t,e){const n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function WK(t,e={},n){return t?Qp.create().superRefine((s,r)=>{var i,o;const a=t(s);if(a instanceof Promise)return a.then(l=>{var c,d;if(!l){const h=M4(e,s),f=(d=(c=h.fatal)!==null&&c!==void 0?c:n)!==null&&d!==void 0?d:!0;r.addIssue({code:"custom",...h,fatal:f})}});if(!a){const l=M4(e,s),c=(o=(i=l.fatal)!==null&&i!==void 0?i:n)!==null&&o!==void 0?o:!0;r.addIssue({code:"custom",...l,fatal:c})}}):Qp.create()}const R8e={object:Ps.lazycreate};var Ut;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Ut||(Ut={}));const P8e=(t,e={message:`Input not instance of ${t.name}`})=>WK(n=>n instanceof t,e),UK=La.create,HK=Qu.create,A8e=Ew.create,j8e=Zu.create,GK=Y0.create,D8e=Ph.create,O8e=Nw.create,F8e=Q0.create,M8e=Z0.create,L8e=Qp.create,B8e=ah.create,V8e=jc.create,z8e=Tw.create,W8e=Ha.create,U8e=Ps.create,H8e=Ps.strictCreate,G8e=J0.create,K8e=e2.create,q8e=ex.create,X8e=Bl.create,Y8e=tx.create,Q8e=_w.create,Z8e=Ah.create,J8e=cp.create,eHe=nx.create,tHe=sx.create,nHe=Ju.create,sHe=rx.create,rHe=Zp.create,L4=Qa.create,iHe=Al.create,oHe=ed.create,aHe=Qa.createWithPreprocess,lHe=Qx.create,cHe=()=>UK().optional(),uHe=()=>HK().optional(),dHe=()=>GK().optional(),hHe={string:t=>La.create({...t,coerce:!0}),number:t=>Qu.create({...t,coerce:!0}),boolean:t=>Y0.create({...t,coerce:!0}),bigint:t=>Zu.create({...t,coerce:!0}),date:t=>Ph.create({...t,coerce:!0})},fHe=qt;var Ts=Object.freeze({__proto__:null,defaultErrorMap:Yp,setErrorMap:a8e,getErrorMap:Sw,makeIssue:Cw,EMPTY_PATH:l8e,addIssueToContext:ct,ParseStatus:si,INVALID:qt,DIRTY:Gf,OK:Ci,isAborted:uT,isDirty:dT,isValid:Rh,isAsync:X0,get util(){return Rn},get objectUtil(){return cT},ZodParsedType:yt,getParsedType:oc,ZodType:hn,datetimeRegex:VK,ZodString:La,ZodNumber:Qu,ZodBigInt:Zu,ZodBoolean:Y0,ZodDate:Ph,ZodSymbol:Nw,ZodUndefined:Q0,ZodNull:Z0,ZodAny:Qp,ZodUnknown:ah,ZodNever:jc,ZodVoid:Tw,ZodArray:Ha,ZodObject:Ps,ZodUnion:J0,ZodDiscriminatedUnion:e2,ZodIntersection:ex,ZodTuple:Bl,ZodRecord:tx,ZodMap:_w,ZodSet:Ah,ZodFunction:cp,ZodLazy:nx,ZodLiteral:sx,ZodEnum:Ju,ZodNativeEnum:rx,ZodPromise:Zp,ZodEffects:Qa,ZodTransformer:Qa,ZodOptional:Al,ZodNullable:ed,ZodDefault:ix,ZodCatch:ox,ZodNaN:Ew,BRAND:I8e,ZodBranded:l3,ZodPipeline:Qx,ZodReadonly:ax,custom:WK,Schema:hn,ZodSchema:hn,late:R8e,get ZodFirstPartyTypeKind(){return Ut},coerce:hHe,any:L8e,array:W8e,bigint:j8e,boolean:GK,date:D8e,discriminatedUnion:K8e,effect:L4,enum:nHe,function:J8e,instanceof:P8e,intersection:q8e,lazy:eHe,literal:tHe,map:Q8e,nan:A8e,nativeEnum:sHe,never:V8e,null:M8e,nullable:oHe,number:HK,object:U8e,oboolean:dHe,onumber:uHe,optional:iHe,ostring:cHe,pipeline:lHe,preprocess:aHe,promise:rHe,record:Y8e,set:Z8e,strictObject:H8e,string:UK,symbol:O8e,transformer:L4,tuple:X8e,undefined:F8e,union:G8e,unknown:B8e,void:z8e,NEVER:fHe,ZodIssueCode:ze,quotelessJson:o8e,ZodError:_o});const B4=(t,e,n)=>{if(t&&"reportValidity"in t){const s=ot(n,e);t.setCustomValidity(s&&s.message||""),t.reportValidity()}},KK=(t,e)=>{for(const n in e.fields){const s=e.fields[n];s&&s.ref&&"reportValidity"in s.ref?B4(s.ref,n,t):s.refs&&s.refs.forEach(r=>B4(r,n,t))}},pHe=(t,e)=>{e.shouldUseNativeValidation&&KK(t,e);const n={};for(const s in t){const r=ot(e.fields,s),i=Object.assign(t[s]||{},{ref:r&&r.ref});if(mHe(e.names||Object.keys(t),s)){const o=Object.assign({},ot(n,s));Wn(o,"root",i),Wn(n,s,o)}else Wn(n,s,i)}return n},mHe=(t,e)=>t.some(n=>n.startsWith(e+"."));var gHe=function(t,e){for(var n={};t.length;){var s=t[0],r=s.code,i=s.message,o=s.path.join(".");if(!n[o])if("unionErrors"in s){var a=s.unionErrors[0].errors[0];n[o]={message:a.message,type:a.code}}else n[o]={message:i,type:r};if("unionErrors"in s&&s.unionErrors.forEach(function(d){return d.errors.forEach(function(h){return t.push(h)})}),e){var l=n[o].types,c=l&&l[s.code];n[o]=IK(o,e,n,r,c?[].concat(c,s.message):s.message)}t.shift()}return n},c3=function(t,e,n){return n===void 0&&(n={}),function(s,r,i){try{return Promise.resolve(function(o,a){try{var l=Promise.resolve(t[n.mode==="sync"?"parse":"parseAsync"](s,e)).then(function(c){return i.shouldUseNativeValidation&&KK({},i),{errors:{},values:n.raw?s:c}})}catch(c){return a(c)}return l&&l.then?l.then(void 0,a):l}(0,function(o){if(function(a){return Array.isArray(a==null?void 0:a.errors)}(o))return{values:{},errors:pHe(gHe(o.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw o}))}catch(o){return Promise.reject(o)}}},xHe="Label",qK=b.forwardRef((t,e)=>u.jsx(Mt.label,{...t,ref:e,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=t.onMouseDown)==null||r.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));qK.displayName=xHe;var XK=qK;const yHe=Sx("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),dl=b.forwardRef(({className:t,...e},n)=>u.jsx(XK,{ref:n,className:Pt(yHe(),t),...e}));dl.displayName=XK.displayName;const YK=zUe,QK=b.createContext({}),Zo=({...t})=>u.jsx(QK.Provider,{value:{name:t.name},children:u.jsx(GUe,{...t})}),t2=()=>{const t=b.useContext(QK),e=b.useContext(ZK),{getFieldState:n,formState:s}=J1(),r=n(t.name,s);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=e;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...r}},ZK=b.createContext({}),fo=b.forwardRef(({className:t,...e},n)=>{const s=b.useId();return u.jsx(ZK.Provider,{value:{id:s},children:u.jsx("div",{ref:n,className:Pt("space-y-2",t),...e})})});fo.displayName="FormItem";const Bi=b.forwardRef(({className:t,...e},n)=>{const{error:s,formItemId:r}=t2();return u.jsx(dl,{ref:n,className:Pt(s&&"text-destructive",t),htmlFor:r,...e})});Bi.displayName="FormLabel";const po=b.forwardRef(({...t},e)=>{const{error:n,formItemId:s,formDescriptionId:r,formMessageId:i}=t2();return u.jsx(iV,{ref:e,id:s,"aria-describedby":n?`${r} ${i}`:`${r}`,"aria-invalid":!!n,...t})});po.displayName="FormControl";const vHe=b.forwardRef(({className:t,...e},n)=>{const{formDescriptionId:s}=t2();return u.jsx("p",{ref:n,id:s,className:Pt("text-sm text-muted-foreground",t),...e})});vHe.displayName="FormDescription";const mo=b.forwardRef(({className:t,children:e,...n},s)=>{const{error:r,formMessageId:i}=t2(),o=r?String((r==null?void 0:r.message)??""):e;return o?u.jsx("p",{ref:s,id:i,className:Pt("text-sm font-medium text-destructive",t),...n,children:o}):null});mo.displayName="FormMessage";function V4(t,[e,n]){return Math.min(n,Math.max(e,t))}function u3(t){const e=b.useRef({value:t,previous:t});return b.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var bHe=[" ","Enter","ArrowUp","ArrowDown"],wHe=[" ","Enter"],Zx="Select",[n2,s2,SHe]=Jw(Zx),[Em,P7e]=Ao(Zx,[SHe,lm]),r2=lm(),[CHe,dd]=Em(Zx),[kHe,NHe]=Em(Zx),JK=t=>{const{__scopeSelect:e,children:n,open:s,defaultOpen:r,onOpenChange:i,value:o,defaultValue:a,onValueChange:l,dir:c,name:d,autoComplete:h,disabled:f,required:p,form:m}=t,g=r2(e),[x,y]=b.useState(null),[v,S]=b.useState(null),[C,k]=b.useState(!1),T=Gx(c),[_=!1,$]=Sc({prop:s,defaultProp:r,onChange:i}),[R,A]=Sc({prop:o,defaultProp:a,onChange:l}),j=b.useRef(null),F=x?m||!!x.closest("form"):!0,[L,M]=b.useState(new Set),q=Array.from(L).map(z=>z.props.value).join(";");return u.jsx(yz,{...g,children:u.jsxs(CHe,{required:p,scope:e,trigger:x,onTriggerChange:y,valueNode:v,onValueNodeChange:S,valueNodeHasChildren:C,onValueNodeHasChildrenChange:k,contentId:Tl(),value:R,onValueChange:A,open:_,onOpenChange:$,dir:T,triggerPointerDownPosRef:j,disabled:f,children:[u.jsx(n2.Provider,{scope:e,children:u.jsx(kHe,{scope:t.__scopeSelect,onNativeOptionAdd:b.useCallback(z=>{M(re=>new Set(re).add(z))},[]),onNativeOptionRemove:b.useCallback(z=>{M(re=>{const U=new Set(re);return U.delete(z),U})},[]),children:n})}),F?u.jsxs(kq,{"aria-hidden":!0,required:p,tabIndex:-1,name:d,autoComplete:h,value:R,onChange:z=>A(z.target.value),disabled:f,form:m,children:[R===void 0?u.jsx("option",{value:""}):null,Array.from(L)]},q):null]})})};JK.displayName=Zx;var eq="SelectTrigger",tq=b.forwardRef((t,e)=>{const{__scopeSelect:n,disabled:s=!1,...r}=t,i=r2(n),o=dd(eq,n),a=o.disabled||s,l=Pn(e,o.onTriggerChange),c=s2(n),d=b.useRef("touch"),[h,f,p]=Nq(g=>{const x=c().filter(S=>!S.disabled),y=x.find(S=>S.value===o.value),v=Tq(x,g,y);v!==void 0&&o.onValueChange(v.value)}),m=g=>{a||(o.onOpenChange(!0),p()),g&&(o.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return u.jsx(M_,{asChild:!0,...i,children:u.jsx(Mt.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":Cq(o.value)?"":void 0,...r,ref:l,onClick:nt(r.onClick,g=>{g.currentTarget.focus(),d.current!=="mouse"&&m(g)}),onPointerDown:nt(r.onPointerDown,g=>{d.current=g.pointerType;const x=g.target;x.hasPointerCapture(g.pointerId)&&x.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(m(g),g.preventDefault())}),onKeyDown:nt(r.onKeyDown,g=>{const x=h.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&f(g.key),!(x&&g.key===" ")&&bHe.includes(g.key)&&(m(),g.preventDefault())})})})});tq.displayName=eq;var nq="SelectValue",sq=b.forwardRef((t,e)=>{const{__scopeSelect:n,className:s,style:r,children:i,placeholder:o="",...a}=t,l=dd(nq,n),{onValueNodeHasChildrenChange:c}=l,d=i!==void 0,h=Pn(e,l.onValueNodeChange);return ti(()=>{c(d)},[c,d]),u.jsx(Mt.span,{...a,ref:h,style:{pointerEvents:"none"},children:Cq(l.value)?u.jsx(u.Fragment,{children:o}):i})});sq.displayName=nq;var THe="SelectIcon",rq=b.forwardRef((t,e)=>{const{__scopeSelect:n,children:s,...r}=t;return u.jsx(Mt.span,{"aria-hidden":!0,...r,ref:e,children:s||"▼"})});rq.displayName=THe;var _He="SelectPortal",iq=t=>u.jsx(bx,{asChild:!0,...t});iq.displayName=_He;var jh="SelectContent",oq=b.forwardRef((t,e)=>{const n=dd(jh,t.__scopeSelect),[s,r]=b.useState();if(ti(()=>{r(new DocumentFragment)},[]),!n.open){const i=s;return i?Fh.createPortal(u.jsx(aq,{scope:t.__scopeSelect,children:u.jsx(n2.Slot,{scope:t.__scopeSelect,children:u.jsx("div",{children:t.children})})}),i):null}return u.jsx(lq,{...t,ref:e})});oq.displayName=jh;var Na=10,[aq,hd]=Em(jh),EHe="SelectContentImpl",$He=mh("SelectContent.RemoveScroll"),lq=b.forwardRef((t,e)=>{const{__scopeSelect:n,position:s="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:i,onPointerDownOutside:o,side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:f,collisionPadding:p,sticky:m,hideWhenDetached:g,avoidCollisions:x,...y}=t,v=dd(jh,n),[S,C]=b.useState(null),[k,T]=b.useState(null),_=Pn(e,ce=>C(ce)),[$,R]=b.useState(null),[A,j]=b.useState(null),F=s2(n),[L,M]=b.useState(!1),q=b.useRef(!1);b.useEffect(()=>{if(S)return LP(S)},[S]),MP();const z=b.useCallback(ce=>{const[me,...ie]=F().map(ae=>ae.ref.current),[Q]=ie.slice(-1),oe=document.activeElement;for(const ae of ce)if(ae===oe||(ae==null||ae.scrollIntoView({block:"nearest"}),ae===me&&k&&(k.scrollTop=0),ae===Q&&k&&(k.scrollTop=k.scrollHeight),ae==null||ae.focus(),document.activeElement!==oe))return},[F,k]),re=b.useCallback(()=>z([$,S]),[z,$,S]);b.useEffect(()=>{L&&re()},[L,re]);const{onOpenChange:U,triggerPointerDownPosRef:G}=v;b.useEffect(()=>{if(S){let ce={x:0,y:0};const me=Q=>{var oe,ae;ce={x:Math.abs(Math.round(Q.pageX)-(((oe=G.current)==null?void 0:oe.x)??0)),y:Math.abs(Math.round(Q.pageY)-(((ae=G.current)==null?void 0:ae.y)??0))}},ie=Q=>{ce.x<=10&&ce.y<=10?Q.preventDefault():S.contains(Q.target)||U(!1),document.removeEventListener("pointermove",me),G.current=null};return G.current!==null&&(document.addEventListener("pointermove",me),document.addEventListener("pointerup",ie,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",me),document.removeEventListener("pointerup",ie,{capture:!0})}}},[S,U,G]),b.useEffect(()=>{const ce=()=>U(!1);return window.addEventListener("blur",ce),window.addEventListener("resize",ce),()=>{window.removeEventListener("blur",ce),window.removeEventListener("resize",ce)}},[U]);const[xe,Ce]=Nq(ce=>{const me=F().filter(oe=>!oe.disabled),ie=me.find(oe=>oe.ref.current===document.activeElement),Q=Tq(me,ce,ie);Q&&setTimeout(()=>Q.ref.current.focus())}),De=b.useCallback((ce,me,ie)=>{const Q=!q.current&&!ie;(v.value!==void 0&&v.value===me||Q)&&(R(ce),Q&&(q.current=!0))},[v.value]),fe=b.useCallback(()=>S==null?void 0:S.focus(),[S]),ee=b.useCallback((ce,me,ie)=>{const Q=!q.current&&!ie;(v.value!==void 0&&v.value===me||Q)&&j(ce)},[v.value]),Pe=s==="popper"?fT:cq,Re=Pe===fT?{side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:f,collisionPadding:p,sticky:m,hideWhenDetached:g,avoidCollisions:x}:{};return u.jsx(aq,{scope:n,content:S,viewport:k,onViewportChange:T,itemRefCallback:De,selectedItem:$,onItemLeave:fe,itemTextRefCallback:ee,focusSelectedItem:re,selectedItemText:A,position:s,isPositioned:L,searchRef:xe,children:u.jsx(K1,{as:$He,allowPinchZoom:!0,children:u.jsx(H1,{asChild:!0,trapped:v.open,onMountAutoFocus:ce=>{ce.preventDefault()},onUnmountAutoFocus:nt(r,ce=>{var me;(me=v.trigger)==null||me.focus({preventScroll:!0}),ce.preventDefault()}),children:u.jsx(rm,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:ce=>ce.preventDefault(),onDismiss:()=>v.onOpenChange(!1),children:u.jsx(Pe,{role:"listbox",id:v.contentId,"data-state":v.open?"open":"closed",dir:v.dir,onContextMenu:ce=>ce.preventDefault(),...y,...Re,onPlaced:()=>M(!0),ref:_,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:nt(y.onKeyDown,ce=>{const me=ce.ctrlKey||ce.altKey||ce.metaKey;if(ce.key==="Tab"&&ce.preventDefault(),!me&&ce.key.length===1&&Ce(ce.key),["ArrowUp","ArrowDown","Home","End"].includes(ce.key)){let Q=F().filter(oe=>!oe.disabled).map(oe=>oe.ref.current);if(["ArrowUp","End"].includes(ce.key)&&(Q=Q.slice().reverse()),["ArrowUp","ArrowDown"].includes(ce.key)){const oe=ce.target,ae=Q.indexOf(oe);Q=Q.slice(ae+1)}setTimeout(()=>z(Q)),ce.preventDefault()}})})})})})})});lq.displayName=EHe;var IHe="SelectItemAlignedPosition",cq=b.forwardRef((t,e)=>{const{__scopeSelect:n,onPlaced:s,...r}=t,i=dd(jh,n),o=hd(jh,n),[a,l]=b.useState(null),[c,d]=b.useState(null),h=Pn(e,_=>d(_)),f=s2(n),p=b.useRef(!1),m=b.useRef(!0),{viewport:g,selectedItem:x,selectedItemText:y,focusSelectedItem:v}=o,S=b.useCallback(()=>{if(i.trigger&&i.valueNode&&a&&c&&g&&x&&y){const _=i.trigger.getBoundingClientRect(),$=c.getBoundingClientRect(),R=i.valueNode.getBoundingClientRect(),A=y.getBoundingClientRect();if(i.dir!=="rtl"){const oe=A.left-$.left,ae=R.left-oe,Ae=_.left-ae,Be=_.width+Ae,Xe=Math.max(Be,$.width),lt=window.innerWidth-Na,Me=V4(ae,[Na,Math.max(Na,lt-Xe)]);a.style.minWidth=Be+"px",a.style.left=Me+"px"}else{const oe=$.right-A.right,ae=window.innerWidth-R.right-oe,Ae=window.innerWidth-_.right-ae,Be=_.width+Ae,Xe=Math.max(Be,$.width),lt=window.innerWidth-Na,Me=V4(ae,[Na,Math.max(Na,lt-Xe)]);a.style.minWidth=Be+"px",a.style.right=Me+"px"}const j=f(),F=window.innerHeight-Na*2,L=g.scrollHeight,M=window.getComputedStyle(c),q=parseInt(M.borderTopWidth,10),z=parseInt(M.paddingTop,10),re=parseInt(M.borderBottomWidth,10),U=parseInt(M.paddingBottom,10),G=q+z+L+U+re,xe=Math.min(x.offsetHeight*5,G),Ce=window.getComputedStyle(g),De=parseInt(Ce.paddingTop,10),fe=parseInt(Ce.paddingBottom,10),ee=_.top+_.height/2-Na,Pe=F-ee,Re=x.offsetHeight/2,ce=x.offsetTop+Re,me=q+z+ce,ie=G-me;if(me<=ee){const oe=j.length>0&&x===j[j.length-1].ref.current;a.style.bottom="0px";const ae=c.clientHeight-g.offsetTop-g.offsetHeight,Ae=Math.max(Pe,Re+(oe?fe:0)+ae+re),Be=me+Ae;a.style.height=Be+"px"}else{const oe=j.length>0&&x===j[0].ref.current;a.style.top="0px";const Ae=Math.max(ee,q+g.offsetTop+(oe?De:0)+Re)+ie;a.style.height=Ae+"px",g.scrollTop=me-ee+g.offsetTop}a.style.margin=`${Na}px 0`,a.style.minHeight=xe+"px",a.style.maxHeight=F+"px",s==null||s(),requestAnimationFrame(()=>p.current=!0)}},[f,i.trigger,i.valueNode,a,c,g,x,y,i.dir,s]);ti(()=>S(),[S]);const[C,k]=b.useState();ti(()=>{c&&k(window.getComputedStyle(c).zIndex)},[c]);const T=b.useCallback(_=>{_&&m.current===!0&&(S(),v==null||v(),m.current=!1)},[S,v]);return u.jsx(PHe,{scope:n,contentWrapper:a,shouldExpandOnScrollRef:p,onScrollButtonChange:T,children:u.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:C},children:u.jsx(Mt.div,{...r,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});cq.displayName=IHe;var RHe="SelectPopperPosition",fT=b.forwardRef((t,e)=>{const{__scopeSelect:n,align:s="start",collisionPadding:r=Na,...i}=t,o=r2(n);return u.jsx(L_,{...o,...i,ref:e,align:s,collisionPadding:r,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});fT.displayName=RHe;var[PHe,d3]=Em(jh,{}),pT="SelectViewport",uq=b.forwardRef((t,e)=>{const{__scopeSelect:n,nonce:s,...r}=t,i=hd(pT,n),o=d3(pT,n),a=Pn(e,i.onViewportChange),l=b.useRef(0);return u.jsxs(u.Fragment,{children:[u.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),u.jsx(n2.Slot,{scope:n,children:u.jsx(Mt.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:nt(r.onScroll,c=>{const d=c.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:f}=o;if(f!=null&&f.current&&h){const p=Math.abs(l.current-d.scrollTop);if(p>0){const m=window.innerHeight-Na*2,g=parseFloat(h.style.minHeight),x=parseFloat(h.style.height),y=Math.max(g,x);if(y<m){const v=y+p,S=Math.min(m,v),C=v-S;h.style.height=S+"px",h.style.bottom==="0px"&&(d.scrollTop=C>0?C:0,h.style.justifyContent="flex-end")}}}l.current=d.scrollTop})})})]})});uq.displayName=pT;var dq="SelectGroup",[AHe,jHe]=Em(dq),DHe=b.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,r=Tl();return u.jsx(AHe,{scope:n,id:r,children:u.jsx(Mt.div,{role:"group","aria-labelledby":r,...s,ref:e})})});DHe.displayName=dq;var hq="SelectLabel",fq=b.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,r=jHe(hq,n);return u.jsx(Mt.div,{id:r.id,...s,ref:e})});fq.displayName=hq;var $w="SelectItem",[OHe,pq]=Em($w),mq=b.forwardRef((t,e)=>{const{__scopeSelect:n,value:s,disabled:r=!1,textValue:i,...o}=t,a=dd($w,n),l=hd($w,n),c=a.value===s,[d,h]=b.useState(i??""),[f,p]=b.useState(!1),m=Pn(e,v=>{var S;return(S=l.itemRefCallback)==null?void 0:S.call(l,v,s,r)}),g=Tl(),x=b.useRef("touch"),y=()=>{r||(a.onValueChange(s),a.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return u.jsx(OHe,{scope:n,value:s,disabled:r,textId:g,isSelected:c,onItemTextChange:b.useCallback(v=>{h(S=>S||((v==null?void 0:v.textContent)??"").trim())},[]),children:u.jsx(n2.ItemSlot,{scope:n,value:s,disabled:r,textValue:d,children:u.jsx(Mt.div,{role:"option","aria-labelledby":g,"data-highlighted":f?"":void 0,"aria-selected":c&&f,"data-state":c?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:m,onFocus:nt(o.onFocus,()=>p(!0)),onBlur:nt(o.onBlur,()=>p(!1)),onClick:nt(o.onClick,()=>{x.current!=="mouse"&&y()}),onPointerUp:nt(o.onPointerUp,()=>{x.current==="mouse"&&y()}),onPointerDown:nt(o.onPointerDown,v=>{x.current=v.pointerType}),onPointerMove:nt(o.onPointerMove,v=>{var S;x.current=v.pointerType,r?(S=l.onItemLeave)==null||S.call(l):x.current==="mouse"&&v.currentTarget.focus({preventScroll:!0})}),onPointerLeave:nt(o.onPointerLeave,v=>{var S;v.currentTarget===document.activeElement&&((S=l.onItemLeave)==null||S.call(l))}),onKeyDown:nt(o.onKeyDown,v=>{var C;((C=l.searchRef)==null?void 0:C.current)!==""&&v.key===" "||(wHe.includes(v.key)&&y(),v.key===" "&&v.preventDefault())})})})})});mq.displayName=$w;var Cg="SelectItemText",gq=b.forwardRef((t,e)=>{const{__scopeSelect:n,className:s,style:r,...i}=t,o=dd(Cg,n),a=hd(Cg,n),l=pq(Cg,n),c=NHe(Cg,n),[d,h]=b.useState(null),f=Pn(e,y=>h(y),l.onItemTextChange,y=>{var v;return(v=a.itemTextRefCallback)==null?void 0:v.call(a,y,l.value,l.disabled)}),p=d==null?void 0:d.textContent,m=b.useMemo(()=>u.jsx("option",{value:l.value,disabled:l.disabled,children:p},l.value),[l.disabled,l.value,p]),{onNativeOptionAdd:g,onNativeOptionRemove:x}=c;return ti(()=>(g(m),()=>x(m)),[g,x,m]),u.jsxs(u.Fragment,{children:[u.jsx(Mt.span,{id:l.textId,...i,ref:f}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Fh.createPortal(i.children,o.valueNode):null]})});gq.displayName=Cg;var xq="SelectItemIndicator",yq=b.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t;return pq(xq,n).isSelected?u.jsx(Mt.span,{"aria-hidden":!0,...s,ref:e}):null});yq.displayName=xq;var mT="SelectScrollUpButton",vq=b.forwardRef((t,e)=>{const n=hd(mT,t.__scopeSelect),s=d3(mT,t.__scopeSelect),[r,i]=b.useState(!1),o=Pn(e,s.onScrollButtonChange);return ti(()=>{if(n.viewport&&n.isPositioned){let a=function(){const c=l.scrollTop>0;i(c)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?u.jsx(wq,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});vq.displayName=mT;var gT="SelectScrollDownButton",bq=b.forwardRef((t,e)=>{const n=hd(gT,t.__scopeSelect),s=d3(gT,t.__scopeSelect),[r,i]=b.useState(!1),o=Pn(e,s.onScrollButtonChange);return ti(()=>{if(n.viewport&&n.isPositioned){let a=function(){const c=l.scrollHeight-l.clientHeight,d=Math.ceil(l.scrollTop)<c;i(d)};const l=n.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[n.viewport,n.isPositioned]),r?u.jsx(wq,{...t,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=n;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});bq.displayName=gT;var wq=b.forwardRef((t,e)=>{const{__scopeSelect:n,onAutoScroll:s,...r}=t,i=hd("SelectScrollButton",n),o=b.useRef(null),a=s2(n),l=b.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return b.useEffect(()=>()=>l(),[l]),ti(()=>{var d;const c=a().find(h=>h.ref.current===document.activeElement);(d=c==null?void 0:c.ref.current)==null||d.scrollIntoView({block:"nearest"})},[a]),u.jsx(Mt.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:nt(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(s,50))}),onPointerMove:nt(r.onPointerMove,()=>{var c;(c=i.onItemLeave)==null||c.call(i),o.current===null&&(o.current=window.setInterval(s,50))}),onPointerLeave:nt(r.onPointerLeave,()=>{l()})})}),FHe="SelectSeparator",Sq=b.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t;return u.jsx(Mt.div,{"aria-hidden":!0,...s,ref:e})});Sq.displayName=FHe;var xT="SelectArrow",MHe=b.forwardRef((t,e)=>{const{__scopeSelect:n,...s}=t,r=r2(n),i=dd(xT,n),o=hd(xT,n);return i.open&&o.position==="popper"?u.jsx(B_,{...r,...s,ref:e}):null});MHe.displayName=xT;function Cq(t){return t===""||t===void 0}var kq=b.forwardRef((t,e)=>{const{value:n,...s}=t,r=b.useRef(null),i=Pn(e,r),o=u3(n);return b.useEffect(()=>{const a=r.current,l=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==n&&d){const h=new Event("change",{bubbles:!0});d.call(a,n),a.dispatchEvent(h)}},[o,n]),u.jsx(wx,{asChild:!0,children:u.jsx("select",{...s,ref:i,defaultValue:n})})});kq.displayName="BubbleSelect";function Nq(t){const e=ei(t),n=b.useRef(""),s=b.useRef(0),r=b.useCallback(o=>{const a=n.current+o;e(a),function l(c){n.current=c,window.clearTimeout(s.current),c!==""&&(s.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),i=b.useCallback(()=>{n.current="",window.clearTimeout(s.current)},[]);return b.useEffect(()=>()=>window.clearTimeout(s.current),[]),[n,r,i]}function Tq(t,e,n){const r=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=n?t.indexOf(n):-1;let o=LHe(t,Math.max(i,0));r.length===1&&(o=o.filter(c=>c!==n));const l=o.find(c=>c.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==n?l:void 0}function LHe(t,e){return t.map((n,s)=>t[(e+s)%t.length])}var BHe=JK,_q=tq,VHe=sq,zHe=rq,WHe=iq,Eq=oq,UHe=uq,$q=fq,Iq=mq,HHe=gq,GHe=yq,Rq=vq,Pq=bq,Aq=Sq;const Iw=BHe,Rw=VHe,lx=b.forwardRef(({className:t,children:e,...n},s)=>u.jsxs(_q,{ref:s,className:Pt("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[e,u.jsx(zHe,{asChild:!0,children:u.jsx(PV,{className:"h-4 w-4 opacity-50"})})]}));lx.displayName=_q.displayName;const jq=b.forwardRef(({className:t,...e},n)=>u.jsx(Rq,{ref:n,className:Pt("flex cursor-default items-center justify-center py-1",t),...e,children:u.jsx(oee,{className:"h-4 w-4"})}));jq.displayName=Rq.displayName;const Dq=b.forwardRef(({className:t,...e},n)=>u.jsx(Pq,{ref:n,className:Pt("flex cursor-default items-center justify-center py-1",t),...e,children:u.jsx(PV,{className:"h-4 w-4"})}));Dq.displayName=Pq.displayName;const cx=b.forwardRef(({className:t,children:e,position:n="popper",...s},r)=>u.jsx(WHe,{children:u.jsxs(Eq,{ref:r,className:Pt("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...s,children:[u.jsx(jq,{}),u.jsx(UHe,{className:Pt("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),u.jsx(Dq,{})]})}));cx.displayName=Eq.displayName;const KHe=b.forwardRef(({className:t,...e},n)=>u.jsx($q,{ref:n,className:Pt("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));KHe.displayName=$q.displayName;const ur=b.forwardRef(({className:t,children:e,...n},s)=>u.jsxs(Iq,{ref:s,className:Pt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(GHe,{children:u.jsx(n1,{className:"h-4 w-4"})})}),u.jsx(HHe,{children:e})]}));ur.displayName=Iq.displayName;const qHe=b.forwardRef(({className:t,...e},n)=>u.jsx(Aq,{ref:n,className:Pt("-mx-1 my-1 h-px bg-muted",t),...e}));qHe.displayName=Aq.displayName;function XHe({open:t,onOpenChange:e}){const[n,s]=b.useState(!1);return b.useEffect(()=>{if(t){const r=setTimeout(()=>{s(!0)},300);return()=>clearTimeout(r)}else s(!1)},[t]),u.jsx(zi,{open:t,onOpenChange:e,children:u.jsxs(pi,{className:"bg-gray-900 text-white border-red-900/30 sm:max-w-md",children:[u.jsxs(mi,{children:[u.jsx("div",{className:"mx-auto mb-4 relative",children:u.jsx("div",{className:`bg-red-600/20 rounded-full p-4 transition-all duration-500 ${n?"scale-100":"scale-0"}`,children:u.jsx("span",{className:"material-icons text-red-500 text-5xl",children:"devices"})})}),u.jsx(gi,{className:"text-xl text-center text-red-500",children:"Mobile Device Detected"}),u.jsx(yo,{className:"text-gray-300 text-center",children:"For the best experience with CoachT, we recommend using a laptop or tablet instead. The pose detection and detailed analysis features work optimally on larger screens."})]}),u.jsx("div",{className:"space-y-3 mb-3",children:u.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-sm",children:[u.jsxs("h4",{className:"font-semibold text-white mb-1 flex items-center",children:[u.jsx("span",{className:"material-icons text-red-500 mr-1 text-base",children:"warning"}),"Limited Functionality"]}),u.jsx("p",{className:"text-gray-300",children:"Some advanced features may be limited or unavailable on mobile devices due to camera constraints and processing requirements."})]})}),u.jsx(xo,{className:"sm:justify-center",children:u.jsx(Se,{onClick:()=>e(!1),className:"w-full bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white",children:"Continue Anyway"})})]})})}const YHe=b.createContext(null);function QHe(){const t=b.useContext(YHe);if(!t)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return t}function ZHe(t){var e;return(e=t==null?void 0:t.clientId)!==null&&e!==void 0?e:t==null?void 0:t.client_id}const JHe={large:40,medium:32,small:20};function eGe({onSuccess:t,onError:e,useOneTap:n,promptMomentNotification:s,type:r="standard",theme:i="outline",size:o="large",text:a,shape:l,logo_alignment:c,width:d,locale:h,click_listener:f,containerProps:p,...m}){const g=b.useRef(null),{clientId:x,scriptLoadedSuccessfully:y}=QHe(),v=b.useRef(t);v.current=t;const S=b.useRef(e);S.current=e;const C=b.useRef(s);return C.current=s,b.useEffect(()=>{var k,T,_,$,R,A,j,F,L;if(y)return(_=(T=(k=window==null?void 0:window.google)===null||k===void 0?void 0:k.accounts)===null||T===void 0?void 0:T.id)===null||_===void 0||_.initialize({client_id:x,callback:M=>{var q;if(!(M!=null&&M.credential))return(q=S.current)===null||q===void 0?void 0:q.call(S);const{credential:z,select_by:re}=M;v.current({credential:z,clientId:ZHe(M),select_by:re})},...m}),(A=(R=($=window==null?void 0:window.google)===null||$===void 0?void 0:$.accounts)===null||R===void 0?void 0:R.id)===null||A===void 0||A.renderButton(g.current,{type:r,theme:i,size:o,text:a,shape:l,logo_alignment:c,width:d,locale:h,click_listener:f}),n&&((L=(F=(j=window==null?void 0:window.google)===null||j===void 0?void 0:j.accounts)===null||F===void 0?void 0:F.id)===null||L===void 0||L.prompt(C.current)),()=>{var M,q,z;n&&((z=(q=(M=window==null?void 0:window.google)===null||M===void 0?void 0:M.accounts)===null||q===void 0?void 0:q.id)===null||z===void 0||z.cancel())}},[x,y,n,r,i,o,a,l,c,d,h]),zt.createElement("div",{...p,ref:g,style:{height:JHe[o],...p==null?void 0:p.style}})}Ts.object({username:Ts.string().min(3,"Username must be at least 3 characters"),password:Ts.string().min(6,"Password must be at least 6 characters")});const tGe=Ts.object({username:Ts.string().min(3,"Username must be at least 3 characters"),email:Ts.string().email("Please enter a valid email address"),password:Ts.string().min(6,"Password must be at least 6 characters"),confirmPassword:Ts.string().min(6,"Password must be at least 6 characters"),beltColor:Ts.string().optional(),experienceTime:Ts.string().optional()}).refine(t=>t.password===t.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});function z4(){var $;const{user:t,registerMutation:e,googleLoginMutation:n,showMobileWarning:s,setShowMobileWarning:r}=nf(),[,i]=Po(),[o,a]=b.useState("login"),[l,c]=b.useState(!1),[d,h]=b.useState(!0),[f,p]=b.useState(""),[m,g]=b.useState(!1),[x,y]=b.useState(!1),[v,S]=b.useState(!1),C=a3({resolver:c3(tGe),defaultValues:{username:"",email:"",password:"",confirmPassword:"",beltColor:"white",experienceTime:"less_than_1_year"}});b.useEffect(()=>{t&&i("/app")},[t,i]),b.useEffect(()=>{const R=()=>{c(window.innerWidth<768)};return R(),window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]),b.useEffect(()=>{let R="CoachT",A=0;y(!0);const j=setInterval(()=>{A<=R.length?(p(R.substring(0,A)),A++):(clearInterval(j),setTimeout(()=>{g(!0),setTimeout(()=>{h(!1)},800)},400))},150);return()=>clearInterval(j)},[]);const k=R=>{n.mutate(R)},T=()=>{console.error("Google login failed")},_=R=>{e.mutate(R)};return t?u.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col items-center justify-center overflow-hidden relative",children:[u.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[u.jsx("div",{className:"absolute top-0 left-0 w-1/3 h-1/3 bg-red-700/20 rounded-full blur-[120px] -translate-x-1/2 -translate-y-1/2"}),u.jsx("div",{className:"absolute bottom-0 right-0 w-1/3 h-1/3 bg-red-700/20 rounded-full blur-[120px] translate-x-1/2 translate-y-1/2"}),u.jsx("div",{className:"absolute top-1/2 left-1/2 w-1/3 h-1/3 bg-red-700/10 rounded-full blur-[150px] -translate-x-1/2 -translate-y-1/2"})]}),u.jsx(X.div,{className:"w-full max-w-md px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:u.jsxs(Ks,{className:"border-red-900/30 bg-gradient-to-br from-gray-900/80 to-black/80 backdrop-blur-lg shadow-[0_10px_30px_rgba(0,0,0,0.5)]",children:[u.jsxs(No,{className:"text-center",children:[u.jsx(To,{className:"text-2xl font-bold text-green-400",children:"✅ Successfully Logged In!"}),u.jsx(Ua,{className:"text-gray-300",children:"Redirecting to your dashboard..."})]}),u.jsxs(rr,{className:"text-center",children:[t.picture&&u.jsx("img",{src:t.picture,alt:"Profile",className:"w-16 h-16 rounded-full mx-auto mb-4 border-2 border-red-500"}),u.jsxs("p",{className:"text-white text-lg mb-2",children:["Welcome, ",u.jsx("span",{className:"font-semibold text-red-400",children:t.name||t.username}),"!"]}),t.email&&u.jsx("p",{className:"text-gray-400 text-sm",children:t.email})]})]})})]}):u.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col items-center justify-center overflow-hidden relative",children:[u.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[u.jsx("div",{className:"absolute top-0 left-0 w-1/3 h-1/3 bg-red-700/20 rounded-full blur-[120px] -translate-x-1/2 -translate-y-1/2"}),u.jsx("div",{className:"absolute bottom-0 right-0 w-1/3 h-1/3 bg-red-700/20 rounded-full blur-[120px] translate-x-1/2 translate-y-1/2"}),u.jsx("div",{className:"absolute top-1/2 left-1/2 w-1/3 h-1/3 bg-red-700/10 rounded-full blur-[150px] -translate-x-1/2 -translate-y-1/2"})]}),u.jsx(XHe,{open:s,onOpenChange:r}),d&&u.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black overflow-hidden",children:[u.jsx(X.div,{className:"absolute inset-x-0 top-0 h-full bg-gradient-to-b from-red-500 via-red-600 to-red-700",initial:{y:"-100%"},animate:{y:x?"0%":"-100%"},transition:{duration:1.2,ease:"easeInOut"}}),u.jsx(X.div,{className:`relative z-20 transition-all duration-500 ease-in-out flex flex-col items-center justify-center
              ${m?"scale-110":"scale-100"}`,initial:{opacity:0},animate:{opacity:1},transition:{delay:.5,duration:.8},children:u.jsxs("div",{className:`flex flex-col items-center justify-center transition-all duration-500 
              ${m?"ring-4 ring-black p-4 rounded-xl bg-red-600":""}`,children:[u.jsx("div",{className:`h-24 w-24 rounded-full bg-gradient-to-br from-red-700 to-red-600 flex items-center justify-center 
                shadow-[0_0_20px_rgba(220,38,38,0.6)] mb-4 transition-all duration-500
                ${m?"ring-2 ring-black":""}`,children:u.jsx("span",{className:"material-icons text-white text-5xl",children:"sports_martial_arts"})}),u.jsx("h1",{className:"text-6xl md:text-8xl font-bold relative inline-block text-white",children:u.jsxs("span",{className:"relative",children:[f,u.jsx("span",{className:"inline-block h-[0.8em] w-[3px] ml-[2px] align-middle bg-white animate-blink"})]})})]})})]}),!d&&u.jsxs(u.Fragment,{children:[u.jsx(X.div,{className:"relative z-10 mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"h-14 w-14 rounded-full bg-gradient-to-br from-red-700 to-red-600 flex items-center justify-center shadow-[0_0_20px_rgba(220,38,38,0.6)]",children:u.jsx("span",{className:"material-icons text-white text-2xl",children:"sports_martial_arts"})}),u.jsx("h1",{className:"text-3xl font-bold text-white",children:"CoachT"})]})}),u.jsx(X.div,{className:"w-full max-w-md px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:u.jsxs(Ks,{className:"border-red-900/30 bg-gradient-to-br from-gray-900/80 to-black/80 backdrop-blur-lg shadow-[0_10px_30px_rgba(0,0,0,0.5)]",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent pointer-events-none"}),u.jsxs(n3,{defaultValue:o,onValueChange:a,className:"w-full",children:[u.jsxs(Q1,{className:"grid grid-cols-2 bg-black/50 border-b border-gray-800 rounded-none w-full h-auto p-0",children:[u.jsx(Fu,{value:"login",className:"data-[state=active]:bg-gradient-to-b data-[state=active]:from-red-700 data-[state=active]:to-red-800 data-[state=active]:text-white rounded-none py-3 text-gray-400",children:"Login"}),u.jsx(Fu,{value:"register",className:"data-[state=active]:bg-gradient-to-b data-[state=active]:from-red-700 data-[state=active]:to-red-800 data-[state=active]:text-white rounded-none py-3 text-gray-400",children:"Register"})]}),u.jsxs(G0,{value:"login",className:"m-0",children:[u.jsxs(No,{children:[u.jsx(To,{className:"text-xl sm:text-2xl font-bold",children:u.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-300",children:"Login to Your Account"})}),u.jsx(Ua,{className:"text-sm sm:text-base text-gray-300",children:"Continue with Google to access your CoachT dashboard"})]}),u.jsxs(rr,{className:"flex flex-col items-center space-y-4",children:[u.jsx(eGe,{onSuccess:k,onError:T,text:"continue_with",shape:"pill",theme:"filled_black",size:"large",width:300}),n.isError&&u.jsx("div",{className:"bg-red-900/30 border border-red-700/50 rounded-lg p-3 w-full",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-red-400 mr-2",children:"error"}),u.jsx("span",{className:"text-red-300 text-sm",children:(($=n.error)==null?void 0:$.message)||"Google login failed"})]})}),n.isPending&&u.jsxs("div",{className:"flex items-center text-gray-300",children:[u.jsx("span",{className:"material-icons animate-spin mr-2",children:"autorenew"}),"Signing you in..."]})]})]}),u.jsxs(G0,{value:"register",className:"m-0",children:[u.jsxs(No,{children:[u.jsx(To,{className:"text-xl sm:text-2xl font-bold text-red-500",children:"Create an Account"}),u.jsx(Ua,{className:"text-sm sm:text-base text-gray-300",children:"Register to save your training sessions and settings"})]}),u.jsx(rr,{children:u.jsx(YK,{...C,children:u.jsxs("form",{id:"register-form",onSubmit:C.handleSubmit(_),className:"space-y-4",children:[u.jsx(Zo,{control:C.control,name:"username",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Username"}),u.jsx(po,{children:u.jsx(ar,{placeholder:"Choose a username",...R,className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30"})}),u.jsx(mo,{className:"text-red-400"})]})}),u.jsx(Zo,{control:C.control,name:"email",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Email Address"}),u.jsx(po,{children:u.jsx(ar,{type:"email",placeholder:"Enter your email address",...R,className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30"})}),u.jsx(mo,{className:"text-red-400"})]})}),u.jsx(Zo,{control:C.control,name:"password",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Password"}),u.jsxs("div",{className:"relative",children:[u.jsx(po,{children:u.jsx(ar,{type:v?"text":"password",placeholder:"Create a password",...R,className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30 pr-10"})}),u.jsx("button",{type:"button",onClick:()=>S(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white transition-colors",children:u.jsx("span",{className:"material-icons text-xl",children:v?"visibility_off":"visibility"})})]}),u.jsx(mo,{className:"text-red-400"})]})}),u.jsx(Zo,{control:C.control,name:"confirmPassword",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Confirm Password"}),u.jsx(po,{children:u.jsx(ar,{type:"password",placeholder:"Confirm your password",...R,className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30"})}),u.jsx(mo,{className:"text-red-400"})]})}),!l&&u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsx(Zo,{control:C.control,name:"beltColor",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Belt Color"}),u.jsxs(Iw,{onValueChange:R.onChange,defaultValue:R.value,children:[u.jsx(po,{children:u.jsx(lx,{className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30",children:u.jsx(Rw,{placeholder:"Select belt"})})}),u.jsxs(cx,{className:"bg-gray-800 border-gray-700 text-white",children:[u.jsx(ur,{value:"white",children:"White"}),u.jsx(ur,{value:"yellow",children:"Yellow"}),u.jsx(ur,{value:"orange",children:"Orange"}),u.jsx(ur,{value:"green",children:"Green"}),u.jsx(ur,{value:"blue",children:"Blue"}),u.jsx(ur,{value:"red",children:"Red"}),u.jsx(ur,{value:"black",children:"Black"})]})]}),u.jsx(mo,{className:"text-red-400"})]})}),u.jsx(Zo,{control:C.control,name:"experienceTime",render:({field:R})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white",children:"Experience"}),u.jsxs(Iw,{onValueChange:R.onChange,defaultValue:R.value,children:[u.jsx(po,{children:u.jsx(lx,{className:"bg-gray-800/70 border-gray-700/50 text-white focus:border-red-500/50 focus:ring-1 focus:ring-red-500/30",children:u.jsx(Rw,{placeholder:"Select experience"})})}),u.jsxs(cx,{className:"bg-gray-800 border-gray-700 text-white",children:[u.jsx(ur,{value:"less_than_1_year",children:"Less than 1 year"}),u.jsx(ur,{value:"1_to_3_years",children:"1-3 years"}),u.jsx(ur,{value:"3_to_5_years",children:"3-5 years"}),u.jsx(ur,{value:"5_plus_years",children:"5+ years"})]})]}),u.jsx(mo,{className:"text-red-400"})]})})]})]})})}),u.jsx(Z9,{className:"flex flex-col gap-4",children:u.jsx(Se,{type:"submit",form:"register-form",className:"w-full bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white py-5",disabled:e.isPending,children:e.isPending?u.jsxs("div",{className:"flex items-center",children:[u.jsx("span",{className:"material-icons animate-spin mr-2",children:"autorenew"}),"Creating Account..."]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"material-icons mr-2",children:"person_add"}),"Create Account"]})})})]})]})]})}),!l&&u.jsxs(X.div,{className:"mt-8 w-full max-w-4xl px-4 grid grid-cols-1 md:grid-cols-3 gap-6",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},children:[u.jsxs("div",{className:"p-5 rounded-2xl backdrop-blur-lg border border-red-500/20 bg-gradient-to-br from-gray-900/80 to-black/80 shadow-lg hover:scale-105 transition-transform duration-300",children:[u.jsx("div",{className:"mb-3 h-10 w-10 rounded-full bg-red-700/20 flex items-center justify-center",children:u.jsx("span",{className:"material-icons text-red-500",children:"analytics"})}),u.jsx("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Real-time Form Analysis"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Perfect your Taekwondo stances with AI-powered pose tracking"})]}),u.jsxs("div",{className:"p-5 rounded-2xl backdrop-blur-lg border border-red-500/20 bg-gradient-to-br from-gray-900/80 to-black/80 shadow-lg hover:scale-105 transition-transform duration-300",children:[u.jsx("div",{className:"mb-3 h-10 w-10 rounded-full bg-red-700/20 flex items-center justify-center",children:u.jsx("span",{className:"material-icons text-red-500",children:"compare"})}),u.jsx("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Comparison Training"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Compare your technique with reference performances"})]}),u.jsxs("div",{className:"p-5 rounded-2xl backdrop-blur-lg border border-red-500/20 bg-gradient-to-br from-gray-900/80 to-black/80 shadow-lg hover:scale-105 transition-transform duration-300",children:[u.jsx("div",{className:"mb-3 h-10 w-10 rounded-full bg-red-700/20 flex items-center justify-center",children:u.jsx("span",{className:"material-icons text-red-500",children:"insights"})}),u.jsx("h3",{className:"text-lg font-semibold text-red-400 mb-2",children:"Performance Metrics"}),u.jsx("p",{className:"text-sm text-gray-300",children:"Track improvement with detailed analysis reports"})]})]}),u.jsx(X.div,{className:"mt-8 text-center text-gray-500 text-sm",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},children:"© 2025 CoachT. All rights reserved."})]})]})}const W4=[{id:1,name:"Front Kick (Ap Chagi)",category:"Basic Kicks",difficulty:"Beginner",description:"A forward kick with the ball of the foot as the striking surface.",videoUrl:"/moves/front-kick.mp4",thumbnailUrl:"/moves/front-kick-thumb.jpg",tip:"Keep your supporting leg slightly bent and maintain balance throughout the kick.",referencePose:void 0},{id:2,name:"Side Kick (Yeop Chagi)",category:"Basic Kicks",difficulty:"Intermediate",description:"A kick delivered with the side edge of the foot or heel.",videoUrl:"/moves/side-kick.mp4",thumbnailUrl:"/moves/side-kick-thumb.jpg",tip:"Chamber your knee high, pivot on your supporting foot, and drive through with your heel. Keep your body straight.",referencePose:{imageUrl:"https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?auto=format&fit=crop&w=800&h=600",processed:!0,angles:{left_shoulder:30,right_shoulder:155,left_elbow:23,right_elbow:20,left_hip:123,right_hip:120,left_knee:171,right_knee:170}}},{id:3,name:"Roundhouse Kick (Dollyo Chagi)",category:"Basic Kicks",difficulty:"Intermediate",description:"A kick that rotates around the body, striking with the top of the foot or instep.",videoUrl:"/moves/roundhouse-kick.mp4",thumbnailUrl:"/moves/roundhouse-kick-thumb.jpg",referencePose:{imageUrl:"https://i.sstatic.net/pjuvo.jpg",processed:!0,angles:{left_shoulder:45,right_shoulder:135,left_elbow:90,right_elbow:160,left_hip:120,right_hip:60,left_knee:170,right_knee:160}}},{id:4,name:"Back Kick (Dwi Chagi)",category:"Basic Kicks",difficulty:"Advanced",description:"A kick delivered directly backward, striking with the heel.",videoUrl:"/moves/back-kick.mp4",thumbnailUrl:"/moves/back-kick-thumb.jpg"},{id:5,name:"Axe Kick (Naeryeo Chagi)",category:"Advanced Kicks",difficulty:"Advanced",description:"An overhand downward strike with the heel.",videoUrl:"/moves/axe-kick.mp4",thumbnailUrl:"/moves/axe-kick-thumb.jpg"},{id:6,name:"Spinning Hook Kick (Huryeo Chagi)",category:"Advanced Kicks",difficulty:"Expert",description:"A spinning kick that hooks around to strike with the heel.",videoUrl:"/moves/spinning-hook-kick.mp4",thumbnailUrl:"/moves/spinning-hook-kick-thumb.jpg"},{id:7,name:"Taegeuk Il Jang",category:"Poomsae (Forms)",difficulty:"Beginner",description:"The first of the eight Taegeuk forms, focusing on the heaven principle.",videoUrl:"/moves/taegeuk-1.mp4",thumbnailUrl:"/moves/taegeuk-1-thumb.jpg"},{id:8,name:"Taegeuk Yi Jang",category:"Poomsae (Forms)",difficulty:"Beginner",description:"The second Taegeuk form, representing joyfulness.",videoUrl:"/moves/taegeuk-2.mp4",thumbnailUrl:"/moves/taegeuk-2-thumb.jpg"},{id:9,name:"Front Stance Punch (Ap Kubi Jireugi)",category:"Basic Techniques",difficulty:"Beginner",description:"A punch delivered from the front stance position.",videoUrl:"/moves/front-stance-punch.mp4",thumbnailUrl:"/moves/front-stance-punch-thumb.jpg"},{id:10,name:"Horse Stance Block (Juchum Seo Makki)",category:"Basic Techniques",difficulty:"Beginner",description:"A blocking technique performed from the horse stance position.",videoUrl:"/moves/horse-stance-block.mp4",thumbnailUrl:"/moves/horse-stance-block-thumb.jpg"},{id:11,name:"Sparring Combination 1",category:"Kyorugi (Sparring)",difficulty:"Intermediate",description:"A basic sparring combination with roundhouse and side kicks.",videoUrl:"/moves/sparring-combo-1.mp4",thumbnailUrl:"/moves/sparring-combo-1-thumb.jpg"},{id:12,name:"Sparring Combination 2",category:"Kyorugi (Sparring)",difficulty:"Advanced",description:"Advanced sparring combination with feints and spinning kicks.",videoUrl:"/moves/sparring-combo-2.mp4",thumbnailUrl:"/moves/sparring-combo-2-thumb.jpg"},{id:13,name:"Low Block (Arae Makki)",category:"Basic Techniques",difficulty:"Beginner",description:"A defensive technique to block low attacks, typically aimed at the lower body.",videoUrl:"/moves/low-block.mp4",thumbnailUrl:"/moves/low-block-thumb.jpg",tip:"Keep your blocking arm strong and ensure your stance is stable."},{id:14,name:"High Block (Eolgul Makki)",category:"Basic Techniques",difficulty:"Beginner",description:"A block where the arm is raised above the head to defend against high attacks.",videoUrl:"/moves/high-block.mp4",thumbnailUrl:"/moves/high-block-thumb.jpg",tip:"Focus on a strong finishing position with your arm at a 45-degree angle above your head."},{id:15,name:"Middle Punch (Momtong Jireugi)",category:"Basic Techniques",difficulty:"Beginner",description:"A straight punch aimed at the middle section (solar plexus) of an opponent.",videoUrl:"/moves/middle-punch.mp4",thumbnailUrl:"/moves/middle-punch-thumb.jpg",tip:"Rotate your hip and shoulder to generate power, keeping your non-punching hand at your hip."},{id:16,name:"Knifehand Strike (Sonnal Chigi)",category:"Basic Techniques",difficulty:"Beginner",description:"A strike performed with the side of the open hand, often targeting the neck.",videoUrl:"/moves/knifehand-strike.mp4",thumbnailUrl:"/moves/knifehand-strike-thumb.jpg",tip:"Keep your hand straight and tense, with thumb tucked in, focusing on striking with the edge of your hand."},{id:17,name:"Palm Block (Batangson Makki)",category:"Basic Techniques",difficulty:"Beginner",description:"A blocking technique using the palm of the hand in a downward pushing motion.",videoUrl:"/moves/palm-block.mp4",thumbnailUrl:"/moves/palm-block-thumb.jpg",tip:"Use the heel of your palm for power and keep your fingers tightly together."},{id:18,name:"Double Roundhouse Kick (Dollyo Chagi x2)",category:"Advanced Kicks",difficulty:"Intermediate",description:"Two consecutive roundhouse kicks performed with the same leg without putting the foot down.",videoUrl:"/moves/double-roundhouse.mp4",thumbnailUrl:"/moves/double-roundhouse-thumb.jpg",tip:"Chamber your leg quickly after the first kick to set up the second one efficiently."},{id:19,name:"Twist Kick (Bituro Chagi)",category:"Advanced Kicks",difficulty:"Intermediate",description:"A kick where the leg is twisted during execution, usually targeting the face.",videoUrl:"/moves/twist-kick.mp4",thumbnailUrl:"/moves/twist-kick-thumb.jpg",tip:"The twisting motion comes from rotating your hips and pivoting on your supporting foot."},{id:20,name:"Push Kick (Meereo Chagi)",category:"Basic Kicks",difficulty:"Intermediate",description:"A front kick that pushes the opponent away rather than striking through them.",videoUrl:"/moves/push-kick.mp4",thumbnailUrl:"/moves/push-kick-thumb.jpg",tip:"Push through with the heel of your foot and keep your knee bent slightly on impact."},{id:21,name:"Elbow Strike (Palkup Chigi)",category:"Basic Techniques",difficulty:"Intermediate",description:"A close-range strike using the point or edge of the elbow.",videoUrl:"/moves/elbow-strike.mp4",thumbnailUrl:"/moves/elbow-strike-thumb.jpg",tip:"Generate power by rotating your torso and keeping your elbow tensed at impact."},{id:22,name:"Twin Forearm Block (Sang Palmok Makki)",category:"Basic Techniques",difficulty:"Intermediate",description:"A defensive technique using both forearms in an X-shape to block attacks.",videoUrl:"/moves/twin-forearm-block.mp4",thumbnailUrl:"/moves/twin-forearm-block-thumb.jpg",tip:"Cross your arms in front of your body and extend forcefully to execute the block."},{id:23,name:"Jumping Side Kick (Twimyeo Yeop Chagi)",category:"Advanced Kicks",difficulty:"Advanced",description:"A side kick performed while jumping, increasing its height and power.",videoUrl:"/moves/jumping-side-kick.mp4",thumbnailUrl:"/moves/jumping-side-kick-thumb.jpg",tip:"Push off strongly with your non-kicking leg and maintain proper side kick form in the air."},{id:24,name:"Jumping Back Kick (Twimyeo Dwi Chagi)",category:"Advanced Kicks",difficulty:"Advanced",description:"A back kick executed while jumping, combining height with the power of a back kick.",videoUrl:"/moves/jumping-back-kick.mp4",thumbnailUrl:"/moves/jumping-back-kick-thumb.jpg",tip:"Look over your shoulder to spot your target before executing the kick in the air."},{id:25,name:"Spinning Crescent Kick (Bandal Chagi)",category:"Advanced Kicks",difficulty:"Advanced",description:"A kick that traces a crescent moon shape, performed with a spinning motion.",videoUrl:"/moves/spinning-crescent-kick.mp4",thumbnailUrl:"/moves/spinning-crescent-kick-thumb.jpg",tip:"Pivot on your supporting foot and maintain height throughout the kick's arc."},{id:26,name:"Reverse Turning Kick (Bandae Dollyo Chagi)",category:"Advanced Kicks",difficulty:"Advanced",description:"A roundhouse kick performed in the opposite direction of a standard turning kick.",videoUrl:"/moves/reverse-turning-kick.mp4",thumbnailUrl:"/moves/reverse-turning-kick-thumb.jpg",tip:"Turn your head quickly to spot your target and pivot fully on your supporting foot."},{id:27,name:"Downward Knifehand Block (Naeryeo Sonnal Makki)",category:"Basic Techniques",difficulty:"Advanced",description:"A blocking technique using the knifehand in a downward diagonal motion.",videoUrl:"/moves/downward-knifehand-block.mp4",thumbnailUrl:"/moves/downward-knifehand-block-thumb.jpg",tip:"Keep your arm strong throughout the motion and end with a tense, straight hand."},{id:28,name:"540 Hook Kick (540 Huryeo Chagi)",category:"Advanced Kicks",difficulty:"Expert",description:"An advanced jumping spinning hook kick involving a 540-degree rotation in the air.",videoUrl:"/moves/540-hook-kick.mp4",thumbnailUrl:"/moves/540-hook-kick-thumb.jpg",tip:"Focus on generating height in your jump before initiating the spin to complete the full rotation."},{id:29,name:"Jumping Axe Kick (Twimyeo Naeryeo Chagi)",category:"Advanced Kicks",difficulty:"Expert",description:"An axe kick performed while jumping, increasing its impact and reach.",videoUrl:"/moves/jumping-axe-kick.mp4",thumbnailUrl:"/moves/jumping-axe-kick-thumb.jpg",tip:"Raise your kicking leg as high as possible before bringing it down with force."},{id:30,name:"Spinning Elbow Strike (Dwi Palkup Chigi)",category:"Basic Techniques",difficulty:"Expert",description:"An elbow strike delivered with a spinning motion to increase power and surprise.",videoUrl:"/moves/spinning-elbow-strike.mp4",thumbnailUrl:"/moves/spinning-elbow-strike-thumb.jpg",tip:"Keep your core tight during the spin and focus on accuracy in targeting."},{id:31,name:"Double Jump Kick (E Dan Chagi)",category:"Advanced Kicks",difficulty:"Expert",description:"A technique where two different kicks are executed during a single jump.",videoUrl:"/moves/double-jump-kick.mp4",thumbnailUrl:"/moves/double-jump-kick-thumb.jpg",tip:"Time your kicks carefully and aim to hit the first target before transitioning to the second kick."},{id:32,name:"Tornado Kick (Huryeo Dollyo Chagi)",category:"Advanced Kicks",difficulty:"Expert",description:"A complex kick combining a spinning motion with a roundhouse kick execution.",videoUrl:"/moves/tornado-kick.mp4",thumbnailUrl:"/moves/tornado-kick-thumb.jpg",tip:"Begin with a strong pivot on your supporting leg and maintain momentum throughout the spin."}],nGe=["All","Basic Kicks","Advanced Kicks","Basic Techniques","Poomsae (Forms)","Kyorugi (Sparring)"],sGe=["All","Beginner","Intermediate","Advanced","Expert"];function U4({angles:t}){return u.jsxs("svg",{width:"200",height:"300",viewBox:"0 0 200 300",style:{display:"block",margin:"0 auto"},children:[u.jsx("circle",{cx:"100",cy:"50",r:"20",fill:"#10b981"}),u.jsx("line",{x1:"100",y1:"70",x2:"100",y2:"170",stroke:"#10b981",strokeWidth:"6"}),u.jsx("line",{x1:"100",y1:"90",x2:"60",y2:"130",stroke:"#10b981",strokeWidth:"6"}),u.jsx("line",{x1:"100",y1:"90",x2:"140",y2:"130",stroke:"#10b981",strokeWidth:"6"}),u.jsx("line",{x1:"100",y1:"170",x2:"70",y2:"250",stroke:"#10b981",strokeWidth:"6"}),u.jsx("line",{x1:"100",y1:"170",x2:"130",y2:"250",stroke:"#10b981",strokeWidth:"6"}),u.jsx("text",{x:"100",y:"280",textAnchor:"middle",fill:"#10b981",fontSize:"18",children:"HINT"})]})}function rGe(){const t=new window.AudioContext,e=t.createOscillator(),n=t.createGain();e.type="sine",e.frequency.value=660,n.gain.value=.08,e.connect(n),n.connect(t.destination),e.start(),e.stop(t.currentTime+.15),e.onended=()=>t.close()}function iGe(){const t=new window.AudioContext,e=t.createOscillator(),n=t.createGain();e.type="triangle",e.frequency.value=220,n.gain.value=.18,e.connect(n),n.connect(t.destination),e.start(),setTimeout(()=>{e.frequency.value=110},60),setTimeout(()=>{n.gain.linearRampToValueAtTime(0,t.currentTime+.08)},120),e.stop(t.currentTime+.18),e.onended=()=>t.close()}function oGe(){var to,of,rl,Ul,af;const{user:t,logoutMutation:e}=nf(),{theme:n,setTheme:s}=t7(),[r,i]=b.useState(W4),[o,a]=b.useState(""),[l,c]=b.useState("All"),[d,h]=b.useState("All"),[f,p]=b.useState(n==="dark"),[m,g]=b.useState(null),[x,y]=b.useState(!1),[v,S]=b.useState(""),[C,k]=b.useState(!1),[T,_]=b.useState(!1),[$,R]=b.useState(!1),[A,j]=b.useState(5),[F,L]=b.useState(!1),[M,q]=b.useState(null),[z,re]=b.useState(null),[U,G]=b.useState(null),[xe,Ce]=b.useState(!1),[De,fe]=b.useState(null),ee=b.useRef(null),Pe=b.useRef(null);b.useRef(null);const Re=b.useRef(null),ce=b.useRef(null),me=b.useRef(null),[ie,Q]=b.useState(null),[oe,ae]=b.useState(null),[Ae,Be]=b.useState(!1),[Xe,lt]=b.useState(null),[Me,je]=b.useState(""),[Ze,Ye]=b.useState(!1),[Ie,B]=b.useState({differences:[],missingJoints:[],score:0}),Z={head:{x:300,y:100},neck:{x:300,y:150},left_shoulder:{x:250,y:180},right_shoulder:{x:350,y:180},left_elbow:{x:220,y:250},right_elbow:{x:380,y:250},left_wrist:{x:190,y:320},right_wrist:{x:410,y:320},left_hip:{x:270,y:300},right_hip:{x:330,y:300},left_knee:{x:250,y:380},right_knee:{x:350,y:380},left_ankle:{x:230,y:460},right_ankle:{x:370,y:460}},te=[["head","neck"],["neck","left_shoulder"],["neck","right_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["neck","left_hip"],["neck","right_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_hip","right_knee"],["right_knee","right_ankle"]];function ve(ne,he,ge){let ft=(Math.atan2(ge.y-he.y,ge.x-he.x)-Math.atan2(ne.y-he.y,ne.x-he.x))*(180/Math.PI);return ft=ft<0?ft+360:ft,Math.round(ft)}const[we,de]=b.useState(!1),[Ee,mt]=b.useState({}),[It,jt]=b.useState(Z),[hs,fn]=b.useState(null),[dt,At]=b.useState(null),Vs=b.useRef(null),Ln=["left_shoulder","right_shoulder","left_elbow","right_elbow","left_hip","right_hip","left_knee","right_knee"],lr=()=>{const ne=n==="dark"?"light":"dark";s(ne),p(ne==="dark")},qn=()=>{v==="ojaskandy"?(y(!0),_(!0),k(!1)):alert("Incorrect password")},Ei=ne=>{var ke;const he=(ke=ne.target.files)==null?void 0:ke[0];if(!he)return;const ge=new FileReader;ge.onload=ft=>{var gn;const Tt=(gn=ft.target)==null?void 0:gn.result;G(Tt)},ge.readAsDataURL(he)},is=async()=>{var ne;if(!((ne=m==null?void 0:m.referencePose)!=null&&ne.processed)){alert("Please process the reference image first.");return}try{const he={moveId:m.id,name:m.name,category:m.category,imageUrl:Vo||m.referencePose.imageUrl,jointAngles:m.referencePose.angles},ge=Array.from(document.querySelectorAll("button"));let ke=null;ge.forEach(Tt=>{var gn;(gn=Tt.textContent)!=null&&gn.includes("Save to Database")&&(ke=Tt)}),ke&&(ke.innerHTML='<span class="material-icons animate-spin text-sm mr-1">refresh</span> Saving...',ke.disabled=!0);const ft=await fetch("/api/reference-moves",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(he)});ft.ok?(console.log("Reference move saved to database successfully"),alert("Reference move saved to database successfully!")):(console.error("Failed to save reference move to database:",await ft.text()),alert("Failed to save reference move to database!"))}catch(he){console.error("Error saving reference move to database:",he),alert("Error saving reference move to database!")}finally{const he=Array.from(document.querySelectorAll("button"));let ge=null;he.forEach(ke=>{var ft,Tt;((ft=ke.textContent)!=null&&ft.includes("Save to Database")||(Tt=ke.textContent)!=null&&Tt.includes("Saving"))&&(ge=ke)}),ge&&(ge.innerHTML='<span class="material-icons text-sm mr-1">save</span> Save to Database',ge.disabled=!1)}},Mo=async()=>{if(!(!U||!m)){if(m.referencePose&&m.referencePose.angles){alert("Angles already exist for this reference pose.");return}Ce(!0);try{console.log("Starting reference image processing..."),console.log("Initializing pose detection with thunder model..."),await go("thunder"),console.log("Loading image...");const ne=new Image;ne.crossOrigin="anonymous",ne.src=U,await new Promise((Tt,gn)=>{ne.onload=()=>{console.log(`Image loaded successfully: ${ne.width}x${ne.height}`),Tt(null)},ne.onerror=zn=>{console.error("Error loading image:",zn),gn(new Error("Failed to load image"))},ne.complete&&(console.log("Image was already loaded"),Tt(null))});const he=Pe.current;if(!he)throw new Error("Canvas reference not available");const ge=he.getContext("2d");if(!ge)throw new Error("Could not get canvas context");he.width=ne.width||640,he.height=ne.height||480,console.log(`Canvas dimensions set to: ${he.width}x${he.height}`),ge.clearRect(0,0,he.width,he.height),ge.drawImage(ne,0,0,he.width,he.height);let ke=he.toDataURL("image/png");console.log("Image drawn on canvas, proceeding to pose detection"),console.log("Detecting poses in reference image...");const ft=await pr(ne,1,.1);if(console.log(`Pose detection complete. Found ${(ft==null?void 0:ft.length)||0} poses.`),ft&&ft.length>0&&console.log(`First pose has ${ft[0].keypoints.length} keypoints`),ft&&ft.length>0&&ft[0].keypoints.length>0){const Tt=ft[0],gn=tc(Tt);console.log("Reference pose angles:",gn),fe(gn),console.log("Drawing skeleton overlay..."),he.style.display="block",ge.clearRect(0,0,he.width,he.height),ge.drawImage(ne,0,0,he.width,he.height),ge.beginPath(),Tt.keypoints.forEach(Dt=>{Dt.score&&Dt.score>.1&&(ge.beginPath(),ge.arc(Dt.x,Dt.y,6,0,2*Math.PI),ge.fillStyle="#00ff00",ge.fill(),ge.strokeStyle="#000000",ge.lineWidth=1,ge.stroke(),Dt.name&&x&&(ge.font="10px Arial",ge.fillStyle="#ffffff",ge.fillText(Dt.name,Dt.x+8,Dt.y)))}),ge.strokeStyle="#00ff00",ge.lineWidth=4;const zn=Ac();ge.beginPath(),zn.forEach(Dt=>{const[ns,ai]=Dt,no=Tt.keypoints.find(Ys=>Ys.name===ns),Ir=Tt.keypoints.find(Ys=>Ys.name===ai);no&&Ir&&typeof no.score=="number"&&no.score>.1&&typeof Ir.score=="number"&&Ir.score>.1&&(ge.moveTo(no.x,no.y),ge.lineTo(Ir.x,Ir.y))}),ge.stroke();const Cn=he.toDataURL("image/png");console.log("Skeleton overlay complete, saving results");const En=[...r],ps=En.findIndex(Dt=>Dt.id===m.id);if(ps>-1){En[ps]={...En[ps],referencePose:{imageUrl:Cn,angles:gn,processed:!0}},g(En[ps]);try{const Dt={moveId:m.id,name:m.name,category:m.category,imageUrl:Cn,jointAngles:gn},ns=await fetch("/api/reference-moves",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Dt)});ns.ok?console.log("Reference move saved to database successfully"):console.error("Failed to save reference move to database:",await ns.text())}catch(Dt){console.error("Error saving reference move to database:",Dt)}console.log("Reference pose processed successfully"),alert("Reference pose processed successfully and saved for all users!")}}else throw new Error("No pose detected in the image")}catch(ne){console.error("Error processing reference image:",ne),alert(`Failed to process reference image: ${(ne==null?void 0:ne.message)||"Please try another image"}`)}finally{Ce(!1)}}},fs=async()=>{var ne;if(!((ne=m==null?void 0:m.referencePose)!=null&&ne.processed)){alert("Reference pose is not available for this move. Please ask a developer to add one.");return}try{await go("lightning")}catch(he){console.error("Error initializing pose detection:",he),alert("Failed to initialize pose detection. Please try again.");return}R(!0),q(null),ae(null),Be(!1),re(null),L(!0)},pe=()=>{var Cn;if(!((Cn=m==null?void 0:m.referencePose)!=null&&Cn.angles)){console.error("No reference angles available for comparison");return}const ne=z||{};console.log("USER ANGLES FOR COMPARISON:",ne),console.log("REFERENCE ANGLES:",m.referencePose.angles);const he=m.referencePose.angles,ge=[],ke=[];let ft=0,Tt=0;Object.entries(he).forEach(([En,ps])=>{if(ne[En]!==void 0){const Dt=ne[En],ns=Math.abs(Dt-ps);ge.push({joint:En,userAngle:Dt,refAngle:ps,diff:ns}),ft+=ns,Tt++}else ge.push({joint:En,refAngle:ps}),ke.push(En)});let gn=0;if(Tt>0){const En=ft/Tt;gn=Math.max(0,100-En*100/45),gn=Math.round(gn)}let zn="";if(ke.length===0&&Tt>0){gn>=90?zn="Excellent form! Your pose is nearly perfect.":gn>=70?zn="Good job! Your form is mostly correct.":gn>=50?zn="You're on the right track, but your form needs some adjustment.":zn="Your pose needs significant improvement. Focus on matching the reference angles.";const En=ge.filter(ps=>ps.diff!==void 0&&ps.diff>15).sort((ps,Dt)=>(Dt.diff||0)-(ps.diff||0)).slice(0,2);if(En.length>0){const ps=En.map(Dt=>{const ns=Dt.joint.replace(/_/g," "),ai=Dt.userAngle||0,no=Dt.refAngle,Ir=ai>no?"decrease":"increase";return`${ns} (${Ir} angle by ${Math.round(Math.abs(ai-no))}°)`}).join(" and ");zn+=` Focus on improving your ${ps}.`}}else ke.length>0&&(zn=`Some key joints are not visible: ${ke.map(En=>En.replace(/_/g," ")).join(", ")}. Try adjusting your position.`);m&&$i(En=>{const ps=En[m.id]||[];if(ps.length>=3)return En;const Dt=z??void 0,ns=[...ps,{score:gn,timestamp:Date.now(),feedback:zn,angles:Dt}];return{...En,[m.id]:ns}}),B({differences:ge,missingJoints:ke,score:gn}),lt(gn),je(zn),Ye(!0)};b.useEffect(()=>{(async()=>{try{const he=await fetch("/api/reference-moves");if(he.ok){const ge=await he.json();if(console.log("Fetched reference moves:",ge),ge&&ge.length>0){const ke=W4.map(ft=>{const Tt=ge.find(gn=>gn.moveId===ft.id);return Tt?{...ft,referencePose:{imageUrl:Tt.imageUrl,angles:Tt.jointAngles||{},processed:!0}}:ft});if(i(ke),m){const ft=ke.find(Tt=>Tt.id===m.id);g(ft||null)}}}else console.error("Failed to fetch reference moves:",await he.text())}catch(he){console.error("Error fetching reference moves:",he)}})()},[]);const $e=r.filter(ne=>{const he=ne.name.toLowerCase().includes(o.toLowerCase())||ne.description.toLowerCase().includes(o.toLowerCase()),ge=l==="All"||ne.category===l,ke=d==="All"||ne.difficulty===d;return he&&ge&&ke});b.useEffect(()=>($&&ie&&(async()=>{try{const ne=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"}});ie.srcObject=ne,ie.onloadedmetadata=()=>{ie.play().catch(he=>console.error("Error playing video:",he))},ie.style.display="block"}catch{alert("Could not access camera. Please ensure camera permissions are granted.")}})(),()=>{ie&&ie.srcObject&&(ie.srcObject.getTracks().forEach(ne=>ne.stop()),ie.srcObject=null)}),[$,ie]);const[Te,Je]=b.useState(null),He=()=>{if(!ie)return;Je(5);const ne=setInterval(()=>{Je(he=>{if(he===null||he<=1){clearInterval(ne),iGe();const ge=document.createElement("canvas");ge.width=ie.videoWidth||640,ge.height=ie.videoHeight||480;const ke=ge.getContext("2d");if(!ke)return null;ke.drawImage(ie,0,0,ge.width,ge.height);const ft=ge.toDataURL("image/png");return ae(ft),Be(!1),lt(null),je(""),setTimeout(async()=>{var Tt;await Lo(ft),(Tt=m==null?void 0:m.referencePose)!=null&&Tt.angles&&pe()},100),null}return rGe(),he-1})},1e3)},it=()=>{de(!0),jt(Z);const ne=On(Z);mt(ne),At(null),fn(null)},Ot=ne=>{At(ne)},Yt=(ne,he)=>{mt(ge=>({...ge,[ne]:he}))},On=ne=>{const he={};he.left_shoulder=ve(ne.neck,ne.left_shoulder,ne.left_elbow),he.left_elbow=ve(ne.left_shoulder,ne.left_elbow,ne.left_wrist),he.right_shoulder=ve(ne.neck,ne.right_shoulder,ne.right_elbow),he.right_elbow=ve(ne.right_shoulder,ne.right_elbow,ne.right_wrist),he.left_hip=ve(ne.neck,ne.left_hip,ne.left_knee),he.left_knee=ve(ne.left_hip,ne.left_knee,ne.left_ankle),he.right_hip=ve(ne.neck,ne.right_hip,ne.right_knee),he.right_knee=ve(ne.right_hip,ne.right_knee,ne.right_ankle);for(const ge in he)isNaN(he[ge])&&(he[ge]=0);return he},en=ne=>{const he=Vs.current;if(!he)return null;const ge=he.getBoundingClientRect();return{x:ne.clientX-ge.left,y:ne.clientY-ge.top}},An=ne=>{const he=en(ne);if(he)for(const ge in It){const ke=It[ge];if(Math.sqrt(Math.pow(he.x-ke.x,2)+Math.pow(he.y-ke.y,2))<15){fn(ge);return}}},os=ne=>{if(!hs)return;const he=en(ne);he&&jt(ge=>{const ke={...ge,[hs]:{x:he.x,y:he.y}},ft=On(ke);return mt(ft),ke})},Ht=()=>{fn(null)},zs=()=>{fn(null)};b.useEffect(()=>{const ne=Vs.current;if(!ne||!we)return;const he=ne.getContext("2d");he&&(he.fillStyle="#18181b",he.fillRect(0,0,ne.width,ne.height),he.strokeStyle="#4ade80",he.lineWidth=5,te.forEach(([ge,ke])=>{const ft=It[ge],Tt=It[ke];ft&&Tt&&(he.beginPath(),he.moveTo(ft.x,ft.y),he.lineTo(Tt.x,Tt.y),he.stroke())}),Object.entries(It).forEach(([ge,ke])=>{he.beginPath(),he.arc(ke.x,ke.y,10,0,2*Math.PI),he.fillStyle=hs===ge?"#f87171":"#a3e635",he.fill(),he.strokeStyle="#18181b",he.lineWidth=2,he.stroke();const ft=ge;Ee[ft]!==void 0&&Ln.includes(ft)&&(he.fillStyle="rgba(16, 185, 129, 0.85)",he.beginPath(),he.arc(ke.x,ke.y-25,20,0,2*Math.PI),he.fill(),he.fillStyle="white",he.font="bold 12px Arial",he.textAlign="center",he.textBaseline="middle",he.fillText(`${Math.round(Ee[ft])}°`,ke.x,ke.y-25),he.font="10px Arial",he.fillText(ft.replace(/_/g," "),ke.x,ke.y-40))}))},[It,Ee,hs,we]);const nl=()=>{if(!m||Object.keys(Ee).length===0){alert("Please adjust the pose or define angles before saving.");return}const ne=Vs.current;if(!ne){alert("Sketch canvas not available.");return}const he=document.createElement("canvas");he.width=ne.width,he.height=ne.height;const ge=he.getContext("2d");if(!ge)return;ge.fillStyle="#18181b",ge.fillRect(0,0,he.width,he.height),ge.strokeStyle="#4ade80",ge.lineWidth=5,te.forEach(([gn,zn])=>{const Cn=It[gn],En=It[zn];Cn&&En&&(ge.beginPath(),ge.moveTo(Cn.x,Cn.y),ge.lineTo(En.x,En.y),ge.stroke())}),Object.entries(It).forEach(([gn,zn])=>{ge.beginPath(),ge.arc(zn.x,zn.y,8,0,2*Math.PI),ge.fillStyle="#a3e635",ge.fill();const Cn=gn;Ee[Cn]!==void 0&&Ln.includes(Cn)&&(ge.fillStyle="rgba(16, 185, 129, 0.85)",ge.beginPath(),ge.arc(zn.x,zn.y-25,20,0,2*Math.PI),ge.fill(),ge.fillStyle="white",ge.font="bold 12px Arial",ge.textAlign="center",ge.textBaseline="middle",ge.fillText(`${Math.round(Ee[Cn])}°`,zn.x,zn.y-25),ge.font="10px Arial",ge.fillText(Cn.replace(/_/g," "),zn.x,zn.y-40))});const ft={imageUrl:he.toDataURL("image/png"),angles:Ee,processed:!0},Tt={...m,referencePose:ft};g(Tt),is(),de(!1)},Lo=async ne=>{const he=new window.Image;if(he.src=ne,await new Promise(Tt=>{he.onload=Tt}),!me.current)return;const ge=me.current;ge.width=he.width,ge.height=he.height;const ke=ge.getContext("2d");if(!ke)return;ke.clearRect(0,0,ge.width,ge.height),ke.drawImage(he,0,0,he.width,he.height);let ft;try{await go("thunder"),ft=await pr(he,1,.15),(!ft||ft.length===0||!ft[0].keypoints||ft[0].keypoints.length<5)&&(await go("lightning"),ft=await pr(he,1,.1))}catch{await go("lightning"),ft=await pr(he,1,.1)}if(ft&&ft.length>0){const Tt=ft[0],gn=tc(Tt);re(gn),Tt.keypoints.forEach(Cn=>{Cn.score&&Cn.score>.1&&(ke.beginPath(),ke.arc(Cn.x,Cn.y,6,0,2*Math.PI),ke.fillStyle="#00ff00",ke.fill(),ke.strokeStyle="#000000",ke.lineWidth=1,ke.stroke(),Cn.name&&(ke.font="10px Arial",ke.fillStyle="#ffffff",ke.fillText(Cn.name,Cn.x+8,Cn.y)))}),ke.strokeStyle="#00ff00",ke.lineWidth=4,Ac().forEach(Cn=>{const[En,ps]=Cn,Dt=Tt.keypoints.find(ai=>ai.name===En),ns=Tt.keypoints.find(ai=>ai.name===ps);Dt&&ns&&typeof Dt.score=="number"&&Dt.score>.1&&typeof ns.score=="number"&&ns.score>.1&&(ke.beginPath(),ke.moveTo(Dt.x,Dt.y),ke.lineTo(ns.x,ns.y),ke.stroke())}),Object.entries(gn).forEach(([Cn,En])=>{const ps=Cn.split("_")[0],Dt=Tt.keypoints.find(ns=>ns.name===ps);if(Dt&&Dt.score&&Dt.score>.1){const ns=`${Math.round(En)}°`,ai=20;ke.beginPath(),ke.fillStyle="#10b981",ke.arc(Dt.x+25,Dt.y-5,ai,0,2*Math.PI),ke.fill(),ke.font="bold 14px Arial",ke.fillStyle="white",ke.textAlign="center",ke.textBaseline="middle",ke.fillText(ns,Dt.x+25,Dt.y-5),ke.font="10px Arial",ke.fillText(Cn.replace(/_/g," "),Dt.x+25,Dt.y-22),ke.beginPath(),ke.strokeStyle="white",ke.lineWidth=1,ke.moveTo(Dt.x,Dt.y),ke.lineTo(Dt.x+15,Dt.y-3),ke.stroke()}}),Be(!0)}},[ts,$i]=b.useState({});function wa(ne){var ge;const he=((ge=ts[ne])==null?void 0:ge.length)||0;return he===0?"0 0 16px 2px rgba(239,68,68,0.6)":he<5?"0 0 16px 2px rgba(250,204,21,0.6)":"0 0 16px 2px rgba(16,185,129,0.7)"}b.useEffect(()=>{var ne;Ae&&oe&&z&&((ne=m==null?void 0:m.referencePose)!=null&&ne.angles)&&pe()},[z,Ae,oe,m]);const[Bo,zl]=b.useState(!1);b.useEffect(()=>{var ne;m&&((ne=ts[m.id])==null?void 0:ne.length)===3&&zl(!0)},[ts,m]);const[Vo,oi]=b.useState("");b.useEffect(()=>{var ne;x&&((ne=m==null?void 0:m.referencePose)!=null&&ne.imageUrl)&&oi(m.referencePose.imageUrl)},[x,m]);const Wl=()=>{const ne=(t==null?void 0:t.username)||"User",he=encodeURIComponent(`Feedback on CoachT (Practice Page) by ${ne}`),ge=encodeURIComponent(`Please type your feedback here:

`);window.location.href=`mailto:ojaskandy@gmail.com?subject=${he}&body=${ge}`},[$r,Xs]=b.useState(!1),[Ii,sl]=b.useState(!1),[as,Oe]=b.useState(!1);b.useState(!1);const[_t,Zt]=b.useState(!1),Es=ne=>{ne&&!_t&&setTimeout(()=>{Xs(!0)},1e3)},Ri=ne=>ne?{"Side Kick (Yeop Chagi)":"Chamber your knee high, pivot on your supporting foot, and drive through with your heel. Keep your body straight and balanced!","Front Kick (Ap Chagi)":"Lift your knee up first, then snap your foot forward. Strike with the ball of your foot, not your toes!","Roundhouse Kick (Dollyo Chagi)":"Turn your hip over and pivot on your supporting foot. Strike with the top of your foot and follow through!","Back Kick (Dwi Chagi)":"Look over your shoulder, chamber your knee, then drive your heel straight back. Maximum power comes from your hip thrust!","Axe Kick (Naeryeo Chagi)":"Lift your leg high and straight, then bring it down like an axe. Strike with your heel and control the descent!"}[ne.name]||`Remember to focus on proper form for ${ne.name}. Balance, timing, and technique are key!`:"Select a technique to start practicing!",yr=(ne,he)=>ne>=90?"Outstanding! Your technique is nearly perfect. Keep this level of precision!":ne>=80?"Excellent work! Small adjustments to your form will make it even better.":ne>=70?"Good effort! Focus on the details - chamber position and follow-through need work.":ne>=50?"Keep practicing! Pay attention to your stance and balance. Slow down and focus on form over speed.":"Don't get discouraged! "+Ri(he)+" Practice makes perfect!";return b.useEffect(()=>{localStorage.getItem("hasSeenPracticeGuides")&&Zt(!0)},[]),b.useEffect(()=>{m&&!_t&&Es(m)},[m,_t]),u.jsxs("div",{className:"min-h-screen flex flex-col bg-black",children:[u.jsxs("header",{className:"bg-black border-b border-red-900/30 p-4 flex justify-between items-center shadow-md",children:[u.jsx("div",{className:"flex items-center",children:u.jsx(jn,{to:"/",className:"cursor-pointer",children:u.jsxs("h1",{className:"text-2xl font-bold gradient-heading flex items-center",children:[u.jsx("span",{className:"material-icons text-red-600 mr-2",children:"sports_martial_arts"}),"CoachT"]})})}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(Se,{variant:"outline",size:"icon",onClick:lr,className:"h-8 w-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20",children:f?u.jsx(kk,{className:"h-4 w-4 text-white"}):u.jsx(wk,{className:"h-4 w-4 text-white"})}),u.jsx(Se,{variant:"outline",size:"icon",onClick:()=>k(!0),className:"h-8 w-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20",children:u.jsx(Ck,{className:"h-4 w-4 text-white"})}),u.jsx(jn,{href:"/profile",children:u.jsxs(Se,{variant:"outline",className:"h-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20 flex items-center px-3 transition-all duration-300 hover:shadow-red-500/30 hover:shadow-sm",children:[u.jsx(Ru,{className:"h-4 w-4 text-white mr-2"}),u.jsx("span",{className:"text-sm text-white font-medium",children:"Profile"})]})}),u.jsxs(iT,{children:[u.jsx(oT,{asChild:!0,children:u.jsxs(Se,{variant:"outline",className:"h-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20 flex items-center px-3",children:[u.jsx(Ru,{className:"h-4 w-4 text-white mr-2"}),u.jsx("span",{className:"text-sm text-white font-medium",children:t==null?void 0:t.username})]})}),u.jsx(mw,{align:"end",className:"w-40 border border-red-600 bg-gray-900",children:u.jsxs(lp,{className:"cursor-pointer flex items-center text-white hover:bg-red-700/30",onClick:()=>e.mutate(),children:[u.jsx(vk,{className:"mr-2 h-4 w-4"}),u.jsx("span",{children:"Logout"})]})})]})]})]}),u.jsx(zi,{open:C,onOpenChange:k,children:u.jsxs(pi,{className:"bg-gray-900 border border-red-900 text-white",children:[u.jsxs(mi,{children:[u.jsx(gi,{children:"Developer Access"}),u.jsx(yo,{className:"text-gray-400",children:"Enter developer password to access developer tools."})]}),u.jsx("div",{className:"py-4",children:u.jsx(ar,{type:"password",placeholder:"Enter password",value:v,onChange:ne=>S(ne.target.value),className:"bg-gray-800 border-red-900/30 text-white"})}),u.jsx(xo,{children:u.jsx(Se,{onClick:qn,className:"bg-red-700 hover:bg-red-600 text-white",children:"Login"})})]})}),u.jsx(zi,{open:$,onOpenChange:ne=>{ne||(R(!1),L(!1),q(null),m&&$i(he=>({...he,[m.id]:[]})))},children:u.jsxs(pi,{className:"bg-gray-900 border border-red-900 text-white max-w-5xl w-full",children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:"flex items-center",children:[u.jsx("span",{className:"material-icons text-red-500 mr-2",children:"sports_martial_arts"}),"Practice: ",m==null?void 0:m.name]}),u.jsx(yo,{className:"text-gray-400",children:"Follow the instructions and match the reference pose."})]}),u.jsx("canvas",{ref:Re,style:{display:"none",position:"absolute"}}),M?u.jsxs("div",{className:"py-8",children:[u.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"text-3xl font-bold mb-2 text-center md:text-left",children:M.score>=80?u.jsx("span",{className:"text-green-500",children:"Excellent Form!"}):M.score>=60?u.jsx("span",{className:"text-yellow-500",children:"Good Effort!"}):u.jsx("span",{className:"text-red-500",children:"Keep Practicing!"})}),u.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[u.jsxs("div",{className:"text-5xl font-bold text-red-500",children:[M.score,"%"]}),u.jsx("div",{className:"bg-gray-700 h-2 flex-1 rounded-full overflow-hidden",children:u.jsx("div",{className:`h-full rounded-full ${M.score>=80?"bg-green-500":M.score>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${M.score}%`}})})]}),u.jsx("p",{className:"text-white text-lg mb-4",children:M.feedback}),u.jsxs("div",{className:"bg-gradient-to-r from-orange-900/40 to-red-900/40 rounded-lg p-4 mb-4 border border-orange-600/20",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx("img",{src:"/images/shifu_coacht.png",alt:"Shifu",className:"w-8 h-8 object-contain rounded mr-3"}),u.jsx("h3",{className:"text-orange-300 font-semibold",children:"Shifu's Advice"})]}),u.jsx("p",{className:"text-orange-100 text-sm leading-relaxed",children:yr(M.score,m)})]}),((to=m==null?void 0:m.referencePose)==null?void 0:to.angles)&&u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-bold text-white mb-2",children:"Angle Comparison"}),u.jsxs("div",{className:"bg-gray-900/70 rounded overflow-hidden",children:[u.jsxs("div",{className:"grid grid-cols-3 gap-1 p-2 text-xs font-medium text-gray-300",children:[u.jsx("div",{children:"Joint"}),u.jsx("div",{children:"Your Angle"}),u.jsx("div",{children:"Reference"})]}),Object.entries(m.referencePose.angles).map(([ne,he])=>{const ge=(z??{})[ne],ke=ge!==void 0?Math.abs(ge-he):void 0;return u.jsxs("div",{className:`grid grid-cols-3 gap-1 p-2 text-xs border-t border-gray-800 ${ge===void 0?"bg-red-900/20":ke!==void 0&&ke<=10?"bg-green-900/20":ke!==void 0&&ke<=20?"bg-yellow-900/20":"bg-red-900/20"}`,children:[u.jsx("div",{children:ne.replace(/_/g," ")}),u.jsx("div",{children:ge!==void 0?`${Math.round(ge)}°`:u.jsx("span",{className:"text-red-500",children:"Missing"})}),u.jsxs("div",{className:"flex items-center",children:[Math.round(he),"°",ke!==void 0&&ge!==void 0?u.jsxs("span",{className:`ml-2 text-xs ${ke<=10?"text-green-500":ke<=20?"text-yellow-500":"text-red-500"}`,children:["(",ke<=10?"✓":`${Math.round(ke)}° off`,")"]}):null]})]},ne)})]})]})]}),u.jsx("div",{className:"w-full md:w-80 bg-black rounded-lg overflow-hidden border border-gray-700",children:u.jsx("canvas",{ref:Re,className:"w-full h-full object-contain",style:{display:"block",minHeight:"320px"}})})]}),u.jsxs("div",{className:"flex gap-4 justify-center mt-6",children:[u.jsx(Se,{onClick:()=>{R(!1),q(null)},className:"bg-gray-800 hover:bg-gray-700 text-white",children:"Close"}),u.jsx(Se,{onClick:()=>{q(null),j(3);const ne=setInterval(()=>{j(he=>he<=1?(clearInterval(ne),L(!0),0):he-1)},1e3)},className:"bg-red-700 hover:bg-red-600 text-white",children:"Try Again"})]})]}):u.jsxs("div",{className:"flex flex-col md:flex-row gap-4 h-[60vh]",children:[u.jsxs("div",{className:"flex-1 md:w-1/2 relative border border-gray-800 rounded-lg overflow-hidden",children:[u.jsx("div",{className:"relative pt-[56.25%] bg-black rounded overflow-hidden mb-6",children:(()=>{var he,ge,ke;if(!m)return null;const ne=(he=m==null?void 0:m.referencePose)==null?void 0:he.imageUrl;return ne?u.jsx("img",{src:ne,alt:`Reference pose for ${m.name}`,className:"absolute inset-0 w-full h-full object-contain"}):(ge=m==null?void 0:m.referencePose)!=null&&ge.jointAngles||(ke=m==null?void 0:m.referencePose)!=null&&ke.angles?u.jsx(U4,{angles:m.referencePose.jointAngles||m.referencePose.angles}):u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:[u.jsx("span",{className:"material-icons text-6xl",children:"sports_martial_arts"}),u.jsx("span",{className:"absolute text-sm mt-16",children:"Reference pose not available"})]})})()}),u.jsx("canvas",{ref:ce,className:"absolute inset-0 w-full h-full pointer-events-none"}),((of=m==null?void 0:m.referencePose)==null?void 0:of.angles)&&Object.entries(m.referencePose.angles).map(([ne,he])=>{let ge="50%",ke="50%";return ne.includes("left_elbow")?(ge="35%",ke="45%"):ne.includes("right_elbow")?(ge="25%",ke="45%"):ne.includes("left_shoulder")?(ge="35%",ke="30%"):ne.includes("right_shoulder")?(ge="25%",ke="30%"):ne.includes("left_hip")?(ge="35%",ke="55%"):ne.includes("right_hip")?(ge="26%",ke="55%"):ne.includes("left_knee")?(ge="35%",ke="70%"):ne.includes("right_knee")&&(ge="25%",ke="70%"),u.jsx("div",{className:"absolute flex items-center justify-center w-12 h-12 -ml-6 -mt-6 text-white font-bold rounded-full",style:{left:ge,top:ke,background:"rgba(16, 185, 129, 0.85)",boxShadow:"0 0 0 3px rgba(255, 255, 255, 0.4), 0 4px 8px rgba(0, 0, 0, 0.3)"},children:u.jsxs("div",{className:"flex flex-col items-center",children:[u.jsx("span",{className:"text-[10px] opacity-80 -mt-5 bg-black/70 px-1 rounded",children:ne.replace(/_/g," ")}),u.jsxs("span",{className:"text-sm leading-none",children:[Math.round(he),"°"]})]})},ne)})]}),u.jsxs("div",{className:"flex-1 md:w-1/2 relative border border-gray-800 rounded-lg overflow-hidden bg-black",children:[!oe&&!M&&u.jsx("video",{ref:ne=>{Q(ne)},autoPlay:!0,muted:!0,playsInline:!0,className:"object-contain w-full h-full"}),oe&&u.jsx("img",{src:oe,alt:"Captured pose",className:"object-contain w-full h-full"}),u.jsx("canvas",{ref:me,className:"absolute top-0 left-0 w-full h-full"}),u.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-4 z-10",children:u.jsxs("button",{onClick:He,className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2 transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!!oe,children:[u.jsx("span",{className:"material-icons text-sm",children:"camera"}),Te!==null?`Taking in ${Te}s...`:"Take Image"]})})]})]}),u.jsx(xo,{children:!A&&!M&&u.jsx(Se,{onClick:()=>{R(!1),L(!1)},className:"bg-gray-800 hover:bg-gray-700 text-white",children:"Cancel Practice"})})]})}),u.jsx(zi,{open:Ze,onOpenChange:Ye,children:u.jsxs(pi,{className:"bg-gray-900 border border-red-900 text-white max-w-lg w-full",children:[u.jsxs(mi,{children:[u.jsx(gi,{children:"Angle Comparison Results"}),u.jsx(yo,{className:"text-gray-400",children:"Detailed comparison of your pose vs. the reference."})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-bold text-white mb-2",children:"Joint Differences"}),u.jsxs("div",{className:"bg-gray-900/70 rounded overflow-hidden",children:[u.jsxs("div",{className:"grid grid-cols-3 gap-1 p-2 text-xs font-medium text-gray-300",children:[u.jsx("div",{children:"Joint"}),u.jsx("div",{children:"Your Angle"}),u.jsx("div",{children:"Reference"})]}),Ie.differences.map(({joint:ne,userAngle:he,refAngle:ge,diff:ke})=>u.jsxs("div",{className:`grid grid-cols-3 gap-1 p-2 text-xs border-t border-gray-800 ${he===void 0?"bg-red-900/20":ke!==void 0&&ke<=10?"bg-green-900/20":ke!==void 0&&ke<=20?"bg-yellow-900/20":"bg-red-900/20"}`,children:[u.jsx("div",{children:ne.replace(/_/g," ")}),u.jsx("div",{children:he!==void 0?`${Math.round(he)}°`:u.jsx("span",{className:"text-red-500",children:"Missing"})}),u.jsxs("div",{children:[Math.round(ge),"°",ke!==void 0&&he!==void 0?u.jsxs("span",{className:`ml-2 text-xs ${ke<=10?"text-green-500":ke<=20?"text-yellow-500":"text-red-500"}`,children:["(",ke<=10?"✓":`${Math.round(ke)}° off`,")"]}):null]})]},ne))]})]}),Ie.missingJoints.length>0&&u.jsxs("div",{className:"mb-2 text-red-400 text-sm",children:[u.jsx("strong",{children:"Missing joints:"})," ",Ie.missingJoints.map(ne=>ne.replace(/_/g," ")).join(", ")]}),u.jsxs("div",{className:"mb-4 mt-6",children:[u.jsx("h4",{className:"text-sm font-bold text-white mb-2",children:"Feedback"}),u.jsx("div",{className:"bg-gray-900/70 rounded p-3 text-gray-200 text-sm",children:(()=>{const ne=[];return Ie.differences.forEach(({joint:he,userAngle:ge,refAngle:ke,diff:ft})=>{ge!==void 0&&ft!==void 0&&ft>10&&(he.includes("shoulder")?ne.push(ge<ke?"Flare arms out more (increase "+he.replace(/_/g," ")+" angle)":"Bring arms in (decrease "+he.replace(/_/g," ")+" angle)"):he.includes("elbow")?ne.push(ge<ke?"Straighten your "+he.replace(/_/g," "):"Bend your "+he.replace(/_/g," ")):he.includes("hip")?ne.push(ge<ke?"Open your hips more ("+he.replace(/_/g," ")+")":"Close your hips a bit ("+he.replace(/_/g," ")+")"):he.includes("knee")?ne.push(ge<ke?"Straighten your "+he.replace(/_/g," "):"Bend your "+he.replace(/_/g," ")):ne.push((ge<ke?"Increase ":"Decrease ")+he.replace(/_/g," ")+" angle"))}),ne.length===0?u.jsx("span",{className:"text-green-400",children:"Great job! Your form is close to the reference."}):u.jsx("ul",{className:"list-disc pl-5",children:ne.map((he,ge)=>u.jsx("li",{children:he},ge))})})()})]}),u.jsxs(xo,{children:[u.jsx(Se,{onClick:()=>Ye(!1),className:"bg-red-700 hover:bg-red-600 text-white",children:"Close"}),u.jsx(Se,{onClick:()=>{Ye(!1),q(null),ae(null),Be(!1),lt(null),je(""),setTimeout(()=>He(),100)},className:"bg-yellow-600 hover:bg-yellow-500 text-white ml-2",disabled:m&&((rl=ts[m.id])==null?void 0:rl.length)===3||Bo,children:"Try Again"})]})]})}),u.jsx(zi,{open:we,onOpenChange:ne=>!ne&&de(!1),children:u.jsxs(pi,{className:"bg-gray-900 border border-red-900 text-white max-w-5xl w-full",children:[" ",u.jsxs(mi,{children:[u.jsx(gi,{children:"Interactive Pose Sketch Tool"}),u.jsx(yo,{className:"text-gray-400",children:"Drag joints to create a pose. Angles are calculated automatically. Use sliders to fine-tune."})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",style:{minHeight:"60vh"},children:[" ",u.jsx("div",{className:"md:col-span-2 p-2 border border-gray-700 rounded-lg bg-black/50 flex items-center justify-center",children:u.jsx("canvas",{ref:Vs,width:600,height:500,className:"cursor-grab active:cursor-grabbing rounded",onMouseDown:An,onMouseMove:os,onMouseUp:Ht,onMouseLeave:zs})}),u.jsxs("div",{className:"p-4 border border-gray-700 rounded-lg bg-black/50",children:[u.jsx("h3",{className:"text-white font-bold mb-4",children:"Joint Angles"}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-gray-400 mb-2 text-sm",children:"Select Joint for Slider"}),u.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ln.map(ne=>u.jsx("button",{onClick:()=>Ot(ne),className:`px-3 py-2 text-sm rounded ${dt===ne?"bg-red-700 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:ne.replace(/_/g," ")},ne))})]}),dt&&u.jsxs("div",{className:"mb-6",children:[u.jsxs("label",{className:"block text-gray-400 mb-2 text-sm",children:[dt.replace(/_/g," ")," angle: ",Math.round(Ee[dt]||0),"°"]}),u.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:Ee[dt]||0,onChange:ne=>Yt(dt,parseInt(ne.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-red-600"}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0°"}),u.jsx("span",{children:"90°"}),u.jsx("span",{children:"180°"}),u.jsx("span",{children:"270°"}),u.jsx("span",{children:"360°"})]})]}),u.jsxs("div",{className:"bg-gray-800/60 border border-red-900/20 rounded p-3 mb-6",children:[u.jsxs("h3",{className:"text-sm font-bold text-white mb-1 flex items-center",children:[u.jsx("span",{className:"material-icons text-red-500 text-sm mr-1",children:"info"}),"How to Use"]}),u.jsxs("ol",{className:"text-gray-300 text-sm list-decimal pl-5 space-y-1",children:[u.jsx("li",{children:"Drag the green joint circles on the canvas to pose the stick figure."}),u.jsx("li",{children:"Angles are calculated and displayed automatically."}),u.jsx("li",{children:"Select a joint from the list on the right to fine-tune its angle with the slider."}),u.jsx("li",{children:'Click "Save as Reference Pose" to use this pose.'})]})]})]})]}),u.jsxs(xo,{className:"space-x-2 pt-4",children:[" ",u.jsx(Se,{onClick:()=>de(!1),className:"bg-gray-800 hover:bg-gray-700 text-white",children:"Cancel"}),u.jsx(Se,{onClick:nl,className:"bg-red-700 hover:bg-red-600 text-white",disabled:Object.keys(Ee).length===0,children:"Save as Reference Pose"})]})]})}),u.jsxs("main",{className:"flex-1 flex flex-col p-6",children:[u.jsx(jn,{href:"/",children:u.jsxs("button",{className:"flex items-center text-red-400 hover:text-red-300 mb-6",children:[u.jsx(fa,{className:"h-4 w-4 mr-2"}),u.jsx("span",{children:"Back to Home"})]})}),m?u.jsxs("div",{className:"bg-gray-900/70 border border-red-900/30 rounded-lg p-6 max-w-4xl mx-auto w-full",children:[u.jsxs("div",{className:"flex justify-between items-start mb-4",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(Se,{variant:"ghost",size:"icon",onClick:()=>g(null),className:"text-red-500 hover:bg-red-900/20",children:u.jsx(fa,{className:"h-6 w-6"})}),u.jsx("h1",{className:"text-2xl font-bold text-red-500 truncate max-w-md",children:m.name})]}),u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(Se,{variant:"outline",size:"icon",onClick:lr,className:"h-10 w-10 rounded-full border-red-600 bg-transparent hover:bg-red-700/20",children:f?u.jsx(kk,{className:"h-5 w-5 text-white"}):u.jsx(wk,{className:"h-5 w-5 text-white"})}),u.jsx(Se,{variant:"outline",size:"icon",onClick:Wl,className:"h-10 w-10 rounded-full border-red-600 bg-transparent hover:bg-red-700/20",children:u.jsx(bk,{className:"h-5 w-5 text-white"})}),u.jsxs(iT,{children:[u.jsx(oT,{asChild:!0,children:u.jsxs(Se,{variant:"outline",className:"h-8 rounded-full border-red-600 bg-transparent hover:bg-red-700/20 flex items-center px-3",children:[u.jsx(Ru,{className:"h-4 w-4 text-white mr-2"}),u.jsx("span",{className:"text-sm text-white font-medium",children:t==null?void 0:t.username})]})}),u.jsx(mw,{align:"end",className:"w-40 border border-red-600 bg-gray-900",children:u.jsxs(lp,{className:"cursor-pointer flex items-center text-white hover:bg-red-700/30",onClick:()=>e.mutate(),children:[u.jsx(vk,{className:"mr-2 h-4 w-4"}),u.jsx("span",{children:"Logout"})]})})]})]})]}),u.jsxs("div",{className:"badge-container flex gap-2 mb-4",children:[u.jsx("span",{className:"bg-red-700/60 text-white text-xs px-2 py-1 rounded",children:m.category}),u.jsx("span",{className:"bg-red-900/60 text-white text-xs px-2 py-1 rounded",children:m.difficulty}),m&&((Ul=m.referencePose)==null?void 0:Ul.processed)&&u.jsxs("span",{className:"bg-green-700/60 text-white text-xs px-2 py-1 rounded flex items-center",children:[u.jsx("span",{className:"material-icons text-xs mr-1",children:"check_circle"}),"Reference Available"]})]}),u.jsx("p",{className:"text-gray-300 mb-3",children:m.description}),m&&m.tip&&u.jsxs("div",{className:"bg-gray-800/60 border border-red-900/20 rounded p-3 mb-4",children:[u.jsxs("h3",{className:"text-sm font-bold text-white mb-1 flex items-center",children:[u.jsx("span",{className:"material-icons text-red-500 text-sm mr-1",children:"tips_and_updates"}),"Coach Tip"]}),u.jsx("p",{className:"text-gray-300 text-sm",children:m.tip})]}),m&&u.jsxs("div",{className:"bg-gradient-to-r from-orange-900/40 to-red-900/40 rounded-lg p-4 mb-6 border border-orange-600/20",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx("img",{src:"/images/shifu_coacht.png",alt:"Shifu",className:"w-7 h-7 object-contain rounded mr-3"}),u.jsx("h3",{className:"text-orange-300 font-semibold text-sm",children:"Shifu's Technique Guide"})]}),u.jsx("p",{className:"text-orange-100 text-sm leading-relaxed",children:Ri(m)})]}),u.jsx("div",{className:"relative pt-[56.25%] bg-black rounded overflow-hidden mb-6",children:(()=>{var he,ge,ke;if(!m)return null;const ne=(he=m==null?void 0:m.referencePose)==null?void 0:he.imageUrl;return ne?u.jsx("img",{src:ne,alt:`Reference pose for ${m.name}`,className:"absolute inset-0 w-full h-full object-contain"}):(ge=m==null?void 0:m.referencePose)!=null&&ge.jointAngles||(ke=m==null?void 0:m.referencePose)!=null&&ke.angles?u.jsx(U4,{angles:m.referencePose.jointAngles||m.referencePose.angles}):u.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:[u.jsx("span",{className:"material-icons text-6xl",children:"sports_martial_arts"}),u.jsx("span",{className:"absolute text-sm mt-16",children:"Reference pose not available"})]})})()}),x&&u.jsxs("div",{className:"border border-red-900/40 rounded-lg mb-6 p-4 bg-gray-800/40",children:[u.jsxs("h3",{className:"text-white font-bold mb-3 flex items-center",children:[u.jsx(Ck,{className:"h-4 w-4 mr-2 text-red-500"}),"Developer Tools"]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("input",{type:"file",accept:"image/*",ref:ee,style:{display:"none"},onChange:Ei}),u.jsxs("div",{className:"flex flex-wrap gap-3 mb-3",children:[u.jsxs("button",{onClick:()=>{var ne;return(ne=ee.current)==null?void 0:ne.click()},className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded flex items-center",disabled:xe,children:[u.jsx("span",{className:"material-icons text-sm mr-1",children:"upload"}),"Upload Reference Image"]}),u.jsxs("button",{onClick:it,className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded flex items-center",children:[u.jsx("span",{className:"material-icons text-sm mr-1",children:"gesture"}),"Sketch Reference Pose"]}),U&&u.jsx("button",{onClick:Mo,className:"px-3 py-2 bg-green-700 hover:bg-green-600 text-white text-sm rounded flex items-center",disabled:xe,children:xe?u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"material-icons animate-spin text-sm mr-1",children:"refresh"}),"Processing..."]}):u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"material-icons text-sm mr-1",children:"fitness_center"}),"Process Reference Image"]})}),((af=m==null?void 0:m.referencePose)==null?void 0:af.processed)&&u.jsxs("button",{onClick:is,className:"px-3 py-2 bg-red-700 hover:bg-red-600 text-white text-sm rounded flex items-center",children:[u.jsx("span",{className:"material-icons text-sm mr-1",children:"save"}),"Save to Database"]})]}),U&&u.jsxs("div",{className:"relative pt-[40%] bg-black rounded overflow-hidden mb-3",children:[u.jsx("img",{src:U,alt:"Uploaded reference",className:"absolute inset-0 w-full h-full object-contain"}),u.jsx("canvas",{ref:Pe,className:"absolute inset-0 w-full h-full",style:{display:"none"}})]})]}),x&&u.jsxs("div",{className:"mb-3",children:[u.jsx("label",{className:"block text-gray-400 mb-1 text-sm",children:"Reference Image URL"}),u.jsx("input",{type:"text",placeholder:"Paste image URL here (for persistence)",value:Vo,onChange:ne=>oi(ne.target.value),className:"bg-gray-800 border border-red-900/30 text-white px-2 py-1 rounded w-full"}),u.jsx("span",{className:"text-xs text-gray-500",children:"If you want this image to persist after refresh, paste a real image URL here."})]})]}),u.jsxs("div",{className:"flex justify-between flex-wrap gap-3",children:[u.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded",children:"Back to Library"}),u.jsxs("button",{onClick:fs,className:`px-4 py-2 ${m!=null&&m.referencePose&&(m.referencePose.imageUrl||m.referencePose.jointAngles||m.referencePose.angles)?"bg-red-700 hover:bg-red-600":"bg-gray-700 cursor-not-allowed"} text-white rounded flex items-center`,disabled:!(m!=null&&m.referencePose&&(m.referencePose.imageUrl||m.referencePose.jointAngles||m.referencePose.angles)),children:[u.jsx("span",{className:"material-icons text-sm mr-1",children:"fitness_center"}),"Practice this move"]})]})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8",children:[u.jsx("h1",{className:"text-3xl font-bold text-white mb-4 md:mb-0",children:"Taekwondo Practice Library"}),u.jsxs("div",{className:"relative w-full md:w-64",children:[u.jsx(pee,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),u.jsx(ar,{type:"text",placeholder:"Search moves...",className:"pl-10 bg-gray-900 border-red-900/30 text-white",value:o,onChange:ne=>a(ne.target.value)})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-gray-400 mb-2 text-sm",children:"Category"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:nGe.map(ne=>u.jsx("button",{onClick:()=>c(ne),className:`px-3 py-1 text-sm rounded-full ${l===ne?"bg-red-700 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:ne},ne))})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-gray-400 mb-2 text-sm",children:"Difficulty"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:sGe.map(ne=>u.jsx("button",{onClick:()=>h(ne),className:`px-3 py-1 text-sm rounded-full ${d===ne?"bg-red-700 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:ne},ne))})]})]}),$e.length>0?u.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[u.jsxs("div",{onClick:()=>g({id:0,name:"Test",category:"Testing",difficulty:"Beginner",description:"Simple test case for verifying basic functionality before implementing complex moves",referencePose:{imageUrl:"",processed:!0,angles:{left_shoulder:90,right_shoulder:90,left_elbow:90,right_elbow:90,left_hip:90,right_hip:90,left_knee:90,right_knee:90}}}),className:"bg-gray-900/70 border-2 border-blue-500 rounded-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105",children:[u.jsx("div",{className:"aspect-video bg-black/60 relative",children:u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsx("span",{className:"material-icons text-blue-500 text-4xl",children:"science"})})}),u.jsxs("div",{className:"p-4",children:[u.jsx("div",{className:"flex justify-between items-start mb-2",children:u.jsx("h3",{className:"text-white font-medium line-clamp-1",children:"Test"})}),u.jsx("div",{className:"flex gap-2 mb-2",children:u.jsx("span",{className:"bg-blue-900/40 text-white text-xs px-1.5 py-0.5 rounded",children:"Simulation"})}),u.jsx("p",{className:"text-gray-400 text-sm line-clamp-2",children:"Simple test case for verifying basic functionality"})]})]}),$e.map(ne=>u.jsxs("div",{onClick:()=>g(ne),className:"bg-gray-900/70 border border-red-900/30 rounded-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105",style:{boxShadow:wa(ne.id),transition:"box-shadow 0.4s"},children:[u.jsx("div",{className:"aspect-video bg-black/60 relative",children:u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsx("span",{className:"material-icons text-red-600 text-4xl",children:"sports_martial_arts"})})}),u.jsxs("div",{className:"p-4",children:[u.jsx("div",{className:"flex justify-between items-start mb-2",children:u.jsx("h3",{className:"text-white font-medium line-clamp-1",children:ne.name})}),u.jsx("div",{className:"flex gap-2 mb-2",children:u.jsx("span",{className:"bg-red-900/40 text-white text-xs px-1.5 py-0.5 rounded",children:ne.difficulty})}),u.jsx("p",{className:"text-gray-400 text-sm line-clamp-2",children:ne.description})]})]},ne.id))]}):u.jsxs("div",{className:"text-center py-12",children:[u.jsx("span",{className:"material-icons text-red-600 text-5xl mb-4",children:"search_off"}),u.jsx("h3",{className:"text-xl text-white mb-2",children:"No moves found"}),u.jsx("p",{className:"text-gray-400",children:"Try adjusting your search or filters"})]})]})]}),!_t&&!m&&u.jsx(iu,{expression:"pointing",message:"Choose a technique from the library to practice! Start with basics if you're new to martial arts.",position:"top-right",pointingDirection:"down",onDismiss:()=>{Zt(!0),localStorage.setItem("hasSeenPracticeGuides","true")},showDelay:1e3,autoShow:!0}),m&&!$&&!$r&&u.jsx(iu,{expression:"neutral",message:`Great choice! ${m.name} is a ${m.difficulty.toLowerCase()} level technique. Review the pose and when ready, click 'Practice this move'.`,position:"top-left",onDismiss:()=>Xs(!0),showDelay:2e3,autoShow:!0}),$&&A>0&&!Ii&&u.jsx(iu,{expression:"happy",message:"Get into position! I'll analyze your form and give you feedback. Remember to hold the pose steady when the camera captures!",position:"center",onDismiss:()=>sl(!0),showDelay:500,autoShow:!0}),M&&M.score>=80&&!as&&u.jsx(iu,{expression:"happy",message:"Excellent form! Your technique is really improving. Keep practicing to maintain this level!",position:"top-right",onDismiss:()=>Oe(!0),showDelay:1e3,autoShow:!0}),M&&M.score<60&&!as&&u.jsx(iu,{expression:"sad",message:"Don't worry, practice makes perfect! Focus on the highlighted joints and try again. You're learning!",position:"top-right",onDismiss:()=>Oe(!0),showDelay:1e3,autoShow:!0})]})}var aGe="Separator",H4="horizontal",lGe=["horizontal","vertical"],Oq=b.forwardRef((t,e)=>{const{decorative:n,orientation:s=H4,...r}=t,i=cGe(s)?s:H4,a=n?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return u.jsx(Mt.div,{"data-orientation":i,...a,...r,ref:e})});Oq.displayName=aGe;function cGe(t){return lGe.includes(t)}var Fq=Oq;const Mq=b.forwardRef(({className:t,orientation:e="horizontal",decorative:n=!0,...s},r)=>u.jsx(Fq,{ref:r,decorative:n,orientation:e,className:Pt("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...s}));Mq.displayName=Fq.displayName;var h3="Radio",[uGe,Lq]=Ao(h3),[dGe,hGe]=uGe(h3),Bq=b.forwardRef((t,e)=>{const{__scopeRadio:n,name:s,checked:r=!1,required:i,disabled:o,value:a="on",onCheck:l,form:c,...d}=t,[h,f]=b.useState(null),p=Pn(e,x=>f(x)),m=b.useRef(!1),g=h?c||!!h.closest("form"):!0;return u.jsxs(dGe,{scope:n,checked:r,disabled:o,children:[u.jsx(Mt.button,{type:"button",role:"radio","aria-checked":r,"data-state":Wq(r),"data-disabled":o?"":void 0,disabled:o,value:a,...d,ref:p,onClick:nt(t.onClick,x=>{r||l==null||l(),g&&(m.current=x.isPropagationStopped(),m.current||x.stopPropagation())})}),g&&u.jsx(fGe,{control:h,bubbles:!m.current,name:s,value:a,checked:r,required:i,disabled:o,form:c,style:{transform:"translateX(-100%)"}})]})});Bq.displayName=h3;var Vq="RadioIndicator",zq=b.forwardRef((t,e)=>{const{__scopeRadio:n,forceMount:s,...r}=t,i=hGe(Vq,n);return u.jsx(jo,{present:s||i.checked,children:u.jsx(Mt.span,{"data-state":Wq(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:e})})});zq.displayName=Vq;var fGe=t=>{const{control:e,checked:n,bubbles:s=!0,...r}=t,i=b.useRef(null),o=u3(n),a=D_(e);return b.useEffect(()=>{const l=i.current,c=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(c,"checked").set;if(o!==n&&h){const f=new Event("click",{bubbles:s});h.call(l,n),l.dispatchEvent(f)}},[o,n,s]),u.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:n,...r,tabIndex:-1,ref:i,style:{...t.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Wq(t){return t?"checked":"unchecked"}var pGe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],f3="RadioGroup",[mGe,A7e]=Ao(f3,[_m,Lq]),Uq=_m(),Hq=Lq(),[gGe,xGe]=mGe(f3),Gq=b.forwardRef((t,e)=>{const{__scopeRadioGroup:n,name:s,defaultValue:r,value:i,required:o=!1,disabled:a=!1,orientation:l,dir:c,loop:d=!0,onValueChange:h,...f}=t,p=Uq(n),m=Gx(c),[g,x]=Sc({prop:i,defaultProp:r,onChange:h});return u.jsx(gGe,{scope:n,name:s,required:o,disabled:a,value:g,onValueChange:x,children:u.jsx(UP,{asChild:!0,...p,orientation:l,dir:m,loop:d,children:u.jsx(Mt.div,{role:"radiogroup","aria-required":o,"aria-orientation":l,"data-disabled":a?"":void 0,dir:m,...f,ref:e})})})});Gq.displayName=f3;var Kq="RadioGroupItem",qq=b.forwardRef((t,e)=>{const{__scopeRadioGroup:n,disabled:s,...r}=t,i=xGe(Kq,n),o=i.disabled||s,a=Uq(n),l=Hq(n),c=b.useRef(null),d=Pn(e,c),h=i.value===r.value,f=b.useRef(!1);return b.useEffect(()=>{const p=g=>{pGe.includes(g.key)&&(f.current=!0)},m=()=>f.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",m),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",m)}},[]),u.jsx(HP,{asChild:!0,...a,focusable:!o,active:h,children:u.jsx(Bq,{disabled:o,required:i.required,checked:h,...l,...r,name:i.name,ref:d,onCheck:()=>i.onValueChange(r.value),onKeyDown:nt(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:nt(r.onFocus,()=>{var p;f.current&&((p=c.current)==null||p.click())})})})});qq.displayName=Kq;var yGe="RadioGroupIndicator",Xq=b.forwardRef((t,e)=>{const{__scopeRadioGroup:n,...s}=t,r=Hq(n);return u.jsx(zq,{...r,...s,ref:e})});Xq.displayName=yGe;var Yq=Gq,Qq=qq,vGe=Xq;const Zq=b.forwardRef(({className:t,...e},n)=>u.jsx(Yq,{className:Pt("grid gap-2",t),...e,ref:n}));Zq.displayName=Yq.displayName;const Hv=b.forwardRef(({className:t,...e},n)=>u.jsx(Qq,{ref:n,className:Pt("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...e,children:u.jsx(vGe,{className:"flex items-center justify-center",children:u.jsx(DV,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Hv.displayName=Qq.displayName;var p3="Checkbox",[bGe,j7e]=Ao(p3),[wGe,SGe]=bGe(p3),Jq=b.forwardRef((t,e)=>{const{__scopeCheckbox:n,name:s,checked:r,defaultChecked:i,required:o,disabled:a,value:l="on",onCheckedChange:c,form:d,...h}=t,[f,p]=b.useState(null),m=Pn(e,C=>p(C)),g=b.useRef(!1),x=f?d||!!f.closest("form"):!0,[y=!1,v]=Sc({prop:r,defaultProp:i,onChange:c}),S=b.useRef(y);return b.useEffect(()=>{const C=f==null?void 0:f.form;if(C){const k=()=>v(S.current);return C.addEventListener("reset",k),()=>C.removeEventListener("reset",k)}},[f,v]),u.jsxs(wGe,{scope:n,state:y,disabled:a,children:[u.jsx(Mt.button,{type:"button",role:"checkbox","aria-checked":Mu(y)?"mixed":y,"aria-required":o,"data-state":nX(y),"data-disabled":a?"":void 0,disabled:a,value:l,...h,ref:m,onKeyDown:nt(t.onKeyDown,C=>{C.key==="Enter"&&C.preventDefault()}),onClick:nt(t.onClick,C=>{v(k=>Mu(k)?!0:!k),x&&(g.current=C.isPropagationStopped(),g.current||C.stopPropagation())})}),x&&u.jsx(CGe,{control:f,bubbles:!g.current,name:s,value:l,checked:y,required:o,disabled:a,form:d,style:{transform:"translateX(-100%)"},defaultChecked:Mu(i)?!1:i})]})});Jq.displayName=p3;var eX="CheckboxIndicator",tX=b.forwardRef((t,e)=>{const{__scopeCheckbox:n,forceMount:s,...r}=t,i=SGe(eX,n);return u.jsx(jo,{present:s||Mu(i.state)||i.state===!0,children:u.jsx(Mt.span,{"data-state":nX(i.state),"data-disabled":i.disabled?"":void 0,...r,ref:e,style:{pointerEvents:"none",...t.style}})})});tX.displayName=eX;var CGe=t=>{const{control:e,checked:n,bubbles:s=!0,defaultChecked:r,...i}=t,o=b.useRef(null),a=u3(n),l=D_(e);b.useEffect(()=>{const d=o.current,h=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(h,"checked").set;if(a!==n&&p){const m=new Event("click",{bubbles:s});d.indeterminate=Mu(n),p.call(d,Mu(n)?!1:n),d.dispatchEvent(m)}},[a,n,s]);const c=b.useRef(Mu(n)?!1:n);return u.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r??c.current,...i,tabIndex:-1,ref:o,style:{...t.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function Mu(t){return t==="indeterminate"}function nX(t){return Mu(t)?"indeterminate":t?"checked":"unchecked"}var sX=Jq,kGe=tX;const rX=b.forwardRef(({className:t,...e},n)=>u.jsx(sX,{ref:n,className:Pt("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...e,children:u.jsx(kGe,{className:Pt("flex items-center justify-center text-current"),children:u.jsx(n1,{className:"h-4 w-4"})})}));rX.displayName=sX.displayName;const NGe=Ts.object({fullName:Ts.string().min(2,{message:"Full name must be at least 2 characters"}),email:Ts.string().email({message:"Please enter a valid email address"}),referralSource:Ts.string().min(1,{message:"Please tell us how you heard about us"}),experienceLevel:Ts.string().optional(),newsletterOptIn:Ts.boolean().default(!0)});function TGe(){const{toast:t}=Qw();SK();const[e,n]=b.useState(1),[s,r]=b.useState(!1),[i,o]=b.useState(0),{scrollYProgress:a}=FP(),l=ja(a,[0,1],["-100%","100%"]),c=ja(a,[0,1],["-150%","80%"]),d=ja(a,[0,1],["-120%","90%"]);b.useEffect(()=>{const C=()=>{o(window.scrollY)};return window.addEventListener("scroll",C,{passive:!0}),()=>window.removeEventListener("scroll",C)},[]);const h=a3({resolver:c3(NGe),defaultValues:{fullName:"",email:"",referralSource:"",experienceLevel:"beginner",newsletterOptIn:!0}}),f=za({mutationFn:async C=>{const k=await aa("POST","/api/early-access",C);if(!k.ok){const T=await k.json();throw new Error(T.message||"Something went wrong")}return k.json()},onSuccess:()=>{r(!0),t({title:"Success!",description:"You're on the list! We'll be in touch soon.",variant:"default"})},onError:C=>{t({title:"Error",description:C.message||"Something went wrong. Please try again.",variant:"destructive"})}}),p=C=>{f.mutate(C)},m=()=>{e===1&&(h.trigger(["fullName","email"]),h.formState.errors.fullName||h.formState.errors.email)||n(e+1)},g=()=>{n(e-1)};if(s)return u.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-black to-red-950 p-4 relative overflow-hidden",children:[u.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none overflow-hidden",children:[u.jsx(X.div,{className:"absolute w-8 md:w-12 h-full opacity-60 left-[5%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #ff3d00, #ff0844, #9c27b0)",filter:"blur(15px)"},animate:{y:["0%","100%","0%"],opacity:[.6,.8,.6]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),u.jsx(X.div,{className:"absolute w-4 md:w-6 h-full opacity-40 left-[10%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #ff5722, #f44336, #e91e63)",filter:"blur(12px)"},animate:{y:["0%","80%","0%"],opacity:[.4,.7,.4]},transition:{duration:10,repeat:1/0,ease:"easeInOut"}}),u.jsx(X.div,{className:"absolute w-10 md:w-16 h-full opacity-50 right-[8%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #304ffe, #651fff, #d500f9)",filter:"blur(20px)"},animate:{y:["0%","90%","0%"],opacity:[.5,.8,.5]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1}}),u.jsx(X.div,{className:"absolute w-3 md:w-5 h-full opacity-30 right-[15%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #00b0ff, #2979ff, #651fff)",filter:"blur(10px)"},animate:{y:["0%","85%","0%"],opacity:[.3,.6,.3]},transition:{duration:9,repeat:1/0,ease:"easeInOut",delay:2}})]}),u.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:Array.from({length:20}).map((C,k)=>u.jsx(X.div,{className:"absolute rounded-full",style:{width:Math.random()*8+2,height:Math.random()*8+2,backgroundColor:["#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#f44336"][Math.floor(Math.random()*8)],filter:`blur(${Math.random()*2}px)`,boxShadow:`0 0 ${Math.random()*10+5}px rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.8)`,top:"50%",left:"50%"},initial:{scale:0,x:0,y:0,opacity:0},animate:{scale:[0,1,.5],x:[(Math.random()-.5)*300,(Math.random()-.5)*400],y:[(Math.random()-.5)*300,(Math.random()-.5)*400],opacity:[0,.8,0]},transition:{duration:2+Math.random()*2,repeat:1/0,delay:Math.random()*2,repeatDelay:Math.random()*3}},`success-particle-${k}`))}),u.jsx(X.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"max-w-md w-full z-10",children:u.jsx(Ks,{className:"p-8 bg-black/80 border border-green-500/30 rounded-xl shadow-xl backdrop-blur-sm",children:u.jsxs("div",{className:"flex flex-col items-center space-y-6 text-center",children:[u.jsx(X.div,{initial:{scale:.8,rotate:-10},animate:{scale:[.8,1.2,1],rotate:[-10,10,0]},transition:{duration:.8,ease:"easeOut"},children:u.jsx(Ff,{className:"w-24 h-24 text-green-500"})}),u.jsx(X.h1,{className:"text-3xl font-bold text-white",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},children:"You're on the List!"}),u.jsx(X.p,{className:"text-gray-300",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},children:"Thanks for signing up for early access to CoachT. We'll notify you as soon as we're ready to welcome you!"}),u.jsx(X.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.7,duration:.5},whileHover:{scale:1.05},children:u.jsx(Se,{asChild:!0,className:"px-6 py-3 rounded-lg text-base font-medium group relative overflow-hidden",style:{background:"linear-gradient(45deg, #00c853, #69f0ae, #00c853)",backgroundSize:"200% 200%",color:"white",transition:"all 0.5s ease",border:"2px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 10px 20px rgba(0, 200, 83, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.1)"},children:u.jsxs(jn,{href:"/",className:"flex items-center",children:[u.jsx("span",{className:"font-bold drop-shadow-[0_1px_1px_rgba(0,0,0,0.3)]",children:"Return to Home"}),u.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:u.jsx(X.div,{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent)",backgroundSize:"200% 200%"},animate:{backgroundPosition:["0% 0%","100% 100%","0% 0%"]},transition:{duration:2.5,repeat:1/0,ease:"linear"}})})]})})})]})})})]});const x=b.useRef(null),y=eT(0),v=eT(0),S=kVe();return b.useEffect(()=>{const C=k=>{if(x.current){const T=x.current.getBoundingClientRect(),_=k.clientX-T.left,$=k.clientY-T.top;y.set(_),v.set($),S.start(R=>{const A=R%6*(T.width/5),j=Math.floor(R/6)*(T.height/5),L=Math.sqrt(Math.pow(A-_,2)+Math.pow(j-$,2))<150;return{x:A+(L?(A-_)*-.1:0),y:j+(L?(j-$)*-.1:0),scale:L?1.5:1,opacity:L?1:.4,transition:{duration:.5}}})}};return window.addEventListener("mousemove",C),()=>window.removeEventListener("mousemove",C)},[S,y,v]),b.useEffect(()=>{if(x.current){const C=x.current.getBoundingClientRect();for(let k=0;k<36;k++)k%6*(C.width/5),Math.floor(k/6)*(C.height/5)}},[]),u.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-black to-red-950 p-4 relative overflow-hidden",children:[u.jsxs("div",{className:"fixed inset-0 z-0 pointer-events-none overflow-hidden",children:[u.jsx(X.div,{className:"absolute w-8 md:w-12 h-full opacity-60 left-[5%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #ff3d00, #ff0844, #9c27b0)",filter:"blur(15px)",transform:"translateY(var(--y))",willChange:"transform",y:l}}),u.jsx(X.div,{className:"absolute w-4 md:w-6 h-full opacity-40 left-[10%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #ff5722, #f44336, #e91e63)",filter:"blur(12px)",transform:"translateY(var(--y))",willChange:"transform",y:c}}),u.jsx(X.div,{className:"absolute w-10 md:w-16 h-full opacity-50 right-[8%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #304ffe, #651fff, #d500f9)",filter:"blur(20px)",transform:"translateY(var(--y))",willChange:"transform",y:d}}),u.jsx(X.div,{className:"absolute w-3 md:w-5 h-full opacity-30 right-[15%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #00b0ff, #2979ff, #651fff)",filter:"blur(10px)",transform:"translateY(var(--y))",willChange:"transform",y:l}}),u.jsx(X.div,{className:"absolute w-6 md:w-8 h-full opacity-40 right-[20%] top-0 rounded-full",style:{background:"linear-gradient(to bottom, #ff9100, #ff3d00, #dd2c00)",filter:"blur(15px)",transform:"translateY(var(--y))",willChange:"transform",y:c}})]}),u.jsxs("div",{ref:x,className:"absolute inset-0 z-0 pointer-events-none",children:[Array.from({length:36}).map((C,k)=>u.jsx(X.div,{custom:k,animate:S,initial:{x:k%6*(window.innerWidth/5),y:Math.floor(k/6)*(window.innerHeight/5),opacity:.4,scale:1},className:"absolute rounded-full",style:{width:Math.random()*3+2,height:Math.random()*3+2,backgroundColor:`rgba(255, ${Math.random()*100+50}, ${Math.random()*100}, ${Math.random()*.3+.7})`,boxShadow:`0 0 8px rgba(255, ${Math.random()*50+100}, ${Math.random()*50}, 0.7)`}},`node-${k}`)),u.jsxs("svg",{className:"absolute inset-0 w-full h-full",children:[u.jsx("defs",{children:u.jsxs("linearGradient",{id:"webGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[u.jsx("stop",{offset:"0%",stopColor:"rgba(255, 30, 30, 0.4)"}),u.jsx("stop",{offset:"50%",stopColor:"rgba(255, 120, 50, 0.2)"}),u.jsx("stop",{offset:"100%",stopColor:"rgba(255, 60, 100, 0.4)"})]})}),Array.from({length:6}).map((C,k)=>u.jsx(X.line,{initial:{opacity:0},animate:{opacity:.3+k%2*.1},x1:"0",y1:k*(window.innerHeight/5),x2:window.innerWidth,y2:k*(window.innerHeight/5),stroke:"url(#webGradient)",strokeWidth:"0.5"},`h-line-${k}`)),Array.from({length:6}).map((C,k)=>u.jsx(X.line,{initial:{opacity:0},animate:{opacity:.3+k%2*.1},x1:k*(window.innerWidth/5),y1:"0",x2:k*(window.innerWidth/5),y2:window.innerHeight,stroke:"url(#webGradient)",strokeWidth:"0.5"},`v-line-${k}`)),Array.from({length:10}).map((C,k)=>u.jsx(X.line,{initial:{opacity:0},animate:{opacity:[.1,.3,.1],pathLength:[.3,1,.3]},transition:{duration:10+k*2,repeat:1/0,repeatType:"reverse"},x1:Math.random()*window.innerWidth,y1:Math.random()*window.innerHeight,x2:Math.random()*window.innerWidth,y2:Math.random()*window.innerHeight,stroke:`rgba(255, ${50+k*20}, ${50+k*5}, 0.4)`,strokeWidth:"0.5"},`d-line-${k}`))]})]}),Array.from({length:20}).map((C,k)=>u.jsx(X.div,{className:"absolute rounded-full z-0",initial:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:0},animate:{x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,opacity:[0,.7,0],scale:[.5,1.5,.5]},transition:{duration:10+Math.random()*20,ease:"easeInOut",repeat:1/0,delay:Math.random()*5},style:{width:Math.random()*5+2,height:Math.random()*5+2,backgroundColor:`rgba(${150+Math.random()*105}, ${30+Math.random()*225}, ${50+Math.random()*100}, 0.8)`,filter:`blur(${Math.random()*2}px)`,boxShadow:`0 0 ${Math.random()*10+5}px rgba(255, ${Math.random()*150+50}, ${Math.random()*100+50}, 0.8)`}},`particle-${k}`)),u.jsx(X.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},className:"max-w-4xl w-full",children:u.jsx(Ks,{className:"p-0 overflow-hidden bg-black/80 border border-red-500/30 rounded-xl shadow-xl backdrop-blur-sm",children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[u.jsxs("div",{className:"p-8",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[u.jsx(gh,{className:"w-5 h-5 text-red-500"}),u.jsx("h1",{className:"text-2xl font-bold text-white",children:"CoachT Early Access"})]}),u.jsx("p",{className:"text-gray-400 mb-8",children:"Join our exclusive waitlist and be among the first to experience the future of Taekwondo training."}),u.jsxs("form",{onSubmit:h.handleSubmit(p),className:"space-y-4",children:[e===1&&u.jsxs(X.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(dl,{htmlFor:"fullName",className:"text-white",children:"Full Name"}),u.jsx(ar,{id:"fullName",placeholder:"Enter your full name",className:"bg-gray-900 border-gray-700 text-white",...h.register("fullName")}),h.formState.errors.fullName&&u.jsx("p",{className:"text-sm text-red-500",children:h.formState.errors.fullName.message})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(dl,{htmlFor:"email",className:"text-white",children:"Email Address"}),u.jsx(ar,{id:"email",type:"email",placeholder:"Enter your email",className:"bg-gray-900 border-gray-700 text-white",...h.register("email")}),h.formState.errors.email&&u.jsx("p",{className:"text-sm text-red-500",children:h.formState.errors.email.message})]}),u.jsx(Se,{type:"button",onClick:m,className:"w-full bg-red-600 hover:bg-red-700",children:"Continue"})]}),e===2&&u.jsxs(X.div,{initial:{x:20,opacity:0},animate:{x:0,opacity:1},className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(dl,{htmlFor:"experienceLevel",className:"text-white",children:"Your Taekwondo Experience"}),u.jsxs(Zq,{defaultValue:h.getValues("experienceLevel")||"beginner",onValueChange:C=>h.setValue("experienceLevel",C),className:"pt-2",children:[u.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[u.jsx(Hv,{value:"beginner",id:"beginner"}),u.jsx(dl,{htmlFor:"beginner",className:"text-gray-300",children:"Beginner"})]}),u.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[u.jsx(Hv,{value:"intermediate",id:"intermediate"}),u.jsx(dl,{htmlFor:"intermediate",className:"text-gray-300",children:"Intermediate"})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Hv,{value:"advanced",id:"advanced"}),u.jsx(dl,{htmlFor:"advanced",className:"text-gray-300",children:"Advanced"})]})]})]}),u.jsxs("div",{className:"space-y-2 mt-6",children:[u.jsx(dl,{htmlFor:"referralSource",className:"text-white",children:"How did you hear about us?"}),u.jsx(q0,{id:"referralSource",placeholder:"Tell us how you found CoachT",className:"bg-gray-900 border-gray-700 text-white h-24",...h.register("referralSource")}),h.formState.errors.referralSource&&u.jsx("p",{className:"text-sm text-red-500",children:h.formState.errors.referralSource.message})]}),u.jsxs("div",{className:"flex items-center space-x-2 mt-6",children:[u.jsx(rX,{id:"newsletterOptIn",defaultChecked:!0,onCheckedChange:C=>h.setValue("newsletterOptIn",C)}),u.jsx(dl,{htmlFor:"newsletterOptIn",className:"text-sm text-gray-300",children:"Keep me updated with news and progress"})]}),u.jsxs("div",{className:"flex gap-2 mt-6",children:[u.jsx(Se,{type:"button",onClick:g,variant:"outline",className:"flex-1 border-gray-700 text-white",children:"Back"}),u.jsx(Se,{type:"submit",disabled:f.isPending,className:"flex-1 bg-red-600 hover:bg-red-700",children:f.isPending?"Submitting...":"Join the Waitlist"})]})]})]}),u.jsx("p",{className:"text-gray-500 text-xs mt-8 text-center",children:"By signing up, you agree to our Terms and Privacy Policy."})]}),u.jsxs("div",{className:"bg-gradient-to-br from-red-950 to-black hidden md:block relative overflow-hidden",children:[u.jsx("div",{className:"absolute inset-0 bg-black/40 z-10"}),u.jsxs("div",{className:"relative z-20 flex flex-col h-full justify-center px-8 py-12",children:[u.jsx("h2",{className:"text-3xl font-bold text-white mb-6",children:"Revolutionize Your Taekwondo Training"}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"mt-1 bg-red-500 p-1 rounded-full",children:u.jsx(Ff,{className:"w-4 h-4 text-white"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-white font-semibold",children:"Real-time pose tracking"}),u.jsx("p",{className:"text-gray-300 text-sm",children:"Get instant feedback on your form and technique"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"mt-1 bg-red-500 p-1 rounded-full",children:u.jsx(Ff,{className:"w-4 h-4 text-white"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-white font-semibold",children:"Movement comparison"}),u.jsx("p",{className:"text-gray-300 text-sm",children:"Compare your moves with expert references"})]})]}),u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"mt-1 bg-red-500 p-1 rounded-full",children:u.jsx(Ff,{className:"w-4 h-4 text-white"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-white font-semibold",children:"Progress tracking"}),u.jsx("p",{className:"text-gray-300 text-sm",children:"Monitor your improvement over time"})]})]})]}),u.jsx(Mq,{className:"my-8 bg-red-500/30"}),u.jsxs("div",{className:"mt-auto",children:[u.jsx("p",{className:"text-white text-lg font-semibold",children:"Early Access Benefits:"}),u.jsx("p",{className:"text-gray-300 mt-2",children:"Get exclusive features, priority support, and be part of shaping the future of martial arts training technology."})]})]}),u.jsx("div",{className:"absolute -bottom-16 -right-16 w-64 h-64 bg-red-600/10 rounded-full blur-3xl"}),u.jsx("div",{className:"absolute top-1/4 -left-16 w-64 h-64 bg-red-600/10 rounded-full blur-3xl"})]})]})})}),u.jsx(X.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},className:"mt-8 mb-4",children:u.jsx(Se,{asChild:!0,className:"px-8 py-6 rounded-lg text-lg font-medium group relative overflow-hidden",style:{background:"linear-gradient(45deg, #304ffe, #651fff, #d500f9, #304ffe)",backgroundSize:"300% 300%",color:"white",transition:"all 0.5s ease",border:"2px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 10px 20px rgba(80, 0, 190, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.1)"},onMouseEnter:C=>{C.currentTarget.style.backgroundPosition="100% 100%",C.currentTarget.style.transform="scale(1.05) translateY(-3px)",C.currentTarget.style.boxShadow="0 15px 30px rgba(80, 0, 190, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.2)",C.currentTarget.style.border="2px solid rgba(255, 255, 255, 0.2)"},onMouseLeave:C=>{C.currentTarget.style.backgroundPosition="0% 0%",C.currentTarget.style.transform="scale(1) translateY(0)",C.currentTarget.style.boxShadow="0 10px 20px rgba(80, 0, 190, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.1)",C.currentTarget.style.border="2px solid rgba(255, 255, 255, 0.1)"},children:u.jsxs(jn,{href:"/",className:"flex items-center",children:[u.jsx("div",{className:"absolute inset-0 overflow-hidden",children:Array.from({length:8}).map((C,k)=>u.jsx(X.div,{className:"absolute rounded-full bg-white",style:{width:Math.random()*3+1,height:Math.random()*3+1,filter:"blur(1px)",opacity:.3+Math.random()*.3},initial:{x:Math.random()*100+"%",y:Math.random()*100+"%",scale:0},animate:{x:[Math.random()*100+"%",Math.random()*100+"%",Math.random()*100+"%"],y:[Math.random()*100+"%",Math.random()*100+"%",Math.random()*100+"%"],scale:[0,1,0],opacity:[0,.6,0]},transition:{duration:2+Math.random()*2,repeat:1/0,delay:Math.random()*2,ease:"easeInOut"}},`home-particle-${k}`))}),u.jsx(AV,{className:"w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform"}),u.jsx("span",{className:"font-bold drop-shadow-[0_1px_1px_rgba(0,0,0,0.3)]",children:"Back to Home"}),u.jsx("div",{className:"absolute inset-0 rounded-lg overflow-hidden",children:u.jsx(X.div,{className:"absolute inset-0 opacity-30",style:{background:"linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent)",backgroundSize:"200% 200%"},animate:{backgroundPosition:["0% 0%","100% 100%","0% 0%"]},transition:{duration:2.5,repeat:1/0,ease:"linear"}})})]})})})]})}const Xl=({expression:t,size:e="medium",message:n="",showMessage:s=!1})=>{const r=()=>({happy:"/images/shifuhappy_ct.png",neutral:"/images/shifu_coacht.png",encouraging:"/images/shifuhappy_ct.png",celebrating:"/images/shifuhappy_ct.png",thinking:"/images/shifu_coacht.png"})[t],i={small:"w-8 h-8",medium:"w-12 h-12",large:"w-16 h-16"},o={happy:{y:[0,-3,0]},neutral:{},encouraging:{rotate:[0,5,-5,0]},celebrating:{scale:[1,1.1,1],rotate:[0,10,-10,0]},thinking:{y:[0,-2,0]}};return u.jsxs("div",{className:"relative",children:[u.jsx(X.div,{animate:o[t],transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:`${i[e]} relative`,children:u.jsx("img",{src:r(),alt:`Shifu ${t}`,className:`${i[e]} object-contain rounded-lg shadow-lg`,style:{imageRendering:"pixelated"}})}),s&&n&&u.jsxs(X.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 bg-white rounded-lg shadow-lg p-2 text-xs text-gray-800 whitespace-nowrap",children:[n,u.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-4 border-t-white border-l-transparent border-r-transparent border-b-transparent"})]})]})};function _Ge(){const[t,e]=b.useState("week"),[n,s]=b.useState(!1),{data:r=[],isLoading:i}=sm({queryKey:["/api/shifu/logs",t],queryFn:()=>aa("GET",`/api/shifu/logs?period=${t}`).then(d=>d.json()),refetchOnWindowFocus:!1}),o=zt.useMemo(()=>{if(!r.length)return{completionRate:0,averageAccuracy:0,currentStreak:0,sessionsStarted:0};const d=r.filter(m=>m.completed).length,h=r.filter(m=>m.sessionStarted).length,f=r.filter(m=>m.actualAccuracy!==null).map(m=>m.actualAccuracy);let p=0;for(let m=r.length-1;m>=0&&r[m].completed;m--)p++;return{completionRate:r.length?Math.round(d/r.length*100):0,averageAccuracy:f.length?Math.round(f.reduce((m,g)=>m+g,0)/f.length):0,currentStreak:p,sessionsStarted:h}},[r]);b.useEffect(()=>{if(o.completionRate>0){const d=setTimeout(()=>s(!0),2e3);return()=>clearTimeout(d)}},[o]);const a=()=>o.completionRate>=80?"Outstanding dedication! You're becoming a true martial artist! 🥋":o.completionRate>=60?"Good progress! Keep up the consistent training! 💪":o.completionRate>=40?"You're improving! Remember, consistency is key in martial arts! 🎯":"Every master was once a beginner. Keep practicing! 🌱",l=()=>o.completionRate>=80?"celebrating":o.completionRate>=60?"happy":o.completionRate>=40?"encouraging":"thinking",c=zt.useMemo(()=>{const d=new Date,h=[];for(let f=6;f>=0;f--){const p=new Date(d);p.setDate(p.getDate()-f);const m=p.toISOString().split("T")[0],g=r.filter(y=>y.date.startsWith(m)&&y.actualAccuracy!==null),x=g.length?g.reduce((y,v)=>y+(v.actualAccuracy||0),0)/g.length:0;h.push({day:p.toLocaleDateString("en",{weekday:"short"}),accuracy:Math.round(x),date:m})}return h},[r]);return i?u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[u.jsx("div",{className:"w-12 h-12 bg-red-400/20 rounded-full animate-pulse"}),u.jsxs("div",{children:[u.jsx("div",{className:"h-6 bg-red-400/20 rounded w-32 mb-2 animate-pulse"}),u.jsx("div",{className:"h-4 bg-red-400/20 rounded w-48 animate-pulse"})]})]}),[1,2,3].map(d=>u.jsx(Ks,{className:"bg-gradient-to-br from-red-900/20 to-red-950/10 border-red-600/20 animate-pulse",children:u.jsxs(rr,{className:"p-6",children:[u.jsx("div",{className:"h-4 bg-red-400/20 rounded w-3/4 mb-2"}),u.jsx("div",{className:"h-8 bg-red-400/20 rounded"})]})},d))]}):u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(Xl,{expression:l(),size:"large",message:n?a():"",showMessage:n}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Shifu's Training Log"}),u.jsx("p",{className:"text-red-200 opacity-80",children:"Track your martial arts journey"})]})]}),u.jsx("div",{className:"flex space-x-2",children:["week","month","all"].map(d=>u.jsx("button",{onClick:()=>e(d),className:`px-3 py-1 text-sm rounded-full transition-colors ${t===d?"bg-red-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:d.charAt(0).toUpperCase()+d.slice(1)},d))})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[u.jsx(Ks,{className:"bg-gradient-to-br from-green-900/30 to-green-950/20 border-green-600/30",children:u.jsx(rr,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-green-200 text-sm",children:"Completion Rate"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs("p",{className:"text-2xl font-bold text-green-400",children:[o.completionRate,"%"]}),u.jsx(Xl,{expression:"happy",size:"small"})]})]}),u.jsx(jV,{className:"h-8 w-8 text-green-500"})]})})}),u.jsx(Ks,{className:"bg-gradient-to-br from-blue-900/30 to-blue-950/20 border-blue-600/30",children:u.jsx(rr,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-blue-200 text-sm",children:"Average Accuracy"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:[o.averageAccuracy,"%"]}),u.jsx(Xl,{expression:"encouraging",size:"small"})]})]}),u.jsx(ea,{className:"h-8 w-8 text-blue-500"})]})})}),u.jsx(Ks,{className:"bg-gradient-to-br from-orange-900/30 to-orange-950/20 border-orange-600/30",children:u.jsx(rr,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-orange-200 text-sm",children:"Current Streak"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("p",{className:"text-2xl font-bold text-orange-400",children:o.currentStreak}),u.jsx(Xl,{expression:"celebrating",size:"small"})]})]}),u.jsx(OV,{className:"h-8 w-8 text-orange-500"})]})})}),u.jsx(Ks,{className:"bg-gradient-to-br from-purple-900/30 to-purple-950/20 border-purple-600/30",children:u.jsx(rr,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-purple-200 text-sm",children:"Sessions Started"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("p",{className:"text-2xl font-bold text-purple-400",children:o.sessionsStarted}),u.jsx(Xl,{expression:"neutral",size:"small"})]})]}),u.jsx(Mh,{className:"h-8 w-8 text-purple-500"})]})})})]}),u.jsxs(Ks,{className:"bg-gradient-to-br from-red-900/20 to-red-950/10 border-red-600/20",children:[u.jsx(No,{children:u.jsxs(To,{className:"text-white flex items-center space-x-2",children:[u.jsx(VV,{className:"h-5 w-5 text-red-400"}),u.jsx("span",{children:"Weekly Accuracy Trends"}),u.jsx(Xl,{expression:"thinking",size:"small"})]})}),u.jsx(rr,{children:u.jsx("div",{className:"h-64 flex items-end justify-between space-x-2",children:c.map((d,h)=>u.jsxs(X.div,{initial:{height:0},animate:{height:`${d.accuracy/100*200}px`},transition:{delay:h*.1,duration:.5},className:"flex-1 bg-gradient-to-t from-red-600 to-red-400 rounded-t-lg min-h-[20px] relative group",style:{height:`${Math.max(d.accuracy/100*200,20)}px`},children:[u.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:[d.accuracy,"%"]}),u.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-gray-400 text-xs",children:d.day})]},d.date))})})]}),u.jsxs(Ks,{className:"bg-gradient-to-br from-red-900/20 to-red-950/10 border-red-600/20",children:[u.jsx(No,{children:u.jsxs(To,{className:"text-white flex items-center space-x-2",children:[u.jsx(Cx,{className:"h-5 w-5 text-red-400"}),u.jsx("span",{children:"Recent Training Goals"}),u.jsx(Xl,{expression:"neutral",size:"small"})]})}),u.jsx(rr,{children:r.length>0?u.jsx("div",{className:"space-y-3",children:r.slice(0,10).map((d,h)=>u.jsxs(X.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:h*.05},className:`flex items-center justify-between p-3 rounded-lg border ${d.completed?"bg-green-900/20 border-green-600/30":d.sessionStarted?"bg-yellow-900/20 border-yellow-600/30":"bg-gray-900/20 border-gray-600/30"}`,children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx(Xl,{expression:d.completed?"happy":d.sessionStarted?"encouraging":"neutral",size:"small"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-white font-medium",children:d.dailyGoal}),u.jsx("p",{className:"text-gray-400 text-sm",children:new Date(d.date).toLocaleDateString()})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[d.actualAccuracy!==null&&u.jsxs("span",{className:`text-sm px-2 py-1 rounded ${d.actualAccuracy>=80?"bg-green-600/20 text-green-400":d.actualAccuracy>=60?"bg-yellow-600/20 text-yellow-400":"bg-red-600/20 text-red-400"}`,children:[d.actualAccuracy,"%"]}),u.jsx("div",{className:`w-3 h-3 rounded-full ${d.completed?"bg-green-500":d.sessionStarted?"bg-yellow-500":"bg-gray-500"}`})]})]},d.id))}):u.jsxs("div",{className:"text-center py-8",children:[u.jsx(Xl,{expression:"thinking",size:"large"}),u.jsx("p",{className:"text-gray-400 mt-4",children:"No training history yet"}),u.jsx("p",{className:"text-gray-500 text-sm",children:"Complete your first daily goal to see it here!"})]})})]})]})}const EGe={totalSessions:0,totalHours:0,averageSessionLength:0,longestStreak:0,currentStreak:0,lastSession:null,createdAt:new Date().toISOString(),activityData:[],beltHistory:[{belt:"white",achievedAt:new Date().toISOString()}],galleryImages:[]},$Ge=(t,e="year")=>{const n=[...t].sort((o,a)=>o.date.getTime()-a.date.getTime()),s=new Date;let r=n;if(e==="week"){const o=new Date;o.setDate(s.getDate()-7),r=n.filter(a=>new Date(a.date)>=o)}else if(e==="month"){const o=new Date;o.setMonth(s.getMonth()-1),r=n.filter(a=>new Date(a.date)>=o)}else{const o=new Date;o.setFullYear(s.getFullYear()-1),r=n.filter(a=>new Date(a.date)>=o)}const i=[];if(e==="week"){const o=[];for(let a=0;a<7;a++){const l=new Date;l.setDate(l.getDate()-6+a),l.setHours(0,0,0,0);const c=r.find(d=>{const h=new Date(d.date);return h.setHours(0,0,0,0),h.getTime()===l.getTime()});o.push(c||{date:l,level:0,minutes:0})}i.push(o)}else{const o=e==="month"?new Date(s.getFullYear(),s.getMonth()-1,s.getDate()):new Date(s.getFullYear()-1,s.getMonth(),s.getDate()),a=e==="month"?31:365,l=7,c=new Map;r.forEach(f=>{const p=new Date(f.date);p.setHours(0,0,0,0),c.set(p.getTime(),f)});const d=Math.min(a,Math.ceil((s.getTime()-o.getTime())/(1e3*60*60*24))),h=Math.ceil(d/l);for(let f=0;f<h;f++){const p=[];for(let m=0;m<l;m++){const g=f*l+m;if(g<d){const x=new Date(s);x.setDate(s.getDate()-d+g),x.setHours(0,0,0,0);const y=c.get(x.getTime());p.push(y||{date:x,level:0,minutes:0})}else p.push(null)}i.push(p)}}return i},IGe=t=>{const e=new Date;if(t==="week")return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];if(t==="month"){const n=new Date(e);n.setMonth(e.getMonth()-1);const s=new Date(n),r=new Date(n);r.setDate(r.getDate()+7);const i=new Date(n);i.setDate(i.getDate()+14);const o=new Date(n);return o.setDate(o.getDate()+21),[`${s.getMonth()+1}/${s.getDate()}`,`${r.getMonth()+1}/${r.getDate()}`,`${i.getMonth()+1}/${i.getDate()}`,`${o.getMonth()+1}/${o.getDate()}`,`${e.getMonth()+1}/${e.getDate()}`]}else{const n=[],s=e.getMonth();for(let r=0;r<12;r++){const i=(s-11+r+12)%12;n.push(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i])}return n}},G4=[{value:"white",label:"White Belt",level:1},{value:"yellow",label:"Yellow Belt",level:1},{value:"yellow",label:"Yellow Belt",level:2},{value:"green",label:"Green Belt",level:1},{value:"green",label:"Green Belt",level:2},{value:"blue",label:"Blue Belt",level:1},{value:"blue",label:"Blue Belt",level:2},{value:"red",label:"Red Belt",level:1},{value:"red",label:"Red Belt",level:2},{value:"black",label:"Black Belt",level:1}];function RGe(){var xe,Ce,De,fe,ee,Pe,Re,ce,me;const{user:t}=nf(),e=Yw(),[n,s]=b.useState(!1),[r,i]=b.useState((t==null?void 0:t.username)||""),[o,a]=b.useState("white"),[l,c]=b.useState("White Belt"),[d,h]=b.useState(1),[f,p]=b.useState("year"),[m,g]=b.useState(!1),[x,y]=b.useState([]),[v,S]=b.useState([]),[C,k]=b.useState(!1),{data:T=EGe,isLoading:_}=sm({queryKey:["userStats"],queryFn:async()=>{const ie=await aa("GET","/api/user-stats");if(ie instanceof Response){const Q=await ie.json();return Q.activityData&&(Q.activityData=Q.activityData.map(oe=>({...oe,date:new Date(oe.date)}))),Q}return ie}}),$=za({mutationFn:async ie=>{const Q=await aa("POST","/api/gallery",{imageUrl:ie});return Q instanceof Response?await Q.json():Q},onSuccess:()=>{e.invalidateQueries({queryKey:["userStats"]})}}),R=za({mutationFn:async ie=>{const Q=await aa("DELETE","/api/gallery",{imageUrl:ie});return Q instanceof Response?await Q.json():Q},onSuccess:()=>{e.invalidateQueries({queryKey:["userStats"]})}}),A=$Ge(Array.isArray(T.activityData)?T.activityData:[],f),j=IGe(f),F=()=>{console.log("Username updated to:",r),s(!1)},L=ie=>{const[Q,oe]=ie.split("-"),ae=G4.find(Be=>Be.value===Q&&Be.level===parseInt(oe));a(Q),h(parseInt(oe)),c((ae==null?void 0:ae.label)||"");const Ae={color:Q,name:(ae==null?void 0:ae.label)||"",level:parseInt(oe)};localStorage.setItem("userBelt",JSON.stringify(Ae))},M=ie=>new Date(ie).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),q=ie=>{switch(ie){case 0:return"bg-gray-800";case 1:return"bg-red-900";case 2:return"bg-red-700";case 3:return"bg-red-600";case 4:return"bg-red-500";default:return"bg-gray-800"}},z=ie=>{var Xe,lt;if(!((Xe=ie.target.files)!=null&&Xe.length))return;const oe=Array.from(ie.target.files).filter(Me=>Me.type.startsWith("image/")),ae=((lt=T.galleryImages)==null?void 0:lt.length)||0,Ae=Math.max(0,10-ae),Be=oe.slice(0,Ae);y(Me=>[...Me,...Be]),Be.forEach(Me=>{const je=new FileReader;je.onload=Ze=>{var Ye;typeof((Ye=Ze.target)==null?void 0:Ye.result)=="string"&&S(Ie=>{var B;return[...Ie,(B=Ze.target)==null?void 0:B.result]})},je.readAsDataURL(Me)})},re=ie=>{y(Q=>Q.filter((oe,ae)=>ae!==ie)),S(Q=>Q.filter((oe,ae)=>ae!==ie))},U=async()=>{if(x.length){k(!0);try{for(let ie=0;ie<v.length;ie++)await $.mutateAsync(v[ie]);y([]),S([]),g(!1)}catch(ie){console.error("Error uploading images:",ie)}finally{k(!1)}}},G=async ie=>{try{await R.mutateAsync(ie)}catch(Q){console.error("Error deleting image:",Q)}};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black to-red-950/30",children:[u.jsxs("main",{className:"container mx-auto px-4 py-8",children:[u.jsx(jn,{href:"/",children:u.jsxs(Se,{variant:"ghost",className:"mb-8 -ml-2 text-white",children:[u.jsx(AV,{className:"h-4 w-4 mr-1"}),"Back to Home"]})}),_?u.jsx("div",{className:"flex justify-center items-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"})}):u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[u.jsx("div",{className:"hidden md:block",children:u.jsx("div",{className:"grid grid-cols-1 gap-4",children:(xe=T.galleryImages)==null?void 0:xe.slice(0,Math.ceil((T.galleryImages.length||0)/2)).map((ie,Q)=>u.jsxs(X.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:Q*.1},className:"relative group rounded-lg overflow-hidden border-2 border-red-900/30 shadow-lg h-40",children:[u.jsx("img",{src:ie,alt:`Training photo ${Q+1}`,className:"w-full h-full object-cover"}),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:u.jsx(Se,{variant:"destructive",size:"icon",className:"h-8 w-8",onClick:()=>G(ie),children:u.jsx(yu,{className:"h-4 w-4"})})})]},`left-${Q}`))})}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col items-center justify-center mb-12 text-center",children:[u.jsx("div",{className:"h-32 w-32 rounded-full bg-gradient-to-br from-red-700 to-red-900 flex items-center justify-center mb-6 border-4 border-red-600/30 shadow-lg shadow-red-900/20",children:u.jsx(Ru,{className:"h-16 w-16 text-white"})}),u.jsx("div",{className:"mb-6",children:n?u.jsxs("div",{className:"flex items-center",children:[u.jsx(ar,{type:"text",value:r,onChange:ie=>i(ie.target.value),className:"bg-red-950/30 border-red-900/50 text-white text-center"}),u.jsx(Se,{variant:"ghost",size:"icon",onClick:F,className:"text-white hover:bg-red-900/20",children:u.jsx(LV,{className:"h-4 w-4"})})]}):u.jsxs("div",{className:"flex items-center",children:[u.jsx("h1",{className:"text-3xl font-bold text-white mr-2",children:r}),u.jsx(Se,{variant:"ghost",size:"icon",onClick:()=>s(!0),className:"text-white hover:bg-red-900/20",children:u.jsx(Sk,{className:"h-4 w-4"})})]})}),u.jsx("div",{className:"w-full max-w-3xl",children:u.jsx(pK,{beltColor:o,beltName:l,beltLevel:d,showLevel:!0,stretched:!0,username:r})}),u.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 mt-2",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-sm text-gray-400",children:"Current belt:"}),u.jsxs(Iw,{value:`${o}-${d}`,onValueChange:L,children:[u.jsx(lx,{className:"w-40 bg-red-950/30 border-red-900/50",children:u.jsx(Rw,{placeholder:"Select Belt"})}),u.jsx(cx,{className:"bg-black border border-red-900/50",children:G4.map(ie=>u.jsxs(ur,{value:`${ie.value}-${ie.level}`,className:"text-white hover:bg-red-900/20",children:[ie.label," ",ie.level>1?`(Level ${ie.level})`:""]},`${ie.value}-${ie.level}`))})]})]}),u.jsxs(Se,{onClick:()=>g(!0),variant:"outline",className:"bg-red-950/30 border-red-900/50 text-white hover:bg-red-900/40",children:[u.jsx(Fm,{className:"h-4 w-4 mr-2"}),"Customize Profile"]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10",children:[u.jsx(ov,{icon:u.jsx(Mh,{className:"h-5 w-5 text-red-400"}),title:"Training Time",value:`${T.totalHours} hours`,description:"Total time spent training"}),u.jsx(ov,{icon:u.jsx(Cx,{className:"h-5 w-5 text-red-400"}),title:"Sessions",value:T.totalSessions.toString(),description:`Avg. ${T.averageSessionLength} mins per session`}),u.jsx(ov,{icon:u.jsx(kv,{className:"h-5 w-5 text-red-400"}),title:"Current Streak",value:`${T.currentStreak} days`,description:`Longest: ${T.longestStreak} days`}),u.jsx(ov,{icon:u.jsx(jg,{className:"h-5 w-5 text-red-400"}),title:"Member Since",value:M(T.createdAt),description:`${Math.floor((Date.now()-new Date(T.createdAt).getTime())/(1e3*60*60*24*30))} months`})]}),u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},className:"mb-10",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Nv,{className:"h-5 w-5 text-red-500 mr-2"}),u.jsx("h2",{className:"text-xl font-bold text-white",children:"Training Activity"})]}),u.jsx(n3,{defaultValue:"year",value:f,onValueChange:p,className:"w-[300px]",children:u.jsxs(Q1,{className:"bg-red-950/30",children:[u.jsx(Fu,{value:"week",className:"data-[state=active]:bg-red-800",children:"Week"}),u.jsx(Fu,{value:"month",className:"data-[state=active]:bg-red-800",children:"Month"}),u.jsx(Fu,{value:"year",className:"data-[state=active]:bg-red-800",children:"Year"})]})})]}),u.jsxs("div",{className:"bg-gradient-to-b from-gray-900 to-black rounded-xl border border-red-900/30 p-6 shadow-lg overflow-x-auto",children:[u.jsxs("div",{className:"min-w-[720px] max-w-full",children:[u.jsx("div",{className:"flex mb-2 pl-10",children:j.map((ie,Q)=>u.jsx("div",{className:"flex-1 text-center text-xs text-gray-400",children:ie},Q))}),u.jsxs("div",{className:"flex",children:[u.jsx("div",{className:"flex flex-col pr-2 text-xs text-gray-400",children:f==="week"?u.jsx("div",{className:"h-5 mt-1",children:"Activity"}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"h-5 mt-1",children:"Mon"}),u.jsx("div",{className:"h-5 mt-1",children:"Wed"}),u.jsx("div",{className:"h-5 mt-1"}),u.jsx("div",{className:"h-5 mt-1",children:"Fri"}),u.jsx("div",{className:"h-5 mt-1"})]})}),u.jsx("div",{className:"flex-1 flex",children:A.map((ie,Q)=>u.jsx("div",{className:`flex-1 flex ${f==="week"?"flex-row":"flex-col"} mr-1`,children:ie.map((oe,ae)=>u.jsx("div",{className:`${f==="week"?"h-10 w-full flex items-center justify-center flex-col":"h-5 w-5"} rounded-sm m-px ${oe?q(oe.level):"bg-gray-800/30"}`,title:oe?`${oe.date.toLocaleDateString()}: ${oe.minutes} minutes`:"No training",children:f==="week"&&oe&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"text-xs text-white",children:[oe.minutes,"m"]}),u.jsx("div",{className:"text-[10px] text-gray-400",children:oe.date.toLocaleDateString("en-US",{weekday:"short"})})]})},ae))},Q))})]})]}),u.jsxs("div",{className:"flex items-center justify-end mt-4 space-x-2 text-sm",children:[u.jsx("span",{className:"text-gray-400",children:"Less"}),u.jsx("div",{className:"h-4 w-4 rounded-sm bg-gray-800"}),u.jsx("div",{className:"h-4 w-4 rounded-sm bg-red-900"}),u.jsx("div",{className:"h-4 w-4 rounded-sm bg-red-700"}),u.jsx("div",{className:"h-4 w-4 rounded-sm bg-red-600"}),u.jsx("div",{className:"h-4 w-4 rounded-sm bg-red-500"}),u.jsx("span",{className:"text-gray-400",children:"More"})]})]})]}),u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsx(jg,{className:"h-5 w-5 text-red-500 mr-2"}),u.jsx("h2",{className:"text-xl font-bold text-white",children:"Belt Progression"})]}),u.jsx("div",{className:"bg-gradient-to-b from-gray-900 to-black rounded-xl border border-red-900/30 p-6 shadow-lg",children:u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute top-0 bottom-0 left-[15px] w-0.5 bg-red-900/70"}),T.beltHistory.map((ie,Q)=>u.jsxs("div",{className:"relative pl-10 pb-8",children:[u.jsx("div",{className:`absolute left-0 top-1 w-8 h-8 flex items-center justify-center rounded-full bg-${ie.belt}-600 ${ie.belt==="black"?"border-2 border-white/70":""} shadow-md`,children:u.jsx(jg,{className:"h-4 w-4 text-white"})}),u.jsxs("div",{children:[u.jsxs("h3",{className:"text-lg font-medium text-white",children:[ie.belt.charAt(0).toUpperCase()+ie.belt.slice(1)," Belt"]}),u.jsxs("p",{className:"text-gray-400",children:["Achieved on ",M(ie.achievedAt)]})]})]},Q))]})})]}),u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.5},className:"mb-10",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsx(N_,{className:"h-5 w-5 text-red-500 mr-2"}),u.jsx("h2",{className:"text-xl font-bold text-white",children:"Shifu AI Coach"})]}),u.jsx(_Ge,{})]})]}),u.jsx("div",{className:"hidden md:block",children:u.jsx("div",{className:"grid grid-cols-1 gap-4",children:(De=T.galleryImages)==null?void 0:De.slice(Math.ceil((((Ce=T.galleryImages)==null?void 0:Ce.length)||0)/2)).map((ie,Q)=>{var oe;return u.jsxs(X.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:Q*.1},className:"relative group rounded-lg overflow-hidden border-2 border-red-900/30 shadow-lg h-40",children:[u.jsx("img",{src:ie,alt:`Training photo ${Q+Math.ceil((((oe=T.galleryImages)==null?void 0:oe.length)||0)/2)+1}`,className:"w-full h-full object-cover"}),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:u.jsx(Se,{variant:"destructive",size:"icon",className:"h-8 w-8",onClick:()=>G(ie),children:u.jsx(yu,{className:"h-4 w-4"})})})]},`right-${Q}`)})})}),u.jsxs("div",{className:"md:hidden mt-8",children:[u.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center",children:[u.jsx(Fm,{className:"mr-2 h-5 w-5 text-red-500"}),"Photo Gallery"]}),u.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[(fe=T.galleryImages)==null?void 0:fe.map((ie,Q)=>u.jsxs(X.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:Q*.05},className:"relative group rounded-lg overflow-hidden border-2 border-red-900/30 shadow-lg aspect-square",children:[u.jsx("img",{src:ie,alt:`Training photo ${Q+1}`,className:"w-full h-full object-cover"}),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:u.jsx(Se,{variant:"destructive",size:"icon",className:"h-8 w-8",onClick:()=>G(ie),children:u.jsx(yu,{className:"h-4 w-4"})})})]},`mobile-${Q}`)),(!T.galleryImages||T.galleryImages.length===0)&&u.jsxs("div",{className:"col-span-full text-center py-10 bg-red-950/10 rounded-lg border border-red-900/30",children:[u.jsx(Fm,{className:"h-10 w-10 text-red-500/50 mx-auto mb-2"}),u.jsx("p",{className:"text-gray-400",children:"No photos added yet"}),u.jsxs(Se,{onClick:()=>g(!0),variant:"outline",size:"sm",className:"mt-4 bg-red-950/30 border-red-900/50 text-white hover:bg-red-900/40",children:[u.jsx(Fm,{className:"h-4 w-4 mr-2"}),"Add Photos"]})]})]})]})]})]}),u.jsx(zi,{open:m,onOpenChange:g,children:u.jsxs(pi,{className:"bg-black border border-red-900/50 text-white sm:max-w-[600px]",children:[u.jsxs(mi,{children:[u.jsxs(gi,{className:"text-xl flex items-center",children:[u.jsx(Fm,{className:"mr-2 h-5 w-5 text-red-500"}),"Customize Profile"]}),u.jsx(yo,{className:"text-gray-400",children:"Upload photos to display in your profile gallery (maximum 10 photos)"})]}),u.jsxs("div",{className:"mt-4 space-y-4",children:[u.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-red-950/20 rounded-lg border border-red-900/30",children:[u.jsxs("span",{className:"text-sm text-gray-300",children:[((ee=T.galleryImages)==null?void 0:ee.length)||0," of 10 photos used"]}),u.jsxs("span",{className:"text-xs text-gray-400",children:[10-(((Pe=T.galleryImages)==null?void 0:Pe.length)||0)," slots available"]})]}),(((Re=T.galleryImages)==null?void 0:Re.length)||0)<10&&u.jsxs("div",{className:"border-2 border-dashed border-red-900/40 rounded-lg p-4 flex flex-col items-center",children:[u.jsx(C_,{className:"h-10 w-10 text-red-500/70 mb-2"}),u.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Upload your photos"}),u.jsx(ar,{type:"file",accept:"image/*",multiple:!0,className:"bg-red-950/20 border-red-900/40 text-white",onChange:z,disabled:C})]}),v.length>0&&u.jsxs("div",{className:"mt-4",children:[u.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Preview:"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:v.map((ie,Q)=>u.jsxs("div",{className:"relative group",children:[u.jsx("img",{src:ie,alt:`Preview ${Q+1}`,className:"w-full h-24 object-cover rounded-md border border-red-900/40"}),u.jsx("button",{className:"absolute top-1 right-1 p-1 bg-black/70 rounded-full hover:bg-red-900/80",onClick:()=>re(Q),children:u.jsx(Lh,{className:"h-3 w-3 text-white"})})]},Q))})]}),(((ce=T.galleryImages)==null?void 0:ce.length)||0)>0&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Current Photos:"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-60 overflow-y-auto pr-2",children:(me=T.galleryImages)==null?void 0:me.map((ie,Q)=>u.jsxs("div",{className:"relative group",children:[u.jsx("img",{src:ie,alt:`Gallery image ${Q+1}`,className:"w-full h-24 object-cover rounded-md border border-red-900/40"}),u.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:u.jsx(Se,{variant:"destructive",size:"icon",className:"h-6 w-6",onClick:()=>G(ie),children:u.jsx(yu,{className:"h-3 w-3"})})})]},Q))})]})]}),u.jsxs(xo,{className:"flex flex-col sm:flex-row gap-2 sm:justify-between",children:[u.jsx(Se,{variant:"ghost",className:"text-gray-400 hover:text-white hover:bg-red-950/30",onClick:()=>{y([]),S([]),g(!1)},children:"Cancel"}),u.jsx(Se,{className:"bg-red-700 hover:bg-red-800 text-white",onClick:U,disabled:v.length===0||C,children:C?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-white/50 border-t-white rounded-full mr-2"}),"Uploading..."]}):u.jsx(u.Fragment,{children:"Upload Photos"})})]})]})})]})}function ov({icon:t,title:e,value:n,description:s}){return u.jsxs(Ks,{className:"bg-red-950/20 border-red-900/30",children:[u.jsx(No,{className:"pb-2",children:u.jsxs("div",{className:"flex justify-between items-start",children:[t,u.jsx(To,{className:"text-xl",children:n})]})}),u.jsxs(rr,{children:[u.jsx(Ua,{className:"text-gray-400",children:e}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s})]})]})}function so({path:t,component:e}){const{user:n,isLoading:s}=nf();return s?u.jsx(ro,{path:t,children:u.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black",children:[u.jsxs("div",{className:"relative mb-2",children:[u.jsx(yb,{className:"h-12 w-12 md:h-16 md:w-16 animate-spin text-red-600"}),u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsx("span",{className:"text-xs font-bold text-white",children:"T"})})]}),u.jsx("div",{className:"flex items-center",children:u.jsx("span",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-red-500 to-red-300 bg-clip-text text-transparent",children:"CoachT"})})]})}):n?u.jsx(ro,{path:t,children:u.jsx(e,{})}):u.jsx(ro,{path:t,children:u.jsx(PZ,{to:"/auth"})})}const iX="/assets/image_1750188086936-BG6UMu1V.png",oX="/assets/image_1750188117761-B9Zg7w2g.png",aX="/assets/image_1750188231521-Dlw8qcyA.png",PGe="/assets/image_1750189369561-BqewrgA8.png";function AGe(){const{scrollYProgress:t}=FP(),e=ja(t,[0,.3],[1,0]),n=ja(t,[0,.3],[1,.8]);return u.jsxs("div",{className:"min-h-screen bg-black text-white overflow-x-hidden",children:[u.jsx(X.div,{className:"w-full py-3 px-6 flex justify-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.8},children:u.jsx("img",{src:PGe,alt:"CoachT",className:"h-8 md:h-10"})}),u.jsxs(X.section,{className:"relative min-h-screen flex items-center justify-center px-6",style:{opacity:e,scale:n},children:[u.jsx("div",{className:"absolute inset-0",children:u.jsx(X.div,{className:"absolute top-1/3 left-1/4 w-96 h-96 bg-red-600/5 rounded-full blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}})}),u.jsx("div",{className:"relative z-10 text-center max-w-4xl mx-auto",children:u.jsxs(X.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:2},children:[u.jsx(X.h1,{className:"text-4xl md:text-6xl font-bold mb-6 leading-tight",initial:{opacity:0,y:100},animate:{opacity:1,y:0},transition:{duration:1.2,delay:.3},children:"Master Every Move"}),u.jsx(X.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:1,delay:.8},className:"mb-8",children:u.jsx("span",{className:"text-xl md:text-2xl bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent font-medium",children:"Experience Precision Perfection"})}),u.jsx(X.p,{className:"text-lg text-gray-400 mb-10 max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{duration:1,delay:1.2},children:"Your personal AI coach that meticulously checks every detail and pushes you towards flawless execution."}),u.jsxs(X.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.8,delay:1.6},className:"flex flex-col sm:flex-row gap-6 justify-center items-center",children:[u.jsx(jn,{href:"/auth",children:u.jsxs(Se,{size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-2xl shadow-red-500/25 px-12 py-6 text-xl font-semibold group transform hover:scale-105 transition-all duration-300",children:["Start Now",u.jsx(lo,{className:"ml-3 w-6 h-6 group-hover:translate-x-1 transition-transform"})]})}),u.jsxs(Se,{variant:"ghost",size:"lg",className:"text-gray-300 hover:text-white px-8 py-6 text-lg group",children:[u.jsx(Mf,{className:"mr-3 w-5 h-5 group-hover:scale-110 transition-transform"}),"Watch Demo"]})]})]})})]}),u.jsx(X.section,{className:"py-32 px-6",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1.5},viewport:{once:!0,margin:"-100px"},children:u.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[u.jsx(X.h2,{className:"text-3xl md:text-4xl font-bold mb-6",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:1},viewport:{once:!0},children:"Revolutionary AI Training"}),u.jsx(X.p,{className:"text-lg text-gray-300 leading-relaxed max-w-3xl mx-auto",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:1,delay:.3},viewport:{once:!0},children:"CoachT uses cutting-edge AI to provide instant, intelligent feedback, helping you fix mistakes in real-time and unlock your full potential."})]})}),u.jsx("section",{className:"py-20 px-6",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsx(X.h2,{className:"text-3xl md:text-4xl font-bold text-center mb-16",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},children:"How CoachT Empowers Your Training"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.1},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-orange-600/50 transition-all duration-300",children:[u.jsx("img",{src:iX,alt:"Challenge Arena",className:"w-full rounded-xl shadow-lg shadow-orange-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-orange-300 transition-colors",children:"Dynamic Challenges"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Push your limits, dominate leaderboards, and prove your skills in thrilling, gamified challenges."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white w-full group",children:["Try Challenges",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-blue-600/50 transition-all duration-300",children:[u.jsx("img",{src:oX,alt:"Training Interface",className:"w-full rounded-xl shadow-lg shadow-blue-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-blue-300 transition-colors",children:"Start Live Routine"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Compare your live performance against expert demonstrations with precise AI insights."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white w-full group",children:["Start Training",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.3},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-purple-600/50 transition-all duration-300",children:[u.jsx("img",{src:aX,alt:"Practice Library",className:"w-full rounded-xl shadow-lg shadow-purple-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-purple-300 transition-colors",children:"Practice Library"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Advanced pose detection analyzes your every move with precise visual cues and AI guidance."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white w-full group",children:["Explore Library",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.4},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-green-600/50 transition-all duration-300",children:[u.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-green-900/20 to-green-700/20 rounded-xl border border-gray-700 mb-6 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(gh,{className:"w-12 h-12 text-green-400 mx-auto mb-4"}),u.jsx("p",{className:"text-green-300 font-medium",children:"Real-time AI Analysis"})]})}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-green-300 transition-colors",children:"Real-time AI Feedback"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Get instant corrections and intelligent voice guidance from your personal AI master."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white w-full group",children:["Try AI Feedback",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})})]})]})}),u.jsx(X.section,{className:"py-32 px-6",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1.5},viewport:{once:!0,margin:"-100px"},children:u.jsx("div",{className:"max-w-4xl mx-auto text-center",children:u.jsxs(X.div,{initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:1},viewport:{once:!0},children:[u.jsx(X.div,{className:"mb-8",initial:{scale:0},whileInView:{scale:1},transition:{duration:.8,delay:.2},viewport:{once:!0},children:u.jsx(gh,{className:"w-16 h-16 text-red-500 mx-auto mb-6"})}),u.jsxs("h2",{className:"text-4xl md:text-6xl font-bold mb-8 leading-tight",children:["Ready to achieve"," ",u.jsx("span",{className:"bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent",children:"mastery?"})]}),u.jsx(X.p,{className:"text-2xl font-bold text-white mb-12",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8,delay:.4},viewport:{once:!0},children:"Start Your FREE Journey with CoachT Today"}),u.jsx(X.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.6},viewport:{once:!0},children:u.jsx(jn,{href:"/auth",children:u.jsxs(Se,{size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-2xl shadow-red-500/30 px-16 py-8 text-2xl font-bold group transform hover:scale-105 transition-all duration-500",children:["Start Now",u.jsx(lo,{className:"ml-3 w-8 h-8 group-hover:translate-x-2 transition-transform duration-300"})]})})}),u.jsx(X.p,{className:"text-gray-400 mt-8 text-lg",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8,delay:.8},viewport:{once:!0},children:"No credit card required • Instant access"})]})})}),u.jsx("footer",{className:"py-8 px-6 border-t border-gray-900",children:u.jsx("div",{className:"max-w-6xl mx-auto text-center",children:u.jsx("p",{className:"text-gray-500 text-sm",children:"© 2025 CoachT. Revolutionizing martial arts training with AI."})})})]})}const jGe="/assets/image_1750270990042-BdIUl81F.png";function DGe(){return u.jsx("div",{className:"w-32 h-32 md:w-48 md:h-48",children:u.jsx("img",{src:jGe,alt:"CoachT Kicking Logo",className:"w-full h-full object-contain"})})}const OGe=["AI Coach","Taekwondo","Karate","Muay Thai","Black Belt","Precision","Stronger","Form","Technique","Master","Training","Power","Speed","Focus","Discipline","Excellence"],K4=["Form Perfection","Power Unleashed","Speed Mastery","Technique Refined","Precision Training","Elite Performance"];function FGe(){const{scrollY:t}=FP(),[e,n]=b.useState(0),[s,r]=b.useState(!0),[i,o]=b.useState(!1),a=ja(t,[0,1200],[1,30]),l=ja(t,[0,600,1200],[1,.8,0]),c=ja(t,[400,800],[1,0]),d=ja(t,[800,1200],[0,1]),h=ja(t,[1200,1400],[50,0]),f=ja(t,[1200,1400],[0,1]);return b.useEffect(()=>{const p=setInterval(()=>{n(m=>(m+1)%K4.length)},4e3);return()=>clearInterval(p)},[]),b.useEffect(()=>{const p=setTimeout(()=>{o(!0),window.scrollTo({top:window.innerHeight*1.6,behavior:"smooth"})},2500);return()=>clearTimeout(p)},[]),b.useEffect(()=>t.on("change",m=>{(m>100||i)&&r(!1)}),[t,i]),u.jsxs("div",{className:"relative min-h-[300vh] bg-black text-white overflow-hidden",children:[u.jsx(X.div,{className:"fixed inset-0 z-10 pointer-events-none",style:{opacity:c},children:OGe.map((p,m)=>u.jsx(X.div,{className:"absolute text-lg md:text-2xl font-bold text-red-500/30 select-none",style:{left:`${15+m%4*25}%`,top:`${10+m%5*18}%`},initial:{opacity:0,scale:.3,y:100},animate:{opacity:[0,.6,.3,0],scale:[.3,1,1,.7],y:[100,0,-30,-80]},transition:{duration:8,repeat:1/0,delay:m*1.2,ease:"easeOut"},children:p},`${p}-${m}`))}),u.jsxs(X.section,{className:"fixed inset-0 flex items-center justify-center z-20",children:[u.jsx(X.div,{className:"relative",style:{scale:a,opacity:l},children:u.jsx(DGe,{})}),u.jsx(ko,{children:s&&u.jsx(X.div,{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:3},children:u.jsxs(X.div,{animate:{y:[0,10,0]},transition:{duration:2,repeat:1/0},children:[u.jsx(iee,{className:"w-8 h-8 text-red-500 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-400 text-lg",children:"Scroll to zoom"})]})})})]}),u.jsx(X.div,{className:"fixed inset-0 bg-gradient-to-b from-black via-gray-900 to-black z-5",style:{opacity:d}}),u.jsxs(X.section,{className:"relative z-30 min-h-screen flex flex-col items-center justify-center px-6 bg-black border-t-4 border-red-500",style:{y:h,opacity:f,marginTop:"160vh"},children:[u.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 w-16 h-1 bg-red-500 rounded-full"}),u.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[u.jsx(X.h1,{className:"text-6xl md:text-8xl font-bold mb-8",initial:{opacity:0,scale:.5},whileInView:{opacity:1,scale:1},transition:{duration:1.5},viewport:{once:!0},children:u.jsx("span",{className:"bg-gradient-to-r from-red-400 via-red-500 to-red-600 bg-clip-text text-transparent",children:"CoachT"})}),u.jsx(X.div,{className:"mb-6",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:1,delay:.3},viewport:{once:!0},children:u.jsxs("h2",{className:"text-2xl md:text-3xl text-gray-200 mb-2",children:["AI-Powered Martial Arts"," ",u.jsx("span",{className:"text-red-500 border border-red-500/50 px-4 py-1 rounded-full",children:"Training Partner"})]})}),u.jsxs(X.div,{className:"mb-12",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1,delay:.6},viewport:{once:!0},children:[u.jsxs("div",{className:"flex items-center justify-center gap-3 mb-8",children:[u.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),u.jsx("span",{className:"text-lg text-gray-300",children:"Built by Martial Artists"})]}),u.jsx(ko,{mode:"wait",children:u.jsx(X.h3,{className:"text-4xl md:text-5xl font-bold text-white mb-8",initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},transition:{duration:1},children:K4[e]},e)})]}),u.jsxs(X.div,{className:"flex flex-col sm:flex-row gap-6 justify-center items-center",initial:{opacity:0,y:40},whileInView:{opacity:1,y:0},transition:{duration:1,delay:1.2},viewport:{once:!0},children:[u.jsx(jn,{href:"/early",children:u.jsxs(Se,{size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-2xl shadow-red-500/25 px-12 py-6 text-xl font-semibold group transform hover:scale-105 transition-all duration-300",children:["Get Your Edge",u.jsx(lo,{className:"ml-3 w-6 h-6 group-hover:translate-x-1 transition-transform"})]})}),u.jsx(Se,{variant:"outline",size:"lg",className:"border-gray-600 text-gray-300 hover:bg-gray-800 hover:text-white px-8 py-6 text-lg",onClick:()=>{const p=document.querySelector('[data-section="features"]');p==null||p.scrollIntoView({behavior:"smooth"})},children:"Learn More"}),u.jsx("a",{href:"https://cal.com/ojas-kandhare/coacht-demo?overlayCalendar=true",target:"_blank",rel:"noopener noreferrer",children:u.jsx(Se,{variant:"outline",size:"lg",className:"border-gray-600 text-gray-300 hover:bg-gray-800 hover:text-white px-8 py-6 text-lg",children:"Reach out as organization"})})]}),u.jsx(X.p,{className:"text-gray-400 mt-12 text-lg max-w-2xl mx-auto leading-relaxed",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1,delay:1.5},viewport:{once:!0},children:"The competitive advantage that accelerates your journey to the next belt."})]})]}),u.jsx("section",{className:"py-32 px-6 relative z-30 bg-gradient-to-b from-black via-gray-900 to-black",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsx(X.h2,{className:"text-4xl md:text-6xl font-bold text-center mb-20",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:1.2},viewport:{once:!0},children:u.jsx("span",{className:"bg-gradient-to-r from-red-400 via-red-500 to-red-600 bg-clip-text text-transparent",children:"Your Journey to Mastery"})}),u.jsx("div",{className:"space-y-6",children:[{belt:"White Belt",phrase:"Start your journey. CoachT will guide every move.",gradient:"from-gray-100 to-white",textColor:"text-gray-800",shadowColor:"shadow-gray-500/20"},{belt:"Yellow Belt",phrase:"Build your basics. Train with confidence, not confusion.",gradient:"from-yellow-200 to-yellow-100",textColor:"text-gray-800",shadowColor:"shadow-yellow-500/20"},{belt:"Green Belt",phrase:"Push further. Tailored workouts, real growth.",gradient:"from-green-200 to-green-100",textColor:"text-gray-800",shadowColor:"shadow-green-500/20"},{belt:"Blue Belt",phrase:"Challenge yourself. Every rep moves you up the ranks.",gradient:"from-blue-200 to-blue-100",textColor:"text-gray-800",shadowColor:"shadow-blue-500/20"},{belt:"Red Belt",phrase:"Refine your edge. Outpace others on the leaderboard.",gradient:"from-red-200 to-red-100",textColor:"text-gray-800",shadowColor:"shadow-red-500/20"},{belt:"Black Belt",phrase:"Train like a master. Inspire the next generation.",gradient:"from-gray-800 to-gray-900",textColor:"text-white",shadowColor:"shadow-gray-900/40"}].map((p,m)=>u.jsxs(X.div,{className:"relative group",initial:{opacity:0,x:m%2===0?-50:50,scale:.9},whileInView:{opacity:1,x:0,scale:1,z:20},whileHover:{scale:1.05,z:40,rotateY:5,rotateX:2},transition:{duration:.8,delay:m*.1,type:"spring",stiffness:100},viewport:{once:!0,margin:"-50px"},style:{perspective:"1000px",transformStyle:"preserve-3d"},children:[u.jsxs("div",{className:`bg-gradient-to-r ${p.gradient} rounded-2xl p-6 md:p-8 border border-gray-200/20 ${p.shadowColor} shadow-2xl transform transition-all duration-500 group-hover:shadow-4xl backdrop-blur-sm`,children:[u.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[u.jsx("div",{className:`w-3 h-3 md:w-4 md:h-4 rounded-full bg-gradient-to-r ${p.gradient} border-2 border-gray-300 shadow-lg`}),u.jsx("div",{className:`text-xs md:text-sm font-bold uppercase tracking-wider ${p.textColor} opacity-90 antialiased`,style:{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale"},children:p.belt})]}),u.jsx("div",{className:`text-lg md:text-xl lg:text-2xl font-semibold leading-relaxed ${p.textColor} antialiased`,style:{WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility"},children:p.phrase}),u.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${p.gradient} rounded-2xl opacity-0 group-hover:opacity-20 transition-opacity duration-300 pointer-events-none`})]}),u.jsx("div",{className:`absolute inset-0 bg-gradient-to-r ${p.gradient} rounded-2xl transform translate-x-2 translate-y-2 -z-10 opacity-30 group-hover:translate-x-3 group-hover:translate-y-3 transition-transform duration-300`})]},m))}),u.jsxs(X.div,{className:"mt-20 flex flex-col sm:flex-row gap-6 justify-center items-center",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},transition:{duration:.8,delay:.8},viewport:{once:!0},children:[u.jsx(jn,{href:"/early",children:u.jsxs(Se,{size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-2xl shadow-red-500/25 px-12 py-6 text-xl font-semibold group transform hover:scale-105 transition-all duration-300",children:["Begin Your Journey",u.jsx(lo,{className:"ml-3 w-6 h-6 group-hover:translate-x-1 transition-transform"})]})}),u.jsx("a",{href:"https://cal.com/ojas-kandhare/coacht-demo?overlayCalendar=true",target:"_blank",rel:"noopener noreferrer",children:u.jsx(Se,{variant:"outline",size:"lg",className:"border-gray-600 text-gray-300 hover:bg-gray-800 hover:text-white px-8 py-6 text-lg font-semibold",children:"Reach out as organization"})})]})]})}),u.jsx("section",{className:"py-20 px-6 relative z-30","data-section":"features",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsx(X.h2,{className:"text-3xl md:text-4xl font-bold text-center mb-16",initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},children:"How CoachT Empowers Your Training"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.1},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-orange-600/50 transition-all duration-300",children:[u.jsx("img",{src:iX,alt:"Challenge Arena",className:"w-full rounded-xl shadow-lg shadow-orange-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-orange-300 transition-colors",children:"Dynamic Challenges"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Push your limits, dominate leaderboards, and prove your skills in thrilling, gamified challenges."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white w-full group",children:["Try Challenges",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-blue-600/50 transition-all duration-300",children:[u.jsx("img",{src:oX,alt:"Training Interface",className:"w-full rounded-xl shadow-lg shadow-blue-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-blue-300 transition-colors",children:"Start Live Routine"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Compare your live performance against expert demonstrations with precise AI insights."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white w-full group",children:["Start Training",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.3},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-purple-600/50 transition-all duration-300",children:[u.jsx("img",{src:aX,alt:"Practice Library",className:"w-full rounded-xl shadow-lg shadow-purple-500/20 border border-gray-700 mb-6"}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-purple-300 transition-colors",children:"Practice Library"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Advanced pose detection analyzes your every move with precise visual cues and AI guidance."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white w-full group",children:["Explore Library",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})}),u.jsx(X.div,{className:"group",initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.4},viewport:{once:!0,margin:"-50px"},children:u.jsxs("div",{className:"bg-gray-900/30 rounded-2xl p-6 h-full border border-gray-800 hover:border-green-600/50 transition-all duration-300",children:[u.jsx("div",{className:"w-full h-48 bg-gradient-to-br from-green-900/20 to-green-700/20 rounded-xl border border-gray-700 mb-6 flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(gh,{className:"w-12 h-12 text-green-400 mx-auto mb-4"}),u.jsx("p",{className:"text-green-300 font-medium",children:"Real-time AI Analysis"})]})}),u.jsx("h3",{className:"text-xl font-bold mb-4 text-white group-hover:text-green-300 transition-colors",children:"Real-time AI Feedback"}),u.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:"Get instant corrections and intelligent voice guidance from your personal AI master."}),u.jsx(jn,{href:"/early",children:u.jsxs(Se,{className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white w-full group",children:["Try AI Feedback",u.jsx(lo,{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform"})]})})]})})]})]})}),u.jsx(X.section,{className:"py-32 px-6 relative z-30",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:1.5},viewport:{once:!0,margin:"-100px"},children:u.jsx("div",{className:"max-w-4xl mx-auto text-center",children:u.jsxs(X.div,{initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:1},viewport:{once:!0},children:[u.jsx(X.div,{className:"mb-8",initial:{scale:0},whileInView:{scale:1},transition:{duration:.8,delay:.2},viewport:{once:!0},children:u.jsx(gh,{className:"w-16 h-16 text-red-500 mx-auto mb-6"})}),u.jsxs("h2",{className:"text-4xl md:text-6xl font-bold mb-8 leading-tight",children:["Ready to achieve"," ",u.jsx("span",{className:"bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent",children:"mastery?"})]}),u.jsx(X.p,{className:"text-2xl font-bold text-white mb-12",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8,delay:.4},viewport:{once:!0},children:"Start Your FREE Journey with CoachT Today"}),u.jsx(X.div,{initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.6},viewport:{once:!0},children:u.jsx(jn,{href:"/early",children:u.jsxs(Se,{size:"lg",className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-2xl shadow-red-500/30 px-16 py-8 text-2xl font-bold group transform hover:scale-105 transition-all duration-500",children:["Start Now",u.jsx(lo,{className:"ml-3 w-8 h-8 group-hover:translate-x-2 transition-transform duration-300"})]})})}),u.jsx(X.p,{className:"text-gray-400 mt-8 text-lg",initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8,delay:.8},viewport:{once:!0},children:"No credit card required • Instant access"})]})})}),u.jsx("footer",{className:"py-8 px-6 border-t border-gray-900 relative z-30",children:u.jsx("div",{className:"max-w-6xl mx-auto text-center",children:u.jsx("p",{className:"text-gray-500 text-sm",children:"© 2025 CoachT. Revolutionizing martial arts training with AI."})})})]})}const MGe=()=>{const[t,e]=b.useState(""),[n,s]=b.useState(""),[r,i]=b.useState("idle"),[o,a]=b.useState(""),l=async c=>{if(c.preventDefault(),!t.trim()){i("error"),a("Please enter your name.");return}if(!n||!n.includes("@")){i("error"),a("Please enter a valid email address.");return}i("loading"),a("");try{const h=await(await fetch("/api/send-guide",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.trim(),email:n})})).json();i("success"),h.note?a(`${h.message}. ${h.note}`):a(h.message||"Guide sent! Check your inbox."),e(""),s("")}catch(d){console.error("Submit Error:",d),i("error"),a("An unexpected error occurred. Please try again later.")}};return b.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"}),[]),u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black text-white flex flex-col items-center justify-center p-6 overflow-hidden",children:u.jsxs(X.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.8,ease:"easeOut"},className:"w-full max-w-md text-center space-y-6 md:space-y-8",children:[u.jsxs("div",{className:"flex justify-center items-center mb-6 md:mb-8",children:[u.jsx(X.span,{className:"material-icons text-red-500 text-5xl md:text-6xl",initial:{rotate:0},animate:{rotate:[0,15,-10,10,-5,5,0]},transition:{duration:1.5,ease:"easeInOut",delay:.5,repeat:1/0,repeatDelay:3},children:"sports_martial_arts"}),u.jsx("h1",{className:"text-4xl md:text-5xl font-bold ml-2 md:ml-3",style:{backgroundImage:"linear-gradient(to right, #f87171, #fb923c, #facc15)",WebkitBackgroundClip:"text",backgroundClip:"text",color:"transparent"},children:"CoachT"})]}),u.jsxs(X.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.3,ease:"easeOut"},className:"space-y-3 md:space-y-4",children:[u.jsx("h2",{className:"text-3xl md:text-4xl font-extrabold tracking-tight",children:"Start Now."}),u.jsxs("p",{className:"text-md md:text-lg text-sky-200/80 max-w-sm mx-auto",children:[u.jsx("span",{className:"font-bold text-lg md:text-xl whitespace-nowrap",children:"Check your email for an onboarding message"}),u.jsx("br",{}),"Or explore for yourself: ",u.jsx("a",{href:"/auth",className:"text-sky-400 hover:text-sky-300 underline",children:"coacht.xyz/auth"})]})]}),u.jsxs(X.form,{onSubmit:l,className:"space-y-4 md:space-y-5 w-full",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6,ease:"easeOut"},children:[u.jsxs("div",{className:"relative",children:[u.jsx(Ru,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),u.jsx(ar,{type:"text",placeholder:"Your name",value:t,onChange:c=>e(c.target.value),className:"w-full pl-10 pr-4 py-3 h-12 md:h-14 text-sm md:text-base bg-gray-800/70 border-gray-700 focus:border-red-500 focus:ring-red-500 placeholder-gray-500 rounded-xl shadow-lg",disabled:r==="loading"})]}),u.jsxs("div",{className:"relative",children:[u.jsx(MV,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),u.jsx(ar,{type:"email",placeholder:"Your email",value:n,onChange:c=>s(c.target.value),className:"w-full pl-10 pr-4 py-3 h-12 md:h-14 text-sm md:text-base bg-gray-800/70 border-gray-700 focus:border-red-500 focus:ring-red-500 placeholder-gray-500 rounded-xl shadow-lg",disabled:r==="loading"})]}),u.jsx(Se,{type:"submit",className:"w-full h-12 md:h-14 text-md md:text-lg font-semibold bg-gradient-to-r from-red-600 to-rose-500 hover:from-red-700 hover:to-rose-600 text-white shadow-xl hover:shadow-red-500/40 focus:ring-red-500 rounded-xl transition-all duration-300 ease-in-out transform hover:scale-105 active:scale-95",disabled:r==="loading",children:r==="loading"?u.jsx(yb,{className:"mr-2 h-5 md:h-6 w-5 md:w-6 animate-spin"}):u.jsxs(u.Fragment,{children:["Let's Start! ",u.jsx(BV,{className:"ml-2 h-4 md:h-5 w-4 md:w-5"})]})})]}),o&&u.jsxs(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:`mt-3 md:mt-4 p-3 rounded-md text-xs md:text-sm flex items-center justify-center ${r==="success"?"bg-green-600/80 text-white":r==="error"?"bg-red-600/80 text-white":""}`,children:[r==="success"&&u.jsx(Ff,{className:"mr-2 h-4 md:h-5 w-4 md:w-5"}),r==="error"&&u.jsx(yee,{className:"mr-2 h-4 md:h-5 w-4 md:w-5"}),o]})]})})},LGe=()=>{const[t,e]=b.useState("combat"),[n,s]=b.useState(null),r={combat:[{name:"Lightning Strikes",id:"max-punches",description:"Maximum punches in 30 seconds",difficulty:"Intermediate",participants:1247,record:"127 punches",recordHolder:"DragonFist92",icon:s1,color:"from-yellow-500 to-orange-600",bgPattern:"combat",available:!0,rewards:["50 XP","Lightning Badge","Leaderboard Spot"]},{name:"Viper's Reflexes",id:"reaction-time",description:"Test your lightning-fast reaction speed",difficulty:"Advanced",participants:892,record:"0.12s",recordHolder:"QuickStrike",icon:ea,color:"from-green-500 to-emerald-600",bgPattern:"reflex",available:!0,rewards:["75 XP","Viper Badge","Speed Master Title"]},{name:"Tornado Kicks",id:"flashy-kicks",description:"Master the most spectacular kicks",difficulty:"Expert",participants:567,record:"Perfect Form",recordHolder:"TornadoMaster",icon:OV,color:"from-purple-500 to-pink-600",bgPattern:"kicks",available:!0,rewards:["100 XP","Tornado Badge","Style Master Title"]}],endurance:[{name:"Iron Will",id:"endurance-test",description:"Hold perfect stance for 5 minutes",difficulty:"Expert",participants:234,record:"5:47",recordHolder:"IronStance",icon:Ck,color:"from-gray-500 to-slate-600",bgPattern:"endurance",available:!1,rewards:["150 XP","Iron Will Badge","Endurance Master"]},{name:"Balance Beam Breaker",id:"balance-beam",description:"Hold a perfect side-kick for 10 seconds on each leg",difficulty:"Advanced",participants:678,record:"Perfect Form",recordHolder:"KickMaster",icon:ea,color:"from-blue-500 to-cyan-600",bgPattern:"precision",available:!0,rewards:["80 XP","Balance Badge","Precision Master"]}],precision:[{name:"Sniper's Focus",id:"precision-strikes",description:"Hit targets with perfect accuracy",difficulty:"Advanced",participants:445,record:"100% accuracy",recordHolder:"BullseyeKing",icon:ea,color:"from-blue-500 to-cyan-600",bgPattern:"precision",available:!1,rewards:["80 XP","Sniper Badge","Precision Master"]}]},i=[{id:"combat",name:"Combat",icon:N_,count:r.combat.length},{id:"endurance",name:"Endurance",icon:k_,count:r.endurance.length},{id:"precision",name:"Precision",icon:ea,count:r.precision.length}],[,o]=Po(),a=(c,d)=>{d&&(c==="max-punches"?o("/challenges/max-punches"):c==="reaction-time"?o("/challenges/reaction-time"):c==="balance-beam"?o("/challenges/balance-beam"):c==="shifu-says"?o("/challenges/shifu-says"):console.log(`Challenge clicked: ${c}`))},l=c=>{switch(c){case"Beginner":return"text-green-400 bg-green-500/20";case"Intermediate":return"text-yellow-400 bg-yellow-500/20";case"Advanced":return"text-orange-400 bg-orange-500/20";case"Expert":return"text-red-400 bg-red-500/20";default:return"text-gray-400 bg-gray-500/20"}};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-950 to-red-950/20 text-white relative overflow-hidden",children:[u.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[u.jsx(X.div,{className:"absolute top-20 left-10 w-64 h-64 bg-red-500/5 rounded-full blur-3xl",animate:{scale:[1,1.2,1],rotate:[0,180,360],opacity:[.3,.6,.3]},transition:{duration:20,repeat:1/0}}),u.jsx(X.div,{className:"absolute bottom-20 right-10 w-96 h-96 bg-orange-500/5 rounded-full blur-3xl",animate:{scale:[1.2,1,1.2],rotate:[360,180,0],opacity:[.4,.7,.4]},transition:{duration:25,repeat:1/0}})]}),u.jsxs("div",{className:"relative z-10 p-4 sm:p-6 lg:p-8",children:[u.jsxs(X.div,{className:"text-center mb-8 sm:mb-12",initial:{opacity:0,y:-30},animate:{opacity:1,y:0},transition:{duration:.8},children:[u.jsx("div",{className:"flex items-center justify-center mb-4",children:u.jsx(jn,{href:"/app",children:u.jsxs(Se,{variant:"ghost",className:"text-white hover:bg-red-600/20 mr-4",children:[u.jsx(fa,{className:"h-5 w-5 mr-2"}),"Back to Training"]})})}),u.jsx(X.div,{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-red-500 to-orange-600 rounded-full mb-6 shadow-2xl shadow-red-500/50",whileHover:{scale:1.1,rotate:360},transition:{duration:.6},children:u.jsx(Nk,{className:"h-10 w-10 text-white"})}),u.jsx("h1",{className:"text-4xl sm:text-6xl lg:text-7xl font-black mb-4 bg-gradient-to-r from-red-400 via-orange-500 to-yellow-400 bg-clip-text text-transparent",children:"CHALLENGE ARENA"}),u.jsx("p",{className:"text-lg sm:text-xl text-gray-300 max-w-2xl mx-auto",children:"Push your limits. Break records. Become legendary."}),u.jsxs(X.div,{className:"flex justify-center items-center gap-8 mt-8 text-sm",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3},children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(T_,{className:"h-4 w-4 text-blue-400"}),u.jsx("span",{className:"text-gray-400",children:"2,138 Active Competitors"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(VV,{className:"h-4 w-4 text-green-400"}),u.jsx("span",{className:"text-gray-400",children:"+47% This Week"})]})]})]}),u.jsxs(X.div,{className:"max-w-4xl mx-auto mb-12 sm:mb-16",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.8},children:[u.jsx(X.div,{className:"text-center mb-8",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.6},children:u.jsxs("div",{className:"inline-flex items-center gap-3 mb-4",children:[u.jsx(X.div,{className:"w-2 h-2 bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full",animate:{scale:[1,1.5,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0}}),u.jsx("span",{className:"text-transparent bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 bg-clip-text font-bold text-lg tracking-widest",children:"FEATURED CHALLENGE"}),u.jsx(X.div,{className:"w-2 h-2 bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full",animate:{scale:[1,1.5,1],opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0,delay:1}})]})}),u.jsxs(X.div,{className:"relative group cursor-pointer",whileHover:{scale:1.02},transition:{duration:.3},onClick:()=>a("shifu-says",!0),children:[u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-r from-yellow-400/20 via-amber-500/30 to-yellow-600/20 rounded-3xl blur-xl",animate:{scale:[1,1.05,1],opacity:[.6,.8,.6]},transition:{duration:3,repeat:1/0}}),u.jsx("div",{className:"relative overflow-hidden rounded-3xl bg-gradient-to-br from-yellow-400 via-amber-500 to-yellow-600 p-[3px] shadow-2xl shadow-yellow-500/50",children:u.jsxs("div",{className:"relative bg-gradient-to-br from-gray-900 via-amber-950/20 to-gray-900 rounded-3xl p-8 sm:p-10 backdrop-blur-xl border border-yellow-500/20",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6 sm:gap-8 mb-8",children:[u.jsxs(X.div,{className:"relative",whileHover:{scale:1.1},transition:{duration:.3},children:[u.jsxs("div",{className:"relative w-24 h-24 sm:w-32 sm:h-32",children:[u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 rounded-full blur-md opacity-75",animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"}}),u.jsx("div",{className:"relative w-full h-full bg-gradient-to-br from-yellow-400 to-amber-600 rounded-full p-1 shadow-lg shadow-yellow-500/50",children:u.jsx("img",{src:"/images/shifu_coacht.png",alt:"Shifu",className:"w-full h-full object-contain rounded-full bg-gray-900"})})]}),u.jsx(X.div,{className:"absolute -top-2 -right-2 w-4 h-4 bg-yellow-400 rounded-full opacity-80",animate:{y:[-5,-15,-5],opacity:[.8,.4,.8]},transition:{duration:2,repeat:1/0}}),u.jsx(X.div,{className:"absolute -bottom-2 -left-2 w-3 h-3 bg-amber-500 rounded-full opacity-60",animate:{y:[-3,-10,-3],opacity:[.6,.3,.6]},transition:{duration:2.5,repeat:1/0,delay:.5}})]}),u.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[u.jsx(X.h2,{className:"text-4xl sm:text-5xl font-black mb-3 bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500 bg-clip-text text-transparent",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7},children:"SHIFU SAYS"}),u.jsx(X.p,{className:"text-amber-100 text-lg sm:text-xl mb-4",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8},children:"Follow the master's commands in this legendary challenge of precision and reflexes"}),u.jsxs(X.div,{className:"inline-flex items-center gap-2 bg-gradient-to-r from-yellow-400/20 to-amber-500/20 backdrop-blur-sm border border-yellow-400/30 rounded-full px-4 py-2",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.9},children:[u.jsx(lc,{className:"h-5 w-5 text-yellow-400"}),u.jsx("span",{className:"text-yellow-300 font-bold text-sm",children:"LEGENDARY"}),u.jsx(X.div,{className:"w-2 h-2 bg-yellow-400 rounded-full",animate:{scale:[1,1.3,1]},transition:{duration:1.5,repeat:1/0}})]})]})]}),u.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 sm:gap-6 mb-8",children:[u.jsxs("div",{className:"text-center p-4 bg-yellow-500/10 rounded-2xl border border-yellow-400/20",children:[u.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-yellow-400 mb-1",children:"156"}),u.jsx("div",{className:"text-amber-200 text-sm",children:"Masters"})]}),u.jsxs("div",{className:"text-center p-4 bg-yellow-500/10 rounded-2xl border border-yellow-400/20",children:[u.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-yellow-400 mb-1",children:"97%"}),u.jsx("div",{className:"text-amber-200 text-sm",children:"Best Score"})]}),u.jsxs("div",{className:"text-center p-4 bg-yellow-500/10 rounded-2xl border border-yellow-400/20",children:[u.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-yellow-400 mb-1",children:"0.8s"}),u.jsx("div",{className:"text-amber-200 text-sm",children:"Avg Time"})]}),u.jsxs("div",{className:"text-center p-4 bg-yellow-500/10 rounded-2xl border border-yellow-400/20",children:[u.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-yellow-400 mb-1",children:"12"}),u.jsx("div",{className:"text-amber-200 text-sm",children:"Rounds"})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"bg-gradient-to-r from-yellow-500/10 to-amber-500/10 rounded-2xl p-6 border border-yellow-400/20 mb-6",children:[u.jsxs("h4",{className:"text-yellow-300 font-bold text-lg mb-3 flex items-center gap-2",children:[u.jsx(ej,{className:"h-5 w-5"}),"The Master's Challenge"]}),u.jsx("p",{className:"text-amber-100 leading-relaxed",children:"Test your reflexes and precision as Shifu calls out complex martial arts sequences. You must perform the exact moves in perfect timing. Only true masters can achieve the golden rank!"})]}),u.jsxs("div",{children:[u.jsx("h5",{className:"text-yellow-300 font-semibold text-sm mb-3 tracking-wide",children:"LEGENDARY REWARDS"}),u.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.jsx("span",{className:"bg-gradient-to-r from-yellow-400/20 to-amber-500/20 border border-yellow-400/30 text-yellow-200 px-3 py-1 rounded-lg text-sm font-medium",children:"500 XP"}),u.jsx("span",{className:"bg-gradient-to-r from-yellow-400/20 to-amber-500/20 border border-yellow-400/30 text-yellow-200 px-3 py-1 rounded-lg text-sm font-medium",children:"Golden Master Badge"}),u.jsx("span",{className:"bg-gradient-to-r from-yellow-400/20 to-amber-500/20 border border-yellow-400/30 text-yellow-200 px-3 py-1 rounded-lg text-sm font-medium",children:"Shifu's Blessing Title"}),u.jsx("span",{className:"bg-gradient-to-r from-yellow-400/20 to-amber-500/20 border border-yellow-400/30 text-yellow-200 px-3 py-1 rounded-lg text-sm font-medium",children:"Hall of Fame"})]})]})]}),u.jsxs(X.div,{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 p-[2px] shadow-xl shadow-yellow-500/50",whileHover:{scale:1.02},whileTap:{scale:.98},children:[u.jsx("div",{className:"bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 rounded-2xl p-4 text-center",children:u.jsxs(X.div,{className:"flex items-center justify-center gap-3 text-gray-900 font-black text-lg",animate:{x:[0,5,0]},transition:{duration:2,repeat:1/0},children:[u.jsx(lc,{className:"h-6 w-6"}),u.jsx("span",{children:"ACCEPT SHIFU'S CHALLENGE"}),u.jsx(yk,{className:"h-6 w-6"})]})}),u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",animate:{x:[-100,400]},transition:{duration:3,repeat:1/0,ease:"linear"}})]}),u.jsx(X.div,{className:"absolute top-6 right-6 w-3 h-3 bg-yellow-400 rounded-full opacity-60",animate:{scale:[1,1.5,1],opacity:[.6,.3,.6]},transition:{duration:3,repeat:1/0}}),u.jsx(X.div,{className:"absolute bottom-8 left-6 w-2 h-2 bg-amber-500 rounded-full opacity-50",animate:{scale:[1,1.8,1],opacity:[.5,.2,.5]},transition:{duration:4,repeat:1/0,delay:1}})]})})]})]}),u.jsx(X.div,{className:"flex justify-center mb-8 sm:mb-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:u.jsx("div",{className:"flex bg-gray-900/50 rounded-2xl p-2 backdrop-blur-xl border border-gray-800",children:i.map(c=>u.jsxs(X.button,{onClick:()=>e(c.id),className:`flex items-center gap-2 px-4 sm:px-6 py-3 rounded-xl transition-all duration-300 ${t===c.id?"bg-gradient-to-r from-red-600 to-orange-600 text-white shadow-lg shadow-red-500/30":"text-gray-400 hover:text-white hover:bg-gray-800/50"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[u.jsx(c.icon,{className:"h-5 w-5"}),u.jsx("span",{className:"font-semibold",children:c.name}),u.jsx("span",{className:"bg-white/20 px-2 py-1 rounded-full text-xs",children:c.count})]},c.id))})}),u.jsx(X.div,{className:"max-w-7xl mx-auto",layout:!0,children:u.jsx(ko,{mode:"wait",children:u.jsx(X.div,{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 sm:gap-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5},children:r[t].map((c,d)=>u.jsxs(X.div,{className:`relative group cursor-pointer ${c.available?"":"opacity-60"}`,initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:d*.1},onMouseEnter:()=>s(c.id),onMouseLeave:()=>s(null),onClick:()=>a(c.id,c.available),whileHover:{scale:c.available?1.02:1},children:[u.jsx("div",{className:`relative overflow-hidden rounded-3xl bg-gradient-to-br ${c.color} p-[2px] shadow-2xl`,children:u.jsxs("div",{className:"relative bg-gray-900/95 rounded-3xl p-6 sm:p-8 h-full backdrop-blur-xl",children:[!c.available&&u.jsx("div",{className:"absolute inset-0 bg-gray-900/80 rounded-3xl flex items-center justify-center z-10",children:u.jsxs("div",{className:"text-center",children:[u.jsx(FV,{className:"h-12 w-12 text-gray-500 mx-auto mb-3"}),u.jsx("p",{className:"text-gray-400 font-semibold",children:"Coming Soon"})]})}),u.jsx(X.div,{className:`inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br ${c.color} rounded-2xl mb-6 shadow-lg`,whileHover:{rotate:360},transition:{duration:.6},children:u.jsx(c.icon,{className:"h-8 w-8 text-white"})}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:c.name}),u.jsx("p",{className:"text-gray-300 text-base sm:text-lg mb-4",children:c.description}),u.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold ${l(c.difficulty)}`,children:[u.jsx(ej,{className:"h-4 w-4 mr-1"}),c.difficulty]})]}),u.jsxs("div",{className:"space-y-3 mb-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-gray-400",children:"Participants"}),u.jsx("span",{className:"text-white font-semibold",children:c.participants.toLocaleString()})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-gray-400",children:"Record"}),u.jsx("span",{className:"text-yellow-400 font-semibold",children:c.record})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-gray-400",children:"Record Holder"}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(lc,{className:"h-4 w-4 text-yellow-400"}),u.jsx("span",{className:"text-yellow-400 font-semibold",children:c.recordHolder})]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"REWARDS"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:c.rewards.map((h,f)=>u.jsx("span",{className:"bg-gray-800/60 text-gray-300 px-2 py-1 rounded-lg text-xs",children:h},f))})]}),u.jsxs(X.div,{className:`flex items-center justify-between p-4 rounded-2xl ${c.available?`bg-gradient-to-r ${c.color} shadow-lg`:"bg-gray-800/50"}`,whileHover:c.available?{scale:1.02}:{},children:[u.jsx("span",{className:"text-white font-bold",children:c.available?"START CHALLENGE":"LOCKED"}),c.available&&u.jsx(yk,{className:"h-5 w-5 text-white"})]}),u.jsx(X.div,{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})}),u.jsx(X.div,{className:`absolute inset-0 bg-gradient-to-br ${c.color} rounded-3xl blur-xl opacity-0 group-hover:opacity-30 transition-opacity duration-500 -z-10`,animate:n===c.id?{scale:[1,1.1,1]}:{},transition:{duration:2,repeat:1/0}})]},c.id))},t)})}),u.jsxs(X.div,{className:"text-center mt-16 sm:mt-20",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:[u.jsx("p",{className:"text-gray-400 text-lg mb-6",children:"Ready to make history?"}),u.jsxs(X.div,{className:"inline-flex items-center gap-2 text-red-400 font-semibold",animate:{x:[0,5,0]},transition:{duration:2,repeat:1/0},children:[u.jsx(xee,{className:"h-5 w-5"}),u.jsx("span",{children:"New challenges drop weekly"})]})]})]})]})},BGe=()=>{const[,t]=Po(),e=[{id:"pushups",name:"Pushups",description:"A high-intensity workout targeting all major muscle groups.",icon:s1,colorScheme:{border:"border-orange-500",bg:"from-orange-900/20 to-orange-800/10",iconBg:"bg-orange-500",glow:"shadow-orange-500/20"}},{id:"crunches",name:"Crunches",description:"Boost your endurance with this heart-pumping cardio session.",icon:k_,colorScheme:{border:"border-green-500",bg:"from-green-900/20 to-green-800/10",iconBg:"bg-green-500",glow:"shadow-green-500/20"}},{id:"jumping-jacks",name:"Jumping Jacks",description:"Focus on building strength and power.",icon:T_,colorScheme:{border:"border-purple-500",bg:"from-purple-900/20 to-purple-800/10",iconBg:"bg-purple-500",glow:"shadow-purple-500/20"}}],n=s=>{switch(console.log(`Workout clicked: ${s}`),s){case"pushups":t("/workouts/pushups");break;case"crunches":t("/workouts/crunches");break;case"jumping-jacks":t("/workouts/jumping-jacks");break;default:console.log("Unknown workout:",s)}};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-indigo-900 text-white flex flex-col items-center justify-center p-8 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Workouts"})}),u.jsx("div",{className:"w-16"})," "]})}),u.jsxs("div",{className:"pt-16 w-full h-full flex-1 flex flex-col items-center justify-center max-w-4xl",children:[u.jsx(X.h1,{className:"text-4xl md:text-5xl font-bold mb-12 text-center text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:"Choose Your Workout"}),u.jsx("div",{className:"w-full space-y-6 max-w-3xl",children:e.map((s,r)=>{const i=s.icon;return u.jsxs(X.div,{className:`
                  relative bg-gradient-to-r ${s.colorScheme.bg} 
                  border-2 ${s.colorScheme.border} 
                  rounded-2xl p-8 cursor-pointer 
                  hover:scale-[1.02] hover:${s.colorScheme.glow} 
                  transition-all duration-300 ease-in-out 
                  shadow-xl backdrop-blur-sm
                  min-h-[120px] flex items-center
                `,onClick:()=>n(s.id),initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.5,delay:r*.1},whileHover:{scale:1.02},whileTap:{scale:.98},children:[u.jsx("div",{className:`
                  ${s.colorScheme.iconBg} 
                  rounded-xl p-4 mr-6 flex-shrink-0
                  shadow-lg
                `,children:u.jsx(i,{className:"w-8 h-8 text-white"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2 text-white",children:s.name}),u.jsx("p",{className:"text-gray-300 text-lg leading-relaxed",children:s.description})]}),u.jsx("div",{className:`
                  absolute inset-0 rounded-2xl 
                  bg-gradient-to-r ${s.colorScheme.bg} 
                  opacity-0 hover:opacity-10 
                  transition-opacity duration-300
                `})]},s.id)})}),e.length===0&&u.jsx(X.p,{className:"text-center text-gray-400 text-xl mt-12",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:"(No workouts available yet - stay tuned!)"})]})]})},VGe=({children:t,initialPosition:e={x:0,y:0},className:n="",constrainToWindow:s=!0,zIndex:r=50})=>{const[i,o]=b.useState(e),a=b.useRef(null),[l,c]=b.useState(!1),[d,h]=b.useState({left:0,right:0,top:0,bottom:0});b.useEffect(()=>{const p=()=>{if(a.current&&s){const m=window.innerWidth,g=window.innerHeight,x=a.current.getBoundingClientRect();h({left:0,right:m-x.width,top:0,bottom:g-x.height})}};return p(),window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[s]);const f=()=>{c(!1),s&&a.current&&o(p=>({x:Math.max(d.left,Math.min(d.right,p.x)),y:Math.max(d.top,Math.min(d.bottom,p.y))}))};return u.jsx(X.div,{ref:a,drag:!0,dragMomentum:!1,dragElastic:0,dragConstraints:s?d:!1,onDragStart:()=>c(!0),onDragEnd:f,initial:{x:i.x,y:i.y},animate:{x:i.x,y:i.y},style:{position:"absolute",zIndex:r,touchAction:"none"},className:`cursor-move ${l?"select-none":""} ${n}`,whileDrag:{scale:1.05},children:t})},q4=t=>t==="blue"?{r:59,g:130,b:246}:t==="green"?{r:16,g:185,b:129}:t==="purple"?{r:139,g:92,b:246}:t==="orange"?{r:249,g:115,b:22}:{r:239,g:68,b:68},zGe=({skeletonColor:t="red"})=>{const e=b.useRef(null),n=b.useRef(null),[s,r]=b.useState(null),[i,o]=b.useState(30),[a,l]=b.useState(!1),[c,d]=b.useState(!0),[h,f]=b.useState(null),p=b.useRef(null),[m,g]=b.useState(null),[x,y]=b.useState(0),[v,S]=b.useState(!1),C=b.useRef({left:0,right:0}),k=80,T=80,_=50,[$,R]=b.useState(null),[A,j]=b.useState(0),[F,L]=b.useState(!1),[M,q]=b.useState(!0),[z,re]=b.useState(null),[U,G]=b.useState(null),xe="/assets/sounds/hit.mp3",Ce="/assets/sounds/countdown.mp3",De="lightning",fe=1,ee=.3,Pe=.3,Re=3,ce=b.useRef(0),[,me]=Po(),[ie,Q]=b.useState({x:window.innerWidth-120,y:80}),oe=b.useRef(0),ae=.3,Ae=b.useRef({left:null,right:null});b.useEffect(()=>{(async()=>{try{const je=await go(De);f(je)}catch(je){console.error("Error initializing pose detection:",je)}})()},[De]),b.useEffect(()=>((async()=>{if(h)try{const je=await navigator.mediaDevices.getUserMedia({video:!0});e.current&&(e.current.srcObject=je,e.current.onloadedmetadata=()=>{n.current&&e.current&&(n.current.width=e.current.videoWidth,n.current.height=e.current.videoHeight)}),r(je)}catch(je){console.error("Error accessing camera:",je)}})(),()=>{s&&s.getTracks().forEach(je=>je.stop()),p.current&&cancelAnimationFrame(p.current)}),[h]),b.useEffect(()=>{try{const Me=new Audio(xe);Me.preload="auto",re(Me),console.log("Hit sound preloaded from:",xe)}catch(Me){console.error("Failed to load hit sound:",Me)}try{const Me=new Audio(Ce);Me.preload="auto",G(Me),console.log("Countdown sound preloaded from:",Ce)}catch(Me){console.error("Failed to load countdown sound:",Me)}},[]),b.useEffect(()=>{const Me=new Image;Me.src="/assets/images/target.png",Me.onload=()=>R(Me),Me.onerror=()=>console.error("Failed to load target image from /assets/images/target.png")},[]);const Be=async()=>{if(ce.current=(ce.current+1)%Re,ce.current!==0&&(F||a)){p.current=requestAnimationFrame(Be);return}if(e.current&&n.current&&h&&e.current.readyState>=2&&e.current.videoWidth>0)try{const Me=await pr(e.current,fe,ee),je=n.current.getContext("2d");if(je&&(je.clearRect(0,0,n.current.width,n.current.height),je.drawImage(e.current,0,0,n.current.width,n.current.height),Me.forEach(Ze=>{if(Ze.keypoints&&Ze.keypoints.length>0){const Ye=Ze.keypoints,Ie=t,B=Pe,Z=3,te=6,ve=q4(Ie),we=`rgb(${ve.r}, ${ve.g}, ${ve.b})`,de=we,Ee=`rgba(${ve.r}, ${ve.g}, ${ve.b}, 0.7)`;je.strokeStyle=we,je.lineWidth=Z,Ac().forEach(It=>{const[jt,hs]=It,fn=Ye.find(At=>At.name===jt),dt=Ye.find(At=>At.name===hs);fn&&dt&&(fn.score??0)>B&&(dt.score??0)>B&&(je.save(),je.shadowColor=Ee,je.shadowBlur=10,je.beginPath(),je.moveTo(fn.x,fn.y),je.lineTo(dt.x,dt.y),je.stroke(),je.restore())}),Ye.forEach(It=>{(It.score??0)>B&&(je.save(),je.shadowColor=Ee,je.shadowBlur=15,je.fillStyle=de,je.beginPath(),je.arc(It.x,It.y,te,0,2*Math.PI),je.fill(),je.restore())})}}),a&&m)){je.save();const Ze=k/2;if($)je.shadowColor=v?"rgba(255, 255, 100, 0.9)":"rgba(255, 87, 34, 0.7)",je.shadowBlur=v?35:25,je.drawImage($,m.x,m.y,k,T);else{const Ie=q4("red");je.shadowColor=v?"rgba(255, 255, 100, 0.9)":`rgba(${Ie.r}, ${Ie.g}, ${Ie.b}, 0.7)`,je.shadowBlur=v?30:20,je.fillStyle=`rgb(${Ie.r}, ${Ie.g}, ${Ie.b})`,je.beginPath(),je.arc(m.x+Ze,m.y+Ze,Ze,0,2*Math.PI),je.fill()}je.restore();const Ye={x:m.x,y:m.y,width:k,height:T};Me.forEach(Ie=>{if(Ie.keypoints&&Ie.keypoints.length>0){const B=Ie.keypoints;[{name:"left",kp:B.find(te=>te.name==="left_wrist")},{name:"right",kp:B.find(te=>te.name==="right_wrist")}].forEach(({name:te,kp:ve})=>{if(ve&&(ve.score??0)>Pe){const we=Date.now(),de=Ae.current[te];let Ee=0;if(de){const mt=ve.x-de.x,It=ve.y-de.y,jt=we-de.time,hs=Math.sqrt(mt*mt+It*It);Ee=jt>0?hs/jt:0}Ae.current[te]={x:ve.x,y:ve.y,time:we},ve.x>Ye.x&&ve.x<Ye.x+Ye.width&&ve.y>Ye.y&&ve.y<Ye.y+Ye.height&&Ee>ae&&we-C.current[te]>_&&(y(mt=>mt+1),C.current[te]=we,S(!0),z&&(z.currentTime=0,z.play().catch(mt=>console.error("Error playing hit sound:",mt))),setTimeout(()=>S(!1),150))}else Ae.current[te]=null})}})}}catch(Me){console.error("Error in detectAndDrawPose:",Me)}(F||a)&&(p.current=requestAnimationFrame(Be))};b.useEffect(()=>{if((F||a)&&h&&s)ce.current=0,p.current=requestAnimationFrame(Be);else if(p.current&&(cancelAnimationFrame(p.current),p.current=null),n.current&&!F&&!a){const Me=n.current.getContext("2d");Me&&Me.clearRect(0,0,n.current.width,n.current.height)}return()=>{p.current&&cancelAnimationFrame(p.current)}},[F,a,h,s,t]),b.useEffect(()=>{let Me=null;return a&&i>0?Me=setInterval(()=>{o(je=>{const Ze=je-1;return Ze<=5&&Ze>0&&U&&(U.currentTime=0,U.play().catch(Ye=>console.error("Error playing main countdown sound:",Ye))),Ze})},1e3):i===0&&a&&(l(!1),d(!0)),()=>{Me&&clearInterval(Me)}},[a,i]);const Xe=async()=>{y(0),C.current={left:0,right:0},o(30),g(null),d(!1),l(!1),j(3),L(!0),console.log("Start button clicked, entering preparation phase...")};b.useEffect(()=>{let Me=null;return F&&A>0?(U&&(U.currentTime=0,U.play().catch(je=>console.error("Error playing prep countdown sound:",je))),Me=setInterval(()=>{j(je=>{const Ze=je-1;return Ze>0&&U&&(U.currentTime=0,U.play().catch(Ye=>console.error("Error playing prep countdown sound:",Ye))),Ze})},1e3)):F&&A===0&&(L(!1),l(!0),(async()=>{if(e.current&&h&&n.current)try{console.log("Attempting to detect pose for paddle placement...");const Ze=await pr(e.current,fe,ee);if(Ze&&Ze.length>0&&Ze[0].keypoints){const Ie=Ze[0].keypoints.find(Z=>Z.name==="right_wrist"),B=k/2;if(Ie&&(Ie.score??0)>Pe){const Z=Ie.x-B,te=Ie.y-B;g({x:Z,y:te}),console.log("Paddle position fixed at right wrist:",{x:Z,y:te})}else console.warn("Right wrist not detected reliably at end of prep. Using default paddle position."),g({x:n.current.width*.75-B,y:n.current.height*.3-B})}else{console.warn("No poses detected at end of prep. Using default paddle position.");const Ye=k/2;g({x:n.current.width*.75-Ye,y:n.current.height*.3-Ye})}}catch(Ze){console.error("Error estimating poses for fixed paddle placement:",Ze);const Ye=k/2;g({x:n.current.width*.75-Ye,y:n.current.height*.3-Ye})}else{console.error("Video, detector, or canvas not ready for fixed paddle placement. Using default.");const Ze=k/2;g({x:300-Ze,y:150-Ze})}})()),()=>{Me&&clearInterval(Me)}},[F,A,h,e,n,k,fe,ee,Pe]);const lt=()=>{const Me=Date.now();Me-oe.current<400&&Q({x:window.innerWidth-120,y:80}),oe.current=Me};return u.jsxs("div",{className:"min-h-screen bg-black text-white flex flex-col items-start justify-start relative overflow-hidden max-w-full max-h-full",children:[u.jsxs("div",{className:"w-full bg-gradient-to-r from-red-900/80 to-black/80 py-3 px-2 sm:px-4 flex items-center justify-between z-10 shadow-lg",children:[u.jsxs("button",{onClick:()=>me("/challenges"),className:"flex items-center text-white/80 hover:text-white transition-colors text-base sm:text-sm",children:[u.jsx(fa,{className:"h-5 w-5 mr-1"}),u.jsx("span",{children:"Back"})]}),u.jsx("h1",{className:"text-lg sm:text-xl md:text-2xl font-bold text-red-500 text-center flex-1",children:"Maximum Punches in 30 Seconds"}),u.jsx("div",{className:"w-10 sm:w-16"})," "]}),M&&u.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center z-50 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-gray-900 border border-red-800 rounded-xl p-4 sm:p-6 max-w-md w-full",children:[u.jsx("h2",{className:"text-2xl sm:text-3xl text-yellow-400 font-bold mb-4 sm:mb-6",children:"Max Punches Challenge!"}),u.jsxs("div",{className:"text-sm sm:text-base text-center space-y-3 sm:space-y-4 mb-6 sm:mb-8",children:[u.jsx("p",{children:"Get ready to punch as fast as you can for 30 seconds!"}),u.jsxs("p",{children:[`When you click "Let's Go!", you'll have `,u.jsx("strong",{className:"text-yellow-400",children:"3 seconds"})," to get in position."]}),u.jsxs("p",{children:["Raise your ",u.jsx("strong",{className:"text-yellow-400",children:"right arm"})," out. A ",u.jsx("strong",{className:"text-red-500",children:"red target"})," will appear at your fist."]}),u.jsx("p",{children:"Punch the target as many times as you can before the timer runs out!"})]}),u.jsx("button",{onClick:()=>q(!1),className:"w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-lg text-lg sm:text-xl shadow-lg hover:shadow-yellow-500/50 transition-all duration-300 ease-in-out",children:"Let's Go!"})]})}),u.jsxs("div",{className:"w-full flex-1 relative max-w-full max-h-full",children:[u.jsxs("div",{className:"absolute inset-0 bg-black max-w-full max-h-full",children:[u.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover max-w-full max-h-full",muted:!0}),u.jsx("canvas",{ref:n,className:"absolute inset-0 w-full h-full max-w-full max-h-full"})]}),a&&m&&u.jsxs("div",{className:"absolute top-16 left-2 sm:left-4 bg-black/70 text-white px-2 sm:px-3 py-1 sm:py-2 rounded-lg z-10 text-base sm:text-lg",children:[u.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-400",children:"HITS"}),u.jsx("div",{className:"text-lg sm:text-2xl font-bold text-white",children:x})]}),a&&u.jsx(VGe,{initialPosition:ie,className:"touch-none",children:u.jsxs("div",{className:"bg-black/80 border-2 border-red-600 rounded-xl px-3 sm:px-4 py-2 sm:py-3 shadow-lg shadow-red-600/30 min-w-[70px] sm:min-w-[100px] text-center select-none",onTouchEnd:lt,onDoubleClick:lt,children:[u.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-400",children:"TIME"}),u.jsx("div",{className:"text-2xl sm:text-3xl md:text-4xl font-mono font-bold text-red-500",children:String(i).padStart(2,"0")})]})}),F&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-30",children:[u.jsx("div",{className:"text-yellow-400 text-2xl sm:text-3xl md:text-5xl font-bold mb-2 sm:mb-4",children:"Get Ready!"}),u.jsx("div",{className:"text-yellow-400 text-5xl sm:text-7xl md:text-9xl font-bold",children:A})]}),!a&&i===0&&u.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-30 p-2 sm:p-4",children:u.jsxs("div",{className:"bg-gray-900 border border-yellow-600 rounded-xl p-4 sm:p-6 max-w-md w-full text-center",children:[u.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-yellow-400 mb-2",children:"Challenge Complete!"}),u.jsxs("div",{className:"text-4xl sm:text-5xl md:text-6xl font-bold text-white my-4 sm:my-6",children:[x," ",u.jsx("span",{className:"text-lg sm:text-2xl text-gray-400",children:"hits"})]}),u.jsx("button",{onClick:Xe,className:"w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-lg text-lg sm:text-xl shadow-lg hover:shadow-yellow-500/50 transition-all duration-300 ease-in-out",children:"Try Again"})]})}),c&&!M&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:u.jsx("button",{onClick:Xe,disabled:F||a,className:`animate-pulse w-11/12 max-w-xs font-bold py-4 px-10 rounded-2xl text-2xl sm:text-3xl shadow-2xl transition-all duration-300 ease-in-out border-4 border-yellow-400 bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-500 text-black drop-shadow-lg focus:outline-none focus:ring-4 focus:ring-yellow-400/60 hover:scale-105 hover:shadow-yellow-400/70 ${F||a?"bg-gray-600 text-gray-400 cursor-not-allowed border-gray-400 animate-none":"hover:bg-yellow-400/90"}`,style:{boxShadow:"0 0 32px 8px #fde047, 0 0 8px 2px #facc15"},children:"Start Challenge"})})]})]})},X4=5,Kc=40,Y4=.2,WGe=()=>{const[,t]=Po(),[e,n]=b.useState(!0),[s,r]=b.useState(!1),[i,o]=b.useState(X4),[a,l]=b.useState(!1),[c,d]=b.useState(null),[h,f]=b.useState(null),[p,m]=b.useState(!1),[g,x]=b.useState(null),[y,v]=b.useState(null),S=b.useRef(null),C=b.useRef(null),[k,T]=b.useState(null),_=b.useRef(null),$=b.useRef({left:null,right:null}),[R,A]=b.useState(!1),[j,F]=b.useState(!1),[L,M]=b.useState(0),q=b.useRef(null);b.useEffect(()=>{(async()=>{try{const ee=await go("lightning");v(ee)}catch(ee){console.error("Error initializing pose detection:",ee)}})()},[]),b.useEffect(()=>((async()=>{try{const ee=await navigator.mediaDevices.getUserMedia({video:!0});S.current&&(S.current.srcObject=ee,S.current.onloadedmetadata=()=>{S.current&&(S.current.play(),C.current&&(C.current.width=S.current.videoWidth,C.current.height=S.current.videoHeight))}),T(ee)}catch(ee){console.error("Error accessing camera:",ee)}})(),()=>{k&&k.getTracks().forEach(ee=>ee.stop()),_.current&&cancelAnimationFrame(_.current)}),[]);const z=()=>{n(!1),r(!0),o(X4),l(!0),d(null),f(null),m(!1),x(null)};b.useEffect(()=>{if(a&&i>0){const fe=setTimeout(()=>o(ee=>ee-1),1e3);return()=>clearTimeout(fe)}else a&&i===0&&(l(!1),A(!0),M(0),F(!0),f(null),re())},[a,i]),b.useEffect(()=>(j?q.current=setInterval(()=>{M(fe=>fe+10)},10):q.current&&clearInterval(q.current),()=>{q.current&&clearInterval(q.current)}),[j]);const re=async()=>{if(!y||!S.current)return;const fe=await pr(S.current,1,.3);if(fe&&fe[0]&&fe[0].keypoints){const ee=fe[0].keypoints,Pe=ee.find(me=>me.name==="left_shoulder"),Re=ee.find(me=>me.name==="right_shoulder");let ce=Re&&typeof Re.score=="number"&&Re.score>.3?Re:Pe;if(ce){const me=C.current.width,ie=C.current.height;let oe=(Math.random()>.5?"right":"left")==="right"?me-Kc:Kc;const ae=ce.x+(oe-ce.x)*.5,Ae=Math.max(Kc,Math.min(ce.y,ie-Kc));d({x:ae,y:Ae}),m(!0),x(performance.now()),_.current=requestAnimationFrame(U);return}}d({x:C.current.width/2,y:C.current.height/2}),m(!0),x(performance.now()),_.current=requestAnimationFrame(U)},U=async()=>{if(!p||!y||!S.current||!c)return;const fe=await pr(S.current,1,.3);if(fe&&fe[0]&&fe[0].keypoints){const ee=fe[0].keypoints,Pe=[{name:"left",kp:ee.find(Re=>Re.name==="left_wrist")},{name:"right",kp:ee.find(Re=>Re.name==="right_wrist")}];for(const{name:Re,kp:ce}of Pe)if(ce&&typeof ce.score=="number"&&ce.score>.3){const me=performance.now(),ie=$.current[Re];let Q=0;if(ie){const ae=ce.x-ie.x,Ae=ce.y-ie.y,Be=me-ie.time,Xe=Math.sqrt(ae*ae+Ae*Ae);Q=Be>0?Xe/Be:0}if($.current[Re]={x:ce.x,y:ce.y,time:me},Math.sqrt(Math.pow(ce.x-c.x,2)+Math.pow(ce.y-c.y,2))<Kc&&Q>Y4){m(!1),A(!1),F(!1),f(L),alert(`Challenge ended! Reaction time: ${L.toFixed(2)} ms`),setTimeout(()=>r(!1),1200);return}}else $.current[Re]=null}_.current=requestAnimationFrame(U)};b.useEffect(()=>{if(C.current&&S.current){const fe=()=>{const ee=C.current.getContext("2d");ee&&(ee.clearRect(0,0,C.current.width,C.current.height),ee.drawImage(S.current,0,0,C.current.width,C.current.height),c&&(p||h!==null)&&(ee.save(),ee.shadowColor="rgba(255,0,0,0.7)",ee.shadowBlur=30,ee.beginPath(),ee.arc(c.x,c.y,Kc,0,2*Math.PI),ee.fillStyle=h!==null?"rgba(255,0,0,0.5)":"red",ee.fill(),ee.restore()),requestAnimationFrame(fe))};fe()}},[c,p,h]);const G=fe=>({r:139,g:92,b:246}),xe="purple",Ce=.3,De=async()=>{if(!S.current||!C.current||!y||S.current.readyState<2){_.current=requestAnimationFrame(De);return}try{const fe=await pr(S.current,1,.3),ee=C.current.getContext("2d");if(ee&&(ee.clearRect(0,0,C.current.width,C.current.height),ee.drawImage(S.current,0,0,C.current.width,C.current.height),fe.forEach(Pe=>{if(Pe.keypoints&&Pe.keypoints.length>0){const Re=Pe.keypoints,ce=G(xe),me=`rgb(${ce.r}, ${ce.g}, ${ce.b})`,ie=me,Q=`rgba(${ce.r}, ${ce.g}, ${ce.b}, 0.7)`;ee.strokeStyle=me,ee.lineWidth=3,Ac().forEach(([ae,Ae])=>{const Be=Re.find(lt=>lt.name===ae),Xe=Re.find(lt=>lt.name===Ae);Be&&Xe&&(Be.score??0)>Ce&&(Xe.score??0)>Ce&&(ee.save(),ee.shadowColor=Q,ee.shadowBlur=10,ee.beginPath(),ee.moveTo(Be.x,Be.y),ee.lineTo(Xe.x,Xe.y),ee.stroke(),ee.restore())}),Re.forEach(ae=>{(ae.score??0)>Ce&&(ee.save(),ee.shadowColor=Q,ee.shadowBlur=15,ee.fillStyle=ie,ee.beginPath(),ee.arc(ae.x,ae.y,6,0,2*Math.PI),ee.fill(),ee.restore())})}}),R&&c&&(ee.save(),ee.shadowColor="rgba(255,0,0,0.7)",ee.shadowBlur=30,ee.beginPath(),ee.arc(c.x,c.y,Kc,0,2*Math.PI),ee.fillStyle="red",ee.fill(),ee.restore())),R&&c&&fe[0]&&fe[0].keypoints){const Pe=fe[0].keypoints,Re=[{name:"left",kp:Pe.find(ce=>ce.name==="left_wrist")},{name:"right",kp:Pe.find(ce=>ce.name==="right_wrist")}];for(const{name:ce,kp:me}of Re)if(me&&typeof me.score=="number"&&me.score>.3){const ie=performance.now(),Q=$.current[ce];let oe=0;if(Q){const Ae=me.x-Q.x,Be=me.y-Q.y,Xe=ie-Q.time,lt=Math.sqrt(Ae*Ae+Be*Be);oe=Xe>0?lt/Xe:0}if($.current[ce]={x:me.x,y:me.y,time:ie},Math.sqrt(Math.pow(me.x-c.x,2)+Math.pow(me.y-c.y,2))<Kc&&oe>Y4){A(!1),F(!1),f(L),alert(`Challenge ended! Reaction time: ${L.toFixed(2)} ms`),setTimeout(()=>r(!1),1200);return}}else $.current[ce]=null}_.current=requestAnimationFrame(De)}catch{_.current=requestAnimationFrame(De)}};return b.useEffect(()=>{if(s&&y&&k)_.current=requestAnimationFrame(De);else if(_.current&&(cancelAnimationFrame(_.current),_.current=null),C.current&&!s){const fe=C.current.getContext("2d");fe&&fe.clearRect(0,0,C.current.width,C.current.height)}return()=>{_.current&&cancelAnimationFrame(_.current)}},[s,y,k,R,c,L]),u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-indigo-900 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/challenges"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Viper's Reflexes"})}),u.jsx("div",{className:"w-16"})," "]})}),u.jsxs("div",{className:"pt-10 w-full h-full flex-1 flex flex-col items-center justify-center",children:[u.jsx(ko,{children:e&&u.jsx(X.div,{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-50 p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-purple-700 max-w-lg text-center",initial:{scale:.9,y:20},animate:{scale:1,y:0},transition:{delay:.1,duration:.3},children:[u.jsx(ea,{className:"text-purple-400 w-16 h-16 mx-auto mb-4"}),u.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500 mb-4",children:"Viper's Reflexes"}),u.jsxs("p",{className:"text-purple-200 text-lg mb-6",children:[u.jsx("strong",{children:"Goal:"})," Face the camera and look at the screen. When the red dot appears, hit it as fast as you can with your fist!"]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/challenges"),variant:"outline",className:"text-purple-300 border-purple-600 hover:bg-purple-700 hover:text-white",children:"Back to Challenges"}),u.jsx(Se,{onClick:z,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold",children:"Let's Go!"})]})]})})}),u.jsxs("div",{className:"absolute inset-0 w-full h-full z-0",children:[u.jsx("video",{ref:S,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),u.jsx("canvas",{ref:C,className:"absolute inset-0 w-full h-full"}),s&&a&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[u.jsx("div",{className:"text-yellow-400 text-3xl sm:text-5xl font-bold mb-2 bg-black/40 px-4 py-2 rounded-xl",children:"Face the camera and look at the screen"}),u.jsx("div",{className:"text-yellow-400 text-7xl sm:text-9xl font-bold bg-black/40 px-8 py-4 rounded-2xl",children:i})]}),s&&R&&u.jsxs("div",{className:"absolute top-6 right-6 z-30 bg-black/60 px-4 py-2 rounded-xl text-2xl font-bold text-yellow-300",children:[(L/1e3).toFixed(3),"s"]}),h!==null&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-30",children:[u.jsxs("div",{className:"text-4xl sm:text-6xl font-bold text-yellow-400 mb-4 bg-black/70 px-8 py-4 rounded-2xl",children:[(h/1e3).toFixed(3),"s"]}),u.jsx("div",{className:"text-xl text-white mb-6 bg-black/60 px-6 py-2 rounded-xl",children:"Your Reaction Time"}),u.jsx(Se,{onClick:z,className:"bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-lg text-lg shadow-lg hover:shadow-yellow-500/50 transition-all duration-300 ease-in-out",children:"Try Again"})]})]})]})]})},Q4=5,UGe="purple",rC=.3,HGe=()=>{const[,t]=Po(),[e,n]=b.useState(!0),[s,r]=b.useState(!1),[i,o]=b.useState(Q4),[a,l]=b.useState(!1),[c,d]=b.useState(null),h=b.useRef(null),f=b.useRef(null),[p,m]=b.useState(null),g=b.useRef(null),[x,y]=b.useState(null),[v,S]=b.useState(!1),[C,k]=b.useState(0),[T,_]=b.useState(!1),[$,R]=b.useState(!1),A=160,j=145,F=.6,[L,M]=b.useState("right"),[q,z]=b.useState(!1),[re,U]=b.useState(0),[G,xe]=b.useState(0),[Ce,De]=b.useState(!1),[fe,ee]=b.useState(null),Pe=.2;b.useEffect(()=>{(async()=>{try{const ae=await go("lightning");d(ae)}catch(ae){console.error("Error initializing pose detection:",ae)}})()},[]),b.useEffect(()=>((async()=>{try{const ae=await navigator.mediaDevices.getUserMedia({video:!0});h.current&&(h.current.srcObject=ae,h.current.onloadedmetadata=()=>{h.current&&(h.current.play(),f.current&&(f.current.width=h.current.videoWidth,f.current.height=h.current.videoHeight))}),m(ae)}catch(ae){console.error("Error accessing camera:",ae)}})(),()=>{p&&p.getTracks().forEach(ae=>ae.stop()),g.current&&cancelAnimationFrame(g.current)}),[]);const Re=()=>{n(!1),r(!0),o(Q4),l(!0),M("right"),k(0),U(0),xe(0),De(!1),z(!1),Q(!1)};b.useEffect(()=>{if(a&&i>0){const oe=setTimeout(()=>o(ae=>ae-1),1e3);return()=>clearTimeout(oe)}else a&&i===0&&l(!1)},[a,i]);const ce=oe=>({r:139,g:92,b:246});b.useEffect(()=>{let oe=null;return s&&v&&(oe=setInterval(()=>k(ae=>ae+.1),100)),()=>{oe&&clearInterval(oe)}},[s,v]),b.useEffect(()=>{if(!a&&s){R(!0);const oe=setTimeout(()=>R(!1),3e3);return()=>clearTimeout(oe)}},[a,s]);const me=async()=>{if(!h.current||!f.current||!c||h.current.readyState<2){g.current=requestAnimationFrame(me);return}try{const oe=await pr(h.current,1,.3),ae=f.current.getContext("2d");if(ae){ae.clearRect(0,0,f.current.width,f.current.height),ae.drawImage(h.current,0,0,f.current.width,f.current.height);let Ae=null,Be=!1;oe.forEach(Xe=>{if(Xe.keypoints&&Xe.keypoints.length>0){const lt=Xe.keypoints,Me=ce(UGe),je=`rgb(${Me.r}, ${Me.g}, ${Me.b})`,Ze=je,Ye=`rgba(${Me.r}, ${Me.g}, ${Me.b}, 0.7)`;ae.strokeStyle=je,ae.lineWidth=3,Ac().forEach(([ve,we])=>{const de=lt.find(mt=>mt.name===ve),Ee=lt.find(mt=>mt.name===we);de&&Ee&&(de.score??0)>rC&&(Ee.score??0)>rC&&(ae.save(),ae.shadowColor=Ye,ae.shadowBlur=10,ae.beginPath(),ae.moveTo(de.x,de.y),ae.lineTo(Ee.x,Ee.y),ae.stroke(),ae.restore())}),lt.forEach(ve=>{(ve.score??0)>rC&&(ae.save(),ae.shadowColor=Ye,ae.shadowBlur=15,ae.fillStyle=Ze,ae.beginPath(),ae.arc(ve.x,ve.y,6,0,2*Math.PI),ae.fill(),ae.restore())});const B=lt.find(ve=>ve.name==="right_hip"),Z=lt.find(ve=>ve.name==="right_knee"),te=lt.find(ve=>ve.name==="right_ankle");if(B&&Z&&te&&(B.score??0)>.3&&(Z.score??0)>.3&&(te.score??0)>.3){const ve=Math.atan2(te.y-Z.y,te.x-Z.x)-Math.atan2(B.y-Z.y,B.x-Z.x);let we=Math.abs(ve*180/Math.PI);we>180&&(we=360-we),we=Math.round(we),Ae=we,ae.save(),ae.font="bold 24px Arial",ae.fillStyle="yellow",ae.strokeStyle="black",ae.lineWidth=4,ae.strokeText(`${we}°`,Z.x+20,Z.y-20),ae.fillText(`${we}°`,Z.x+20,Z.y-20),ae.restore(),Be=(B.y-te.y)/B.y<F}}}),y(Ae),_(Be),Ae!==null&&Ae>=A?S(!0):S(!1)}g.current=requestAnimationFrame(me)}catch{g.current=requestAnimationFrame(me)}};b.useEffect(()=>{if(s&&c&&p)g.current=requestAnimationFrame(me);else if(g.current&&(cancelAnimationFrame(g.current),g.current=null),f.current&&!s){const oe=f.current.getContext("2d");oe&&oe.clearRect(0,0,f.current.width,f.current.height)}return()=>{g.current&&cancelAnimationFrame(g.current)}},[s,c,p]),b.useEffect(()=>{x!==null&&ee(oe=>oe===null?x:oe+(x-oe)*Pe)},[x]);const[ie,Q]=b.useState(!1);return b.useEffect(()=>{!s||a||(x!==null&&x>=j&&Q(!0),ie&&x!==null&&x<j&&(z(!0),Q(!1),L==="right"?(U(C),setTimeout(()=>{M("left"),k(0),z(!1),Q(!1),R(!0),setTimeout(()=>R(!1),3e3)},2500)):(xe(C),setTimeout(()=>{De(!0),r(!1),z(!1)},2500))))},[x,ie,s,a,L,C]),u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-indigo-900 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/challenges"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Balance Beam Breaker"})}),u.jsx("div",{className:"w-16"})," "]})}),u.jsxs("div",{className:"pt-10 w-full h-full flex-1 flex flex-col items-center justify-center",children:[u.jsx(ko,{children:e&&u.jsx(X.div,{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-50 p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-purple-700 max-w-lg text-center",initial:{scale:.9,y:20},animate:{scale:1,y:0},transition:{delay:.1,duration:.3},children:[u.jsx(ea,{className:"text-purple-400 w-16 h-16 mx-auto mb-4"}),u.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500 mb-4",children:"Balance Beam Breaker"}),u.jsxs("p",{className:"text-purple-200 text-lg mb-6",children:[u.jsx("strong",{children:"Goal:"})," Hold a perfect side-kick for as long as possible. Keep your leg straight and high, and maintain your balance!"]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/challenges"),variant:"outline",className:"text-purple-300 border-purple-600 hover:bg-purple-700 hover:text-white",children:"Back to Challenges"}),u.jsx(Se,{onClick:Re,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold",children:"Let's Go!"})]})]})})}),u.jsxs("div",{className:"absolute inset-0 w-full h-full z-0",children:[u.jsx("video",{ref:h,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),u.jsx("canvas",{ref:f,className:"absolute inset-0 w-full h-full"}),s&&a&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[u.jsx("div",{className:"text-yellow-400 text-3xl sm:text-5xl font-bold mb-2 bg-black/40 px-4 py-2 rounded-xl",children:"Get ready to side kick and hold!"}),u.jsx("div",{className:"text-yellow-400 text-7xl sm:text-9xl font-bold bg-black/40 px-8 py-4 rounded-2xl",children:i})]})]}),s&&!a&&!Ce&&u.jsxs("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-xl flex flex-col items-center",children:[u.jsxs("div",{className:"w-full px-8",children:[u.jsx("div",{className:"relative w-full h-6 rounded-full bg-gradient-to-r from-red-500 via-yellow-400 to-green-500 shadow-lg",children:fe!==null&&u.jsx("div",{className:"absolute top-0 h-6 w-1.5 rounded bg-white shadow transition-all duration-200",style:{left:`calc(${(Math.max(120,Math.min(180,fe))-120)/60*100}% - 3px)`,minWidth:6,maxWidth:12}})}),u.jsxs("div",{className:"flex justify-between text-xs text-white mt-1 px-1",children:[u.jsx("span",{children:"Not Straight"}),u.jsx("span",{children:"Almost"}),u.jsx("span",{children:"Perfect"})]})]}),u.jsx("div",{className:"mt-2 text-lg font-bold text-green-300 drop-shadow",children:v?`In perfect form! Time: ${C.toFixed(1)}s`:"Hold your leg straighter!"}),u.jsx("div",{className:"mt-1 text-base text-white font-semibold",children:L==="right"?"Right Leg":"Left Leg"})]}),$&&u.jsxs("div",{className:"fixed top-32 left-1/2 transform -translate-x-1/2 z-50 bg-black/80 text-white text-2xl font-bold px-8 py-4 rounded-2xl shadow-lg border-2 border-purple-600",children:["Side kick with your ",L==="right"?"right":"left"," foot and hold!"]}),s&&!a&&!Ce&&T&&u.jsx("div",{className:"fixed top-48 left-1/2 transform -translate-x-1/2 z-50 bg-red-700/90 text-white text-xl font-semibold px-6 py-3 rounded-xl shadow-lg border border-red-300",children:"Keep your foot up and hold it a bit longer!"}),q&&u.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-black/90 text-yellow-300 text-2xl font-bold px-10 py-6 rounded-2xl shadow-lg border-2 border-yellow-400",children:L==="right"?"Switch to your left leg!":"Challenge complete!"}),Ce&&u.jsx("div",{className:"fixed inset-0 flex flex-col items-center justify-center z-50 bg-black/80",children:u.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-purple-700 max-w-lg text-center",children:[u.jsx("h2",{className:"text-3xl font-bold text-yellow-400 mb-4",children:"Challenge Complete!"}),u.jsxs("div",{className:"text-xl text-white mb-6 space-y-2",children:[u.jsxs("p",{children:["Right Leg: ",re.toFixed(1),"s in green"]}),u.jsxs("p",{children:["Left Leg: ",G.toFixed(1),"s in green"]}),u.jsxs("p",{className:"text-yellow-400 font-bold mt-4",children:["Total: ",(re+G).toFixed(1),"s"]})]}),u.jsx(Se,{onClick:Re,className:"bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-8 rounded-lg text-lg shadow-lg hover:shadow-yellow-500/50 transition-all duration-300 ease-in-out",children:"Try Again"})]})})]})]})},GGe=({onClose:t})=>{const[e,n]=b.useState(1),[s,r]=b.useState({}),[i,o]=b.useState(""),[a,l]=b.useState(null),[c,d]=b.useState(!1),[h,f]=b.useState(null),[p,m]=b.useState({}),[g,x]=b.useState({}),[y,v]=b.useState({}),[S,C]=b.useState(new Set),[k,T]=b.useState([]),[_,$]=b.useState(null),[R,A]=b.useState(""),[j,F]=b.useState(""),L=b.useRef(null),M=b.useRef(null);zt.useEffect(()=>{const fe=localStorage.getItem("shifuSaysCustomPoses");if(fe)try{r(JSON.parse(fe))}catch(ee){console.error("Error loading saved poses:",ee)}},[]),zt.useEffect(()=>{(async()=>{try{const ee={modelType:Bf.modelType.SINGLEPOSE_LIGHTNING},Pe=await i8(Wa.MoveNet,ee);f(Pe)}catch(ee){console.error("Error initializing pose detector:",ee)}})()},[]);const q=b.useCallback(()=>{const fe=M.current;if(!fe||!a||k.length===0)return;const ee=fe.getContext("2d");if(!ee)return;const Pe=new Image;Pe.onload=()=>{const Re=Pe.width/Pe.height,ce=400,me=ce/Re;fe.width=ce,fe.height=me,ee.drawImage(Pe,0,0,ce,me);const ie=ce/Pe.width,Q=me/Pe.height;k.forEach(ae=>{if(ae.score>.3){const Ae=ae.x*ie,Be=ae.y*Q;ee.fillStyle="#FFD700",ee.strokeStyle="#000000",ee.lineWidth=2,ee.beginPath(),ee.arc(Ae,Be,6,0,2*Math.PI),ee.fill(),ee.stroke(),ee.fillStyle="#FFFFFF",ee.strokeStyle="#000000",ee.lineWidth=3,ee.font="12px Arial",ee.textAlign="center",ee.strokeText(ae.name.replace("_"," "),Ae,Be-10),ee.fillText(ae.name.replace("_"," "),Ae,Be-10)}}),[["left_shoulder","left_elbow","left_wrist"],["right_shoulder","right_elbow","right_wrist"],["left_hip","left_knee","left_ankle"],["right_hip","right_knee","right_ankle"],["left_shoulder","left_hip","left_knee"],["right_shoulder","right_hip","right_knee"]].forEach(([ae,Ae,Be])=>{const Xe=k.find(je=>je.name===ae),lt=k.find(je=>je.name===Ae),Me=k.find(je=>je.name===Be);Xe&&lt&&Me&&Xe.score>.3&&lt.score>.3&&Me.score>.3&&(ee.strokeStyle="#FF6B6B",ee.lineWidth=2,ee.beginPath(),ee.moveTo(Xe.x*ie,Xe.y*Q),ee.lineTo(lt.x*ie,lt.y*Q),ee.lineTo(Me.x*ie,Me.y*Q),ee.stroke())})},Pe.src=a},[a,k]);zt.useEffect(()=>{q()},[q]);const z=b.useCallback((fe,ee,Pe)=>{const Re={x:fe.x-ee.x,y:fe.y-ee.y},ce={x:Pe.x-ee.x,y:Pe.y-ee.y},me=Re.x*ce.x+Re.y*ce.y,ie=Math.sqrt(Re.x*Re.x+Re.y*Re.y),Q=Math.sqrt(ce.x*ce.x+ce.y*ce.y);if(ie===0||Q===0)return 0;const oe=me/(ie*Q),ae=Math.max(-1,Math.min(1,oe));return Math.acos(ae)*(180/Math.PI)},[]),re=b.useCallback(async fe=>{var Pe;const ee=(Pe=fe.target.files)==null?void 0:Pe[0];if(!(!ee||!h)){d(!0);try{const Re=URL.createObjectURL(ee);l(Re);const ce=new Image;ce.onload=async()=>{try{const me=await h.estimatePoses(ce);if(me.length>0){const Q=me[0].keypoints;T(Q);const oe=mt=>Q.find(It=>It.name===mt),ae={},Ae={},Be={},Xe=oe("left_hip"),lt=oe("right_hip"),Me=oe("left_knee"),je=oe("right_knee"),Ze=oe("left_ankle"),Ye=oe("right_ankle"),Ie=oe("left_shoulder"),B=oe("right_shoulder"),Z=oe("left_elbow"),te=oe("right_elbow"),ve=oe("left_wrist"),we=oe("right_wrist");Xe&&Me&&Ze&&(ae.leftKneeAngle=z(Xe,Me,Ze)),lt&&je&&Ye&&(ae.rightKneeAngle=z(lt,je,Ye)),Ie&&Z&&ve&&(ae.leftElbowAngle=z(Ie,Z,ve)),B&&te&&we&&(ae.rightElbowAngle=z(B,te,we)),Ie&&Xe&&Me&&(ae.leftHipAngle=z(Ie,Xe,Me)),B&&lt&&je&&(ae.rightHipAngle=z(B,lt,je));const de=Xe&&lt?(Xe.y+lt.y)/2:0,Ee=Ie&&B?(Ie.y+B.y)/2:0;Ze&&de&&(Ae.leftAnkleHeight=de-Ze.y),Ye&&de&&(Ae.rightAnkleHeight=de-Ye.y),ve&&Ee&&(Ae.leftWristHeight=Ee-ve.y),we&&Ee&&(Ae.rightWristHeight=Ee-we.y),Ze&&Ye&&(Be.stanceWidth=Math.abs(Ze.x-Ye.x)),Ie&&B&&(Be.shoulderWidth=Math.abs(Ie.x-B.x)),m(ae),x(Ae),v(Be)}}catch(me){console.error("Error detecting pose:",me)}finally{d(!1)}},ce.src=Re}catch(Re){console.error("Error uploading image:",Re),d(!1)}}},[h,z]),U=()=>{if(R&&j){const fe=parseFloat(j);isNaN(fe)||(m(ee=>({...ee,[R]:fe})),A(""),F(""))}},G=(fe,ee)=>{const Pe=parseFloat(ee);isNaN(Pe)||(m(Re=>({...Re,[fe]:Pe})),$(null))},xe=fe=>{m(ee=>{const Pe={...ee};return delete Pe[fe],Pe}),C(ee=>{const Pe=new Set(ee);return Pe.delete(fe),Pe})},Ce=b.useCallback(async()=>{if(!a){alert("Please upload an image first!");return}const fe=i.trim()||`Shifu Says Pose ${e}`,ee={id:e,name:fe,imageUrl:a,angles:{...p},heights:{...g},measurements:{...y},keyAngles:Array.from(S),timestamp:new Date().toISOString()},Pe={...s,[e]:ee};r(Pe),localStorage.setItem("shifuSaysCustomPoses",JSON.stringify(Pe));try{(await fetch(`/api/shifu-says/poses/1/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)})).ok?(console.log("Saved custom pose to database:",ee),alert(`✅ Saved "${fe}" successfully!`)):(console.error("Failed to save to database"),alert(`✅ Saved "${fe}" locally! (Database save failed)`))}catch(Re){console.error("Error saving to database:",Re),alert(`✅ Saved "${fe}" locally!`)}},[e,i,a,p,g,y,S,s]),De=b.useCallback(fe=>{const ee=s[fe];ee&&(l(ee.imageUrl),m(ee.angles),x(ee.heights),v(ee.measurements),C(new Set(ee.keyAngles)),n(fe),o(ee.name))},[s]);return u.jsx(u.Fragment,{children:u.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:u.jsxs(X.div,{className:"bg-gray-900 rounded-2xl p-6 w-full max-w-6xl max-h-[95vh] overflow-y-auto border border-yellow-500/30",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-xl flex items-center justify-center",children:u.jsx(vb,{className:"h-6 w-6 text-black"})}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-yellow-400 via-amber-400 to-yellow-500 bg-clip-text text-transparent",children:"Shifu Says Pose Creator"}),u.jsx("p",{className:"text-gray-400 text-lg",children:"Upload images, analyze poses, and create custom challenges"})]})]}),t&&u.jsx(Se,{variant:"ghost",onClick:t,className:"text-gray-400 hover:text-white hover:bg-red-500/20 rounded-xl p-3",children:u.jsx(Lh,{className:"h-5 w-5"})})]}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-800/40 rounded-xl p-4 border border-yellow-500/20",children:[u.jsx("label",{className:"block text-yellow-300 font-bold mb-3 text-sm",children:"🎯 Pose Slot"}),u.jsx("select",{value:e,onChange:fe=>n(Number(fe.target.value)),className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm mb-3",children:[1,2,3,4,5,6,7,8,9,10].map(fe=>u.jsxs("option",{value:fe,children:["Pose ",fe," ",s[fe]?"✓":""]},fe))}),u.jsx("label",{className:"block text-yellow-300 font-bold mb-2 text-sm",children:"📝 Pose Name"}),u.jsx("input",{type:"text",value:i,onChange:fe=>o(fe.target.value),placeholder:`Shifu Says Pose ${e}`,className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"})]}),u.jsxs("div",{className:"bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-xl p-4 border border-blue-500/30",children:[u.jsxs("label",{className:"block text-blue-300 font-bold mb-3 text-sm flex items-center gap-2",children:[u.jsx(bb,{className:"h-4 w-4"}),"📸 Upload Pose Image"]}),u.jsx("input",{ref:L,type:"file",accept:"image/*",onChange:re,className:"hidden"}),u.jsx(Se,{onClick:()=>{var fe;return(fe=L.current)==null?void 0:fe.click()},className:"w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-3",disabled:c,children:c?"Analyzing Pose...":"Choose Image"}),a&&u.jsx("div",{className:"mt-3 text-xs text-green-400",children:"✅ Image analyzed - joints detected and angles calculated"})]}),u.jsxs("div",{className:"bg-gradient-to-br from-orange-900/20 to-red-900/20 rounded-xl p-4 border border-orange-500/30",children:[u.jsxs("label",{className:"block text-orange-300 font-bold mb-3 text-sm flex items-center gap-2",children:[u.jsx(JA,{className:"h-4 w-4"}),"➕ Add Custom Angle"]}),u.jsx("input",{type:"text",value:R,onChange:fe=>A(fe.target.value),placeholder:"Angle name (e.g., customShoulderAngle)",className:"w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm mb-2"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("input",{type:"number",value:j,onChange:fe=>F(fe.target.value),placeholder:"Degrees",className:"flex-1 bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-white text-sm"}),u.jsx(Se,{onClick:U,size:"sm",className:"bg-orange-600 hover:bg-orange-700",disabled:!R||!j,children:u.jsx(JA,{className:"h-4 w-4"})})]})]}),u.jsx("div",{className:"space-y-3",children:u.jsxs(Se,{onClick:Ce,className:"w-full bg-gradient-to-r from-yellow-500 via-amber-500 to-yellow-600 hover:from-yellow-600 hover:via-amber-600 hover:to-yellow-700 text-black font-bold text-sm py-3 rounded-lg",disabled:!a,children:[u.jsx(LV,{className:"h-4 w-4 mr-2"}),'💾 Save "',i||`Pose ${e}`,'"']})}),u.jsxs("div",{className:"bg-gradient-to-br from-purple-900/20 to-blue-900/20 rounded-xl p-4 border border-purple-500/30",children:[u.jsx("h3",{className:"text-purple-300 font-bold mb-3 text-sm",children:"Quick Load Saved Poses"}),u.jsx("div",{className:"grid grid-cols-5 gap-2",children:[1,2,3,4,5,6,7,8,9,10].map(fe=>{var ee;return u.jsx(Se,{size:"sm",variant:s[fe]?"default":"outline",onClick:()=>De(fe),disabled:!s[fe],className:"text-xs py-2 px-2 h-10",title:(ee=s[fe])==null?void 0:ee.name,children:fe},fe)})})]})]}),u.jsx("div",{children:u.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-800/40 rounded-xl p-4 border border-yellow-500/20",children:[u.jsx("label",{className:"block text-yellow-300 font-bold text-sm flex items-center gap-2 mb-3",children:"📷 Pose Image with Joints"}),u.jsx("div",{className:"border border-gray-600 rounded-lg overflow-hidden bg-gray-800 aspect-square flex items-center justify-center",children:a?u.jsx("canvas",{ref:M,className:"max-w-full max-h-full object-contain"}):u.jsxs("div",{className:"text-gray-500 text-center p-8",children:[u.jsx(bb,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"Upload an image to see joints and angles"})]})}),a&&u.jsx("div",{className:"mt-3 text-xs text-gray-400 text-center",children:"🟡 Yellow dots = detected joints • 🔴 Red lines = angle connections"})]})}),u.jsxs("div",{className:"space-y-4",children:[Object.keys(p).length>0&&u.jsxs("div",{className:"bg-gradient-to-br from-green-900/20 to-emerald-900/20 rounded-xl p-4 border border-green-500/30",children:[u.jsxs("h3",{className:"text-green-300 font-bold mb-3 text-sm flex items-center gap-2",children:[u.jsx(vb,{className:"h-4 w-4"}),"🎯 Joint Angles Table"]}),u.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Object.entries(p).map(([fe,ee])=>u.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-800/50 rounded-lg",children:[u.jsxs("div",{className:"flex-1",children:[u.jsx("span",{className:"text-white font-medium text-sm block",children:fe.replace(/([A-Z])/g," $1")}),_===fe?u.jsx("input",{type:"number",defaultValue:ee.toFixed(1),onBlur:Pe=>G(fe,Pe.target.value),onKeyPress:Pe=>Pe.key==="Enter"&&G(fe,Pe.target.value),className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-xs w-20 mt-1",autoFocus:!0}):u.jsxs("div",{className:"text-green-300 font-mono text-sm",children:[ee.toFixed(1),"°"]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",className:"w-4 h-4 text-yellow-500 rounded",checked:S.has(fe),onChange:Pe=>{const Re=new Set(S);Pe.target.checked?Re.add(fe):Re.delete(fe),C(Re)},title:"Mark as key angle"}),S.has(fe)&&u.jsx("span",{className:"text-yellow-400 text-xs",children:"⭐"}),u.jsx(Se,{size:"sm",variant:"ghost",onClick:()=>$(_===fe?null:fe),className:"h-6 w-6 p-1 text-blue-400 hover:bg-blue-400/20",children:u.jsx(Sk,{className:"h-3 w-3"})}),u.jsx(Se,{size:"sm",variant:"ghost",onClick:()=>xe(fe),className:"h-6 w-6 p-1 text-red-400 hover:bg-red-400/20",children:u.jsx(yu,{className:"h-3 w-3"})})]})]},fe))}),u.jsxs("div",{className:"mt-3 text-xs text-gray-400 space-y-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"checkbox",className:"w-3 h-3",checked:!0,readOnly:!0}),u.jsx("span",{children:"⭐ = Key angle (important for pose matching)"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Sk,{className:"h-3 w-3 text-blue-400"}),u.jsx("span",{children:"= Edit angle value"})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(yu,{className:"h-3 w-3 text-red-400"}),u.jsx("span",{children:"= Delete angle"})]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[Object.keys(g).length>0&&u.jsxs("div",{className:"bg-blue-900/20 rounded-xl p-3 border border-blue-500/30",children:[u.jsx("strong",{className:"text-blue-400 text-xs flex items-center gap-2 mb-2",children:"📏 Heights"}),u.jsx("div",{className:"space-y-1",children:Object.entries(g).map(([fe,ee])=>u.jsxs("div",{className:"flex justify-between text-xs",children:[u.jsx("span",{className:"text-gray-300",children:fe.replace(/([A-Z])/g," $1")}),u.jsxs("span",{className:"font-mono text-blue-300",children:[ee.toFixed(1),"px"]})]},fe))})]}),Object.keys(y).length>0&&u.jsxs("div",{className:"bg-purple-900/20 rounded-xl p-3 border border-purple-500/30",children:[u.jsx("strong",{className:"text-purple-400 text-xs flex items-center gap-2 mb-2",children:"📐 Measurements"}),u.jsx("div",{className:"space-y-1",children:Object.entries(y).map(([fe,ee])=>u.jsxs("div",{className:"flex justify-between text-xs",children:[u.jsx("span",{className:"text-gray-300",children:fe.replace(/([A-Z])/g," $1")}),u.jsxs("span",{className:"font-mono text-purple-300",children:[ee.toFixed(1),"px"]})]},fe))})]})]}),Object.keys(p).length===0&&!c&&u.jsxs("div",{className:"bg-gray-800/40 rounded-xl p-4 border border-gray-600/30",children:[u.jsx("h3",{className:"text-gray-300 font-bold mb-2 text-sm",children:"📋 Instructions"}),u.jsxs("div",{className:"text-gray-400 text-xs space-y-2",children:[u.jsx("p",{children:"1. Select a pose slot (1-10) and name your pose"}),u.jsx("p",{children:"2. Upload a clear martial arts pose image"}),u.jsx("p",{children:"3. Review detected joints and calculated angles"}),u.jsx("p",{children:"4. Add missing angles manually if needed"}),u.jsx("p",{children:'5. Mark important angles as "key" with ⭐'}),u.jsx("p",{children:"6. Edit angle values by clicking the edit button"}),u.jsx("p",{children:"7. Save your custom pose"})]})]})]})]})]})})})},KGe=()=>{Po();const[t,e]=b.useState(!1),[n,s]=b.useState("waiting"),[r,i]=b.useState(null),[o,a]=b.useState(null),[l,c]=b.useState(!1),[d,h]=b.useState(!1),[f,p]=b.useState(!1),[m,g]=b.useState(0),[x,y]=b.useState(1),[v,S]=b.useState(3.5),[C,k]=b.useState(!1),[T,_]=b.useState(""),[$,R]=b.useState(!1),[A,j]=b.useState("No Pose"),[F,L]=b.useState(!0),[M,q]=b.useState(!0),[z,re]=b.useState(!1),[U,G]=b.useState(!1),[xe,Ce]=b.useState(""),[De,fe]=b.useState("No Pose"),[ee,Pe]=b.useState(0),Re=b.useRef(null),ce=b.useRef(null),[me,ie]=b.useState(null),[Q,oe]=b.useState(null),ae=b.useRef(null),Ae=b.useRef(0),Be=3,Xe=b.useRef(null),lt=b.useRef(!1),Me=b.useRef("waiting"),je=b.useRef(!1),Ze=b.useRef(null),[Ye,Ie]=b.useState([]);b.useState(0);const B=pe=>{console.log("DEBUG:",pe),Ie($e=>[...$e.slice(-4),`${new Date().toLocaleTimeString()}: ${pe}`])},Z=(pe,$e)=>{if($e===1)return pe?4:3.5;const Te={2:[2,2.5],3:[1.5,2],4:[1.2,1.5],5:[1,1.2],6:[.9,1],7:[.8,.9],8:[.7,.8],9:[.6,.7],10:[.5,.5]},Je=Math.min($e,10),[He,it]=Te[Je]||[.5,.5],Ot=pe?it:He;return console.log(`🕐 NEW DIFFICULTY: Level ${$e}, ${pe?"Shifu Says":"Normal"} = ${Ot}s`),Ot},te=pe=>{console.log(`💀 GAME OVER: ${pe} | Final Score: ${m}`);const $e=new Audio("/sounds/incorrect.m4a");$e.volume=.8,$e.play().then(()=>{console.log("❌ Failure sound played")}).catch(Te=>{console.error(`🚨 Error playing failure sound: ${Te}`)}),Ze.current&&(clearTimeout(Ze.current),Ze.current=null),s("gameover"),Me.current="gameover",_(pe),k(!0),p(!0),je.current=!0,R(!1),j("No Pose")},ve=()=>{const pe=Z(lt.current,x);console.log(`⏰ TIMER SETUP: Level ${x}, ${lt.current?"Shifu Says":"Normal"} command`),console.log(`⏰ EXACT TIMING: Starting ${pe}s timer for move: "${Xe.current}"`),Ze.current&&clearTimeout(Ze.current),S(pe);let $e=pe;const Te=setInterval(()=>{$e-=.1,S(Math.max(0,$e)),$e<=0&&(clearInterval(Te),we())},100);Ze.current=Te,console.log(`⏰ TIMER ACTIVE: ${pe}s countdown started!`)},we=()=>{if(n==="gameover"||Me.current==="gameover"){console.log("🛑 BLOCKED: handleMoveTimeout called but game is over!");return}console.log(`⏰ TIMER EXPIRED! | Move: "${Xe.current}" | isShifuSays: ${lt.current} | User moved: ${je.current}`),lt.current?te(`You didn't do "${Xe.current}" when Shifu said to!`):(console.log(`✅ CORRECT! User correctly ignored "${Xe.current}" (no Shifu says)`),de())},de=()=>{if(n==="gameover"||Me.current==="gameover"){console.log("🛑 BLOCKED: advanceToNextMove called but game is over!");return}console.log(`🎯 ADVANCING TO NEXT MOVE | Current Score: ${m}`);const pe=new Audio("/sounds/correct.m4a");pe.volume=.8,pe.play().then(()=>{console.log("✅ Success sound played")}).catch($e=>{console.error(`🚨 Error playing success sound: ${$e}`)}),g($e=>{const Te=$e+1;console.log(`📊 Score increased from ${$e} to: ${Te}`);const Je=Math.floor(Te/5)+1;return Je>x&&Je<=10&&(y(Je),console.log(`🎉 LEVEL UP! From ${x} to ${Je} (Score: ${Te})`),console.log(`🎯 NEW TIMINGS: Normal=${Z(!1,Je)}s, Shifu Says=${Z(!0,Je)}s`),setTimeout(()=>{B(`Level Up! Now Level ${Je} - Timing: ${Z(!0,Je)}s`)},100)),Te}),h(!0),setTimeout(()=>h(!1),1e3),setTimeout(()=>{jt()},1e3)};b.useEffect(()=>{console.log(`📝 🎯 CURRENTMOVE STATE CHANGED: "${o}"`),console.log(`📝 🎯 UI should now display: "${l?"Shifu says: ":""}${o}"`)},[o]),b.useEffect(()=>{console.log(`📝 moveMatched state changed to: ${f} | Command: "${o}" | Current Pose: "${De}"`)},[f]),b.useEffect(()=>{console.log(`📝 gameState changed to: "${n}"`)},[n]),b.useEffect(()=>{console.log(`📝 🎯 SHIFUSAYS STATE CHANGED: ${l}`),console.log(`📝 🎯 Full command display should be: "${l?"Shifu says: ":""}${o}"`)},[l]);const Ee=["Left High Block","Right High Block","Left Mid Block","Right Mid Block","Left Punch","Right Punch","Left Kick","Right Kick","X Block"],mt=(pe,$e)=>`/sounds/${$e?"shifu_says":"normal"}/${$e?"Shifu Says":"LMNT Shifu"} ${pe}.mp3`,It=pe=>{const Je=`/poses/${{"Left High Block":"ctlefthighblock.png","Right High Block":"ctrighthighblock.png","Left Mid Block":"ctleftmidblock.png","Right Mid Block":"ctrightmidblock.png","Left Punch":"ctleftpunch.png","Right Punch":"ctrightpunch.png","Left Kick":"ctleftkick.png","Right Kick":"ctrightkick.png","X Block":"ctxblock.png"}[pe]}`;return console.log(`🖼️ Pose image mapping: "${pe}" -> ${Je}`),Je},jt=()=>{console.log(`🚨 selectRandomMove() STARTING! | Before: currentMove="${o}" | gameState="${n}"`),p(!1),je.current=!1,console.log("🚨 setMoveMatched(false) called + moveMatchedRef.current = false");const pe=Math.floor(Math.random()*Ee.length),$e=Ee[pe];console.log(`🚨 Random move selected: "${$e}" (index ${pe})`);let Te;if(ee>=2?(Te=!0,console.log(`🚨 FORCED Shifu Says: Too many non-Shifu commands (${ee}) - resetting streak`),Pe(0)):(Te=Math.random()<.8,console.log(`🚨 Shifu Says flag: ${Te} (80% chance)`),Te?Pe(0):(Pe(it=>it+1),console.log(`🚨 Non-Shifu command #${ee+1} in a row`))),console.log(`🚨 ABOUT TO SET STATE: setCurrentMove("${$e}")`),a($e),Xe.current=$e,console.log(`🚨 setCurrentMove("${$e}") called + currentMoveRef.current = "${$e}"`),console.log(`🚨 ABOUT TO SET STATE: setIsShifuSays(${Te})`),c(Te),lt.current=Te,console.log(`🚨 setIsShifuSays(${Te}) called + isShifuSaysRef.current = ${Te}`),console.log(`🔥 BACKEND IMMEDIATELY SYNCED: currentMoveRef="${Xe.current}", isShifuSaysRef=${lt.current}`),z){const it=It($e);console.log(`🖼️ POSE POPUP: Showing popup for "${$e}" with image: ${it}`),Ce(it),G(!0),console.log("🖼️ POSE POPUP: showPosePopup set to true"),setTimeout(()=>{console.log("🖼️ POSE POPUP: Hiding popup after 1 second"),G(!1)},1e3)}else console.log(`🖼️ POSE POPUP: Pose images are disabled (showPoseImages = ${z})`);const Je=mt($e,Te);console.log(`🚨 Audio path: ${Je}`);const He=new Audio(Je);He.volume=.8,R(!0),He.addEventListener("loadedmetadata",()=>{const it=He.duration,Ot=Z(Te,x),Yt=it*1e3;console.log(`🎵 FIXED TIMING: Audio=${it.toFixed(2)}s, Response=${Ot}s, Total=${(it+Ot).toFixed(2)}s`),setTimeout(()=>{console.log(`🎵 Audio finished (${it.toFixed(2)}s), starting ${Ot}s response timer now...`),R(!1),ve()},Yt)}),He.addEventListener("error",()=>{const it=Z(Te,x),Ot=3e3;console.warn(`⚠️ Could not get audio duration, using fallback: 3s audio + ${it}s response = ${(3+it).toFixed(2)}s total`),setTimeout(()=>{console.log(`🎵 Fallback timer starting ${it}s response timer...`),R(!1),ve()},Ot)}),He.play().then(()=>{console.log(`✅ Audio started playing successfully: ${Je}`)}).catch(it=>{console.error(`🚨 ERROR playing audio: ${it}`),R(!1),it.name==="NotAllowedError"?alert(`Browser blocked audio autoplay! Please:
1. Click the "Test Audio" button first
2. Make sure your volume is up
3. Try starting the game again`):alert(`Audio playback failed: ${it.message}. Please check your audio settings and try again.`),Z(Te,x),setTimeout(()=>{ve()},2e3)}),console.log("🚨 selectRandomMove() COMPLETED! Audio playing... Timer will start after audio finishes + 2s")};b.useEffect(()=>{(async()=>{try{const $e=await go("lightning");oe($e)}catch($e){console.error("Error initializing pose detection:",$e)}})()},[]),b.useEffect(()=>((async()=>{if(Q&&(r===1||n==="playing"))try{const $e=await navigator.mediaDevices.getUserMedia({video:!0});Re.current&&(Re.current.srcObject=$e,Re.current.onloadedmetadata=()=>{ce.current&&Re.current&&(ce.current.width=Re.current.videoWidth,ce.current.height=Re.current.videoHeight)}),ie($e),hs()}catch($e){console.error("Error accessing camera:",$e)}})(),()=>{me&&me.getTracks().forEach($e=>$e.stop()),ae.current&&cancelAnimationFrame(ae.current)}),[Q,r,n]);const hs=async()=>{var pe,$e;if(Ae.current=(Ae.current+1)%Be,Ae.current!==0){ae.current=requestAnimationFrame(hs);return}if(Re.current&&ce.current&&Q&&Re.current.readyState>=2&&Re.current.videoWidth>0)try{const Te=await pr(Re.current,1,.3),Je=ce.current.getContext("2d");if(Je)if(Je.clearRect(0,0,ce.current.width,ce.current.height),F&&Je.drawImage(Re.current,0,0,ce.current.width,ce.current.height),Te.length>0){const He=Te[0],it=is(He.keypoints);if(fe(it),j(it),Ae.current===0&&console.log(`🎯 POSE: "${it}" | Game: "${n}" | Command: "${o}"`),Me.current==="playing"){const Ot=((pe=document.querySelector('[data-testid="current-command"]'))==null?void 0:pe.textContent)||"NOT_FOUND",Yt=(($e=document.querySelector('[data-testid="current-pose"]'))==null?void 0:$e.textContent)||"NOT_FOUND";console.log("🔍 MATCH CHECK:"),console.log(`   React State: gameState="${n}" | Expected="${o}" | Detected="${it}" | Matched=${f}`),console.log(`   Ref Values:  gameStateRef="${Me.current}" | currentMoveRef="${Xe.current}" | moveMatchedRef=${je.current}`),console.log(`   Frontend DOM: Command="${Ot}" | Pose="${Yt}"`),Ot!==o&&console.log(`⚠️  SYNC WARNING: Frontend command "${Ot}" != React state "${o}"`),Ot!==Xe.current&&console.log(`⚠️  SYNC WARNING: Frontend command "${Ot}" != Ref value "${Xe.current}"`),Yt!==it&&console.log(`⚠️  SYNC WARNING: Frontend pose "${Yt}" != React state "${it}"`);const On=A==="No Pose"&&it!=="No Pose",en=it!=="No Pose"&&Xe.current&&it===Xe.current,An=it!=="No Pose";if(console.log(`🔍 MOVEMENT CHECK: moveMatched=${je.current} | audioPlaying=${$} | hasMovedFromRest=${On} | hasMovedToSpecificPose=${en}`),!je.current&&(On||en||An&&!$)){if(console.log(`🎉 USER MOVED! From: "${A}" | To: "${it}" | Expected: "${Xe.current}" | isShifuSays: ${lt.current}`),Me.current==="gameover"){console.log("🛑 BLOCKED: Movement detected but game is over! Ignoring.");return}lt.current?it===Xe.current?(console.log(`✅ CORRECT! User did "${it}" when Shifu said to!`),p(!0),je.current=!0,Ze.current&&(clearTimeout(Ze.current),Ze.current=null),de()):console.log(`⚠️ IGNORE: User did "${it}" but Shifu said "${Xe.current}" - waiting for correct move or timeout`):(console.log(`❌ WRONG! User moved when Shifu didn't say to! Detected: "${it}"`),p(!0),je.current=!0,Ze.current&&(clearTimeout(Ze.current),Ze.current=null),te(`You moved when Shifu didn't say to! You did "${it}" but should have stayed still.`))}}fn(Je,He.keypoints)}else fe("No Pose"),Ae.current===0&&console.log(`🎯 POSE: "No Pose" | Game: "${n}" | Command: "${o}"`),j("No Pose"),(n==="playing"||Me.current==="playing")&&(console.log(`🔍 MATCH CHECK: gameState="${n}" | Expected="${o}" | Detected="No Pose" | Matched=${f}`),console.log(`🔍 REF CHECK: gameStateRef="${Me.current}" | currentMoveRef="${Xe.current}" | moveMatchedRef=${je.current}`))}catch(Te){console.error("Error detecting poses:",Te)}ae.current=requestAnimationFrame(hs)},fn=(pe,$e)=>{if(!M)return;const Te=He=>$e.find(it=>it.name===He&&it.score>.3);pe.strokeStyle="rgba(0, 255, 255, 0.8)",pe.lineWidth=3,Ac().forEach(([He,it])=>{const Ot=Te(He),Yt=Te(it);Ot&&Yt&&(pe.beginPath(),pe.moveTo(Ot.x,Ot.y),pe.lineTo(Yt.x,Yt.y),pe.stroke())}),$e.forEach(He=>{if(He.score>.3){let it="rgba(255, 255, 0, 0.9)";He.name.includes("shoulder")||He.name.includes("hip")?it="rgba(255, 100, 100, 0.9)":He.name.includes("elbow")||He.name.includes("wrist")?it="rgba(100, 255, 100, 0.9)":He.name.includes("knee")||He.name.includes("ankle")?it="rgba(100, 100, 255, 0.9)":(He.name.includes("eye")||He.name.includes("ear")||He.name.includes("nose"))&&(it="rgba(255, 255, 255, 0.9)"),pe.fillStyle=it,pe.beginPath(),pe.arc(He.x,He.y,6,0,2*Math.PI),pe.fill(),pe.strokeStyle="rgba(0, 0, 0, 0.8)",pe.lineWidth=2,pe.stroke()}})},dt=(pe,$e,Te)=>{if(!pe||!$e||!Te)return 0;const Je={x:pe.x-$e.x,y:pe.y-$e.y},He={x:Te.x-$e.x,y:Te.y-$e.y},it=Je.x*He.x+Je.y*He.y,Ot=Math.sqrt(Je.x*Je.x+Je.y*Je.y),Yt=Math.sqrt(He.x*He.x+He.y*He.y),On=it/(Ot*Yt),en=Math.max(-1,Math.min(1,On));return Math.acos(en)*(180/Math.PI)},At=(pe,$e)=>pe.find(Te=>Te.name===$e&&Te.score>.3),Vs=pe=>{const $e=At(pe,"left_shoulder"),Te=At(pe,"left_elbow"),Je=At(pe,"left_wrist"),He=At(pe,"right_shoulder"),it=At(pe,"right_elbow"),Ot=At(pe,"right_wrist");let Yt=!1,On=!1;if($e&&Te&&Je){const An=dt($e,Te,Je)>=160,os=Je.y<=$e.y+10,Ht=Je.x>$e.x+40,zs=Te.y<=$e.y+40;An&&os&&Ht&&zs&&(Yt=!0)}if(He&&it&&Ot){const An=dt(He,it,Ot)>=160,os=Ot.y<=He.y+10,Ht=Ot.x<He.x-40,zs=it.y<=He.y+40;An&&os&&Ht&&zs&&(On=!0)}return Yt&&On?"Double Punch":Yt?"Left Punch":On?"Right Punch":null},Ln=pe=>{const $e=At(pe,"left_hip"),Te=At(pe,"left_knee"),Je=At(pe,"left_ankle"),He=At(pe,"right_hip"),it=At(pe,"right_knee"),Ot=At(pe,"right_ankle");if(!$e||!Te||!Je||!He||!it||!Ot)return null;const Yt=dt($e,Te,Je),On=dt(He,it,Ot),en=Math.abs(Yt-On);return console.log(`🦵 Leg angles: Left=${Yt.toFixed(1)}°, Right=${On.toFixed(1)}°, Difference=${en.toFixed(1)}°`),en>=60&&en<=90?Yt<On?(console.log(`✅ LEFT KICK detected: Left leg angle ${Yt.toFixed(1)}° < Right leg angle ${On.toFixed(1)}°`),"Left Kick"):(console.log(`✅ RIGHT KICK detected: Right leg angle ${On.toFixed(1)}° < Left leg angle ${Yt.toFixed(1)}°`),"Right Kick"):null},lr=pe=>{const $e=At(pe,"left_shoulder"),Te=At(pe,"left_elbow"),Je=At(pe,"left_wrist"),He=At(pe,"right_shoulder"),it=At(pe,"right_elbow"),Ot=At(pe,"right_wrist");let Yt=!1,On=!1;if($e&&Te&&Je){const en=dt($e,Te,Je),An=en>=70&&en<=120,os=Je.y<$e.y-40,Ht=Te.y<$e.y;An&&os&&Ht&&(Yt=!0)}if(He&&it&&Ot){const en=dt(He,it,Ot),An=en>=70&&en<=120,os=Ot.y<He.y-40,Ht=it.y<He.y;An&&os&&Ht&&(On=!0)}return Yt&&On?"Double High Block":Yt?"Left High Block":On?"Right High Block":null},qn=pe=>{const $e=At(pe,"left_shoulder"),Te=At(pe,"left_elbow"),Je=At(pe,"left_wrist"),He=At(pe,"right_shoulder"),it=At(pe,"right_elbow"),Ot=At(pe,"right_wrist");if(!$e||!Te||!Je||!He||!it||!Ot)return!1;const Yt=Je.y<$e.y-30,On=Ot.y<He.y-30,en=Te.y<$e.y+20,An=it.y<He.y+20,os=Math.abs(Je.x-Ot.x)<80,Ht=($e.x+He.x)/2,zs=(Je.x+Ot.x)/2,nl=Math.abs(zs-Ht)<60,Lo=dt($e,Te,Je),ts=dt(He,it,Ot),$i=Lo>=60&&Lo<=140,wa=ts>=60&&ts<=140;return[Yt,On,en,An,os,nl,$i,wa].filter(Boolean).length>=6},Ei=pe=>{const $e=At(pe,"left_shoulder"),Te=At(pe,"left_elbow"),Je=At(pe,"left_wrist"),He=At(pe,"right_shoulder"),it=At(pe,"right_elbow"),Ot=At(pe,"right_wrist");let Yt=!1,On=!1;if($e&&Te&&Je){const en=dt($e,Te,Je),An=en>=60&&en<=110,os=Je.y>=$e.y-20&&Je.y<=$e.y+80,Ht=Je.x>$e.x;An&&os&&Ht&&(Yt=!0)}if(He&&it&&Ot){const en=dt(He,it,Ot),An=en>=60&&en<=110,os=Ot.y>=He.y-20&&Ot.y<=He.y+80,Ht=Ot.x<He.x;An&&os&&Ht&&(On=!0)}return Yt&&On?"Double Mid Block":Yt?"Left Mid Block":On?"Right Mid Block":null},is=pe=>{const $e=Vs(pe);if($e)return $e;const Te=Ln(pe);if(Te)return Te;const Je=lr(pe);if(Je)return Je;const He=Ei(pe);return He||(qn(pe)?"X Block":"No Pose")},Mo=()=>{console.log(`🎮 START CHALLENGE CLICKED! | Command: "${o}" | Current Pose: "${De}"`),p(!1),je.current=!1,a(null),Xe.current=null,h(!1),j("No Pose"),Pe(0),console.log(`🎮 Setting gameState to: "countdown" | Command: "${o}" | Current Pose: "${De}"`),s("countdown"),Me.current="countdown",i(5);let pe=5;console.log(`🎮 Starting countdown interval... | Command: "${o}" | Current Pose: "${De}"`);const $e=setInterval(()=>{console.log(`🎮 Countdown interval fired! countdownValue=${pe} | Command: "${o}" | Current Pose: "${De}"`),pe-=1,i(pe),console.log(`🎮 Countdown: ${pe} | Command: "${o}" | Current Pose: "${De}"`),pe===1&&(console.log("📹 Activating camera at countdown = 1"),L(!0)),pe<=0&&(console.log("🚨 COUNTDOWN REACHED 0! Starting game setup..."),clearInterval($e),console.log("🚨 Interval cleared"),i(null),console.log("🚨 setCountdown(null) called"),console.log('🚨 ABOUT TO SET: setGameState("playing")'),s("playing"),Me.current="playing",console.log('🚨 setGameState("playing") called + gameStateRef.current = "playing"'),console.log("🚨 ABOUT TO CALL: selectRandomMove()"),jt(),console.log("🚨 selectRandomMove() call completed"))},1e3)},fs=()=>{console.log("🔄 RESTARTING GAME"),Ze.current&&(clearTimeout(Ze.current),Ze.current=null),s("waiting"),Me.current="waiting",a(null),Xe.current=null,c(!1),lt.current=!1,p(!1),je.current=!1,g(0),y(1),S(3.5),k(!1),_(""),h(!1),i(null),R(!1),j("No Pose"),G(!1),Ce(""),Pe(0),console.log("🔄 Game reset to waiting state")};return b.useEffect(()=>{console.log(`🖼️ POPUP STATE: showPosePopup changed to: ${U} | Image: ${xe}`)},[U,xe]),b.useEffect(()=>{console.log(`🖼️ TOGGLE STATE: showPoseImages changed to: ${z}`)},[z]),b.useEffect(()=>{console.log(`📝 🎯 CURRENTMOVE STATE CHANGED: "${o}"`),console.log(`📝 🎯 UI should now display: "${l?"Shifu says: ":""}${o}"`)},[o]),b.useEffect(()=>{if(n==="playing"){console.log(`🎯 DIFFICULTY VERIFICATION - Current Level: ${x}`),console.log("📊 ALL LEVEL TIMINGS:");for(let pe=1;pe<=10;pe++){const $e=Z(!1,pe),Te=Z(!0,pe);console.log(`   Level ${pe}: Normal=${$e}s, Shifu Says=${Te}s`)}}},[n,x]),u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-black via-gray-950 to-yellow-950/20 text-white relative overflow-hidden",children:[u.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[u.jsx(X.div,{className:"absolute top-20 left-10 w-64 h-64 bg-yellow-500/10 rounded-full blur-3xl",animate:{scale:[1,1.2,1],rotate:[0,180,360],opacity:[.3,.6,.3]},transition:{duration:20,repeat:1/0}}),u.jsx(X.div,{className:"absolute bottom-20 right-10 w-96 h-96 bg-amber-500/10 rounded-full blur-3xl",animate:{scale:[1.2,1,1.2],rotate:[360,180,0],opacity:[.4,.7,.4]},transition:{duration:25,repeat:1/0}})]}),u.jsxs("div",{className:"relative z-10 h-screen flex flex-col",children:[u.jsxs("div",{className:"flex items-center justify-between p-4 bg-black/50 backdrop-blur-sm border-b border-yellow-500/20",children:[u.jsx("div",{className:"flex gap-2",children:u.jsx(jn,{href:"/challenges",children:u.jsxs(Se,{variant:"ghost",className:"text-white hover:bg-yellow-600/20",children:[u.jsx(fa,{className:"h-5 w-5 mr-2"}),"Back to Challenges"]})})}),u.jsx("div",{className:"flex items-center gap-6",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(lc,{className:"h-5 w-5 text-yellow-400"}),u.jsx("span",{className:"text-yellow-300 font-bold",children:"Shifu Says"})]})})]}),u.jsxs("div",{className:"flex-1 relative",children:[u.jsxs("div",{className:"absolute inset-0",children:[u.jsx("video",{ref:Re,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover opacity-0 pointer-events-none"}),u.jsx("canvas",{ref:ce,className:"absolute inset-0 w-full h-full object-cover"}),u.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[F&&u.jsxs("div",{className:"bg-green-500/20 border border-green-500/50 rounded-lg px-3 py-1 text-green-400 text-sm flex items-center gap-2",children:[u.jsx(C_,{className:"h-4 w-4"}),"Camera Active"]}),M&&u.jsxs("div",{className:"bg-cyan-500/20 border border-cyan-500/50 rounded-lg px-3 py-1 text-cyan-400 text-sm flex items-center gap-2",children:[u.jsx(Ru,{className:"h-4 w-4"}),"Skeleton Active"]})]})]}),u.jsxs("div",{className:"absolute inset-0 flex flex-col",children:[u.jsxs("div",{className:"flex justify-between items-start p-4",children:[u.jsx("div",{className:"bg-black/70 backdrop-blur-sm rounded-2xl px-4 py-3 border border-blue-500/30",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"text-blue-400 font-semibold text-sm",children:"Current Pose:"}),u.jsx("div",{"data-testid":"current-pose",className:`font-bold text-lg transition-colors duration-200 ${De==="No Pose"?"text-gray-400":"text-green-400"}`,children:De}),u.jsx("div",{className:`w-3 h-3 rounded-full transition-colors duration-200 ${De==="No Pose"?"bg-gray-500":"bg-green-400 animate-pulse"}`})]})}),n==="playing"&&u.jsxs("div",{className:"flex gap-4",children:[u.jsx("div",{className:"bg-black/70 backdrop-blur-sm rounded-2xl px-4 py-3 border border-yellow-500/30",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(lc,{className:"h-5 w-5 text-yellow-400"}),u.jsx("span",{className:"text-yellow-400 font-bold text-xl",children:m})]})}),u.jsx("div",{className:"bg-black/70 backdrop-blur-sm rounded-2xl px-4 py-3 border border-purple-500/30",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-400 flex items-center justify-center text-black text-xs font-bold",children:"L"}),u.jsx("span",{className:"text-purple-400 font-bold text-xl",children:x})]})}),u.jsx("div",{className:`bg-black/70 backdrop-blur-sm rounded-2xl px-4 py-3 border ${$?"border-blue-500/30":"border-orange-500/30"}`,children:u.jsx("div",{className:"flex items-center gap-2",children:$?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-400 animate-pulse"}),u.jsx("span",{className:"font-bold text-xl text-blue-400",children:"🎵 Listening..."})]}):u.jsxs(u.Fragment,{children:[u.jsx("div",{className:`w-3 h-3 rounded-full ${v>1?"bg-green-400":v>.5?"bg-yellow-400 animate-pulse":"bg-red-400 animate-pulse"}`}),u.jsxs("span",{className:`font-bold text-xl ${v>1?"text-green-400":v>.5?"text-yellow-400":"text-red-400"}`,children:[v.toFixed(1),"s"]})]})})})]}),u.jsxs("div",{className:"bg-black/70 backdrop-blur-sm rounded-2xl px-4 py-3 border border-red-500/30 max-w-md",children:[u.jsx("div",{className:"text-red-400 font-semibold text-sm mb-2",children:"Debug Info:"}),u.jsx("div",{className:"text-xs text-white space-y-1",children:Ye.map((pe,$e)=>u.jsx("div",{className:"font-mono",children:pe},$e))})]})]}),u.jsxs("div",{className:"flex-1 flex items-center justify-center",children:[n==="waiting"&&u.jsxs("div",{className:"text-center bg-black/80 backdrop-blur-sm rounded-3xl p-8 border border-yellow-500/30 max-w-lg",children:[u.jsx(lc,{className:"h-16 w-16 text-yellow-400 mx-auto mb-4"}),u.jsx("h1",{className:"text-4xl font-black bg-gradient-to-r from-yellow-300 via-amber-400 to-yellow-500 bg-clip-text text-transparent mb-4",children:"SHIFU SAYS"}),u.jsxs("div",{className:"bg-orange-500/20 border border-orange-500/50 rounded-lg p-4 mb-6",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("span",{className:"text-orange-400 text-2xl",children:"🔊"}),u.jsx("span",{className:"text-orange-300 font-bold",children:"AUDIO REQUIRED"})]}),u.jsx("p",{className:"text-orange-200 text-sm mb-2",children:'Turn up your volume! This game requires audio to distinguish between "Shifu says" and regular commands.'}),u.jsx("p",{className:"text-orange-300 text-xs",children:`💡 If audio doesn't work: Click "Test Audio" first to enable browser permissions.`})]}),u.jsx("p",{className:"text-gray-300 text-lg mb-6",children:"Listen carefully! Only perform moves when Shifu says so."}),u.jsx(Se,{onClick:()=>{console.log("🎵 Testing audio...");const pe=new Audio("/sounds/shifu_says/Shifu Says Left Punch.mp3");pe.volume=.8,pe.play().then(()=>{console.log("✅ Audio test successful!"),alert('Audio test successful! 🎵 You should have heard "Shifu Says Left Punch"')}).catch($e=>{console.error(`🚨 Audio test failed: ${$e}`),$e.name==="NotAllowedError"?alert("Browser blocked audio! Please click somewhere on the page first, then try again."):alert(`Audio test failed: ${$e.message}. Please check your speakers/headphones.`)})},className:"bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 mb-4 mr-4",children:"🎵 Test Audio"}),u.jsx("div",{className:"mb-6",children:u.jsxs("button",{onClick:()=>{const pe=!z;console.log(`🖼️ TOGGLE: Pose images toggled from ${z} to ${pe}`),re(pe)},className:`rounded-lg px-4 py-3 text-sm flex items-center gap-3 transition-colors mx-auto ${z?"bg-purple-500/20 border border-purple-500/50 text-purple-400":"bg-gray-500/20 border border-gray-500/50 text-gray-400 hover:bg-purple-500/10"}`,children:[u.jsx("span",{className:"text-xl",children:"🖼️"}),u.jsxs("div",{className:"text-left",children:[u.jsx("div",{className:"font-semibold",children:z?"Pose Images: ON":"Pose Images: OFF"}),u.jsx("div",{className:"text-xs opacity-75",children:z?"Pop-up will show pose reference":"Click to enable pose references"})]})]})}),u.jsxs(Se,{onClick:()=>{Mo()},className:"bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-600 text-black hover:from-yellow-500 hover:via-amber-600 hover:to-yellow-700 text-lg px-8 py-3 font-bold",children:[u.jsx(lc,{className:"h-5 w-5 mr-2"}),"Start Challenge"]})]}),n==="countdown"&&r!==null&&u.jsxs("div",{className:"text-center bg-black/80 backdrop-blur-sm rounded-3xl p-8 border border-yellow-500/30 max-w-2xl",children:[u.jsx("div",{className:"text-8xl font-bold text-yellow-400 mb-4 animate-pulse",children:r}),u.jsx("div",{className:"text-3xl text-white mb-4 font-bold",children:"Get Ready!"}),u.jsx("div",{className:"text-lg text-gray-300 mb-2",children:"📍 Step back and ensure your entire body is visible"}),u.jsx("div",{className:"text-lg text-gray-300 mb-2",children:"🎯 Get in position for martial arts moves"}),u.jsx("div",{className:"text-lg text-yellow-400",children:"The challenge begins when the countdown reaches 1!"})]}),n==="playing"&&u.jsxs("div",{className:"text-center bg-black/80 backdrop-blur-sm rounded-3xl p-8 border border-green-500/30 max-w-lg",children:[o&&u.jsx("div",{className:"mb-4",children:u.jsx("p",{"data-testid":"current-command",className:"text-4xl font-bold text-yellow-400 mb-6",children:o})}),u.jsxs("div",{className:"text-gray-400 text-sm",children:["Score: ",m," • ",$?"🎵 Listen...":`${v.toFixed(1)}s`]})]}),u.jsx(ko,{children:d&&u.jsx(X.div,{className:"absolute inset-0 flex items-center justify-center z-50",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{duration:.3},children:u.jsx("div",{className:"w-32 h-32 rounded-full bg-green-500/90 border-4 border-green-400 flex items-center justify-center",children:u.jsx(n1,{className:"h-16 w-16 text-white"})})})})]})]})]})]}),u.jsx(ko,{children:U&&u.jsx(X.div,{className:"fixed inset-0 flex items-center justify-center z-40 pointer-events-none",initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},transition:{duration:.2},children:u.jsxs("div",{className:"bg-black/90 backdrop-blur-sm rounded-3xl p-6 border-2 border-purple-500/50 shadow-2xl max-w-sm",children:[u.jsx("img",{src:xe,alt:"Pose reference",className:"mx-auto max-w-48 max-h-48 rounded-lg border border-purple-400/30",onLoad:()=>{console.log(`✅ POSE POPUP: Image loaded successfully: ${xe}`)},onError:pe=>{console.error(`❌ POSE POPUP: Image failed to load: ${xe}`),pe.currentTarget.style.display="none"}}),u.jsx("p",{className:"text-purple-300 text-center text-sm mt-3 font-semibold",children:"📸 Pose Reference"})]})})}),u.jsx(ko,{children:C&&u.jsx(X.div,{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-900 to-black border border-red-500/50 rounded-3xl p-8 max-w-md w-full mx-4 text-center",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{type:"spring",duration:.5},children:[u.jsx("div",{className:"text-6xl mb-4",children:"💀"}),u.jsx("h2",{className:"text-3xl font-bold text-red-400 mb-4",children:"Game Over!"}),u.jsx("p",{className:"text-gray-300 text-lg mb-6",children:T}),u.jsxs("div",{className:"bg-black/50 rounded-2xl p-4 mb-6",children:[u.jsx("div",{className:"text-yellow-400 text-sm mb-2",children:"Final Results"}),u.jsxs("div",{className:"flex items-center justify-center gap-6",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(lc,{className:"h-6 w-6 text-yellow-400"}),u.jsx("span",{className:"text-3xl font-bold text-yellow-400",children:m})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-400 flex items-center justify-center text-black text-sm font-bold",children:"L"}),u.jsx("span",{className:"text-3xl font-bold text-purple-400",children:x})]})]})]}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx(Se,{onClick:fs,className:"flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3",children:"Play Again"}),u.jsx(jn,{href:"/challenges",children:u.jsx(Se,{variant:"outline",className:"flex-1 border-gray-500 text-gray-300 hover:bg-gray-700",children:"Back to Menu"})})]})]})})}),t&&u.jsx(GGe,{onClose:()=>e(!1)})]})},Z4=3,qGe="orange",bd=.3,J4=80,eL=140,XGe=()=>{const[,t]=Po(),[e,n]=b.useState(!0),[s,r]=b.useState(!1),[i,o]=b.useState(Z4),[a,l]=b.useState(!1),[c,d]=b.useState(null),h=b.useRef(null),f=b.useRef(null),[p,m]=b.useState(null),g=b.useRef(null),[x,y]=b.useState(0),[v,S]=b.useState("up"),[C,k]=b.useState(null),[T,_]=b.useState(null),[$,R]=b.useState(null),[A,j]=b.useState(!1),[F,L]=b.useState(!1),[M,q]=b.useState(0),[z,re]=b.useState(null),[U,G]=b.useState(null),[xe,Ce]=b.useState(null),[De,fe]=b.useState(!1),[ee,Pe]=b.useState(0),Re=200,[ce,me]=b.useState({totalWorkouts:0,totalPushups:0}),[ie,Q]=b.useState(""),[oe,ae]=b.useState(0);b.useEffect(()=>{const Ye=localStorage.getItem("pushupsWorkoutStats");Ye&&me(JSON.parse(Ye))},[]);const Ae=(Ye,Ie)=>{const B=new Date().toLocaleDateString(),Z={count:Ye,duration:Ie,date:B},te={lastWorkout:Z,bestWorkout:!ce.bestWorkout||Ye>ce.bestWorkout.count?Z:ce.bestWorkout,totalWorkouts:ce.totalWorkouts+1,totalPushups:ce.totalPushups+Ye};me(te),localStorage.setItem("pushupsWorkoutStats",JSON.stringify(te))};b.useEffect(()=>{(async()=>{try{const Ie=await go("lightning");d(Ie)}catch(Ie){console.error("Error initializing pose detection:",Ie)}})()},[]),b.useEffect(()=>((async()=>{try{const Ie=await navigator.mediaDevices.getUserMedia({video:!0});h.current&&(h.current.srcObject=Ie,h.current.onloadedmetadata=()=>{h.current&&(h.current.play(),f.current&&(f.current.width=h.current.videoWidth,f.current.height=h.current.videoHeight))}),m(Ie)}catch(Ie){console.error("Error accessing camera:",Ie)}})(),()=>{p&&p.getTracks().forEach(Ie=>Ie.stop()),g.current&&cancelAnimationFrame(g.current)}),[]);const Be=()=>{n(!1),r(!0),o(Z4),l(!0),y(0),S("up"),L(!1),re(Date.now()),Q(""),ae(0),G(null),Ce(null),fe(!1),Pe(0)};b.useEffect(()=>{if(a&&i>0){const Ye=setTimeout(()=>o(Ie=>Ie-1),1e3);return()=>clearTimeout(Ye)}else a&&i===0&&l(!1)},[a,i]);const Xe=Ye=>({r:249,g:115,b:22});b.useEffect(()=>{let Ye=null;return s&&!a&&z&&(Ye=setInterval(()=>{q(Math.floor((Date.now()-z)/1e3))},1e3)),()=>{Ye&&clearInterval(Ye)}},[s,a,z]);const lt=(Ye,Ie,B)=>{if(!Ye||!Ie||!B)return null;const Z=Math.atan2(B.y-Ie.y,B.x-Ie.x)-Math.atan2(Ye.y-Ie.y,Ye.x-Ie.x);let te=Math.abs(Z*180/Math.PI);return te>180&&(te=360-te),Math.round(te)},Me=async()=>{if(!h.current||!f.current||!c||h.current.readyState<2){g.current=requestAnimationFrame(Me);return}try{const Ye=await pr(h.current,1,.3),Ie=f.current.getContext("2d");if(Ie){Ie.clearRect(0,0,f.current.width,f.current.height),Ie.drawImage(h.current,0,0,f.current.width,f.current.height);let B=null,Z=null,te=null,ve=!1;if(Ye.forEach(we=>{if(we.keypoints&&we.keypoints.length>0){const de=we.keypoints,Ee=Xe(qGe),mt=`rgb(${Ee.r}, ${Ee.g}, ${Ee.b})`,It=mt,jt=`rgba(${Ee.r}, ${Ee.g}, ${Ee.b}, 0.7)`;Ie.strokeStyle=mt,Ie.lineWidth=3,Ac().forEach(([pe,$e])=>{const Te=de.find(He=>He.name===pe),Je=de.find(He=>He.name===$e);Te&&Je&&(Te.score??0)>bd&&(Je.score??0)>bd&&(Ie.save(),Ie.shadowColor=jt,Ie.shadowBlur=10,Ie.beginPath(),Ie.moveTo(Te.x,Te.y),Ie.lineTo(Je.x,Je.y),Ie.stroke(),Ie.restore())}),de.forEach(pe=>{(pe.score??0)>bd&&(Ie.save(),Ie.shadowColor=jt,Ie.shadowBlur=15,Ie.fillStyle=It,Ie.beginPath(),Ie.arc(pe.x,pe.y,6,0,2*Math.PI),Ie.fill(),Ie.restore())});const fn=de.find(pe=>pe.name==="left_shoulder"),dt=de.find(pe=>pe.name==="left_elbow"),At=de.find(pe=>pe.name==="left_wrist"),Vs=de.find(pe=>pe.name==="right_shoulder"),Ln=de.find(pe=>pe.name==="right_elbow"),lr=de.find(pe=>pe.name==="right_wrist"),qn=de.find(pe=>pe.name==="left_hip"),Ei=de.find(pe=>pe.name==="right_hip"),is=de.find(pe=>pe.name==="left_ankle"),Mo=de.find(pe=>pe.name==="right_ankle");fn&&dt&&At&&(B=lt(fn,dt,At),B!==null&&(Ie.save(),Ie.font="bold 18px Arial",Ie.fillStyle="yellow",Ie.strokeStyle="black",Ie.lineWidth=3,Ie.strokeText(`${B}°`,dt.x-30,dt.y-10),Ie.fillText(`${B}°`,dt.x-30,dt.y-10),Ie.restore())),Vs&&Ln&&lr&&(Z=lt(Vs,Ln,lr),Z!==null&&(Ie.save(),Ie.font="bold 18px Arial",Ie.fillStyle="yellow",Ie.strokeStyle="black",Ie.lineWidth=3,Ie.strokeText(`${Z}°`,Ln.x+10,Ln.y-10),Ie.fillText(`${Z}°`,Ln.x+10,Ln.y-10),Ie.restore())),fn&&qn&&is&&(te=lt(fn,qn,is));const fs=de.find(pe=>pe.name==="nose");if(fs&&(fs.score??0)>bd&&G({x:fs.x,y:fs.y}),fn&&Vs&&(fn.score??0)>bd&&(Vs.score??0)>bd){const pe=(fn.y+Vs.y)/2;if(Ce(pe),fs&&(fs.score??0)>bd){const $e=pe-fs.y<=J4;if(fe($e),s&&!a){const Te=pe-fs.y;console.log(`Face Y: ${fs.y.toFixed(0)}, Shoulder Y: ${pe.toFixed(0)}, Distance: ${Te.toFixed(0)}, Threshold: ${J4}, BelowLine: ${$e}, Phase: ${v}`)}}}ve=fn!==null&&Vs!==null&&(te===null||te>=eL)}}),k(B),_(Z),R(te),j(ve),s&&!a&&xe!==null&&U!==null){const we=Date.now(),de=we-ee;v==="up"&&De?(console.log("Phase change: UP -> DOWN (face below shoulders)"),S("down")):v==="down"&&!De&&de>Re&&(console.log("PUSHUP COUNTED! Face returned above shoulders"),S("up"),y(Ee=>{const mt=Ee+1;return console.log(`Pushup count: ${Ee} -> ${mt}`),mt}),ae(Ee=>Ee+1),Pe(we))}s&&!a&&oe>=5?xe!==null&&U!==null?te!==null&&te<eL?Q("Keep your body straight like a plank!"):Q(v==="down"&&!De?"Go lower! Get your face below your shoulders!":v==="up"&&De?"Push all the way up! Lift your head higher!":v==="down"?"Perfect form! Keep going!":v==="up"?"Excellent! You're crushing it!":"Keep it up! Focus on your form!"):Q("Face the camera and get in pushup position!"):s&&!a&&oe<5&&Q("Keep going! I'll give you tips soon!")}g.current=requestAnimationFrame(Me)}catch{g.current=requestAnimationFrame(Me)}};b.useEffect(()=>{if(s&&c&&p)g.current=requestAnimationFrame(Me);else if(g.current&&(cancelAnimationFrame(g.current),g.current=null),f.current&&!s){const Ye=f.current.getContext("2d");Ye&&Ye.clearRect(0,0,f.current.width,f.current.height)}return()=>{g.current&&cancelAnimationFrame(g.current)}},[s,c,p]);const je=Ye=>{const Ie=Math.floor(Ye/60),B=Ye%60;return`${Ie}:${B.toString().padStart(2,"0")}`},Ze=()=>{r(!1),L(!0),Ae(x,M)};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-orange-900 to-red-900 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/workouts"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Pushups Workout"})}),u.jsx("div",{className:"w-16"})," "]})}),u.jsxs("div",{className:"pt-10 w-full h-full flex-1 flex flex-col items-center justify-center",children:[u.jsx(ko,{children:e&&u.jsx(X.div,{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-50 p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-orange-700 max-w-lg text-center",initial:{scale:.9,y:20},animate:{scale:1,y:0},transition:{delay:.1,duration:.3},children:[u.jsx(s1,{className:"text-orange-400 w-16 h-16 mx-auto mb-4"}),u.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-red-500 mb-4",children:"Pushups Workout"}),u.jsxs("div",{className:"text-orange-200 text-lg mb-6 space-y-3",children:[u.jsx("p",{children:u.jsx("strong",{children:"Instructions:"})}),u.jsx("p",{children:"• Face the camera in a pushup position"}),u.jsx("p",{children:"• Keep your body straight like a plank"}),u.jsx("p",{children:"• Lower your body until your arms are at 90°"}),u.jsx("p",{children:"• Push back up until your arms are straight"}),u.jsx("p",{children:"• I'll count each perfect pushup for you!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-orange-300 border-orange-600 hover:bg-orange-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:Be,className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-semibold",children:"Start Workout!"})]})]})})}),u.jsxs("div",{className:"absolute inset-0 w-full h-full z-0",children:[u.jsx("video",{ref:h,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),u.jsx("canvas",{ref:f,className:"absolute inset-0 w-full h-full"}),s&&a&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[u.jsx("div",{className:"text-orange-400 text-3xl sm:text-5xl font-bold mb-2 bg-black/40 px-4 py-2 rounded-xl",children:"Get into pushup position!"}),u.jsx("div",{className:"text-orange-400 text-7xl sm:text-9xl font-bold bg-black/40 px-8 py-4 rounded-2xl",children:i})]})]}),!e&&u.jsx("div",{className:"fixed top-16 right-4 z-40 w-64",children:u.jsxs("div",{className:"bg-black/90 rounded-xl p-4 shadow-lg border border-orange-600",children:[u.jsx("h3",{className:"text-orange-400 font-bold text-lg mb-3 text-center",children:"📊 Your Stats"}),u.jsxs("div",{className:"space-y-2 text-sm",children:[ce.lastWorkout?u.jsxs("div",{className:"bg-orange-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-orange-300 font-semibold",children:"Last Workout:"}),u.jsxs("div",{className:"text-white",children:[ce.lastWorkout.count," pushups"]}),u.jsx("div",{className:"text-gray-400",children:ce.lastWorkout.date})]}):u.jsxs("div",{className:"bg-orange-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-orange-300 font-semibold",children:"First workout!"}),u.jsx("div",{className:"text-gray-400",children:"No previous data"})]}),ce.bestWorkout&&u.jsxs("div",{className:"bg-yellow-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-yellow-300 font-semibold",children:"🏆 Personal Best:"}),u.jsxs("div",{className:"text-white",children:[ce.bestWorkout.count," pushups"]}),u.jsx("div",{className:"text-gray-400",children:ce.bestWorkout.date})]}),u.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2",children:[u.jsx("div",{className:"text-gray-300 font-semibold",children:"Total:"}),u.jsxs("div",{className:"text-white",children:[ce.totalWorkouts," workouts"]}),u.jsxs("div",{className:"text-white",children:[ce.totalPushups," pushups"]})]})]})]})}),s&&!a&&!F&&u.jsx("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md flex flex-col items-center",children:u.jsxs("div",{className:"bg-black/80 rounded-xl p-4 shadow-lg border border-orange-600",children:[u.jsxs("div",{className:"text-center mb-2",children:[u.jsx("div",{className:"text-3xl font-bold text-orange-400",children:x}),u.jsx("div",{className:"text-sm text-white",children:"Pushups"})]}),u.jsxs("div",{className:"flex justify-between text-sm text-gray-300 mb-2",children:[u.jsxs("span",{children:["Time: ",je(M)]}),u.jsxs("span",{children:["Phase: ",v.toUpperCase()]})]}),u.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[u.jsxs("div",{children:["Elbow Angles: L:",C,"° R:",T,"°"]}),xe&&U&&u.jsxs("div",{children:["Face: ",U.y.toFixed(0),"px | Shoulders: ",xe.toFixed(0),"px",u.jsx("br",{}),De?"✅ DOWN Position":"❌ UP Position",u.jsx("br",{}),"Phase: ",u.jsx("span",{className:"font-bold text-orange-300",children:v.toUpperCase()})]})]})]})}),s&&!a&&!F&&u.jsx("div",{className:"fixed top-32 left-1/2 transform -translate-x-1/2 z-40 max-w-md",children:u.jsx("div",{className:`text-center px-4 py-2 rounded-lg ${A?"bg-green-600/80 text-white":"bg-red-600/80 text-white"}`,children:A?"Perfect form! Keep it up!":"Keep your body straight and face the camera"})}),s&&!a&&!F&&ie&&u.jsx("div",{className:"fixed top-48 left-1/2 transform -translate-x-1/2 z-40 max-w-lg",children:u.jsxs("div",{className:"bg-orange-600/90 text-white text-center px-6 py-3 rounded-lg shadow-lg border-2 border-orange-400",children:[u.jsx("div",{className:"text-lg font-bold",children:"💪 Coach Says:"}),u.jsx("div",{className:"text-base mt-1",children:ie})]})}),s&&!a&&!F&&u.jsx("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:u.jsx(Se,{onClick:Ze,className:"bg-orange-600 hover:bg-orange-700 text-white font-semibold px-6 py-3 rounded-lg",children:"Finish Workout"})}),F&&u.jsx("div",{className:"fixed inset-0 flex flex-col items-center justify-center z-50 bg-black/80",children:u.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-orange-700 max-w-lg text-center",children:[u.jsx("h2",{className:"text-3xl font-bold text-orange-400 mb-4",children:"Workout Complete!"}),u.jsxs("div",{className:"text-xl text-white mb-6 space-y-2",children:[u.jsx("p",{className:"text-orange-400 font-bold text-3xl",children:x}),u.jsx("p",{children:"Pushups completed"}),u.jsxs("p",{children:["Duration: ",je(M)]}),u.jsx("p",{className:"text-sm text-gray-300 mt-4",children:"Great job! Keep up the consistent training!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-orange-300 border-orange-600 hover:bg-orange-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:Be,className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-semibold",children:"Do Another Set"})]})]})})]})]})},tL=3,YGe="green",iC=.3,nL=120,sL=80,QGe=()=>{const[,t]=Po(),[e,n]=b.useState(!0),[s,r]=b.useState(!1),[i,o]=b.useState(tL),[a,l]=b.useState(!1),[c,d]=b.useState(null),h=b.useRef(null),f=b.useRef(null),[p,m]=b.useState(null),g=b.useRef(null),[x,y]=b.useState(0),[v,S]=b.useState("down"),[C,k]=b.useState(null),[T,_]=b.useState(!1),[$,R]=b.useState(!1),[A,j]=b.useState(0),[F,L]=b.useState(null),[M,q]=b.useState({totalWorkouts:0,totalCrunches:0}),[z,re]=b.useState(""),[U,G]=b.useState(0);b.useEffect(()=>{const ce=localStorage.getItem("crunchesWorkoutStats");ce&&q(JSON.parse(ce))},[]);const xe=(ce,me)=>{const ie=new Date().toLocaleDateString(),Q={count:ce,duration:me,date:ie},oe={lastWorkout:Q,bestWorkout:!M.bestWorkout||ce>M.bestWorkout.count?Q:M.bestWorkout,totalWorkouts:M.totalWorkouts+1,totalCrunches:M.totalCrunches+ce};q(oe),localStorage.setItem("crunchesWorkoutStats",JSON.stringify(oe))};b.useEffect(()=>{(async()=>{try{const me=await go("lightning");d(me)}catch(me){console.error("Error initializing pose detection:",me)}})()},[]),b.useEffect(()=>((async()=>{try{const me=await navigator.mediaDevices.getUserMedia({video:!0});h.current&&(h.current.srcObject=me,h.current.onloadedmetadata=()=>{h.current&&(h.current.play(),f.current&&(f.current.width=h.current.videoWidth,f.current.height=h.current.videoHeight))}),m(me)}catch(me){console.error("Error accessing camera:",me)}})(),()=>{p&&p.getTracks().forEach(me=>me.stop()),g.current&&cancelAnimationFrame(g.current)}),[]);const Ce=()=>{n(!1),r(!0),o(tL),l(!0),y(0),S("down"),R(!1),L(Date.now()),re(""),G(0)};b.useEffect(()=>{if(a&&i>0){const ce=setTimeout(()=>o(me=>me-1),1e3);return()=>clearTimeout(ce)}else a&&i===0&&l(!1)},[a,i]);const De=ce=>({r:16,g:185,b:129});b.useEffect(()=>{let ce=null;return s&&!a&&F&&(ce=setInterval(()=>{j(Math.floor((Date.now()-F)/1e3))},1e3)),()=>{ce&&clearInterval(ce)}},[s,a,F]);const fe=(ce,me,ie)=>{if(!ce||!me||!ie)return null;const Q=Math.atan2(ie.y-me.y,ie.x-me.x)-Math.atan2(ce.y-me.y,ce.x-me.x);let oe=Math.abs(Q*180/Math.PI);return oe>180&&(oe=360-oe),Math.round(oe)},ee=async()=>{if(!h.current||!f.current||!c||h.current.readyState<2){g.current=requestAnimationFrame(ee);return}try{const ce=await pr(h.current,1,.3),me=f.current.getContext("2d");if(me){me.clearRect(0,0,f.current.width,f.current.height),me.drawImage(h.current,0,0,f.current.width,f.current.height);let ie=null,Q=!1;ce.forEach(oe=>{if(oe.keypoints&&oe.keypoints.length>0){const ae=oe.keypoints,Ae=De(YGe),Be=`rgb(${Ae.r}, ${Ae.g}, ${Ae.b})`,Xe=Be,lt=`rgba(${Ae.r}, ${Ae.g}, ${Ae.b}, 0.7)`;me.strokeStyle=Be,me.lineWidth=3,Ac().forEach(([te,ve])=>{const we=ae.find(Ee=>Ee.name===te),de=ae.find(Ee=>Ee.name===ve);we&&de&&(we.score??0)>iC&&(de.score??0)>iC&&(me.save(),me.shadowColor=lt,me.shadowBlur=10,me.beginPath(),me.moveTo(we.x,we.y),me.lineTo(de.x,de.y),me.stroke(),me.restore())}),ae.forEach(te=>{(te.score??0)>iC&&(me.save(),me.shadowColor=lt,me.shadowBlur=15,me.fillStyle=Xe,me.beginPath(),me.arc(te.x,te.y,6,0,2*Math.PI),me.fill(),me.restore())});const je=ae.find(te=>te.name==="left_shoulder"),Ze=ae.find(te=>te.name==="right_shoulder"),Ye=ae.find(te=>te.name==="left_hip"),Ie=ae.find(te=>te.name==="right_hip"),B=ae.find(te=>te.name==="left_knee"),Z=ae.find(te=>te.name==="right_knee");if(je&&Ze&&Ye&&Ie){const te={x:(je.x+Ze.x)/2,y:(je.y+Ze.y)/2},ve={x:(Ye.x+Ie.x)/2,y:(Ye.y+Ie.y)/2},we=B&&Z?{x:(B.x+Z.x)/2,y:(B.y+Z.y)/2}:null;we&&(ie=fe(te,ve,we),ie!==null&&(me.save(),me.font="bold 20px Arial",me.fillStyle="yellow",me.strokeStyle="black",me.lineWidth=3,me.strokeText(`${ie}°`,ve.x-20,ve.y-30),me.fillText(`${ie}°`,ve.x-20,ve.y-30),me.restore()))}Q=ie!==null&&je&&Ze&&Ye&&Ie}}),k(ie),_(Q),s&&!a&&ie!==null&&Q&&(v==="down"&&ie<=sL?S("up"):v==="up"&&ie>=nL&&(S("down"),y(oe=>oe+1),G(oe=>oe+1))),s&&!a&&U>=5?ie!==null?Q?v==="down"&&ie>nL-20?re("Crunch higher! Lift those shoulders!"):v==="up"&&ie<sL+20?re("Lower back down slowly and controlled!"):re(Q&&v==="up"?"Great crunch! Feel those abs working!":Q&&v==="down"?"Perfect! Keep that steady rhythm!":"Keep going! Focus on controlled movements!"):re("Lie down flat and face the camera!"):re("Lie down and position yourself for crunches!"):s&&!a&&U<5&&re("Keep going! I'll give you tips soon!")}g.current=requestAnimationFrame(ee)}catch{g.current=requestAnimationFrame(ee)}};b.useEffect(()=>{if(s&&c&&p)g.current=requestAnimationFrame(ee);else if(g.current&&(cancelAnimationFrame(g.current),g.current=null),f.current&&!s){const ce=f.current.getContext("2d");ce&&ce.clearRect(0,0,f.current.width,f.current.height)}return()=>{g.current&&cancelAnimationFrame(g.current)}},[s,c,p]);const Pe=ce=>{const me=Math.floor(ce/60),ie=ce%60;return`${me}:${ie.toString().padStart(2,"0")}`},Re=()=>{r(!1),R(!0),xe(x,A)};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-green-900 to-teal-900 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/workouts"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Crunches Workout"})}),u.jsx("div",{className:"w-16"})," "]})}),u.jsxs("div",{className:"pt-10 w-full h-full flex-1 flex flex-col items-center justify-center",children:[u.jsx(ko,{children:e&&u.jsx(X.div,{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-50 p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-green-700 max-w-lg text-center",initial:{scale:.9,y:20},animate:{scale:1,y:0},transition:{delay:.1,duration:.3},children:[u.jsx(k_,{className:"text-green-400 w-16 h-16 mx-auto mb-4"}),u.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-teal-500 mb-4",children:"Crunches Workout"}),u.jsxs("div",{className:"text-green-200 text-lg mb-6 space-y-3",children:[u.jsx("p",{children:u.jsx("strong",{children:"Instructions:"})}),u.jsx("p",{children:"• Lie on your back facing the camera"}),u.jsx("p",{children:"• Bend your knees and keep feet flat"}),u.jsx("p",{children:"• Lift your shoulders off the ground"}),u.jsx("p",{children:"• Crunch your abs and lower back down"}),u.jsx("p",{children:"• I'll count each perfect crunch for you!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-green-300 border-green-600 hover:bg-green-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:Ce,className:"bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold",children:"Start Workout!"})]})]})})}),u.jsxs("div",{className:"absolute inset-0 w-full h-full z-0",children:[u.jsx("video",{ref:h,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),u.jsx("canvas",{ref:f,className:"absolute inset-0 w-full h-full"}),s&&a&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[u.jsx("div",{className:"text-green-400 text-3xl sm:text-5xl font-bold mb-2 bg-black/40 px-4 py-2 rounded-xl",children:"Lie down and get ready!"}),u.jsx("div",{className:"text-green-400 text-7xl sm:text-9xl font-bold bg-black/40 px-8 py-4 rounded-2xl",children:i})]})]}),!e&&u.jsx("div",{className:"fixed top-16 right-4 z-40 w-64",children:u.jsxs("div",{className:"bg-black/90 rounded-xl p-4 shadow-lg border border-green-600",children:[u.jsx("h3",{className:"text-green-400 font-bold text-lg mb-3 text-center",children:"📊 Your Stats"}),u.jsxs("div",{className:"space-y-2 text-sm",children:[M.lastWorkout?u.jsxs("div",{className:"bg-green-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-green-300 font-semibold",children:"Last Workout:"}),u.jsxs("div",{className:"text-white",children:[M.lastWorkout.count," crunches"]}),u.jsx("div",{className:"text-gray-400",children:M.lastWorkout.date})]}):u.jsxs("div",{className:"bg-green-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-green-300 font-semibold",children:"First workout!"}),u.jsx("div",{className:"text-gray-400",children:"No previous data"})]}),M.bestWorkout&&u.jsxs("div",{className:"bg-yellow-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-yellow-300 font-semibold",children:"🏆 Personal Best:"}),u.jsxs("div",{className:"text-white",children:[M.bestWorkout.count," crunches"]}),u.jsx("div",{className:"text-gray-400",children:M.bestWorkout.date})]}),u.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2",children:[u.jsx("div",{className:"text-gray-300 font-semibold",children:"Total:"}),u.jsxs("div",{className:"text-white",children:[M.totalWorkouts," workouts"]}),u.jsxs("div",{className:"text-white",children:[M.totalCrunches," crunches"]})]})]})]})}),s&&!a&&!$&&u.jsx("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md flex flex-col items-center",children:u.jsxs("div",{className:"bg-black/80 rounded-xl p-4 shadow-lg border border-green-600",children:[u.jsxs("div",{className:"text-center mb-2",children:[u.jsx("div",{className:"text-3xl font-bold text-green-400",children:x}),u.jsx("div",{className:"text-sm text-white",children:"Crunches"})]}),u.jsxs("div",{className:"flex justify-between text-sm text-gray-300",children:[u.jsxs("span",{children:["Time: ",Pe(A)]}),u.jsxs("span",{children:["Phase: ",v.toUpperCase()]})]})]})}),s&&!a&&!$&&u.jsx("div",{className:"fixed top-32 left-1/2 transform -translate-x-1/2 z-40 max-w-md",children:u.jsx("div",{className:`text-center px-4 py-2 rounded-lg ${T?"bg-green-600/80 text-white":"bg-red-600/80 text-white"}`,children:T?"Perfect form! Keep crunching!":"Lie down and face the camera"})}),s&&!a&&!$&&z&&u.jsx("div",{className:"fixed top-48 left-1/2 transform -translate-x-1/2 z-40 max-w-lg",children:u.jsxs("div",{className:"bg-green-600/90 text-white text-center px-6 py-3 rounded-lg shadow-lg border-2 border-green-400",children:[u.jsx("div",{className:"text-lg font-bold",children:"💪 Coach Says:"}),u.jsx("div",{className:"text-base mt-1",children:z})]})}),s&&!a&&!$&&u.jsx("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:u.jsx(Se,{onClick:Re,className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg",children:"Finish Workout"})}),$&&u.jsx("div",{className:"fixed inset-0 flex flex-col items-center justify-center z-50 bg-black/80",children:u.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-green-700 max-w-lg text-center",children:[u.jsx("h2",{className:"text-3xl font-bold text-green-400 mb-4",children:"Workout Complete!"}),u.jsxs("div",{className:"text-xl text-white mb-6 space-y-2",children:[u.jsx("p",{className:"text-green-400 font-bold text-3xl",children:x}),u.jsx("p",{children:"Crunches completed"}),u.jsxs("p",{children:["Duration: ",Pe(A)]}),u.jsx("p",{className:"text-sm text-gray-300 mt-4",children:"Excellent core work! Your abs are getting stronger!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-green-300 border-green-600 hover:bg-green-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:Ce,className:"bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold",children:"Do Another Set"})]})]})})]})]})},rL=3,ZGe="purple",oC=.3,iL=120,oL=60,JGe=()=>{const[,t]=Po(),[e,n]=b.useState(!0),[s,r]=b.useState(!1),[i,o]=b.useState(rL),[a,l]=b.useState(!1),[c,d]=b.useState(null),h=b.useRef(null),f=b.useRef(null),[p,m]=b.useState(null),g=b.useRef(null),[x,y]=b.useState(0),[v,S]=b.useState("down"),[C,k]=b.useState(null),[T,_]=b.useState(null),[$,R]=b.useState(!1),[A,j]=b.useState(!1),[F,L]=b.useState(0),[M,q]=b.useState(null),[z,re]=b.useState({totalWorkouts:0,totalJumpingJacks:0}),[U,G]=b.useState(""),[xe,Ce]=b.useState(0);b.useEffect(()=>{const ie=localStorage.getItem("jumpingJacksWorkoutStats");ie&&re(JSON.parse(ie))},[]);const De=(ie,Q)=>{const oe=new Date().toLocaleDateString(),ae={count:ie,duration:Q,date:oe},Ae={lastWorkout:ae,bestWorkout:!z.bestWorkout||ie>z.bestWorkout.count?ae:z.bestWorkout,totalWorkouts:z.totalWorkouts+1,totalJumpingJacks:z.totalJumpingJacks+ie};re(Ae),localStorage.setItem("jumpingJacksWorkoutStats",JSON.stringify(Ae))};b.useEffect(()=>{(async()=>{try{const Q=await go("lightning");d(Q)}catch(Q){console.error("Error initializing pose detection:",Q)}})()},[]),b.useEffect(()=>((async()=>{try{const Q=await navigator.mediaDevices.getUserMedia({video:!0});h.current&&(h.current.srcObject=Q,h.current.onloadedmetadata=()=>{h.current&&(h.current.play(),f.current&&(f.current.width=h.current.videoWidth,f.current.height=h.current.videoHeight))}),m(Q)}catch(Q){console.error("Error accessing camera:",Q)}})(),()=>{p&&p.getTracks().forEach(Q=>Q.stop()),g.current&&cancelAnimationFrame(g.current)}),[]);const fe=()=>{n(!1),r(!0),o(rL),l(!0),y(0),S("down"),j(!1),q(Date.now()),G(""),Ce(0)};b.useEffect(()=>{if(a&&i>0){const ie=setTimeout(()=>o(Q=>Q-1),1e3);return()=>clearTimeout(ie)}else a&&i===0&&l(!1)},[a,i]);const ee=ie=>({r:139,g:92,b:246});b.useEffect(()=>{let ie=null;return s&&!a&&M&&(ie=setInterval(()=>{L(Math.floor((Date.now()-M)/1e3))},1e3)),()=>{ie&&clearInterval(ie)}},[s,a,M]);const Pe=(ie,Q,oe)=>{if(!ie||!Q||!oe)return null;const ae=Math.atan2(oe.y-Q.y,oe.x-Q.x)-Math.atan2(ie.y-Q.y,ie.x-Q.x);let Ae=Math.abs(ae*180/Math.PI);return Ae>180&&(Ae=360-Ae),Math.round(Ae)},Re=async()=>{if(!h.current||!f.current||!c||h.current.readyState<2){g.current=requestAnimationFrame(Re);return}try{const ie=await pr(h.current,1,.3),Q=f.current.getContext("2d");if(Q){Q.clearRect(0,0,f.current.width,f.current.height),Q.drawImage(h.current,0,0,f.current.width,f.current.height);let oe=null,ae=null,Ae=!1;if(ie.forEach(Be=>{if(Be.keypoints&&Be.keypoints.length>0){const Xe=Be.keypoints,lt=ee(ZGe),Me=`rgb(${lt.r}, ${lt.g}, ${lt.b})`,je=Me,Ze=`rgba(${lt.r}, ${lt.g}, ${lt.b}, 0.7)`;Q.strokeStyle=Me,Q.lineWidth=3,Ac().forEach(([de,Ee])=>{const mt=Xe.find(jt=>jt.name===de),It=Xe.find(jt=>jt.name===Ee);mt&&It&&(mt.score??0)>oC&&(It.score??0)>oC&&(Q.save(),Q.shadowColor=Ze,Q.shadowBlur=10,Q.beginPath(),Q.moveTo(mt.x,mt.y),Q.lineTo(It.x,It.y),Q.stroke(),Q.restore())}),Xe.forEach(de=>{(de.score??0)>oC&&(Q.save(),Q.shadowColor=Ze,Q.shadowBlur=15,Q.fillStyle=je,Q.beginPath(),Q.arc(de.x,de.y,6,0,2*Math.PI),Q.fill(),Q.restore())});const Ie=Xe.find(de=>de.name==="left_shoulder"),B=Xe.find(de=>de.name==="left_elbow"),Z=Xe.find(de=>de.name==="left_wrist"),te=Xe.find(de=>de.name==="right_shoulder"),ve=Xe.find(de=>de.name==="right_elbow"),we=Xe.find(de=>de.name==="right_wrist");Ie&&B&&Z&&(oe=Pe(Ie,B,Z),oe!==null&&(Q.save(),Q.font="bold 16px Arial",Q.fillStyle="yellow",Q.strokeStyle="black",Q.lineWidth=2,Q.strokeText(`L: ${oe}°`,B.x-40,B.y-10),Q.fillText(`L: ${oe}°`,B.x-40,B.y-10),Q.restore())),te&&ve&&we&&(ae=Pe(te,ve,we),ae!==null&&(Q.save(),Q.font="bold 16px Arial",Q.fillStyle="yellow",Q.strokeStyle="black",Q.lineWidth=2,Q.strokeText(`R: ${ae}°`,ve.x+10,ve.y-10),Q.fillText(`R: ${ae}°`,ve.x+10,ve.y-10),Q.restore())),Ae=oe!==null&&ae!==null}}),k(oe),_(ae),R(Ae),s&&!a&&oe!==null&&ae!==null&&Ae){const Be=(oe+ae)/2;v==="down"&&Be>=iL?S("up"):v==="up"&&Be<=oL&&(S("down"),y(Xe=>Xe+1),Ce(Xe=>Xe+1))}if(s&&!a&&xe>=5)if(oe!==null&&ae!==null){const Be=(oe+ae)/2;Ae?v==="down"&&Be<iL-30?G("Jump higher! Get those arms up!"):v==="up"&&Be>oL+30?G("Bring your arms all the way down!"):G(Ae&&v==="up"?"Great jump! Keep that energy up!":Ae&&v==="down"?"Perfect! Keep jumping with rhythm!":"Keep going! Jump with full arm motion!"):G("Stand up straight and face the camera!")}else G("Stand facing the camera and start jumping!");else s&&!a&&xe<5&&G("Keep jumping! I'll give you tips soon!")}g.current=requestAnimationFrame(Re)}catch{g.current=requestAnimationFrame(Re)}};b.useEffect(()=>{if(s&&c&&p)g.current=requestAnimationFrame(Re);else if(g.current&&(cancelAnimationFrame(g.current),g.current=null),f.current&&!s){const ie=f.current.getContext("2d");ie&&ie.clearRect(0,0,f.current.width,f.current.height)}return()=>{g.current&&cancelAnimationFrame(g.current)}},[s,c,p]);const ce=ie=>{const Q=Math.floor(ie/60),oe=ie%60;return`${Q}:${oe.toString().padStart(2,"0")}`},me=()=>{r(!1),j(!0),De(x,F)};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 text-white flex flex-col items-center justify-center p-4 relative overflow-hidden",children:[u.jsx("div",{className:"w-full fixed top-0 left-0 z-50",children:u.jsxs("div",{className:"flex items-center justify-between bg-gradient-to-r from-[#6b1b1b] to-black h-10 px-4 shadow-md",children:[u.jsxs("button",{onClick:()=>t("/workouts"),className:"flex items-center text-white hover:text-red-400 font-semibold text-sm",children:[u.jsx(fa,{className:"w-5 h-5 mr-1"})," Back"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-lg",children:"Jumping Jacks Workout"})}),u.jsx("div",{className:"w-16"})]})}),u.jsxs("div",{className:"pt-10 w-full h-full flex-1 flex flex-col items-center justify-center",children:[u.jsx(ko,{children:e&&u.jsx(X.div,{className:"absolute inset-0 bg-black/90 flex flex-col items-center justify-center z-50 p-8",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:u.jsxs(X.div,{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-purple-700 max-w-lg text-center",initial:{scale:.9,y:20},animate:{scale:1,y:0},transition:{delay:.1,duration:.3},children:[u.jsx(T_,{className:"text-purple-400 w-16 h-16 mx-auto mb-4"}),u.jsx("h2",{className:"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-violet-500 mb-4",children:"Jumping Jacks Workout"}),u.jsxs("div",{className:"text-purple-200 text-lg mb-6 space-y-3",children:[u.jsx("p",{children:u.jsx("strong",{children:"Instructions:"})}),u.jsx("p",{children:"• Stand facing the camera with feet together"}),u.jsx("p",{children:"• Jump and spread your legs wide"}),u.jsx("p",{children:"• Raise your arms overhead as you jump"}),u.jsx("p",{children:"• Jump back to starting position"}),u.jsx("p",{children:"• I'll count each perfect jumping jack!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-purple-300 border-purple-600 hover:bg-purple-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:fe,className:"bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white font-semibold",children:"Start Workout!"})]})]})})}),u.jsxs("div",{className:"absolute inset-0 w-full h-full z-0",children:[u.jsx("video",{ref:h,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,autoPlay:!0,muted:!0}),u.jsx("canvas",{ref:f,className:"absolute inset-0 w-full h-full"}),s&&a&&u.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-none",children:[u.jsx("div",{className:"text-purple-400 text-3xl sm:text-5xl font-bold mb-2 bg-black/40 px-4 py-2 rounded-xl",children:"Stand ready to jump!"}),u.jsx("div",{className:"text-purple-400 text-7xl sm:text-9xl font-bold bg-black/40 px-8 py-4 rounded-2xl",children:i})]})]}),!e&&u.jsx("div",{className:"fixed top-16 right-4 z-40 w-64",children:u.jsxs("div",{className:"bg-black/90 rounded-xl p-4 shadow-lg border border-purple-600",children:[u.jsx("h3",{className:"text-purple-400 font-bold text-lg mb-3 text-center",children:"📊 Your Stats"}),u.jsxs("div",{className:"space-y-2 text-sm",children:[z.lastWorkout?u.jsxs("div",{className:"bg-purple-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-purple-300 font-semibold",children:"Last Workout:"}),u.jsxs("div",{className:"text-white",children:[z.lastWorkout.count," jumping jacks"]}),u.jsx("div",{className:"text-gray-400",children:z.lastWorkout.date})]}):u.jsxs("div",{className:"bg-purple-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-purple-300 font-semibold",children:"First workout!"}),u.jsx("div",{className:"text-gray-400",children:"No previous data"})]}),z.bestWorkout&&u.jsxs("div",{className:"bg-yellow-900/30 rounded-lg p-2",children:[u.jsx("div",{className:"text-yellow-300 font-semibold",children:"🏆 Personal Best:"}),u.jsxs("div",{className:"text-white",children:[z.bestWorkout.count," jumping jacks"]}),u.jsx("div",{className:"text-gray-400",children:z.bestWorkout.date})]}),u.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-2",children:[u.jsx("div",{className:"text-gray-300 font-semibold",children:"Total:"}),u.jsxs("div",{className:"text-white",children:[z.totalWorkouts," workouts"]}),u.jsxs("div",{className:"text-white",children:[z.totalJumpingJacks," jumping jacks"]})]})]})]})}),s&&!a&&!A&&u.jsx("div",{className:"fixed top-16 left-1/2 transform -translate-x-1/2 z-40 w-full max-w-md flex flex-col items-center",children:u.jsxs("div",{className:"bg-black/80 rounded-xl p-4 shadow-lg border border-purple-600",children:[u.jsxs("div",{className:"text-center mb-2",children:[u.jsx("div",{className:"text-3xl font-bold text-purple-400",children:x}),u.jsx("div",{className:"text-sm text-white",children:"Jumping Jacks"})]}),u.jsxs("div",{className:"flex justify-between text-sm text-gray-300",children:[u.jsxs("span",{children:["Time: ",ce(F)]}),u.jsxs("span",{children:["Phase: ",v.toUpperCase()]})]})]})}),s&&!a&&!A&&u.jsx("div",{className:"fixed top-32 left-1/2 transform -translate-x-1/2 z-40 max-w-md",children:u.jsx("div",{className:`text-center px-4 py-2 rounded-lg ${$?"bg-green-600/80 text-white":"bg-red-600/80 text-white"}`,children:$?"Great form! Keep jumping!":"Stand facing the camera and jump!"})}),s&&!a&&!A&&U&&u.jsx("div",{className:"fixed top-48 left-1/2 transform -translate-x-1/2 z-40 max-w-lg",children:u.jsxs("div",{className:"bg-purple-600/90 text-white text-center px-6 py-3 rounded-lg shadow-lg border-2 border-purple-400",children:[u.jsx("div",{className:"text-lg font-bold",children:"💪 Coach Says:"}),u.jsx("div",{className:"text-base mt-1",children:U})]})}),s&&!a&&!A&&u.jsx("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-40",children:u.jsx(Se,{onClick:me,className:"bg-purple-600 hover:bg-purple-700 text-white font-semibold px-6 py-3 rounded-lg",children:"Finish Workout"})}),A&&u.jsx("div",{className:"fixed inset-0 flex flex-col items-center justify-center z-50 bg-black/80",children:u.jsxs("div",{className:"bg-gradient-to-br from-gray-800 to-black p-8 rounded-2xl shadow-2xl border border-purple-700 max-w-lg text-center",children:[u.jsx("h2",{className:"text-3xl font-bold text-purple-400 mb-4",children:"Workout Complete!"}),u.jsxs("div",{className:"text-xl text-white mb-6 space-y-2",children:[u.jsx("p",{className:"text-purple-400 font-bold text-3xl",children:x}),u.jsx("p",{children:"Jumping Jacks completed"}),u.jsxs("p",{children:["Duration: ",ce(F)]}),u.jsx("p",{className:"text-sm text-gray-300 mt-4",children:"Fantastic cardio session! Your heart and muscles thank you!"})]}),u.jsxs("div",{className:"flex justify-center gap-4",children:[u.jsx(Se,{onClick:()=>t("/workouts"),variant:"outline",className:"text-purple-300 border-purple-600 hover:bg-purple-700 hover:text-white",children:"Back to Workouts"}),u.jsx(Se,{onClick:fe,className:"bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white font-semibold",children:"Do Another Set"})]})]})})]})]})},e9e=Sx("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),lX=b.forwardRef(({className:t,variant:e,...n},s)=>u.jsx("div",{ref:s,role:"alert",className:Pt(e9e({variant:e}),t),...n}));lX.displayName="Alert";const t9e=b.forwardRef(({className:t,...e},n)=>u.jsx("h5",{ref:n,className:Pt("mb-1 font-medium leading-none tracking-tight",t),...e}));t9e.displayName="AlertTitle";const cX=b.forwardRef(({className:t,...e},n)=>u.jsx("div",{ref:n,className:Pt("text-sm [&_p]:leading-relaxed",t),...e}));cX.displayName="AlertDescription";function n9e({onImageUpload:t,onVideoUpload:e,onCancel:n}){const[s,r]=b.useState(!1),[i,o]=b.useState(null),[a,l]=b.useState(!1),c=b.useRef(null),d=["image/jpeg","image/png","image/webp","image/gif"],h=["video/mp4","video/webm","video/quicktime"],f=v=>{const S=v.target.files;S&&S.length>0&&x(S[0])},p=v=>{v.preventDefault(),v.stopPropagation(),r(!0)},m=v=>{v.preventDefault(),v.stopPropagation(),r(!1)},g=v=>{v.preventDefault(),v.stopPropagation(),r(!1);const S=v.dataTransfer.files;S&&S.length>0&&x(S[0])},x=v=>{o(null),l(!0);const S=v.type,C=URL.createObjectURL(v);if(d.includes(S)){const k=new Image;k.onload=()=>{l(!1),t(k,C)},k.onerror=()=>{l(!1),o("Failed to load image. Please try another file."),URL.revokeObjectURL(C)},k.src=C}else if(h.includes(S)){const k=document.createElement("video");k.onloadeddata=()=>{l(!1),e(k,C)},k.onerror=()=>{l(!1),o("Failed to load video. Please try another file."),URL.revokeObjectURL(C)},k.src=C,k.load()}else l(!1),o("Please upload an image (JPG, PNG, WEBP) or video (MP4, WEBM).")},y=()=>{c.current&&c.current.click()};return u.jsxs("div",{className:"p-6 bg-gray-900 rounded-lg max-w-md w-full border border-red-900/30 shadow-lg",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h3",{className:"text-xl font-serif bg-gradient-to-r from-red-500 to-red-600 text-transparent bg-clip-text",children:"Upload Media"}),u.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:u.jsx("span",{className:"material-icons",children:"close"})})]}),u.jsxs("div",{className:`upload-zone p-8 mb-4 flex flex-col items-center justify-center bg-gray-800/50 border border-dashed border-red-900/50 rounded-lg ${s?"bg-red-900/20 border-red-600":""}`,onDragOver:p,onDragLeave:m,onDrop:g,children:[u.jsx("span",{className:"material-icons text-4xl text-red-500 mb-3",children:a?"hourglass_top":"cloud_upload"}),u.jsx("p",{className:"text-center text-gray-300 mb-3",children:a?"Processing your file...":"Drag & drop your image or video here"}),u.jsx("p",{className:"text-xs text-gray-500 mb-4 text-center",children:"Supported formats: JPG, PNG, WEBP, MP4, WEBM"}),!a&&u.jsx(Se,{onClick:y,className:"bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700",children:"Browse Files"}),a&&u.jsx("div",{className:"loader mt-2"}),u.jsx("input",{type:"file",ref:c,onChange:f,accept:".jpg,.jpeg,.png,.webp,.gif,.mp4,.webm,.mov",className:"hidden"})]}),i&&u.jsx(lX,{variant:"destructive",className:"mb-4 bg-red-950 border border-red-700 text-red-300",children:u.jsx(cX,{children:i})}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsx(Se,{variant:"outline",onClick:n,className:"border-red-900/30 bg-gray-900 text-gray-300 hover:bg-gray-800",children:"Cancel"}),u.jsx(Se,{className:"bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700",onClick:y,disabled:a,children:a?"Processing...":"Select File"})]})]})}function s9e({onImageUpload:t,onVideoUpload:e,onCancel:n}){const[s,r]=b.useState("main"),i=(l,c,d)=>{e(l,c,d)},o=(l,c)=>{e(l,c)},a=(l,c)=>{t(l,c)};return s==="preloaded"?u.jsx(BH,{onVideoSelect:i,onCancel:()=>r("main")}):s==="upload"?u.jsx(n9e,{onImageUpload:a,onVideoUpload:o,onCancel:()=>r("main")}):u.jsxs("div",{className:"p-8 bg-gray-900 rounded-lg max-w-md w-full border border-red-900/30 shadow-lg",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsx("h3",{className:"text-2xl font-serif bg-gradient-to-r from-red-500 to-red-600 text-transparent bg-clip-text",children:"Select Reference Media"}),u.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white",children:u.jsx("span",{className:"material-icons",children:"close"})})]}),u.jsx("p",{className:"text-gray-300 text-center mb-8",children:"Upload an image or video to compare with your live tracking"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs(Se,{onClick:()=>r("preloaded"),className:"w-full h-16 bg-gradient-to-r from-red-700 to-red-600 hover:from-red-800 hover:to-red-700 text-white font-semibold text-lg flex items-center justify-center gap-3",children:[u.jsx("span",{className:"material-icons text-2xl",children:"video_library"}),"Choose Pre-loaded Video"]}),u.jsxs(Se,{onClick:()=>r("upload"),className:"w-full h-16 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-gray-800 hover:to-gray-700 text-white font-semibold text-lg flex items-center justify-center gap-3",children:[u.jsx("span",{className:"material-icons text-2xl",children:"file_upload"}),"Upload Video"]}),u.jsxs(Se,{variant:"outline",onClick:n,className:"w-full border-red-900/30 bg-transparent text-gray-300 hover:bg-red-900/20 hover:text-white",children:[u.jsx("span",{className:"material-icons mr-2",children:"close"}),"Cancel"]})]}),u.jsx("div",{className:"mt-6 pt-4 border-t border-red-900/30",children:u.jsxs("div",{className:"text-xs text-gray-500 text-center space-y-1",children:[u.jsx("p",{children:"Pre-loaded videos include martial arts forms and techniques"}),u.jsx("p",{children:"Upload supports: JPG, PNG, WEBP, MP4, WEBM"})]})})]})}const r9e=()=>{const[,t]=Po(),[e,n]=b.useState(!1),[s,r]=b.useState(null),[i,o]=b.useState(null),a=(d,h,f)=>{r({video:d,url:h,data:f}),n(!1)},l=(d,h)=>{o({image:d,url:h}),n(!1)},c=()=>{n(!1)};return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-red-900 to-black text-white",children:[u.jsxs("div",{className:"w-full bg-gradient-to-r from-[#6b1b1b] to-black h-12 px-4 shadow-md flex items-center",children:[u.jsxs("button",{onClick:()=>t("/"),className:"flex items-center text-white hover:text-red-400 font-semibold",children:[u.jsx(fa,{className:"w-5 h-5 mr-2"})," Back to Home"]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("span",{className:"text-red-400 font-bold text-xl",children:"Live Routine Demo"})}),u.jsx("div",{className:"w-24"})," "]}),u.jsx("div",{className:"container mx-auto px-4 py-8",children:u.jsxs("div",{className:"max-w-4xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-8",children:[u.jsx("h1",{className:"text-4xl font-bold mb-4 bg-gradient-to-r from-red-400 to-orange-500 text-transparent bg-clip-text",children:"Start Live Routine"}),u.jsx("p",{className:"text-gray-300 text-lg",children:"Choose a pre-loaded martial arts form or upload your own reference media"})]}),!s&&!i&&u.jsx("div",{className:"text-center mb-8",children:u.jsx(Se,{onClick:()=>n(!0),className:"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold text-xl px-8 py-4 rounded-lg shadow-lg hover:shadow-red-500/50 transition-all duration-300",children:"Select Reference Media"})}),s&&u.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 border border-red-900/30 mb-8",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Selected Video"}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsx("div",{children:u.jsx("video",{src:s.url,controls:!0,className:"w-full rounded-lg",style:{maxHeight:"300px"}})}),u.jsxs("div",{className:"space-y-4",children:[s.data?u.jsxs(u.Fragment,{children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-white",children:s.data.name}),u.jsx("p",{className:"text-gray-400",children:s.data.description})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("span",{className:"px-3 py-1 bg-red-600 text-white text-sm rounded-full",children:s.data.category.replace("-"," ").toUpperCase()}),u.jsx("span",{className:`px-3 py-1 text-white text-sm rounded-full ${s.data.difficulty==="beginner"?"bg-green-600":s.data.difficulty==="intermediate"?"bg-yellow-600":"bg-red-600"}`,children:s.data.difficulty.toUpperCase()}),u.jsx("span",{className:"px-3 py-1 bg-gray-600 text-white text-sm rounded-full",children:s.data.duration})]})]}):u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-white",children:"Custom Video"}),u.jsx("p",{className:"text-gray-400",children:"User uploaded video"})]}),u.jsx(Se,{onClick:()=>r(null),variant:"outline",className:"border-red-600 text-red-400 hover:bg-red-900/20",children:"Remove Video"})]})]})]}),i&&u.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 border border-red-900/30 mb-8",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-red-400",children:"Selected Image"}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsx("div",{children:u.jsx("img",{src:i.url,alt:"Reference",className:"w-full rounded-lg",style:{maxHeight:"300px",objectFit:"contain"}})}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold text-white",children:"Custom Image"}),u.jsx("p",{className:"text-gray-400",children:"User uploaded reference image"})]}),u.jsx(Se,{onClick:()=>o(null),variant:"outline",className:"border-red-600 text-red-400 hover:bg-red-900/20",children:"Remove Image"})]})]})]}),(s||i)&&u.jsxs("div",{className:"text-center space-y-4",children:[u.jsx(Se,{className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold text-lg px-8 py-3 rounded-lg shadow-lg hover:shadow-green-500/50 transition-all duration-300",children:"Start Live Comparison"}),u.jsx("div",{children:u.jsx(Se,{onClick:()=>n(!0),variant:"outline",className:"border-red-600 text-red-400 hover:bg-red-900/20",children:"Choose Different Media"})})]}),u.jsxs("div",{className:"mt-12 grid md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"bg-gray-800/30 rounded-lg p-6 border border-red-900/20",children:[u.jsx("div",{className:"text-3xl mb-4",children:"🥋"}),u.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Pre-loaded Forms"}),u.jsx("p",{className:"text-gray-400",children:"Choose from a library of martial arts forms including karate katas, taekwondo poomsae, and more."})]}),u.jsxs("div",{className:"bg-gray-800/30 rounded-lg p-6 border border-red-900/20",children:[u.jsx("div",{className:"text-3xl mb-4",children:"📹"}),u.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Custom Uploads"}),u.jsx("p",{className:"text-gray-400",children:"Upload your own reference videos or images to compare with your live performance."})]}),u.jsxs("div",{className:"bg-gray-800/30 rounded-lg p-6 border border-red-900/20",children:[u.jsx("div",{className:"text-3xl mb-4",children:"🤖"}),u.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"AI Analysis"}),u.jsx("p",{className:"text-gray-400",children:"Get real-time pose comparison and feedback to improve your martial arts technique."})]})]})]})}),e&&u.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:u.jsx(s9e,{onImageUpload:l,onVideoUpload:a,onCancel:c})})]})},i9e=Ts.object({fullName:Ts.string().min(2,"Full name is required"),email:Ts.string().email("Please enter a valid email address"),socialMediaHandle:Ts.string().optional(),socialMediaPlatform:Ts.enum(["linkedin","twitter","github","instagram","tiktok","other"]).optional(),technicalHackAnswer:Ts.string().max(100,"Please keep under 100 words").optional(),unorthodoxThingAnswer:Ts.string().max(100,"Please keep under 100 words").optional(),resumeFileName:Ts.string().optional(),resumeFileUrl:Ts.string().optional()});function o9e(){const{toast:t}=Qw(),[e,n]=b.useState(!1),[s,r]=b.useState(null),[i,o]=b.useState(!1),a=a3({resolver:c3(i9e),defaultValues:{fullName:"",email:"",socialMediaHandle:"",socialMediaPlatform:void 0,technicalHackAnswer:"",unorthodoxThingAnswer:"",resumeFileName:"",resumeFileUrl:""}}),l=za({mutationFn:async h=>{const f=await aa("POST","/api/internship-applications",h);if(!f.ok){const p=await f.json();throw new Error(p.message||"Something went wrong")}return f.json()},onSuccess:()=>{n(!0),t({title:"Application Submitted!",description:"Thank you for your interest. We'll be in touch soon."})},onError:h=>{t({title:"Error",description:h.message,variant:"destructive"})}}),c=async h=>{var p;const f=(p=h.target.files)==null?void 0:p[0];if(f){if(f.type!=="application/pdf"&&f.type!=="application/msword"&&f.type!=="application/vnd.openxmlformats-officedocument.wordprocessingml.document"){t({title:"Invalid File Type",description:"Please upload a PDF or Word document",variant:"destructive"});return}if(f.size>5*1024*1024){t({title:"File Too Large",description:"Please upload a file smaller than 5MB",variant:"destructive"});return}o(!0);try{const m=new FormData;m.append("resume",f),m.append("applicantName",a.getValues("fullName")||"unknown");const g=await fetch("/api/upload-resume",{method:"POST",body:m});if(!g.ok)throw new Error("Upload failed");const x=await g.json();r(f),a.setValue("resumeFileName",f.name),a.setValue("resumeFileUrl",x.fileUrl),o(!1),t({title:"Resume Uploaded",description:"Your resume has been attached successfully."})}catch{o(!1),t({title:"Upload Failed",description:"Failed to upload resume. Please try again.",variant:"destructive"})}}},d=h=>{l.mutate(h)};return e?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black flex items-center justify-center p-4",children:u.jsxs(X.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"max-w-md w-full text-center",children:[u.jsx(X.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2},className:"mb-6",children:u.jsx(Ff,{className:"w-24 h-24 text-red-500 mx-auto"})}),u.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Application Submitted!"}),u.jsx("p",{className:"text-gray-300 mb-6",children:"Thank you for your interest in joining the CoachT team. We'll review your application and get back to you soon."}),u.jsx(Se,{onClick:()=>window.location.href="/",className:"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-500/25",children:"Return to Home"})]})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black py-12 px-4",children:u.jsxs("div",{className:"max-w-2xl mx-auto",children:[u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[u.jsxs("h1",{className:"text-4xl font-bold text-white mb-4",children:["Join the ",u.jsx("span",{className:"text-red-500",children:"CoachT"})," Team"]}),u.jsx("p",{className:"text-gray-300 text-lg",children:"Revolutionize martial arts training with AI"})]}),u.jsx(X.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:.2},children:u.jsxs(Ks,{className:"bg-gray-900/80 border-red-900/50 backdrop-blur-sm shadow-xl shadow-red-500/10",children:[u.jsxs(No,{className:"border-b border-red-900/30",children:[u.jsx(To,{className:"text-white text-2xl",children:"Internship Application"}),u.jsx(Ua,{className:"text-gray-400",children:"We're looking for passionate individuals to join our mission"})]}),u.jsx(rr,{children:u.jsx(YK,{...a,children:u.jsxs("form",{onSubmit:a.handleSubmit(d),className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx(Zo,{control:a.control,name:"fullName",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Full Name *"}),u.jsx(po,{children:u.jsx(ar,{...h,className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-500",placeholder:"Your full name"})}),u.jsx(mo,{})]})}),u.jsx(Zo,{control:a.control,name:"email",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Email Address *"}),u.jsx(po,{children:u.jsx(ar,{...h,type:"email",className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-500",placeholder:"your.email@example.com"})}),u.jsx(mo,{})]})})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsx(Zo,{control:a.control,name:"socialMediaPlatform",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Most Relevant Social Platform"}),u.jsxs(Iw,{onValueChange:h.onChange,defaultValue:h.value,children:[u.jsx(po,{children:u.jsx(lx,{className:"bg-gray-800 border-gray-600 text-white focus:border-red-500 focus:ring-1 focus:ring-red-500",children:u.jsx(Rw,{placeholder:"Select platform"})})}),u.jsxs(cx,{className:"bg-gray-800 border-gray-600",children:[u.jsx(ur,{value:"linkedin",children:"LinkedIn"}),u.jsx(ur,{value:"github",children:"GitHub"}),u.jsx(ur,{value:"twitter",children:"Twitter"}),u.jsx(ur,{value:"instagram",children:"Instagram"}),u.jsx(ur,{value:"tiktok",children:"TikTok"}),u.jsx(ur,{value:"other",children:"Other"})]})]}),u.jsx(mo,{})]})}),u.jsx(Zo,{control:a.control,name:"socialMediaHandle",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Handle/Username"}),u.jsx(po,{children:u.jsx(ar,{...h,className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-500",placeholder:"@username or profile URL"})}),u.jsx(mo,{})]})})]}),u.jsx(Zo,{control:a.control,name:"technicalHackAnswer",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Technical/Non-technical System Hack (Optional)"}),u.jsx(po,{children:u.jsx(q0,{...h,className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 min-h-20 focus:border-red-500 focus:ring-1 focus:ring-red-500",placeholder:"Describe a technical or non-technical system you hacked to your benefit (under 100 words)",maxLength:600})}),u.jsx(mo,{})]})}),u.jsx(Zo,{control:a.control,name:"unorthodoxThingAnswer",render:({field:h})=>u.jsxs(fo,{children:[u.jsx(Bi,{className:"text-white font-medium",children:"Unorthodox/Silly Thing You Made People Care About (Optional)"}),u.jsx(po,{children:u.jsx(q0,{...h,className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 min-h-20 focus:border-red-500 focus:ring-1 focus:ring-red-500",placeholder:"Describe something unorthodox or silly you got people to care about and how (under 100 words)",maxLength:600})}),u.jsx(mo,{})]})}),u.jsxs("div",{className:"space-y-4",children:[u.jsx(Bi,{className:"text-white font-medium",children:"Resume Upload"}),u.jsxs("div",{className:"border-2 border-dashed border-red-800/50 rounded-lg p-6 text-center bg-gray-800/30",children:[s?u.jsxs("div",{className:"flex items-center justify-center space-x-2 text-red-400",children:[u.jsx(uee,{className:"w-5 h-5"}),u.jsx("span",{children:s.name})]}):u.jsxs("div",{className:"space-y-2",children:[u.jsx(bb,{className:"w-8 h-8 text-red-400 mx-auto"}),u.jsx("p",{className:"text-gray-300",children:"Upload your resume (PDF or Word)"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Max file size: 5MB"})]}),u.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:c,className:"hidden",id:"resume-upload"}),u.jsx("label",{htmlFor:"resume-upload",className:`inline-block mt-4 px-6 py-2 rounded-lg cursor-pointer transition-all duration-200 ${i?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-500/25 hover:shadow-red-500/40"}`,children:i?"Uploading...":s?"Change Resume":"Choose File"})]})]}),u.jsx(Se,{type:"submit",disabled:l.isPending,className:"w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white py-4 text-lg font-bold shadow-xl shadow-red-500/25 hover:shadow-red-500/40 transition-all duration-200",children:l.isPending?"Submitting Application...":"Submit Application"})]})})})]})})]})})}const a9e=Sx("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function aL({className:t,variant:e,...n}){return u.jsx("div",{className:Pt(a9e({variant:e}),t),...n})}function l9e(){const[t,e]=b.useState(!1),[n,s]=b.useState(""),[r,i]=b.useState(""),{data:o,isLoading:a,error:l}=sm({queryKey:["/api/internship-applications"],enabled:t}),c=f=>{f.preventDefault(),n==="280806"?(e(!0),i("")):(i("Invalid password"),s(""))};if(!t)return u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black flex items-center justify-center p-4",children:u.jsx(X.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"max-w-md w-full",children:u.jsxs(Ks,{className:"bg-gray-900/80 border-red-900/50 backdrop-blur-sm shadow-xl shadow-red-500/10",children:[u.jsxs(No,{className:"text-center border-b border-red-900/30",children:[u.jsxs(To,{className:"text-white text-2xl flex items-center justify-center gap-2",children:[u.jsx(FV,{className:"w-6 h-6 text-red-400"}),"Admin Access"]}),u.jsx(Ua,{className:"text-gray-400",children:"Enter password to view applications"})]}),u.jsx(rr,{className:"pt-6",children:u.jsxs("form",{onSubmit:c,className:"space-y-4",children:[u.jsx(ar,{type:"password",value:n,onChange:f=>s(f.target.value),placeholder:"Enter password",className:"bg-gray-800 border-gray-600 text-white placeholder-gray-400 focus:border-red-500 focus:ring-1 focus:ring-red-500"}),r&&u.jsx("p",{className:"text-red-400 text-sm",children:r}),u.jsx(Se,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-500/25",children:"Access Admin Panel"})]})})]})})});const d=(f,p)=>{const m=document.createElement("a");m.href=f,m.download=p,document.body.appendChild(m),m.click(),document.body.removeChild(m)},h=(f,p)=>{let m=p;if(!p.startsWith("http"))switch(f){case"linkedin":m=p.startsWith("/")?`https://linkedin.com${p}`:`https://linkedin.com/in/${p}`;break;case"github":m=`https://github.com/${p.replace("@","")}`;break;case"twitter":m=`https://twitter.com/${p.replace("@","")}`;break;case"instagram":m=`https://instagram.com/${p.replace("@","")}`;break;case"tiktok":m=`https://tiktok.com/@${p.replace("@","")}`;break;default:m=p}window.open(m,"_blank")};return a?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"}),u.jsx("p",{className:"text-white",children:"Loading applications..."})]})}):l?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx("p",{className:"text-red-400 mb-4",children:"Error loading applications"}),u.jsx("p",{className:"text-gray-400",children:l?String(l):"Unknown error"})]})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-black via-red-950/20 to-black py-12 px-4",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[u.jsxs("h1",{className:"text-4xl font-bold text-white mb-4",children:[u.jsx("span",{className:"text-red-500",children:"CoachT"})," Internship Applications"]}),u.jsx("p",{className:"text-gray-300 text-lg",children:"Review and manage candidate applications"})]}),o&&o.length===0?u.jsx(X.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"text-center py-12",children:u.jsx("p",{className:"text-gray-400 text-lg",children:"No applications received yet"})}):u.jsx("div",{className:"grid gap-6",children:o==null?void 0:o.map((f,p)=>u.jsx(X.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:p*.1},children:u.jsxs(Ks,{className:"bg-gray-900/80 border-red-900/50 backdrop-blur-sm shadow-xl shadow-red-500/10",children:[u.jsx(No,{className:"border-b border-red-900/30",children:u.jsxs("div",{className:"flex justify-between items-start",children:[u.jsxs("div",{children:[u.jsxs(To,{className:"text-white text-xl flex items-center gap-2",children:[u.jsx(Ru,{className:"w-5 h-5 text-red-400"}),f.fullName]}),u.jsxs(Ua,{className:"text-gray-400 flex items-center gap-2 mt-2",children:[u.jsx(MV,{className:"w-4 h-4"}),f.email]})]}),u.jsx("div",{className:"text-right",children:u.jsxs(aL,{variant:"outline",className:"text-gray-300 border-gray-600",children:[u.jsx(Cx,{className:"w-3 h-3 mr-1"}),bK(new Date(f.createdAt),"MMM dd, yyyy")]})})]})}),u.jsxs(rr,{className:"pt-6 space-y-6",children:[f.socialMediaPlatform&&f.socialMediaHandle&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Social Media"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(aL,{className:"bg-red-600/20 text-red-300 border-red-600/50",children:f.socialMediaPlatform}),u.jsxs(Se,{variant:"ghost",size:"sm",onClick:()=>h(f.socialMediaPlatform,f.socialMediaHandle),className:"text-gray-300 hover:text-white hover:bg-red-600/20",children:[f.socialMediaHandle,u.jsx(cee,{className:"w-3 h-3 ml-1"})]})]})]}),f.resumeFileUrl&&u.jsxs("div",{children:[u.jsx("h4",{className:"text-white font-medium mb-2",children:"Resume"}),u.jsxs(Se,{onClick:()=>d(f.resumeFileUrl,f.resumeFileName||"resume.pdf"),className:"bg-red-600 hover:bg-red-700 text-white shadow-lg shadow-red-500/25",children:[u.jsx(lee,{className:"w-4 h-4 mr-2"}),"Download ",f.resumeFileName||"Resume"]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center gap-2",children:[u.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Technical/System Hack"]}),u.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700 min-h-[100px]",children:f.technicalHackAnswer?u.jsx("p",{className:"text-gray-300 leading-relaxed",children:f.technicalHackAnswer}):u.jsx("p",{className:"text-gray-500 italic",children:"No response provided"})})]}),u.jsxs("div",{children:[u.jsxs("h4",{className:"text-white font-medium mb-3 flex items-center gap-2",children:[u.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Unorthodox/Silly Achievement"]}),u.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700 min-h-[100px]",children:f.unorthodoxThingAnswer?u.jsx("p",{className:"text-gray-300 leading-relaxed",children:f.unorthodoxThingAnswer}):u.jsx("p",{className:"text-gray-500 italic",children:"No response provided"})})]})]}),u.jsxs("div",{className:"bg-red-950/20 rounded-lg p-4 border border-red-800/30",children:[u.jsx("h4",{className:"text-red-300 font-medium mb-2",children:"Application Summary"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-400",children:"Contact:"}),u.jsx("p",{className:"text-white",children:f.email})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-400",children:"Social Platform:"}),u.jsx("p",{className:"text-white",children:f.socialMediaPlatform||"Not provided"})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-400",children:"Resume:"}),u.jsx("p",{className:"text-white",children:f.resumeFileName?"Attached":"Not provided"})]})]})]})]})]})},f.id))})]})})}function c9e(){return u.jsxs(RZ,{children:[u.jsx(ro,{path:"/",component:z4}),u.jsx(ro,{path:"/welcome",component:FGe}),u.jsx(ro,{path:"/renovate",component:AGe}),u.jsx(ro,{path:"/dashboard",component:MUe}),u.jsx(so,{path:"/app",component:w6e}),u.jsx(so,{path:"/practice",component:oGe}),u.jsx(so,{path:"/profile",component:RGe}),u.jsx(so,{path:"/challenges",component:LGe}),u.jsx(so,{path:"/workouts",component:BGe}),u.jsx(so,{path:"/challenges/max-punches",component:zGe}),u.jsx(so,{path:"/challenges/reaction-time",component:WGe}),u.jsx(so,{path:"/challenges/balance-beam",component:HGe}),u.jsx(so,{path:"/challenges/shifu-says",component:KGe}),u.jsx(so,{path:"/workouts/pushups",component:XGe}),u.jsx(so,{path:"/workouts/crunches",component:QGe}),u.jsx(so,{path:"/workouts/jumping-jacks",component:JGe}),u.jsx(so,{path:"/live-routine",component:r9e}),u.jsx(ro,{path:"/auth",component:z4}),u.jsx(ro,{path:"/early-access",component:TGe}),u.jsx(ro,{path:"/early",component:MGe}),u.jsx(ro,{path:"/internship",component:o9e}),u.jsx(ro,{path:"/admin/applications",component:l9e}),u.jsx(ro,{component:LUe})]})}function u9e(){return u.jsx(tV,{client:wv,children:u.jsx(FUe,{children:u.jsx(Nne,{children:u.jsxs(e7,{children:[u.jsx(ete,{}),u.jsx(c9e,{})]})})})})}const uX=document.createElement("style");uX.textContent=`
  body {
    font-family: 'Roboto', sans-serif;
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
  }
  
  .camera-container {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
  }
  
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }
  
  /* Loader Animation */
  .loader {
    border: 4px solid rgba(3, 218, 198, 0.3);
    border-radius: 50%;
    border-top: 4px solid #03DAC6;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`;document.head.appendChild(uX);const d9e=new ZB;aC.createRoot(document.getElementById("root")).render(u.jsx(zt.StrictMode,{children:u.jsx(tV,{client:d9e,children:u.jsx(e7,{children:u.jsx(u9e,{})})})}));
